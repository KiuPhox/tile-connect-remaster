function _instanceof(left,right){if(right!=null&&typeof Symbol!=="undefined"&&right[Symbol.hasInstance]){return!!right[Symbol.hasInstance](left)}else{return left instanceof right}}function _type_of(obj){"@swc/helpers - typeof";return obj&&typeof Symbol!=="undefined"&&obj.constructor===Symbol?"symbol":typeof obj}function _ts_generator(thisArg,body){var f,y,t,g,_={label:0,sent:function(){if(t[0]&1)throw t[1];return t[1]},trys:[],ops:[]};return g={next:verb(0),"throw":verb(1),"return":verb(2)},typeof Symbol==="function"&&(g[Symbol.iterator]=function(){return this}),g;function verb(n){return function(v){return step([n,v])}}function step(op){if(f)throw new TypeError("Generator is already executing.");while(_)try{if(f=1,y&&(t=op[0]&2?y["return"]:op[0]?y["throw"]||((t=y["return"])&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;if(y=0,t)op=[op[0]&2,t.value];switch(op[0]){case 0:case 1:t=op;break;case 4:_.label++;return{value:op[1],done:false};case 5:_.label++;y=op[1];op=[0];continue;case 7:op=_.ops.pop();_.trys.pop();continue;default:if(!(t=_.trys,t=t.length>0&&t[t.length-1])&&(op[0]===6||op[0]===2)){_=0;continue}if(op[0]===3&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(op[0]===6&&_.label<t[1]){_.label=t[1];t=op;break}if(t&&_.label<t[2]){_.label=t[2];_.ops.push(op);break}if(t[2])_.ops.pop();_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e];y=0}finally{f=t=0}if(op[0]&5)throw op[1];return{value:op[0]?op[1]:void 0,done:true}}}System.register("chunks:///start-scene.js",["cc"],function(e,t){var n,i,a,o,r,s,l,u,c,h,d,p,y,f,v,m,g,b,S,w,k,E,C,T,A,R,I,P,_,L,O,D,N,M,x,B,F,z,G,U,H,V,q,W,K,j,Y,X,J,Q,Z,$,ee,te,ne,ie,ae,oe,re,se,le,ue,ce,he,de,pe,ye,fe,ve,me,ge,be,Se;return{setters:[function(e){n=e.cclegacy,i=e._decorator,a=e.Node,o=e.Color,r=e.Canvas,s=e.UITransform,l=e.instantiate,u=e.Label,c=e.RichText,h=e.Toggle,d=e.Button,p=e.director,y=e.Component,f=e.isCCObject,v=e.Animation,m=e.CCString,g=e.CCInteger,b=e.AudioSource,S=e.resources,w=e.AudioClip,k=e.tween,E=e.CCFloat,C=e.Widget,T=e.Layout,A=e.Sprite,R=e.ccenum,I=e.find,P=e.Prefab,_=e.JsonAsset,L=e.AnimationClip,O=e.ImageAsset,D=e.SpriteFrame,N=e.Enum,M=e.easing,x=e.UIOpacity,B=e.view,F=e.screen,z=e.math,G=e.EventHandler,U=e.animation,H=e.CCBoolean,V=e.Input,q=e.Graphics,W=e.game,K=e.profiler,j=e.sys,Y=e.Vec3,X=e.ProgressBar,J=e.Font,Q=e.Vec2,Z=e.Director,$=e.Layers,ee=e.randomRangeInt,te=e.pseudoRandomRangeInt,ne=e.pseudoRandom,ie=e.randomRange,ae=e.Pool,oe=e.ParticleSystem2D,re=e.HorizontalTextAlignment,se=e.Tween,le=e.View,ue=e.ScrollView,ce=e.lerp,he=e.Mask,de=e.AssetManager,pe=e.DynamicAtlasManager,ye=e.macro,fe=e.settings,ve=e.Settings,me=e.ResolutionPolicy,ge=e.UIRenderer,be=e.Texture2D,Se=e.Game}],execute:function execute(){function e(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,i)}return n}function we(t){for(var n=1;n<arguments.length;n++){var i=null!=arguments[n]?arguments[n]:{};n%2?e(Object(i),!0).forEach(function(e){Re(t,e,i[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):e(Object(i)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))})}return t}function ke(e,t,n,i,a,o,r){try{var s=e[o](r),l=s.value}catch(e){return void n(e)}s.done?t(l):Promise.resolve(l).then(i,a)}function Ee(e){return function(){var t=this,n=arguments;return new Promise(function(i,a){var o=e.apply(t,n);function r(e){ke(o,i,a,r,s,"next",e)}function s(e){ke(o,i,a,r,s,"throw",e)}r(void 0)})}}function Ce(e,t){if(!_instanceof(e,t))throw new TypeError("Cannot call a class as a function")}function Te(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,Ke(i.key),i)}}function Ae(e,t,n){return t&&Te(e.prototype,t),n&&Te(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function Re(e,t,n){return(t=Ke(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Ie(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&_e(e,t)}function Pe(e){return(Pe=Object.setPrototypeOf?Object.getPrototypeOf.bind():function Pe(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _e(e,t){return(_e=Object.setPrototypeOf?Object.setPrototypeOf.bind():function _e(e,t){return e.__proto__=t,e})(e,t)}function Le(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function Oe(e,t,n){return(Oe=Le()?Reflect.construct.bind():function Oe(e,t,n){var i=[null];i.push.apply(i,t);var a=new(Function.bind.apply(e,i));return n&&_e(a,n.prototype),a}).apply(null,arguments)}function De(e){var t="function"==typeof Map?new Map:void 0;return(De=function De(e){if(null===e||(n=e,-1===Function.toString.call(n).indexOf("[native code]")))return e;var n;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,i)}function i(){return Oe(e,arguments,Pe(this).constructor)}return i.prototype=Object.create(e.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),_e(i,e)})(e)}function Ne(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Me(e,t){if(t&&("object"==(typeof t==="undefined"?"undefined":_type_of(t))||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return Ne(e)}function xe(e){var t=Le();return function(){var n,i=Pe(e);if(t){var a=Pe(this).constructor;n=Reflect.construct(i,arguments,a)}else n=i.apply(this,arguments);return Me(this,n)}}function Be(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Pe(e)););return e}function Fe(){return(Fe="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function Fe(e,t,n){var i=Be(e,t);if(i){var a=Object.getOwnPropertyDescriptor(i,t);return a.get?a.get.call(arguments.length<3?e:n):a.value}}).apply(this,arguments)}function ze(e,t,n,i){return(ze="undefined"!=typeof Reflect&&Reflect.set?Reflect.set:function ze(e,t,n,i){var a,o=Be(e,t);if(o){if((a=Object.getOwnPropertyDescriptor(o,t)).set)return a.set.call(i,n),!0;if(!a.writable)return!1}if(a=Object.getOwnPropertyDescriptor(i,t)){if(!a.writable)return!1;a.value=n,Object.defineProperty(i,t,a)}else Re(i,t,n);return!0})(e,t,n,i)}function Ge(e,t,n,i,a){if(!ze(e,t,n,i||e)&&a)throw new TypeError("failed to set property");return n}function Ue(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var i,a,o,r,s=[],l=!0,u=!1;try{if(o=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;l=!1}else for(;!(l=(i=o.call(n)).done)&&(s.push(i.value),s.length!==t);l=!0);}catch(e){u=!0,a=e}finally{try{if(!l&&null!=n.return&&(r=n.return(),Object(r)!==r))return}finally{if(u)throw a}}return s}}(e,t)||Ve(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function He(e){return function(e){if(Array.isArray(e))return qe(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||Ve(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Ve(e,t){if(e){if("string"==typeof e)return qe(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?qe(e,t):void 0}}function qe(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function We(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=Ve(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0,a=function a(){};return{s:a,n:function n(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function e(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,r=!0,s=!1;return{s:function s(){n=n.call(e)},n:function n1(){var _$e=n.next();return r=_$e.done,_$e},e:function e(e){s=!0,o=e},f:function f(){try{r||null==n.return||n.return()}finally{if(s)throw o}}}}function Ke(e){var t=function(e,t){if("object"!=(typeof e==="undefined"?"undefined":_type_of(e))||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t||"default");if("object"!=(typeof i==="undefined"?"undefined":_type_of(i)))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==(typeof t==="undefined"?"undefined":_type_of(t))?t:String(t)}function je(e,t,n,i){n&&Object.defineProperty(e,t,{enumerable:n.enumerable,configurable:n.configurable,writable:n.writable,value:n.initializer?n.initializer.call(i):void 0})}function Ye(e,t,n,i,a){var o={};return Object.keys(i).forEach(function(e){o[e]=i[e]}),o.enumerable=!!o.enumerable,o.configurable=!!o.configurable,("value"in o||o.initializer)&&(o.writable=!0),o=n.slice().reverse().reduce(function(n,i){return i(e,t,n)||n},o),a&&void 0!==o.initializer&&(o.value=o.initializer?o.initializer.call(a):void 0,o.initializer=void 0),void 0===o.initializer&&(Object.defineProperty(e,t,o),o=null),o}var Xe,Je,Qe,Ze,$e,et,tt,nt,it;n._RF.push({},"b2bd1+njXxJxaFY3ymm06WU","debug-view-runtime-control",void 0);var at=i.ccclass,ot=i.property;Xe=at("internal.DebugViewRuntimeControl"),Je=ot(a),Qe=ot(a),Ze=ot(a),Xe((tt=Ye((et=function(e){Ie(n,e);var t=xe(n);function n(){var _$e;Ce(this,n);for(var i=arguments.length,a=new Array(i),r=0;r<i;r++)a[r]=arguments[r];return je(_$e=t.call.apply(t,[this].concat(a)),"compositeModeToggle",tt,Ne(_$e)),je(_$e,"singleModeToggle",nt,Ne(_$e)),je(_$e,"EnableAllCompositeModeButton",it,Ne(_$e)),_$e._single=0,_$e.strSingle=["No Single Debug","Vertex Color","Vertex Normal","Vertex Tangent","World Position","Vertex Mirror","Face Side","UV0","UV1","UV Lightmap","Project Depth","Linear Depth","Fragment Normal","Fragment Tangent","Fragment Binormal","Base Color","Diffuse Color","Specular Color","Transparency","Metallic","Roughness","Specular Intensity","IOR","Direct Diffuse","Direct Specular","Direct All","Env Diffuse","Env Specular","Env All","Emissive","Light Map","Shadow","AO","Fresnel","Direct Transmit Diffuse","Direct Transmit Specular","Env Transmit Diffuse","Env Transmit Specular","Transmit All","Direct Internal Specular","Env Internal Specular","Internal All","Fog"],_$e.strComposite=["Direct Diffuse","Direct Specular","Env Diffuse","Env Specular","Emissive","Light Map","Shadow","AO","Normal Map","Fog","Tone Mapping","Gamma Correction","Fresnel","Transmit Diffuse","Transmit Specular","Internal Specular","TT"],_$e.strMisc=["CSM Layer Coloration","Lighting With Albedo"],_$e.compositeModeToggleList=[],_$e.singleModeToggleList=[],_$e.miscModeToggleList=[],_$e.textComponentList=[],_$e.labelComponentList=[],_$e.textContentList=[],_$e._currentColorIndex=0,_$e.strColor=["<color=#ffffff>","<color=#000000>","<color=#ff0000>","<color=#00ff00>","<color=#0000ff>"],_$e.color=[o.WHITE,o.BLACK,o.RED,o.GREEN,o.BLUE],_$e}return Ae(n,[{key:"start",value:function value(){if(this.node.parent.getComponent(r)){var _$e=this.node.parent.getComponent(s),t=.5*_$e.width,_$n=.5*_$e.height,i=.1*t-t,a=_$n-.1*_$n,p=this.node.getChildByName("MiscMode"),y=l(p);y.parent=this.node,y.name="Buttons";var f=l(p);f.parent=this.node,f.name="Titles";for(var v=0;v<2;v++){var m=l(this.EnableAllCompositeModeButton.getChildByName("Label"));m.setPosition(i+(v>0?450:150),a,0),m.setScale(.75,.75,.75),m.parent=f;var g=m.getComponent(u);g.string=v?"----------Composite Mode----------":"----------Single Mode----------",g.color=o.WHITE,g.overflow=0,this.labelComponentList[this.labelComponentList.length]=g}a-=20;for(var b=0,S=0;S<this.strSingle.length;S++,b++){S===this.strSingle.length>>1&&(i+=200,b=0);var w=S?l(this.singleModeToggle):this.singleModeToggle;w.setPosition(i,a-20*b,0),w.setScale(.5,.5,.5),w.parent=this.singleModeToggle.parent;var k=w.getComponentInChildren(c);k.string=this.strSingle[S],this.textComponentList[this.textComponentList.length]=k,this.textContentList[this.textContentList.length]=k.string,w.on(h.EventType.TOGGLE,this.toggleSingleMode,this),this.singleModeToggleList[S]=w}i+=200,this.EnableAllCompositeModeButton.setPosition(i+15,a,0),this.EnableAllCompositeModeButton.setScale(.5,.5,.5),this.EnableAllCompositeModeButton.on(d.EventType.CLICK,this.enableAllCompositeMode,this),this.EnableAllCompositeModeButton.parent=y;var E=this.EnableAllCompositeModeButton.getComponentInChildren(u);this.labelComponentList[this.labelComponentList.length]=E;var C=l(this.EnableAllCompositeModeButton);C.setPosition(i+90,a,0),C.setScale(.5,.5,.5),C.on(d.EventType.CLICK,this.changeTextColor,this),C.parent=y,(E=C.getComponentInChildren(u)).string="TextColor",this.labelComponentList[this.labelComponentList.length]=E;var T=l(this.EnableAllCompositeModeButton);T.setPosition(i+200,a,0),T.setScale(.5,.5,.5),T.on(d.EventType.CLICK,this.hideUI,this),T.parent=this.node.parent,(E=T.getComponentInChildren(u)).string="Hide UI",this.labelComponentList[this.labelComponentList.length]=E,this.hideButtonLabel=E,a-=40;for(var A=0;A<this.strMisc.length;A++){var R=l(this.compositeModeToggle);R.setPosition(i,a-20*A,0),R.setScale(.5,.5,.5),R.parent=p;var I=R.getComponentInChildren(c);I.string=this.strMisc[A],this.textComponentList[this.textComponentList.length]=I,this.textContentList[this.textContentList.length]=I.string,R.getComponent(h).isChecked=!!A,R.on(h.EventType.TOGGLE,A?this.toggleLightingWithAlbedo:this.toggleCSMColoration,this),this.miscModeToggleList[A]=R}a-=150;for(var P=0;P<this.strComposite.length;P++){var _=P?l(this.compositeModeToggle):this.compositeModeToggle;_.setPosition(i,a-20*P,0),_.setScale(.5,.5,.5),_.parent=this.compositeModeToggle.parent;var L=_.getComponentInChildren(c);L.string=this.strComposite[P],this.textComponentList[this.textComponentList.length]=L,this.textContentList[this.textContentList.length]=L.string,_.on(h.EventType.TOGGLE,this.toggleCompositeMode,this),this.compositeModeToggleList[P]=_}}else console.error("debug-view-runtime-control should be child of Canvas")}},{key:"isTextMatched",value:function value(e,t){var _$n=new String(e),i=_$n.search(">");return-1===i?e===t:(_$n=(_$n=_$n.substr(i+1)).substr(0,_$n.search("<")))===t}},{key:"toggleSingleMode",value:function value(e){for(var t=p.root.debugView,_$n=e.getComponentInChildren(c),i=0;i<this.strSingle.length;i++)this.isTextMatched(_$n.string,this.strSingle[i])&&(t.singleMode=i)}},{key:"toggleCompositeMode",value:function value(e){for(var t=p.root.debugView,_$n=e.getComponentInChildren(c),i=0;i<this.strComposite.length;i++)this.isTextMatched(_$n.string,this.strComposite[i])&&t.enableCompositeMode(i,e.isChecked)}},{key:"toggleLightingWithAlbedo",value:function value(e){p.root.debugView.lightingWithAlbedo=e.isChecked}},{key:"toggleCSMColoration",value:function value(e){p.root.debugView.csmLayerColoration=e.isChecked}},{key:"enableAllCompositeMode",value:function value(e){var t=p.root.debugView;t.enableAllCompositeMode(!0);for(var _$n=0;_$n<this.compositeModeToggleList.length;_$n++){this.compositeModeToggleList[_$n].getComponent(h).isChecked=!0}var i=this.miscModeToggleList[0].getComponent(h);i.isChecked=!1,t.csmLayerColoration=!1,(i=this.miscModeToggleList[1].getComponent(h)).isChecked=!0,t.lightingWithAlbedo=!0}},{key:"hideUI",value:function value(e){var t=this.node.getChildByName("Titles"),_$n=!t.active;this.singleModeToggleList[0].parent.active=_$n,this.miscModeToggleList[0].parent.active=_$n,this.compositeModeToggleList[0].parent.active=_$n,this.EnableAllCompositeModeButton.parent.active=_$n,t.active=_$n,this.hideButtonLabel.string=_$n?"Hide UI":"Show UI"}},{key:"changeTextColor",value:function value(e){this._currentColorIndex++,this._currentColorIndex>=this.strColor.length&&(this._currentColorIndex=0);for(var t=0;t<this.textComponentList.length;t++)this.textComponentList[t].string=this.strColor[this._currentColorIndex]+this.textContentList[t]+"</color>";for(var _$n=0;_$n<this.labelComponentList.length;_$n++)this.labelComponentList[_$n].color=this.color[this._currentColorIndex]}},{key:"onLoad",value:function value(){}},{key:"update",value:function value(e){}}]),n}(y)).prototype,"compositeModeToggle",[Je],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return null}}),nt=Ye(et.prototype,"singleModeToggle",[Qe],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return null}}),it=Ye(et.prototype,"EnableAllCompositeModeButton",[Ze],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return null}}),$e=et));n._RF.pop(),n._RF.push({},"95972yG/ulEg4gycbc+QB5Y","ComponentUtils",void 0);var rt,st,lt,ut,ct,ht,dt,pt,yt,ft=GameCore.Utils,vt=ft.Array,mt=ft.Object,gt=ft.Valid,bt=["cc.Mask","cc.Label","cc.Canvas","cc.Camera","cc.Layout","cc.Button","cc.Sprite","cc.Widget","cc.Renderer","cc.Animation","cc.UIOpacity"],St=function(){function e(){Ce(this,e),this.validComponentCalled={}}return Ae(e,[{key:"validateRequiredComponents",value:function value(e){var t,n=e.name,i=e.constructor,a=We(this.getRequiredComponentNames(i));try{for(a.s();!(t=a.n()).done;){var o=t.value;if(!e.getComponent(o))throw new Error("".concat(n,": Missing required ").concat(o," component"))}}catch(e){a.e(e)}finally{a.f()}}},{key:"validateRequiredProperties",value:function value(e){var t,n=e.name,i=e.constructor,a=We(this.getRequiredPropNames(i));try{for(a.s();!(t=a.n()).done;){var o=t.value;if(!mt.hasOwn(e,o))throw new Error("".concat(n,": Missing required ").concat(o," property"));var r=this.getProperty(o,e);if(!f(r))throw new Error("".concat(n,": ").concat(o," property is not a cc object"))}}catch(e){a.e(e)}finally{a.f()}}},{key:"validateCustomProperties",value:function value(e){var t,n=e.name,i=We(this.getCustomPropNames(e));try{for(i.s();!(t=i.n()).done;){var a=t.value;if(!mt.hasOwn(e,a))throw new Error("".concat(n,": Missing required ").concat(a," property"));var o=this.getProperty(a,e);if(!f(o))throw new Error("".concat(n,": ").concat(a," property is not a cc object"))}}catch(e){i.e(e)}finally{i.f()}}},{key:"getProperty",value:function value(e,t){var n;if(mt.hasOwn(t,e))return(null!==(n=Object.getOwnPropertyDescriptor(t,e))&&void 0!==n?n:{}).value}},{key:"getProps",value:function value(e){if(!mt.hasOwn(e,"__props__"))return[];var t=e.__props__;return Array.isArray(t)?t:[]}},{key:"getRequiredPropNames",value:function value(e){return this.getProps(e).filter(function(t){return"node"!==t&&!!mt.hasOwn(e,t)&&!!f(e[t])&&t.indexOf("_")<0})}},{key:"getBaseComponentName",value:function value(e){for(var t=0,n=bt;t<n.length;t++){var i=n[t];if(i.indexOf(e)>=0)return i}return e}},{key:"getRequiredComponentNames",value:function value(e){var t=this;if(!mt.hasOwn(e,"_requireComponent"))return[];var n=e._requireComponent;return Array.isArray(n)?n.map(function(e){return t.getBaseComponentName(e)}):[]}},{key:"getCustomPropNames",value:function value(e){var t=this,n=Object.keys(e),i=this.getProps(e.constructor);return vt.difference(n,i).filter(function(e){return e.indexOf("_")<0}).filter(function(n){if(!mt.hasOwn(e,n))return!1;var i=t.getProperty(n,e);return!(!gt.isObject(i)||!f(i))})}}],[{key:"inst",get:function get(){return this._instance||(this._instance=new e),this._instance}},{key:"lazyValidateProperties",value:function value(e){var _$t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(_$t){var n=e.constructor,i=n.name;if(!this.inst.validComponentCalled[i])try{this.inst.validateRequiredComponents(e),this.inst.validateRequiredProperties(e),this.inst.validateCustomProperties(e)}catch(t){e.enabled=!1,console.error(t)}finally{this.inst.validComponentCalled[i]=!0}}}}]),e}();try{new St}catch(e){console.error("ComponentUtils",e)}n._RF.pop(),n._RF.push({},"60ac3vor0dMT5bXi8D3VSJN","BubbleAnimation",void 0);var wt=i.ccclass,kt=i.property,Et=GameCore.Utils.Array;rt=wt("BubbleAnimation"),st=kt(v),lt=kt(m),ut=kt(g),rt((dt=Ye((ht=function(e){Ie(n,e);var t=xe(n);function n(){var _$e;Ce(this,n);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return je(_$e=t.call.apply(t,[this].concat(a)),"animation",dt,Ne(_$e)),je(_$e,"clipName",pt,Ne(_$e)),je(_$e,"repeat",yt,Ne(_$e)),_$e.currentRepeat=-1,_$e}return Ae(n,[{key:"__preload",value:function value(){this.animation=this.getComponent(v),this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function value(){St.lazyValidateProperties(this)}},{key:"play",value:function value(){var _$e=this;this.animation&&(Et.search(this.animation.clips,function(t){return(null==t?void 0:t.name)===_$e.clipName})?(this.currentRepeat=-1,this.animation.play(this.clipName)):console.warn("BubbleAnimation: Animation component must have ".concat(this.clipName," clip")))}},{key:"onBubbleAnimationLoop",value:function value(){this.animation&&-1!==this.repeat&&(this.currentRepeat++,this.currentRepeat>this.repeat&&this.animation.stop())}}]),n}(y)).prototype,"animation",[st],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),pt=Ye(ht.prototype,"clipName",[lt],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return"Bubble"}}),yt=Ye(ht.prototype,"repeat",[ut],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return-1}}),ct=ht));n._RF.pop(),n._RF.push({},"cc0a5OvhdRCMZRZuRscaz+7","AudioPlayer",void 0);var Ct=function(e){Ie(n,e);var t=xe(n);function n(e,i){var a;return Ce(this,n),(a=t.call(this,e)).audioSource=i,a}return Ae(n,[{key:"play",value:function value(e){if(e){var t=e.volume,_$n=void 0===t?1:t,i=e.loop,a=void 0!==i&&i;this.audioSource.volume=_$n,this.audioSource.loop=a}this.audioSource.play()}},{key:"pause",value:function value(){this.audioSource.pause()}},{key:"resume",value:function value(){this.audioSource.state===b.AudioState.PAUSED&&this.audioSource.play()}},{key:"stop",value:function value(){this.audioSource.stop()}},{key:"setVolume",value:function value(e){this.audioSource.volume=e}},{key:"getAudioSource",value:function value(){return this.audioSource}}]),n}(GameCore.Plugins.Audio.BaseAudioPlayer);n._RF.pop(),n._RF.push({},"8b5ecHv/+BJiorK1kiVbTcf","AudioChannel",void 0);var Tt=GameCore,At=Tt.Plugins.Audio.BaseChannelManager,Rt=Tt.Utils.Array,It=function(e){Ie(i,e);var t,n=xe(i);function i(e,t){var a;return Ce(this,i),(a=n.call(this,t)).allowMultipleTracking={},a.handleLoadedAudio=function(e,t){var n=a.node.addComponent(b);return n.clip=t,n.playOnAwake=!1,new Ct(e,n)},a.node=e,a}return Ae(i,[{key:"playing",value:function value(e){var t,n=null===(t=this.getAudioClip(e))||void 0===t?void 0:t.audioPlayer;return!!n&&n.getAudioSource().state===b.AudioState.PLAYING}},{key:"onLoadAudio",value:(t=Ee(function(e,t){var n;return _ts_generator(this,function(_state){n=this;return[2,new Promise(function(t,i){S.load(e,w,function(a,o){try{if(a)throw new Error(a.message);if(!n.node.isValid)return;var r=n.handleLoadedAudio(e,o);t(r)}catch(a){_instanceof(a,Error)?i(a):i(new Error("Audio load: Unknown error"))}})})]})}),function(e,n){return t.apply(this,arguments)})},{key:"playWithRealConfig",value:function value(e,t){if(this.isCanPlay(t)){if(t){var n=t.volume,_$i=void 0===n?1:n,a=t.allowMultiple,o=void 0!==a&&a;if(t.volume=this.getVolume()*_$i,o)return void this.requestDuplicateAudioPlayer(e.getKey(),e.getAudioSource().clip,t).play(t)}e.play(t)}}},{key:"isCanPlay",value:function value(e){var t=this;if(e){var n=e.checkList;if((void 0===n?[]:n).some(function(e){var n=t.getAudioClip(e);return!!n&&n.audioPlayer.getAudioSource().state===b.AudioState.PLAYING}))return!1}return!0}},{key:"requestDuplicateAudioPlayer",value:function value(e,t,n){var _$i=this.getDuplicateAudioFromPool(e);if(_$i){if(n){var a=_$i.key,o=n.volume,r=void 0===o?1:o;this.setAudioClip(a,{volume:r})}return _$i.audioPlayer}var s="".concat(e,"_").concat(this.allowMultipleTracking[e].currentPostFix),l=this.handleLoadedAudio(s,t);return this.allowMultipleTracking[e].list.push({audioPlayer:l,key:s}),this.allowMultipleTracking[e].currentPostFix+=1,this.setAudioClip(s,{audioPlayer:l,volume:1}),l}},{key:"getDuplicateAudioFromPool",value:function value(e){if(this.allowMultipleTracking[e]){var t=this.allowMultipleTracking[e].list,n=Rt.search(t,function(e){return e.audioPlayer.getAudioSource().state!==b.AudioState.PLAYING});if(n)return n}else this.allowMultipleTracking[e]={currentPostFix:1,list:[]};return null}}]),i}(At);n._RF.pop();var Pt,_t,Lt,Ot,Dt;n._RF.push({},"1a025mmN7BL7r5cF6gWR4b/","Music",void 0);var Nt,Mt,xt,Bt,Ft,zt=i.ccclass,Gt=i.property,Ut=globalThis.game,Ht=Ut.audio,Vt=Ut.player,qt=(Pt=zt("Music"),_t=Gt(m),Pt((Dt=Ye((Ot=function(e){Ie(n,e);var t=xe(n);function n(){var _$e;Ce(this,n);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return je(_$e=t.call.apply(t,[this].concat(a)),"channelId",Dt,Ne(_$e)),_$e.channel=null,_$e}return Ae(n,[{key:"__preload",value:function value(){this.makePersistent(),this.channel=new It(this.node,this.channelId),Ht.addChannel(this.channel)}},{key:"makePersistent",value:function value(){p.addPersistRootNode(this.node)}},{key:"playing",value:function value(e){var t,_$n;return null!==(t=null===(_$n=this.channel)||void 0===_$n?void 0:_$n.playing(e))&&void 0!==t&&t}},{key:"play",value:function value(e,t){var _$n;this.isMusicEnable()&&(null!==(_$n=t)&&void 0!==_$n&&_$n.loop||(t=we(we({},t),{},{loop:!0})),Ht.play(e,t,this.channelId))}},{key:"isMusicEnable",value:function value(){return!!Vt.getPlayerSetting("music")}},{key:"setVolume",value:function value(e){Ht.setVolume(e,this.channelId)}},{key:"pause",value:function value(e){Ht.pause(e,this.channelId)}},{key:"resume",value:function value(e){this.isMusicEnable()&&Ht.resume(e,this.channelId)}},{key:"stop",value:function value(e){Ht.stop(e,this.channelId)}},{key:"mute",value:function value(e){e?Ht.mute(this.channelId):Ht.unmute(this.channelId)}}]),n}(y)).prototype,"channelId",[_t],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return"global_music"}}),Lt=Ot))||Lt);n._RF.pop(),n._RF.push({},"1299a7X1XNNEKxSKMV6E5jQ","Sound",void 0);var Wt=i.ccclass,Kt=i.property,jt=globalThis.game,Yt=jt.audio,Xt=jt.player,Jt=(Nt=Wt("Sound"),Mt=Kt(m),Nt((Ft=Ye((Bt=function(e){Ie(n,e);var t=xe(n);function n(){var _$e;Ce(this,n);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return je(_$e=t.call.apply(t,[this].concat(a)),"channelId",Ft,Ne(_$e)),_$e.channel=null,_$e}return Ae(n,[{key:"__preload",value:function value(){this.channel=new It(this.node,this.channelId),Yt.addChannel(this.channel)}},{key:"onLoad",value:function value(){""===this.channelId&&(this.channelId=this.node.uuid)}},{key:"makePersistent",value:function value(){p.addPersistRootNode(this.node)}},{key:"removePersistent",value:function value(){p.removePersistRootNode(this.node)}},{key:"play",value:function value(e,t){this.isSoundEnable()&&Yt.play(e,t,this.channelId)}},{key:"isSoundEnable",value:function value(){return!!Xt.getPlayerSetting("sound")}},{key:"setVolume",value:function value(e){Yt.setVolume(e,this.channelId)}},{key:"pause",value:function value(e){Yt.pause(e,this.channelId)}},{key:"resume",value:function value(e){this.isSoundEnable()&&Yt.resume(e,this.channelId)}},{key:"stop",value:function value(e){Yt.stop(e,this.channelId)}},{key:"stopAll",value:function value(){Yt.stopAll(this.channelId)}},{key:"mute",value:function value(e){e?Yt.mute(this.channelId):Yt.unmute(this.channelId)}}]),n}(y)).prototype,"channelId",[Mt],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return""}}),xt=Bt))||xt);n._RF.pop(),n._RF.push({},"99b8eEF6WlE8pzPfD+whiJu","AnimUtils",void 0);var Qt,Zt,$t,en,tn,nn,an,on,rn,sn,ln,un,cn,hn,dn,pn,yn,fn,vn,mn,gn=function(){function e(){Ce(this,e)}return Ae(e,null,[{key:"inst",get:function get(){return this._instance||(this._instance=new e),this._instance}},{key:"elasticOut",value:function value(e,t,n){if(void 0===t&&(t=.1),void 0===n&&(n=.1),0===e)return 0;if(1===e)return 1;var i=n/4;return t<1?t=1:i=n*Math.asin(1/t)/(2*Math.PI),t*Math.pow(2,-10*e)*Math.sin((e-i)*(2*Math.PI)/n)+1}},{key:"easeOutExpo",value:function value(e){return 1===e?1:1-Math.pow(2,-10*e)}},{key:"easeInExpo",value:function value(e){return 0===e?0:Math.pow(2,10*e-10)}},{key:"runTweenAsync",value:function value(e,t){return new Promise(function(n){var i=e.call(function(){n({tween:e})}).start();t&&(t.aborted?(i.stop(),n({tween:e})):t.addAbortListener(function(){i.stop(),n({tween:e})}))})}},{key:"runOnUpdateAsync",value:function value(e,t,n,i){return new Promise(function(a,o){var r=k(e).to(t,{},{onUpdate:function onUpdate(e,t){if(void 0!==t)try{n(t)}catch(e){o(_instanceof(e,Error)?e:new Error(JSON.stringify(e)))}}}).call(function(){a({tween:r})}).start();i&&(i.aborted?(r.stop(),a({tween:r})):i.addAbortListener(function(){r.stop(),a({tween:r})}))})}},{key:"waitTweenAsync",value:function value(e,t){return new Promise(function(n){var i=k({});i.delay(e),i.call(function(){n()}),i.start(),t&&(t.aborted?(i.stop(),n()):t.addAbortListener(function(){i.stop(),n()}))})}},{key:"runAnimationAsync",value:function value(e,t){return new Promise(function(n){e.play(t),e.once(v.EventType.FINISHED,function(){n()})})}}]),e}();try{new gn}catch(e){console.error("AnimUtils",e)}n._RF.pop(),n._RF.push({},"84a2dB5IaRJ8JB+n9yXfBc7","AutoLayout",void 0);var bn,Sn,wn,kn,En,Cn=i.ccclass,Tn=i.property,An=(Qt=Cn("AutoLayoutWrappee"),Zt=Tn({type:s}),$t=Tn({type:s}),Qt((nn=Ye((tn=Ae(function e(){Ce(this,e),je(this,"wrapeeContainer",nn,this),je(this,"wrapee",an,this)})).prototype,"wrapeeContainer",[Zt],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),an=Ye(tn.prototype,"wrapee",[$t],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),en=tn))||en),Rn=(on=Cn("AutoLayout"),rn=Tn({displayName:"Use Auto Layout"}),sn=Tn({type:[An],displayName:"Children",visible:function visible(){return this.useAutoLayout}}),ln=Tn({visible:!1,serializable:!0}),un=Tn({type:g,displayName:"Selected Index",visible:function visible(){return this.useAutoLayout}}),cn=Tn({type:E,displayName:"Deselected Icon Width",group:"Edge Icons",visible:function visible(){return this.useAutoLayout}}),hn=Tn({visible:!1,serializable:!0}),on((yn=Ye((pn=function(e){Ie(i,e);var t,n=xe(i);function i(){var _$e;Ce(this,i);for(var t=arguments.length,a=new Array(t),o=0;o<t;o++)a[o]=arguments[o];return je(_$e=n.call.apply(n,[this].concat(a)),"useAutoLayout",yn,Ne(_$e)),je(_$e,"children",fn,Ne(_$e)),_$e.mappedChildren=[],je(_$e,"selected",vn,Ne(_$e)),je(_$e,"deselectedIconW",mn,Ne(_$e)),_$e.tweens=[],_$e}return Ae(i,[{key:"selectedIndex",get:function get(){return this.selected},set:function set(e){this.selected=e,this.updateLayout(!0)}},{key:"deselectedIconWidth",get:function get(){return this.deselectedIconW},set:function set(e){this.deselectedIconW=e,this.updateLayout(!0)}},{key:"__preload",value:function value(){this.mappedChildren=this.children.map(function(e){var t=e.wrapeeContainer.getComponent(C);if(!t)throw new Error("AutoLayout: Widget component not found");return we(we({},e),{},{wrapeeContainerWidget:t})})}},{key:"updateLayout",value:function value(){var _$e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];(this._layoutDirty||_$e)&&(this.updateChildrenAnchors(),this.mappedChildren.forEach(function(e){return e.wrapeeContainerWidget.updateAlignment()})),Fe(Pe(i.prototype),"updateLayout",this).call(this,_$e)}},{key:"getSelectedWorldX",value:function value(){var _$e=this.mappedChildren[this.selectedIndex].wrapeeContainer;return 0===this.selectedIndex||this.selectedIndex===this.children.length-1?_$e.getBoundingBoxToWorld().xMin+this.getAnchorX(this.selectedIndex)*_$e.width:_$e.getBoundingBoxToWorld().center.x}},{key:"getAnchorX",value:function value(e){if(e<this.selectedIndex)return 0;if(e>this.selectedIndex)return 1;if(0===e){var t=this.mappedChildren[e].wrapeeContainer.width,n=this.deselectedIconWidth/2,_$i=this.paddingLeft;return((_$i+t+(t-n+this.spacingX))/2-_$i)/t}if(e===this.children.length-1){var a=this.mappedChildren[e].wrapeeContainer.width,o=a-this.deselectedIconWidth/2+this.spacingX;return((o+a+this.paddingRight)/2-o)/a}return .5}},{key:"updateChildrenAnchors",value:(t=Ee(function(){var _$e;return _ts_generator(this,function(_state){switch(_state.label){case 0:_$e=this;this.tweens.forEach(function(e){return e.stop()}),this.tweens=[];return[4,Promise.all([this.children.flatMap(function(t,n){return _$e.getChildrenAnchorsTweens(t,_$e.getAnchorX(n))}).map(function(e){return gn.runTweenAsync(e)})])];case 1:_state.sent();return[2]}})}),function(){return t.apply(this,arguments)})},{key:"updateChildrenAnchorsEditor",value:function value(){var _$e=this;this.children.forEach(function(t,n){var _$i=_$e.getAnchorX(n);t.wrapee.setAnchorPoint(_$i,t.wrapee.anchorY),t.wrapeeContainer.setAnchorPoint(_$i,t.wrapeeContainer.anchorY)})}},{key:"getChildrenAnchorsTweens",value:function value(e,t){return[k(e.wrapee).to(.3,{anchorX:t},{easing:"sineInOut"}).call(function(){e.wrapee.setAnchorPoint(t,e.wrapee.anchorY)}),k(e.wrapeeContainer).to(.3,{anchorX:t},{easing:"sineInOut"}).call(function(){e.wrapeeContainer.setAnchorPoint(t,e.wrapeeContainer.anchorY)})]}}]),i}(T)).prototype,"useAutoLayout",[rn],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return!0}}),fn=Ye(pn.prototype,"children",[sn],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return[]}}),vn=Ye(pn.prototype,"selected",[ln],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return 0}}),Ye(pn.prototype,"selectedIndex",[un],Object.getOwnPropertyDescriptor(pn.prototype,"selectedIndex"),pn.prototype),Ye(pn.prototype,"deselectedIconWidth",[cn],Object.getOwnPropertyDescriptor(pn.prototype,"deselectedIconWidth"),pn.prototype),mn=Ye(pn.prototype,"deselectedIconW",[hn],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return 0}}),dn=pn))||dn);n._RF.pop(),n._RF.push({},"ca427NpeqpC3bUoGTd9I/BM","Background",void 0);var In=i.ccclass,Pn=i.property;bn=In("Background"),Sn=Pn({type:A}),bn((En=Ye((kn=function(e){Ie(n,e);var t=xe(n);function n(){var _$e;Ce(this,n);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return je(_$e=t.call.apply(t,[this].concat(a)),"sprite",En,Ne(_$e)),_$e}return Ae(n,[{key:"__preload",value:function value(){this.validateRequiredComponents(),this.listenGameEvents()}},{key:"validateRequiredComponents",value:function value(){St.lazyValidateProperties(this)}},{key:"listenGameEvents",value:function value(){}}]),n}(y)).prototype,"sprite",[Sn],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wn=kn));n._RF.pop(),n._RF.push({},"bf320amyc1I86bS3oK0M9NR","DashboardEvents",void 0);var _n="STARS_UPDATED",Ln="PLAY_BUTTON_PRESS",On="REQUEST_NAVIGATION",Dn="REQUEST_NAVIGATION_ANIMATION",Nn="DASHBOARD_EVENTS_BUTTON_PRESS";n._RF.pop(),n._RF.push({},"68b8bf0Va5JT7NVPECDNC5l","DashboardScreens",void 0);var Mn=function(e){return e[e.store=0]="store",e[e.collections=1]="collections",e[e.home=2]="home",e[e.leaderboard=3]="leaderboard",e[e.tournaments=4]="tournaments",e}(Mn||{});R(Mn),n._RF.pop(),n._RF.push({},"a0756pde9lOeoJ4TckTOcMV","AnimAbortSignal",void 0);var xn=GameCore.Utils.Array,Bn=function(){function e(){Ce(this,e),this.callbacks=[],this.isAborted=!1,this.abortReason="",this.callbacks=[]}var t;return Ae(e,[{key:"aborted",get:function get(){return this.isAborted}},{key:"reason",get:function get(){return this.abortReason}},{key:"addAbortListener",value:function value(e){this.callbacks.push(e)}},{key:"removeAbortListener",value:function value(e){var t=xn.searchIndex(this.callbacks,function(t){return t===e});-1!==t?this.callbacks.splice(t,1):console.warn("Abort listener not found")}},{key:"abort",value:function value(e){this.isAborted||(this.isAborted=!0,this.abortReason=e,this.callbacks.forEach(function(e){return e()}),this.callbacks=[])}},{key:"untilAborted",value:(t=Ee(function(){var _$e;return _ts_generator(this,function(_state){_$e=this;if(!this.isAborted)return[2,new Promise(function(t){_$e.addAbortListener(function(){return t()})})];return[2]})}),function(){return t.apply(this,arguments)})}],[{key:"hasBeenAborted",value:function value(e){return null==e||e.aborted}}]),e}();n._RF.pop(),n._RF.push({},"a6e4bjV/RVH17qBEx1mZaFg","ResourcePaths",void 0);var Fn=function(e){return e.BOMB_RESCUE_PREFAB="game-objects/bomb/BombRescue",e.BOMB_EXPLODE_PREFAB="game-objects/bomb/BombExplode",e.BOMB_DEFUSE_PREFAB="game-objects/bomb/DefuseExplode",e.COLLECTIONS_CONTENT_PREFAB="game-objects/dashboard-scene/CollectionsContent",e.CLOUD_IDLE_ANIM="animations/CloudIdle",e.TORNADO_IDLE_ANIM="animations/TornadoIdle",e.TILE_BREAK_ANIM="animations/TileBreak",e.TILE_CLEAR_ANIM="animations/TileClear",e.TILE_SHAKE_ANIM="animations/TileShake",e.TILE_SKIN_FOLDER="loadable/tiles",e.TILE_SKIN_PREVIEW_FOLDER="loadable/tiles-preview",e.ITEM_POPUP_FOLDER="loadable/item-popup",e.SUMMER_BG="images/bg/summer",e.AUTUMN_BG="images/bg/autumn",e.WINTER_BG="images/bg/winter",e.SUMMER_BG_PREVIEW="images/preview/summer",e.AUTUMN_BG_PREVIEW="images/preview/autumn",e.WINTER_BG_PREVIEW="images/preview/winter",e.COLLECTIONS_PAGE="pages/CollectionsContent",e.LEADERBOARD_PAGE="pages/LeaderboardContent",e.TOURNAMENTS_PAGE="pages/TournamentsContent",e.LEVEL_DATA_FOLDER="levels-json",e}(Fn||{});n._RF.pop(),n._RF.push({},"2a657+TsltMe4rrDmyWGrLy","ThemeResourcesPath",void 0);var zn={summer:Fn.SUMMER_BG,autumn:Fn.AUTUMN_BG,winter:Fn.WINTER_BG},Gn={summer:Fn.SUMMER_BG_PREVIEW,autumn:Fn.AUTUMN_BG_PREVIEW,winter:Fn.WINTER_BG_PREVIEW};n._RF.pop(),n._RF.push({},"669a1OtNF9EDrMRLWTjxk4B","GeneralUtils",void 0);var Un,Hn,Vn,qn,Wn,Kn,jn,Yn,Xn,Jn,Qn,Zn,$n,ei,ti,ni,ii,ai,oi,ri,si,li=function(){function e(){Ce(this,e)}var t,n,i,a,o,r,s,l,u,c;return Ae(e,null,[{key:"inst",get:function get(){return this._instance||(this._instance=new e),this._instance}},{key:"setBlockInput",value:function value(e){var t=I("Canvas/InputBlocker");t?t.active=e:console.warn("InputBlocker not found")}},{key:"getBlockInput",value:function value(){var _$e=I("Canvas/InputBlocker");return _$e?_$e.active:(console.warn("InputBlocker not found"),!1)}},{key:"loadPrefabAsync",value:function value(e){var t=S.getInfoWithPath(e,P);if(t&&null!==S.get(t.path,P)){var n=S.get(t.path,P);if(null!==n)return Promise.resolve(n)}return new Promise(function(t){S.load(e,P,function(e,n){t(e?null:n)})})}},{key:"loadJsonAsync",value:(c=Ee(function(e){return _ts_generator(this,function(_state){return[2,new Promise(function(t){var n=S.getInfoWithPath(e,_);if(n&&null!==S.get(n.path,_)){var i=S.get(n.path,_);if(null!==i)return void t(i.json)}S.load(e,_,function(e,n){e?t(null):n&&n.json?t(n.json):t(null)})})]})}),function(e){return c.apply(this,arguments)})},{key:"loadAnimClipAsync",value:(u=Ee(function(e){var t,n;return _ts_generator(this,function(_state){t=S.getInfoWithPath(e,L);if(t&&null!==S.get(t.path,L)){n=S.get(t.path,L);if(null!==n)return[2,Promise.resolve(n)]}return[2,new Promise(function(t){S.load(e,L,function(e,n){t(e?null:n)})})]})}),function(e){return u.apply(this,arguments)})},{key:"loadImageSpriteFrameAsync",value:(l=Ee(function(e){var t,n;return _ts_generator(this,function(_state){t=S.getInfoWithPath(e,O);if(t&&null!==S.get(t.path,O)){n=S.get(t.path,O);if(null!==n)return[2,Promise.resolve(D.createWithImage(n))]}return[2,new Promise(function(t){S.load(e,O,function(e,n){t(e?null:D.createWithImage(n))})})]})}),function(e){return l.apply(this,arguments)})},{key:"loadSpriteFrameAsync",value:(s=Ee(function(e){var t,n,i;var _arguments=arguments;return _ts_generator(this,function(_state){t=!(_arguments.length>1&&void 0!==_arguments[1])||_arguments[1],n=S.getInfoWithPath(e,D);if(n&&null!==S.get(n.path,D)){i=S.get(n.path,D);if(null!==i)return[2,(i.packable=t,Promise.resolve(i))]}return[2,new Promise(function(n){S.load(e,D,function(e,i){!e&&i?(i.packable=t,n(i)):n(null)})})]})}),function(e){return s.apply(this,arguments)})},{key:"loadSpriteFramesDirAsync",value:(r=Ee(function(e){var t,n,i,a,o,r;return _ts_generator(this,function(_state){t=S.getDirWithPath(e,D);if(t.length>0){i=[],a=We(t);try{for(a.s();!(n=a.n()).done;){o=n.value,r=S.get(o.path,D);if(!r)return[2,this.loadSpriteFramesFromDirAsync(e)];i.push(r)}}catch(e){a.e(e)}finally{a.f()}return[2,i]}return[2,this.loadSpriteFramesFromDirAsync(e)]})}),function(e){return r.apply(this,arguments)})},{key:"loadSpriteFramesFromDirAsync",value:(o=Ee(function(e){return _ts_generator(this,function(_state){return[2,new Promise(function(t){S.loadDir(e,D,function(e,n){t(e?[]:n)})})]})}),function(e){return o.apply(this,arguments)})},{key:"lazyLoadDashboardSceneResourcesAsync",value:(a=Ee(function(){return _ts_generator(this,function(_state){return[2,e.loadPrefabAsync(Fn.COLLECTIONS_CONTENT_PREFAB)]})}),function(){return a.apply(this,arguments)})},{key:"loadThemeAsync",value:(i=Ee(function(e){return _ts_generator(this,function(_state){return[2,this.loadSpriteFrameAsync("".concat(zn[e],"/spriteFrame"))]})}),function(e){return i.apply(this,arguments)})},{key:"loadThemePreviewAsync",value:(n=Ee(function(e){return _ts_generator(this,function(_state){return[2,this.loadSpriteFrameAsync("".concat(Gn[e],"/spriteFrame"))]})}),function(e){return n.apply(this,arguments)})},{key:"loadSkinPreviewAsync",value:(t=Ee(function(e){var t,n,i;return _ts_generator(this,function(_state){for(t=[],n=1;n<=4;n++){i="".concat(Fn.TILE_SKIN_PREVIEW_FOLDER,"/").concat(e.replace(/-/g,"_"),"_").concat(n,"/spriteFrame");t.push(this.loadSpriteFrameAsync(i))}return[2,Promise.all(t)]})}),function(e){return t.apply(this,arguments)})}]),e}();try{new li}catch(e){console.error("GeneralUtils",e)}n._RF.pop(),n._RF.push({},"ab9cd/wERRKYqhDoYtJ1L3w","MultiBackground",void 0);var ui=i.ccclass,ci=i.property,hi=globalThis.game.monitorError,di=GameCore.Utils.Number,pi=(Un=ui("MultiBackground"),Hn=ci({type:A}),Vn=ci({type:A}),qn=ci({type:s}),Wn=ci({type:s}),Kn=ci({type:s}),jn=ci(g),Yn=ci(C),Xn=ci({type:N(Mn)}),Jn=ci({type:N(Mn)}),Un(($n=Ye((Zn=function(e){Ie(a,e);var t,n,i=xe(a);function a(){var _$e;Ce(this,a);for(var t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];return je(_$e=i.call.apply(i,[this].concat(n)),"background1",$n,Ne(_$e)),je(_$e,"background2",ei,Ne(_$e)),je(_$e,"screenUiTransform",ti,Ne(_$e)),je(_$e,"background1Uitransform",ni,Ne(_$e)),je(_$e,"background2UiTransform",ii,Ne(_$e)),je(_$e,"backgroundNudgeAmount",ai,Ne(_$e)),je(_$e,"nudgeableWidget",oi,Ne(_$e)),je(_$e,"pageOrder",ri,Ne(_$e)),je(_$e,"homePage",si,Ne(_$e)),_$e.currentThemeId="",_$e.tryNudgeBackground=function(t){var n=t.to,i=_$e.getDirection(_$e.homePage,n),_$a=di.sign(i),o=Math.abs(i),r=_$e.backgroundNudgeAmount*o,s=Math.min(_$e.background1Uitransform.width,_$e.background2UiTransform.width),l=Math.max(0,(s-_$e.screenUiTransform.width)/2),u=Math.min(l,r)*_$a;k(_$e.nudgeableWidget).to(.5,{horizontalCenter:u},{easing:M.cubicInOut}).start()},_$e}return Ae(a,[{key:"onLoad",value:function value(){this.currentBackground=this.background1,this.nextBackground=this.background2,St.lazyValidateProperties(this),this.listenToNavigationEvents()}},{key:"onDestroy",value:function value(){var _$e;null===(_$e=this.tweenSignal)||void 0===_$e||_$e.abort(),this.unlistenToNavigationEvents()}},{key:"start",value:function value(){var _$e=this.getComponent(C),t=this.getComponentsInChildren(C);(_$e?[_$e].concat(He(t)):t).forEach(function(e){e.updateAlignment()})}},{key:"listenToNavigationEvents",value:function value(){this.node.scene.on(Dn,this.tryNudgeBackground)}},{key:"unlistenToNavigationEvents",value:function value(){this.node.scene.off(Dn,this.tryNudgeBackground)}},{key:"getDirection",value:function value(e,t){var n=this.pageOrder.indexOf(e),i=this.pageOrder.indexOf(t);return-1===n||-1===i?(null==hi||hi.sendException(new Error("MultiBackground.getDirection: fromIndex or toIndex is -1")),0):n-i}},{key:"setCurrentTheme",value:(n=Ee(function(e){var t;return _ts_generator(this,function(_state){switch(_state.label){case 0:return[4,li.loadThemeAsync(e)];case 1:t=_state.sent();t?(t.packable=!1,this.background1.spriteFrame=t,this.background2.spriteFrame=t,this.currentThemeId=e):null==hi||hi.sendException(new Error("MultiBackground.setCurrentTheme: Failed to load theme ".concat(e,"'s sprite.")));return[2]}})}),function(e){return n.apply(this,arguments)})},{key:"animateToNextTheme",value:(t=Ee(function(e){var t,n,i,_$a;return _ts_generator(this,function(_state){switch(_state.label){case 0:if(this.currentThemeId===e)return[2,Promise.resolve()];return[4,li.loadThemeAsync(e)];case 1:n=_state.sent();if(!n)return[3,3];n.packable=!1,this.currentThemeId=e,this.nextBackground.node.active=!0,this.nextBackground.spriteFrame=n,this.nextBackground.node.setSiblingIndex(1);i=this.nextBackground.getComponent(x);if(!i)throw new Error("".concat(this.nextBackground.node.name," UIOpacity is required"));i.opacity=0,null===(t=this.tweenSignal)||void 0===t||t.abort(),this.tweenSignal=new Bn;return[4,gn.runTweenAsync(k(i).to(1,{opacity:255}),this.tweenSignal)];case 2:if(_state.sent(),!this.tweenSignal.aborted){this.currentBackground.node.active=!1;_$a=this.currentBackground;this.currentBackground=this.nextBackground,this.nextBackground=_$a}return[3,4];case 3:null==hi||hi.sendException(new Error("MultiBackground.animateToNextTheme: Failed to load theme ".concat(e,"'s sprite.")));_state.label=4;case 4:return[2]}})}),function(e){return t.apply(this,arguments)})}]),a}(y)).prototype,"background1",[Hn],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ei=Ye(Zn.prototype,"background2",[Vn],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ti=Ye(Zn.prototype,"screenUiTransform",[qn],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ni=Ye(Zn.prototype,"background1Uitransform",[Wn],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ii=Ye(Zn.prototype,"background2UiTransform",[Kn],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ai=Ye(Zn.prototype,"backgroundNudgeAmount",[jn],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return 50}}),oi=Ye(Zn.prototype,"nudgeableWidget",[Yn],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ri=Ye(Zn.prototype,"pageOrder",[Xn],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return[]}}),si=Ye(Zn.prototype,"homePage",[Jn],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return Mn.home}}),Qn=Zn))||Qn);n._RF.pop(),n._RF.push({},"d159egaUVVLHKLg1UL865ub","SoundKeys",void 0);var yi="sounds/",fi=GameCore.Utils.Object,vi={BUTTON_CLICK:"".concat(yi,"use_item_click"),BOMB_DEFUSE:"".concat(yi,"bomb_defuse"),BOMB_EXPLODE_1:"".concat(yi,"bomb_explode_1"),BOMB_EXPLODE_2:"".concat(yi,"bomb_explode_2"),CLICKS:"".concat(yi,"clicks"),CLOSE_POPUP_CLICK:"".concat(yi,"close_popup_click"),COLLECT_STARS:"".concat(yi,"collect_stars"),COMBO_1:"".concat(yi,"combo_1"),COMBO_2:"".concat(yi,"combo_2"),COMBO_3:"".concat(yi,"combo_3"),COMBO_4:"".concat(yi,"combo_4"),COMBO_5:"".concat(yi,"combo_5"),DAILY_REWARD:"".concat(yi,"daily_reward"),EXTRA_TIME_SPAWN:"".concat(yi,"extra_time_spawn"),GIFT_CHARGE:"".concat(yi,"gift_charge"),GIFT_EXPLODE:"".concat(yi,"gift_explode"),GIFT_REVEAL:"".concat(yi,"gift_reveal"),HINT_ITEM:"".concat(yi,"hint_item"),INVALID_MATCH:"".concat(yi,"invalid_match"),LEVEL_COMPLETE:"".concat(yi,"level_complete"),LEVEL_FAIL:"".concat(yi,"level_fail"),LEVEL_START:"".concat(yi,"level_start"),PROGRESS_STAR:"".concat(yi,"progress_star"),RESCUE_TIMER:"".concat(yi,"rescue_timer"),ROCKET_FLY:"".concat(yi,"rocket_fly"),SHUFFLE_ITEM:"".concat(yi,"shuffle_item"),THREE_STARS:"".concat(yi,"three_stars"),TICKING_BOMB_BEFORE_EXPLODE:"".concat(yi,"ticking_bomb_before_explode"),TILE_SELECT:"".concat(yi,"tile_select"),USE_ITEM_CLICK:"".concat(yi,"use_item_click"),BG_MUSIC:"".concat("musics/","bg_music"),PATCH_SHIFT:"".concat(yi,"patch_shift"),THUNDERBOLT:"".concat(yi,"thunderbolt"),WIND:"".concat(yi,"wind"),COLLECT_COINS:"".concat(yi,"collect_coins"),COLLECT_STOCK_COINS:"".concat(yi,"collect_stock_coins"),LEVEL_FAIL_TIMEOUT:"".concat(yi,"level_fail_timeout"),STAR_CHEST_DRUM_ROLL:"".concat(yi,"star_chest_drum_roll"),STAR_CHEST_OPEN:"".concat(yi,"star_chest_open"),LEADERBOARD_TRIUMPH:"".concat(yi,"leaderboard_triumph"),ITEM_REWARD:"".concat(yi,"item_reward")},mi=fi.vals(vi),gi=mi.reduce(function(e,t,n){return we(we({},e),{},Re({},t,n))},{});R(gi);var bi,Si,wi=mi;n._RF.pop(),n._RF.push({},"0eeb868JeVE67iFwhbkRCmE","ScreenKeys",void 0);var ki=function(e){return e[e.RESCUES_SCREEN=0]="RESCUES_SCREEN",e[e.LOADING_SCREEN=1]="LOADING_SCREEN",e[e.GET_ITEM_SCREEN=2]="GET_ITEM_SCREEN",e[e.GET_COIN_SCREEN=3]="GET_COIN_SCREEN",e[e.SETTINGS_SCREEN=4]="SETTINGS_SCREEN",e[e.START_LEVEL_SCREEN=5]="START_LEVEL_SCREEN",e[e.NOTIFICATION_SCREEN=6]="NOTIFICATION_SCREEN",e[e.LEVEL_COMPLETE_SCREEN=7]="LEVEL_COMPLETE_SCREEN",e[e.CONGRATULATION_SCREEN=8]="CONGRATULATION_SCREEN",e[e.QUIT_LEVEL_SCREEN=9]="QUIT_LEVEL_SCREEN",e[e.TOURNAMENT_DETAIL_SCREEN=10]="TOURNAMENT_DETAIL_SCREEN",e[e.DAILY_REWARDS_SCREEN=11]="DAILY_REWARDS_SCREEN",e[e.STAR_CHEST_SCREEN=12]="STAR_CHEST_SCREEN",e}(ki||{}),Ei=(Re(bi={},ki.RESCUES_SCREEN,"RescuesScreen"),Re(bi,ki.LOADING_SCREEN,"LoadingScreen"),Re(bi,ki.GET_ITEM_SCREEN,"GetItemScreen"),Re(bi,ki.GET_COIN_SCREEN,"GetCoinScreen"),Re(bi,ki.SETTINGS_SCREEN,"SettingsScreen"),Re(bi,ki.START_LEVEL_SCREEN,"StartLevelScreen"),Re(bi,ki.NOTIFICATION_SCREEN,"NotificationScreen"),Re(bi,ki.LEVEL_COMPLETE_SCREEN,"LevelCompleteScreen"),Re(bi,ki.CONGRATULATION_SCREEN,"CongratulationScreen"),Re(bi,ki.QUIT_LEVEL_SCREEN,"QuitLevelScreen"),Re(bi,ki.TOURNAMENT_DETAIL_SCREEN,"TournamentDetailScreen"),Re(bi,ki.DAILY_REWARDS_SCREEN,"DailyRewardsScreen"),Re(bi,ki.STAR_CHEST_SCREEN,"StarChestScreen"),bi),Ci=(Re(Si={},Ei[ki.RESCUES_SCREEN],ki.RESCUES_SCREEN),Re(Si,Ei[ki.LOADING_SCREEN],ki.LOADING_SCREEN),Re(Si,Ei[ki.GET_ITEM_SCREEN],ki.GET_ITEM_SCREEN),Re(Si,Ei[ki.GET_COIN_SCREEN],ki.GET_COIN_SCREEN),Re(Si,Ei[ki.SETTINGS_SCREEN],ki.SETTINGS_SCREEN),Re(Si,Ei[ki.START_LEVEL_SCREEN],ki.START_LEVEL_SCREEN),Re(Si,Ei[ki.NOTIFICATION_SCREEN],ki.NOTIFICATION_SCREEN),Re(Si,Ei[ki.LEVEL_COMPLETE_SCREEN],ki.LEVEL_COMPLETE_SCREEN),Re(Si,Ei[ki.CONGRATULATION_SCREEN],ki.CONGRATULATION_SCREEN),Re(Si,Ei[ki.QUIT_LEVEL_SCREEN],ki.QUIT_LEVEL_SCREEN),Re(Si,Ei[ki.TOURNAMENT_DETAIL_SCREEN],ki.TOURNAMENT_DETAIL_SCREEN),Re(Si,Ei[ki.DAILY_REWARDS_SCREEN],ki.DAILY_REWARDS_SCREEN),Re(Si,Ei[ki.STAR_CHEST_SCREEN],ki.STAR_CHEST_SCREEN),Si),Ti=[ki[ki.NOTIFICATION_SCREEN],ki[ki.LOADING_SCREEN]];n._RF.pop(),n._RF.push({},"09bc071ZcpI978b1NdKUaqD","AnalyticsUtils",void 0);var Ai=globalThis.game.analytics,Ri=GameCore.Utils.Array,Ii=function(){function e(){Ce(this,e)}return Ae(e,null,[{key:"inst",get:function get(){return this._instance||(this._instance=new e),this._instance}},{key:"trackCurrentPage",value:function value(e,t){if(!Ri.has(Ti,e)&&(t||Ri.has(this.trackingPages,e))){this.trackingPages=this.trackingPages.filter(function(t){return t!==e}),t&&this.trackingPages.push(e);var n=this.getCurrentPage();Ai.pageview(n)}}},{key:"switchSceneTracking",value:function value(){this.trackingPages=[];var _$e=this.getCurrentPage();Ai.pageview(_$e)}},{key:"getCurrentPage",value:function value(){var _$e,t;return this.trackingPages.length>0?this.trackingPages[this.trackingPages.length-1]:null!==(_$e=null===(t=p.getScene())||void 0===t?void 0:t.name)&&void 0!==_$e?_$e:"Unknown Scene"}}]),e}();Ii.trackingPages=[];try{new Ii}catch(e){console.error("AnalyticsUtils",e)}n._RF.pop(),n._RF.push({},"31871PLRYRJu7yCCX5F6lWK","AudioUtils",void 0);var Pi=function(){function e(){Ce(this,e)}return Ae(e,[{key:"sound",get:function get(){var _$e,t;return null!==(_$e=null===(t=I("Sound"))||void 0===t?void 0:t.getComponent(Jt))&&void 0!==_$e?_$e:null}},{key:"music",get:function get(){var _$e,t;return null!==(_$e=null===(t=I("Music"))||void 0===t?void 0:t.getComponent(qt))&&void 0!==_$e?_$e:null}}],[{key:"inst",get:function get(){return this._instance||(this._instance=new e),this._instance}},{key:"muteAudio",value:function value(e){this.muteMusic(e),this.muteSound(e)}},{key:"playSound",value:function value(e,t){var n;null===(n=this.inst.sound)||void 0===n||n.play(e,t)}},{key:"pauseSound",value:function value(e){var t;null===(t=this.inst.sound)||void 0===t||t.pause(e)}},{key:"resumeSound",value:function value(e){var t;null===(t=this.inst.sound)||void 0===t||t.resume(e)}},{key:"stopSound",value:function value(e){var t;null===(t=this.inst.sound)||void 0===t||t.stop(e)}},{key:"stopAllSounds",value:function value(){var _$e;null===(_$e=this.inst.sound)||void 0===_$e||_$e.stopAll()}},{key:"muteSound",value:function value(e){var t;null===(t=this.inst.sound)||void 0===t||t.mute(e)}},{key:"playMusic",value:function value(){var _$e,t,n=arguments.length>0&&void 0!==arguments[0]&&arguments[0];!n&&null!==(_$e=this.inst.music)&&void 0!==_$e&&_$e.playing(vi.BG_MUSIC)||null===(t=this.inst.music)||void 0===t||t.play(vi.BG_MUSIC)}},{key:"pauseMusic",value:function value(){var _$e;null===(_$e=this.inst.music)||void 0===_$e||_$e.pause(vi.BG_MUSIC)}},{key:"muteMusic",value:function value(e){var t;null===(t=this.inst.music)||void 0===t||t.mute(e)}},{key:"turnUpMusic",value:function value(){var _$e;null===(_$e=this.inst.music)||void 0===_$e||_$e.setVolume(.8)}},{key:"turnDownMusic",value:function value(){var _$e;null===(_$e=this.inst.music)||void 0===_$e||_$e.setVolume(.4)}},{key:"turnOffMusic",value:function value(){var _$e;null===(_$e=this.inst.music)||void 0===_$e||_$e.setVolume(0)}}]),e}();try{new Pi}catch(e){console.error("AudioUtils",e)}n._RF.pop(),n._RF.push({},"05faedSJ2NHFqLe9b3g4RIl","CocosUtils",void 0);var _i,Li,Oi,Di,Ni,Mi,xi,Bi,Fi,zi,Gi,Ui,Hi,Vi,qi,Wi,Ki,ji,Yi,Xi,Ji,Qi,Zi,$i,ea,ta,na,ia,aa,oa,ra,sa,la,ua=function(){function e(){Ce(this,e)}return Ae(e,[{key:"getWindowSizeVsWorldGameRatio",value:function value(){var _$e=B.getVisibleSize();return F.windowSize.width/window.devicePixelRatio/_$e.width}},{key:"getBoundingBoxTo",value:function value(e,t){var n=z.mat4();z.Mat4.fromSRT(n,t.getRotation(),t.getPosition(),t.getScale());var i=t.getComponent(s);if(!i)throw new Error("Node must have UITransform component");var a=i.anchorPoint,o=i.contentSize,r=o.width,l=o.height,u=new z.Rect(-a.x*r,-a.y*l,r,l),c=z.mat4();if(z.Mat4.multiply(c,e,n),u.transformMat4(c),!t.children||0===t.children.length)return u;var h,d=t.children,p=t.getWorldMatrix(),y=We(d);try{for(y.s();!(h=y.n()).done;){var f=h.value;if(null!=f&&f.active){if(f.getComponent(s)){var v=this.getBoundingBoxTo(p,f);v&&z.Rect.union(u,u,v)}}}}catch(e){y.e(e)}finally{y.f()}return u}}],[{key:"inst",get:function get(){return this._instance||(this._instance=new e),this._instance}},{key:"getBoundingBoxToWorld",value:function value(e){if(e.parent){var t=e.parent.getWorldMatrix();return this.inst.getBoundingBoxTo(t,e)}var n=e.getComponent(s);if(!n)throw new Error("Node must have UITransform component");return n.getBoundingBox()}},{key:"worldSizeToCssSize",value:function value(e){return e*this.inst.getWindowSizeVsWorldGameRatio()}},{key:"cssSizeToWorldSize",value:function value(e){return e/this.inst.getWindowSizeVsWorldGameRatio()}},{key:"getScreenWidthCss",value:function value(){var _$e=document,t=_$e.body,n=_$e.documentElement,i=t.clientWidth,a=n.clientWidth;return Math.max(a,i)||0}},{key:"getScreenHeightCss",value:function value(){var _$e=document,t=_$e.body,n=_$e.documentElement,i=t.clientHeight,a=n.clientHeight;return Math.max(a,i)||0}}]),e}();try{new ua}catch(e){console.error("CocosUtils",e)}n._RF.pop(),n._RF.push({},"ef63ctZn6BPAout9ufUgFVq","ExtendedButton",void 0);var ca,ha,da,pa,ya=i.ccclass,fa=i.property,va=i.disallowMultiple,ma=i.executionOrder,ga=globalThis.game.analytics,ba=GameCore.Plugins.Analytics.Events,Sa=(_i=ya("ExtendedButton"),Li=ma(111),Oi=fa(G),Di=fa(G),Ni=fa(U.AnimationController),Mi=fa({override:!0,visible:!1}),xi=fa({override:!0,visible:!1}),Bi=fa({override:!0,visible:!1}),Fi=fa({override:!0,visible:!1}),zi=fa({override:!0,visible:!1}),Gi=fa({override:!0,visible:!1}),Ui=fa({override:!0,visible:!1}),Hi=fa({override:!0,visible:!1}),Vi=fa({override:!0,visible:!1}),qi=fa({override:!0,visible:!1}),Wi=fa({override:!0,visible:!1}),Ki=fa(H),ji=fa(H),Yi=fa(H),Xi=fa({visible:function visible(){return this.makeSound},type:gi}),Ji=fa({tooltip:"Add a delay after click to prevent spamming (not apply for cancel click)"}),Qi=fa({visible:function visible(){return this.disableSpamClick},tooltip:"Delay time in seconds"}),_i(Zi=va(Zi=Li((ea=Ye(($i=function(e){Ie(n,e);var t=xe(n);function n(){var _$e;Ce(this,n);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return je(_$e=t.call.apply(t,[this].concat(a)),"clickStartEvents",ea,Ne(_$e)),je(_$e,"clickEndEvents",ta,Ne(_$e)),je(_$e,"animationController",na,Ne(_$e)),je(_$e,"useDesktopHover",ia,Ne(_$e)),je(_$e,"emitAnalyticsEvents",aa,Ne(_$e)),je(_$e,"makeSound",oa,Ne(_$e)),je(_$e,"soundKey",ra,Ne(_$e)),je(_$e,"disableSpamClick",sa,Ne(_$e)),je(_$e,"disableSpamDelay",la,Ne(_$e)),_$e.currentClickBoundingBox=null,_$e.hasDown=!1,_$e.hasUp=!1,_$e.hasFinishClickCycle=!1,_$e.onTouchStart=function(t){_$e.interactable&&(_$e.hasDown||(_$e.currentClickBoundingBox=ua.getBoundingBoxToWorld(_$e.node),_$e.handleDown(t)))},_$e.onTouchEnd=function(t){_$e.interactable&&_$e.hasDown&&(_$e.hasUp||_$e.handleUp(t))},_$e.onTouchCancel=function(t){var _$n,i;if(_$e.interactable&&_$e.hasDown&&!_$e.hasUp){var a=t.getUILocation();null!==(_$n=null===(i=_$e.currentClickBoundingBox)||void 0===i?void 0:i.contains(a))&&void 0!==_$n&&_$n?_$e.handleUp(t):(_$e.hasUp=!0,_$e.hasFinishClickCycle=!0,_$e.handleResetButtonState(),_$e.emitClickEndEvents(t))}},_$e.onMouseEnter=function(t){_$e.useDesktopHover&&_$e.interactable&&(_$e.hasDown||(_$e.hasFinishClickCycle=!1,_$e.setAnimationState("HOVER")))},_$e.onMouseLeave=function(t){_$e.useDesktopHover&&_$e.interactable&&(_$e.hasDown||_$e.hasUp||_$e.hasFinishClickCycle||_$e.handleResetButtonState())},_$e.handleResetButtonState=function(){_$e.hasDown=!1,_$e.hasUp=!1,_$e.setAnimationState("RESET")},_$e}return Ae(n,[{key:"transition",get:function get(){return d.Transition.NONE},set:function set(e){Ge(Pe(n.prototype),"transition",d.Transition.NONE,this,!0)}},{key:"normalColor",get:function get(){return Fe(Pe(n.prototype),"normalColor",this)},set:function set(e){Ge(Pe(n.prototype),"normalColor",e,this,!0)}},{key:"pressedColor",get:function get(){return Fe(Pe(n.prototype),"pressedColor",this)},set:function set(e){Ge(Pe(n.prototype),"pressedColor",e,this,!0)}},{key:"hoverColor",get:function get(){return Fe(Pe(n.prototype),"hoverColor",this)},set:function set(e){Ge(Pe(n.prototype),"hoverColor",e,this,!0)}},{key:"disabledColor",get:function get(){return Fe(Pe(n.prototype),"disabledColor",this)},set:function set(e){Ge(Pe(n.prototype),"disabledColor",e,this,!0)}},{key:"normalSprite",get:function get(){return Fe(Pe(n.prototype),"normalSprite",this)},set:function set(e){Ge(Pe(n.prototype),"normalSprite",e,this,!0)}},{key:"pressedSprite",get:function get(){return Fe(Pe(n.prototype),"pressedSprite",this)},set:function set(e){Ge(Pe(n.prototype),"pressedSprite",e,this,!0)}},{key:"hoverSprite",get:function get(){return Fe(Pe(n.prototype),"hoverSprite",this)},set:function set(e){Ge(Pe(n.prototype),"hoverSprite",e,this,!0)}},{key:"disabledSprite",get:function get(){return Fe(Pe(n.prototype),"disabledSprite",this)},set:function set(e){Ge(Pe(n.prototype),"disabledSprite",e,this,!0)}},{key:"duration",get:function get(){return Fe(Pe(n.prototype),"duration",this)},set:function set(e){Ge(Pe(n.prototype),"duration",e,this,!0)}},{key:"zoomScale",get:function get(){return Fe(Pe(n.prototype),"zoomScale",this)},set:function set(e){Ge(Pe(n.prototype),"zoomScale",e,this,!0)}},{key:"__preload",value:function value(){Fe(Pe(n.prototype),"__preload",this).call(this),St.lazyValidateProperties(this)}},{key:"onDestroy",value:function value(){var _$e;null===(_$e=Fe(Pe(n.prototype),"onDestroy",this))||void 0===_$e||_$e.call(this)}},{key:"onEnable",value:function value(){var _$e;null===(_$e=Fe(Pe(n.prototype),"onEnable",this))||void 0===_$e||_$e.call(this),this.node.off(V.EventType.TOUCH_END,this._onTouchEnded,this),this.node.on(a.EventType.TOUCH_START,this.onTouchStart),this.node.on(a.EventType.TOUCH_END,this.onTouchEnd),this.node.on(a.EventType.TOUCH_CANCEL,this.onTouchCancel),this.node.on(a.EventType.MOUSE_ENTER,this.onMouseEnter),this.node.on(a.EventType.MOUSE_LEAVE,this.onMouseLeave)}},{key:"onDisable",value:function value(){var _$e;null===(_$e=Fe(Pe(n.prototype),"onDisable",this))||void 0===_$e||_$e.call(this),this.node.off(a.EventType.TOUCH_START,this.onTouchStart),this.node.off(a.EventType.TOUCH_END,this.onTouchEnd),this.node.off(a.EventType.TOUCH_CANCEL,this.onTouchCancel),this.node.off(a.EventType.MOUSE_ENTER,this.onMouseEnter),this.node.off(a.EventType.MOUSE_LEAVE,this.onMouseLeave),this.unschedule(this.handleResetButtonState),this.handleResetButtonState()}},{key:"handleDown",value:function value(e){this.hasDown=!0,this.setAnimationState("DOWN"),this.makeSound&&Pi.playSound(wi[this.soundKey]),this.emitClickStartEvents(e)}},{key:"emitClickStartEvents",value:function value(e){this.clickStartEvents.forEach(function(t){t.emit([e,t.customEventData])})}},{key:"emitClickEndEvents",value:function value(e){this.clickEndEvents.forEach(function(t){t.emit([e,t.customEventData])})}},{key:"handleUp",value:function value(e){this.hasUp=!0,this.hasFinishClickCycle=!0,this.setAnimationState("RESET"),this.disableSpamClick?this.scheduleOnce(this.handleResetButtonState,this.disableSpamDelay):this.handleResetButtonState(),this.emitButtonEvents(e),this.emitClickEndEvents(e)}},{key:"emitButtonEvents",value:function value(e){this.interactable&&(this.emitAnalyticsEvents&&ga.event(ba.BUTTON_CLICK,{button_name:this.node.name,screen_name:Ii.getCurrentPage()}),this.clickEvents.forEach(function(t){t.emit([e,t.customEventData])}))}},{key:"setAnimationState",value:function value(e){this.animationController.setValue("DOWN","DOWN"===e),this.animationController.setValue("HOVER","HOVER"===e),this.animationController.setValue("RESET","RESET"===e)}},{key:"fakeClick",value:function value(){var _$e=this;this.setAnimationState("DOWN"),this.scheduleOnce(function(){_$e.setAnimationState("RESET")},0)}},{key:"resetButtonState",value:function value(){this.handleResetButtonState()}}]),n}(d)).prototype,"clickStartEvents",[Oi],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return[]}}),ta=Ye($i.prototype,"clickEndEvents",[Di],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return[]}}),na=Ye($i.prototype,"animationController",[Ni],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ye($i.prototype,"transition",[Mi],Object.getOwnPropertyDescriptor($i.prototype,"transition"),$i.prototype),Ye($i.prototype,"normalColor",[xi],Object.getOwnPropertyDescriptor($i.prototype,"normalColor"),$i.prototype),Ye($i.prototype,"pressedColor",[Bi],Object.getOwnPropertyDescriptor($i.prototype,"pressedColor"),$i.prototype),Ye($i.prototype,"hoverColor",[Fi],Object.getOwnPropertyDescriptor($i.prototype,"hoverColor"),$i.prototype),Ye($i.prototype,"disabledColor",[zi],Object.getOwnPropertyDescriptor($i.prototype,"disabledColor"),$i.prototype),Ye($i.prototype,"normalSprite",[Gi],Object.getOwnPropertyDescriptor($i.prototype,"normalSprite"),$i.prototype),Ye($i.prototype,"pressedSprite",[Ui],Object.getOwnPropertyDescriptor($i.prototype,"pressedSprite"),$i.prototype),Ye($i.prototype,"hoverSprite",[Hi],Object.getOwnPropertyDescriptor($i.prototype,"hoverSprite"),$i.prototype),Ye($i.prototype,"disabledSprite",[Vi],Object.getOwnPropertyDescriptor($i.prototype,"disabledSprite"),$i.prototype),Ye($i.prototype,"duration",[qi],Object.getOwnPropertyDescriptor($i.prototype,"duration"),$i.prototype),Ye($i.prototype,"zoomScale",[Wi],Object.getOwnPropertyDescriptor($i.prototype,"zoomScale"),$i.prototype),ia=Ye($i.prototype,"useDesktopHover",[Ki],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return!0}}),aa=Ye($i.prototype,"emitAnalyticsEvents",[ji],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return!0}}),oa=Ye($i.prototype,"makeSound",[Yi],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return!0}}),ra=Ye($i.prototype,"soundKey",[Xi],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return gi[vi.BUTTON_CLICK]}}),sa=Ye($i.prototype,"disableSpamClick",[Ji],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return!0}}),la=Ye($i.prototype,"disableSpamDelay",[Qi],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return .5}}),Zi=$i))||Zi)||Zi)||Zi);n._RF.pop(),n._RF.push({},"0e570DdAIZPKY6DNtNerFmX","OpacityToggler",void 0);var wa=i.ccclass,ka=i.requireComponent,Ea=i.property,Ca=wa("OpacityToggler")(ca=ka([x])((da=Ye((ha=function(e){Ie(i,e);var t,n=xe(i);function i(){var _$e;Ce(this,i);for(var t=arguments.length,a=new Array(t),o=0;o<t;o++)a[o]=arguments[o];return je(_$e=n.call.apply(n,[this].concat(a)),"activeValue",da,Ne(_$e)),je(_$e,"inActiveValue",pa,Ne(_$e)),_$e.signal=new Bn,_$e}return Ae(i,[{key:"__preload",value:function value(){this.opacityComponent=this.getComponent(x),this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function value(){St.lazyValidateProperties(this)}},{key:"changeState",value:function value(){var _$e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.signal.abort(),this.opacityComponent.opacity=_$e?this.activeValue:this.inActiveValue}},{key:"changeStateFade",value:(t=Ee(function(){var _$e,t,n;var _arguments=arguments;return _ts_generator(this,function(_state){switch(_state.label){case 0:_$e=_arguments.length>0&&void 0!==_arguments[0]&&_arguments[0],t=_arguments.length>1&&void 0!==_arguments[1]?_arguments[1]:.2;this.signal.abort(),this.signal=new Bn;n=_$e?this.activeValue:this.inActiveValue;return[4,gn.runTweenAsync(k(this.opacityComponent).to(t,{opacity:n}),this.signal)];case 1:_state.sent();return[2]}})}),function(){return t.apply(this,arguments)})}]),i}(y)).prototype,"activeValue",[Ea],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return 255}}),pa=Ye(ha.prototype,"inActiveValue",[Ea],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return 128}}),ca=ha))||ca)||ca;n._RF.pop(),n._RF.push({},"244e9OHsmpDnpHQKeLzgiiX","GameEvents",void 0);var Ta="view-resize",Aa="view-resized",Ra="request-view-resize",Ia="layout-changed",Pa="gameplay-update-config",_a="opened-skip-overlay",La="closed-skip-overlay",Oa="result-scene-replay",Da="result-scene-home",Na="upgrade-quality",Ma="upgrade-dynamic-atlas";n._RF.pop(),n._RF.push({},"5c76fxO2ppOqYp4WNO+Kavm","GameWorld",void 0);var xa,Ba,Fa,za={Portrait:"portrait",Landscape:"landscape"},Ga={Portrait:{WIDTH:750,HEIGHT:1583},Landscape:{WIDTH:1920,HEIGHT:1583}};n._RF.pop(),n._RF.push({},"7ef37Q3PZpKYaeik5JzGwNy","DebugResolution",void 0);var Ua,Ha,Va,qa,Wa,Ka,ja,Ya,Xa,Ja,Qa,Za,$a,eo,to,no,io,ao,oo,ro,so=i.ccclass,lo=i.property,uo=i.requireComponent,co=i.disallowMultiple,ho=i.executeInEditMode,po=Ga,yo=po.Portrait,fo=po.Landscape;so("DebugResolution")(xa=co(xa=uo([q])(xa=ho(!0)(((Fa=function(e){Ie(n,e);var t=xe(n);function n(){var _$e;Ce(this,n);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return(_$e=t.call.apply(t,[this].concat(a))).handleLayoutChange=function(){var t;null===(t=_$e.graphics)||void 0===t||t.clear(),_$e.start()},_$e}return Ae(n,[{key:"drawPortrait",get:function get(){return n._drawPortrait},set:function set(e){e!==n._drawPortrait&&(e?this.drawPortraitResolution():this.graphics.clear(),n._drawPortrait=e,n._drawLandscape&&this.drawLandscapeResolution())}},{key:"drawLandscape",get:function get(){return n._drawLandscape},set:function set(e){e!==n._drawLandscape&&(e?this.drawLandscapeResolution():this.graphics.clear(),n._drawLandscape=e,n._drawPortrait&&this.drawPortraitResolution())}},{key:"__preload",value:function value(){this.graphics=this.getComponent(q),this.validateRequiredComponents(),this.listenGameEvents()}},{key:"validateRequiredComponents",value:function value(){St.lazyValidateProperties(this)}},{key:"listenGameEvents",value:function value(){W.on(Ia,this.handleLayoutChange)}},{key:"start",value:function value(){this.drawPortrait&&this.drawPortraitResolution(),this.drawLandscape&&this.drawLandscapeResolution()}},{key:"drawPortraitResolution",value:function value(){var _$e=this.graphics,t=yo.WIDTH,_$n=yo.HEIGHT,i=-t/2,a=-_$n/2;_$e.strokeColor=o.GREEN,_$e.rect(i,a,t,_$n),_$e.stroke()}},{key:"drawLandscapeResolution",value:function value(){var _$e=this.graphics,t=fo.WIDTH,_$n=fo.HEIGHT,i=-t/2,a=-_$n/2;_$e.strokeColor=o.CYAN,_$e.rect(i,a,t,_$n),_$e.stroke()}}]),n}(y))._drawPortrait=!0,Fa._drawLandscape=!0,Ye((Ba=Fa).prototype,"drawPortrait",[lo],Object.getOwnPropertyDescriptor(Ba.prototype,"drawPortrait"),Ba.prototype),Ye(Ba.prototype,"drawLandscape",[lo],Object.getOwnPropertyDescriptor(Ba.prototype,"drawLandscape"),Ba.prototype),xa=Ba))||xa)||xa)||xa);n._RF.pop(),n._RF.push({},"0e2d6yn/BVObK1kyTJ5a09a","GameStats",void 0);var vo=i.ccclass,mo=i.executionOrder,go=i.property,bo=GameCore.Utils.Valid,So=o.RED,wo=o.BLACK,ko=o.MAGENTA;Ua=vo("GameStats"),Ha=mo(-1e3),Va=go(u),qa=go(u),Wa=go(u),Ka=go(u),ja=go(u),Ya=go(u),Xa=go(u),Ja=go(u),Ua(Qa=Ha(($a=Ye((Za=function(e){Ie(n,e);var t=xe(n);function n(){var _$e;Ce(this,n);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return je(_$e=t.call.apply(t,[this].concat(a)),"fpsLabel",$a,Ne(_$e)),je(_$e,"drawCountLabel",eo,Ne(_$e)),je(_$e,"logicTimeLabel",to,Ne(_$e)),je(_$e,"physicTimeLabel",no,Ne(_$e)),je(_$e,"renderTimeLabel",io,Ne(_$e)),je(_$e,"objectMemoryUsageLabel",ao,Ne(_$e)),je(_$e,"textureMemoryUsageLabel",oo,Ne(_$e)),je(_$e,"devicePixelRatioLabel",ro,Ne(_$e)),_$e.refreshInterval=.5,_$e.handleMouseDown=function(){_$e.bg.enabled=!_$e.bg.enabled},_$e.waitForStats=function(){K.stats&&(_$e.unschedule(_$e.waitForStats),_$e.node.active=!0,_$e.stats=K.stats,_$e.startUpdateStats())},_$e.updateStats=function(){_$e.updateFps(),_$e.updateDrawCalls(),_$e.updateLogicTime(),_$e.updatePhysicTime(),_$e.updateRenderTime(),_$e.updateObjectMemoryUsage(),_$e.updateTextureMemoryUsage(),_$e.updateDevicePixelRatio()},_$e}return Ae(n,[{key:"__preload",value:function value(){this.bg=this.getComponent(A),this.validateRequiredComponents(),this.listenInputEvents()}},{key:"validateRequiredComponents",value:function value(){St.lazyValidateProperties(this)}},{key:"listenInputEvents",value:function value(){this.node.on(V.EventType.TOUCH_START,this.handleMouseDown)}},{key:"start",value:function value(){this.bg.enabled=!1,this.node.active=!1,K&&bo.isDebugger()&&(K.showStats(),this.schedule(this.waitForStats,.5,20))}},{key:"startUpdateStats",value:function value(){this.schedule(this.updateStats,this.refreshInterval)}},{key:"updateFps",value:function value(){var _$e=this.getFps();this.updateFpsColor(_$e),this.fpsLabel.string="FPS: ".concat(_$e)}},{key:"updateFpsColor",value:function value(e){this.fpsLabel.color=e<30?So:e<48?ko:wo}},{key:"updateDrawCalls",value:function value(){var _$e=this.getDrawCalls();this.updateDrawCallsColor(_$e),this.drawCountLabel.string="Draw Calls: ".concat(_$e)}},{key:"updateDrawCallsColor",value:function value(e){var t=j.os===j.OS.IOS,_$n=t?80:25,i=t?60:15;this.drawCountLabel.color=e>_$n?So:e>i?ko:wo}},{key:"updateLogicTime",value:function value(){var _$e=this.getLogicTime();this.updateLogicTimeColor(_$e),this.logicTimeLabel.string="Logic Time: ".concat(_$e.toFixed(2),"ms")}},{key:"updateLogicTimeColor",value:function value(e){this.logicTimeLabel.color=e>10?So:e>5?ko:wo}},{key:"updatePhysicTime",value:function value(){var _$e=this.getPhysicTime();this.updatePhysicTimeColor(_$e),this.physicTimeLabel.string="Physic Time: ".concat(_$e.toFixed(2),"ms")}},{key:"updatePhysicTimeColor",value:function value(e){this.physicTimeLabel.color=e>10?So:e>5?ko:wo}},{key:"updateRenderTime",value:function value(){var _$e=this.getRenderTime();this.updateRenderTimeColor(_$e),this.renderTimeLabel.string="Render Time: ".concat(_$e.toFixed(2),"ms")}},{key:"updateRenderTimeColor",value:function value(e){this.renderTimeLabel.color=e>10?So:e>5?ko:wo}},{key:"updateObjectMemoryUsage",value:function value(){var _$e=this.getObjectMemoryUsage();this.updateObjectMemoryUsageColor(_$e),this.objectMemoryUsageLabel.string="Object Mem: ".concat(_$e.toFixed(2),"MB")}},{key:"updateObjectMemoryUsageColor",value:function value(e){this.objectMemoryUsageLabel.color=e>40?So:e>25?ko:wo}},{key:"updateTextureMemoryUsage",value:function value(){var _$e=this.getTextureMemoryUsage();this.updateTextureMemoryUsageColor(_$e),this.textureMemoryUsageLabel.string="Texture Mem: ".concat(_$e.toFixed(2),"MB")}},{key:"updateTextureMemoryUsageColor",value:function value(e){this.textureMemoryUsageLabel.color=e>50?So:e>35?ko:wo}},{key:"updateDevicePixelRatio",value:function value(){var _$e=this.getDevicePixelRatio();this.updateDevicePixelRatioColor(_$e),this.devicePixelRatioLabel.string="Device Pixel Ratio: ".concat(_$e)}},{key:"updateDevicePixelRatioColor",value:function value(e){this.devicePixelRatioLabel.color=e>2?So:e<=1?ko:wo}},{key:"getFps",value:function value(){var _$e=this.stats.fps.counter;return Math.floor(_$e.value)||0}},{key:"getDrawCalls",value:function value(){return this.stats.draws.counter.value||0}},{key:"getLogicTime",value:function value(){var _$e=this.stats.logic.counter;return Math.floor(1e3*_$e.value)/1e3||0}},{key:"getPhysicTime",value:function value(){var _$e=this.stats.physics.counter;return Math.floor(1e3*_$e.value)/1e3||0}},{key:"getRenderTime",value:function value(){var _$e=this.stats.render.counter;return Math.floor(1e3*_$e.value)/1e3||0}},{key:"getObjectMemoryUsage",value:function value(){var _$e=this.stats.bufferMemory.counter;return Math.floor(1e3*_$e.value)/1e3||0}},{key:"getTextureMemoryUsage",value:function value(){var _$e=this.stats.textureMemory.counter;return Math.floor(1e3*_$e.value)/1e3||0}},{key:"getDevicePixelRatio",value:function value(){return window.devicePixelRatio||0}}]),n}(y)).prototype,"fpsLabel",[Va],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),eo=Ye(Za.prototype,"drawCountLabel",[qa],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),to=Ye(Za.prototype,"logicTimeLabel",[Wa],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),no=Ye(Za.prototype,"physicTimeLabel",[Ka],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),io=Ye(Za.prototype,"renderTimeLabel",[ja],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ao=Ye(Za.prototype,"objectMemoryUsageLabel",[Ya],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),oo=Ye(Za.prototype,"textureMemoryUsageLabel",[Xa],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ro=Ye(Za.prototype,"devicePixelRatioLabel",[Ja],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Qa=Za))||Qa);n._RF.pop(),n._RF.push({},"ca922n1V0RLioEyUJg8hQXH","GameEvents",void 0);var Eo,Co=function(e){return e.INVITE_FRIENDS="invite-friends",e.REPLAY_FRIENDS="replay-friends",e.SHOW_CHALLENGE_RESULTS="show-challenge-results",e.NEXT_LEVEL="next-level",e.MAX_LEVEL="max-level",e.START_OVER="start-over",e.SELECT_LEVEL="select-level",e.GAME_START="game-start",e.GAME_PAUSE="game-pause",e.GAME_RESUME="game-resume",e.GAME_REPLAY="game-replay",e.GAME_FINISH="game-finish",e.GAME_EXIT="game-exit",e.USE_ITEM="use-item",e.SKIP_LEVEL="skip-level",e.ADD_ITEM="add-item",e.ADD_ITEMS="add-items",e.ADD_COINS="add-coins",e.REMOVE_COINS="remove-coins",e.REMOVE_COINS_SUCCESS="remove-coins-success",e.REMOVE_COINS_FAILED="remove-coins-failed",e.COIN_CHANGED="coin-changed",e.ADD_STARS="add-stars",e.PAUSE_TIME="pause-time",e.RESUME_TIME="resume-time",e.TIME_OUT="time-out",e.HALF_TIME="half-time",e.RESCUE_START="rescue-time",e.RESCUE_FINISHED="clock-animation-finished",e.APPLY_GRAVITY="apply-gravity",e.IDLE_ENTER="idle-enter",e.IDLE_EXIT="idle-exit",e.GRID_MATCH="grid-match",e.GRID_MATCH_SUCCESS="grid-match-success",e.GRID_MATCH_FAIL="grid-match-fail",e.GRID_CLEAR="grid-clear",e.GRID_CREATE="grid-create",e.GRID_RESIZE="grid-resize",e.TILE_CLICK="tile-click",e.BOMB_EXPLODE="bomb-explode",e.SHOW_HINT="show-hint",e.ADD_COMBO="add-combo",e.COMBO_UPDATED="combo-updated",e.COMBO_ENDED="combo-ended",e.ADD_SCORE="add-score",e.SCORE_UPDATED="score-updated",e.REGISTER_ANIMATOR="register-animator",e.UNREGISTER_ANIMATOR="unregister-animator",e.SHOW_UI="show-ui",e.HIDE_UI="hide-ui",e.AUTO_PLAY="auto-play",e.GUIDE_MASK_CLICKED="guide-mask-clicked",e}(Co||{});n._RF.pop(),n._RF.push({},"8249dDH5xBEc4nnCGRgSjaW","PanelAnimationController",void 0);var To,Ao,Ro,Io,Po,_o,Lo,Oo,Do,No,Mo,xo,Bo,Fo,zo,Go,Uo,Ho,Vo=(0,i.ccclass)("PanelAnimationController")(Eo=function(e){Ie(n,e);var t=xe(n);function n(){var _$e;Ce(this,n);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return(_$e=t.call.apply(t,[this].concat(a))).animators=new Set,_$e.handleRegistration=function(t){if(!t)throw new Error("Invalid event payload.");_$e.animators.has(t)&&console.warn("Animator already registered."),_$e.animators.add(t)},_$e.handleUnregistration=function(t){if(!t)throw new Error("Invalid event payload.");_$e.animators.has(t)||console.warn("Animator not registered."),_$e.animators.delete(t)},_$e.handleShowUIs=function(t){var _$n=!1,i=[];_$e.animators.forEach(function(e){i.push(e)});for(var a=[],o=0,r=i;o<r.length;o++){var s,l=r[o];if(!l.isReadyForAnimation()&&!_$n)_$n=!0,null==t||null===(s=t.fallback)||void 0===s||s.call(t);a.push(l.handleShowUI())}void 0!==(null==t?void 0:t.onComplete)&&a.length>0&&Promise.all(a).then(t.onComplete)},_$e.handleHideUIs=function(t){var _$n=!1,i=[];_$e.animators.forEach(function(e){i.push(e)});for(var a=[],o=0,r=i;o<r.length;o++){var s,l=r[o];if(!l.isReadyForAnimation()&&!_$n)_$n=!0,null==t||null===(s=t.fallback)||void 0===s||s.call(t);a.push(l.handleHideUI())}void 0!==(null==t?void 0:t.onComplete)&&a.length>0&&Promise.all(a).then(t.onComplete)},_$e}return Ae(n,[{key:"init",value:function value(){this.node.scene.off(Co.REGISTER_ANIMATOR),this.node.scene.off(Co.UNREGISTER_ANIMATOR),this.node.scene.off(Co.SHOW_UI),this.node.scene.off(Co.HIDE_UI),this.node.scene.on(Co.REGISTER_ANIMATOR,this.handleRegistration),this.node.scene.on(Co.UNREGISTER_ANIMATOR,this.handleUnregistration),this.node.scene.on(Co.SHOW_UI,this.handleShowUIs),this.node.scene.on(Co.HIDE_UI,this.handleHideUIs)}}]),n}(y))||Eo;n._RF.pop(),n._RF.push({},"f190aWZvVlGiplYX4XrZG3a","PanelAnimator",void 0);var qo,Wo,Ko,jo,Yo=i.ccclass,Xo=i.property,Jo=GameCore.Utils.Object,Qo=(To=Yo("AnimationConfig"),Ao=Xo({type:[C]}),To((Po=Ye((Io=function(){function e(){Ce(this,e),je(this,"startHidden",Po,this),je(this,"nodes",_o,this),je(this,"posOffset",Lo,this),je(this,"showEase",Oo,this),je(this,"hideEase",Do,this),je(this,"showDuration",No,this),je(this,"hideDuration",Mo,this)}return Ae(e,[{key:"setConfig",value:function value(e){e&&Jo.assign(this,e)}}]),e}()).prototype,"startHidden",[Xo],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return!0}}),_o=Ye(Io.prototype,"nodes",[Ao],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return[]}}),Lo=Ye(Io.prototype,"posOffset",[Xo],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return 0}}),Oo=Ye(Io.prototype,"showEase",[Xo],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return"backOut"}}),Do=Ye(Io.prototype,"hideEase",[Xo],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return"backIn"}}),No=Ye(Io.prototype,"showDuration",[Xo],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return 0}}),Mo=Ye(Io.prototype,"hideDuration",[Xo],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return 0}}),Ro=Io))||Ro),Zo=(xo=Yo("PanelAnimator"),Bo=Xo({type:Qo,displayName:"Top animation nodes"}),Fo=Xo({type:Qo,displayName:"Bottom animation nodes"}),xo((Uo=Ye((Go=function(e){Ie(a,e);var t,n,i=xe(a);function a(){var _$e;Ce(this,a);for(var t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];return je(_$e=i.call.apply(i,[this].concat(n)),"topConfig",Uo,Ne(_$e)),je(_$e,"botConfig",Ho,Ne(_$e)),_$e.isReady=!1,_$e}return Ae(a,[{key:"onEnable",value:function value(){this.node.scene.emit(Co.REGISTER_ANIMATOR,this)}},{key:"onDisable",value:function value(){this.node.scene.emit(Co.UNREGISTER_ANIMATOR,this)}},{key:"onLoad",value:function value(){this.topAnimator=this.createAnimator(this.topConfig,"top"),this.botAnimator=this.createAnimator(this.botConfig,"bottom"),this.initUIPos(),this.isReady=!0}},{key:"initUIPos",value:function value(){this.topAnimator.switchState(this.topConfig.startHidden?"hidden":"shown",!0),this.botAnimator.switchState(this.botConfig.startHidden?"hidden":"shown",!0)}},{key:"isReadyForAnimation",value:function value(){return this.isReady}},{key:"handleShowUI",value:(n=Ee(function(){return _ts_generator(this,function(_state){if(this.isReady)return[2,Promise.all([this.topAnimator.switchState("shown"),this.botAnimator.switchState("shown")])];console.warn("".concat(this.node.name,"'s ").concat(this.name,": not ready"));return[2]})}),function(){return n.apply(this,arguments)})},{key:"handleHideUI",value:(t=Ee(function(){return _ts_generator(this,function(_state){if(this.isReady)return[2,Promise.all([this.topAnimator.switchState("hidden"),this.botAnimator.switchState("hidden")])];console.warn("".concat(this.node.name,"'s ").concat(this.name,": not ready"));return[2]})}),function(){return t.apply(this,arguments)})},{key:"createAnimator",value:function value(e,t){var n=e.nodes,i=e.posOffset,o=e.showEase,r=e.hideEase,s=e.showDuration,l=e.hideDuration,u=n.map(function(e){return"top"===t&&e.isAlignTop?{mode:"top",value:e.top}:"bottom"===t&&e.isAlignBottom?{mode:"bottom",value:e.bottom}:{mode:"position",value:e.node.position.y}}),c=n.map(function(e){return"top"===t&&e.isAlignTop?{mode:"top",value:e.top+i}:"bottom"===t&&e.isAlignBottom?{mode:"bottom",value:e.bottom-i}:{mode:"position",value:e.node.position.y+i}}),h="shown";return{switchState:function switchState(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(h===e)return Promise.resolve(null);h=e;var i="hidden"===e?u:c,d="hidden"===e?c:u,p="hidden"===e?l:s,y="hidden"===e?r:o;return t?(n.forEach(function(e,t){var n=i[t],_$a=d[t].value;"top"===n.mode&&(e.top=_$a),"bottom"===n.mode&&(e.bottom=_$a),"position"===n.mode&&(e.node.position=new Y(e.node.position.x,_$a,e.node.position.z))}),Promise.resolve(null)):Promise.all(n.map(function(e,t){var n=i[t],o=d[t].value;return gn.runTweenAsync(a.getTween({widget:e,config:n,target:o,easing:y,duration:p}))}))}}}},{key:"setAnimator",value:function value(e){var t=e.topConfig,n=e.botConfig,i=new Qo,_$a=new Qo;i.setConfig(t),_$a.setConfig(n),this.topConfig=i,this.botConfig=_$a,this.topAnimator=this.createAnimator(this.topConfig,"top"),this.botAnimator=this.createAnimator(this.botConfig,"bottom"),this.initUIPos()}}],[{key:"getTween",value:function value(e){var t=e.widget,n=e.config,i=e.target,_$a=e.easing,o=e.duration;return"top"===n.mode?k(t).call(function(){t.top=n.value}).to(o,{top:i},{easing:_$a}):"bottom"===n.mode?k(t).call(function(){t.bottom=n.value}).to(o,{bottom:i},{easing:_$a}):k(t.node.position).call(function(){t.node.position=new Y(t.node.position.x,n.value,t.node.position.z)}).to(o,{y:i},{easing:_$a})}}]),a}(y)).prototype,"topConfig",[Bo],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return new Qo}}),Ho=Ye(Go.prototype,"botConfig",[Fo],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return new Qo}}),zo=Go))||zo);n._RF.pop(),n._RF.push({},"6ea01hdw/9MHb28SCDAiRss","ResizeWithBannerAd",void 0);var $o,er,tr,nr,ir,ar,or,rr,sr,lr,ur,cr=i.ccclass,hr=i.requireComponent,dr=i.property,pr=globalThis.game,yr=pr.ads,fr=pr.event,vr=GameCore,mr=vr.Events,gr=vr.Configs.Ads,br=vr.Plugins.Ads,Sr=br.Types,wr=br.Status;cr("ResizeWithBannerAd")(qo=hr(C)((Ko=Ye((Wo=function(e){Ie(n,e);var t=xe(n);function n(){var _$e;Ce(this,n);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return je(_$e=t.call.apply(t,[this].concat(a)),"willShowBanner",Ko,Ne(_$e)),je(_$e,"includeSAB",jo,Ne(_$e)),_$e.handleAdShow=function(t){var _$n,i=t.placementId;null!==i&&(null===(_$n=yr.getAdByPlacementId(i))||void 0===_$n?void 0:_$n.type)===Sr.BANNER&&_$e.resizeToFitBannerAd()},_$e.handleAdClose=function(t){var _$n,i=t.placementId;null!==i&&(null===(_$n=yr.getAdByPlacementId(i))||void 0===_$n?void 0:_$n.type)===Sr.BANNER&&_$e.updateWidgets({bottom:yr.getSafeAreaBottom(ua.cssSizeToWorldSize(1))})},_$e}return Ae(n,[{key:"__preload",value:function value(){this.widget=this.getComponent(C),St.lazyValidateProperties(this),fr.on(mr.AD_SHOWING,this.handleAdShow),fr.on(mr.AD_CLOSED,this.handleAdClose)}},{key:"onDestroy",value:function value(){fr.off(mr.AD_SHOWING,this.handleAdShow),fr.off(mr.AD_CLOSED,this.handleAdClose)}},{key:"start",value:function value(){var _$e=yr.getSafeAreaBottom(ua.cssSizeToWorldSize(1));this.willShowBanner||n.isBannerAdShowing()?this.resizeToFitBannerAd():_$e>0&&this.includeSAB&&this.updateWidgets({bottom:_$e})}},{key:"resizeToFitBannerAd",value:function value(){var _$e=this,t=gr.Enabled,_$n=gr.BannerDisplayAdOptions;if(t)if(this.widget.isAlignBottom){var i=void 0,a=void 0,o=void 0,r=void 0,s=ua.cssSizeToWorldSize(1);_$n.forEach(function(t){var _$n=t.PlacementId,l=t.Position,u=t.BannerWidth;if(yr.canbeShowBannerAd(_$n))switch(l){case"top":i=yr.getBannerHeight(_$n,s);break;case"bottom":a=yr.getBannerHeight(_$n,s,_$e.includeSAB);break;case"left":if(void 0===u)break;var c=u;"getBannerOffset"in GameSDK.extra&&(c+=GameSDK.extra.getBannerOffset()),o=c*s;break;case"right":if(void 0===u)break;var h=u;"getBannerOffset"in GameSDK.extra&&(h+=GameSDK.extra.getBannerOffset()),r=h*s}}),this.updateWidgets({top:i,bottom:a,left:o,right:r})}else console.warn("Widget does not align to bottom, ResizeWithBannerAds will have no effect!")}},{key:"updateWidgets",value:function value(e){var t=e.top,_$n=e.bottom,i=e.left,a=e.right;this.widget.top=null!=t?t:this.widget.top,this.widget.bottom=null!=_$n?_$n:this.widget.bottom,this.widget.left=null!=i?i:this.widget.left,this.widget.right=null!=a?a:this.widget.right,this.widget.updateAlignment(),this.getComponentsInChildren(C).forEach(function(e){e.updateAlignment()})}}],[{key:"isBannerAdShowing",value:function value(){return yr.enabled&&yr.getAdStatus(Sr.BANNER)===wr.SHOWING}}]),n}(y)).prototype,"willShowBanner",[dr],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return!1}}),jo=Ye(Wo.prototype,"includeSAB",[dr],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return!0}}),qo=Wo))||qo);n._RF.pop(),n._RF.push({},"3d28fQaHU5Lm4/Zyq/Jd2b6","TapperedProgressBar",void 0);var kr,Er,Cr,Tr,Ar,Rr,Ir,Pr,_r,Lr,Or=i.ccclass,Dr=i.property,Nr=i.executeInEditMode,Mr=i.requireComponent,xr=($o=Or("TapperedProgressBar"),er=Mr(x),tr=Dr({type:x,displayName:"Fill opacity"}),nr=Dr({type:A,displayName:"Left Cap",tooltip:"If assigned, will be displayed when progress is larger than 0%"}),ir=Dr({type:A,displayName:"Right Cap",tooltip:"If assigned, will be displayed when progress is at 100%"}),ar=Dr({range:[0,1,.01],slide:!0,tooltip:"i18n:progress.progress",override:!0}),$o(or=Nr(or=er((sr=Ye((rr=function(e){Ie(n,e);var t=xe(n);function n(){var _$e;Ce(this,n);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return je(_$e=t.call.apply(t,[this].concat(a)),"uiOpacity",sr,Ne(_$e)),je(_$e,"leftCap",lr,Ne(_$e)),je(_$e,"rightCap",ur,Ne(_$e)),_$e}return Ae(n,[{key:"progress",get:function get(){return Fe(Pe(n.prototype),"progress",this)},set:function set(e){Ge(Pe(n.prototype),"progress",e,this,!0),this.updateAppearance()}},{key:"updateAppearance",value:function value(){if(null!==this.uiOpacity)if(this.progress<=0)this.uiOpacity.opacity=0;else if(this.progress>.1)this.uiOpacity.opacity=255;else{var _$e=Math.floor(this.progress/.05*255);this.uiOpacity.opacity=_$e}}},{key:"start",value:function value(){this.updateAppearance()}}]),n}(X)).prototype,"uiOpacity",[tr],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return null}}),lr=Ye(rr.prototype,"leftCap",[nr],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return null}}),ur=Ye(rr.prototype,"rightCap",[ir],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return null}}),Ye(rr.prototype,"progress",[ar],Object.getOwnPropertyDescriptor(rr.prototype,"progress"),rr.prototype),or=rr))||or)||or)||or);n._RF.pop(),n._RF.push({},"bce15LcVrxOfYMa9rbXN/qi","Localize",void 0);var Br,Fr,zr,Gr,Ur,Hr,Vr,qr,Wr,Kr=i.ccclass,jr=i.property,Yr=i.requireComponent,Xr=i.executeInEditMode,Jr=i.disallowMultiple,Qr=globalThis.game.language;kr=Kr("Localize"),Er=Yr(u),Cr=Xr(!0),Tr=jr({visible:!0}),Ar=jr({group:{name:"Fonts",id:"fonts",displayOrder:1},type:J}),Rr=jr({group:{name:"Fonts",id:"fonts",displayOrder:2},type:J}),kr(Ir=Jr(Ir=Er(Ir=Cr((Ye((Pr=function(e){Ie(n,e);var t=xe(n);function n(){var _$e;Ce(this,n);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return je(_$e=t.call.apply(t,[this].concat(a)),"enFont",_r,Ne(_$e)),je(_$e,"ruFont",Lr,Ne(_$e)),_$e.handleLanguageChanged=function(){_$e.updateTransToNode()},_$e}return Ae(n,[{key:"key",get:function get(){return this._key},set:function set(e){e&&(this._key=e,this.updateTransToNode())}},{key:"__preload",value:function value(){this.label=this.getComponent(u),this.validateRequiredComponents(),this.updateTransToNode()}},{key:"validateRequiredComponents",value:function value(){St.lazyValidateProperties(this)}},{key:"start",value:function value(){this.listenEvent()}},{key:"listenEvent",value:function value(){W.on("update-language",this.handleLanguageChanged)}},{key:"updateTransToNode",value:function value(){if(this.node.active&&this._key)try{var _$e=Qr.getText(this._key),t=this.getFontByLang();this.label.font=t,this.label.string=_$e,this.node.emit("update-trans",_$e)}catch(e){console.warn(e)}}},{key:"getFontByLang",value:function value(){if(!this.enFont||!this.ruFont)throw new Error("Font is not found");switch(Qr.getCurrentLocale()){case"en":return this.enFont;case"ru":return this.ruFont;default:return this.enFont}}}]),n}(y)).prototype,"key",[Tr],Object.getOwnPropertyDescriptor(Pr.prototype,"key"),Pr.prototype),_r=Ye(Pr.prototype,"enFont",[Ar],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return null}}),Lr=Ye(Pr.prototype,"ruFont",[Rr],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return null}}),Ir=Pr))||Ir)||Ir)||Ir);n._RF.pop(),n._RF.push({},"aef305TaZhKVo1f4/qH1kf+","SecondOrderDynamics",void 0);var Zr,$r,es,ts,ns,is,as,os,rs,ss=i.ccclass,ls=i.property,us=function(){function e(t,n){var i;Ce(this,e),n=null!==(i=n)&&void 0!==i?i:{response:1,dampen:1,eager:1},this.k1=e.calcK1(n),this.k2=e.calcK2(n),this.k3=e.calcK3(n),this.xp=t.clone(),this.y=t.clone(),this.yd=new Q(0,0)}return Ae(e,[{key:"update",value:function value(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;null===n&&(n=new Q((t.x-this.xp.x)/e,(t.y-this.xp.y)/e),this.xp.x=t.x,this.xp.y=t.y);var i=Math.max(this.k2,e*e/2+e*this.k1/2,e*this.k1);return this.y.x=this.y.x+e*this.yd.x,this.y.y=this.y.y+e*this.yd.y,this.yd.x=this.yd.x+e*(t.x+this.k3*n.x-this.y.x-this.k1*this.yd.x)/i,this.yd.y=this.yd.y+e*(t.y+this.k3*n.y-this.y.y-this.k1*this.yd.y)/i,this.y}},{key:"setDynamics",value:function value(t){this.k1=e.calcK1(t),this.k2=e.calcK2(t),this.k3=e.calcK3(t)}},{key:"reset",value:function value(e){this.xp.set(e.x,e.y),this.y.set(e.x,e.y),this.yd.set(0,0)}},{key:"currentState",get:function get(){return this.y}}],[{key:"calcK1",value:function value(e){return e.dampen/(Math.PI*e.response)}},{key:"calcK2",value:function value(e){return 1/(2*Math.PI*e.response*(2*Math.PI*e.response))}},{key:"calcK3",value:function value(e){return e.eager*e.dampen/(2*Math.PI*e.response)}}]),e}(),cs=(Br=ss("SODConfig"),Fr=ls({type:E,displayName:"Responsiveness",tooltip:"Higher values will result shorter response times."}),zr=ls({type:E,displayName:"Dampening",tooltip:"Higher values will result in less overshoot and oscillation."}),Gr=ls({type:E,displayName:"Eagerness",tooltip:"Higher values will result in more overshoot and oscillation, negative values will result in anticipation."}),Br((Vr=Ye((Hr=Ae(function e(){Ce(this,e),je(this,"response",Vr,this),je(this,"dampen",qr,this),je(this,"eager",Wr,this)})).prototype,"response",[Fr],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return 200}}),qr=Ye(Hr.prototype,"dampen",[zr],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return 20}}),Wr=Ye(Hr.prototype,"eager",[Gr],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return 0}}),Ur=Hr))||Ur);n._RF.pop(),n._RF.push({},"e9e74FEHyRLvar32WZD/F11","Trail",void 0);var hs,ds,ps,ys,fs,vs,ms,gs,bs,Ss,ws,ks,Es,Cs,Ts,As,Rs,Is,Ps,_s,Ls,Os,Ds,Ns,Ms,xs,Bs=i.ccclass,Fs=i.property,zs=(Zr=Bs("Trail"),$r=Fs({type:a,displayName:"Target"}),es=Fs({type:q,displayName:"Graphics"}),ts=Fs({type:[cs],displayName:"Trail Nodes"}),Zr((as=Ye((is=function(e){Ie(n,e);var t=xe(n);function n(){var _$e;Ce(this,n);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return je(_$e=t.call.apply(t,[this].concat(a)),"target",as,Ne(_$e)),je(_$e,"graphics",os,Ne(_$e)),je(_$e,"trailNodes",rs,Ne(_$e)),_$e.trailNodeInstances=[],_$e}return Ae(n,[{key:"reset",value:function value(){var _$e,t=We(this.trailNodeInstances);try{for(t.s();!(_$e=t.n()).done;){_$e.value.reset(new Q(this.node.worldPosition.x,this.node.worldPosition.y))}}catch(e){t.e(e)}finally{t.f()}this.graphics.clear()}},{key:"onLoad",value:function value(){this.validateRequiredComponents(),this.spawnTrailNodes()}},{key:"update",value:function value(e){this.graphics.clear();var t=this.trailNodeInstances[0];this.drawTrail(e,t,this.target.worldPosition.x,this.target.worldPosition.y);for(var _$n=1;_$n<this.trailNodeInstances.length;_$n++){var i=this.trailNodeInstances[_$n-1],a=this.trailNodeInstances[_$n];this.drawTrail(e,a,i.currentState.x,i.currentState.y)}}},{key:"drawTrail",value:function value(e,t,n,i){var a=this.graphics,o=new Q(n,i),r=t.update(e,o),s=new Y(o.x,o.y,0),l=new Y(r.x,r.y,0);a.node.inverseTransformPoint(s,s),a.node.inverseTransformPoint(l,l),a.moveTo(s.x,s.y),a.lineTo(l.x,l.y),a.stroke()}},{key:"spawnTrailNodes",value:function value(){var _$e,t=We(this.trailNodes);try{for(t.s();!(_$e=t.n()).done;){var _$n=_$e.value,i=new Q(this.node.worldPosition.x,this.node.worldPosition.y),a=new us(i,_$n);this.trailNodeInstances.push(a)}}catch(e){t.e(e)}finally{t.f()}}},{key:"validateRequiredComponents",value:function value(){if(!this.target)throw new Error("Target is not set");if(!this.graphics)throw new Error("Graphics is not set");0===this.trailNodes.length&&console.warn("No trail nodes are set")}}]),n}(y)).prototype,"target",[$r],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),os=Ye(is.prototype,"graphics",[es],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),rs=Ye(is.prototype,"trailNodes",[ts],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return[]}}),ns=is))||ns);n._RF.pop(),n._RF.push({},"a2260jBMJFPCrn/Q4Vo4iB1","BatchNodes",void 0);var Gs,Us=i.ccclass,Hs=i.executionOrder,Vs=i.property,qs=GameCore.Utils.Array,Ws="Batch By Name",Ks="Batch Label",js="Batch Sprite",Ys=(hs=Us("BatchNodes"),ds=Hs(99999),ps=Vs({group:{name:Ws}}),ys=Vs({type:[g],group:{name:Ws}}),fs=Vs({type:[m],group:{name:Ws}}),vs=Vs({group:{name:Ks}}),ms=Vs({group:{name:Ks}}),gs=Vs({group:{name:Ks}}),bs=Vs({group:{name:js}}),Ss=Vs({group:{name:js}}),ws=Vs({readonly:!0}),ks=Vs({readonly:!0}),Es=Vs({readonly:!0}),hs(Cs=ds((As=Ye((Ts=function(e){Ie(n,e);var t=xe(n);function n(){var _$e;Ce(this,n);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return je(_$e=t.call.apply(t,[this].concat(a)),"batchByName",As,Ne(_$e)),je(_$e,"depthNames",Rs,Ne(_$e)),je(_$e,"listName",Is,Ne(_$e)),je(_$e,"batchLabel",Ps,Ne(_$e)),je(_$e,"depthLabel",_s,Ne(_$e)),je(_$e,"typeLabel",Ls,Ne(_$e)),je(_$e,"batchSprite",Os,Ne(_$e)),je(_$e,"depthSprite",Ds,Ne(_$e)),je(_$e,"batchAllNodes",Ns,Ne(_$e)),je(_$e,"batchDepth",Ms,Ne(_$e)),je(_$e,"checkOverlap",xs,Ne(_$e)),_$e.batchNode={},_$e.labelChildren=[],_$e.spriteChildren=[],_$e.allChildren=[],_$e.nameChildren=[],_$e.originalParents={},_$e.isInited=!1,_$e.onAfterUpdate=function(){_$e.isInited&&_$e.hierarchyChildren()},_$e.onAfterRender=function(){_$e.isInited&&_$e.restoreOriginalChildren()},_$e}return Ae(n,[{key:"__preload",value:function value(){this.enabled&&(p.on(Z.EVENT_AFTER_UPDATE,this.onAfterUpdate),p.on(Z.EVENT_AFTER_RENDER,this.onAfterRender))}},{key:"onDestroy",value:function value(){p.off(Z.EVENT_AFTER_UPDATE,this.onAfterUpdate),p.off(Z.EVENT_AFTER_RENDER,this.onAfterRender)}},{key:"onLoad",value:function value(){this.enabled&&(this.setupBatchNodes(this.node),this.isInited=!0)}},{key:"onEnable",value:function value(){p.on(Z.EVENT_AFTER_UPDATE,this.onAfterUpdate),p.on(Z.EVENT_AFTER_RENDER,this.onAfterRender),this.setupBatchNodes(this.node),this.isInited=!0}},{key:"onDisable",value:function value(){this.restoreOriginalChildren(),p.off(Z.EVENT_AFTER_UPDATE,this.onAfterUpdate),p.off(Z.EVENT_AFTER_RENDER,this.onAfterRender),this.isInited=!1}},{key:"setupBatchNodes",value:function value(e){this.allChildren=[],this.nameChildren=[],this.labelChildren=[],this.spriteChildren=[],this.saveOriginalChildren(e),this.createGlobalNodes(e),this.createGlobalNameNodes(e),this.createGlobalLabelNode(e),this.createGlobalSpriteNode(e),this.sortGlobalNodes()}},{key:"sortGlobalNodes",value:function value(){var _$e,t,_$n,i=this;null===(_$e=this.batchNode.node)||void 0===_$e||_$e.setSiblingIndex(0),null===(t=this.batchNode.label)||void 0===t||t.setSiblingIndex(this.depthLabel),null===(_$n=this.batchNode.sprite)||void 0===_$n||_$n.setSiblingIndex(this.depthSprite),this.listName.forEach(function(e,t){var _$n;null===(_$n=i.batchNode[e])||void 0===_$n||_$n.setSiblingIndex(i.depthNames[t])})}},{key:"createGlobalNodes",value:function value(e){if(this.batchAllNodes){var t=new a("GlobalBatchNode");t.active=!0,this.batchNode.node=t,e.addChild(t)}}},{key:"createGlobalNameNodes",value:function value(e){var t=this;this.batchByName&&this.listName.forEach(function(n){if(!t.batchNode[n]){var i=new a(n);i.active=!0,t.batchNode[n]=i,e.addChild(i)}})}},{key:"createGlobalLabelNode",value:function value(e){if(this.batchLabel){var t=new a("GlobalLabelNode");t.active=!0,this.batchNode.label=t,e.addChild(t)}}},{key:"createGlobalSpriteNode",value:function value(e){if(this.batchSprite){var t=new a("GlobalSpriteNode");t.active=!0,this.batchNode.sprite=t,e.addChild(t)}}},{key:"saveOriginalParents",value:function value(){var _$e=this;[].concat(He(this.labelChildren),He(this.spriteChildren)).forEach(function(t){t.node.parent&&(_$e.originalParents[t.uuid]=t.node.parent)}),this.nameChildren.forEach(function(t){t.parent&&(_$e.originalParents[t.uuid]=t.parent)})}},{key:"saveOriginalChildren",value:function value(e){var t=this;e.children.forEach(function(e){t.saveLabelChildren(e),t.saveSpriteChildren(e),t.saveNodeChildrenByName(e),t.saveNodeChildrenByType(e)}),this.saveOriginalParents()}},{key:"saveLabelChildren",value:function value(e){var t;if(this.batchLabel){var _$n=e.getComponentsInChildren(u);"char"===this.typeLabel&&_$n.filter(function(e){return e.cacheMode===u.CacheMode.CHAR}),0!==_$n.length&&(t=this.labelChildren).push.apply(t,He(_$n))}}},{key:"saveSpriteChildren",value:function value(e){var t;if(this.batchSprite){var _$n=e.getComponentsInChildren(A);0!==_$n.length&&(t=this.spriteChildren).push.apply(t,He(_$n))}}},{key:"saveNodeChildrenByName",value:function value(e){var t=this;this.batchByName&&e.children.forEach(function(e){qs.has(t.listName,e.name)?t.nameChildren.push(e):t.saveNodeChildrenByName(e)})}},{key:"saveNodeChildrenByType",value:function value(e){var t,_$n=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(this.batchAllNodes){var a=e.getComponentsInChildren(y);(t=this.allChildren).push.apply(t,He(a)),this.batchDepth>0&&i<this.batchDepth&&this.allChildren.forEach(function(e){_$n.saveNodeChildrenByType(e.node,_$n.batchDepth)})}}},{key:"hierarchyChildren",value:function value(){var _$e,t=this;this.labelChildren.forEach(function(n){n.node.isValid&&n.node.activeInHierarchy&&(_$e=t.batchNode.label,n.node.isChildOf(_$e)||(n.node.setParent(_$e,!0),n.node.layer=$.Enum.UI_2D))}),this.spriteChildren.forEach(function(n){n.node.isValid&&n.node.activeInHierarchy&&(_$e=t.batchNode.sprite,n.node.isChildOf(_$e)||(n.node.setParent(_$e,!0),n.node.layer=$.Enum.UI_2D))}),this.allChildren.forEach(function(n){n.node.isValid&&n.node.activeInHierarchy&&(_$e=t.batchNode.node,n.node.isChildOf(_$e)||(n.node.setParent(_$e,!0),n.node.layer=$.Enum.UI_2D))}),this.allChildren.sort(function(e,t){var _$n=e.constructor.name,i=t.constructor.name;return _$n<i?-1:_$n>i?1:0}),this.nameChildren.forEach(function(n){if(n.isValid&&n.activeInHierarchy&&n.isTransformDirty()){var i=n.getComponent(x);i&&i.opacity<1||(_$e=t.batchNode[n.name],n.isChildOf(_$e)||(n.setParent(_$e,!0),n.layer=$.Enum.UI_2D))}})}},{key:"restoreOriginalChildren",value:function value(){var _$e=this,t=[].concat(He(this.labelChildren),He(this.spriteChildren));t.length>0&&t.forEach(function(t){var _$n=_$e.originalParents[t.uuid];_$n&&(t.node.isChildOf(_$n)||t.node.setParent(_$n,!0))}),this.nameChildren.forEach(function(t){var _$n=_$e.originalParents[t.uuid];_$n&&(t.isChildOf(_$n)||t.setParent(_$n,!0))})}}]),n}(y)).prototype,"batchByName",[ps],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return!1}}),Rs=Ye(Ts.prototype,"depthNames",[ys],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return[]}}),Is=Ye(Ts.prototype,"listName",[fs],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return[]}}),Ps=Ye(Ts.prototype,"batchLabel",[vs],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return!1}}),_s=Ye(Ts.prototype,"depthLabel",[ms],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return 1}}),Ls=Ye(Ts.prototype,"typeLabel",[gs],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return"char"}}),Os=Ye(Ts.prototype,"batchSprite",[bs],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return!1}}),Ds=Ye(Ts.prototype,"depthSprite",[Ss],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return 0}}),Ns=Ye(Ts.prototype,"batchAllNodes",[ws],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return!1}}),Ms=Ye(Ts.prototype,"batchDepth",[ks],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return 0}}),xs=Ye(Ts.prototype,"checkOverlap",[Es],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return!1}}),Cs=Ts))||Cs)||Cs);n._RF.pop(),n._RF.push({},"9b958Lf6PFClb/JuJfTLzxG","Vibrate",void 0);var Xs=i.ccclass,Js=GameCore.Utils.Browser,Qs=globalThis.game.player,Zs=Xs("Vibrate")(Gs=function(e){Ie(n,e);var t=xe(n);function n(){return Ce(this,n),t.apply(this,arguments)}return Ae(n,[{key:"vibrate",value:function value(e){if(this.isVibrateEnable()&&!Js.vibrate(e)){if("performHapticFeedbackAsync"in GameSDK.extra)return void GameSDK.extra.performHapticFeedbackAsync();console.warn("Vibrate failed")}}},{key:"isVibrateEnable",value:function value(){return!!Qs.getPlayerSetting("vibrate")}}]),n}(y))||Gs;n._RF.pop(),n._RF.push({},"358fdIqjFdNzZGa95REWt2F","Ads",void 0);var $s=1/6;n._RF.pop(),n._RF.push({},"542caJcCPRMI5EaOkgOzhek","ItemKeys",void 0);var el,tl={HINT:"hint",THUNDER:"thunder",STORM:"storm",PLIERS:"pliers"};n._RF.pop(),n._RF.push({},"62927KYr+tCcIzOaPtVc/q8","CoinData",void 0);var nl=10,il=50,al=100,ol=(Re(el={},tl.HINT,80),Re(el,tl.THUNDER,200),Re(el,tl.STORM,150),Re(el,tl.PLIERS,150),el),rl=200,sl=40;n._RF.pop(),n._RF.push({},"8328a20Ku5GF4anma0sBaxm","DailyRewardsData",void 0);var ll={0:{id:1,type:"coin",value:20},1:{id:2,type:"coin",value:30},2:{id:3,type:"coin",value:50},3:{id:4,type:"coin",value:100},4:{id:5,type:"coin",value:150},5:{id:6,type:"coin",value:200},6:{id:7,type:"coin",value:250,items:{hint:3,thunder:3,storm:3,pliers:0}}};n._RF.pop(),n._RF.push({},"8875b8IrVpJWJr/45aS1gql","DefaultRespMatchData",void 0);var ul=we(we({},GameCore.Dtos.Match.Data.getDefaultData()),{},{extraData:null});n._RF.pop(),n._RF.push({},"ad867amogBFGJo9jp78EnQP","DevTools",void 0);var cl=function(e){return e.UNLOCK_DEV_TOOLS="unlock-dev-tools",e.TRIGGER_UNLOCK_KEY="trigger-unlock-key",e.TRIGGER_RESET_SEQUENCE="trigger-reset-sequence",e}(cl||{}),hl={Events:cl,UNLOCK_SEQUENCE:"101013012031"};n._RF.pop(),n._RF.push({},"7decaASyaFOAp2izq8DsREg","TotalLevel",void 0);var dl;n._RF.pop(),n._RF.push({},"f8533KH/fxOfYqya9sgLrSj","GameData",void 0);var pl={level:0,coins:0,stars:0,totalLevel:80,levelVersion:0,lastRewardedItems:0,lastCreateTournamentShown:0,guideItemShowed:[],items:(dl={},Re(dl,tl.HINT,0),Re(dl,tl.THUNDER,0),Re(dl,tl.STORM,0),Re(dl,tl.PLIERS,0),dl),skins:{}};n._RF.pop(),n._RF.push({},"52b52FNwvhBKY/becAy420o","Leaderboard",void 0);var yl="global-leaderboard-key",fl="friends-leaderboard-key",vl="global-leaderboard-id",ml="friends-leaderboard-id";n._RF.pop(),n._RF.push({},"3b9bcPJBxpNOqG2I6exTOVn","MatchCustomData",void 0);var gl=we(we({},GameCore.Dtos.Match.CustomData.getDefaultData()),{},{score:0});n._RF.pop(),n._RF.push({},"074c4KXFZ1Pq6d+66PrLd2+","PlayerData",void 0);var bl={score:0,endlessScore:0,settings:{sound:!0,music:!0,vibrate:!0,language:"en"},gameData:pl,isFirstLogin:!0,dailyRewarded:{logDays:[],lastRewarded:0}};n._RF.pop(),n._RF.push({},"32598ObpVZK/pecmWIdcs+7","SceneKeys",void 0);var Sl="BootScene",wl="GameScene",kl="DashboardScene",El="ChallengeResultScene";n._RF.pop(),n._RF.push({},"f16ffbXQPtDK58g6BNFwzJv","Tournament",void 0);var Cl=function(e){return e.RELOAD_TOURNAMENT="reload-tournament",e}(Cl||{});n._RF.pop(),n._RF.push({},"598f2UgQ+NGBYLWv34s6Vev","renderCustomResultChallenge",void 0);var Tl=GameCore,Al=Tl.Configs.FrameCapture,Rl=Al.Enabled,Il=Al.WideframeConfigs,Pl=Tl.Utils.Object,_l=function(){var _$e=Ee(function(e){var t,n,i,a,o;return _ts_generator(this,function(_state){if(!Rl)return[2,(console.warn("FrameCapture is not enabled"),null)];t=Ol(e);if(!t)return[2,null];Ll(t,Il.CustomResultChallenge);n=window.game.frameCapture,i=Il.CustomResultChallenge,a=i.Width,o=i.Height;return[2,n.captureAsync({name:"CustomResultChallenge",width:a,height:o,renderOptions:t})]})});return function(t){return _$e.apply(this,arguments)}}(),Ll=function Ll(e,t){var n=t.Width,i=t.Height,a=t.Wideframe;e.wideframe={name:"custom-result-challenge",type:"image",depth:0,image:a,size:[n,i],position:[0,0]}},Ol=function Ol(e){try{var t=e.playerId,n=void 0===t?"10":t,i=e.playerPhoto,a=void 0===i?"":i,o=e.playerScore,r=void 0===o?0:o,s=e.opponentId,l=void 0===s?"20":s,u=e.opponentPhoto,c=void 0===u?"":u,h=e.opponentScore,d=void 0===h?0:h,p=e.isPlayerFinished,y=e.isOpponentFinished,f=Il.CustomResultChallenge.RenderOptions,v=Pl.camelCaseKeys(Pl.clone(f)),m=v.playerPhoto,g=v.opponentPhoto,b=r===d,S=r>d,w=null!=p?p:y,k=p&&y;return"image"===m.type&&(m.name="".concat(n),m.image=a),"image"===g.type&&(g.name="".concat(l),g.image=c),w&&Dl(v,{playerScore:r,opponentScore:d,isPlayerFinished:p,isOpponentFinished:y}),!k||b?(delete v.leftCrown,delete v.rightCrown,v):(S?delete v.rightCrown:delete v.leftCrown,v)}catch(e){return console.warn("getRenderOptionsShareScore",e),null}},Dl=function Dl(e,t){var n=e.leftScore,i=e.rightScore,a=t.playerScore,o=void 0===a?0:a,r=t.opponentScore,s=void 0===r?0:r,l=t.isPlayerFinished,u=t.isOpponentFinished;"text"===n.type&&(n.text=l?"".concat(o):"???"),"text"===i.type&&(i.text=u?"".concat(s):"???")};n._RF.pop(),n._RF.push({},"ad7acMQ2iJNKKA2RkT+nGNI","CommonError",void 0);var Nl=function(e){Ie(n,e);var t=xe(n);function n(e,i){var a;return Ce(this,n),(a=t.call(this,i)).code=e,a}return Ae(n)}(De(Error));n._RF.pop(),n._RF.push({},"5ff78u05/tPepABfMzNaOjM","PlayerHasTournamentError",void 0);var Ml=function(e){Ie(n,e);var t=xe(n);function n(e,i){var a;return Ce(this,n),(a=t.call(this,"PLAYER_HAS_TOURNAMENT","Player has a tournament")).playerId=e,a.tournamentId=i,a}return Ae(n)}(Nl);n._RF.pop(),n._RF.push({},"e14dbcdc89LQJIggfi5qO6U","MapData",void 0);var xl={themeNames:["summer","autumn","winter"],skinNames:["cakes","car","cosmetics","flower","fruit","ice-cream","sport","tool"],mapOrder:[{id:1,theme:"summer",skin:"fruit",levelCount:10},{id:2,theme:"autumn",skin:"flower",levelCount:10},{id:3,theme:"winter",skin:"tool",levelCount:10},{id:4,theme:"summer",skin:"sport",levelCount:10},{id:5,theme:"autumn",skin:"cosmetics",levelCount:10},{id:6,theme:"winter",skin:"ice-cream",levelCount:10},{id:7,theme:"summer",skin:"cakes",levelCount:10},{id:8,theme:"autumn",skin:"car",levelCount:10}]};n._RF.pop(),n._RF.push({},"c0656MbbYRE+KSk63rv74ZI","SkinKeys",void 0);var Bl="cakes",Fl="flower",zl="fruit";n._RF.pop(),n._RF.push({},"3f1dbbPrPVBy5lNYySV74Qq","ThemeKeys",void 0);var Gl={SUMMER:"summer",AUTUMN:"autumn",WINTER:"winter"};R(Gl),n._RF.pop(),n._RF.push({},"6093adbLQZKpqgUpTV/sHj1","ThemeUtils",void 0);var Ul=globalThis.game,Hl=Ul.player,Vl=Ul.storage,ql=GameCore.Utils.Array,Wl={currentProgress:0,maxProgress:10,isLocked:!0,themeId:"summer"},Kl={id:0,currentSkin:Bl,currentTheme:Gl.SUMMER,nextSkin:null,nextTheme:null,progress:0,max:10},jl={skin:"cakes",themeId:"summer",progress:0,max:10,isLocked:!0},Yl=function(){function e(){Ce(this,e),this.mapData=xl,this.playerSkinProgress=null}return Ae(e,[{key:"initDashboardSceneStorage",value:function value(){var _$e=Vl.getStorage("dashboard");if(null==_$e){var t=this.getCurrentMapProgressInstance();Vl.addStorage("dashboard",{lastMapPayload:t,numOfMapsPassed:0,animateToCurrentLevel:!1});var n=Vl.getStorage("collection");if(null==n){Vl.addStorage("collection",{lastMapPack:t.id,animateMapPackUnlock:!1});var i=Vl.getStorage("leaderboard_content");if(null==i){Vl.addStorage("leaderboard_content",{lastTabOpened:"global"});var a=Vl.getStorage("tournament");null==a&&Vl.addStorage("tournament",{animateTournamentLeader:!1})}}}}},{key:"getCurrentMapProgressInstance",value:function value(){if(null===this.playerSkinProgress)return console.warn("getCurrentMapProgress: playerSkinProgress not found. Have you called init()?"),Kl;for(var _$e=this.mapData.mapOrder,t=void 0,n=void 0,i=void 0,a=void 0,o=0,r=0,s=0,l=0;l<_$e.length;l++){var u=this.playerSkinProgress[_$e[l].skin];if(u.currentProgress<u.maxProgress){var c,h,d,p;s=_$e[l].id,t=_$e[l].skin,n=_$e[l].theme,i=null!==(c=null===(h=_$e[l+1])||void 0===h?void 0:h.skin)&&void 0!==c?c:t,a=null!==(d=null===(p=_$e[l+1])||void 0===p?void 0:p.theme)&&void 0!==d?d:n,o=u.currentProgress,r=u.maxProgress;break}}if(void 0===t||void 0===i||void 0===n||void 0===a){var y=_$e[_$e.length-1];return s=y.id,t=y.skin,n=y.theme,i=y.skin,a=y.theme,o=y.levelCount,r=y.levelCount,console.log("getMapCurrentProgress: all skin completed"),{id:s,currentSkin:t,currentTheme:n,nextSkin:i,nextTheme:a,progress:o,max:r}}return console.log("getMapCurrentProgress",t,i,o,r),{id:s,currentSkin:t,currentTheme:n,nextSkin:i,nextTheme:a,progress:o,max:r}}},{key:"getUnlockedSkinsInstance",value:function value(){if(null===this.playerSkinProgress||void 0===this.playerSkinProgress)return console.warn("getUnlockedSkins: playerSkinProgress not found. Have you called init()?"),["cakes"];for(var _$e=[],t=0,n=Object.keys(this.playerSkinProgress);t<n.length;t++){var i=n[t];this.playerSkinProgress[i].isLocked||_$e.push(i)}return console.log("getUnlockedSkins",_$e),_$e}},{key:"getLevelSkinInstance",value:function value(e){var t,n=null!=e?e:1,i=this.mapData.mapOrder,a=0,o=We(i);try{for(o.s();!(t=o.n()).done;){var r=t.value;if(a+r.levelCount>=n)return console.log("getMapSkin",r.skin),r.skin;a+=r.levelCount}}catch(e){o.e(e)}finally{o.f()}var s=i[i.length-1];return console.log("getMapSkin",s.skin),s.skin}},{key:"getLevelThemeInstance",value:function value(e){var t,n=null!=e?e:1,i=this.mapData.mapOrder,a=0,o=We(i);try{for(o.s();!(t=o.n()).done;){var r=t.value;if(a+r.levelCount>=n)return console.log("getMapTheme",r.theme),r.theme;a+=r.levelCount}}catch(e){o.e(e)}finally{o.f()}var s=i[i.length-1];return console.log("getMapTheme",s.theme),s.theme}},{key:"getCollectionUnlockProgressInstance",value:function value(){if(null===this.playerSkinProgress)return console.warn("getCollectionUnlockProgress: playerSkinProgress not found. Have you called init()?"),[jl];for(var _$e=[],t=0,n=Object.entries(this.playerSkinProgress);t<n.length;t++){var i=n[t],a=i[1],o=a.currentProgress,r=a.maxProgress,s=a.isLocked,l=a.themeId;_$e.push({progress:o,max:r,isLocked:s,skin:i[0],themeId:l})}return _$e}},{key:"updatePlayerSkinProgress",value:function value(){var _$e=Hl.getGameData();if(null!=_$e&&_$e.skins&&Object.keys(_$e.skins).length>0){this.playerSkinProgress={};for(var t=0,n=Object.keys(_$e.skins);t<n.length;t++){var i=n[t];this.playerSkinProgress[i]=we(we({},Wl),_$e.skins[i])}}else{console.log("getPlayerSkinProgress: playerData not found, use data from level");var a=this.mapData.mapOrder;this.playerSkinProgress={};var o,r=We(a);try{for(r.s();!(o=r.n()).done;){var s=o.value;this.playerSkinProgress[s.skin]={themeId:s.theme,currentProgress:0,maxProgress:s.levelCount,isLocked:!0}}}catch(e){r.e(e)}finally{r.f()}this.updatePlayerSkinProgressByLevel(),console.log(this.playerSkinProgress)}}},{key:"updatePlayerSkinProgressByLevel",value:function value(){var _$e,t=Hl.getGameData(),n=(null!==(_$e=null==t?void 0:t.level)&&void 0!==_$e?_$e:1)-1,i=this.mapData.mapOrder;this.playerSkinProgress[i[0].skin].isLocked=!1;var a,o=We(i);try{for(o.s();!(a=o.n()).done;){var r=a.value,s=r.levelCount,l=r.skin;if(!(n<=0)){var u=n-s>=0?s:n;n-=u,console.log("getPlayerSkinProgressByLevel",l,u),this.increaseProgressInstance(l,u,!1)}}}catch(e){o.e(e)}finally{o.f()}}},{key:"increaseProgressInstance",value:function value(e,t,n){if(null!==this.playerSkinProgress)if(this.playerSkinProgress[e]){var i=this.playerSkinProgress[e],a=i.currentProgress,o=i.maxProgress,r=a+t>o?o:a+t;if(r>0&&(this.playerSkinProgress[e].isLocked=!1),r===o){var s,l=this.mapData.mapOrder,u=null===(s=l[ql.searchIndex(l,function(t){return t.skin===e})+1])||void 0===s?void 0:s.skin;u&&this.unlockSkinInstance(u,!1)}this.playerSkinProgress[e].currentProgress=r,this.playerSkinProgress[e].maxProgress=o,n&&this.syncPlayerSkinProgress()}else console.warn("increaseProgress: skin not found",e);else console.warn("increaseProgress: playerSkinProgress not found. Have you called init()?")}},{key:"unlockSkinInstance",value:function value(e,t){null!==this.playerSkinProgress?this.playerSkinProgress[e]?(this.playerSkinProgress[e].isLocked=!1,t&&this.syncPlayerSkinProgress()):console.warn("unlockSkin: skin not found",e):console.warn("unlockSkin: playerSkinProgress not found. Have you called init()?")}},{key:"syncPlayerSkinProgress",value:function value(){Hl.setGameData({skins:this.playerSkinProgress})}}],[{key:"getInstance",value:function value(){return this._instance||(this._instance=new e),this._instance}},{key:"init",value:function value(){var _$e=this.getInstance();_$e.updatePlayerSkinProgress(),_$e.initDashboardSceneStorage()}},{key:"getCurrentMapProgress",value:function value(){return this.getInstance().getCurrentMapProgressInstance()}},{key:"getUnlockedSkins",value:function value(){return this.getInstance().getUnlockedSkinsInstance()}},{key:"getLevelSkin",value:function value(e){return this.getInstance().getLevelSkinInstance(e)}},{key:"getLevelTheme",value:function value(e){return this.getInstance().getLevelThemeInstance(e)}},{key:"getCollectionUnlockProgress",value:function value(){return this.getInstance().getCollectionUnlockProgressInstance()}},{key:"increaseProgress",value:function value(e,t,n){this.getInstance().increaseProgressInstance(e,t,n)}},{key:"unlockSkin",value:function value(e,t){this.getInstance().unlockSkinInstance(e,t)}}]),e}();n._RF.pop(),n._RF.push({},"0397cr2IpZEwbRzwQhlVHMO","MatchUtils",void 0);var Xl=globalThis.game,Jl=Xl.match,Ql=Xl.player,Zl=Xl.leaderboard,$l=Xl.frameCapture,eu=GameCore,tu=eu.Utils,nu=tu.Object,iu=tu.Valid,au=tu.String,ou=tu.Array,ru=eu.Match.Modes,su=eu.Dtos.Match.Data,lu=["Champion","Ultimate","Grand","Elite","Master's","Premier","Epic","Pro's","Supreme","Legendary","Victory","Prime","Titan's","Hero's","Star's"],uu=function(){function e(){Ce(this,e)}var t,n,i,a,o,r,s,l,u,c,h,d,p,y,f,v,m,g,b;return Ae(e,[{key:"processStartSingleModeAsync",value:(b=Ee(function(){var _$e;return _ts_generator(this,function(_state){switch(_state.label){case 0:_$e=Ql.getPlayerId();return[4,Jl.single.start.processAsync({playerId:_$e})];case 1:_state.sent();return[2]}})}),function(){return b.apply(this,arguments)})},{key:"processFinishSingleModeAsync",value:(g=Ee(function(){return _ts_generator(this,function(_state){switch(_state.label){case 0:return[4,Jl.single.finish.processAsync()];case 1:_state.sent();return[2]}})}),function(){return g.apply(this,arguments)})},{key:"processStartTournamentModeAsync",value:(m=Ee(function(){var _$e,t;return _ts_generator(this,function(_state){switch(_state.label){case 0:_$e=Ql.getPlayerId(),t=GameSDK.context.getID();return[4,Jl.tournament.continue.processAsync({playerId:_$e,contextId:t})];case 1:_state.sent();return[2]}})}),function(){return m.apply(this,arguments)})},{key:"processFinishTournamentModeAsync",value:(v=Ee(function(){var _$e,t;return _ts_generator(this,function(_state){switch(_state.label){case 0:_$e=Ql.getPlayerId(),t=Ql.getBestScore();return[4,Jl.tournament.finish.processAsync({playerId:_$e,bestScore:t})];case 1:_state.sent();return[2]}})}),function(){return v.apply(this,arguments)})},{key:"processStartChallengeModeAsync",value:(f=Ee(function(){var e,_tmp,_tmp1;return _ts_generator(this,function(_state){switch(_state.label){case 0:_state.trys.push([0,2,,7]);return[4,this.processContinueChallengeAsync()];case 1:_state.sent();return[3,7];case 2:e=_state.sent();if(!nu.hasOwn(e,"name")||iu.isString(e.name))throw e;_tmp="PlayerHasFinishedMatch"===e.name;if(!_tmp)return[3,4];return[4,this.processChallengeNewOpponentAsync()];case 3:_tmp=_state.sent();_state.label=4;case 4:_tmp;_tmp1="PlayerNotJoinInMatch"===e.name;if(!_tmp1)return[3,6];return[4,this.processJoinChallengeAsync()];case 5:_tmp1=_state.sent();_state.label=6;case 6:_tmp1;return[3,7];case 7:return[2]}})}),function(){return f.apply(this,arguments)})},{key:"processFinishChallengeModeAsync",value:(y=Ee(function(e){return _ts_generator(this,function(_state){switch(_state.label){case 0:$l.addWideframeRender("renderResultChallenge",$l.wideframe.renderResultChallenge);return[4,Jl.challenge.finish.processAsync(e)];case 1:_state.sent();return[2]}})}),function(e){return y.apply(this,arguments)})},{key:"processContinueChallengeAsync",value:(p=Ee(function(){var _$e,t,n,i,a,o;return _ts_generator(this,function(_state){switch(_state.label){case 0:_$e=this.getMatchState(),t=_$e.id,n=_$e.customData,i=n.playerId,a=n.opponentId;if(!iu.isString(t))throw new Error("Invalid match id");if(!iu.isString(i))throw new Error("Invalid player id");if(!iu.isString(a))throw new Error("Invalid opponent id");o=GameSDK.context.getID();if(!o)throw new Error("Cannot get contextId");return[4,Jl.challenge.continue.processAsync({matchId:t,contextId:o,playerId:i,opponentId:a})];case 1:_state.sent();return[2]}})}),function(){return p.apply(this,arguments)})},{key:"processChallengeNewOpponentAsync",value:(d=Ee(function(){var _$e,t,n,i;return _ts_generator(this,function(_state){switch(_state.label){case 0:_$e=Ql.getConnectedPlayerIds(100,0),t=Math.floor(Math.random()*_$e.length),n=Ql.getPlayerId(),i=_$e[t];return[4,Jl.challenge.friend.processAsync({playerId:n,opponentId:i})];case 1:_state.sent();return[2]}})}),function(){return d.apply(this,arguments)})},{key:"processJoinChallengeAsync",value:(h=Ee(function(){var _$e,t,n,i,a;return _ts_generator(this,function(_state){switch(_state.label){case 0:_$e=this.getMatchState(),t=_$e.id,n=_$e.customData,i=n.playerId,a=n.opponentId;if(!iu.isString(t))throw new Error("Invalid match id");if(!iu.isString(i))throw new Error("Invalid player id");if(!iu.isString(a))throw new Error("Invalid opponent id");return[4,Jl.challenge.join.processAsync({matchId:t,playerId:i,opponentId:a})];case 1:_state.sent();return[2]}})}),function(){return h.apply(this,arguments)})},{key:"getMatchState",value:function value(){var _$e=Jl.getMatchState();if(!_$e)throw new Error("Match state not found");return _$e}}],[{key:"inst",get:function get(){return this._instance||(this._instance=new e),this._instance}},{key:"startMatchAsync",value:(c=Ee(function(e){var _,e1;return _ts_generator(this,function(_state){switch(_state.label){case 0:_state.trys.push([0,10,,11]);_=null!=e?e:this.getMatchMode();switch(_){case ru.SINGLE:return[3,1];case ru.TOURNAMENT:return[3,3];case ru.CHALLENGE_FRIEND:return[3,5]}return[3,7];case 1:return[4,this.inst.processStartSingleModeAsync()];case 2:_state.sent();return[3,9];case 3:return[4,this.inst.processStartTournamentModeAsync()];case 4:_state.sent();return[3,9];case 5:return[4,this.inst.processStartChallengeModeAsync()];case 6:_state.sent();return[3,9];case 7:return[4,this.inst.processStartSingleModeAsync()];case 8:_state.sent();_state.label=9;case 9:return[3,11];case 10:e1=_state.sent();console.warn("startMatchAsync",e1);return[3,11];case 11:return[2]}})}),function(e){return c.apply(this,arguments)})},{key:"setProfileMatchDataAsync",value:(u=Ee(function(e){var e1;return _ts_generator(this,function(_state){switch(_state.label){case 0:_state.trys.push([0,2,,3]);return[4,Jl.handler.setProfileData(e)];case 1:_state.sent();return[3,3];case 2:e1=_state.sent();console.warn("setProfileMatchDataAsync",e1);return[3,3];case 3:return[2]}})}),function(e){return u.apply(this,arguments)})},{key:"setMatchCustomDataAsync",value:(l=Ee(function(e){var e1;return _ts_generator(this,function(_state){switch(_state.label){case 0:_state.trys.push([0,2,,3]);return[4,Jl.handler.setMatchCustomData(e)];case 1:_state.sent();return[3,3];case 2:e1=_state.sent();console.warn("setMatchCustomDataAsync",e1);return[3,3];case 3:return[2]}})}),function(e){return l.apply(this,arguments)})},{key:"setLeaderboardScoreAsync",value:(s=Ee(function(e){var e1;return _ts_generator(this,function(_state){switch(_state.label){case 0:_state.trys.push([0,2,,3]);return[4,Jl.handler.setLeaderboardScore(e)];case 1:_state.sent();return[3,3];case 2:e1=_state.sent();console.warn("setLeaderboardScoreAsync",e1);return[3,3];case 3:return[2]}})}),function(e){return s.apply(this,arguments)})},{key:"finishMatchAsync",value:(r=Ee(function(e){var _,e1;return _ts_generator(this,function(_state){switch(_state.label){case 0:_state.trys.push([0,10,,11]);_=this.getMatchMode();switch(_){case ru.SINGLE:return[3,1];case ru.TOURNAMENT:return[3,3];case ru.CHALLENGE_FRIEND:return[3,5]}return[3,7];case 1:return[4,this.inst.processFinishSingleModeAsync()];case 2:_state.sent();return[3,9];case 3:return[4,this.inst.processFinishTournamentModeAsync()];case 4:_state.sent();return[3,9];case 5:return[4,this.inst.processFinishChallengeModeAsync(e)];case 6:_state.sent();return[3,9];case 7:return[4,this.inst.processFinishSingleModeAsync()];case 8:_state.sent();_state.label=9;case 9:return[3,11];case 10:e1=_state.sent();console.warn("finishMatchAsync",e1);return[3,11];case 11:return[2]}})}),function(e){return r.apply(this,arguments)})},{key:"joinTournamentAsync",value:(o=Ee(function(e){var t;return _ts_generator(this,function(_state){switch(_state.label){case 0:t=Ql.getPlayerId();return[4,Jl.tournament.join.processAsync({tournamentId:e,playerId:t})];case 1:_state.sent();return[2]}})}),function(e){return o.apply(this,arguments)})},{key:"continueTournamentAsync",value:(a=Ee(function(e){var t;return _ts_generator(this,function(_state){switch(_state.label){case 0:t=Ql.getPlayerId();return[4,Jl.tournament.continue.processAsync({playerId:t,contextId:e})];case 1:_state.sent();return[2]}})}),function(e){return a.apply(this,arguments)})},{key:"createTournamentName",value:function value(){var _$e=lu[z.randomRangeInt(0,lu.length-1)],t="".concat(_$e," Tournament"),n=au.removeDiacritics(t);return"".concat(n)}},{key:"getShortName",value:function value(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:50,i=e.split(" "),a=0,o="",r=We(i);try{for(r.s();!(t=r.n()).done;){var s=t.value;if(a+s.length+1>n)break;o+="".concat(s," "),a+=s.length+1}}catch(e){r.e(e)}finally{r.f()}return o.slice(0,-1)}},{key:"createTournamentPayload",value:function value(){var _$e,t,n,i=au.generateObjectId(),a=Ql.getPlayerId(),o=Ql.getPlayer().name,r=Ql.getGameData(),s=null!==(_$e=null==r?void 0:r.level)&&void 0!==_$e?_$e:1,l=Yl.getLevelTheme(s),u=this.inst.getMatchState().profiles;return{score:null!==(t=null===(n=(void 0===u?{}:u)[a])||void 0===n?void 0:n.score)&&void 0!==t?t:0,playerId:a,mode:ru.TOURNAMENT,name:this.createTournamentName(),leaderboardId:i,payload:{playerId:a,playerName:o,leaderboardId:i,themeId:l}}}},{key:"getTournamentsAsync",value:(i=Ee(function(){var e;return _ts_generator(this,function(_state){switch(_state.label){case 0:_state.trys.push([0,2,,3]);return[4,GameSDK.tournament.getTournamentsAsync()];case 1:return[2,_state.sent()];case 2:e=_state.sent();return[2,(console.error(e),[])];case 3:return[2]}})}),function(){return i.apply(this,arguments)})},{key:"processCreateTournamentAsync",value:(n=Ee(function(){var _$e,t,n,i;return _ts_generator(this,function(_state){switch(_state.label){case 0:return[4,this.getTournamentsAsync()];case 1:_$e=_state.sent(),t=ou.search(_$e,function(e){var t,n=JSON.parse(null!==(t=e.getPayload())&&void 0!==t?t:"{}");return"DEFAULT"===e.getTournamentType()&&n.playerId===Ql.getPlayerId()});if(t)throw new Ml(Ql.getPlayerId(),t.getID());n=this.createTournamentPayload();Ql.setGameData({lastCreateTournamentShown:Date.now()});return[4,Jl.tournament.create.processAsync(n)];case 2:_state.sent();i=n.leaderboardId;Zl.addLeaderboard({name:i,type:"tournament",autoSortRank:!0,leaderboardId:i});return[2]}})}),function(){return n.apply(this,arguments)})},{key:"getMatchMode",value:function value(){var _$e=this.inst.getMatchState();return iu.isString(_$e.mode)?_$e.mode:null}},{key:"getMatchCustomData",value:function value(){var _$e=this.inst.getMatchState();return iu.isObject(_$e.customData)?_$e.customData:null}},{key:"getMatchExtraDataAsync",value:(t=Ee(function(e){var t;return _ts_generator(this,function(_state){switch(_state.label){case 0:return[4,Jl.api.getMatchAPI().getMatchDetailByIdAsync(e)];case 1:t=_state.sent();return[2,new su(t).toObject().extraData]}})}),function(e){return t.apply(this,arguments)})},{key:"updateMatchStateAfterLevelFinish",value:function value(e,t){this.setMatchCustomDataAsync({level:e,score:t});var n=Ql.getPlayerId();this.setProfileMatchDataAsync({id:n,score:t})}}]),e}();try{new uu}catch(e){console.error("MatchUtils",e)}n._RF.pop(),n._RF.push({},"97ca9J9nzNCeIjC1l+ZT/Hm","SceneUtils",void 0);var cu,hu,du,pu,yu,fu,vu,mu=globalThis.game.event,gu=GameCore.Events,bu=function(){function e(){Ce(this,e)}return Ae(e,null,[{key:"inst",get:function get(){return this._instance||(this._instance=new e),this._instance}},{key:"switchScene",value:function value(e,t){mu.emit(gu.SWITCH_SCENE,{sceneName:e,sceneData:t})}},{key:"preloadScene",value:function value(e){mu.emit(gu.PRELOAD_SCENE,{sceneName:e})}},{key:"preloadDashboardScene",value:function value(){this.preloadScene(kl)}},{key:"switchToDashboardScene",value:function value(e){this.switchScene(kl,e)}},{key:"preloadGameScene",value:function value(){this.preloadScene(wl)}},{key:"switchToGameScene",value:function value(e){this.switchScene(wl,e)}},{key:"getSceneData",value:function value(e){return"data"in e.scene&&e.scene.data||{}}}]),e}();try{new bu}catch(e){console.error("SceneUtils",e)}n._RF.pop(),n._RF.push({},"46b8aK6CThLtpMhZPEfDrNs","LoadingFullScreen",void 0);var Su,wu,ku,Eu,Cu,Tu=i.ccclass,Au=i.property,Ru=(cu=Tu("LoadingFullScreen"),hu=Au(X),du=Au(u),cu((fu=Ye((yu=function(e){Ie(a,e);var t,n,i=xe(a);function a(){var _$e;Ce(this,a);for(var t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];return je(_$e=i.call.apply(i,[this].concat(n)),"progressBar",fu,Ne(_$e)),je(_$e,"loadingText",vu,Ne(_$e)),_$e}return Ae(a,[{key:"__preload",value:function value(){this.uiOpacity=this.getComponent(x),this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function value(){St.lazyValidateProperties(this)}},{key:"runLoadingTextAnimation",value:function value(){var _$e=this,t=0;this.schedule(function(){t=t>2?0:t+1,_$e.loadingText.string="Loading";for(var n=0;n<t;n++)_$e.loadingText.string+="."},.5)}},{key:"stopLoadingTextAnimation",value:function value(){this.unscheduleAllCallbacks()}},{key:"show",value:(n=Ee(function(){var _$e,t;return _ts_generator(this,function(_state){switch(_state.label){case 0:this.uiOpacity.opacity=0,this.progressBar.progress=0;_$e=k(this.uiOpacity).to(.2,{opacity:255},{easing:"cubicOut"}),t=k(this.progressBar).to(8,{progress:.9},{easing:"cubicOut"});this.runLoadingTextAnimation(),gn.runTweenAsync(_$e);return[4,gn.runTweenAsync(t)];case 1:_state.sent();return[2]}})}),function(){return n.apply(this,arguments)})},{key:"hide",value:(t=Ee(function(){var _$e,t;return _ts_generator(this,function(_state){switch(_state.label){case 0:if(!(this.uiOpacity&&this.progressBar))return[3,3];this.uiOpacity.opacity=255,this.progressBar.progress=.9;_$e=k(this.uiOpacity).to(.15,{opacity:0},{easing:"cubicIn"}),t=k(this.progressBar).to(.2,{progress:1},{easing:"cubicIn"});this.runLoadingTextAnimation();return[4,gn.runTweenAsync(t)];case 1:_state.sent(),this.stopLoadingTextAnimation();return[4,gn.runTweenAsync(_$e)];case 2:_state.sent(),this.node.active=!1;_state.label=3;case 3:return[2]}})}),function(){return t.apply(this,arguments)})}]),a}(y)).prototype,"progressBar",[hu],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),vu=Ye(yu.prototype,"loadingText",[du],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),pu=yu))||pu);n._RF.pop(),n._RF.push({},"74caciRBKZLu7ymXYJK2GYy","Loading",void 0);var Iu=i.ccclass,Pu=i.property,_u=(Su=Iu("Loading"),wu=Pu(P),Su((Cu=Ye((Eu=function(e){Ie(a,e);var t,n,i=xe(a);function a(){var _$e;Ce(this,a);for(var t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];return je(_$e=i.call.apply(i,[this].concat(n)),"loadingPrefab",Cu,Ne(_$e)),_$e.loadingNode=null,_$e}return Ae(a,[{key:"__preload",value:function value(){this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function value(){St.lazyValidateProperties(this)}},{key:"onLoad",value:function value(){this.makePersistent()}},{key:"makePersistent",value:function value(){p.addPersistRootNode(this.node)}},{key:"createLoadingFullScreen",value:function value(){var _$e,t=I("Canvas");if(t&&!t.getChildByName("Loading")){this.loadingNode||(this.loadingNode=l(this.loadingPrefab));var n=l._clone(this.loadingNode);this.loadingFullScreen=n.getComponent(Ru),this.node.active=!1,null===(_$e=I("Canvas"))||void 0===_$e||_$e.addChild(n)}}},{key:"show",value:(n=Ee(function(){var _tmp;return _ts_generator(this,function(_state){switch(_state.label){case 0:this.createLoadingFullScreen();_tmp=this.node.active;if(_tmp)return[3,2];this.node.active=!0;return[4,this.loadingFullScreen.show()];case 1:_tmp=_state.sent();_state.label=2;case 2:_tmp;return[2]}})}),function(){return n.apply(this,arguments)})},{key:"hide",value:(t=Ee(function(){var _$e,_tmp;return _ts_generator(this,function(_state){switch(_state.label){case 0:_tmp=null!==(_$e=this.node)&&void 0!==_$e&&_$e.active&&this.loadingFullScreen;if(!_tmp)return[3,2];return[4,this.loadingFullScreen.hide()];case 1:_tmp=(_state.sent(),this.node.active=!1);_state.label=2;case 2:_tmp;return[2]}})}),function(){return t.apply(this,arguments)})}]),a}(y)).prototype,"loadingPrefab",[wu],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ku=Eu))||ku);n._RF.pop(),n._RF.push({},"a0dcdDZxhZImZ8Cfg4Dc7SJ","ScreenUtils",void 0);var Lu=globalThis.game.event,Ou=GameCore,Du=Ou.Events,Nu=Ou.Utils.Array,Mu=function(){function e(){Ce(this,e),this.showedScreens=[]}var t,n;return Ae(e,null,[{key:"inst",get:function get(){return this._instance||(this._instance=new e),this._instance}},{key:"openScreen",value:function value(e,t){var n=Ei[e];Lu.emit(Du.OPEN_SCREEN,{screenName:n,screenData:t})}},{key:"closeScreen",value:function value(e){var t=Ei[e];Lu.emit(Du.CLOSE_SCREEN,{screenName:t})}},{key:"showLoadingScreen",value:function value(e){this.openScreen(ki.LOADING_SCREEN,{duration:e})}},{key:"closeLoadingScreen",value:function value(){this.closeScreen(ki.LOADING_SCREEN)}},{key:"showNotificationScreen",value:function value(e,t){this.openScreen(ki.NOTIFICATION_SCREEN,{message:e,duration:t})}},{key:"closeNotificationScreen",value:function value(){this.closeScreen(ki.NOTIFICATION_SCREEN)}},{key:"addShowedScene",value:function value(e){Nu.has(this.inst.showedScreens,e)||this.inst.showedScreens.push(e)}},{key:"showLoadingFullScreen",value:(n=Ee(function(e){var t,_tmp;return _ts_generator(this,function(_state){switch(_state.label){case 0:if(!!Nu.has(this.inst.showedScreens,e))return[3,3];this.addShowedScene(e);t=I("Loading");_tmp=t;if(!_tmp)return[3,2];t.active=!0;return[4,t.getComponent(_u).show()];case 1:_tmp=_state.sent();_state.label=2;case 2:_tmp;_state.label=3;case 3:return[2]}})}),function(e){return n.apply(this,arguments)})},{key:"hideLoadingFullScreen",value:(t=Ee(function(e){var t,_tmp;return _ts_generator(this,function(_state){switch(_state.label){case 0:_tmp=Nu.has(this.inst.showedScreens,e);if(_tmp)return[3,2];return[4,null===(t=I("Loading"))||void 0===t?void 0:t.getComponent(_u).hide()];case 1:_tmp=_state.sent();_state.label=2;case 2:_tmp;return[2]}})}),function(e){return t.apply(this,arguments)})},{key:"showLoadingNotificationScreen",value:function value(){this.openScreen(ki.NOTIFICATION_SCREEN,{message:"Loading",enableCloseOnTouch:!1})}},{key:"showTournamentDetailScreen",value:function value(e,t){this.openScreen(ki.TOURNAMENT_DETAIL_SCREEN,{tournament:e,tournamentContextType:t})}},{key:"closeTournamentDetailScreen",value:function value(){this.closeScreen(ki.TOURNAMENT_DETAIL_SCREEN)}}]),e}();try{new Mu}catch(e){console.error("ScreenUtils",e)}n._RF.pop(),n._RF.push({},"d6fb7/+FFxLs7k5w6K38JYb","TournamentUtils",void 0);var xu=GameCore,Bu=xu.Utils,Fu=Bu.String,zu=Bu.Valid,Gu=Bu.Array,Uu=xu.Configs.Mockup.Leaderboards,Hu=globalThis.game,Vu=Hu.leaderboard,qu=Hu.player,Wu=function(){function e(){var t=this;Ce(this,e),this.globalTournamentLBData=[],this.playerTournaments=[],this.tournamentData=[],this.maxTimeRefetch=5e3,this.lastFetchTournamentsData=0,this.lastFetchGlobalTournament=0,this.fetchGlobalTournamentLeaderboardAsync=Ee(function(){var _tmp,e;return _ts_generator(this,function(_state){switch(_state.label){case 0:_state.trys.push([0,3,,4]);_tmp=Date.now()-t.lastFetchGlobalTournament>t.maxTimeRefetch;if(!_tmp)return[3,2];return[4,Vu.requestLeaderboardsAsync({limit:100,type:"world_tournament_leaderboard"})];case 1:_tmp=(t.globalTournamentLBData=_state.sent(),t.globalTournamentLBData.sort(function(e,t){return e.expireTime-t.expireTime}));_state.label=2;case 2:_tmp;return[3,4];case 3:e=_state.sent();console.warn("fetchGlobalTournamentLeaderboardAsync",e);return[3,4];case 4:return[2,t.globalTournamentLBData]}})}),this.fetchTournamentsAsync=Ee(function(){var _tmp,e;return _ts_generator(this,function(_state){switch(_state.label){case 0:_state.trys.push([0,3,,4]);_tmp=Date.now()-t.lastFetchTournamentsData>t.maxTimeRefetch;if(!_tmp)return[3,2];return[4,GameSDK.tournament.getTournamentsAsync()];case 1:_tmp=(t.playerTournaments=_state.sent(),t.playerTournaments.sort(function(e,t){return e.getEndTime()-t.getEndTime()}));_state.label=2;case 2:_tmp;return[3,4];case 3:e=_state.sent();console.warn("fetchTournamentsAsync",e);return[3,4];case 4:return[2,t.playerTournaments]}})})}var t;return Ae(e,[{key:"processPlayerTournamentData",value:function value(){var _$e,t=[],n=We(this.playerTournaments);try{for(n.s();!(_$e=n.n()).done;){var i,a,o=_$e.value,r="".concat(o.getID()),s=o.getContextID(),l=o.getEndTime(),u=this.parseTournamentPayload(o.getPayload());if(this.validateGameSDKTournamentPayload(u)){if(!(l<Date.now()/1e3)&&"PAGE_HOSTED"!==o.getTournamentType()){var c=null!==(i=u.playerName)&&void 0!==i?i:"Player",h={id:r,title:null!==(a=o.getTitle())&&void 0!==a?a:this.createDefaultTournamentName(c),endTime:l,contextId:s,payload:u};t.push(h)}}}}catch(e){n.e(e)}finally{n.f()}return t}},{key:"processGlobalTournamentLeaderboardData",value:function value(){var _$e=[];if(Uu.Enabled){for(var t=0;t<this.playerTournaments.length;t++){var n,i=this.playerTournaments[t],a=i.getTournamentType();if("PAGE_HOSTED"===a){var o="".concat(i.getID()),r=i.getContextID(),s=i.getEndTime(),l=this.parseTournamentPayload(i.getPayload()),u={id:o,title:null!==(n=i.getTitle())&&void 0!==n?n:"Global Tournament",endTime:s,contextId:r,payload:l,tournamentType:a};_$e.push(u)}}return _$e}for(var c=0;c<this.globalTournamentLBData.length;c++){var h,d={tournamentId:"",contextId:""},p=this.globalTournamentLBData[c];try{d=JSON.parse(p.description)}catch(e){continue}if(this.validateExpireTime(p)&&this.validateGlobalTournamentPayload(d)){var y={id:d.tournamentId,title:p.name,endTime:this.getTournamentEndTime(p),contextId:d.contextId,payload:{playerId:"global",playerName:"global",leaderboardId:p._id,themeId:null!==(h=d.themeId)&&void 0!==h?h:Gl.SUMMER}};_$e.push(y)}}return _$e}},{key:"validateGlobalTournamentPayload",value:function value(e){var t=e.tournamentId,n=e.contextId;return!(!zu.isString(t)||""===t)&&!(!zu.isString(n)||""===n)}},{key:"getTournamentEndTime",value:function value(e){var t=new Date(e.createdAt).getTime();return Math.round((1e3*e.expireTime+t)/1e3)}},{key:"validateExpireTime",value:function value(e){return 1e3*this.getTournamentEndTime(e)-Date.now()>0}},{key:"validateGameSDKTournamentPayload",value:function value(e){return!(!zu.isString(e.playerId)||""===e.playerId)&&!(!zu.isString(e.playerName)||""===e.playerName)&&!(!zu.isString(e.leaderboardId)||""===e.leaderboardId)}},{key:"createDefaultTournamentName",value:function value(e){var t=e.substring(0,7),n="".concat(t.split(" ")[0]||t,"'s Tournament"),i=Fu.removeDiacritics(n);return"".concat(i)}},{key:"parseTournamentPayload",value:function value(e){if("string"!=typeof e)return{};try{return JSON.parse(e)}catch(e){return{}}}}],[{key:"getInstance",value:function value(){return this._instance||(this._instance=new e),this._instance}},{key:"requestTournamentDataAsync",value:(t=Ee(function(){var _$e,t,n;return _ts_generator(this,function(_state){switch(_state.label){case 0:_$e=this.getInstance();return[4,Promise.all([_$e.fetchTournamentsAsync(),_$e.fetchGlobalTournamentLeaderboardAsync()])];case 1:_state.sent();t=_$e.processPlayerTournamentData(),n=_$e.processGlobalTournamentLeaderboardData();return[2,(_$e.tournamentData=[].concat(He(t),He(n)),_$e.tournamentData.sort(function(e,t){return e.endTime-t.endTime}),_$e.tournamentData.forEach(function(e){var t=e.payload.leaderboardId;t&&(Vu.isExistLeaderboardId(t)||Vu.addLeaderboard({type:"tournament",name:t,autoSortRank:!0,leaderboardId:t}))}),_$e.tournamentData)]}})}),function(){return t.apply(this,arguments)})},{key:"getAllTournamentData",value:function value(){return this.getInstance().tournamentData}},{key:"getTournamentDataById",value:function value(e){var t=this.getInstance();return Gu.search(t.tournamentData,function(t){return t.id===e})}},{key:"getPlayerTournamentData",value:function value(){var _$e=this.getInstance(),t=qu.getPlayerId();return _$e.tournamentData.filter(function(e){return e.payload.playerId===t})}},{key:"getFriendsTournamentData",value:function value(){var _$e=this.getInstance(),t=qu.getPlayerId();return _$e.tournamentData.filter(function(e){var n=e.payload;return n.playerId!==t&&"global"!==n.playerId})}},{key:"getGlobalTournamentData",value:function value(){return this.getInstance().tournamentData.filter(function(e){return"global"===e.payload.playerId})}},{key:"validateTournamentExpired",value:function value(e){var t=this.getTournamentDataById(e);return!!t&&t.endTime<Date.now()/1e3}}]),e}();n._RF.pop(),n._RF.push({},"d90c4WisP9LybAFqNuS6imZ","FailKeys",void 0);var Ku,ju="time",Yu="bomb";n._RF.pop(),n._RF.push({},"44b50YkamZDD5fO9vdZKeG7","InputController",void 0);var Xu=(0,i.ccclass)("InputController")(Ku=function(e){Ie(n,e);var t=xe(n);function n(){var _$e;Ce(this,n);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return(_$e=t.call.apply(t,[this].concat(a))).handleElementPointerDown=function(){},_$e.handleElementPointerUp=function(e){},_$e}return Ae(n,[{key:"onLoad",value:function value(){this.listenInputEvents()}},{key:"listenInputEvents",value:function value(){j.os!==j.OS.WINDOWS&&j.os!==j.OS.OSX||(document.addEventListener("pointerup",this.handleElementPointerUp),document.addEventListener("pointerdown",this.handleElementPointerDown))}},{key:"onDestroy",value:function value(){j.os!==j.OS.WINDOWS&&j.os!==j.OS.OSX||(document.removeEventListener("pointerup",this.handleElementPointerUp),document.removeEventListener("pointerdown",this.handleElementPointerDown))}}]),n}(y))||Ku;n._RF.pop(),n._RF.push({},"7f144HjLfBLWbFvbRFCCt8e","Directions",void 0);var Ju={Up:{x:0,y:1},Down:{x:0,y:-1},Left:{x:-1,y:0},Right:{x:1,y:0}};n._RF.pop(),n._RF.push({},"361eckT3VBO5ZFyetePNmNY","LevelGravity",void 0);var Qu="fall-down",Zu="fly-up",$u="push-left",ec="push-right",tc="put-column-middle",nc="put-row-middle";function ic(e){for(var t=e.array,n=e.isLighter,i=e.out,a=void 0===i?new Set:i,o=0;o<t.length;o++)if(n(t.get(o))){for(var r=o+1;r<t.length;r++)if(!n(t.get(r))){t.swap(o,r),a.add(t.get(o));break}}return a}n._RF.pop(),n._RF.push({},"cf506DevntPeIl9QrpMEBY0","Grid",void 0);var ac=function(){function e(t){var n;Ce(this,e),this.array=[];var i=null!=t?t:{},a=i.width,o=void 0===a?1:a,r=i.height,s=void 0===r?1:r,l=_instanceof(t,e)?t.array:null!==(n=null==t?void 0:t.content)&&void 0!==n?n:[];if(l.length!==o*s)throw new Error("Invalid content length");this.width=o,this.height=s,this.array=He(l)}return Ae(e,[{key:"asArray",value:function value(){return this.array}},{key:"get",value:function value(e,t){return this.array[t*this.width+e]}},{key:"set",value:function value(e,t,n){this.array[t*this.width+e]=n}},{key:"isInBounds",value:function value(e,t){return e>=0&&e<this.width&&t>=0&&t<this.height}},{key:"forEach",value:function value(e){for(var t=0;t<this.height;t++)for(var n=0;n<this.width;n++)e(this.get(n,t),n,t)}},{key:"map",value:function value(e){for(var t=[],n=0;n<this.height;n++)for(var i=0;i<this.width;i++)t.push(e(this.get(i,n),i,n));return t}},{key:"reduce",value:function value(e,t){for(var n=t,i=0;i<this.height;i++)for(var a=0;a<this.width;a++)n=e(n,this.get(a,i),a,i);return n}},{key:"swap",value:function value(e,t){var n=Ue(e,2),i=n[0],a=n[1],o=Ue(t,2),r=o[0],s=o[1],l=this.get(i,a);this.set(i,a,this.get(r,s)),this.set(r,s,l)}},{key:"shuffle",value:function value(e){for(var t,n=He(e=null!==(t=e)&&void 0!==t?t:this.map(function(e,t,n){return[t,n]})),i=new Set,a=n.length-1;a>0;a--){var o=ee(0,a+1),r=[n[o],n[a]];n[a]=r[0],n[o]=r[1],i.add(this.get(n[a][0],n[a][1])),i.add(this.get(n[o][0],n[o][1]))}for(var s=0;s<n.length;s++){var l=Ue(e[s],2),u=l[0],c=l[1],h=Ue(n[s],2),d=h[0],p=h[1];this.swap([u,c],[d,p])}return i}},{key:"toShuffled",value:function value(t){var n=new e({width:this.width,height:this.height,content:this.array}),i=n.shuffle(t);return[n,i]}},{key:"gravitate",value:function value(e){var t=this,n=Ue(e.rowRange,2),i=n[0],a=n[1],o=Ue(e.colRange,2),r=o[0],s=o[1],l=e.direction,u=e.isLighter,c=e.onSwap,h=e.out,d=void 0===h?new Set:h,p=s-r+1,y=a-i+1;switch(l){case Ju.Up:for(var f=function f(e){ic({array:{length:y,get:function get(n){return t.get(e,a-n)},swap:function swap(n,i){var o=t.get(e,a-n),r=t.get(e,a-i);t.swap([e,a-n],[e,a-i]),null==c||c(o,r)}},isLighter:u,out:d})},v=r;v<=s;v++)f(v);return d;case Ju.Down:for(var m=function m(e){ic({array:{length:y,get:function get(n){return t.get(e,i+n)},swap:function swap(n,a){var o=t.get(e,i+n),r=t.get(e,i+a);t.swap([e,i+n],[e,i+a]),null==c||c(o,r)}},isLighter:u,out:d})},g=r;g<=s;g++)m(g);return d;case Ju.Left:for(var b=function b(e){ic({array:{length:p,get:function get(n){return t.get(r+n,e)},swap:function swap(n,i){var a=t.get(r+n,e),o=t.get(r+i,e);t.swap([r+n,e],[r+i,e]),null==c||c(a,o)}},isLighter:u,out:d})},S=i;S<=a;S++)b(S);return d;case Ju.Right:for(var w=function w(e){ic({array:{length:p,get:function get(n){return t.get(s-n,e)},swap:function swap(n,i){var a=t.get(s-n,e),o=t.get(s-i,e);t.swap([s-n,e],[s-i,e]),null==c||c(a,o)}},isLighter:u,out:d})},k=i;k<=a;k++)w(k);return d;default:throw new Error("Invalid direction")}}},{key:"toGravitated",value:function value(){var t=new e({width:this.width,height:this.height,content:this.array}),n=t.gravitate.apply(t,arguments);return[t,n]}},{key:"toRotated",value:function value(){for(var t=new e({width:this.height,height:this.width,content:new Array(this.width*this.height)}),n=0;n<this.height;n++)for(var i=0;i<this.width;i++)t.set(this.height-1-n,i,this.get(i,n));return t}}]),e}();n._RF.pop(),n._RF.push({},"4046cPYak1BDIVFKksVPsnk","index",void 0),n._RF.pop(),n._RF.push({},"c517dy1TKlPd7mHxulLPv1G","TileSpecialTypes",void 0);var oc,rc,sc,lc,uc,cc,hc,dc,pc,yc,fc,vc,mc,gc,bc,Sc,wc,kc,Ec,Cc,Tc,Ac,Rc,Ic,Pc,_c={bomb:"bomb",star:"star",none:"none"};n._RF.pop(),n._RF.push({},"ea140gA27tJa4LD9MT3t93/","Tile",void 0);var Lc=i.ccclass,Oc=i.property,Dc=i.requireComponent,Nc=(oc=Lc("Tile"),rc=Dc([s]),sc=Dc([x]),lc=Oc(A),uc=Oc(A),cc=Oc(A),hc=Oc(a),dc=Oc({type:s,displayName:"Background's UI Transform"}),pc=Oc({type:x,displayName:"This UI Opacity"}),yc=Oc(x),fc=Oc(x),vc=Oc(Sa),mc=Oc(v),oc(gc=rc(gc=sc((Sc=Ye((bc=function(e){Ie(h,e);var t,n,i,a,o,r,s,l,u,c=xe(h);function h(){var _$e;Ce(this,h);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return je(_$e=c.call.apply(c,[this].concat(n)),"icon",Sc,Ne(_$e)),je(_$e,"bombComponent",wc,Ne(_$e)),je(_$e,"starComponent",kc,Ne(_$e)),je(_$e,"background",Ec,Ne(_$e)),je(_$e,"bgUITransform",Cc,Ne(_$e)),je(_$e,"uiOpacity",Tc,Ne(_$e)),je(_$e,"shineOpacity",Ac,Ne(_$e)),je(_$e,"glowOpacity",Rc,Ne(_$e)),je(_$e,"button",Ic,Ne(_$e)),je(_$e,"animationComponent",Pc,Ne(_$e)),_$e.id=null,_$e.isEmpty=!1,_$e.coord=new Q,_$e.restoreSignal=new Bn,_$e}return Ae(h,[{key:"onLoad",value:function value(){St.lazyValidateProperties(this),this.special=this.createSpecialHandler(_c.none)}},{key:"update",value:function value(e){var t;(null===(t=this.special)||void 0===t?void 0:t.type)===_c.bomb&&this.special.update(e)}},{key:"onDestroy",value:function value(){var _$e,t;(null===(_$e=this.special)||void 0===_$e?void 0:_$e.type)===_c.bomb&&(null===(t=this.special)||void 0===t||t.onDestroy())}},{key:"setIgnoreInput",value:function value(){var _$e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.button.interactable=!_$e}},{key:"getCoord",value:function value(){return this.coord}},{key:"setCoord",value:function value(e,t){this.coord.set(e,t)}},{key:"isSimilarTo",value:function value(e){return this.id===e.id}},{key:"inSamePositionAs",value:function value(e,t){return _instanceof(e,h)?this.coord.equals(e.getCoord()):this.coord.x===e&&this.coord.y===t}},{key:"isHidden",value:function value(){return this.isEmpty}},{key:"getSize",value:function value(){return[this.bgUITransform.width,this.bgUITransform.height]}},{key:"onClick",value:function value(){this.isHidden()||this.node.scene.emit(Co.TILE_CLICK,this)}},{key:"setIdentity",value:function value(e){this.id=e,this.icon.spriteFrame=e;var t=Ue(this.getSize(),2),n=t[0],i=t[1],a=e.originalSize,o=a.width,r=a.height,s=Math.max(o/(.7*n),r/(.7*i));s>1&&this.icon.node.setScale(new Y(1/s,1/s,1))}},{key:"setSpecialType",value:function value(){var _$e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:_c.none,n=arguments.length>1?arguments[1]:void 0;null===(_$e=this.special)||void 0===_$e||_$e.switch(t,n)}},{key:"setFocused",value:(u=Ee(function(e){var t,n,i;return _ts_generator(this,function(_state){switch(_state.label){case 0:t=k(this.shineOpacity).to(.2,{opacity:e?255:0},{easing:"quadIn"});this.shineOpacity.node.scale=e?Y.ZERO:Y.ONE;n=k(this.shineOpacity.node).to(.2,{scale:e?Y.ONE:Y.ZERO},{easing:"quadOut"});if(e){i=k(this.glowOpacity).to(2,{opacity:150});i.to(2,{opacity:20}),this.glowOpacityTween=k(this.glowOpacity).repeatForever(i).start()}else this.glowOpacityTween&&this.glowOpacityTween.stop(),this.glowOpacity.opacity=0;return[4,Promise.all([gn.runTweenAsync(t),gn.runTweenAsync(n)])];case 1:_state.sent();return[2]}})}),function(e){return u.apply(this,arguments)})},{key:"setEmpty",value:function value(){var _$e,t,n=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.isEmpty){var i;if(this.restoreSignal.abort(),this.isEmpty=!0,this.setIgnoreInput(!0),this.button.resetButtonState(),n)return this.uiOpacity.opacity=0,void(null===(i=this.special)||void 0===i||i.switch(_c.none));(null===(_$e=this.special)||void 0===_$e?void 0:_$e.type)===_c.star&&this.special.clear(),null===(t=this.special)||void 0===t||t.switch(_c.none),this.uiOpacity.opacity=0}}},{key:"setHint",value:(l=Ee(function(e){var t;return _ts_generator(this,function(_state){switch(_state.label){case 0:if(!e)return[3,2];return[4,this.loadShakeClip()];case 1:_state.sent(),this.shakeClip&&this.runAnimation(this.shakeClip.name);return[3,4];case 2:this.animationComponent.stop();t=k(this.background).to(.1,{scale:Y.ONE,eulerAngles:Y.ZERO});return[4,gn.runTweenAsync(t)];case 3:_state.sent();_state.label=4;case 4:return[2]}})}),function(e){return l.apply(this,arguments)})},{key:"playClearFX",value:(s=Ee(function(e){var t,_tmp,_tmp1;return _ts_generator(this,function(_state){switch(_state.label){case 0:t=null;if(!("clear"===e))return[3,2];return[4,this.loadClearClip()];case 1:_tmp=(_state.sent(),t=this.clearClip);return[3,4];case 2:return[4,this.loadBreakClip()];case 3:_tmp=(_state.sent(),t=this.breakClip);_state.label=4;case 4:_tmp;_tmp1=null!==t;if(!_tmp1)return[3,6];return[4,this.runAnimation(t.name)];case 5:_tmp1=_state.sent();_state.label=6;case 6:_tmp1;return[2]}})}),function(e){return s.apply(this,arguments)})},{key:"restore",value:(r=Ee(function(e){return _ts_generator(this,function(_state){switch(_state.label){case 0:this.restoreSignal.abort(),this.restoreSignal=new Bn,this.isEmpty=!1,this.setIgnoreInput(!0),e&&this.setIdentity(e),this.uiOpacity.opacity=255,this.node.setScale(Y.ZERO),this.button.fakeClick();return[4,gn.runTweenAsync(k(this.node).to(.3,{scale:Y.ONE},{easing:"backOut"}),this.restoreSignal)];case 1:_state.sent(),this.node.setScale(Y.ONE),this.setIgnoreInput(!1);return[2]}})}),function(e){return r.apply(this,arguments)})},{key:"sync",value:(o=Ee(function(e){var t,n,i,a,o,r,s,l;return _ts_generator(this,function(_state){switch(_state.label){case 0:t=e.duration,n=void 0===t?.3:t,i=e.delay,a=void 0===i?0:i,o=e.easing,r=void 0===o?"cubicOut":o,s=(0,e.getTargetPosition)(this.coord),l=new Y(s.x,s.y,this.node.position.z);return[4,gn.runTweenAsync(k(this.node).delay(a).to(n,{position:l},{easing:r}))];case 1:_state.sent();return[2]}})}),function(e){return o.apply(this,arguments)})},{key:"fly",value:(a=Ee(function(e){var t,n,i,a,o,r,s,l,u,c,_$h,d,p,y,f,v,m,g;return _ts_generator(this,function(_state){t=this,n=300,i=Math.sqrt(Math.pow(this.node.position.x,2)+Math.pow(this.node.position.y,2)),a=Math.max(n-.7*i,0),o=i/1e3,r=this.node.position.clone(),s=e.getTilePosition(this.coord),l=new Y(s.x,s.y,this.node.position.z),u=this.background,c=2,_$h=1,d=360,p=.0025*a,y=0,f=new Y(0,0,0),v=.75-p,m={value:0,prevElapsed:0},g=k(m);return[2,(g.delay(o),g.to(.5,{value:0},{progress:function progress(e,n,i,a){var o=(c*=-1)*a,s=r.clone();return s.x+=o,t.node.setPosition(s),i}}),g.to(p,{value:1},{progress:function progress(e,i,o,r){var s=gn.easeOutExpo(r),l=p*r-m.prevElapsed,c=p*r,y=a*s;t.setHeight(y,n);var f=t.node.position.clone();_$h+=.1,Y.rotateZ(f,f,new Y(0,0,0),_$h*Math.PI*l),t.node.setPosition(new Y(f.x,f.y,f.z));var v=(d+=10)*l;return u.angle+=v,m.prevElapsed=c,o}}),g.call(function(){f.set((t.node.position.x+l.x)/2,(t.node.position.y+l.y)/2,0),m.prevElapsed=0,u.angle%=360,u.angle-=360,y=u.angle}),g.to(v,{value:0},{progress:function progress(e,i,o,r){var s=v*r-m.prevElapsed,l=v*r,c=a*(1-r);t.setHeight(c,n);var _$h=t.node.position.clone();return Y.rotateZ(_$h,_$h,f,Math.PI/v*s),t.node.setPosition(new Y(_$h.x,_$h.y,_$h.z)),u.angle+=-y/v*s,m.prevElapsed=l,o}}),g.call(function(){t.node.setPosition(l),t.setHeight(0,n),u.angle=0}),gn.runTweenAsync(g))]})}),function(e){return a.apply(this,arguments)})},{key:"loadBreakClip",value:(i=Ee(function(){var _$e;return _ts_generator(this,function(_state){switch(_state.label){case 0:if(this.breakClip)return[2,Promise.resolve()];return[4,li.loadAnimClipAsync(Fn.TILE_BREAK_ANIM)];case 1:_$e=_state.sent();if(!_$e)return[2,Promise.resolve()];this.breakClip=_$e,this.animationComponent.addClip(this.breakClip);return[2]}})}),function(){return i.apply(this,arguments)})},{key:"loadClearClip",value:(n=Ee(function(){var _$e;return _ts_generator(this,function(_state){switch(_state.label){case 0:if(this.clearClip)return[2,Promise.resolve()];return[4,li.loadAnimClipAsync(Fn.TILE_CLEAR_ANIM)];case 1:_$e=_state.sent();if(!_$e)return[2,Promise.resolve()];this.clearClip=_$e,this.animationComponent.addClip(this.clearClip);return[2]}})}),function(){return n.apply(this,arguments)})},{key:"loadShakeClip",value:(t=Ee(function(){var _$e;return _ts_generator(this,function(_state){switch(_state.label){case 0:if(this.shakeClip)return[2,Promise.resolve()];return[4,li.loadAnimClipAsync(Fn.TILE_SHAKE_ANIM)];case 1:_$e=_state.sent();if(!_$e)return[2,Promise.resolve()];this.shakeClip=_$e,this.animationComponent.addClip(this.shakeClip);return[2]}})}),function(){return t.apply(this,arguments)})},{key:"runAnimation",value:function value(e){var t=this;return this.animationComponent.play(e),new Promise(function(e){t.animationComponent.once(v.EventType.FINISHED,function(){e()})})}},{key:"setHeight",value:function value(e,t){var n=this.background;n.setPosition(new Y(n.position.x,e,0)),n.setScale(new Y(1+e/t*.3,1+e/t*.3,1))}},{key:"createSpecialHandler",value:function value(e,t){var n=this;switch(e){case _c.bomb:return this.createBombHandler(null!=t?t:90);case _c.star:return this.createStarHandler();default:return{type:_c.none,switch:function _switch(e,t){n.special=n.createSpecialHandler(e,t)}}}}},{key:"createBombHandler",value:function value(e){var t=this,n=!1,i=e,a=function a(){n=!0},o=function o(){n=!1};this.node.scene.on(Co.TILE_CLICK,a),this.node.scene.on(Co.USE_ITEM,a),this.node.scene.on(Co.RESUME_TIME,a),this.node.scene.on(Co.PAUSE_TIME,o),this.node.scene.on(Co.TIME_OUT,o),this.bombComponent.node.active=!0;var r=function r(){n=!1,t.bombComponent.node.active=!1,i=e,t.node.scene.off(Co.TILE_CLICK,a),t.node.scene.off(Co.USE_ITEM,a),t.node.scene.off(Co.GAME_RESUME,a),t.node.scene.off(Co.GAME_PAUSE,o),t.node.scene.off(Co.TIME_OUT,o)};return{type:_c.bomb,update:function update(a){n&&(i-=a,t.bombComponent.fillRange=-i/e,i<=0&&(n=!1,t.bombComponent.node.active=!1,t.node.scene.emit(Co.BOMB_EXPLODE,t),t.setEmpty()))},cleanup:r,onDestroy:function onDestroy(){t.node.scene.off(Co.TILE_CLICK,a),t.node.scene.off(Co.USE_ITEM,a),t.node.scene.off(Co.GAME_RESUME,a),t.node.scene.off(Co.GAME_PAUSE,o),t.node.scene.off(Co.TIME_OUT,o)},switch:function _switch(e,n){r(),t.special=t.createSpecialHandler(e,n)},detonateImmediately:function detonateImmediately(){i=0}}}},{key:"createStarHandler",value:function value(){var _$e=this;this.starComponent.node.active=!0;var t=function t(){_$e.starComponent.node.active=!1};return{type:_c.star,clear:function clear(){_$e.starComponent.node.active=!1;var t=_$e.node.worldPosition,n=t.x,i=t.y;_$e.node.scene.emit(Co.ADD_STARS,{startAnimationAt:[n,i]})},cleanup:t,switch:function _switch(n){t(),_$e.special=_$e.createSpecialHandler(n)}}}}]),h}(y)).prototype,"icon",[lc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wc=Ye(bc.prototype,"bombComponent",[uc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),kc=Ye(bc.prototype,"starComponent",[cc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ec=Ye(bc.prototype,"background",[hc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Cc=Ye(bc.prototype,"bgUITransform",[dc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Tc=Ye(bc.prototype,"uiOpacity",[pc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ac=Ye(bc.prototype,"shineOpacity",[yc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Rc=Ye(bc.prototype,"glowOpacity",[fc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ic=Ye(bc.prototype,"button",[vc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Pc=Ye(bc.prototype,"animationComponent",[mc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),gc=bc))||gc)||gc)||gc);function Mc(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a=n.x,o=n.y,r=Ue(t,2),s=r[0],l=r[1],u=s*(a-(e.width-1)/2)+i*(a-e.width/2),c=l*(o-(e.height-1)/2)+i*(o-e.height/2);return-1===a&&(u+=t[0]/4),a===e.width&&(u-=t[0]/4),-1===o&&(c+=t[1]/4),o===e.height&&(c-=t[1]/4),{x:u,y:c}}function xc(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0],n=Ue(e,2),i=n[0],a=n[1],o=Ue(t,2),r=o[0],s=o[1],l=1-r,u=1-s,c=i*l,h=a*u;return[c,h]}function Bc(e){for(var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=e.split("-"),i=[],a=0;a<n.length;){var o=null,r=n[a];switch(r){case"normal":a+=1;break;case"fall":o=Qu,a+=2;break;case"fly":o=Zu,a+=2;break;case"push":"left"===n[a+1]?(o=$u,a+=2):(o=ec,a+=2);break;case"put":"columns"===n[a+1]?(o=tc,a+=3):(o=nc,a+=3)}o&&(t&&(o=Fc(o)),i.push(o))}return i}function Fc(e){switch(e){case Qu:return ec;case Zu:return $u;case $u:return Qu;case ec:return Zu;case tc:return nc;case nc:return tc}}function zc(e){return(_instanceof(e,ac)?e.asArray():e).filter(function(e){return!e.isHidden()})}function Gc(e){return(_instanceof(e,ac)?e.asArray():e).filter(function(e){return e.isHidden()})}n._RF.pop(),n._RF.push({},"d6995j9hvVJYKs6vvV+rs1I","index",void 0),n._RF.pop(),n._RF.push({},"cb8ddC2w59DpqVoQENbYYcU","calcBoardScale",void 0),n._RF.pop(),n._RF.push({},"305c7LJx+ROLI4g8tTiAFyb","calcTilePosition",void 0),n._RF.pop(),n._RF.push({},"c522ca1UPhDYaToWf66t1X2","calcTileSize",void 0),n._RF.pop(),n._RF.push({},"37667B66RZBc5chlMqN6mH8","parseLevelGravity",void 0),n._RF.pop(),n._RF.push({},"f0f0bXgdxJHIJWOmA6n0Ood","getUncleared",void 0),n._RF.pop(),n._RF.push({},"a90bcq22hlMzbYdivjPpm0h","getBombTiles",void 0),n._RF.pop(),n._RF.push({},"92e23drVfRIgbDVZLTSdEkI","getCleared",void 0),n._RF.pop(),n._RF.push({},"7105bfR+Y5F1a0SDiMXZ9mV","getNearbyTiles",void 0);var Uc=GameCore.Utils.Object;function Hc(e,t){var n=t.getCoord(),i=n.x,a=n.y;return Uc.vals(Ju).reduce(function(t,n){var o=n.x,r=n.y,s=i+o,l=a+r;return e.isInBounds(s,l)&&t.push(e.get(s,l)),t},[])}function Vc(e){return Array.isArray(e)}function qc(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Date.now(),n=Vc(e)?e:e.asArray();return n[te(t,0,n.length)]}n._RF.pop(),n._RF.push({},"d1b9bBg+dBA+7n/Sz+RCIAX","getRandomTile",void 0),n._RF.pop(),n._RF.push({},"c4bf3uyS1pEdrTrwDEXeuZP","getRandomPair",void 0);var Wc=GameCore.Utils.Array;function Kc(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Date.now(),n=_instanceof(e,ac)?e.asArray():e,i=qc(n,t),a=Wc.search(n,function(e){return e.isSimilarTo(i)&&!e.inSamePositionAs(i)});if(void 0===a)throw new Error("Could not find a matching tile");return[i,a]}n._RF.pop(),n._RF.push({},"cf8d6gfx2ZIsqm978cNLWaV","pseudoRandomIterable",void 0);var jc=function jc(e){return e};function Yc(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:jc;return function(){var i,a;return _ts_generator(this,function(_state){switch(_state.label){case 0:i=t;e<=0&&(e=1/0);a=0;_state.label=1;case 1:if(!(a<e))return[3,4];return[4,n(i)];case 2:_state.sent(),i=1e9*ne(i);_state.label=3;case 3:a++;return[3,1];case 4:return[2]}})}()}function Xc(e){return Array.isArray(e)}function Jc(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Date.now(),i=Xc(e)?e:e.asArray();if(i.length<t)return new Set(i);for(var a=new Set,o=Yc(-1,n),r=o.next();a.size<t;){if(r.done)throw new Error("RNG exhausted");a.add(qc(i,r.value)),r=o.next()}return a}n._RF.pop(),n._RF.push({},"718b6Wu0pdGVK5KYSUDctVX","getRandomTiles",void 0),n._RF.pop(),n._RF.push({},"17ccarKybRNwYcZnBQhCUYy","index",void 0),n._RF.pop(),n._RF.push({},"bab6dqrPz9AaaBN5cy+QzPj","assignSpecialTiles",void 0);var Qc=[1,4];function Zc(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Date.now(),i=t.specials,a=i.bomb,o=te.apply(void 0,[n].concat(Qc)),r=Jc(e,a,n),s=e.asArray().filter(function(e){return!r.has(e)}),l=Jc(s,o,n);r.forEach(function(e){var n=2*t.time/3;e.setSpecialType(_c.bomb,n)}),l.forEach(function(e){return e.setSpecialType(_c.star)})}n._RF.pop(),n._RF.push({},"228efPdzUNCMp4yYcBs9r+3","index",void 0),n._RF.pop(),n._RF.push({},"09be7lmGLNMvIObiqskePhz","createGrid",void 0);var $c=GameCore.Utils.Array;function eh(e){var t=e.levelData,n=t.columns,i=t.rows,a=e.identities,o=e.createTile,r=e.seed,s=(function(e,t,n){var i,a=[],o=We(Yc(t/2,e,function(e){return te(e,0,n.length)}));try{for(o.s();!(i=o.n()).done;){var r=i.value;a.push(n[r]),a.push(n[r])}}catch(e){o.e(e)}finally{o.f()}return $c.shuffle(a),a})(void 0===r?Date.now():r,n*i,a).map(function(e){var t=o(e);return t.setIdentity(e),t});return new ac({width:n,height:i,content:s})}n._RF.pop(),n._RF.push({},"5d998xlab9FLIpvw+sXMIYw","createGridFromFen",void 0);var th=GameCore.Utils.Array;function nh(e){var t=e.customFen,n=e.identities,i=e.createTile,a=t.idSize,o=t.cols,r=t.rows,s=t.code;if(n.length<t.idSize)throw new Error("Invalid grid code. There are not enough identities/frames ".concat(n.length," to fill it according to fen code ").concat(a));var l=s.split(":");if(l.length!==r)throw new Error("Invalid grid code");var u=/[a-zA-Z]+\d+|./g,c=/[a-zA-Z]+/,h=/\d+/,d=l.reduceRight(function(e,a){var o,r=[],s=We(a.matchAll(u));try{for(s.s();!(o=s.n()).done;){var l,d,p=o.value[0],y=null===(l=h.exec(p))||void 0===l?void 0:l[0],f=void 0!==y?parseInt(y,10):void 0,v=void 0!==f&&!isNaN(f)&&f<n.length?n[f]:void 0,m=i(void 0!==v?v:n[0]),g=null===(d=c.exec(p))||void 0===d?void 0:d[0],b=void 0!==g?ih(g,t.encoding):void 0;b&&v?m.setSpecialType(b):m.setEmpty(),r.push(m)}}catch(e){s.e(e)}finally{s.f()}return e.concat(r)},[]);return new ac({width:o,height:r,content:d})}function ih(e,t){var n=th.search(Object.entries(t),function(t){var n=Ue(t,2);n[0];return n[1]===e});if(void 0===n)throw new Error("Invalid special type ".concat(e));return n[0]}n._RF.pop(),n._RF.push({},"30de5d+cW5OjKyEubKVREbU","createRotatedGrid",void 0),n._RF.pop(),n._RF.push({},"9ceb6vNbn9PKozkdGjjZD67","ensureOneMatch",void 0);var ah=GameCore.Utils.Array;function oh(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Date.now(),n=e.asArray(),i=qc(e,t),a=Hc(e,i);if(!a.some(function(e){return e.isSimilarTo(i)})){var o=qc(a,t),r=ah.search(n,function(e){return!e.inSamePositionAs(i)&&!e.inSamePositionAs(o)&&e.isSimilarTo(o)});r.setIdentity(i.id),o.setIdentity(i.id)}}n._RF.pop(),n._RF.push({},"89318H0TDxMlJsVFwuKgrh3","index",void 0),n._RF.pop(),n._RF.push({},"fb4a9VOCxBBvpXFCcSt4P3J","NewbieSteps",void 0);var rh=[{startTile:{x:0,y:1},endTile:{x:3,y:1},description:"Tap to connect"},{startTile:{x:2,y:2},endTile:{x:3,y:0},description:"Connect similar tiles with less than 2 turns"},{startTile:{x:0,y:0},endTile:{x:3,y:3},description:"Connect similar tiles with less than 2 turns"},{startTile:{x:0,y:4},endTile:{x:2,y:3},description:"More than 2 turns are NOT allowed"},{startTile:{x:1,y:4},endTile:{x:1,y:2},description:"There's obstacle between the tiles"}];n._RF.pop(),n._RF.push({},"627d5N3oStP8q9+ABNqnHBq","getBestPath",void 0);var sh=GameCore.Utils.Array;function lh(e,t){return e[0]===t[0]&&e[1]===t[1]}function uh(e){return new Q(e[0],e[1])}function ch(e,t){return e.x>=-1&&e.x<t.width+1&&e.y>=-1&&e.y<t.height+1}function hh(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:ph;return t.map(function(t){return[e.tile[0]+t.x,e.tile[1]+t.y]})}var dh,ph=[Ju.Up,Ju.Down,Ju.Left,Ju.Right],yh=function(){function e(t,n){var i;if(Ce(this,e),this.f=0,this.g=0,this.h=0,n&&lh(t,n.tile))throw new Error("Tile cannot be its own parent");this.tile=t,this.parent=n;var a=e.calcDirection(this),o=n&&a&&n.cache.direction&&!a.equals(n.cache.direction)?1:0;this.cache={direction:a,turns:o+(null!==(i=null==n?void 0:n.cache.turns)&&void 0!==i?i:0)}}return Ae(e,[{key:"getKey",value:function value(){var _$e;return"x:".concat(this.tile[0],",y:").concat(this.tile[1],",d:").concat(null===(_$e=this.cache.direction)||void 0===_$e?void 0:_$e.toString())}},{key:"equals",value:function value(e){return this.getKey()===e.getKey()}}],[{key:"calcDirection",value:function value(e){if(e.parent){var t=e.parent.tile,n=e.tile;return new Q(n[0]-t[0],n[1]-t[1])}return null}}]),e}();function fh(e,t){var n=e.tile,i=t.tile;return Math.abs(n[0]-i[0])+Math.abs(n[1]-i[1])}function vh(e,t){var n,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],a=[],o=We(ph);try{var r=function r(){var o=n.value,r={x:t[0]+o.x,y:t[1]+o.y};if(e.isInBounds(r.x,r.y))return(e.get(r.x,r.y).isHidden()||sh.search(i,function(e){return lh(e,[r.x,r.y])}))&&a.push(o),1;ch(r,e)&&a.push(o)};for(o.s();!(n=o.n()).done;)r()}catch(e){o.e(e)}finally{o.f()}return a}function mh(e,t,n,i){if(i){var a=rh[4].startTile,o=rh[4].endTile;if(t[0]===a.x&&t[1]===a.y&&n[0]===o.x&&n[1]===o.y)return[{a:a,b:o}];if(t[0]===o.x&&t[1]===o.y&&n[0]===a.x&&n[1]===a.y)return[{a:a,b:o}]}return function(e,t,n){var _$i=[],a=[],o=new yh(t,null),r=new yh(n,null),s=[r.tile];for(_$i.push(o);_$i.length>0;){var l=_$i.shift();if(a.push(l),lh(l.tile,r.tile)){for(var u=[],c=l,h=l,d=l.parent;d;)d.cache.turns!==h.cache.turns&&(u.unshift({a:uh(d.tile),b:uh(c.tile)}),c=d),h=d,d=d.parent;return u.unshift({a:uh(h.tile),b:uh(c.tile)}),u}var p,y=We(hh(l,vh(e,l.tile,s)));try{var f=function f(){var _$e=p.value,_$t=new yh(_$e,l);if(_$t.cache.turns>8)return 0;var _$n=lh(_$t.tile,r.tile),o=a.some(function(e){return e.equals(_$t)});if(_$i.some(function(e){return e.equals(_$t)})||o&&!_$n)return 0;_$t.g=l.g+1+_$t.cache.turns,_$t.h=fh(_$t,r),_$t.f=_$t.g+_$t.h,_$i.push(_$t)};for(y.s();!(p=y.n()).done;)f()}catch(e){y.e(e)}finally{y.f()}_$i.sort(function(e,t){return e.f-t.f})}var v=o.tile,m=r.tile;return v[0]===m[0]||v[1]===m[1]?[{a:uh(v),b:uh(m)}]:[{a:uh(v),b:{x:v[0],y:m[1]}},{a:{x:v[0],y:m[1]},b:uh(m)}]}(e,t,n)}n._RF.pop(),n._RF.push({},"b622ea7Aw5LT5yfRAx8qSap","getErrorPath",void 0),n._RF.pop(),n._RF.push({},"716f6/ILpZCPp1nebbdk8Oj","getGridFen",void 0);var gh=(Re(dh={},_c.bomb,"b"),Re(dh,_c.star,"s"),Re(dh,_c.none,"t"),dh);function bh(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:gh,n=e.width,i=e.height,a=[],o=new Map,r=i-1;r>=0;r--){for(var s=[],l=0;l<n;l++){var u,c,h=e.get(l,r),d=h.isHidden()?null:h.id;if(null!==d){var p=null!==(u=null===(c=h.special)||void 0===c?void 0:c.type)&&void 0!==u?u:_c.none,y=t[p];if(!o.has(d)){var f=o.size.toString();o.set(d,f)}var v="".concat(y).concat(o.get(d));s.push(v)}else s.push(".")}a.push(s.join(""))}return{code:a.join(":"),idSize:o.size,encoding:t,rows:i,cols:n}}function Sh(e){return e.reduce(function(e,t,n,i){return t.inSamePositionAs(n,i)||e.push([t,[n,i]]),e},[])}function wh(e,t){var n,i,a,o,r,s,l,u;return _ts_generator(this,function(_state){switch(_state.label){case 0:n=0,i=e-1,a=0,o=t-1;_state.label=1;case 1:if(!(n<=i&&a<=o))return[3,19];r=n;_state.label=2;case 2:if(!(r<=i))return[3,5];return[4,{x:r,y:a}];case 3:_state.sent();_state.label=4;case 4:r++;return[3,2];case 5:s=++a;_state.label=6;case 6:if(!(s<=o))return[3,9];return[4,{x:i,y:s}];case 7:_state.sent();_state.label=8;case 8:s++;return[3,6];case 9:l=--i;_state.label=10;case 10:if(!(l>=n))return[3,13];return[4,{x:l,y:o}];case 11:_state.sent();_state.label=12;case 12:l--;return[3,10];case 13:u=--o;_state.label=14;case 14:if(!(u>=a))return[3,17];return[4,{x:n,y:u}];case 15:_state.sent();_state.label=16;case 16:u--;return[3,14];case 17:n++;_state.label=18;case 18:return[3,1];case 19:return[2]}})}n._RF.pop(),n._RF.push({},"badfeEqwgFEorJVHO9tJSXZ","getOutOfSync",void 0),n._RF.pop(),n._RF.push({},"cd0d548/WxD7KCyW2hwySVO","traverseSpiralIn",void 0),n._RF.pop(),n._RF.push({},"373ceVkYCtMTrQObvzJgg7s","getValidPath",void 0);var kh,Eh,Ch,Th,Ah,Rh,Ih,Ph,_h,Lh,Oh=GameCore.Utils.Array,Dh=function(){function e(t,n){Ce(this,e),this.coord=new Q(t,n)}return Ae(e,[{key:"isHidden",value:function value(){return!0}},{key:"isSimilarTo",value:function value(){return!1}}]),e}();function Nh(e){return new Q(e[0],e[1])}function Mh(e,t,n){if(void 0===t||void 0===n)return function(e){var _$t,_$n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:wh,i=[],a=We(_$n(e.width,e.height));try{for(a.s();!(_$t=a.n()).done;){var o=_$t.value,r=e.get(o.x,o.y);r.isHidden()||i.push([r,[o.x,o.y]])}}catch(e){a.e(e)}finally{a.f()}var s,l=[],u=function u(){var _$t=Ue(i.shift(),2),_$n=_$t[0],a=_$t[1];if(Oh.search(l,function(e){return Fh(e,a)}))return 0;l.push(a);for(var o,r=function r(){var _$t=Ue(u[s],2),i=_$t[0],o=_$t[1];if(!i.isSimilarTo(_$n)||Oh.search(l,function(e){return Fh(e,o)}))return 0;var r=Mh(e,a,o);return null!==r?{v:{v:r}}:void 0},s=0,u=i;s<u.length;s++)if(0!==(o=r())&&o)return o.v};for(;i.length>0;)if(0!==(s=u())&&s)return s.v;return null}(e);var i,a=[t[0]+1,t[1]+1],o=[n[0]+1,n[1]+1],r=function(e){var _$t=Oh.fillWith(e.width+2,function(e){return new Dh(e-1,-1)}),_$n=Oh.fillWith(e.width+2,function(t){return new Dh(t-1,e.height)}),i=Oh.fillWith(e.height,function(e){return new Dh(-1,e)}),a=Oh.fillWith(e.height,function(t){return new Dh(e.width,t)}),o=function o(o,r){var s=o-1,l=r-1;return-1===s?i[l]:s===e.width?a[l]:-1===l?_$t[s]:l===e.height?_$n[s]:e.get(s,l)};return{get:function get(e,t){return o(e,t)},width:e.width+2,height:e.height+2}}(e),s=[a,o];if(a[0]===o[0]&&Gh(r,s,a[1],o[1],a[0])||a[1]===o[1]&&Uh(r,s,a[0],o[0],a[1]))return qh([{a:Nh(a),b:Nh(o)}],{x:-1,y:-1});var l=a[1]<=o[1]?a:o,u=a[1]<=o[1]?o:a,c=a[0]<=o[0]?a:o,h=a[0]<=o[0]?o:a,d=[],p=[];return-1===(i=Hh(r,s,1,Nh(l),Nh(u)))&&-1===(i=Hh(r,s,-1,Nh(l),Nh(u)))||(d=[{a:Nh(a),b:{x:a[0],y:i}},{a:{x:a[0],y:i},b:{x:o[0],y:i}},{a:{x:o[0],y:i},b:Nh(o)}]),-1===(i=Vh(r,s,1,Nh(c),Nh(h)))&&-1===(i=Vh(r,s,-1,Nh(c),Nh(h)))||(d=[{a:Nh(a),b:{x:i,y:a[1]}},{a:{x:i,y:a[1]},b:{x:i,y:o[1]}},{a:{x:i,y:o[1]},b:Nh(o)}]),-1!==(i=function(e,t,n,i){for(var a=n.y+1;a<i.y;a++)if(Gh(e,t,n.y,a,n.x)&&Uh(e,t,n.x,i.x,a)&&Gh(e,t,a,i.y,i.x))return a;return-1}(r,s,Nh(l),Nh(u)))?p=[{a:Nh(a),b:{x:a[0],y:i}},{a:{x:a[0],y:i},b:{x:o[0],y:i}},{a:{x:o[0],y:i},b:Nh(o)}]:-1!==(i=function(e,t,n,i){for(var a=n.x+1;a<i.x;a++)if(Uh(e,t,n.x,a,n.y)&&Gh(e,t,n.y,i.y,a)&&Uh(e,t,a,i.x,i.y))return a;return-1}(r,s,Nh(c),Nh(h)))&&(p=[{a:Nh(a),b:{x:i,y:a[1]}},{a:{x:i,y:a[1]},b:{x:i,y:o[1]}},{a:{x:i,y:o[1]},b:Nh(o)}]),d.length>0&&p.length>0?qh(xh(d)<=xh(p)?d:p,{x:-1,y:-1}):d.length>0?qh(d,{x:-1,y:-1}):p.length>0?qh(p,{x:-1,y:-1}):null}function xh(e){var t,n=0,i=We(e);try{for(i.s();!(t=i.n()).done;){n+=Bh(t.value)}}catch(e){i.e(e)}finally{i.f()}return n}function Bh(e){return e.a.x===e.b.x?Math.abs(e.a.y-e.b.y):e.a.y===e.b.y?Math.abs(e.a.x-e.b.x):0}function Fh(e,t){return e[0]===t[0]&&e[1]===t[1]}function zh(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],i=e.get.apply(e,He(t));return i.isHidden()||n.some(function(e){return Fh(e,t)})}function Gh(e,t,n,i,a){for(var o=Math.min(n,i),r=Math.max(n,i),s=o;s<=r;s++)if(!zh(e,[a,s],t))return!1;return!0}function Uh(e,t,n,i,a){for(var o=Math.min(n,i),r=Math.max(n,i),s=o;s<=r;s++)if(!zh(e,[s,a],t))return!1;return!0}function Hh(e,t,n,i,a){var o=1===n?a.y:i.y,r=1===n?i.x:a.x;if(Gh(e,t,i.y,a.y,r))for(;o>=0&&o<e.height&&zh(e,[i.x,o],t)&&zh(e,[a.x,o],t);){if(Uh(e,t,i.x,a.x,o))return o;o+=n}return-1}function Vh(e,t,n,i,a){var o=1===n?a.x:i.x,r=1===n?i.y:a.y;if(Uh(e,t,i.x,a.x,r))for(;o>=0&&o<e.width&&zh(e,[o,i.y],t)&&zh(e,[o,a.y],t);){if(Gh(e,t,i.y,a.y,o))return o;o+=n}return-1}function qh(e,t){return e.map(function(e){return{a:{x:e.a.x+t.x,y:e.a.y+t.y},b:{x:e.b.x+t.x,y:e.b.y+t.y}}})}n._RF.pop(),n._RF.push({},"0cceagmIDZNoZTxP8hBPplh","Board",void 0);var Wh,Kh=i.ccclass,jh=i.property,Yh=i.requireComponent,Xh=globalThis.game.monitorError,Jh=GameCore.Utils.Array,Qh=(kh=Kh("Board"),Eh=Yh(s),Ch=jh(Nc),Th=jh(a),Ah=jh({displayName:"Tile Spacing",group:"Create config"}),kh(Rh=Eh((Ph=Ye((Ih=function(e){Ie(a,e);var t,n,i=xe(a);function a(){var _$e;Ce(this,a);for(var t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];return je(_$e=i.call.apply(i,[this].concat(n)),"tilePrefab",Ph,Ne(_$e)),je(_$e,"tilesHolder",_h,Ne(_$e)),je(_$e,"tileTrim",Lh,Ne(_$e)),_$e.tileSize=[0,0],_$e.selectedTile=null,_$e.layoutType="portrait",_$e.parsedGravityRules=[],_$e.normalMatches=0,_$e.normalMatchesSinceLastSpawn=0,_$e.spawnAttempts=0,_$e.hintPath=null,_$e.hintTiles=null,_$e.animationQueue=[],_$e.isConsumingAnimation=!1,_$e.handleViewResized=function(){_$e.updateTilesHolderScale()},_$e.onLayoutChanged=function(t){_$e.layoutType=t},_$e}return Ae(a,[{key:"onLoad",value:function value(){this.uiTransform=this.getComponent(s),St.lazyValidateProperties(this),this.tilePrefab.node.active=!1,this.listenLayoutevents()}},{key:"onDestroy",value:function value(){this.unlistenLayoutevents()}},{key:"create",value:function value(e,t){var n=this,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Date.now(),_$a=He(e);Jh.shuffle(_$a),e=_$a.slice(0,t.colors),this.levelData=t,this.parsedGravityRules=Bc(t.mode,this.layoutType===za.Landscape);var o=function o(e){var _$t=l(n.tilePrefab.node),i=_$t.getComponent(Nc);return i.setIdentity(e),n.tilesHolder.addChild(_$t),_$t.active=!0,i},r=!1;if(void 0!==t.customFen)try{r=!0,this.grid=nh({customFen:t.customFen,identities:e,createTile:o}),this.grid.forEach(function(e,t,n){e.setCoord(t,n),e.setIgnoreInput(!1),e.node.setSiblingIndex(0)})}catch(e){console.error("Error creating grid from custom fen",e,"falling back to random grid"),r=!1}r||(this.grid=eh({levelData:t,seed:i,identities:e,createTile:o}),this.grid.forEach(function(e,t,n){e.setCoord(t,n),e.setIgnoreInput(!1),e.node.setSiblingIndex(0)}),oh(this.grid,i),Zc(this.grid,t,i)),this.handleBoardLayout();var s=[this.tileTrim.x,this.tileTrim.y];this.tileSize=xc(this.tilePrefab.getSize(),s),this.updateTilesHolderScale(),this.node.scene.emit(Co.GRID_CREATE,this),this.selectedTile=null,this.animationQueue=[],this.normalMatches=0,this.normalMatchesSinceLastSpawn=0,this.spawnAttempts=0,this.hintPath=null,this.processGameplayCycle()}},{key:"updateTilesHolderScale",value:function value(){if(this.grid){var _$e=[this.grid.width,this.grid.height],t=[this.uiTransform.width,this.uiTransform.height],n=function(e,t,n){var i=Ue(e,2),_$a=i[0],o=i[1],r=Ue(t,2),s=r[0],l=r[1],u=Ue(n,2),c=u[0]/(_$a*s),h=u[1]/(o*l);return Math.min(c,h)}(_$e,this.tilePrefab.getSize(),t);this.tilesHolder.setScale(n,n),this.node.scene.emit(Co.GRID_RESIZE,n)}}},{key:"handleBoardLayout",value:function value(){var _$e,t;this.layoutType===za.Landscape&&0!==this.levelData.level&&(this.grid=(_$e=this.grid,(t=_$e.toRotated()).forEach(function(e,t,n){e.setCoord(t,n)}),t))}},{key:"destroyTiles",value:function value(){var _$e;null===(_$e=this.grid)||void 0===_$e||_$e.forEach(function(e){return e.node.destroy()})}},{key:"animateTilesAppear",value:function value(){var _$e=this;return new Promise(function(t){var n=function(){var n=Ee(function(){return _ts_generator(this,function(_state){switch(_state.label){case 0:return[4,Promise.all(_$e.grid.map(function(t,n,i){var _$a=ie(0,.5),o=t.node.scale.clone(),r=function(t,n){var _$i=Q.ZERO.clone();return _$e.parsedGravityRules.forEach(function(a){var o=_$e.getPrimitiveDirection(t,n,a);_$i.subtract2f(o.x,o.y)}),_$i.normalize()}(n,i),s=Mc(_$e.grid,_$e.tileSize,{x:n,y:i}),l=r.multiplyScalar(100).add2f(s.x,s.y);return t.node.setPosition(l.x,l.y),t.node.setScale(0,0),Promise.all([gn.runTweenAsync(k(t.node).delay(_$a).to(.5,{scale:o},{easing:"elasticOut"})),t.sync({getTargetPosition:function getTargetPosition(t){return Mc(_$e.grid,_$e.tileSize,t)},easing:"backOut",duration:.5,delay:_$a})])}))];case 1:_state.sent(),t();return[2]}})});return function(){return n.apply(this,arguments)}}();_$e.animationQueue.push(n),_$e.consumeAnimationQueue()})}},{key:"handleTileClick",value:function value(e){if(!e.isHidden()){if(this.selectedTile===e)return this.selectedTile=null,void e.setFocused(!1);if(!this.selectedTile)return this.selectedTile=e,void e.setFocused(!0);if(!this.selectedTile.isSimilarTo(e))return this.selectedTile.setFocused(!1),this.selectedTile=e,void e.setFocused(!0);this.selectedTile.setFocused(!1),this.match(this.selectedTile,e),this.selectedTile=null}}},{key:"clearSelectedTile",value:function value(){this.selectedTile&&(this.selectedTile.setFocused(!1),this.selectedTile=null)}},{key:"match",value:function value(e,t){var n=[e.getCoord().x,e.getCoord().y],i=[t.getCoord().x,t.getCoord().y],_$a=Mh(this.grid,n,i);if(null===_$a){Pi.playSound(vi.INVALID_MATCH),this.shakeGrid();var o=0===this.levelData.level,r=mh(this.grid,n,i,o);return this.node.scene.emit(Co.GRID_MATCH,[e,t]),void this.node.scene.emit(Co.GRID_MATCH_FAIL,r)}this.node.scene.emit(Co.GRID_MATCH,[e,t]),this.node.scene.emit(Co.GRID_MATCH_SUCCESS,_$a,[e,t]),this.clear([[e,t]],"clear")}},{key:"clear",value:function value(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"clear";this.normalMatches+=e.length,e.forEach(function(e){var i=Ue(e,2),_$a=i[0],o=i[1];_$a.setEmpty(),o.setEmpty(),_$a.playClearFX(n),o.playClearFX(n),t.node.scene.emit(Co.GRID_CLEAR,[_$a,o])}),this.processGameplayCycle()}},{key:"showHint",value:function value(){if(this.hintPath){var _$e=this.hintPath[0].a,t=this.hintPath[this.hintPath.length-1].b,n=this.getTileAt(_$e.x,_$e.y),i=this.getTileAt(t.x,t.y);n.setHint(!0),i.setHint(!0),this.hintTiles=[n,i]}}},{key:"hideHint",value:function value(){if(this.hintTiles){var _$e=Ue(this.hintTiles,2),t=_$e[0],n=_$e[1];t.setHint(!1),n.setHint(!1),this.hintTiles=null}}},{key:"getHintPath",value:function value(){return this.hintPath}},{key:"getTileAt",value:function value(e,t){return this.grid.isInBounds(e,t)?this.grid.get(e,t):null}},{key:"getAnyTileWorldPosition",value:function value(e,t){var n=Mc(this.grid,this.tileSize,{x:e,y:t});this.tilePrefab.node.setPosition(n.x,n.y);var i=this.tilePrefab.node.getWorldPosition();return{x:i.x,y:i.y}}},{key:"getTileSize",value:function value(){return this.tileSize}},{key:"getGridSize",value:function value(){return[this.grid.width,this.grid.height]}},{key:"getUncleared",value:function value(){return zc(this.grid)}},{key:"getCleared",value:function value(){return Gc(this.grid)}},{key:"getBombTiles",value:function value(){return zc(_instanceof(_$e=this.grid,ac)?_$e.asArray():_$e).filter(function(e){var t;return(null===(t=e.special)||void 0===t?void 0:t.type)===_c.bomb});var _$e}},{key:"getPairs",value:function value(){for(var _$e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=[],i=t?zc(this.grid):Gc(this.grid),_$a=function a(){var _$e=Ue(Kc(i),2),t=_$e[0],_$a=_$e[1];n.push([t,_$a]),i=i.filter(function(e){return e!==t&&e!==_$a})};n.length<_$e;)_$a();return n}},{key:"setIgnoreInput",value:function value(){var _$e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.grid.forEach(function(t){return t.setIgnoreInput(_$e)})}},{key:"processShuffleRequest",value:function value(e){var t=this.processShuffleStep(this.grid,!0,e);this.grid=t[0],this.hintPath=t[1],this.consumeAnimationQueue()}},{key:"getCurrentFen",value:function value(){return bh(this.grid)}},{key:"generateFenFromCurrentLevel",value:function value(e){return a.generateFen(null!=e?e:this.levelData)}},{key:"listenLayoutevents",value:function value(){W.on(Aa,this.handleViewResized),W.on(Ia,this.onLayoutChanged)}},{key:"unlistenLayoutevents",value:function value(){W.off(Aa,this.handleViewResized),W.off(Ia,this.onLayoutChanged)}},{key:"shakeGrid",value:(n=Ee(function(){var _$e,t,n;return _ts_generator(this,function(_state){switch(_state.label){case 0:_$e=this.tilesHolder.position.clone(),t=k(this.tilesHolder).to(.05,{position:_$e.clone().add3f(ie(5,10),ie(5,10),0)}).to(.05,{position:_$e.clone().subtract3f(ie(5,10),ie(5,10),0)}),n=k(this.tilesHolder).repeat(2,t).to(.05,{position:_$e});return[4,gn.runTweenAsync(n)];case 1:_state.sent();return[2]}})}),function(){return n.apply(this,arguments)})},{key:"processGameplayCycle",value:function value(){var _$e=zc(this.grid);if(0!==_$e.length){var t=this.grid,n=_$e.length>=2&&this.spawnAttempts<this.levelData.rules.addRandomTilesPerMove&&this.normalMatches>=5,i=this.normalMatchesSinceLastSpawn>=2;n&&(i?(this.spawnAttempts++,this.normalMatchesSinceLastSpawn=0,this.processSpawnStep()):this.normalMatchesSinceLastSpawn++),_$e.length>14&&(t=this.processGravitationStep(t));var _$a=this.processShuffleStep(t);this.consumeAnimationQueue(),this.grid=_$a[0],this.hintPath=_$a[1]}}},{key:"processSpawnStep",value:function value(){var _$e=Ue(Jc(Gc(this.grid),2),2),t=_$e[0],n=_$e[1];t.restore(),n.restore(t.id)}},{key:"processGravitationStep",value:function value(e){var t,n=this,i=e,_$a=[],o=We(this.parsedGravityRules);try{var r=function r(){var _$e=t.value,o=Sh(i=n.toGravitated(i,_$e));if(0===o.length)return 1;o.forEach(function(e){var t=Ue(e,2),n=t[0],i=t[1],_$a=i[0],o=i[1];n.setCoord(_$a,o)}),i.forEach(function(e){e.node.setSiblingIndex(0)});var r=function(){var _$e=Ee(function(){return _ts_generator(this,function(_state){switch(_state.label){case 0:return[4,Promise.all(o.map(function(e){var t=Ue(e,2),_$a=t[0],o=Ue(t[1],2),r=o[0],s=o[1];return _$a.sync({delay:.25,duration:.25,getTargetPosition:function getTargetPosition(){return Mc(i,n.tileSize,{x:r,y:s})}})}))];case 1:_state.sent();return[2]}})});return function(){return _$e.apply(this,arguments)}}();_$a.push(r)};for(o.s();!(t=o.n()).done;)r()}catch(e){o.e(e)}finally{o.f()}var s=function(){var _$e=Ee(function(){var _$e,t,n;return _ts_generator(this,function(_state){switch(_state.label){case 0:_$e=0,t=_$a;_state.label=1;case 1:if(!(_$e<t.length))return[3,4];n=t[_$e];return[4,n()];case 2:_state.sent();_state.label=3;case 3:_$e++;return[3,1];case 4:return[2]}})});return function(){return _$e.apply(this,arguments)}}();return this.animationQueue.push(s),i}},{key:"toGravitated",value:function value(e,t){var n=new ac(e),i=e.height-1,_$a=e.width-1,o=[0,i],r=[0,_$a],s=Math.floor(e.height/2),l=Math.floor(e.width/2),u=function u(e){return e.isHidden()};switch(t){case Qu:n.gravitate({rowRange:o,colRange:r,direction:Ju.Down,isLighter:u});break;case Zu:n.gravitate({rowRange:o,colRange:r,direction:Ju.Up,isLighter:u});break;case $u:n.gravitate({rowRange:o,colRange:r,direction:Ju.Left,isLighter:u});break;case ec:n.gravitate({rowRange:o,colRange:r,direction:Ju.Right,isLighter:u});break;case tc:n.gravitate({rowRange:o,colRange:[l,_$a],direction:Ju.Left,isLighter:u,out:n.gravitate({rowRange:o,colRange:[0,l-1],direction:Ju.Right,isLighter:u})});break;case nc:n.gravitate({rowRange:[s,i],colRange:r,direction:Ju.Down,isLighter:u,out:n.gravitate({rowRange:[0,s-1],colRange:r,direction:Ju.Up,isLighter:u})})}return n}},{key:"getPrimitiveDirection",value:function value(e,t,n){var i=Math.floor(this.grid.height/2),_$a=Math.floor(this.grid.width/2);switch(n){case Qu:return Ju.Down;case Zu:return Ju.Up;case $u:return Ju.Left;case ec:return Ju.Right;case tc:return e>=_$a?Ju.Left:Ju.Right;case nc:return t>=i?Ju.Down:Ju.Up}}},{key:"processShuffleStep",value:function value(e){var t,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2?arguments[2]:void 0,_$a=Mh(e),o=zc(e).map(function(e){var t=e.getCoord();return[t.x,t.y]});if(null!==_$a&&!n)return[e,_$a];var r=100;do{var s=e.toShuffled(o),l=Ue(s,1);_$a=Mh(t=l[0]),r--}while(null===_$a&&r>0);if(r<=0)return null==Xh||Xh.sendException(new Error("No paths found after 100 shuffle attempts"),{message:"No paths found after 100 shuffle attempts",levelData:this.levelData,gridAsArray:t.asArray()}),this.node.scene.emit(Co.GAME_EXIT),[e,_$a];var u=Sh(t);if(0===u.length)return[t,_$a];u.forEach(function(e){var t=Ue(e,2),n=t[0],i=Ue(t[1],2),_$a=i[0],o=i[1];n.setCoord(_$a,o)});var c=void 0!==i?function c(){return i(e,t)}:this.createShuffleAnimationHandler(e,t);return this.animationQueue.push(c),[t,_$a]}},{key:"createShuffleAnimationHandler",value:function value(e,t){var n=this,i=function(){var i=Ee(function(){return _ts_generator(this,function(_state){switch(_state.label){case 0:return[4,Promise.all(e.map(function(e,i,a){return e.sync({duration:.4,easing:"smooth",getTargetPosition:function getTargetPosition(){return Mc(t,n.tileSize,{x:i,y:a},10)}})}))];case 1:_state.sent();return[2]}})});return function(){return i.apply(this,arguments)}}(),_$a=function(){var _$e=Ee(function(){return _ts_generator(this,function(_state){switch(_state.label){case 0:t.forEach(function(e){e.node.setSiblingIndex(0)});return[4,Promise.all(t.map(function(e){return e.sync({duration:.6,easing:"smooth",delay:ie(0,.4),getTargetPosition:function getTargetPosition(e){return Mc(t,n.tileSize,e)}})}))];case 1:_state.sent();return[2]}})});return function(){return _$e.apply(this,arguments)}}();return function(){var _$e=Ee(function(){return _ts_generator(this,function(_state){switch(_state.label){case 0:return[4,i()];case 1:_state.sent();return[4,_$a()];case 2:_state.sent();return[2]}})});return function(){return _$e.apply(this,arguments)}}()}},{key:"consumeAnimationQueue",value:(t=Ee(function(){var _$e;return _ts_generator(this,function(_state){switch(_state.label){case 0:if(!!this.isConsumingAnimation)return[3,5];this.isConsumingAnimation=!0;_state.label=1;case 1:if(!(this.animationQueue.length>0))return[3,4];if(0===this.getUncleared().length){this.animationQueue=[];return[3,4]}_$e=this.animationQueue.shift();return[4,_$e()];case 2:_state.sent();_state.label=3;case 3:return[3,1];case 4:this.isConsumingAnimation=!1;_state.label=5;case 5:return[2]}})}),function(){return t.apply(this,arguments)})}],[{key:"generateFen",value:function value(e){for(var t=e,n=[],i=0;i<t.colors;i++)n.push(i+1);var _$a=Date.now(),o=eh({levelData:t,seed:_$a,identities:n,createTile:function createTile(e){var t=e,n=void 0,i=new Q(0,0);return{get id(){return t},get special(){return n},get coord(){return i},setIdentity:function setIdentity(e){t=e},isHidden:function isHidden(){return!1},setSpecialType:function setSpecialType(e){n={type:e}},setCoord:function setCoord(e,t){return i.set(e,t)},getCoord:function getCoord(){return i},isSimilarTo:function isSimilarTo(e){return e.id===t},inSamePositionAs:function inSamePositionAs(e){return e.getCoord().equals(i)}}}});return o.forEach(function(e,t,n){e.setCoord(t,n)}),oh(o,_$a),Zc(o,t,_$a),bh(o)}}]),a}(y)).prototype,"tilePrefab",[Ch],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_h=Ye(Ih.prototype,"tilesHolder",[Th],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Lh=Ye(Ih.prototype,"tileTrim",[Ah],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return new Q(.025,.1)}}),Rh=Ih))||Rh)||Rh);n._RF.pop(),n._RF.push({},"c92ec8pmUJGbrL9PLjum+i5","Line",void 0);var Zh=(0,i.ccclass)("Line")(Wh=function(e){Ie(n,e);var t=xe(n);function n(){return Ce(this,n),t.apply(this,arguments)}return Ae(n,[{key:"onLoad",value:function value(){this.uiTransform=this.getComponent(s)}},{key:"setPoints",value:function value(e,t){this.node.setWorldPosition((e.x+t.x)/2,(e.y+t.y)/2,0),this.uiTransform.width=Q.distance(e,t)+10,this.uiTransform.width/=this.node.worldScale.x;var _$n=180*Math.atan2(t.y-e.y,t.x-e.x)/Math.PI;this.node.eulerAngles=new Y(0,0,_$n)}}]),n}(y))||Wh;n._RF.pop(),n._RF.push({},"1e7cch8i/5DkYHOwJowrjeg","AFPool",void 0);var $h,ed,td,nd,id,ad,od,rd,sd,ld,ud,cd=function(e){Ie(n,e);var t=xe(n);function n(e,i,a,o,r){var s;return Ce(this,n),(s=t.call(this,e,i,r)).ator=a,s.ftor=o,s}return Ae(n,[{key:"alloc",value:function value(){var _$e=Fe(Pe(n.prototype),"alloc",this).call(this);return this.ator&&this.ator(_$e),_$e}},{key:"free",value:function value(e){this.ftor&&this.ftor(e),Fe(Pe(n.prototype),"free",this).call(this,e)}}]),n}(ae);n._RF.pop(),n._RF.push({},"6f7a1msxIxIbYLx5PpbL/BZ","PathDrawer",void 0);var hd,dd,pd,yd,fd,vd,md,gd,bd,Sd=i.ccclass,wd=i.property,kd=($h=Sd("PathDrawer"),ed=wd({group:"Line",displayName:"Prefab",type:P}),td=wd({group:"Line",displayName:"Holder",type:a,tooltip:"Line Prefab"}),nd=wd({group:"Point",displayName:"Prefab",type:P}),id=wd({group:"Point",displayName:"Holder",type:a}),$h((rd=Ye((od=function(e){Ie(n,e);var t=xe(n);function n(){var _$e;Ce(this,n);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return je(_$e=t.call.apply(t,[this].concat(a)),"linePrefab",rd,Ne(_$e)),je(_$e,"lineHolder",sd,Ne(_$e)),_$e.lineNodes=[],je(_$e,"pointPrefab",ld,Ne(_$e)),je(_$e,"pointHolder",ud,Ne(_$e)),_$e.pointNodes=[],_$e}return Ae(n,[{key:"start",value:function value(){var _$e=this;this.linePool=new cd(function(){var t=l(_$e.linePrefab);return _$e.lineHolder.addChild(t),t.parent=_$e.lineHolder,t.active=!1,t},0,function(t){_$e.lineNodes.push(t),t.active=!0},function(e){e.active=!1},function(e){e.isValid&&e.destroy()}),this.pointPool=new cd(function(){var t=l(_$e.pointPrefab);return _$e.pointHolder.addChild(t),t.active=!1,t},0,function(t){_$e.pointNodes.push(t),t.active=!0},function(e){e.active=!1},function(e){e.isValid&&e.destroy()})}},{key:"drawPath",value:function value(e){this.clearPath();var t,_$n=We(e);try{for(_$n.s();!(t=_$n.n()).done;){var i,a=t.value;null===(i=this.linePool.alloc().getComponent(Zh))||void 0===i||i.setPoints(a.a,a.b)}}catch(e){_$n.e(e)}finally{_$n.f()}}},{key:"clearPath",value:function value(){var _$e,t=We(this.lineNodes);try{for(t.s();!(_$e=t.n()).done;){var _$n=_$e.value;this.linePool.free(_$n)}}catch(e){t.e(e)}finally{t.f()}this.lineNodes=[];var i,a=We(this.pointNodes);try{for(a.s();!(i=a.n()).done;){var o=i.value;this.pointPool.free(o)}}catch(e){a.e(e)}finally{a.f()}this.pointNodes=[]}}]),n}(y)).prototype,"linePrefab",[ed],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),sd=Ye(od.prototype,"lineHolder",[td],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ld=Ye(od.prototype,"pointPrefab",[nd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ud=Ye(od.prototype,"pointHolder",[id],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ad=od))||ad);n._RF.pop(),n._RF.push({},"5cc7bAmTI1JL7nwLzZcp45u","ErrorDrawer",void 0);var Ed,Cd=i.ccclass,Td=i.property,Ad=(hd=Cd("ErrorDrawer"),dd=Td(D),pd=Td(D),yd=Td(D),hd((md=Ye((vd=function(e){Ie(n,e);var t=xe(n);function n(){var _$e;Ce(this,n);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return je(_$e=t.call.apply(t,[this].concat(a)),"one",md,Ne(_$e)),je(_$e,"two",gd,Ne(_$e)),je(_$e,"error",bd,Ne(_$e)),_$e}return Ae(n,[{key:"start",value:function value(){Fe(Pe(n.prototype),"start",this).call(this),this.pathAppearDuration=0}},{key:"drawPath",value:function value(e){var t=this;if(this.clearPath(),e.forEach(function(n,i){var a;if(null===(a=t.linePool.alloc().getComponent(Zh))||void 0===a||a.setPoints(n.a,n.b),0!==i){var o=t.pointPool.alloc();o.setWorldPosition(new Y(n.a.x,n.a.y,0));var r=o.getComponent(A);1===i&&e.length>3?r.spriteFrame=t.one:2===i&&e.length>3?r.spriteFrame=t.two:r.spriteFrame=t.error}}),1===e.length){var _$n=this.pointPool.alloc();_$n.setWorldPosition(new Y(e[0].a.x+e[0].b.x,e[0].a.y+e[0].b.y,0).multiplyScalar(.5)),_$n.getComponent(A).spriteFrame=this.error}this.pathAppearDuration=.8}},{key:"update",value:function value(e){this.pathAppearDuration>0&&(this.pathAppearDuration-=e,this.pathAppearDuration<=0&&this.clearPath())}}]),n}(kd)).prototype,"one",[dd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),gd=Ye(vd.prototype,"two",[pd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),bd=Ye(vd.prototype,"error",[yd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),fd=vd))||fd);n._RF.pop(),n._RF.push({},"880e8aL9NFPj68zH2xVRIFR","HintDrawer",void 0);var Rd,Id=(0,i.ccclass)("HintDrawer")(Ed=function(e){Ie(n,e);var t=xe(n);function n(){return Ce(this,n),t.apply(this,arguments)}return Ae(n,[{key:"drawPath",value:function value(e){this.clearPath(),this.createPath(e),this.showPath()}},{key:"createPath",value:function value(e){var t=this;e.forEach(function(e){var _$n;null===(_$n=t.linePool.alloc().getComponent(Zh))||void 0===_$n||_$n.setPoints(e.a,e.b),t.pointPool.alloc().setWorldPosition(e.a.x,e.a.y,0)}),this.pointPool.alloc().setWorldPosition(e[e.length-1].b.x,e[e.length-1].b.y,0)}},{key:"showPath",value:function value(){var _$e,t=We(this.lineNodes);try{for(t.s();!(_$e=t.n()).done;){var _$n=_$e.value.getComponent(x);_$n.opacity=0,k(_$n).to(.2,{opacity:255},{easing:"quadOut"}).start()}}catch(e){t.e(e)}finally{t.f()}var i,a=We(this.pointNodes);try{for(a.s();!(i=a.n()).done;){var o=i.value.getComponent(x);o.opacity=0,k(o).to(.2,{opacity:255},{easing:"quadOut"}).start()}}catch(e){a.e(e)}finally{a.f()}}},{key:"clearPath",value:function value(){var _$e,t=this,_$n=We(this.lineNodes);try{var i=function i(){var _$n=_$e.value,i=_$n.getComponent(x);k(i).to(.15,{opacity:0},{onComplete:function onComplete(){i.opacity=255,t.linePool.free(_$n)}}).start()};for(_$n.s();!(_$e=_$n.n()).done;)i()}catch(e){_$n.e(e)}finally{_$n.f()}var a,o=We(this.pointNodes);try{var r=function r(){var _$e=a.value,_$n=_$e.getComponent(x);k(_$n).to(.15,{opacity:0},{onComplete:function onComplete(){_$n.opacity=255,t.pointPool.free(_$e)}}).start()};for(o.s();!(a=o.n()).done;)r()}catch(e){o.e(e)}finally{o.f()}this.lineNodes=[],this.pointNodes=[]}}]),n}(kd))||Ed;n._RF.pop(),n._RF.push({},"25f67BW5/5Jzox4v+yBBbyS","MatchDrawer",void 0);var Pd,_d,Ld,Od,Dd,Nd,Md,xd,Bd,Fd=(0,i.ccclass)("MatchDrawer")(Rd=function(e){Ie(a,e);var t,n,i=xe(a);function a(){return Ce(this,a),i.apply(this,arguments)}return Ae(a,[{key:"drawPath",value:function value(e){var t=this;e.forEach(function(e,n){var i,_$a=t.linePool.alloc();null===(i=_$a.getComponent(Zh))||void 0===i||i.setPoints(e.a,e.b),t.animateLine(_$a);var o=t.pointPool.alloc();o.setWorldPosition(e.a.x,e.a.y,0),t.animatePoint(o,n)});var n=this.pointPool.alloc();n.setWorldPosition(e[e.length-1].b.x,e[e.length-1].b.y,0),this.animatePoint(n,e.length)}},{key:"animateLine",value:(n=Ee(function(e){var t,n;return _ts_generator(this,function(_state){switch(_state.label){case 0:t=e.getComponent(x);t.opacity=0;n=k(t).to(.25,{opacity:255},{easing:"quadOut"}).delay(.1).to(.2,{opacity:0});return[4,gn.runTweenAsync(n)];case 1:_state.sent(),t.opacity=255,this.linePool.free(e);return[2]}})}),function(e){return n.apply(this,arguments)})},{key:"animatePoint",value:(t=Ee(function(e,t){var n;return _ts_generator(this,function(_state){switch(_state.label){case 0:e.scale=Y.ZERO;n=k(e).delay(.03*t).to(.2,{scale:Y.ONE},{easing:"quadOut"}).delay(.1).to(.2,{scale:Y.ZERO},{easing:"backIn"});return[4,gn.runTweenAsync(n)];case 1:_state.sent(),this.pointPool.free(e);return[2]}})}),function(e,n){return t.apply(this,arguments)})},{key:"clearPath",value:function value(){this.lineNodes=[],this.pointNodes=[]}}]),a}(kd))||Rd;n._RF.pop(),n._RF.push({},"bfdf2THr9lPJ4TOVDN8VgE4","PathDraw",void 0);var zd,Gd=i.ccclass,Ud=i.property,Hd=(Pd=Gd("PathDraw"),_d=Ud({group:{name:"Path Drawer"},type:Fd}),Ld=Ud({group:{name:"Path Drawer"},type:Id}),Od=Ud({group:{name:"Path Drawer"},type:Ad}),Pd((Md=Ye((Nd=function(e){Ie(n,e);var t=xe(n);function n(){var _$e;Ce(this,n);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return je(_$e=t.call.apply(t,[this].concat(a)),"matchPath",Md,Ne(_$e)),je(_$e,"hintPath",xd,Ne(_$e)),je(_$e,"errorPath",Bd,Ne(_$e)),_$e.isDrawingHint=!1,_$e}return Ae(n,[{key:"drawMatchPath",value:function value(e,t){var _$n,i=We(e=e.map(function(e){return we({},e)}));try{for(i.s();!(_$n=i.n()).done;){var a=_$n.value;a.a=t(a.a),a.b=t(a.b)}}catch(e){i.e(e)}finally{i.f()}this.matchPath.drawPath(e)}},{key:"clearMatchPath",value:function value(){this.matchPath.clearPath()}},{key:"drawHintPath",value:function value(e,t){if(!this.isDrawingHint){this.isDrawingHint=!0;var _$n,i=We(e=e.map(function(e){return we({},e)}));try{for(i.s();!(_$n=i.n()).done;){var a=_$n.value;a.a=t(a.a),a.b=t(a.b)}}catch(e){i.e(e)}finally{i.f()}this.hintPath.drawPath(e)}}},{key:"clearHintPath",value:function value(){this.isDrawingHint&&(this.isDrawingHint=!1,this.hintPath.clearPath())}},{key:"drawErrorPath",value:function value(e,t){var _$n,i=We(e=e.map(function(e){return we({},e)}));try{for(i.s();!(_$n=i.n()).done;){var a=_$n.value;a.a=t(a.a),a.b=t(a.b)}}catch(e){i.e(e)}finally{i.f()}this.errorPath.drawPath(e)}}]),n}(y)).prototype,"matchPath",[_d],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),xd=Ye(Nd.prototype,"hintPath",[Ld],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Bd=Ye(Nd.prototype,"errorPath",[Od],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Dd=Nd))||Dd);n._RF.pop(),n._RF.push({},"3afb9sM0KZKyod8UtofqZYu","ComboManager",void 0);var Vd,qd,Wd,Kd,jd,Yd,Xd,Jd,Qd,Zd,$d,ep,tp,np,ip,ap,op,rp=(0,i.ccclass)("ComboManager")(zd=function(e){Ie(n,e);var t=xe(n);function n(){return Ce(this,n),t.apply(this,arguments)}return Ae(n,[{key:"init",value:function value(){this.currentCombo=0,this.setEmitEvent(!0),this.node.scene.on(Co.COMBO_ENDED,this.resetCombo,this),this.node.scene.on(Co.GAME_FINISH,this.resetCombo,this),this.node.scene.on(Co.GAME_REPLAY,this.resetCombo,this),this.node.scene.on(Co.NEXT_LEVEL,this.resetCombo,this),this.node.scene.on(Co.ADD_COMBO,this.addCombo,this)}},{key:"addCombo",value:function value(){this.setCombo(this.currentCombo+1)}},{key:"resetCombo",value:function value(){this.setCombo(0)}},{key:"getCombo",value:function value(){return this.currentCombo}},{key:"setCombo",value:function value(e){if(this.currentCombo=e,e>0&&e<5){var t=[vi.COMBO_1,vi.COMBO_2,vi.COMBO_3,vi.COMBO_4,vi.COMBO_5];Pi.playSound(t[e])}else e>=5&&Pi.playSound(vi.COMBO_5);e>0&&this.vibrate(e),this.emitEvent&&this.node.scene.emit(Co.COMBO_UPDATED,e)}},{key:"vibrate",value:function value(e){var t;null===(t=I("Vibrate"))||void 0===t||null===(t=t.getComponent(Zs))||void 0===t||t.vibrate(Math.min(20+20*e,220))}},{key:"setEmitEvent",value:function value(e){this.emitEvent=e}}]),n}(y))||zd;n._RF.pop(),n._RF.push({},"da8a1SD+ahMFpc6MIdiFP5H","ShiningStar",void 0);var sp,lp,up,cp,hp,dp=i.ccclass,pp=i.property,yp=i.disallowMultiple,fp=(Vd=dp("ShiningStar"),qd=pp(A),Wd=pp({serializable:!0,visible:!1}),Kd=pp({type:E,displayName:"Scale up duration",min:.001}),jd=pp({serializable:!0,visible:!1}),Yd=pp({type:E,displayName:"Bounce and Fall duration",min:.001}),Xd=pp({serializable:!0,visible:!1}),Jd=pp({type:E,displayName:"Start scale"}),Qd=pp({serializable:!0,visible:!1}),Zd=pp({type:E,displayName:"End scale"}),Vd($d=yp((tp=Ye((ep=function(e){Ie(u,e);var t,n,i,a,o,r,s,l=xe(u);function u(){var _$e;Ce(this,u);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return je(_$e=l.call.apply(l,[this].concat(n)),"shine",tp,Ne(_$e)),je(_$e,"twScaleUpDuration",np,Ne(_$e)),je(_$e,"twBounceAndFallDuration",ip,Ne(_$e)),je(_$e,"twStartScale",ap,Ne(_$e)),je(_$e,"twEndScale",op,Ne(_$e)),_$e.isBeingAnimated=!1,_$e}return Ae(u,[{key:"scaleUpDuration",get:function get(){return this.twScaleUpDuration},set:function set(e){this.twScaleUpDuration=e}},{key:"bounceAndFallDuration",get:function get(){return this.twBounceAndFallDuration},set:function set(e){this.twBounceAndFallDuration=e}},{key:"startScale",get:function get(){return this.twStartScale},set:function set(e){this.twStartScale=e}},{key:"endScale",get:function get(){return this.twEndScale},set:function set(e){this.twEndScale=e}},{key:"isAvailable",get:function get(){return!this.isBeingAnimated}},{key:"__preload",value:function value(){this.shineOpacity=this.shine.node.getComponent(x),this.uiOpacity=this.node.getComponent(x),this.validateRequiredComponents()}},{key:"onLoad",value:function value(){this.uiOpacity.opacity=0}},{key:"playAnimation",value:(s=Ee(function(){return _ts_generator(this,function(_state){switch(_state.label){case 0:if(!this.isAvailable)throw new Error("ShiningStar: This star is being animated.");this.isBeingAnimated=!0;return[4,this.animateAppear()];case 1:_state.sent();return[4,this.animateDisappear()];case 2:_state.sent(),this.isBeingAnimated=!1;return[2]}})}),function(){return s.apply(this,arguments)})},{key:"animateAppear",value:(r=Ee(function(){return _ts_generator(this,function(_state){switch(_state.label){case 0:this.shineOpacity.opacity=255;return[4,Promise.all([this.animateFadeIn(),this.animateScaleUp()])];case 1:_state.sent();return[2]}})}),function(){return r.apply(this,arguments)})},{key:"animateDisappear",value:(o=Ee(function(){return _ts_generator(this,function(_state){switch(_state.label){case 0:return[4,Promise.all([this.animateBounceAndFall(),this.animateScaleDown()])];case 1:_state.sent(),this.node.setScale(0,0),this.uiOpacity.opacity=0;return[2]}})}),function(){return o.apply(this,arguments)})},{key:"animateBounceAndFall",value:(a=Ee(function(){var _$e,t,n,i,a,o,r,s,l,_$u;return _ts_generator(this,function(_state){switch(_state.label){case 0:_$e=this.node.position.x,t=this.node.position.y,n=[60,120],i=(Math.random()*(n[1]-n[0])+n[0])*(Math.PI/180),a=_$e+200*Math.cos(i),o=t+200*Math.sin(i),r=t-500,s=gn.runTweenAsync(k(this.node).to(.2*this.twBounceAndFallDuration,{position:new Y(a,o,this.node.position.z)},{easing:"sineOut"}).to(.4*this.twBounceAndFallDuration,{position:new Y(a,r,this.node.position.z)},{easing:"cubicIn"})),l=[0,360],_$u=gn.runTweenAsync(k(this.node).to(this.twBounceAndFallDuration,{eulerAngles:new Y(0,0,Math.random()*(l[1]-l[0])*(a>_$e?-1:1))},{easing:"sineOut"}));return[4,Promise.all([s,_$u])];case 1:_state.sent(),this.node.eulerAngles=new Y(0,0,0);return[2]}})}),function(){return a.apply(this,arguments)})},{key:"animateFadeIn",value:(i=Ee(function(){var _$e;return _ts_generator(this,function(_state){switch(_state.label){case 0:_$e=Math.max(this.scaleUpDuration/4,.01);return[4,gn.runTweenAsync(k(this.uiOpacity).to(_$e,{opacity:255}))];case 1:_state.sent();return[2]}})}),function(){return i.apply(this,arguments)})},{key:"animateScaleUp",value:(n=Ee(function(){var _$e;return _ts_generator(this,function(_state){switch(_state.label){case 0:this.node.setScale(this.startScale,this.startScale);_$e=new Y(this.endScale,this.endScale,1);return[4,gn.runTweenAsync(k(this.node).to(this.scaleUpDuration,{scale:_$e},{easing:"cubicOut"}))];case 1:_state.sent();return[2]}})}),function(){return n.apply(this,arguments)})},{key:"animateScaleDown",value:(t=Ee(function(){var _$e;return _ts_generator(this,function(_state){switch(_state.label){case 0:_$e=new Y(0,0,1);return[4,gn.runTweenAsync(k(this.node).delay(.1*this.bounceAndFallDuration).to(.5*this.bounceAndFallDuration,{scale:_$e},{easing:"cubicIn"}))];case 1:_state.sent();return[2]}})}),function(){return t.apply(this,arguments)})},{key:"validateRequiredComponents",value:function value(){St.lazyValidateProperties(this)}}]),u}(y)).prototype,"shine",[qd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),np=Ye(ep.prototype,"twScaleUpDuration",[Wd],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return .5}}),Ye(ep.prototype,"scaleUpDuration",[Kd],Object.getOwnPropertyDescriptor(ep.prototype,"scaleUpDuration"),ep.prototype),ip=Ye(ep.prototype,"twBounceAndFallDuration",[jd],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return .5}}),Ye(ep.prototype,"bounceAndFallDuration",[Yd],Object.getOwnPropertyDescriptor(ep.prototype,"bounceAndFallDuration"),ep.prototype),ap=Ye(ep.prototype,"twStartScale",[Xd],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return .5}}),Ye(ep.prototype,"startScale",[Jd],Object.getOwnPropertyDescriptor(ep.prototype,"startScale"),ep.prototype),op=Ye(ep.prototype,"twEndScale",[Qd],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return 1}}),Ye(ep.prototype,"endScale",[Zd],Object.getOwnPropertyDescriptor(ep.prototype,"endScale"),ep.prototype),$d=ep))||$d)||$d);n._RF.pop(),n._RF.push({},"2e9aaj8L6lN1pTv2xGEj1sE","StarParticles",void 0);var vp,mp,gp,bp,Sp,wp,kp,Ep,Cp,Tp,Ap,Rp,Ip,Pp,_p,Lp,Op,Dp,Np,Mp,xp,Bp=i.ccclass,Fp=i.property,zp=i.disallowMultiple,Gp=GameCore.Utils.Array,Up=(sp=Bp("StarParticles"),lp=Fp({type:[fp],displayName:"Prebuilt Shining stars"}),sp(up=zp((hp=Ye((cp=function(e){Ie(i,e);var t,n=xe(i);function i(){var _$e;Ce(this,i);for(var t=arguments.length,a=new Array(t),o=0;o<t;o++)a[o]=arguments[o];return je(_$e=n.call.apply(n,[this].concat(a)),"shiningStars",hp,Ne(_$e)),_$e}return Ae(i,[{key:"__preload",value:function value(){this.validateRequiredComponents()}},{key:"fireShiningStarAt",value:(t=Ee(function(e){var t,n,_$i,a,o;return _ts_generator(this,function(_state){switch(_state.label){case 0:t=this.getFirstAvailableShiningStar();if(void 0===t)throw new Error("No available shining stars. Please add more prebuilt shining stars or calls this function later.");n=Ue(e,2),_$i=n[0],a=n[1],o=new Y(_$i,a,this.node.worldPosition.z);t.node.worldPosition=o;return[4,t.playAnimation()];case 1:_state.sent();return[2]}})}),function(e){return t.apply(this,arguments)})},{key:"getFirstAvailableShiningStar",value:function value(){return Gp.search(this.shiningStars,function(e){return e.isAvailable})}},{key:"validateRequiredComponents",value:function value(){St.lazyValidateProperties(this)}}]),i}(y)).prototype,"shiningStars",[lp],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return[]}}),up=cp))||up)||up);n._RF.pop(),n._RF.push({},"2913d3KShhIEaPfSLUhFqvA","EffectManager",void 0);var Hp=i.ccclass,Vp=i.property,qp=(vp=Hp("EffectManager"),mp=Vp({group:"Thunder Effect",type:a}),gp=Vp({group:"Thunder Effect",type:a}),bp=Vp({group:"Mask Effect",type:Ca}),Sp=Vp({group:"Mask Effect",type:a}),wp=Vp({group:"Tornado Effect",type:a}),kp=Vp({group:"Clear Particle Effect",type:a,displayName:"Particle holder node"}),Ep=Vp({group:"Clear Particle Effect",type:oe,displayName:"Emitter 1"}),Cp=Vp({group:"Clear Particle Effect",type:oe,displayName:"Emitter 2"}),Tp=Vp({group:"Star Particles Effect",type:Up}),vp((Ip=Ye((Rp=function(e){Ie(y,e);var t,n,i,a,o,r,l,u,c,h,d,p=xe(y);function y(){var _$e;Ce(this,y);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return je(_$e=p.call.apply(p,[this].concat(n)),"cloud",Ip,Ne(_$e)),je(_$e,"lightnings",Pp,Ne(_$e)),je(_$e,"backgroundMask",_p,Ne(_$e)),je(_$e,"masks",Lp,Ne(_$e)),je(_$e,"tornado",Op,Ne(_$e)),_$e.bombExplosion=null,_$e.bombExplosionPool=null,_$e.defuseExplosion=null,_$e.defuseExplosionPool=null,je(_$e,"clearParticleHolder",Dp,Ne(_$e)),je(_$e,"clearParticle1",Np,Ne(_$e)),je(_$e,"clearParticle2",Mp,Ne(_$e)),je(_$e,"starParticle",xp,Ne(_$e)),_$e.maskTargets=[],_$e}return Ae(y,[{key:"__preload",value:function value(){this.validateRequiredComponents()}},{key:"update",value:function value(){var _$e=this;this.maskTargets.length>0&&this.maskTargets.forEach(function(t,n){t.isHidden()||(_$e.masks[n].worldPosition=t.node.worldPosition.clone())})}},{key:"validateRequiredComponents",value:function value(){St.lazyValidateProperties(this)}},{key:"start",value:function value(){this.node.scene.on(Co.GRID_RESIZE,this.handleBoardResize,this)}},{key:"playClearFXAt",value:function value(e){this.clearParticle1.node.setWorldPosition(new Y(e[0].x,e[0].y,1)),this.clearParticle2.node.setWorldPosition(new Y(e[1].x,e[1].y,1)),this.clearParticle1.resetSystem(),this.clearParticle2.resetSystem()}},{key:"playStarFXAt",value:function value(e){this.starParticle.fireShiningStarAt(e)}},{key:"playTornadoAnimation",value:(d=Ee(function(){var _$e;return _ts_generator(this,function(_state){switch(_state.label){case 0:if(!(null!==this.tornado.getChildByName("Sprite").getComponent(v).defaultClip))return[3,2];this.tornado.active=!0;_$e=k(this.tornado);_$e.set({scale:new Y(0,0,0)}),_$e.delay(.5),_$e.to(.5,{scale:new Y(1,1,1)},{easing:"quadOut"}),_$e.to(.5,{scale:new Y(0,0,0)},{easing:"quadIn"}),_$e.set({active:!1}),li.setBlockInput(!0);return[4,gn.runTweenAsync(_$e)];case 1:_state.sent(),li.setBlockInput(!1);return[3,3];case 2:console.warn("EffectManager: Tornado animation is not loaded when animation play request was made.");_state.label=3;case 3:return[2]}})}),function(){return d.apply(this,arguments)})},{key:"shakeGame",value:(h=Ee(function(){var _$e,t;return _ts_generator(this,function(_state){switch(_state.label){case 0:_$e=this.node.position.clone(),t=k(this.node).to(.05,{position:_$e.clone().add3f(ie(5,10),ie(5,10),0)}).to(.05,{position:_$e.clone().subtract3f(ie(5,10),ie(5,10),0)}).to(.05,{position:_$e});return[4,gn.runTweenAsync(t)];case 1:_state.sent();return[2]}})}),function(){return h.apply(this,arguments)})},{key:"handleBoardResize",value:function value(e){this.clearParticleHolder.setScale(e,e)}},{key:"playThunderAnimation",value:(c=Ee(function(e,t){var n,i,a,o,r,l,u,c,h,d,p,_$y;return _ts_generator(this,function(_state){switch(_state.label){case 0:this.cloud.active=!0;a=I("Canvas").getComponent(s),o=a.width,r=a.height,l=0,u=0;switch(Math.floor(4*Math.random())){case 0:l=Math.random()*o-o/2,u=r/2+300;break;case 1:l=Math.random()*o-o/2,u=-r/2-300;break;case 2:l=-o/2-300,u=Math.random()*r-r/2;break;case 3:l=o/2+300,u=Math.random()*r-r/2}this.cloud.position=new Y(l,u),this.resetMasks(),this.setMaskProperties(0,e[0][0].node.worldPosition,e[0][0].node.worldScale),this.setMaskProperties(1,e[0][1].node.worldPosition,e[0][1].node.worldScale),this.setMaskProperties(2,e[1][0].node.worldPosition,e[1][0].node.worldScale),this.setMaskProperties(3,e[1][1].node.worldPosition,e[1][1].node.worldScale),this.maskTargets=[e[0][0],e[0][1],e[1][0],e[1][1]];return[4,this.setBackgroundMaskActive(!0)];case 1:_state.sent();c=k(this.cloud).to(.8,{position:new Y(0,300)},{easing:"quadOut"});return[4,gn.runTweenAsync(c)];case 2:_state.sent();h=e[0][0].node.worldPosition.clone(),d=e[0][1].node.worldPosition.clone();this.shakeGame(),null===(n=I("Vibrate"))||void 0===n||null===(n=n.getComponent(Zs))||void 0===n||n.vibrate(500),Pi.playSound(vi.THUNDERBOLT),t.clear([e[0]],"break");return[4,Promise.all([this.playLightningAnimation(h,0),this.playLightningAnimation(d,1)])];case 3:_state.sent(),this.node.scene.emit(Co.ADD_COMBO),this.node.scene.emit(Co.ADD_SCORE);p=e[1][1].node.worldPosition.clone(),_$y=e[1][0].node.worldPosition.clone();this.shakeGame(),null===(i=I("Vibrate"))||void 0===i||null===(i=i.getComponent(Zs))||void 0===i||i.vibrate(500),Pi.playSound(vi.THUNDERBOLT),t.clear([e[1]],"break");return[4,Promise.all([this.playLightningAnimation(_$y,0),this.playLightningAnimation(p,1)])];case 4:_state.sent(),this.node.scene.emit(Co.ADD_COMBO),this.node.scene.emit(Co.ADD_SCORE),this.cloud.active=!1;return[4,this.setBackgroundMaskActive(!1)];case 5:_state.sent(),this.maskTargets=[];return[2]}})}),function(e,t){return c.apply(this,arguments)})},{key:"playLightningAnimation",value:(u=Ee(function(e,t){var n,i,a,o,r;return _ts_generator(this,function(_state){n=this,i=this.lightnings[t],a=e.subtract(i.worldPosition),o=Math.atan2(a.y,a.x)*(180/Math.PI)+180,r=a.length();return[2,(i.getComponent(s).width=r,i.angle=o,new Promise(function(e){i.active=!0,n.scheduleOnce(function(){i.active=!1,e()},.2)}))]})}),function(e,t){return u.apply(this,arguments)})},{key:"setBackgroundMaskActive",value:(l=Ee(function(e){return _ts_generator(this,function(_state){switch(_state.label){case 0:e&&(this.backgroundMask.node.active=!0);return[4,this.backgroundMask.changeStateFade(e,.25)];case 1:_state.sent(),e||(this.backgroundMask.node.active=!1);return[2]}})}),function(e){return l.apply(this,arguments)})},{key:"resetMasks",value:function value(){this.masks.forEach(function(e){e.worldPosition=new Y(-9999,-9999,0)})}},{key:"setMaskProperties",value:function value(e,t,n){n&&(this.masks[e].worldScale=n),this.masks[e].worldPosition=t}},{key:"createDefuseExplosionAt",value:(r=Ee(function(e){var t,n;return _ts_generator(this,function(_state){switch(_state.label){case 0:return[4,this.loadDefuseExplosionPrefab()];case 1:_state.sent(),this.defuseExplosionPool||(this.defuseExplosionPool=new cd(this.createDefuseExplosion.bind(this),1,Wp.getBombDefuseExplosion,Wp.returnBombDefuseExplosion,Wp.destroyBombDefuseExplosion));t=this.defuseExplosionPool.alloc();t.setWorldPosition(e);n=t.getComponent(v);return[4,gn.runAnimationAsync(n)];case 2:if(_state.sent(),!this.defuseExplosionPool)throw new Error("EffectManager: defuseExplosionPool is null");this.defuseExplosionPool.free(t);return[2]}})}),function(e){return r.apply(this,arguments)})},{key:"createBombExplosionAt",value:(o=Ee(function(e){var t,n;return _ts_generator(this,function(_state){switch(_state.label){case 0:return[4,this.loadBombExplosionPrefab()];case 1:_state.sent(),this.bombExplosionPool||(this.bombExplosionPool=new cd(this.createBombExplosion.bind(this),1,Kp.getBombExplosion,Kp.returnBombExplosion,Kp.destroyBombExplosion));t=this.bombExplosionPool.alloc();t.setWorldPosition(e);n=t.getComponent(v);return[4,gn.runAnimationAsync(n)];case 2:if(_state.sent(),!this.bombExplosionPool)throw new Error("EffectManager: bombExplosionPool is null");this.bombExplosionPool.free(t);return[2]}})}),function(e){return o.apply(this,arguments)})},{key:"createDefuseExplosion",value:function value(){if(!this.defuseExplosion)throw new Error("EffectManager: defuseExplosion is not loaded!");return Wp.createDefuseExplosion(this.defuseExplosion,this.node)}},{key:"createBombExplosion",value:function value(){if(!this.bombExplosion)throw new Error("EffectManager: bombExplosion is not loaded!");return Kp.createBombExplosion(this.bombExplosion,this.node)}},{key:"loadBombExplosionPrefab",value:(a=Ee(function(){var _$e;return _ts_generator(this,function(_state){switch(_state.label){case 0:if(this.bombExplosion)return[2,Promise.resolve()];return[4,li.loadPrefabAsync(Fn.BOMB_EXPLODE_PREFAB)];case 1:_$e=_state.sent();return[2,(_$e&&(this.bombExplosion=_$e),Promise.resolve())]}})}),function(){return a.apply(this,arguments)})},{key:"loadDefuseExplosionPrefab",value:(i=Ee(function(){var _$e;return _ts_generator(this,function(_state){switch(_state.label){case 0:if(this.defuseExplosion)return[2,Promise.resolve()];return[4,li.loadPrefabAsync(Fn.BOMB_DEFUSE_PREFAB)];case 1:_$e=_state.sent();return[2,(_$e&&(this.defuseExplosion=_$e),Promise.resolve())]}})}),function(){return i.apply(this,arguments)})},{key:"loadThunderAnimation",value:(n=Ee(function(){var _$e,t;return _ts_generator(this,function(_state){switch(_state.label){case 0:_$e=this.cloud.getChildByName("Top").getComponent(v);if(null!==_$e.defaultClip)return[2,Promise.resolve()];return[4,li.loadAnimClipAsync(Fn.CLOUD_IDLE_ANIM)];case 1:t=_state.sent();return[2,(t&&(_$e.defaultClip=t),Promise.resolve())]}})}),function(){return n.apply(this,arguments)})},{key:"loadTornadoAnimation",value:(t=Ee(function(){var _$e,t;return _ts_generator(this,function(_state){switch(_state.label){case 0:_$e=this.tornado.getChildByName("Sprite").getComponent(v);if(null!==_$e.defaultClip)return[2,Promise.resolve()];return[4,li.loadAnimClipAsync(Fn.TORNADO_IDLE_ANIM)];case 1:t=_state.sent();return[2,(t&&(_$e.defaultClip=t),Promise.resolve())]}})}),function(){return t.apply(this,arguments)})}]),y}(y)).prototype,"cloud",[mp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Pp=Ye(Rp.prototype,"lightnings",[gp],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return[]}}),_p=Ye(Rp.prototype,"backgroundMask",[bp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Lp=Ye(Rp.prototype,"masks",[Sp],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return[]}}),Op=Ye(Rp.prototype,"tornado",[wp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Dp=Ye(Rp.prototype,"clearParticleHolder",[kp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Np=Ye(Rp.prototype,"clearParticle1",[Ep],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Mp=Ye(Rp.prototype,"clearParticle2",[Cp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),xp=Ye(Rp.prototype,"starParticle",[Tp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ap=Rp))||Ap),Wp=function(){function e(){Ce(this,e)}return Ae(e,null,[{key:"createDefuseExplosion",value:function value(e,t){var n=l(e);return t.addChild(n),n.active=!1,n}},{key:"destroyBombDefuseExplosion",value:function value(e){e.destroy()}},{key:"getBombDefuseExplosion",value:function value(e){e.active=!0}},{key:"returnBombDefuseExplosion",value:function value(e){e.active=!1}}]),e}(),Kp=function(){function e(){Ce(this,e)}return Ae(e,null,[{key:"createBombExplosion",value:function value(e,t){var n=l(e);return t.addChild(n),n.active=!1,n}},{key:"destroyBombExplosion",value:function value(e){e.destroy()}},{key:"getBombExplosion",value:function value(e){e.active=!0}},{key:"returnBombExplosion",value:function value(e){e.active=!1}}]),e}();n._RF.pop(),n._RF.push({},"062f3AVHntKsIyireZmXg9P","GuideKeys",void 0);var jp="newbie",Yp="timer",Xp="combo",Jp="hint-item",Qp="thunder-item",Zp="storm-item",$p="pliers-item";n._RF.pop(),n._RF.push({},"6448denZfFEUru9tWmWGb7N","Guide01Newbie",void 0);var ey=.7261538461538461,ty=function(){function e(t){Ce(this,e),this.manager=t,this.gameplay=t.gameplay}var t,n;return Ae(e,[{key:"setup",value:function value(){this.currentStep=0,this.manager.node.scene.on(Co.GRID_MATCH_SUCCESS,this.showNextStep,this),this.manager.node.scene.on(Co.GRID_MATCH_FAIL,this.showNextStep,this),W.on(Aa,this.handleViewResized,this),W.on(Ia,this.handleViewResized,this),this.showStep(this.currentStep),this.manager.node.scene.emit(Co.HIDE_UI),this.manager.guideSkipButton.active=!0}},{key:"showNextStep",value:function value(){this.currentStep+1<rh.length?(this.currentStep+=1,this.showStep(this.currentStep)):this.close()}},{key:"showStep",value:(n=Ee(function(e){var t,n,i,a,o,r,s,l,u,c,h,d;return _ts_generator(this,function(_state){switch(_state.label){case 0:t=this.gameplay,n=t.board,i=t.effectManager,a=rh[e].startTile,o=rh[e].endTile,r=n.getTileAt(a.x,a.y),s=n.getTileAt(o.x,o.y);if(!(r&&s))return[3,3];l=r.node.worldPosition,u=s.node.worldPosition;i.resetMasks(),i.setMaskProperties(0,l,r.node.worldScale),i.setMaskProperties(1,u,s.node.worldScale),i.setBackgroundMaskActive(!0);c=this.manager,h=c.guideHand,d=c.guideTextBox;h.node.active=!0,h.playHandAnimation(l,u),this.alignGuideTextBox(),this.alignSkipButton();return[4,d.hide()];case 1:_state.sent(),d.setText(rh[e].description);return[4,d.show()];case 2:_state.sent(),n.setIgnoreInput(!0),r.setIgnoreInput(!1),s.setIgnoreInput(!1),this.gameplay.comboManager.setEmitEvent(!1);_state.label=3;case 3:return[2]}})}),function(e){return n.apply(this,arguments)})},{key:"handleViewResized",value:function value(){var _$e=this.gameplay,t=_$e.board,n=_$e.effectManager,i=rh[this.currentStep].startTile,a=rh[this.currentStep].endTile,o=t.getTileAt(i.x,i.y),r=t.getTileAt(a.x,a.y);if(o&&r){var s=o.node.worldPosition,l=r.node.worldPosition;n.setMaskProperties(0,s,o.node.worldScale),n.setMaskProperties(1,l,r.node.worldScale),this.alignGuideTextBox(),this.alignSkipButton()}}},{key:"alignGuideTextBox",value:function value(){var _$e=this.gameplay.board,t=this.manager.guideTextBox,n=_$e.getTileAt(0,0);if(n){var i=n.node.worldPosition,a=_$e.tilesHolder.getWorldScale(),o=_$e.getTileSize()[1]*a.y,r=a.clone().multiplyScalar(ey);t.node.setWorldScale(r),t.node.setWorldPosition(new Y(t.node.worldPosition.x,(i.y-o/2)/2))}}},{key:"alignSkipButton",value:function value(){var _$e=this.gameplay.board,t=this.manager.guideSkipButton;if(t){var n=_$e.getTileAt(0,_$e.getGridSize()[1]-1);if(n){var i=n.node.worldPosition,a=_$e.tilesHolder.getWorldScale(),o=_$e.getTileSize()[1]*a.y,r=a.clone().multiplyScalar(ey),l=t.getComponent(s).contentSize.height*r.y;t.setWorldScale(r),t.setWorldPosition(new Y(t.worldPosition.x,i.y+(o+l)/2+30))}}}},{key:"close",value:(t=Ee(function(){var _$e,t,n,_,_tmp;return _ts_generator(this,function(_state){switch(_state.label){case 0:_$e=this.gameplay,t=_$e.board,n=_$e.effectManager;this.manager.node.scene.off(Co.GRID_MATCH_SUCCESS,this.showNextStep,this),this.manager.node.scene.off(Co.GRID_MATCH_FAIL,this.showNextStep,this),W.off(Aa,this.handleViewResized,this),W.off(Ia,this.handleViewResized,this),t.setIgnoreInput(!1);_=Promise.all;return[4,this.manager.guideTextBox.hide()];case 1:_tmp=[_state.sent()];return[4,n.setBackgroundMaskActive(!1)];case 2:return[4,_.apply(Promise,[_tmp.concat([_state.sent()])])];case 3:_state.sent(),this.manager.guideHand.node.active=!1,this.manager.completeGuide(jp);return[2]}})}),function(){return t.apply(this,arguments)})}]),e}();n._RF.pop(),n._RF.push({},"a52daB3sGxP8JyGBZo5K1+X","Guide02Timer",void 0);var ny=function(){function e(t){Ce(this,e),this.manager=t,this.gameplay=t.gameplay}var t,n;return Ae(e,[{key:"setup",value:(n=Ee(function(){var _$e,t,n,i,a,o,r,l;return _ts_generator(this,function(_state){switch(_state.label){case 0:_$e=this.manager,t=_$e.guideMasks,n=_$e.guideInfoText,i=this.gameplay.uiManager.clock,a=i.getComponent(s).contentSize,o=a.width,r=a.height,l=i.node.worldPosition;o*=1.5,r*=1.5;return[4,this.gameplay.handleShowUI()];case 1:_state.sent(),t.node.active=!0,t.setOtherMaskTransform(l.x,l.y,o,r),n.node.active=!0,n.string="Remove all tiles before\nthe time end",n.node.setWorldPosition(l.x,l.y-r/2-50,0),n.horizontalAlign=re.CENTER,n.getComponent(s).setAnchorPoint(.5,.5);return[4,t.show()];case 2:_state.sent(),this.manager.node.scene.once(Co.GUIDE_MASK_CLICKED,this.close,this),this.manager.node.scene.emit(Co.PAUSE_TIME),W.on(Aa,this.handleViewResized,this),W.on(Ia,this.handleViewResized,this);return[2]}})}),function(){return n.apply(this,arguments)})},{key:"handleViewResized",value:function value(){var _$e=this.manager,t=_$e.guideMasks,n=_$e.guideInfoText,i=this.gameplay.uiManager.clock,a=i.getComponent(s).contentSize,o=a.width,r=a.height,l=i.node.worldPosition;o*=1.5,r*=1.5,t.setOtherMaskTransform(l.x,l.y,o,r),n.node.setWorldPosition(l.x,l.y-r/2-50,0)}},{key:"close",value:(t=Ee(function(){var _$e,t,n;return _ts_generator(this,function(_state){switch(_state.label){case 0:_$e=this.manager,t=_$e.guideInfoText,n=_$e.guideMasks;this.gameplay.comboManager.setEmitEvent(!0),this.gameplay.stateManager.isPlaying()&&this.manager.node.scene.emit(Co.RESUME_TIME);return[4,n.hide()];case 1:_state.sent(),t.node.active=!1,this.manager.completeGuide(Yp),W.off(Aa,this.handleViewResized,this),W.off(Ia,this.handleViewResized,this);return[2]}})}),function(){return t.apply(this,arguments)})}]),e}();n._RF.pop(),n._RF.push({},"add56o6JFNHAZiCO6F+Z9jK","Guide03Combo",void 0);var iy=function(){function e(t){Ce(this,e),this.manager=t,this.gameplay=t.gameplay}var t,n;return Ae(e,[{key:"setup",value:(n=Ee(function(){var _$e,t,n,i,a,o,r,l;return _ts_generator(this,function(_state){switch(_state.label){case 0:_$e=this.manager,t=_$e.guideMasks,n=_$e.guideInfoText,i=this.gameplay.uiManager.comboContainer,a=i.getComponent(s).contentSize,o=a.width,r=a.height,l=i.worldPosition;o*=1.5,r*=1.5,t.node.active=!0,t.setOtherMaskTransform(l.x,l.y,o,r),n.node.active=!0,n.string="Remove tiles continuously\nto increase combo!",n.node.setWorldPosition(l.x-o/2-10,l.y,0),n.horizontalAlign=re.RIGHT,n.getComponent(s).setAnchorPoint(1,.5);return[4,t.show()];case 1:_state.sent(),this.manager.node.scene.once(Co.GUIDE_MASK_CLICKED,this.close,this),this.manager.node.scene.emit(Co.PAUSE_TIME),W.on(Aa,this.handleViewResized,this),W.on(Ia,this.handleViewResized,this);return[2]}})}),function(){return n.apply(this,arguments)})},{key:"handleViewResized",value:function value(){var _$e=this.manager,t=_$e.guideMasks,n=_$e.guideInfoText,i=this.gameplay.uiManager.comboContainer,a=i.getComponent(s).contentSize,o=a.width,r=a.height,l=i.worldPosition;o*=1.5,r*=1.5,t.setOtherMaskTransform(l.x,l.y,o,r),n.node.setWorldPosition(l.x-o/2-10,l.y,0)}},{key:"close",value:(t=Ee(function(){var _$e,t,n;return _ts_generator(this,function(_state){switch(_state.label){case 0:_$e=this.manager,t=_$e.guideInfoText,n=_$e.guideMasks;this.manager.node.scene.emit(Co.RESUME_TIME),n.node.off(a.EventType.TOUCH_START,this.close,this);return[4,n.hide()];case 1:_state.sent(),t.node.active=!1,this.manager.completeGuide(Xp),W.off(Aa,this.handleViewResized,this),W.off(Ia,this.handleViewResized,this);return[2]}})}),function(){return t.apply(this,arguments)})}]),e}();n._RF.pop(),n._RF.push({},"fd93d+WLXVHk4yJGmVeSjmR","Guide04Hint",void 0);var ay=GameCore.Utils.Array,oy=function(){function e(t){Ce(this,e),this.manager=t,this.gameplay=t.gameplay}var t,n;return Ae(e,[{key:"setup",value:(n=Ee(function(){var _$e,t,n,i,a,o,r,l;return _ts_generator(this,function(_state){switch(_state.label){case 0:_$e=this.manager,t=_$e.guideMasks,n=_$e.guideInfoText,i=ay.search(this.gameplay.itemManager.items,function(e){return e.itemType===tl.HINT});if(!i)return[3,2];a=i.node.worldPosition,o=i.getComponent(s).contentSize,r=o.width,l=o.height;r+=40,l+=40,t.node.active=!0,t.setItemMaskTransform(a.x,a.y,r,l),n.node.active=!0,n.string="Tap to reveal a connectable pair",n.node.setPosition(0,0),n.node.setWorldPosition(n.node.worldPosition.x,a.y+l/2+30,0),n.horizontalAlign=re.CENTER,n.getComponent(s).setAnchorPoint(.5,.5);return[4,t.show()];case 1:_state.sent(),this.manager.node.scene.once(Co.GUIDE_MASK_CLICKED,this.close,this),this.manager.node.scene.emit(Co.PAUSE_TIME),W.on(Aa,this.handleViewResized,this),W.on(Ia,this.handleViewResized,this);_state.label=2;case 2:return[2]}})}),function(){return n.apply(this,arguments)})},{key:"handleViewResized",value:function value(){var _$e=this.manager,t=_$e.guideMasks,n=_$e.guideInfoText,i=ay.search(this.gameplay.itemManager.items,function(e){return e.itemType===tl.HINT});if(i){var a=i.node.worldPosition,o=i.getComponent(s).contentSize,r=o.width,l=o.height;r+=40,l+=40,t.setItemMaskTransform(a.x,a.y,r,l),n.node.setWorldPosition(n.node.worldPosition.x,a.y+l/2+30,0)}}},{key:"close",value:(t=Ee(function(){var _$e,t,n;return _ts_generator(this,function(_state){switch(_state.label){case 0:_$e=this.manager,t=_$e.guideMasks,n=_$e.guideInfoText;this.manager.node.scene.emit(Co.RESUME_TIME);return[4,t.hide()];case 1:_state.sent(),n.node.active=!1,this.manager.completeGuide(Jp),W.off(Aa,this.handleViewResized,this),W.off(Ia,this.handleViewResized,this);return[2]}})}),function(){return t.apply(this,arguments)})}]),e}();n._RF.pop(),n._RF.push({},"b08f4dC/r1EPbsfAe1wtcBg","Guide05Thunder",void 0);var ry=GameCore.Utils.Array,sy=function(){function e(t){Ce(this,e),this.manager=t,this.gameplay=t.gameplay}var t,n;return Ae(e,[{key:"setup",value:(n=Ee(function(){var _$e,t,n,i,a,o,r,l;return _ts_generator(this,function(_state){switch(_state.label){case 0:_$e=this.manager,t=_$e.guideMasks,n=_$e.guideInfoText,i=ry.search(this.gameplay.itemManager.items,function(e){return e.itemType===tl.THUNDER});if(!i)return[3,2];a=i.node.worldPosition,o=i.getComponent(s).contentSize,r=o.width,l=o.height;r+=40,l+=40,t.node.active=!0,t.setItemMaskTransform(a.x,a.y,r,l),n.node.active=!0,n.string="Tap to remove 2 pairs",n.node.setPosition(0,0),n.node.setWorldPosition(n.node.worldPosition.x,a.y+l/2+30,0),n.horizontalAlign=re.CENTER,n.getComponent(s).setAnchorPoint(.5,.5);return[4,t.show()];case 1:_state.sent(),this.manager.node.scene.once(Co.GUIDE_MASK_CLICKED,this.close,this),this.manager.node.scene.emit(Co.PAUSE_TIME),W.on(Aa,this.handleViewResized,this),W.on(Ia,this.handleViewResized,this);_state.label=2;case 2:return[2]}})}),function(){return n.apply(this,arguments)})},{key:"handleViewResized",value:function value(){var _$e=this.manager,t=_$e.guideMasks,n=_$e.guideInfoText,i=ry.search(this.gameplay.itemManager.items,function(e){return e.itemType===tl.THUNDER});if(i){var a=i.node.worldPosition,o=i.getComponent(s).contentSize,r=o.width,l=o.height;r+=40,l+=40,t.setItemMaskTransform(a.x,a.y,r,l),n.node.setWorldPosition(n.node.worldPosition.x,a.y+l/2+30,0)}}},{key:"close",value:(t=Ee(function(){var _$e,t,n;return _ts_generator(this,function(_state){switch(_state.label){case 0:_$e=this.manager,t=_$e.guideMasks,n=_$e.guideInfoText;this.manager.node.scene.emit(Co.RESUME_TIME);return[4,t.hide()];case 1:_state.sent(),n.node.active=!1,this.manager.completeGuide(Qp),W.off(Aa,this.handleViewResized,this),W.off(Ia,this.handleViewResized,this);return[2]}})}),function(){return t.apply(this,arguments)})}]),e}();n._RF.pop(),n._RF.push({},"f4ef8MBZxxKC4bfuDzsLQ5X","Guide06Storm",void 0);var ly=GameCore.Utils.Array,uy=function(){function e(t){Ce(this,e),this.manager=t,this.gameplay=t.gameplay}var t,n;return Ae(e,[{key:"setup",value:(n=Ee(function(){var _$e,t,n,i,a,o,r,l;return _ts_generator(this,function(_state){switch(_state.label){case 0:_$e=this.manager,t=_$e.guideMasks,n=_$e.guideInfoText,i=ly.search(this.gameplay.itemManager.items,function(e){return e.itemType===tl.STORM});if(!i)return[3,2];a=i.node.worldPosition,o=i.getComponent(s).contentSize,r=o.width,l=o.height;r+=40,l+=40,t.node.active=!0,t.setItemMaskTransform(a.x,a.y,r,l),n.node.active=!0,n.string="Tap to rearrange the tiles",n.node.setPosition(0,0),n.node.setWorldPosition(n.node.worldPosition.x,a.y+l/2+30,0),n.horizontalAlign=re.CENTER,n.getComponent(s).setAnchorPoint(.5,.5);return[4,t.show()];case 1:_state.sent(),this.manager.node.scene.once(Co.GUIDE_MASK_CLICKED,this.close,this),this.manager.node.scene.emit(Co.PAUSE_TIME),W.on(Aa,this.handleViewResized,this),W.on(Ia,this.handleViewResized,this);_state.label=2;case 2:return[2]}})}),function(){return n.apply(this,arguments)})},{key:"handleViewResized",value:function value(){var _$e=this.manager,t=_$e.guideMasks,n=_$e.guideInfoText,i=ly.search(this.gameplay.itemManager.items,function(e){return e.itemType===tl.STORM});if(i){var a=i.node.worldPosition,o=i.getComponent(s).contentSize,r=o.width,l=o.height;r+=40,l+=40,t.setItemMaskTransform(a.x,a.y,r,l),n.node.setWorldPosition(n.node.worldPosition.x,a.y+l/2+30,0)}}},{key:"close",value:(t=Ee(function(){var _$e,t,n;return _ts_generator(this,function(_state){switch(_state.label){case 0:_$e=this.manager,t=_$e.guideMasks,n=_$e.guideInfoText;this.manager.node.scene.emit(Co.RESUME_TIME);return[4,t.hide()];case 1:_state.sent(),n.node.active=!1,this.manager.completeGuide(Zp),W.off(Aa,this.handleViewResized,this),W.off(Ia,this.handleViewResized,this);return[2]}})}),function(){return t.apply(this,arguments)})}]),e}();n._RF.pop(),n._RF.push({},"9920dDqYP9ITJp0bSlZ+K9R","Guide07Pliers",void 0);var cy,hy,dy,py,yy,fy,vy,my,gy,by=GameCore.Utils.Array,Sy=function(){function e(t){Ce(this,e),this.manager=t,this.gameplay=t.gameplay}var t,n;return Ae(e,[{key:"setup",value:(n=Ee(function(){var _$e,t,n,i,a,o,r,l;return _ts_generator(this,function(_state){switch(_state.label){case 0:_$e=this.manager,t=_$e.guideMasks,n=_$e.guideInfoText,i=by.search(this.gameplay.itemManager.items,function(e){return e.itemType===tl.PLIERS});if(!i)return[3,2];a=i.node.worldPosition,o=i.getComponent(s).contentSize,r=o.width,l=o.height;r+=40,l+=40,t.node.active=!0,t.setItemMaskTransform(a.x,a.y,r,l),n.node.active=!0,n.string="Tap to remove bomb",n.node.setPosition(0,0),n.node.setWorldPosition(n.node.worldPosition.x,a.y+l/2+30,0),n.horizontalAlign=re.CENTER,n.getComponent(s).setAnchorPoint(.5,.5);return[4,t.show()];case 1:_state.sent(),this.manager.node.scene.once(Co.GUIDE_MASK_CLICKED,this.close,this),this.manager.node.scene.emit(Co.PAUSE_TIME),W.on(Aa,this.handleViewResized,this),W.on(Ia,this.handleViewResized,this);_state.label=2;case 2:return[2]}})}),function(){return n.apply(this,arguments)})},{key:"handleViewResized",value:function value(){var _$e=this.manager,t=_$e.guideMasks,n=_$e.guideInfoText,i=by.search(this.gameplay.itemManager.items,function(e){return e.itemType===tl.PLIERS});if(i){var a=i.node.worldPosition,o=i.getComponent(s).contentSize,r=o.width,l=o.height;r+=40,l+=40,t.setItemMaskTransform(a.x,a.y,r,l),n.node.setWorldPosition(n.node.worldPosition.x,a.y+l/2+30,0)}}},{key:"close",value:(t=Ee(function(){var _$e,t,n;return _ts_generator(this,function(_state){switch(_state.label){case 0:_$e=this.manager,t=_$e.guideMasks,n=_$e.guideInfoText;this.manager.node.scene.emit(Co.RESUME_TIME);return[4,t.hide()];case 1:_state.sent(),n.node.active=!1,this.manager.completeGuide($p),W.off(Aa,this.handleViewResized,this),W.off(Ia,this.handleViewResized,this);return[2]}})}),function(){return t.apply(this,arguments)})}]),e}();n._RF.pop(),n._RF.push({},"8ab11Ocp6VMg5ZkRHXv4Odu","GuideHand",void 0);var wy,ky,Ey,Cy,Ty,Ay,Ry,Iy=i.ccclass,Py=i.property,_y=(cy=Iy("GuideHand"),hy=Py(a),dy=Py(a),py=Py(x),cy((vy=Ye((fy=function(e){Ie(n,e);var t=xe(n);function n(){var _$e;Ce(this,n);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return je(_$e=t.call.apply(t,[this].concat(a)),"hand",vy,Ne(_$e)),je(_$e,"circleHighlight",my,Ne(_$e)),je(_$e,"circleHighlightOpacity",gy,Ne(_$e)),_$e}return Ae(n,[{key:"start",value:function value(){this.circleHighlight.setScale(0,0),this.circleHighlightOpacity.opacity=255}},{key:"playHandAnimation",value:function value(e,t){var _$n=this;this.handTween&&this.handTween.stop();var i=k(this.hand).to(.8,{worldPosition:t},{easing:"quartOut"}).to(.2,{scale:new Y(.9,.9,.9),angle:15}).call(function(){_$n.playHighlightAnimation()}).to(.2,{scale:Y.ONE,angle:0}).to(.8,{worldPosition:e},{easing:"quartOut"}).to(.2,{scale:new Y(.9,.9,.9),angle:15}).call(function(){_$n.playHighlightAnimation()}).to(.2,{scale:Y.ONE,angle:0});this.handTween=k(this.hand).repeatForever(i).start()}},{key:"playHighlightAnimation",value:function value(){this.circleHighlight.setScale(0,0),this.circleHighlightOpacity.opacity=255,this.circleHighlight.position=this.hand.position.clone(),k(this.circleHighlight).to(.6,{scale:new Y(1.5,1.5)},{easing:"quadOut"}).start(),k(this.circleHighlightOpacity).to(.6,{opacity:0},{easing:"quadIn"}).start()}}]),n}(y)).prototype,"hand",[hy],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),my=Ye(fy.prototype,"circleHighlight",[dy],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),gy=Ye(fy.prototype,"circleHighlightOpacity",[py],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),yy=fy))||yy);n._RF.pop(),n._RF.push({},"b2213ccDllApaGIouur6a6b","GameMask",void 0);var Ly,Oy,Dy,Ny,My,xy,By=i.ccclass,Fy=i.property,zy=(wy=By("GameMask"),ky=Fy(s),Ey=Fy(A),wy((Ay=Ye((Ty=function(e){Ie(n,e);var t=xe(n);function n(){var _$e;Ce(this,n);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return je(_$e=t.call.apply(t,[this].concat(a)),"uiTransform",Ay,Ne(_$e)),je(_$e,"sprite",Ry,Ne(_$e)),_$e}return Ae(n,[{key:"texture",get:function get(){return this.sprite.spriteFrame.texture}}]),n}(y)).prototype,"uiTransform",[ky],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ry=Ye(Ty.prototype,"sprite",[Ey],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Cy=Ty))||Cy);n._RF.pop(),n._RF.push({},"ad9c7KiarJHXpRRfn9GOaVx","AlphaMasks",void 0);var Gy,Uy,Hy,Vy,qy,Wy,Ky,jy=i.ccclass,Yy=i.property,Xy=i.executeInEditMode,Jy=(Ly=jy("AlphaMasks"),Oy=Xy(!0),Dy=Yy(zy),Ly(Ny=Oy((xy=Ye((My=function(e){Ie(n,e);var t=xe(n);function n(){var _$e;Ce(this,n);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return je(_$e=t.call.apply(t,[this].concat(a)),"masks",xy,Ne(_$e)),_$e}return Ae(n,[{key:"onLoad",value:function value(){this.UITransform=this.node.getComponent(s)}},{key:"start",value:function value(){this.material=this.getComponent(A).getMaterialInstance(0)}},{key:"update",value:function value(){var _$e=this,t=this.UITransform,_$n=t.width,i=t.height;this.masks.forEach(function(t,a){var o=t.uiTransform,r=o.width,s=o.height,l=o.anchorX,u=o.anchorY,c=r*t.node.scale.x,h=s*t.node.scale.y,d=new Q(c/_$n,h/i),p=new Q(.5+(.5-l)*d.x,.5-(.5-u)*d.y),y=new Q(p.x+(t.node.worldPosition.x-_$e.node.worldPosition.x)/_$n,p.y-(t.node.worldPosition.y-_$e.node.worldPosition.y)/i);_$e.material.setProperty("mask".concat(a,"Texture"),t.texture),_$e.material.setProperty("ratio".concat(a),d),_$e.material.setProperty("center".concat(a),y)})}},{key:"setMaskActive",value:function value(e,t){e>=this.masks.length||this.material.setProperty("useMask".concat(e),t?1:0)}}]),n}(y)).prototype,"masks",[Dy],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return[]}}),Ny=My))||Ny)||Ny);n._RF.pop(),n._RF.push({},"69569cXv55L852IkWTL0swz","GuideMasks",void 0);var Qy,Zy,$y,ef,tf,nf=i.ccclass,af=i.property,of=(Gy=nf("GuideMasks"),Uy=af(Ca),Hy=af(Jy),Gy((Wy=Ye((qy=function(e){Ie(a,e);var t,n,i=xe(a);function a(){var _$e;Ce(this,a);for(var t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];return je(_$e=i.call.apply(i,[this].concat(n)),"background",Wy,Ne(_$e)),je(_$e,"alphaMasks",Ky,Ne(_$e)),_$e}return Ae(a,[{key:"__preload",value:function value(){this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function value(){St.lazyValidateProperties(this)}},{key:"show",value:(n=Ee(function(){return _ts_generator(this,function(_state){switch(_state.label){case 0:this.background.node.active=!0;return[4,this.background.changeStateFade(!0,.25)];case 1:_state.sent();return[2]}})}),function(){return n.apply(this,arguments)})},{key:"hide",value:(t=Ee(function(){return _ts_generator(this,function(_state){switch(_state.label){case 0:return[4,this.background.changeStateFade(!1,.25)];case 1:_state.sent(),this.background.node.active=!1;return[2]}})}),function(){return t.apply(this,arguments)})},{key:"onClick",value:function value(){this.node.scene.emit(Co.GUIDE_MASK_CLICKED)}},{key:"setOtherMaskTransform",value:function value(e,t,n,i){this.alphaMasks.masks[1].node.worldPosition=new Y(-9999,-9999,0);var _$a=this.alphaMasks.masks[0];this.setMaskTransform(_$a,e,t,n,i)}},{key:"setItemMaskTransform",value:function value(e,t,n,i){this.alphaMasks.masks[0].node.worldPosition=new Y(-9999,-9999,0);var _$a=this.alphaMasks.masks[1];this.setMaskTransform(_$a,e,t,n,i)}},{key:"setMaskTransform",value:function value(e,t,n,i,a){e.uiTransform.setContentSize(i,a),e.node.setWorldPosition(t,n,0)}}]),a}(y)).prototype,"background",[Uy],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ky=Ye(qy.prototype,"alphaMasks",[Hy],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Vy=qy))||Vy);n._RF.pop(),n._RF.push({},"abfb9zudJhHdZfeUgbnBrs0","GuideTextBox",void 0);var rf,sf,lf,uf,cf,hf,df,pf,yf,ff,vf,mf,gf,bf=i.ccclass,Sf=i.property,wf=(Qy=bf("GuideTextBox"),Zy=Sf(u),Qy((tf=Ye((ef=function(e){Ie(a,e);var t,n,i=xe(a);function a(){var _$e;Ce(this,a);for(var t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];return je(_$e=i.call.apply(i,[this].concat(n)),"guideText",tf,Ne(_$e)),_$e}return Ae(a,[{key:"__preload",value:function value(){this.opacityToggler=this.getComponent(Ca),St.lazyValidateProperties(this)}},{key:"setText",value:function value(e){this.guideText.string=e}},{key:"show",value:(n=Ee(function(){return _ts_generator(this,function(_state){switch(_state.label){case 0:return[4,this.opacityToggler.changeStateFade(!0)];case 1:_state.sent();return[2]}})}),function(){return n.apply(this,arguments)})},{key:"hide",value:(t=Ee(function(){return _ts_generator(this,function(_state){switch(_state.label){case 0:return[4,this.opacityToggler.changeStateFade(!1)];case 1:_state.sent();return[2]}})}),function(){return t.apply(this,arguments)})}]),a}(y)).prototype,"guideText",[Zy],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),$y=ef))||$y);n._RF.pop(),n._RF.push({},"4d800jyvxFJIYnkeNGud6KJ","GuidelinesManager",void 0);var kf,Ef,Cf,Tf,Af,Rf,If,Pf,_f,Lf,Of,Df,Nf,Mf,xf,Bf,Ff,zf,Gf,Uf=game,Hf=Uf.player,Vf=Uf.analytics,qf=i.ccclass,Wf=i.property,Kf=GameCore,jf=Kf.Plugins.Analytics.Events,Yf=Kf.Utils.Array,Xf=new Q(0,10),Jf=new Q(0,10),Qf="READY",Zf="RUNNING",$f=(rf=qf("GuidelinesManager"),sf=Wf(_y),lf=Wf(wf),uf=Wf(u),cf=Wf(of),hf=Wf(a),rf((yf=Ye((pf=function(e){Ie(i,e);var t,n=xe(i);function i(){var _$e;Ce(this,i);for(var t=arguments.length,a=new Array(t),o=0;o<t;o++)a[o]=arguments[o];return je(_$e=n.call.apply(n,[this].concat(a)),"guideHand",yf,Ne(_$e)),je(_$e,"guideTextBox",ff,Ne(_$e)),je(_$e,"guideInfoText",vf,Ne(_$e)),je(_$e,"guideMasks",mf,Ne(_$e)),je(_$e,"guideSkipButton",gf,Ne(_$e)),_$e.guideHintDelay=null,_$e.guideStormDelay=null,_$e}return Ae(i,[{key:"init",value:function value(e){this.gameplay=e,this.status=Qf,this.node.scene.on(Co.COMBO_UPDATED,this.startComboGuide,this),this.node.scene.on(Co.TILE_CLICK,this.startAutoGuides,this),this.node.scene.on(Co.USE_ITEM,this.handleUseItem,this),this.node.scene.on(Co.GAME_FINISH,this.stopAutoGuides,this),this.node.scene.on(Co.GAME_REPLAY,this.stopAutoGuides,this),this.node.scene.on(Co.GAME_PAUSE,this.stopAutoGuides,this)}},{key:"show",value:function value(){this.isNewbieGuideLevel()?(this.hasGuideItemShowed(jp)&&this.resetGuideItemShowed(),this.startGuide(jp)):this.startGuide(Yp)}},{key:"startGuide",value:function value(e){if(this.status===Zf)return!1;if(this.hasGuideItemShowed(e))return!1;switch(this.addGuideItemShowed(e),this.status=Zf,e){case jp:Vf.event(jf.TUTORIAL_BEGIN),this.guide1=new ty(this),this.guide1.setup();break;case Yp:this.guide2=new ny(this),this.guide2.setup();break;case Xp:this.guide3=new iy(this),this.guide3.setup();break;case Jp:this.guide4=new oy(this),this.guide4.setup();break;case Qp:this.guide5=new sy(this),this.guide5.setup();break;case Zp:this.guide6=new uy(this),this.guide6.setup();break;case $p:this.guide7=new Sy(this),this.guide7.setup()}return!0}},{key:"completeGuide",value:function value(e){Vf.event(jf.TUTORIAL_STEP,{step:e}),this.status=Qf,this.addGuideItemShowed(e),this.gameplay.stateManager.isPlaying()&&this.startAutoGuides()}},{key:"isHintGuideLevel",value:function value(){return this.getCurrentLevel()>=Xf.x&&this.getCurrentLevel()<=Xf.y}},{key:"isShowErrorPathLevel",value:function value(){return this.getCurrentLevel()>=Jf.x&&this.getCurrentLevel()<=Jf.y}},{key:"isNewbieGuideLevel",value:function value(){return 0===this.getCurrentLevel()}},{key:"hasGuideItemShowed",value:function value(e){return Yf.has(this.getGuideItemShowed(),e)}},{key:"addGuideItemShowed",value:function value(e){if(!this.hasGuideItemShowed(e)){var t=this.getGuideItemShowed();t.push(e),Hf.setGameData({guideItemShowed:t})}}},{key:"resetGuideItemShowed",value:function value(){Hf.setGameData({guideItemShowed:[]})}},{key:"getGuideItemShowed",value:function value(){var _$e,t;return null!==(_$e=null===(t=Hf.getGameData())||void 0===t?void 0:t.guideItemShowed)&&void 0!==_$e?_$e:[]}},{key:"getCurrentLevel",value:function value(){return this.gameplay.levelManager.getLevelData().level}},{key:"startComboGuide",value:function value(e){this.isNewbieGuideLevel()||e<2||(this.startGuide(Xp),this.node.scene.off(Co.COMBO_UPDATED,this.startComboGuide,this))}},{key:"startAutoGuides",value:function value(){this.startHintGuide(),this.startStormGuide()}},{key:"stopAutoGuides",value:function value(){null!==this.guideHintDelay&&this.guideHintDelay.stop(),null!==this.guideStormDelay&&this.guideStormDelay.stop()}},{key:"startHintGuide",value:function value(){var _$e=this;this.isHintGuideLevel()&&(null===this.guideHintDelay&&(this.guideHintDelay=new se(this.node).delay(5).call(function(){_$e.isNewbieGuideLevel()||(_$e.hasGuideItemShowed(Jp)&&_$e.status===Qf?_$e.node.scene.emit(Co.SHOW_HINT):_$e.startGuide(Jp),_$e.startHintGuide())})),this.guideHintDelay.stop(),this.guideHintDelay.start())}},{key:"startStormGuide",value:function value(){var _$e=this;null===this.guideStormDelay&&(this.guideStormDelay=new se(this.node).delay(10).call(function(){if(!_$e.isNewbieGuideLevel()&&!_$e.hasGuideItemShowed(Zp)){var t=Yf.search(_$e.gameplay.itemManager.items,function(e){return e.itemType===tl.STORM});t&&t.canActivate()&&(_$e.startGuide(Zp)||_$e.startStormGuide())}})),this.guideStormDelay.stop(),this.guideStormDelay.start()}},{key:"startThunderGuide",value:function value(){return!this.isNewbieGuideLevel()&&this.startGuide(Qp)}},{key:"startPliersGuide",value:function value(){return!this.isNewbieGuideLevel()&&this.startGuide($p)}},{key:"handleUseItem",value:function value(e){switch(this.startAutoGuides(),e){case tl.HINT:this.addGuideItemShowed(Jp);break;case tl.THUNDER:this.addGuideItemShowed(Qp);break;case tl.STORM:this.addGuideItemShowed(Zp);break;case tl.PLIERS:this.addGuideItemShowed($p)}}},{key:"skipNewbieGuide",value:(t=Ee(function(){var _$e;return _ts_generator(this,function(_state){switch(_state.label){case 0:this.guideSkipButton.active=!1;return[4,this.guide1.close()];case 1:_state.sent();_$e=this.getCurrentLevel()+1;Hf.setGameData({level:_$e}),this.node.scene.emit(Co.NEXT_LEVEL);return[2]}})}),function(){return t.apply(this,arguments)})}]),i}(y)).prototype,"guideHand",[sf],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ff=Ye(pf.prototype,"guideTextBox",[lf],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),vf=Ye(pf.prototype,"guideInfoText",[uf],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),mf=Ye(pf.prototype,"guideMasks",[cf],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),gf=Ye(pf.prototype,"guideSkipButton",[hf],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),df=pf))||df);n._RF.pop(),n._RF.push({},"c3d9fl9+INO3ac7Q2zvmRKy","SpecialItem",void 0);var ev,tv=i.ccclass,nv=i.property,iv=(kf=tv("SpecialItem"),Ef=nv({editorOnly:!0,tooltip:"A debug button has infinite quantity"}),Cf=nv({type:d,tooltip:"The button that activates the item"}),Tf=nv({type:g,group:"Quantity",tooltip:"The starting quantity of the item",displayName:"Quantity"}),Af=nv({type:u,group:"Quantity",tooltip:"The label that shows the quantity",displayName:"Label"}),Rf=nv({type:a,group:"Quantity",tooltip:"The node that shows the quantity of the item",displayName:"Quantity node"}),If=nv({type:a,group:"Quantity",tooltip:"The node that shows the plus icon when there is no item",displayName:"Plus node"}),Pf=nv({type:x,group:"Animation"}),_f=nv({type:x,tooltip:"The opacity component of the button",displayName:"Button UI Opacity"}),kf((Df=Ye((Of=function(e){Ie(o,e);var t,n,i,a=xe(o);function o(){var _$e;Ce(this,o);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return je(_$e=a.call.apply(a,[this].concat(n)),"isDevButton",Df,Ne(_$e)),je(_$e,"button",Nf,Ne(_$e)),je(_$e,"quantity",Mf,Ne(_$e)),je(_$e,"quantityLabel",xf,Ne(_$e)),je(_$e,"quantityNode",Bf,Ne(_$e)),je(_$e,"plusNode",Ff,Ne(_$e)),je(_$e,"glowUIOpacity",zf,Ne(_$e)),je(_$e,"uiOpacity",Gf,Ne(_$e)),_$e.requestItem=null,_$e.loadQuantity=null,_$e}return Ae(o,[{key:"itemType",get:function get(){}},{key:"onLoad",value:function value(){this.validateRequiredComponents()}},{key:"init",value:function value(e){var t=this;this.node.scene.on(Co.GRID_CREATE,this.applyActivationStatus,this),this.node.scene.on(Co.GRID_MATCH,this.applyActivationStatus,this),this.node.scene.on(Co.GRID_CLEAR,this.applyActivationStatus,this),this.node.scene.on(Co.IDLE_EXIT,function(){t.button.interactable=!1,t.applyActivationStatus()}),this.node.scene.on(Co.IDLE_ENTER,function(){t.button.interactable=!0,t.applyActivationStatus()})}},{key:"start",value:function value(){var _$e=this.loadQuantity();this.setQuantity(_$e)}},{key:"validateRequiredComponents",value:function value(){St.lazyValidateProperties(this)}},{key:"applyActivationStatus",value:(i=Ee(function(){var _$e;return _ts_generator(this,function(_state){switch(_state.label){case 0:_$e=this.canActivate();this.button.interactable=_$e;return[4,gn.runTweenAsync(k(this.uiOpacity).to(.2,{opacity:_$e?255:128}))];case 1:_state.sent();return[2]}})}),function(){return i.apply(this,arguments)})},{key:"activate",value:(n=Ee(function(){return _ts_generator(this,function(_state){this.quantity<=0?this.requestItem():(this.vibrate(),this.setQuantity(this.quantity-1));return[2]})}),function(){return n.apply(this,arguments)})},{key:"canActivate",value:function value(){return!1}},{key:"setQuantity",value:function value(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.isDevButton)return this.quantityLabel.string="i",this.quantityNode.active=!0,this.plusNode.active=!1,void this.applyActivationStatus();e<0&&(e=0),this.quantity=e,this.quantityLabel.string="".concat(this.quantity),e<=0?(this.quantityNode.active=!1,this.plusNode.active=!0):(this.quantityNode.active=!0,this.plusNode.active=!1),t&&this.animateAddItem(),this.applyActivationStatus(),this.saveQuantity()}},{key:"getQuantity",value:function value(){return this.quantity}},{key:"saveQuantity",value:function value(){var _$e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.getQuantity(),t=arguments.length>1?arguments[1]:void 0;this.isDevButton||t&&this.setQuantity(_$e,t.animate)}},{key:"vibrate",value:function value(){var _$e;null===(_$e=I("Vibrate"))||void 0===_$e||null===(_$e=_$e.getComponent(Zs))||void 0===_$e||_$e.vibrate(50)}},{key:"animateAddItem",value:(t=Ee(function(){return _ts_generator(this,function(_state){return[2,(this.glowUIOpacity.opacity=0,Promise.all([gn.runTweenAsync(k(this.node).to(.1,{scale:new Y(1.15,1.15,1.15)},{easing:"cubicOut"}).delay(.2).to(.7,{scale:Y.ONE},{easing:"elasticOut"})),gn.runTweenAsync(k(this.glowUIOpacity).to(.1,{opacity:100}).delay(.2).to(.6,{opacity:0}))]))]})}),function(){return t.apply(this,arguments)})}]),o}(y)).prototype,"isDevButton",[Ef],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return!1}}),Nf=Ye(Of.prototype,"button",[Cf],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Mf=Ye(Of.prototype,"quantity",[Tf],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return 0}}),xf=Ye(Of.prototype,"quantityLabel",[Af],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Bf=Ye(Of.prototype,"quantityNode",[Rf],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ff=Ye(Of.prototype,"plusNode",[If],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),zf=Ye(Of.prototype,"glowUIOpacity",[Pf],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Gf=Ye(Of.prototype,"uiOpacity",[_f],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Lf=Of))||Lf);n._RF.pop(),n._RF.push({},"e1fd9AcoshNdK0i6vow/F2P","ItemManager",void 0);var av,ov=(0,i.ccclass)("ItemManager")(ev=function(e){Ie(n,e);var t=xe(n);function n(){var _$e;Ce(this,n);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return(_$e=t.call.apply(t,[this].concat(a))).sceneItems=new Set,_$e}return Ae(n,[{key:"items",get:function get(){return He(this.sceneItems)}},{key:"onLoad",value:function value(){this.syncItems()}},{key:"syncItems",value:function value(){var _$e=this,t=I("Canvas/UI");t&&t.getComponentsInChildren(iv).forEach(function(t){t.node.activeInHierarchy&&_$e.sceneItems.add(t)})}}]),n}(y))||ev;n._RF.pop(),n._RF.push({},"bbe87JDGgVEkJdgCL2ydwxX","LevelManager",void 0);var rv,sv=i.ccclass,lv=GameCore.Utils,uv=lv.Device,cv=(lv.String,{level:1,mode:"normal",time:900,colors:12,specials:{bomb:0,rocket:0},rules:{maxSpaceOfPair:1,addRandomTilesPerMove:0},columns:5,rows:6,theme:["flower"]}),hv=sv("LevelManager")(av=function(e){Ie(a,e);var t,n,i=xe(a);function a(){return Ce(this,a),i.apply(this,arguments)}return Ae(a,[{key:"loadLevel",value:(n=Ee(function(){var _$e,t,n,i,_$a,o,r,s;var _arguments=arguments;return _ts_generator(this,function(_state){switch(_state.label){case 0:_$e=_arguments.length>0&&void 0!==_arguments[0]?_arguments[0]:1,t=_arguments.length>1&&void 0!==_arguments[1]?_arguments[1]:Fl;return[4,this.loadLevelData(_$e)];case 1:n=_state.sent();this.levelData=n||this.levelData||cv;i=this.levelData,_$a=i.rows,o=i.columns;uv.isMobile()&&o>=6&&_$a>=10&&(this.levelData.columns=5,this.levelData.rows=10);r="".concat(Fn.TILE_SKIN_FOLDER,"/").concat(t);return[4,li.loadSpriteFramesDirAsync(r)];case 2:s=_state.sent();return[2,s]}})}),function(){return n.apply(this,arguments)})},{key:"loadLevelData",value:(t=Ee(function(){var _$e,t,n,i,_$a;var _arguments=arguments;return _ts_generator(this,function(_state){switch(_state.label){case 0:_$e=_arguments.length>0&&void 0!==_arguments[0]?_arguments[0]:1,t=10,n=this.paddingZero("".concat(Math.floor(_$e/t)+1),3),i=_$e%t;return[4,li.loadJsonAsync("".concat(Fn.LEVEL_DATA_FOLDER,"/").concat(n))];case 1:_$a=_state.sent();return[2,_$a?_$a[i]:null]}})}),function(){return t.apply(this,arguments)})},{key:"getLevelData",value:function value(){return this.levelData}},{key:"paddingZero",value:function value(e,t){for(var n="",i=0;i<t-e.length;i++)n+="0";return n+e}}]),a}(y))||av;n._RF.pop(),n._RF.push({},"3f8fenpEyBKaaNxBYL5960v","ScoreManager",void 0);var dv=i.ccclass,pv=GameCore.Match.Modes,yv=dv("ScoreManager")(rv=function(e){Ie(i,e);var t,n=xe(i);function i(){var _$e;Ce(this,i);for(var t=arguments.length,a=new Array(t),o=0;o<t;o++)a[o]=arguments[o];return(_$e=n.call.apply(n,[this].concat(a))).currentScore=0,_$e.tournamentStartScore=0,_$e}return Ae(i,[{key:"addScore",value:function value(e,t,n){var _$i=this.getLevelMultiplier(t),a=this.getComboMultiplier(n),o=Math.floor(this.currentScore+e*_$i*a),r=10*Math.ceil(o/10);this.setScore(r)}},{key:"init",value:function value(){this.initCurrentScore(),this.updateScore()}},{key:"initCurrentScore",value:function value(){var _$e=uu.getMatchMode();this.currentScore=_$e===pv.TOURNAMENT?this.tournamentStartScore:0}},{key:"setScore",value:function value(e){this.currentScore=e,this.updateScore()}},{key:"updateTournamentStartScore",value:function value(){this.tournamentStartScore=this.currentScore}},{key:"updateScore",value:(t=Ee(function(){return _ts_generator(this,function(_state){this.node.scene.emit(Co.SCORE_UPDATED,this.currentScore);return[2]})}),function(){return t.apply(this,arguments)})},{key:"getCurrentScore",value:function value(){return this.currentScore}},{key:"getLevelMultiplier",value:function value(e){return 1+.1*(e-1)}},{key:"getComboMultiplier",value:function value(e){return 1+.1*(e-1)}}]),i}(y))||rv;n._RF.pop(),n._RF.push({},"4a4bfX6KIJCcIozlNHuAwoi","AdsUtils",void 0);var fv=GameCore,vv=fv.Configs,mv=fv.Plugins.Ads,gv=mv.Types,bv=mv.Status,Sv=fv.Utils.Array,wv=globalThis.game.ads,kv=function(){function e(){Ce(this,e)}var t,n,i;return Ae(e,[{key:"canbeShowInSDK",value:function value(){var _$e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=GameSDK.getSDKName();return(null==t||!t.length||!Sv.has(t,n))&&!(null!=_$e&&_$e.length&&!Sv.has(_$e,n))}}],[{key:"inst",get:function get(){return this._instance||(this._instance=new e),this._instance}},{key:"preloadAds",value:(i=Ee(function(){var _$e,t,n,i,a,o;return _ts_generator(this,function(_state){_$e=vv.Ads,t=_$e.Enabled,n=_$e.InterstitialAdOptions,i=_$e.RewardedVideoAdOptions;if(t){a=gv.INTERSTITIAL,o=gv.REWARDED_VIDEO;n.forEach(function(e){var t=e.PlacementId;wv.loadAdAsync(a,t).catch(function(){})}),i.forEach(function(e){var t=e.PlacementId;wv.loadAdAsync(o,t).catch(function(){})})}return[2]})}),function(){return i.apply(this,arguments)})},{key:"showBannerAds",value:function value(){var _$e=vv.Ads,t=_$e.Enabled,n=_$e.BannerDisplayAdOptions;if(t){var i=le.instance.getVisibleSize(),a=ua.worldSizeToCssSize(i.height*$s);"MsGames"!==GameSDK.getSDKName()?n.forEach(function(e){var t=e.PlacementId,n=e.Position,i=e.BannerHeight;"bottom"===n&&i>a||wv.showBannerAdAsync(t).catch(function(e){})}):wv.showBannerAdAsync().catch(function(e){})}}},{key:"hideBannerAds",value:function value(){var _$e=vv.Ads,t=_$e.Enabled,n=_$e.BannerDisplayAdOptions;t&&n.forEach(function(e){var t=e.PlacementId;wv.hideBannerAdAsync(t).catch(function(e){})})}},{key:"showInterstitialAdAsync",value:(n=Ee(function(e){var t,n,i,a,o,_tmp,e1,r;return _ts_generator(this,function(_state){switch(_state.label){case 0:t=e.forLevel,n=void 0===t?1:t,i=e.includeSDK,a=e.excludeSDK;if(!this.inst.canbeShowInSDK(i,a))return[2,!1];if(vv.Gameplay.StartAdAtLevel>=n)return[2,!1];if(!wv.canbeShowInterstitialAd())return[2,!1];o=Date.now();_state.label=1;case 1:_state.trys.push([1,5,6,7]);Pi.muteAudio(!0),Mu.showLoadingNotificationScreen();_tmp=wv.getAdStatus(gv.INTERSTITIAL)!==bv.FILLED;if(!_tmp)return[3,3];return[4,wv.loadAdAsync(gv.INTERSTITIAL)];case 2:_tmp=_state.sent();_state.label=3;case 3:_tmp;return[4,wv.showAdAsync(gv.INTERSTITIAL)];case 4:return[2,(_state.sent(),!0)];case 5:e1=_state.sent();return[2,(console.warn("showInterstitialAdAsync failed",e1),!1)];case 6:Pi.muteAudio(!1);r=(Date.now()-o)/1e3;setTimeout(function(){Mu.closeNotificationScreen()},r>.5?0:.5),wv.loadAdAsync(gv.INTERSTITIAL).catch(function(){});return[7];case 7:return[2]}})}),function(e){return n.apply(this,arguments)})},{key:"showRewardVideoAdAsync",value:(t=Ee(function(e){var t,n,_tmp,e1;return _ts_generator(this,function(_state){switch(_state.label){case 0:t=e.includeSDK,n=e.excludeSDK;if(!this.inst.canbeShowInSDK(t,n))return[2,!1];_state.label=1;case 1:_state.trys.push([1,5,6,7]);Pi.muteAudio(!0),Mu.showLoadingNotificationScreen();_tmp=wv.getAdStatus(gv.REWARDED_VIDEO)!==bv.FILLED;if(!_tmp)return[3,3];return[4,wv.loadAdAsync(gv.REWARDED_VIDEO)];case 2:_tmp=_state.sent();_state.label=3;case 3:_tmp;return[4,wv.showAdAsync(gv.REWARDED_VIDEO)];case 4:return[2,(_state.sent(),Mu.closeNotificationScreen(),!0)];case 5:e1=_state.sent();return[2,(console.warn("showRewardVideoAdAsync failed",e1),_instanceof(e1,Object)&&"code"in e1&&"USER_INPUT"===e1.code?Mu.showNotificationScreen("Sorry, no rewards!\n You have cancelled the ad.",2):Mu.showNotificationScreen("No ads to display.",2),!1)];case 6:Pi.muteAudio(!1),wv.loadAdAsync(gv.REWARDED_VIDEO).catch(function(){});return[7];case 7:return[2]}})}),function(e){return t.apply(this,arguments)})}]),e}();try{new kv}catch(e){console.error("AdsUtils",e)}n._RF.pop(),n._RF.push({},"e6116mseMNPD6VcLUtkvez6","BaseState",void 0);var Ev=function(){function e(t){Ce(this,e),this.game=null,this.data={},this.game=t.getGameplay(),this.manager=t,this.updateStateData(),this.logDebug()}return Ae(e,[{key:"logDebug",value:function value(){var _$e=this.constructor.name;console.info("[STATE] ".concat(_$e),this.data)}},{key:"updateStateData",value:function value(){if(this.game){var _$e=this.game.getGameData();_$e&&(this.data=_$e)}}},{key:"updateGameData",value:function value(e){var t;null===(t=this.game)||void 0===t||t.setGameData(e)}}]),e}();n._RF.pop(),n._RF.push({},"e4ee7Ho9zJPVKobpdsCwGlp","FailState",void 0);var Cv=globalThis.game,Tv=Cv.analytics,Av=Cv.monitorError,Rv=Cv.match,Iv=Cv.player,Pv=Cv.storage,_v=GameCore,Lv=_v.Match.Modes,Ov=_v.Dtos.Match.Data,Dv=function(e){Ie(s,e);var t,n,i,a,o,r=xe(s);function s(e,t){var n;return Ce(this,s),n=r.call(this,e),Pi.stopAllSounds(),n.vibrateDevice(),n.pauseCountdown(),n.updateMatchCustomData(),n.handleGameOver(t),n.logLevelFailAnalytics(),n}return Ae(s,[{key:"pauseCountdown",value:function value(){var _$e;null===(_$e=this.game)||void 0===_$e||_$e.uiManager.pauseTime()}},{key:"vibrateDevice",value:function value(){var _$e;null===(_$e=I("Vibrate"))||void 0===_$e||null===(_$e=_$e.getComponent(Zs))||void 0===_$e||_$e.vibrate(500)}},{key:"handleGameOver",value:(o=Ee(function(e){var t;return _ts_generator(this,function(_state){switch(_state.label){case 0:t=uu.getMatchMode();if(!(li.setBlockInput(!0),t===Lv.SINGLE))return[3,2];return[4,this.handleTournamentCreateFlow()];case 1:return[2,(_state.sent(),void this.showFailScreen(e))];case 2:if(!(t===Lv.TOURNAMENT))return[3,4];return[4,this.handleTournamentGameOver()];case 3:_state.sent();return[3,6];case 4:if(t!==Lv.CHALLENGE_FRIEND)return[2,void this.showFailScreen(e)];return[4,this.handleChallengeGameOver()];case 5:_state.sent();_state.label=6;case 6:li.setBlockInput(!1);return[2]}})}),function(e){return o.apply(this,arguments)})},{key:"handleTournamentCreateFlow",value:(a=Ee(function(){var e;return _ts_generator(this,function(_state){switch(_state.label){case 0:_state.trys.push([0,2,,3]);return[4,uu.processCreateTournamentAsync()];case 1:_state.sent();return[3,3];case 2:e=_state.sent();if(_instanceof(e,Ml))return[2];return[2,(_instanceof(e,Nl)&&(null==Av||Av.sendException(e)),void console.error(e))];case 3:return[2]}})}),function(){return a.apply(this,arguments)})},{key:"handleTournamentGameOver",value:(i=Ee(function(){var _$e,t,n,i,a,o,r,_$s,l,e;return _ts_generator(this,function(_state){switch(_state.label){case 0:n=this,i=null===(_$e=uu.getMatchCustomData())||void 0===_$e?void 0:_$e.tournamentId;if(!i)return[3,5];if(Wu.validateTournamentExpired(i))return[2,(Pv.setStorageData("tournament","animateTournamentLeader",!1),Mu.showNotificationScreen("Tournament has ended",2),void(null===(a=this.game)||void 0===a||a.scheduleOnce(function(){var _$e;null===(_$e=n.game)||void 0===_$e||_$e.node.scene.emit(Co.GAME_EXIT)},2)))];_state.label=1;case 1:_state.trys.push([1,3,,4]);return[4,uu.finishMatchAsync()];case 2:_state.sent();_$s=Rv.getMatchState().profiles,l=null!==(o=Pv.getStorageData("tournament","previousScore"))&&void 0!==o?o:0;(null!==(r=_$s[Iv.getPlayerId()].score)&&void 0!==r?r:0)>l&&Pv.setStorageData("tournament","animateTournamentLeader",!0);return[3,4];case 3:e=_state.sent();console.warn(e);return[3,4];case 4:null===(t=this.game)||void 0===t||t.node.scene.emit(Co.GAME_EXIT);_state.label=5;case 5:return[2]}})}),function(){return i.apply(this,arguments)})},{key:"handleChallengeGameOver",value:(n=Ee(function(){var _$e,t,n,e;return _ts_generator(this,function(_state){switch(_state.label){case 0:_state.trys.push([0,3,,4]);_$e=Rv.getMatchState().id;return[4,Rv.api.getMatchAPI().getMatchDetailByIdAsync(_$e)];case 1:t=_state.sent(),n=new Ov(t).toObject().extraData;return[4,uu.finishMatchAsync({extraData:null!=n?n:void 0})];case 2:_state.sent();return[3,4];case 3:e=_state.sent();console.warn(e);return[3,4];case 4:this.game.node.scene.emit(Co.SHOW_CHALLENGE_RESULTS);return[2]}})}),function(){return n.apply(this,arguments)})},{key:"showFailScreen",value:(t=Ee(function(e){var t,_tmp;return _ts_generator(this,function(_state){switch(_state.label){case 0:t=this.data.level;_tmp=this.game;if(!_tmp)return[3,2];return[4,kv.showInterstitialAdAsync({forLevel:t})];case 1:_tmp=_state.sent();_state.label=2;case 2:_tmp,Pi.turnOffMusic(),e===ju&&Pi.playSound(vi.LEVEL_FAIL_TIMEOUT),Pi.playSound(vi.LEVEL_FAIL),Mu.openScreen(ki.RESCUES_SCREEN,{level:t,failKey:e});return[2]}})}),function(e){return t.apply(this,arguments)})},{key:"updateMatchCustomData",value:function value(){var _$e,t,n=this.data.level,i=void 0===n?1:n,a=null!==(_$e=null===(t=this.game)||void 0===t?void 0:t.scoreManager.getCurrentScore())&&void 0!==_$e?_$e:0;uu.updateMatchStateAfterLevelFinish(i,a)}},{key:"logLevelFailAnalytics",value:function value(){if(this.game){var _$e=this.data.level,t=void 0===_$e?0:_$e,n=this.game.scoreManager.getCurrentScore();Tv.levelFail(t,n)}}},{key:"initialize",value:function value(){var _$e=this.manager.createInitializeState(this.manager);this.manager.change(_$e)}},{key:"ready",value:function value(){}},{key:"playing",value:function value(){var _$e=this.manager.createPlayingState(this.manager);this.manager.change(_$e)}},{key:"fail",value:function value(){}},{key:"finish",value:function value(){var _$e=this.manager.createFinishState(this.manager);this.manager.change(_$e)}},{key:"update",value:function value(){}}]),s}(Ev);n._RF.pop(),n._RF.push({},"a9bc11SkV9L/5L+Y+fhswfJ","FinishState",void 0);var Nv=globalThis.game,Mv=Nv.analytics,xv=Nv.player,Bv=Nv.leaderboard,Fv=Nv.match,zv=Nv.monitorError,Gv=GameCore.Match.Modes,Uv=function(e){Ie(s,e);var t,n,i,a,o,r=xe(s);function s(e){var t;return Ce(this,s),(t=r.call(this,e)).handleFinishStateFlow(),t}return Ae(s,[{key:"handleFinishStateFlow",value:(o=Ee(function(){var _$e,t,_tmp;return _ts_generator(this,function(_state){switch(_state.label){case 0:this.processCrazyGamesEvent(),this.attemptCallCreateShortcut(),Pi.turnUpMusic(),null===(_$e=this.game)||void 0===_$e||_$e.uiManager.pauseTime();t=uu.getMatchMode();t!==Gv.CHALLENGE_FRIEND&&this.updatePlayerProgress(),this.updateMatchCustomData(),this.handlePostScoreToLeaderboard();if(!(t===Gv.CHALLENGE_FRIEND))return[3,1];_tmp=this.handleChallengeOver();return[3,3];case 1:return[4,this.handleTournamentCreateFlow()];case 2:_tmp=(_state.sent(),this.showLevelCompleteScreen());_state.label=3;case 3:_tmp,this.logLevelCompleteAnalytics();return[2]}})}),function(){return o.apply(this,arguments)})},{key:"handleChallengeOver",value:(a=Ee(function(){var _$e,t,e;return _ts_generator(this,function(_state){switch(_state.label){case 0:_state.trys.push([0,3,,5]);_$e=Fv.getMatchState().id;return[4,uu.getMatchExtraDataAsync(_$e)];case 1:t=_state.sent();return[4,uu.finishMatchAsync({extraData:null!=t?t:void 0})];case 2:_state.sent();return[3,5];case 3:e=_state.sent();console.warn(e);return[4,uu.finishMatchAsync()];case 4:_state.sent();return[3,5];case 5:this.game.node.scene.emit(Co.SHOW_CHALLENGE_RESULTS);return[2]}})}),function(){return a.apply(this,arguments)})},{key:"processCrazyGamesEvent",value:function value(){"gameplayStop"in GameSDK.extra&&GameSDK.extra.gameplayStop()}},{key:"updateMatchCustomData",value:function value(){var _$e,t,n=this.data.level,i=void 0===n?1:n,a=null!==(_$e=null===(t=this.game)||void 0===t?void 0:t.scoreManager.getCurrentScore())&&void 0!==_$e?_$e:0;uu.updateMatchStateAfterLevelFinish(i,a)}},{key:"logLevelCompleteAnalytics",value:function value(){if(this.game){var _$e=this.data.level,t=void 0===_$e?0:_$e,n=this.game.scoreManager.getCurrentScore();Mv.levelComplete(t,n)}}},{key:"showLevelCompleteScreen",value:(i=Ee(function(){var _$e,t,n,i;return _ts_generator(this,function(_state){n=this.data.level;Pi.turnOffMusic(),Pi.playSound(vi.LEVEL_COMPLETE);i=null!==(_$e=null===(t=xv.getGameData())||void 0===t?void 0:t.coins)&&void 0!==_$e?_$e:0;Mu.openScreen(ki.LEVEL_COMPLETE_SCREEN,{level:n,currentCoin:i});return[2]})}),function(){return i.apply(this,arguments)})},{key:"updatePlayerProgress",value:function value(){if(this.game){var _$e=this.data.level;if(_$e){var t=_$e+1,n=xv.getGameData();if(n){var i=n.totalLevel,a=n.level,o=Math.max(a,t),r=we({},n);o<i&&(r.level=o),xv.setGameData(r)}}}}},{key:"attemptCallCreateShortcut",value:function value(){var _$e=this.data.level;(void 0===_$e?0:_$e)<2||"checkAndCreateShortcutAsync"in GameSDK.extra&&GameSDK.extra.checkAndCreateShortcutAsync().catch(function(e){console.warn("createShortcutAsync",e)})}},{key:"handleTournamentCreateFlow",value:(n=Ee(function(){var _$e,t,n,e;return _ts_generator(this,function(_state){switch(_state.label){case 0:if(!(uu.getMatchMode()===Gv.SINGLE))return[3,4];_$e=xv.getGameData();if(!_$e)return[3,4];t=_$e.lastCreateTournamentShown,n=void 0===t?0:t;if(!(Date.now()-n>3e5))return[3,4];_state.label=1;case 1:_state.trys.push([1,3,,4]);return[4,uu.processCreateTournamentAsync()];case 2:_state.sent();return[3,4];case 3:e=_state.sent();if(_instanceof(e,Ml))return[2];return[2,(_instanceof(e,Nl)&&(null==zv||zv.sendException(e)),void console.error(e))];case 4:return[2]}})}),function(){return n.apply(this,arguments)})},{key:"handlePostScoreToLeaderboard",value:(t=Ee(function(){var _$e,t,e,n,i,a,_tmp;return _ts_generator(this,function(_state){switch(_state.label){case 0:if(!(uu.getMatchMode()===Gv.TOURNAMENT))return[3,7];t=null===(_$e=this.game)||void 0===_$e?void 0:_$e.scoreManager.getCurrentScore();if(!t)return[3,7];_state.label=1;case 1:_state.trys.push([1,3,,4]);return[4,GameSDK.tournament.postScoreAsync(t)];case 2:_state.sent();return[3,4];case 3:e=_state.sent();console.warn("GameSDK post score async",e);return[3,4];case 4:n=uu.getMatchCustomData();if(!n)return[3,7];i=n.leaderboardId,a=n.playerId;_tmp=i&&a;if(!_tmp)return[3,6];return[4,Bv.setLeaderboardScoreAsync(i,a,t)];case 5:_tmp=_state.sent();_state.label=6;case 6:_tmp;_state.label=7;case 7:return[2]}})}),function(){return t.apply(this,arguments)})},{key:"initialize",value:function value(){var _$e=this.manager.createInitializeState(this.manager);this.manager.change(_$e)}},{key:"ready",value:function value(){}},{key:"playing",value:function value(){}},{key:"fail",value:function value(){}},{key:"finish",value:function value(){}},{key:"update",value:function value(){}}]),s}(Ev);n._RF.pop(),n._RF.push({},"37a5cRy3ANBGpVlH3wyS3Ra","InitializeState",void 0);var Hv=globalThis.game,Vv=Hv.player,qv=Hv.match,Wv=GameCore.Match.Modes,Kv=function(e){Ie(a,e);var t,n,i=xe(a);function a(e){var t;return Ce(this,a),(t=i.call(this,e)).handleSingleGameStart=function(){var _$e=Ee(function(e){var n,i,_$a,o;return _ts_generator(this,function(_state){switch(_state.label){case 0:i=t.game.levelManager.getLevelData(),_$a=t.data.level,o=Vv.getPlayerId();return[4,Promise.all([uu.setMatchCustomDataAsync({level:_$a,score:0}),uu.setProfileMatchDataAsync({id:o,score:0})])];case 1:_state.sent(),t.game.board.create(e,i),t.game.board.setIgnoreInput(!0);return[4,t.game.board.animateTilesAppear()];case 2:_state.sent(),null!==(n=t.game.guidelinesManager)&&void 0!==n&&n.isNewbieGuideLevel()||t.game.board.setIgnoreInput(!1),t.ready();return[2]}})});return function(t){return _$e.apply(this,arguments)}}(),t.enableUI(),t.clearBoard(),t.loadLevel(),t.initCountdown(),t.initScore(),t}return Ae(a,[{key:"enableUI",value:function value(){var _$e;null===(_$e=this.game)||void 0===_$e||_$e.uiManager.enableHeader()}},{key:"clearBoard",value:function value(){this.game&&(this.game.rescueTiles=[],this.game.board.destroyTiles(),this.game.pathDraw.clearMatchPath())}},{key:"loadLevel",value:(n=Ee(function(){var _$e,t,n,i,_$a,o,r,e,s,l;return _ts_generator(this,function(_state){switch(_state.label){case 0:if(!this.game)return[3,9];_$e=uu.getMatchMode();_state.label=1;case 1:_state.trys.push([1,7,,9]);if(!(_$e===Wv.CHALLENGE_FRIEND))return[3,4];t=qv.getMatchState().id;return[4,uu.getMatchExtraDataAsync(t)];case 2:n=_state.sent();if(null==n)throw new Error("Match mode ".concat(Wv.CHALLENGE_FRIEND," but no extraData (for opponent initialization) was found in match data."));i=this.getLevelSkin(n.level);return[4,this.game.levelManager.loadLevel(n.level,i)];case 3:_$a=_state.sent();this.updateGameData({level:n.level,levelData:this.game.levelManager.getLevelData()}),Pi.playSound(vi.LEVEL_START),this.handleChallengeFriendGameStart(_$a,n);return[3,6];case 4:o=this.getLevelSkin(this.data.level);return[4,this.game.levelManager.loadLevel(this.data.level,o)];case 5:r=_state.sent();this.updateGameData({levelData:this.game.levelManager.getLevelData()}),Pi.playSound(vi.LEVEL_START),this.handleSingleGameStart(r);_state.label=6;case 6:return[3,9];case 7:e=_state.sent();console.error("Error loading level:",e);s=this.getLevelSkin(this.data.level);return[4,this.game.levelManager.loadLevel(this.data.level,s)];case 8:l=_state.sent();this.updateGameData({levelData:this.game.levelManager.getLevelData()}),Pi.playSound(vi.LEVEL_START),this.handleSingleGameStart(l);return[3,9];case 9:return[2]}})}),function(){return n.apply(this,arguments)})},{key:"getLevelSkin",value:function value(e){var t=Yl.getLevelSkin(e),n=Yl.getUnlockedSkins();if(n.length<=1)return t;if(z.random()<=.5)return t;var i=n.indexOf(t);return n.splice(i,1),n[z.randomRangeInt(0,n.length)]}},{key:"handleChallengeFriendGameStart",value:(t=Ee(function(e,t){var n,i,_$a,o,r,s,l;return _ts_generator(this,function(_state){switch(_state.label){case 0:n=this.game.levelManager.getLevelData(),i=t.level,_$a=t.fen,o=t.gravity,r=t.rules,s=t.time,l=Vv.getPlayerId();return[4,Promise.all([uu.setMatchCustomDataAsync({level:i,score:0}),uu.setProfileMatchDataAsync({id:l,score:0})])];case 1:_state.sent(),this.game.board.create(e,we(we({},n),{},{level:i,customFen:_$a,mode:o,rules:r,time:s})),this.game.board.setIgnoreInput(!0);return[4,this.game.board.animateTilesAppear()];case 2:_state.sent(),this.game.board.setIgnoreInput(!1),this.ready();return[2]}})}),function(e,n){return t.apply(this,arguments)})},{key:"initScore",value:function value(){this.game&&this.game.scoreManager.init()}},{key:"initCountdown",value:function value(){this.game&&this.game.uiManager.initCountdown()}},{key:"initialize",value:function value(){}},{key:"ready",value:function value(){var _$e=this.manager.createReadyState(this.manager);this.manager.change(_$e)}},{key:"pause",value:function value(){}},{key:"playing",value:function value(){}},{key:"fail",value:function value(){}},{key:"finish",value:function value(){}},{key:"update",value:function value(){}}]),a}(Ev);n._RF.pop(),n._RF.push({},"e3b372NaI5HvY5HnTleBQKd","PlayingState",void 0);var jv=function(e){Ie(n,e);var t=xe(n);function n(e){var i;return Ce(this,n),(i=t.call(this,e)).startCountdown(),i}return Ae(n,[{key:"startCountdown",value:function value(){var _$e;null===(_$e=this.game)||void 0===_$e||_$e.uiManager.startCountdown()}},{key:"initialize",value:function value(){var _$e=this.manager.createInitializeState(this.manager);this.manager.change(_$e)}},{key:"ready",value:function value(){var _$e=this.manager.createReadyState(this.manager);this.manager.change(_$e)}},{key:"playing",value:function value(){}},{key:"fail",value:function value(e){var t=this.manager.createFailState(this.manager,e);this.manager.change(t)}},{key:"finish",value:function value(){var _$e=this.manager.createFinishState(this.manager);this.manager.change(_$e)}},{key:"update",value:function value(){this.updateStateData()}}]),n}(Ev);n._RF.pop(),n._RF.push({},"5ef69tJ5eNNv7o22H/XfSD2","ReadyState",void 0);var Yv,Xv=globalThis.game,Jv=Xv.analytics,Qv=Xv.match,Zv=GameCore.Utils.Valid,$v=function(e){Ie(n,e);var t=xe(n);function n(e){var i;return Ce(this,n),i=t.call(this,e),Pi.stopAllSounds(),Pi.turnDownMusic(),i.handleGuideFlow(),i.setLevelText(),i.setLevelTime(),i.setGridPlayable(),i.logLevelStartAnalytics(),i}return Ae(n,[{key:"initialize",value:function value(){var _$e=this.manager.createInitializeState(this.manager);this.manager.change(_$e)}},{key:"ready",value:function value(){}},{key:"playing",value:function value(){var _$e=this.manager.createPlayingState(this.manager);this.manager.change(_$e)}},{key:"fail",value:function value(e){if(Zv.isDebugger()){var t=this.manager.createFailState(this.manager);this.manager.change(t)}}},{key:"finish",value:function value(){if(Zv.isDebugger()){var _$e=this.manager.createFinishState(this.manager);this.manager.change(_$e)}}},{key:"update",value:function value(){}},{key:"setGridPlayable",value:function value(){var _$e;null!==(_$e=this.manager.getGameplay().guidelinesManager)&&void 0!==_$e&&_$e.isNewbieGuideLevel()||this.manager.getGameplay().board.setIgnoreInput(!1)}},{key:"handleGuideFlow",value:function value(){var _$e,t;null!==(_$e=this.game.guidelinesManager)&&void 0!==_$e&&_$e.isNewbieGuideLevel()||this.game.handleShowUI(),null===(t=this.game.guidelinesManager)||void 0===t||t.show()}},{key:"setLevelTime",value:function value(){if(this.game){var _$e=this.data.levelData;_$e&&this.game.uiManager.setCountdownTime(_$e.time)}}},{key:"setLevelText",value:function value(){if(this.game){var _$e=this.data.level,t=void 0===_$e?0:_$e;this.game.uiManager.setLevelText(t)}}},{key:"logLevelStartAnalytics",value:function value(){if(this.game){var _$e=this.data.level,t=void 0===_$e?0:_$e,_$n=Qv.getMatchState().customData.score,i=void 0===_$n?0:_$n;Jv.levelStart(t,i)}}}]),n}(Ev);n._RF.pop(),n._RF.push({},"bb0e3beWSxOOLCv7gjyg2s0","StateManager",void 0);var em,tm,nm,im,am,om=(0,i.ccclass)("StateManager")(Yv=function(e){Ie(n,e);var t=xe(n);function n(){return Ce(this,n),t.apply(this,arguments)}return Ae(n,[{key:"getGameplay",value:function value(){return this.gameplay}},{key:"init",value:function value(e){this.gameplay=e,this.state=new Kv(this)}},{key:"change",value:function value(e){this.state=e}},{key:"initialize",value:function value(){this.state.initialize()}},{key:"isInitialize",value:function value(){return _instanceof(this.state,Kv)}},{key:"ready",value:function value(){this.state.ready()}},{key:"isReady",value:function value(){return _instanceof(this.state,$v)}},{key:"playing",value:function value(){this.state.playing()}},{key:"isPlaying",value:function value(){return _instanceof(this.state,jv)}},{key:"fail",value:function value(e){this.state.fail(e)}},{key:"isFail",value:function value(){return _instanceof(this.state,Dv)}},{key:"finish",value:function value(){this.state.finish()}},{key:"isFinished",value:function value(){return _instanceof(this.state,Uv)}},{key:"update",value:function value(e){this.state&&this.state.update(e)}},{key:"createInitializeState",value:function value(){for(var _$e=arguments.length,t=new Array(_$e),_$n=0;_$n<_$e;_$n++)t[_$n]=arguments[_$n];return Oe(Kv,t)}},{key:"createReadyState",value:function value(){for(var _$e=arguments.length,t=new Array(_$e),_$n=0;_$n<_$e;_$n++)t[_$n]=arguments[_$n];return Oe($v,t)}},{key:"createPlayingState",value:function value(){for(var _$e=arguments.length,t=new Array(_$e),_$n=0;_$n<_$e;_$n++)t[_$n]=arguments[_$n];return Oe(jv,t)}},{key:"createFailState",value:function value(){for(var _$e=arguments.length,t=new Array(_$e),_$n=0;_$n<_$e;_$n++)t[_$n]=arguments[_$n];return Oe(Dv,t)}},{key:"createFinishState",value:function value(){for(var _$e=arguments.length,t=new Array(_$e),_$n=0;_$n<_$e;_$n++)t[_$n]=arguments[_$n];return Oe(Uv,t)}}]),n}(y))||Yv;n._RF.pop(),n._RF.push({},"659a5DHz/dCjaYaS9/4ZunE","Digit",void 0);var rm,sm,lm,um,cm,hm,dm,pm=i.ccclass,ym=i.property,fm=(em=pm("Digit"),tm=ym(u),em((am=Ye((im=function(e){Ie(n,e);var t=xe(n);function n(){var _$e;Ce(this,n);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return je(_$e=t.call.apply(t,[this].concat(a)),"numberLabels",am,Ne(_$e)),_$e.labelUITransforms=[],_$e.labelUIOpacitys=[],_$e.previousNumber=0,_$e}return Ae(n,[{key:"onLoad",value:function value(){this.uiTransform=this.getComponent(s),this.labelUITransforms=this.numberLabels.map(function(e){return e.getComponent(s)}),this.labelUIOpacitys=this.numberLabels.map(function(e){return e.getComponent(x)}),St.lazyValidateProperties(this)}},{key:"setNumber",value:function value(e){this.previousNumber!==e&&(this.labelUIOpacitys[this.previousNumber].opacity=0,this.numberLabels[e].node.active||(this.numberLabels[e].node.active=!0),this.labelUIOpacitys[e].opacity=255,this.uiTransform.setContentSize(this.labelUITransforms[e].contentSize),this.previousNumber=e)}}]),n}(y)).prototype,"numberLabels",[tm],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return[]}}),nm=im))||nm);n._RF.pop(),n._RF.push({},"9e40aEq56tMKLFoeACyl+eH","Clock",void 0);var vm,mm=i.ccclass,gm=i.disallowMultiple,bm=i.property,Sm=(rm=mm("Clock"),sm=bm(a),lm=bm(fm),rm(um=gm((hm=Ye((cm=function(e){Ie(n,e);var t=xe(n);function n(){var _$e;Ce(this,n);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return je(_$e=t.call.apply(t,[this].concat(a)),"clockIcon",hm,Ne(_$e)),je(_$e,"digits",dm,Ne(_$e)),_$e.time=0,_$e.remaining=0,_$e.running=!1,_$e.halfTime=!1,_$e.handleUpdateConfig=function(t){_$e.enabled&&console.log("Clock: handleUpdateConfig",t)},_$e.refillTime=function(){var t=Date.now(),_$n=k(_$e.node).to(.5,{scale:new Y(1.1,1.1,1)}),i=k(_$e.node).to(.5,{scale:new Y(1,1,1)}),a=k(_$e.clockIcon).to(.15,{angle:-15},{easing:"cubicOut"}).to(.15,{angle:0},{easing:"cubicIn"}).to(.15,{angle:15},{easing:"cubicOut"}).to(.15,{angle:0},{easing:"cubicIn"}),o=k(_$e.clockIcon).repeat(5,a),r=k(_$e.node).to(3,{position:new Y(0,0,0)},{onUpdate:function onUpdate(){var _$n=Date.now(),i=(_$n-t)/3e3>1?1:(_$n-t)/3e3,a=z.lerp(0,120,i);_$e.setTime(a)}}).call(function(){_$e.setTime(120),i.start(),_$e.node.scene.emit(Co.RESCUE_FINISHED)});k(_$e.node).parallel(_$n,r).start(),o.start()},_$e}return Ae(n,[{key:"__preload",value:function value(){this.listenEvents()}},{key:"start",value:function value(){this.init()}},{key:"init",value:function value(){this.running=!1,this.halfTime=!1}},{key:"listenEvents",value:function value(){this.node.scene.on(Pa,this.handleUpdateConfig),this.node.scene.on(Co.RESCUE_START,this.refillTime)}},{key:"setTime",value:function value(e){this.time=e,this.updateTimeLabel(e),this.remaining=e}},{key:"startCountdown",value:function value(){this.running=!0,this.remaining=this.time}},{key:"pause",value:function value(){this.running=!1}},{key:"resume",value:function value(){this.running=!0}},{key:"endCountDown",value:function value(){this.running=!1,this.remaining=0,this.node.scene.emit(Co.TIME_OUT)}},{key:"update",value:function value(e){this.running&&(this.remaining<=0?this.endCountDown():(this.remaining-=e,!this.halfTime&&this.remaining<=this.time/2&&(this.halfTime=!0,this.node.scene.emit(Co.HALF_TIME)),this.remaining>=0&&this.updateTimeLabel(this.remaining)))}},{key:"updateTimeLabel",value:function value(e){for(var t=this.convertSecondsToMmSs(e),_$n=0;_$n<t.length;_$n++)this.digits[_$n].setNumber(parseInt(t[_$n]))}},{key:"convertSecondsToMmSs",value:function value(e){var t=Math.floor(e/60),_$n=Math.floor(e%60),i=this.padZero(t),a=this.padZero(_$n);return"".concat(i).concat(a)}},{key:"padZero",value:function value(e){return e<10?"0".concat(e):"".concat(e)}}]),n}(y)).prototype,"clockIcon",[sm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),dm=Ye(cm.prototype,"digits",[lm],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return[]}}),um=cm))||um)||um);n._RF.pop(),n._RF.push({},"ed00dMDxYRJP4fZMawN9JnW","ComboProgressBar",void 0);var wm,km,Em,Cm,Tm,Am,Rm,Im,Pm,_m=i.ccclass,Lm=_m("ComboProgressBar")(vm=function(e){Ie(n,e);var t=xe(n);function n(){return Ce(this,n),t.apply(this,arguments)}return Ae(n,[{key:"start",value:function value(){this.progressBar=this.getComponent(xr),this.opacity=this.getComponent(x),this.comboTimer=0,this.isActive=!1,this.node.scene.on(Co.COMBO_UPDATED,this.handleComboUpdated,this)}},{key:"update",value:function value(e){this.isActive&&(this.comboTimer>0?(this.comboTimer-=e,this.progressBar.progress=this.comboTimer/3):(this.isActive=!1,this.opacity.opacity=0,this.node.scene.emit(Co.COMBO_ENDED)))}},{key:"handleComboUpdated",value:function value(e){0===e?this.opacity.opacity=0:e>0&&(this.isActive=!0,this.comboTimer=3),e>1&&(this.opacity.opacity=255)}},{key:"pause",value:function value(){this.isActive=!1}},{key:"resume",value:function value(){this.isActive=!0}}]),n}(y))||vm;n._RF.pop(),n._RF.push({},"46f05OkhTtGz6xBJuPMZGqH","ScoreBlock",void 0);var Om,Dm,Nm,Mm,xm,Bm,Fm,zm,Gm,Um,Hm,Vm,qm,Wm,Km,jm,Ym,Xm=i.ccclass,Jm=i.property,Qm=GameCore.Utils.Image,Zm=(wm=Xm("ScoreBlock"),km=Jm(A),Em=Jm(D),Cm=Jm(u),wm((Rm=Ye((Am=function(e){Ie(a,e);var t,n,i=xe(a);function a(){var _$e;Ce(this,a);for(var t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];return je(_$e=i.call.apply(i,[this].concat(n)),"avatar",Rm,Ne(_$e)),je(_$e,"defaultAvatar",Im,Ne(_$e)),je(_$e,"scoreText",Pm,Ne(_$e)),_$e}return Ae(a,[{key:"onLoad",value:function value(){this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function value(){St.lazyValidateProperties(this)}},{key:"updateInfo",value:(n=Ee(function(e,t){var n,i,e1;return _ts_generator(this,function(_state){switch(_state.label){case 0:t?(this.score=t,this.scoreText.string=t.toString()):(this.score=0,this.scoreText.string="0");_state.label=1;case 1:_state.trys.push([1,3,,4]);return[4,Qm.loadImage(e)];case 2:n=_state.sent();if(!n)return[2];i=D.createWithImage(n);i.packable=!0,this.avatar.spriteFrame=i;return[3,4];case 3:e1=_state.sent();this.avatar.spriteFrame=this.defaultAvatar;return[3,4];case 4:return[2]}})}),function(e,t){return n.apply(this,arguments)})},{key:"updateScore",value:(t=Ee(function(e){var t,n,i;return _ts_generator(this,function(_state){switch(_state.label){case 0:t=this,n=e-this.score,i=k(this.node).to(.1,{},{onUpdate:function onUpdate(e,i){if(i){var _$a=Math.floor(n*i)+t.score;t.scoreText.string=_$a.toString()}}});return[4,gn.runTweenAsync(i)];case 1:_state.sent(),this.scoreText.string=e.toString(),this.score=e;return[2]}})}),function(e){return t.apply(this,arguments)})}]),a}(y)).prototype,"avatar",[km],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Im=Ye(Am.prototype,"defaultAvatar",[Em],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Pm=Ye(Am.prototype,"scoreText",[Cm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Tm=Am))||Tm);n._RF.pop(),n._RF.push({},"61791zAr2tJR4p22EZ5QRfk","Header",void 0);var $m,eg,tg,ng,ig,ag=i.ccclass,og=i.property,rg=globalThis.game.match,sg=(Om=ag("Header"),Dm=og(u),Nm=og(a),Mm=og(a),xm=og(a),Bm=og(a),Fm=og(Zm),zm=og(Zm),Om((Hm=Ye((Um=function(e){Ie(n,e);var t=xe(n);function n(){var _$e;Ce(this,n);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return je(_$e=t.call.apply(t,[this].concat(a)),"levelText",Hm,Ne(_$e)),je(_$e,"settingNode",Vm,Ne(_$e)),je(_$e,"homeNode",qm,Ne(_$e)),je(_$e,"leftNode",Wm,Ne(_$e)),je(_$e,"coinNode",Km,Ne(_$e)),je(_$e,"playerScoreBlock",jm,Ne(_$e)),je(_$e,"opponentScoreBlock",Ym,Ne(_$e)),_$e.challengeScoreBlockShown=!1,_$e}return Ae(n,[{key:"onLoad",value:function value(){this.validateRequiredComponents(),this.listenGameEvents()}},{key:"listenGameEvents",value:function value(){this.node.scene.on(Co.SCORE_UPDATED,this.updateScore,this)}},{key:"unlistenGameEvents",value:function value(){this.node.scene.off(Co.SCORE_UPDATED,this.updateScore,this)}},{key:"validateRequiredComponents",value:function value(){St.lazyValidateProperties(this)}},{key:"handleClickedPauseGame",value:function value(){this.showSettingScreen(),this.node.scene.emit(Co.GAME_PAUSE)}},{key:"handleReturnHome",value:function value(){Mu.openScreen(ki.QUIT_LEVEL_SCREEN),this.node.scene.emit(Co.GAME_PAUSE)}},{key:"highlightCoinContainer",value:function value(){var _$e=I("Canvas/Screens");if(_$e){var t=this.coinNode.worldPosition.clone();this.coinNode.parent=_$e,this.coinNode.worldPosition=t}}},{key:"removeCoinContainerHighlight",value:function value(){var _$e=this.coinNode.worldPosition.clone();this.coinNode.parent=this.leftNode,this.coinNode.worldPosition=_$e}},{key:"showSettingScreen",value:function value(){Mu.openScreen(ki.SETTINGS_SCREEN,{})}},{key:"setLevelText",value:function value(e){this.levelText.string="Level ".concat(e)}},{key:"setButtonsSelectable",value:function value(){var _$e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.enableBtnNode(this.settingNode,_$e,!0),this.enableBtnNode(this.homeNode,_$e,!0)}},{key:"showChallengeScoreBlock",value:function value(){if(!this.challengeScoreBlockShown){this.challengeScoreBlockShown=!0;var _$e=rg.getMatchState(),t=_$e.id,_$n=_$e.customData,i=_$n.playerId,a=_$n.opponentId;if(t&&i&&a){this.playerScoreBlock.node.active=!0,this.opponentScoreBlock.node.active=!0;var o=_$e.profiles[i],r=_$e.profiles[a];this.playerScoreBlock.updateInfo(o.photo,o.score),this.opponentScoreBlock.updateInfo(r.photo,r.score)}}}},{key:"hideChallengeScoreBlock",value:function value(){this.challengeScoreBlockShown&&(this.challengeScoreBlockShown=!1,this.playerScoreBlock.node.active=!1,this.opponentScoreBlock.node.active=!1)}},{key:"enableBtnNode",value:function value(e,t,n){var i=e.getComponent(d);if(i&&(i.interactable=t),e.active=n,n)e.getComponent(Ca)}},{key:"updateScore",value:function value(e){this.challengeScoreBlockShown&&this.playerScoreBlock.updateScore(e)}},{key:"onDestroy",value:function value(){this.unlistenGameEvents()}}]),n}(y)).prototype,"levelText",[Dm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Vm=Ye(Um.prototype,"settingNode",[Nm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),qm=Ye(Um.prototype,"homeNode",[Mm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Wm=Ye(Um.prototype,"leftNode",[xm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Km=Ye(Um.prototype,"coinNode",[Bm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),jm=Ye(Um.prototype,"playerScoreBlock",[Fm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ym=Ye(Um.prototype,"opponentScoreBlock",[zm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Gm=Um))||Gm);n._RF.pop(),n._RF.push({},"396015KIPBL3bHTUOHN7pCl","UIMasks",void 0);var lg=i.ccclass,ug=i.property,cg=($m=lg("UIMasks"),eg=ug(Ca),$m((ig=Ye((ng=function(e){Ie(a,e);var t,n,i=xe(a);function a(){var _$e;Ce(this,a);for(var t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];return je(_$e=i.call.apply(i,[this].concat(n)),"background",ig,Ne(_$e)),_$e}return Ae(a,[{key:"__preload",value:function value(){this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function value(){St.lazyValidateProperties(this)}},{key:"show",value:(n=Ee(function(){return _ts_generator(this,function(_state){switch(_state.label){case 0:this.background.node.active=!0;return[4,this.background.changeStateFade(!0,.25)];case 1:_state.sent();return[2]}})}),function(){return n.apply(this,arguments)})},{key:"hide",value:(t=Ee(function(){return _ts_generator(this,function(_state){switch(_state.label){case 0:return[4,this.background.changeStateFade(!1,.25)];case 1:_state.sent(),this.background.node.active=!1;return[2]}})}),function(){return t.apply(this,arguments)})}]),a}(y)).prototype,"background",[eg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),tg=ng))||tg);n._RF.pop(),n._RF.push({},"805dbJxaCpKBpzq9ejSgrc8","TileType",void 0);var hg,dg,pg,yg,fg,vg="bomb";n._RF.pop(),n._RF.push({},"151afQBVDpOYpTjtwP+wYH+","DevTools",void 0);var mg,gg,bg,Sg,wg,kg,Eg,Cg,Tg,Ag,Rg,Ig,Pg,_g,Lg,Og,Dg,Ng,Mg,xg=GameCore,Bg=xg.Dtos.Player,Fg=xg.Utils.Function,zg=i.ccclass,Gg=i.property,Ug=globalThis.game.player,Hg=(hg=zg("DevToolsContainer"),dg=Gg(a),hg((fg=Ye((yg=function(e){Ie(o,e);var t,n,i,a=xe(o);function o(){var _$e;Ce(this,o);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return je(_$e=a.call.apply(a,[this].concat(n)),"devToolsToggle",fg,Ne(_$e)),_$e.isActive=!0,_$e.game=null,_$e.debouncedStarsNotification=Fg.debounce(function(){var _$e=Ug.getGameData();_$e&&Mu.showNotificationScreen("Stars added. Current stars: ".concat(_$e.stars))},700),_$e}return Ae(o,[{key:"injectGameplay",value:function value(e){this.game=e}},{key:"hideAllButtons",value:function value(){var _$e=this;this.getComponentsInChildren(d).forEach(function(t){var n=t.node.parent;n&&n.name!==_$e.devToolsToggle.name&&(n.active=!1)})}},{key:"showAllButtons",value:function value(){var _$e=this;this.getComponentsInChildren(d).forEach(function(t){var n=t.node.parent;n&&n.name!==_$e.devToolsToggle.name&&(n.active=!0)})}},{key:"handleClickDevToolsButton",value:function value(){this.isActive?(this.hideAllButtons(),this.isActive=!1):(this.showAllButtons(),this.isActive=!0)}},{key:"handleResetData",value:function value(){Ug.setPlayerData(Bg.Data.getDefaultData()),Mu.openScreen(ki.NOTIFICATION_SCREEN,{duration:3,message:"Items and stars will only be reset if you refresh the game page now."}),this.node.scene.emit(Co.START_OVER)}},{key:"handleNextLevel",value:(i=Ee(function(){var _$e,t,n,i;return _ts_generator(this,function(_state){i=(null!==(_$e=null===(t=this.game)||void 0===t||null===(t=t.getGameData())||void 0===t?void 0:t.level)&&void 0!==_$e?_$e:1)+1;null===(n=this.game)||void 0===n||n.setGameData({level:i-1}),Ug.setGameData({level:i}),this.node.scene.emit(Co.NEXT_LEVEL);return[2]})}),function(){return i.apply(this,arguments)})},{key:"handlePrevLevel",value:(n=Ee(function(){var _$e,t,n,i;return _ts_generator(this,function(_state){i=Math.max((null!==(_$e=null===(t=this.game)||void 0===t||null===(t=t.getGameData())||void 0===t?void 0:t.level)&&void 0!==_$e?_$e:2)-1,1);null===(n=this.game)||void 0===n||n.setGameData({level:i-1}),Ug.setGameData({level:i}),this.node.scene.emit(Co.NEXT_LEVEL);return[2]})}),function(){return n.apply(this,arguments)})},{key:"handleEnterSelectLevel",value:(t=Ee(function(e){var t,n;return _ts_generator(this,function(_state){n=Number(e.string);null===(t=this.game)||void 0===t||t.setGameData({level:n-1}),Ug.setGameData({level:n}),this.node.scene.emit(Co.NEXT_LEVEL);return[2]})}),function(e){return t.apply(this,arguments)})},{key:"handleClickBuildVersionButton",value:function value(){var _$e=globalThis.game.getBuildVersion();Mu.showNotificationScreen("Build version: ".concat(_$e))}},{key:"handleClickWinLevelButton",value:function value(){this.node.scene.emit(Co.GAME_FINISH)}},{key:"handleClickTimeOutButton",value:function value(){this.node.scene.emit(Co.TIME_OUT)}},{key:"handleClickExplodeButton",value:function value(){var _$e,t,n=this.game;if(n){var i=null===(_$e=n.getGameData())||void 0===_$e||null===(_$e=_$e.levelData)||void 0===_$e?void 0:_$e.specials.bomb;if(i&&!(i<=0)){var a=n.board.getBombTiles();if(0!==a.length){var _$o=a[0];if((null===(t=_$o.special)||void 0===t?void 0:t.type)!==vg)throw new Error("Invalid bomb tile");_$o.special.detonateImmediately()}else console.info("No bomb tiles found")}}}},{key:"handleFillItem",value:function value(){this.node.scene.emit(Co.ADD_ITEM,{animate:function animate(){return Promise.resolve()},item:tl.HINT,quantity:2}),this.node.scene.emit(Co.ADD_ITEM,{animate:function animate(){return Promise.resolve()},item:tl.STORM,quantity:2}),this.node.scene.emit(Co.ADD_ITEM,{animate:function animate(){return Promise.resolve()},item:tl.THUNDER,quantity:2}),this.node.scene.emit(Co.ADD_ITEM,{animate:function animate(){return Promise.resolve()},item:tl.PLIERS,quantity:2})}},{key:"handleAutoPlay",value:function value(){this.node.scene.emit(Co.AUTO_PLAY)}},{key:"handleAddStars",value:function value(){var _$e=Ug.getGameData();_$e&&(Ug.setGameData({stars:_$e.stars+10}),this.debouncedStarsNotification())}},{key:"handleSwitchBundle",value:function value(){W.emit(Na)}}]),o}(y)).prototype,"devToolsToggle",[dg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),pg=yg))||pg);n._RF.pop(),n._RF.push({},"a3b0f6zU+1D97PyszsgST1H","UIManager",void 0);var Vg,qg,Wg,Kg,jg,Yg,Xg,Jg,Qg,Zg=i.ccclass,$g=i.property,eb=GameCore,tb=eb.Utils.Valid,nb=eb.Match.Modes,ib=globalThis.game.match,ab=(mg=Zg("UIManager"),gg=$g(Sm),bg=$g(sg),Sg=$g(Hg),wg=$g(Lm),kg=$g(a),Eg=$g(cg),Cg=$g([a]),Tg=$g([a]),mg((Ig=Ye((Rg=function(e){Ie(r,e);var t,n,i,a,o=xe(r);function r(){var _$e;Ce(this,r);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return je(_$e=o.call.apply(o,[this].concat(n)),"clock",Ig,Ne(_$e)),je(_$e,"header",Pg,Ne(_$e)),je(_$e,"devTools",_g,Ne(_$e)),je(_$e,"comboProgressBar",Lg,Ne(_$e)),je(_$e,"comboContainer",Og,Ne(_$e)),je(_$e,"uiMasks",Dg,Ne(_$e)),je(_$e,"topAnimNodes",Ng,Ne(_$e)),_$e.originTopNodesPos=[],je(_$e,"botAnimNodes",Mg,Ne(_$e)),_$e.originBotNodesPos=[],_$e.hideBotWorldY=-80,_$e.entranceSignal=new Bn,_$e.exitSignal=new Bn,_$e.showDevTools=function(){_$e.devTools&&(_$e.devTools.node.active=!0)},_$e}return Ae(r,[{key:"onLoad",value:function value(){var _$e=this;this.validateRequiredComponents(),this.listensDevToolsEvents(),this.listenRescueEvents(),p.once(Z.EVENT_AFTER_UPDATE,function(){_$e.saveOriginPos(),_$e.initUIPos()})}},{key:"validateRequiredComponents",value:function value(){St.lazyValidateProperties(this)}},{key:"saveOriginPos",value:function value(){var _$e=this;this.topAnimNodes.forEach(function(t){_$e.originTopNodesPos.push(t.position.clone())}),this.botAnimNodes.forEach(function(t){_$e.originBotNodesPos.push(t.position.clone())})}},{key:"initUIPos",value:function value(){var _$e=this;this.topAnimNodes.forEach(function(t,n){var i=_$e.originTopNodesPos[n].clone();i.y+=200,t.setPosition(i)});var t=new Y(0,this.hideBotWorldY,0);this.botAnimNodes.forEach(function(n,i){var a,o,_$r=_$e.originBotNodesPos[i].clone();t.y=_$e.hideBotWorldY;var s=null!==(a=null===(o=n.parent)||void 0===o?void 0:o.inverseTransformPoint(t,t).y)&&void 0!==a?a:200;_$r.y=s,n.setPosition(_$r)})}},{key:"listensDevToolsEvents",value:function value(){this.node.scene.on(hl.Events.UNLOCK_DEV_TOOLS,this.showDevTools)}},{key:"listenRescueEvents",value:function value(){this.node.scene.on(Co.RESCUE_START,this.showRescueAnimation,this),this.node.scene.on(Co.RESCUE_FINISHED,this.hideRescueAnimation,this)}},{key:"initDevTools",value:function value(e){var t=this;window.addEventListener("reset-game-data",function(){var _$e;null===(_$e=t.devTools)||void 0===_$e||_$e.handleResetData()}),this.devTools&&(this.devTools.node.active=tb.isDebugger(),this.devTools.injectGameplay(e))}},{key:"setLevelText",value:function value(e){this.header.setLevelText(e)}},{key:"initCountdown",value:function value(){this.clock.init()}},{key:"setCountdownTime",value:function value(e){this.clock.setTime(e)}},{key:"startCountdown",value:function value(){this.clock.startCountdown()}},{key:"pauseTime",value:function value(){this.comboProgressBar.pause(),this.clock.pause()}},{key:"resumeTime",value:function value(){this.comboProgressBar.resume(),this.clock.resume()}},{key:"setComboUI",value:function value(e){this.comboContainer.getComponent(Ca).changeStateFade(e,.1)}},{key:"disableHeader",value:function value(){this.header.setButtonsSelectable(!1)}},{key:"enableHeader",value:function value(){this.header.setButtonsSelectable()}},{key:"updateStatus",value:function value(){ib.getMatchState().mode===nb.CHALLENGE_FRIEND?this.header.showChallengeScoreBlock():this.header.hideChallengeScoreBlock()}},{key:"showRescueAnimation",value:(a=Ee(function(){return _ts_generator(this,function(_state){switch(_state.label){case 0:return[4,this.uiMasks.show()];case 1:_state.sent();return[2]}})}),function(){return a.apply(this,arguments)})},{key:"hideRescueAnimation",value:(i=Ee(function(){return _ts_generator(this,function(_state){switch(_state.label){case 0:return[4,this.uiMasks.hide()];case 1:_state.sent();return[2]}})}),function(){return i.apply(this,arguments)})},{key:"playExitAnimUI",value:(n=Ee(function(){var _$e,t,n;return _ts_generator(this,function(_state){switch(_state.label){case 0:_$e=this;this.entranceSignal.abort(),this.exitSignal.abort(),this.exitSignal=new Bn;t=[];this.topAnimNodes.forEach(function(n,i){var a=new Y(n.position.x,_$e.originTopNodesPos[i].y+200,0),o=k(n);o.to(.17,{position:a},{easing:"backIn"}),t.push(gn.runTweenAsync(o,_$e.exitSignal))});n=new Y(0,this.hideBotWorldY,0);this.botAnimNodes.forEach(function(i){var a,o;n.y=_$e.hideBotWorldY;var _$r=null!==(a=null===(o=i.parent)||void 0===o?void 0:o.inverseTransformPoint(n,n).y)&&void 0!==a?a:200,s=new Y(i.position.x,_$r,0),l=k(i);l.to(.17,{position:s},{easing:"backIn"}),t.push(gn.runTweenAsync(l,_$e.exitSignal))});return[4,Promise.all(t)];case 1:_state.sent(),this.exitSignal.aborted||(this.header.node.active=!1);return[2]}})}),function(){return n.apply(this,arguments)})},{key:"playEntranceAnimUI",value:(t=Ee(function(){var _$e,t;return _ts_generator(this,function(_state){switch(_state.label){case 0:_$e=this;this.exitSignal.abort(),this.entranceSignal.abort(),this.entranceSignal=new Bn,this.header.node.active=!0;t=[];this.topAnimNodes.forEach(function(n,i){var a=new Y(n.position.x,_$e.originTopNodesPos[i].y,0),o=k(n);o.to(.2,{position:a},{easing:"backOut"}),t.push(gn.runTweenAsync(o,_$e.entranceSignal))}),this.botAnimNodes.forEach(function(n,i){var a=new Y(n.position.x,_$e.originBotNodesPos[i].y,0),o=k(n);o.to(.2,{position:a},{easing:"backOut"}),t.push(gn.runTweenAsync(o,_$e.entranceSignal))});return[4,Promise.all(t)];case 1:_state.sent();return[2]}})}),function(){return t.apply(this,arguments)})},{key:"highlightCoinContainer",value:function value(){this.header.highlightCoinContainer()}},{key:"unHighlightCoinContainer",value:function value(){this.header.removeCoinContainerHighlight()}},{key:"setInteractableItemButtons",value:function value(){var _$e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.botAnimNodes.forEach(function(t){var n=t.getComponent(iv);if(n){if(!_$e)return void(n.button.interactable=!1);n.canActivate()&&(n.button.interactable=!0)}})}}]),r}(y)).prototype,"clock",[gg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Pg=Ye(Rg.prototype,"header",[bg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_g=Ye(Rg.prototype,"devTools",[Sg],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return null}}),Lg=Ye(Rg.prototype,"comboProgressBar",[wg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Og=Ye(Rg.prototype,"comboContainer",[kg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Dg=Ye(Rg.prototype,"uiMasks",[Eg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ng=Ye(Rg.prototype,"topAnimNodes",[Cg],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return[]}}),Mg=Ye(Rg.prototype,"botAnimNodes",[Tg],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return[]}}),Ag=Rg))||Ag);n._RF.pop(),n._RF.push({},"157f203vjtMma2FDvAlyM6h","Gameplay",void 0);var ob=globalThis.game,rb=ob.player,sb=ob.ads,lb=ob.event,ub=ob.match,cb=ob.storage,hb=ob.analytics,db=ob.monitorError,pb=ob.frameCapture,yb=ob.leaderboard,fb=GameCore,vb=fb.Events,mb=fb.Utils,gb=mb.Time,bb=mb.Array,Sb=fb.Configs.Gameplay,wb=fb.Match.Modes,kb=i.ccclass,Eb=i.property,Cb=[];Vg=kb("Gameplay"),qg=Eb(Qh),Wg=Eb(Ca),Kg=Eb(Hd),Vg((Xg=Ye((Yg=function(e){Ie(i,e);var t,n=xe(i);function i(){var _$e;Ce(this,i);for(var t=arguments.length,a=new Array(t),o=0;o<t;o++)a[o]=arguments[o];return je(_$e=n.call.apply(n,[this].concat(a)),"board",Xg,Ne(_$e)),je(_$e,"opacityToggler",Jg,Ne(_$e)),je(_$e,"pathDraw",Qg,Ne(_$e)),_$e.gameData=null,_$e.defaultData={level:1,isMatchStartFromLoader:!1},_$e.rescueTiles=[],_$e.isAutoPlayEnabled=!1,_$e.handleOpenScreen=function(t){t.screenName===Ei[ki.GET_ITEM_SCREEN]&&_$e.uiManager.highlightCoinContainer()},_$e.handleShowUI=Ee(function(){return _ts_generator(this,function(_state){switch(_state.label){case 0:_$e.uiManager.updateStatus(),_$e.uiManager.disableHeader(),_$e.uiManager.setInteractableItemButtons(!1);return[4,_$e.uiManager.playEntranceAnimUI()];case 1:_state.sent(),_$e.uiManager.enableHeader(),_$e.uiManager.setInteractableItemButtons(!0);return[2]}})}),_$e.handleHideUI=Ee(function(){return _ts_generator(this,function(_state){switch(_state.label){case 0:_$e.uiManager.disableHeader(),_$e.uiManager.setInteractableItemButtons(!1);return[4,_$e.uiManager.playExitAnimUI()];case 1:_state.sent();return[2]}})}),_$e.handleCloseScreen=function(t){t.screenName===Ei[ki.GET_ITEM_SCREEN]&&_$e.uiManager.unHighlightCoinContainer()},_$e.handlePauseGame=function(){_$e.node.scene.emit(Co.PAUSE_TIME),_$e.node.pauseSystemEvents(!0),_$e.opacityToggler.changeStateFade(!1,.1),_$e.uiManager.setComboUI(!1),_$e.processCrazyGamesGameplayStop()},_$e.handleResumeGame=function(){var t;_$e.node.resumeSystemEvents(!0),_$e.stateManager.isPlaying()&&_$e.node.scene.emit(Co.RESUME_TIME),_$e.processCrazyGamesGameplayStart(),_$e.opacityToggler.changeStateFade(!0,.1),_$e.uiManager.setComboUI(!0),null===(t=_$e.guidelinesManager)||void 0===t||t.startAutoGuides()},_$e.handleReplayGame=function(){var t=Ee(function(t){var n,_tmp,_tmp1,e;return _ts_generator(this,function(_state){switch(_state.label){case 0:_$e.handleHideHint();n=we(we({},_$e.defaultData),t);_state.label=1;case 1:_state.trys.push([1,6,,7]);_tmp=ub.getMatchState().mode===wb.SINGLE;if(!_tmp)return[3,3];return[4,uu.finishMatchAsync()];case 2:_tmp=_state.sent();_state.label=3;case 3:_tmp;_tmp1=ub.getMatchState().mode!==wb.CHALLENGE_FRIEND;if(!_tmp1)return[3,5];return[4,uu.startMatchAsync()];case 4:_tmp1=_state.sent();_state.label=5;case 5:_tmp1;return[3,7];case 6:e=_state.sent();console.warn("handleReplayGame",e);return[3,7];case 7:_$e.setGameData(n),_$e.stateManager.initialize();return[2]}})});return function(e){return t.apply(this,arguments)}}(),_$e.handleFinishGame=function(){var t;_$e.attemptCallCreateShortcut(),null!==(t=_$e.guidelinesManager)&&void 0!==t&&t.isNewbieGuideLevel()?(_$e.guidelinesManager.guideSkipButton.active=!1,_$e.handleNextLevel()):_$e.stateManager.finish()},_$e.handleNextLevel=Ee(function(){var t,_tmp,e,n;return _ts_generator(this,function(_state){switch(_state.label){case 0:if(!_$e.gameData)return[3,7];_state.label=1;case 1:_state.trys.push([1,4,,5]);_tmp=ub.getMatchState().mode===wb.SINGLE;if(!_tmp)return[3,3];return[4,uu.finishMatchAsync()];case 2:_tmp=_state.sent();_state.label=3;case 3:_tmp,ub.getMatchState().mode===wb.TOURNAMENT&&_$e.scoreManager.updateTournamentStartScore();return[3,5];case 4:e=_state.sent();console.warn("handleReplayGame",e);return[3,5];case 5:n=(null!==(t=_$e.gameData.level)&&void 0!==t?t:1)+1;_$e.setGameData({level:n});return[4,Promise.all([uu.setMatchCustomDataAsync({level:n,score:0}),uu.startMatchAsync()])];case 6:_state.sent(),_$e.stateManager.initialize(),console.log("Next level",_$e.gameData.level);_state.label=7;case 7:return[2]}})}),_$e.handleStartOver=Ee(function(){var t;return _ts_generator(this,function(_state){rb.setGameData({level:Sb.Tutorial.Enabled?0:1}),_$e.gameData=rb.getGameData(),_$e.stateManager.initialize(),console.info("Start over",null===(t=_$e.gameData)||void 0===t?void 0:t.level);return[2]})}),_$e.handleMaxLevel=function(){_$e.gameData&&(_$e.initData(),Mu.openScreen(ki.CONGRATULATION_SCREEN,{level:_$e.gameData.level}),console.info("Max level",_$e.gameData.level))},_$e.handleExitGame=Ee(function(){return _ts_generator(this,function(_state){try{cb.setStorageData("dashboard","animateToCurrentLevel",!0),cb.setStorageData("collection","animateMapPackUnlock",!0)}catch(e){console.warn("handleExitGame",e)}return[2]})}),_$e.handleTileClick=function(t){_$e.stateManager.playing(),_$e.board.handleTileClick(t),_$e.handleHideHint()},_$e.handleGridMatchSuccess=function(t,n){_$e.pathDraw.drawMatchPath(t,function(t){var _$n=t.x,_$i=t.y;return _$e.board.getAnyTileWorldPosition(_$n,_$i)}),_$e.comboManager.addCombo(),_$e.handleAddScore(),_$e.effectManager.playClearFXAt([n[0].node.worldPosition,n[1].node.worldPosition])},_$e.handleGridMatchFail=function(t){var n;null!==(n=_$e.guidelinesManager)&&void 0!==n&&n.isShowErrorPathLevel()&&_$e.pathDraw.drawErrorPath(t,function(t){var n=t.x,_$i=t.y;return _$e.board.getAnyTileWorldPosition(n,_$i)})},_$e.checkIfGameIsFinish=function(){0===_$e.board.getUncleared().length&&_$e.node.scene.emit(Co.GAME_FINISH)},_$e.handlePauseTime=function(){_$e.uiManager.pauseTime()},_$e.handleResumeTime=function(){_$e.uiManager.resumeTime()},_$e.handleClockTimeout=function(){_$e.stateManager.fail(ju)},_$e.handleHalfTime=function(){void 0!==_$e.guidelinesManager&&(_$e.board.getUncleared().length>=_$e.board.getCleared().length&&_$e.guidelinesManager.startThunderGuide()||_$e.board.getBombTiles().length>0&&_$e.guidelinesManager.startPliersGuide())},_$e.handleStartRescue=function(){var t,n;for(li.setBlockInput(!0),_$e.board.setIgnoreInput(!0);_$e.rescueTiles.length>0;){var _$i=_$e.rescueTiles.pop();null==_$i||_$i.restore()}hb.levelRescue(null!==(t=null===(n=_$e.gameData)||void 0===n?void 0:n.level)&&void 0!==t?t:1)},_$e.handleFinishRescue=function(){li.setBlockInput(!1),_$e.board.setIgnoreInput(!1)},_$e.handleBombExplode=function(){var t=Ee(function(t){var n;return _ts_generator(this,function(_state){switch(_state.label){case 0:_$e.rescueTiles.push(t),_$e.board.setIgnoreInput(!0),li.getBlockInput()||(Pi.playSound(vi.BOMB_EXPLODE_1),li.setBlockInput(!0));n=t.node.worldPosition;return[4,_$e.effectManager.createBombExplosionAt(new Y(n.x,n.y,0))];case 1:_state.sent(),li.setBlockInput(!1),_$e.stateManager.isFail()||_$e.stateManager.fail(Yu);return[2]}})});return function(e){return t.apply(this,arguments)}}(),_$e.handleShowHint=function(){if(!_$e.pathDraw.isDrawingHint){var t=_$e.board.getHintPath();t&&(Pi.playSound(vi.HINT_ITEM),_$e.pathDraw.drawHintPath(t,function(t){return _$e.board.getAnyTileWorldPosition(t.x,t.y)}),_$e.board.showHint())}},_$e.handleHideHint=function(){_$e.pathDraw.isDrawingHint&&(_$e.pathDraw.clearHintPath(),_$e.board.hideHint())},_$e.handleAddScore=function(){var t=_$e.levelManager.getLevelData().level,n=_$e.comboManager.getCombo();_$e.scoreManager.addScore(10,t,n)},_$e.handleUseItem=function(t){_$e.stateManager.playing(),t!==tl.HINT&&_$e.handleHideHint()},_$e.handleAutoPlay=function(){_$e.isAutoPlayEnabled?_$e.disableAutoPlay():_$e.enableAutoPlay()},_$e.enableAutoPlay=function(){_$e.isAutoPlayEnabled=!0;_$e.node.scene.once(Co.GAME_FINISH,function(){_$e.disableAutoPlay()}),_$e.schedule(_$e.autoPlay,.5)},_$e.disableAutoPlay=function(){_$e.isAutoPlayEnabled=!1,_$e.unschedule(_$e.autoPlay)},_$e.autoPlay=function(){var t=_$e.board.getHintPath();if(!t)throw new Error("No path found");var n=t[0].a,_$i=t.slice(-1)[0].b,a=_$e.board.getTileAt(n.x,n.y),o=_$e.board.getTileAt(_$i.x,_$i.y);if(!a||!o)throw new Error("Tile is null");a.onClick(),o.onClick()},_$e.handleAddStars=function(t){var n=rb.getGameData();if(!n)return Promise.resolve([]);rb.setGameData({stars:n.stars+1});var _$i=t.startAnimationAt;_$i&&_$e.effectManager.playStarFXAt(_$i)},_$e.handleInviteFriends=Ee(function(){var _$t,n,_$i,a,o,r,s,l,u,c,h,d,p,t;return _ts_generator(this,function(_state){switch(_state.label){case 0:_state.trys.push([0,2,,3]);Mu.showLoadingScreen();a=_$e.board.generateFenFromCurrentLevel(),o=(null!==(_$t=rb.getGameData())&&void 0!==_$t?_$t:{}).level,r=void 0===o?1:o;r=Math.max(1,r);s=null!==(n=null===(_$i=_$e.gameData)||void 0===_$i?void 0:_$i.levelData)&&void 0!==n?n:{},l=s.mode,u=void 0===l?"":l,c=s.rules,h=void 0===c?{addRandomTilesPerMove:0,maxSpaceOfPair:0}:c,d=s.time,p=void 0===d?0:d;pb.addWideframeRender("renderResultChallenge",_l);return[4,ub.context.choose.processAsync({playerId:rb.getPlayerId(),fallbackSingleMode:!1,extraData:{level:r,fen:a,gravity:u,rules:h,time:p}})];case 1:_state.sent(),Mu.closeLoadingScreen(),_$e.node.scene.emit(Co.GAME_RESUME),_$e.node.scene.emit(Co.GAME_REPLAY,{level:r});return[3,3];case 2:t=_state.sent();if(console.warn("Unable to invite friends",t),Mu.closeLoadingScreen(),Mu.showNotificationScreen("Sorry, please try again later"),!_instanceof(t,Error))return[2];null==db||db.sendException(t),_$e.node.scene.emit(Co.GAME_RESUME),_$e.node.scene.emit(Co.SHOW_UI);return[3,3];case 3:return[2]}})}),_$e.handleAdShow=function(t){var n=t.placementId;n&&-1!==Cb.indexOf(n)&&(Cb.splice(Cb.indexOf(n),1),sb.hideBannerAdAsync(n).catch(function(){}),0===Cb.length&&lb.off(vb.AD_SHOWING,_$e.handleAdShow))},_$e.handleAddItem=function(){var t=Ee(function(t){var n,_$i,a,o,r;return _ts_generator(this,function(_state){switch(_state.label){case 0:n=t.animate,_$i=t.item,a=t.quantity,o=bb.search(_$e.itemManager.items,function(e){return e.itemType===_$i});if(!(void 0!==o))return[3,2];r=o.getQuantity()+a;o.saveQuantity(r),_$e.uiManager.setInteractableItemButtons(!1),_$e.handlePauseGame();return[4,n()];case 1:_state.sent(),o.setQuantity(r,!0),_$e.uiManager.setInteractableItemButtons(!0),_$e.handleResumeGame();return[3,3];case 2:console.warn("Item ".concat(_$i," not found"));_state.label=3;case 3:return[2]}})});return function(e){return t.apply(this,arguments)}}(),_$e}return Ae(i,[{key:"__preload",value:function value(){this.initComponents(),this.validateRequiredComponents(),this.listenCoreEvents(),this.listenInputEvents(),this.listenFlowEvents()}},{key:"onLoad",value:function value(){Yl.init()}},{key:"initComponents",value:function value(){this.initUIManager(),this.initLevelManager(),this.initStateManager(),this.initEffectManager(),this.initItemManager(),this.initComboManager(),this.initScoreManager(),this.initInputController(),this.initGuidelinesManager()}},{key:"initUIManager",value:function value(){var _$e;this.uiManager=null===(_$e=this.node.parent)||void 0===_$e?void 0:_$e.getComponentInChildren(ab),this.uiManager.initDevTools(this)}},{key:"initLevelManager",value:function value(){this.levelManager=this.getComponent(hv)}},{key:"initStateManager",value:function value(){this.stateManager=this.getComponent(om)}},{key:"initInputController",value:function value(){this.inputController=this.getComponent(Xu)}},{key:"initEffectManager",value:function value(){this.effectManager=this.getComponent(qp)}},{key:"initItemManager",value:function value(){var _$e=this;this.itemManager=this.getComponent(ov),this.itemManager.syncItems(),this.itemManager.items.forEach(function(t){t.init(_$e)})}},{key:"initComboManager",value:function value(){this.comboManager=this.getComponent(rp),this.comboManager.init()}},{key:"initScoreManager",value:function value(){this.scoreManager=this.getComponent(yv),this.scoreManager.init()}},{key:"initGuidelinesManager",value:function value(){Sb.Tutorial.Enabled&&(this.guidelinesManager=this.getComponent($f),this.guidelinesManager.init(this))}},{key:"validateRequiredComponents",value:function value(){St.lazyValidateProperties(this)}},{key:"listenCoreEvents",value:function value(){Cb=[],lb.off(vb.AD_SHOWING,this.handleAdShow),lb.clear(vb.OPENING_SCREEN),lb.clear(vb.CLOSING_SCREEN),lb.on(vb.OPENING_SCREEN,this.handleOpenScreen),lb.on(vb.CLOSING_SCREEN,this.handleCloseScreen)}},{key:"listenInputEvents",value:function value(){this.node.scene.on(Co.SHOW_UI,this.handleShowUI),this.node.scene.on(Co.HIDE_UI,this.handleHideUI),this.node.scene.on(Co.GAME_PAUSE,this.handlePauseGame),this.node.scene.on(Co.GAME_RESUME,this.handleResumeGame),this.node.scene.on(Co.GAME_REPLAY,this.handleReplayGame),this.node.scene.on(Co.GAME_FINISH,this.handleFinishGame),this.node.scene.on(Co.NEXT_LEVEL,this.handleNextLevel),this.node.scene.on(Co.START_OVER,this.handleStartOver),this.node.scene.on(Co.MAX_LEVEL,this.handleMaxLevel),this.node.scene.on(Co.GAME_EXIT,this.handleExitGame),this.node.scene.on(Co.TILE_CLICK,this.handleTileClick),this.node.scene.on(Co.GRID_MATCH_SUCCESS,this.handleGridMatchSuccess),this.node.scene.on(Co.GRID_MATCH_FAIL,this.handleGridMatchFail),this.node.scene.on(Co.PAUSE_TIME,this.handlePauseTime),this.node.scene.on(Co.RESUME_TIME,this.handleResumeTime),this.node.scene.on(Co.TIME_OUT,this.handleClockTimeout),this.node.scene.on(Co.HALF_TIME,this.handleHalfTime),this.node.scene.on(Co.RESCUE_START,this.handleStartRescue),this.node.scene.on(Co.RESCUE_FINISHED,this.handleFinishRescue),this.node.scene.on(Co.BOMB_EXPLODE,this.handleBombExplode),this.node.scene.on(Co.SHOW_HINT,this.handleShowHint),this.node.scene.on(Co.ADD_SCORE,this.handleAddScore),this.node.scene.on(Co.GRID_CLEAR,this.checkIfGameIsFinish),this.node.scene.on(Co.USE_ITEM,this.handleUseItem),this.node.scene.on(Co.ADD_ITEM,this.handleAddItem),this.node.scene.on(Co.AUTO_PLAY,this.handleAutoPlay),this.node.scene.on(Co.ADD_STARS,this.handleAddStars)}},{key:"listenFlowEvents",value:function value(){this.node.scene.on(Co.INVITE_FRIENDS,this.handleInviteFriends)}},{key:"start",value:function value(){this.initDataFirstTime(),this.initGame(),this.trySetTournamentStorage()}},{key:"initDataFirstTime",value:function value(){var _$e=this.getSceneData(),t=(null!=_$e?_$e:{}).level;void 0===t&&(t=uu.getMatchMode()===wb.TOURNAMENT?1:0),this.initData(),this.setGameData({level:t})}},{key:"initData",value:function value(){var _$e,t=null!==(_$e=rb.getGameData())&&void 0!==_$e?_$e:{},n=t.level,_$i=void 0===n?1:n,a=t.items;a&&this.checkItemsRewardable()&&(a.hint<5&&(a.hint+=1),a.thunder<5&&(a.thunder+=1),a.storm<5&&(a.storm+=1),a.pliers<5&&(a.pliers+=1),rb.setGameData({items:a,lastRewardedItems:Date.now()})),this.setGameData(we(we({},this.defaultData),{},{level:_$i}))}},{key:"checkItemsRewardable",value:function value(){var _$e,t=(null!==(_$e=rb.getGameData())&&void 0!==_$e?_$e:{}).lastRewardedItems,n=void 0===t?0:t;return!gb.isToday(n)}},{key:"initGame",value:function value(){this.stateManager.init(this),this.stateManager.initialize()}},{key:"trySetTournamentStorage",value:(t=Ee(function(){var _$e,t,n,_$i,a,o,r;return _ts_generator(this,function(_state){switch(_state.label){case 0:if(!(uu.getMatchMode()===wb.TOURNAMENT))return[3,3];t=(null!==(_$e=uu.getMatchCustomData())&&void 0!==_$e?_$e:{}).leaderboardId;if(!t)return[3,3];return[4,Wu.requestTournamentDataAsync()];case 1:_state.sent();n=yb.getLeaderboardName(t);if(!n)return[3,3];return[4,yb.getLeadersByPlayerIdsAsync(n,[rb.getPlayerId()])];case 2:_$i=_state.sent();if(0!==_$i.length){a=_$i[0],o=a.score,r=a.rank;cb.setStorageData("tournament","previousScore",o),cb.setStorageData("tournament","previousRank",r)}_state.label=3;case 3:return[2]}})}),function(){return t.apply(this,arguments)})},{key:"setGameData",value:function value(e){var t,n,_$i,a=null!==(t=null!==(n=e.level)&&void 0!==n?n:null===(_$i=this.gameData)||void 0===_$i?void 0:_$i.level)&&void 0!==t?t:1;this.gameData=we(we(we({},this.gameData),e),{},{level:a})}},{key:"getGameData",value:function value(){return this.gameData}},{key:"getSceneData",value:function value(){return bu.getSceneData(this.node.scene)}},{key:"attemptCallCreateShortcut",value:function value(){var _$e,t=null!==(_$e=this.getGameData())&&void 0!==_$e?_$e:{},n=t.level,_$i=void 0===n?0:n,a=t.nextLevelCount;_$i<2||(void 0===a?0:a)<2||"checkAndCreateShortcutAsync"in GameSDK.extra&&GameSDK.extra.checkAndCreateShortcutAsync().catch(function(e){console.warn("checkAndCreateShortcutAsync",e)})}},{key:"processCrazyGamesGameplayStart",value:function value(){"gameplayStart"in GameSDK.extra&&GameSDK.extra.gameplayStart()}},{key:"processCrazyGamesGameplayStop",value:function value(){"gameplayStop"in GameSDK.extra&&GameSDK.extra.gameplayStop()}},{key:"disableRewardAdsItemForCrazyGames",value:function value(){GameSDK.getSDKName()}}]),i}(y)).prototype,"board",[qg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Jg=Ye(Yg.prototype,"opacityToggler",[Wg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Qg=Ye(Yg.prototype,"pathDraw",[Kg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),jg=Yg));n._RF.pop(),n._RF.push({},"c863f/bTTdAjqEM+Kj9OaKi","DashboardEventButtonTypes",void 0);var Tb=function(e){return e[e.STAR_CHEST=0]="STAR_CHEST",e[e.BALLOON=1]="BALLOON",e}(Tb||{});R(Tb),n._RF.pop(),n._RF.push({},"17fa4eEXEhIfZh+ad9Oqcmw","Leaderboard",void 0);var Ab,Rb=function(e){return e.WORLD_TAB_SELECTED="world-tab-selected",e.FRIENDS_TAB_SELECTED="friends-tab-selected",e}(Rb||{}),Ib="#AE4212",Pb="#3D5172",_b="#92200C",Lb="#8F5542",Ob="#8A4733",Db="#3e7110",Nb="#3e7110";n._RF.pop(),n._RF.push({},"4cd93d4ECxKDYSG9apAx603","LevelMission",void 0),n._RF.pop(),n._RF.push({},"78297LLtrJKMpOIidCw/BA9","index",void 0),n._RF.pop(),n._RF.push({},"176c3V0yoFEhIdpVcCIhDz7","isEmptyBoard",void 0),n._RF.pop(),n._RF.push({},"5262atLmldNy7Q3MtHgiSRI","HintItem",void 0);var Mb,xb=i.ccclass,Bb=globalThis.game,Fb=Bb.player,zb=Bb.analytics,Gb=GameCore.Plugins.Analytics.Events;xb("HintItem")(Ab=function(e){Ie(i,e);var t,n=xe(i);function i(){var _$e;Ce(this,i);for(var t=arguments.length,a=new Array(t),o=0;o<t;o++)a[o]=arguments[o];return(_$e=n.call.apply(n,[this].concat(a))).requestItem=function(){Mu.openScreen(ki.GET_ITEM_SCREEN,{item:tl.HINT,message:"Shows a pair of tiles\nthat can be connected.",quantity:1})},_$e.loadQuantity=function(){var _$e=Fb.getGameData();return null!=_$e&&_$e.items&&_$e?_$e.items[tl.HINT]:0},_$e}return Ae(i,[{key:"itemType",get:function get(){return tl.HINT}},{key:"init",value:function value(e){this.boardInstance=e.board,this.pathDrawer=e.pathDraw,this.setQuantity(this.loadQuantity()),Fe(Pe(i.prototype),"init",this).call(this,e)}},{key:"onDestroy",value:function value(){var _$e;if(this.boardInstance){this.node.scene.targetOff(this);var t,n=this.boardInstance.node;if(null!=n)this.boardInstance.node.targetOff(this),null===(_$e=Fe(Pe(i.prototype),"onDestroy",this))||void 0===_$e||_$e.call(this);else null===(t=Fe(Pe(i.prototype),"onDestroy",this))||void 0===t||t.call(this)}}},{key:"validateRequiredComponents",value:function value(){Fe(Pe(i.prototype),"validateRequiredComponents",this).call(this),St.lazyValidateProperties(this)}},{key:"canActivate",value:function value(){try{return this.boardInstance.getUncleared().length>0}catch(e){return!1}}},{key:"activate",value:(t=Ee(function(){var _tmp,_tmp1;return _ts_generator(this,function(_state){switch(_state.label){case 0:_tmp=this.pathDrawer.isDrawingHint;if(_tmp)return[3,5];if(!(this.getQuantity()<=0))return[3,2];return[4,Fe(Pe(i.prototype),"activate",this).call(this)];case 1:_tmp1=_state.sent();return[3,4];case 2:return[4,Fe(Pe(i.prototype),"activate",this).call(this)];case 3:_tmp1=(_state.sent(),zb.event(Gb.USE_ITEM,{item_name:tl.HINT}),this.node.scene.emit(Co.USE_ITEM,tl.HINT),this.node.scene.emit(Co.SHOW_HINT));_state.label=4;case 4:_tmp=_tmp1;_state.label=5;case 5:_tmp;return[2]}})}),function(){return t.apply(this,arguments)})},{key:"saveQuantity",value:function value(){var _$e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.getQuantity(),t=arguments.length>1?arguments[1]:void 0;Fe(Pe(i.prototype),"saveQuantity",this).call(this,_$e,t);var n=Fb.getGameData();n&&Fb.setGameData({items:we(we({},n.items),{},Re({},tl.HINT,_$e))})}}]),i}(iv));n._RF.pop(),n._RF.push({},"3f4c1AB+jdNFqylpogoaiDZ","PliersItem",void 0);var Ub,Hb=i.ccclass,Vb=globalThis.game,qb=Vb.player,Wb=Vb.analytics,Kb=GameCore.Plugins.Analytics.Events;Hb("PliersItem")(Mb=function(e){Ie(i,e);var t,n=xe(i);function i(){var _$e;Ce(this,i);for(var t=arguments.length,a=new Array(t),o=0;o<t;o++)a[o]=arguments[o];return(_$e=n.call.apply(n,[this].concat(a))).requestItem=function(){Mu.openScreen(ki.GET_ITEM_SCREEN,{item:tl.PLIERS,message:"Removes a random bomb\nfrom the game field.",quantity:1})},_$e.loadQuantity=function(){var _$e=qb.getGameData();return null!=_$e&&_$e.items&&_$e?_$e.items[tl.PLIERS]:0},_$e}return Ae(i,[{key:"itemType",get:function get(){return tl.PLIERS}},{key:"init",value:function value(e){this.boardInstance=e.board,this.effectManager=e.effectManager,Fe(Pe(i.prototype),"init",this).call(this,e)}},{key:"onDestroy",value:function value(){var _$e;if(this.boardInstance){this.node.scene.targetOff(this);var t,n=this.boardInstance.node;if(null!=n)this.boardInstance.node.targetOff(this),null===(_$e=Fe(Pe(i.prototype),"onDestroy",this))||void 0===_$e||_$e.call(this);else null===(t=Fe(Pe(i.prototype),"onDestroy",this))||void 0===t||t.call(this)}}},{key:"validateRequiredComponents",value:function value(){Fe(Pe(i.prototype),"validateRequiredComponents",this).call(this),St.lazyValidateProperties(this)}},{key:"canActivate",value:function value(){try{return this.boardInstance.getBombTiles().length>0}catch(e){return!1}}},{key:"activate",value:(t=Ee(function(){var _$e,t;return _ts_generator(this,function(_state){switch(_state.label){case 0:if(!(this.getQuantity()<=0))return[3,2];return[4,Fe(Pe(i.prototype),"activate",this).call(this)];case 1:_state.sent();return[3,4];case 2:return[4,Fe(Pe(i.prototype),"activate",this).call(this)];case 3:_state.sent(),Wb.event(Kb.USE_ITEM,{item_name:tl.PLIERS}),this.node.scene.emit(Co.USE_ITEM,tl.PLIERS);_$e=qc(this.boardInstance.getBombTiles()),t=_$e.node.worldPosition;this.effectManager.createDefuseExplosionAt(new Y(t.x,t.y,0)),Pi.playSound(vi.BOMB_DEFUSE),_$e.special.switch(_c.none),this.applyActivationStatus();_state.label=4;case 4:return[2]}})}),function(){return t.apply(this,arguments)})},{key:"saveQuantity",value:function value(){var _$e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.getQuantity(),t=arguments.length>1?arguments[1]:void 0;Fe(Pe(i.prototype),"saveQuantity",this).call(this,_$e,t);var n=qb.getGameData();n&&qb.setGameData({items:we(we({},n.items),{},Re({},tl.PLIERS,_$e))})}}]),i}(iv));n._RF.pop(),n._RF.push({},"d6e51+oy6NCF7cKvf6KOWiu","StormItem",void 0);var jb,Yb=i.ccclass,Xb=globalThis.game,Jb=Xb.player,Qb=Xb.analytics,Zb=GameCore.Plugins.Analytics.Events;Yb("StormItem")(Ub=function(e){Ie(i,e);var t,n=xe(i);function i(){var _$e;Ce(this,i);for(var t=arguments.length,a=new Array(t),o=0;o<t;o++)a[o]=arguments[o];return(_$e=n.call.apply(n,[this].concat(a))).requestItem=function(){Mu.openScreen(ki.GET_ITEM_SCREEN,{item:tl.STORM,message:"Randomly rearranges the \ntiles on the game field.",quantity:1})},_$e.loadQuantity=function(){var _$e=Jb.getGameData();return null!=_$e&&_$e.items&&_$e?_$e.items[tl.STORM]:0},_$e}return Ae(i,[{key:"itemType",get:function get(){return tl.STORM}},{key:"init",value:function value(e){this.boardInstance=e.board,this.effectManager=e.effectManager,Fe(Pe(i.prototype),"init",this).call(this,e)}},{key:"onDestroy",value:function value(){var _$e;if(this.boardInstance){this.node.scene.targetOff(this);var t,n=this.boardInstance.node;if(null!=n)this.boardInstance.node.targetOff(this),null===(_$e=Fe(Pe(i.prototype),"onDestroy",this))||void 0===_$e||_$e.call(this);else null===(t=Fe(Pe(i.prototype),"onDestroy",this))||void 0===t||t.call(this)}}},{key:"validateRequiredComponents",value:function value(){Fe(Pe(i.prototype),"validateRequiredComponents",this).call(this),St.lazyValidateProperties(this)}},{key:"canActivate",value:function value(){try{return this.boardInstance.getUncleared().length>2}catch(e){return!1}}},{key:"activate",value:(t=Ee(function(){var _$e,t,n;return _ts_generator(this,function(_state){switch(_state.label){case 0:_$e=this;if(!(this.getQuantity()<=0))return[3,2];return[4,Fe(Pe(i.prototype),"activate",this).call(this)];case 1:_state.sent();return[3,5];case 2:return[4,Fe(Pe(i.prototype),"activate",this).call(this)];case 3:_state.sent(),Qb.event(Zb.USE_ITEM,{item_name:tl.STORM}),this.node.scene.emit(Co.USE_ITEM,tl.STORM),this.node.scene.emit(Co.HIDE_UI);t=new Promise(function(t){return _$e.scheduleOnce(t,.5)});return[4,Promise.race([this.effectManager.loadTornadoAnimation(),t])];case 4:_state.sent();n=function(){var t=Ee(function(t,n){var _$i;return _ts_generator(this,function(_state){switch(_state.label){case 0:Pi.muteMusic(!0),Pi.playSound(vi.SHUFFLE_ITEM),Pi.playSound(vi.WIND);_$i=function(){var _$t=Ee(function(){return _ts_generator(this,function(_state){switch(_state.label){case 0:n.forEach(function(e,t,i){e.node.setSiblingIndex(n.asArray().length-1-(t+i*n.width))});return[4,Promise.all(n.map(function(t){return t.fly({getTilePosition:function getTilePosition(t){return Mc(n,_$e.boardInstance.getTileSize(),t)}})}))];case 1:_state.sent();return[2]}})});return function(){return _$t.apply(this,arguments)}}();return[4,Promise.all(t.map(function(n,i,a){return n.sync({duration:.4,easing:"smooth",getTargetPosition:function getTargetPosition(){return Mc(t,_$e.boardInstance.getTileSize(),{x:i,y:a},10)}})}))];case 1:_state.sent(),_$e.effectManager.playTornadoAnimation();return[4,_$i()];case 2:_state.sent(),_$e.node.scene.emit(Co.SHOW_UI),Pi.muteMusic(!1);return[2]}})});return function(e,n){return t.apply(this,arguments)}}();this.boardInstance.processShuffleRequest(n);_state.label=5;case 5:return[2]}})}),function(){return t.apply(this,arguments)})},{key:"saveQuantity",value:function value(){var _$e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.getQuantity(),t=arguments.length>1?arguments[1]:void 0;Fe(Pe(i.prototype),"saveQuantity",this).call(this,_$e,t);var n=Jb.getGameData();n&&Jb.setGameData({items:we(we({},n.items),{},Re({},tl.STORM,_$e))})}}]),i}(iv));n._RF.pop(),n._RF.push({},"b30ffJjU2lAH5yu2NkzVVnO","ThunderItem",void 0);var $b,eS=i.ccclass,tS=globalThis.game,nS=tS.player,iS=tS.analytics,aS=GameCore.Plugins.Analytics.Events;eS("ThunderItem")(jb=function(e){Ie(i,e);var t,n=xe(i);function i(){var _$e;Ce(this,i);for(var t=arguments.length,a=new Array(t),o=0;o<t;o++)a[o]=arguments[o];return(_$e=n.call.apply(n,[this].concat(a))).requestItem=function(){Mu.openScreen(ki.GET_ITEM_SCREEN,{item:tl.THUNDER,message:"Remove 2 pair of tiles\non the game field.",quantity:1})},_$e.loadQuantity=function(){var _$e=nS.getGameData();return null!=_$e&&_$e.items&&_$e?_$e.items[tl.THUNDER]:0},_$e}return Ae(i,[{key:"itemType",get:function get(){return tl.THUNDER}},{key:"init",value:function value(e){this.boardInstance=e.board,this.effectManager=e.effectManager,Fe(Pe(i.prototype),"init",this).call(this,e)}},{key:"onDestroy",value:function value(){var _$e;if(this.boardInstance){this.node.scene.targetOff(this);var t,n=this.boardInstance.node;if(null!=n)this.boardInstance.node.targetOff(this),null===(_$e=Fe(Pe(i.prototype),"onDestroy",this))||void 0===_$e||_$e.call(this);else null===(t=Fe(Pe(i.prototype),"onDestroy",this))||void 0===t||t.call(this)}}},{key:"validateRequiredComponents",value:function value(){Fe(Pe(i.prototype),"validateRequiredComponents",this).call(this),St.lazyValidateProperties(this)}},{key:"canActivate",value:function value(){try{return this.boardInstance.getUncleared().length>=4}catch(e){return!1}}},{key:"activate",value:(t=Ee(function(){var _$e,t;return _ts_generator(this,function(_state){switch(_state.label){case 0:if(!(this.getQuantity()<=0))return[3,2];return[4,Fe(Pe(i.prototype),"activate",this).call(this)];case 1:_state.sent();return[3,6];case 2:return[4,Fe(Pe(i.prototype),"activate",this).call(this)];case 3:_state.sent(),iS.event(aS.USE_ITEM,{item_name:tl.THUNDER}),this.node.scene.emit(Co.USE_ITEM,tl.THUNDER),this.node.scene.emit(Co.HIDE_UI);return[4,this.effectManager.loadThunderAnimation()];case 4:_state.sent(),Pi.muteMusic(!0);_$e=this.boardInstance.getUncleared();if(_$e.length<4)throw new Error("Not enough uncleared tiles");t=this.boardInstance.getPairs(2);li.setBlockInput(!0),this.boardInstance.clearSelectedTile();return[4,this.effectManager.playThunderAnimation(t,this.boardInstance)];case 5:_state.sent(),_$e.length>4&&this.node.scene.emit(Co.SHOW_UI),Pi.muteMusic(!1),li.setBlockInput(!1);_state.label=6;case 6:return[2]}})}),function(){return t.apply(this,arguments)})},{key:"saveQuantity",value:function value(){var _$e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.getQuantity(),t=arguments.length>1?arguments[1]:void 0;Fe(Pe(i.prototype),"saveQuantity",this).call(this,_$e,t);var n=nS.getGameData();n&&nS.setGameData({items:we(we({},n.items),{},Re({},tl.THUNDER,_$e))})}}]),i}(iv));n._RF.pop(),n._RF.push({},"0a97aK0agJOHb07cLs0JICj","PathHolder",void 0);var oS,rS,sS,lS,uS,cS,hS,dS,pS,yS,fS,vS,mS,gS=i.ccclass,bS=i.requireComponent;gS("PathHolder")($b=bS(x)($b=function(e){Ie(n,e);var t=xe(n);function n(){return Ce(this,n),t.apply(this,arguments)}return Ae(n,[{key:"onLoad",value:function value(){var _$e=this;this.node.scene.on(Co.GRID_RESIZE,function(t){_$e.node.setScale(t,t)})}}]),n}(y))||$b);n._RF.pop(),n._RF.push({},"944cbG3+yRMsJZimXjukGdn","Coin",void 0);var SS,wS,kS,ES,CS,TS,AS,RS=i.ccclass,IS=i.property,PS=(oS=RS("Coin"),rS=IS(oe),sS=IS(oe),lS=IS(v),uS=IS(L),cS=IS(L),oS((pS=Ye((dS=function(e){Ie(n,e);var t=xe(n);function n(){var _$e;Ce(this,n);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return je(_$e=t.call.apply(t,[this].concat(a)),"explodeParticles",pS,Ne(_$e)),je(_$e,"emittingParticles",yS,Ne(_$e)),je(_$e,"animation",fS,Ne(_$e)),je(_$e,"spin",vS,Ne(_$e)),je(_$e,"rest",mS,Ne(_$e)),_$e}return Ae(n,[{key:"__preload",value:function value(){St.lazyValidateProperties(this)}},{key:"playAnimation",value:function value(){var _$e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,_$n=arguments.length>1?arguments[1]:void 0;t>0&&this.scheduleOnce(function(){null!=_$n&&_$n.aborted||_$e.animation.play(_$e.spin.name)},t),this.animation.play(this.spin.name)}},{key:"stopAnimation",value:function value(){this.animation.play(this.rest.name)}}]),n}(y)).prototype,"explodeParticles",[rS],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),yS=Ye(dS.prototype,"emittingParticles",[sS],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),fS=Ye(dS.prototype,"animation",[lS],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),vS=Ye(dS.prototype,"spin",[uS],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),mS=Ye(dS.prototype,"rest",[cS],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),hS=dS))||hS);n._RF.pop(),n._RF.push({},"0c6a8vx5IhFvKJ5IUimm0Je","CoinTextPopup",void 0);var _S,LS,OS,DS,NS,MS,xS,BS,FS,zS=i.ccclass,GS=i.property,US=Y.ZERO.clone().add3f(0,-100,0),HS=Y.ZERO.clone().add3f(0,100,0),VS=GameCore.Utils.Number,qS=(SS=zS("CoinTextPopup"),wS=GS(u),kS=GS(x),SS((TS=Ye((CS=function(e){Ie(i,e);var t,n=xe(i);function i(){var _$e;Ce(this,i);for(var t=arguments.length,a=new Array(t),o=0;o<t;o++)a[o]=arguments[o];return je(_$e=n.call.apply(n,[this].concat(a)),"label",TS,Ne(_$e)),je(_$e,"uiOpacity",AS,Ne(_$e)),_$e}return Ae(i,[{key:"__preload",value:function value(){St.lazyValidateProperties(this),this.node.active=!1}},{key:"show",value:(t=Ee(function(e,t){var n;return _ts_generator(this,function(_state){switch(_state.label){case 0:n=VS.getShortNumber(e,3);this.label.string=n,this.node.active=!0,this.uiOpacity.opacity=255,this.node.setScale(.5,.5,.5),this.node.setPosition(US);return[4,Promise.all([gn.runTweenAsync(k(this.node).to(1.5,{position:HS},{easing:"sineOut"}),t),gn.runTweenAsync(k(this.node).to(.5,{scale:Y.ONE},{easing:"backOut"}),t)])];case 1:_state.sent(),this.node.setScale(Y.ONE),this.node.setPosition(HS);return[4,gn.runTweenAsync(k(this.uiOpacity).to(.5,{opacity:0}))];case 2:_state.sent(),this.node.active=!1;return[2]}})}),function(e,n){return t.apply(this,arguments)})}]),i}(y)).prototype,"label",[wS],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),AS=Ye(CS.prototype,"uiOpacity",[kS],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ES=CS))||ES);n._RF.pop(),n._RF.push({},"8a5c3m7o41LNqGBKPo0oqf1","CoinManager",void 0);var WS=i.ccclass,KS=i.disallowMultiple,jS=i.property,YS=globalThis.game,XS=YS.player,JS=YS.monitorError,QS=999999999,ZS=10,$S=1,ew=1,tw=(_S=WS("CoinManager"),LS=jS(P),OS=jS(P),DS=jS(a),_S(NS=KS((xS=Ye((MS=function(e){Ie(s,e);var t,n,i,a,o,r=xe(s);function s(){var _$e;Ce(this,s);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return(_$e=r.call.apply(r,[this].concat(n))).coins=0,je(_$e,"coinPrefab",xS,Ne(_$e)),je(_$e,"coinTextPopup",BS,Ne(_$e)),je(_$e,"coinAnimContainer",FS,Ne(_$e)),_$e.collectionAnimSignal=null,_$e.coinObjects=[],_$e}return Ae(s,[{key:"__preload",value:function value(){this.lifeCycleSignal=new Bn,this.validateRequiredComponents(),this.getCoinsFromPlayerData()}},{key:"onLoad",value:function value(){this.prepareCoinCollection(),this.prepareCoinTextPopup(),this.listenToCoinEvents()}},{key:"start",value:function value(){this.emitCoinAmount()}},{key:"init",value:function value(e){this.updateCoins({coins:this.coins,collectionAnimation:void 0}),this.animSkipOverlay=e}},{key:"listenToCoinEvents",value:function value(){this.node.scene.on(Co.ADD_COINS,this.addCoins,this),this.node.scene.on(Co.REMOVE_COINS,this.removeCoins,this)}},{key:"validateRequiredComponents",value:function value(){St.lazyValidateProperties(this)}},{key:"prepareCoinCollection",value:function value(){for(var _$e=0;_$e<ZS;_$e++){var t=l(this.coinPrefab);t.setParent(this.coinAnimContainer),t.setPosition(0,0),t.active=!1,this.coinObjects.push(t.getComponent(PS))}}},{key:"prepareCoinTextPopup",value:function value(){var _$e=l(this.coinTextPopup);_$e.setParent(this.node),_$e.active=!1,this.coinTextPopupNode=_$e.getComponent(qS)}},{key:"handleCollectionAnim",value:(o=Ee(function(e,t,n){var i,a,o,r,_$s,l;return _ts_generator(this,function(_state){switch(_state.label){case 0:o=this;if(!this.targetContainer)return[3,4];r=this.coinObjects.slice(0,this.getShortAmount(e));if(0===r.length)return[2,(console.warn("Requested coins amount is ".concat(e,". Shortened to ").concat(this.getShortAmount(e),". No coin objects was found to animate collection.")),void(null==JS||JS.sendException(new Error("Requested coins amount is ".concat(e,". Shortened to ").concat(this.getShortAmount(e),". No coin objects was found to animate collection.")),{coins:e,animatedCoins:r.length,hasCoinTextPopup:!!this.coinTextPopupNode,hasTargetContainer:!!this.targetContainer,coinCollectionCount:this.coinObjects.length})))];return[4,null===(i=this.animSkipOverlay)||void 0===i?void 0:i.open({onSkip:function onSkip(){return o.collectionAnimSignal.abort()},opacity:150})];case 1:_state.sent(),Pi.playSound(vi.COLLECT_STOCK_COINS);_$s=r.map(function(){var _$e=Ee(function(e){var i,a,r,_$s;return _ts_generator(this,function(_state){switch(_state.label){case 0:e.explodeParticles.stopSystem(),e.emittingParticles.stopSystem(),e.node.active=!0;i=[0,.5*Math.min(t,n)],a=ie.apply(void 0,i),r=t-a,_$s=n+a;return[4,o.animateCoinExplode(e.node,r)];case 1:_state.sent(),e.playAnimation(2*a,o.collectionAnimSignal),e.emittingParticles.resetSystem();return[4,o.animateCoinFlyBack(o.collectionAnimSignal,e,_$s)];case 2:_state.sent(),e.emittingParticles.stopSystem(),e.stopAnimation();return[2]}})});return function(t){return _$e.apply(this,arguments)}}()),l=function(){var _$e=Ee(function(){var _$e;return _ts_generator(this,function(_state){switch(_state.label){case 0:return[4,Promise.all(_$s)];case 1:_state.sent();return[4,null===(_$e=o.targetContainer)||void 0===_$e?void 0:_$e.emitExplodeEffect(o.collectionAnimSignal)];case 2:_state.sent();return[2]}})});return function(){return _$e.apply(this,arguments)}}();return[4,Promise.all([l(),this.animateCoinTextPopup(e,this.collectionAnimSignal,t+n/2)])];case 2:_state.sent();return[4,null===(a=this.animSkipOverlay)||void 0===a?void 0:a.close()];case 3:_state.sent(),this.collectionAnimSignal.abort();return[3,5];case 4:console.warn("No target coin container assigned to CoinManager. No coin collection animation will be played");_state.label=5;case 5:return[2]}})}),function(e,t,n){return o.apply(this,arguments)})},{key:"animateCoinTextPopup",value:(a=Ee(function(e,t,n){return _ts_generator(this,function(_state){switch(_state.label){case 0:return[4,gn.waitTweenAsync(n,t)];case 1:_state.sent();return[4,this.coinTextPopupNode.show(e,t)];case 2:_state.sent();return[2]}})}),function(e,t,n){return a.apply(this,arguments)})},{key:"animateCoinFlyBack",value:(i=Ee(function(e,t,n){var i,a,o,r;return _ts_generator(this,function(_state){switch(_state.label){case 0:i=this,a=t.node.worldPosition.clone(),o=Y.ZERO.clone(),r=this.targetContainer.getCoinIconWorldScale();return[4,gn.runTweenAsync(k(t.node).to(n,{scale:r},{onUpdate:function onUpdate(e,n){if(void 0!==n){var r=M.cubicIn(n),_$s=i.targetContainer.getCoinIconWorldPosition();t.node.worldPosition=Y.lerp(o,a,_$s,r)}}}),e)];case 1:_state.sent(),t.node.scale=Y.ZERO,this.explodeParticlesAndDisableAfter(1,t);return[2]}})}),function(e,t,n){return i.apply(this,arguments)})},{key:"explodeParticlesAndDisableAfter",value:(n=Ee(function(e,t){var n,_tmp;return _ts_generator(this,function(_state){switch(_state.label){case 0:n=t.explodeParticles;n.resetSystem();return[4,gn.waitTweenAsync(e/10,this.lifeCycleSignal)];case 1:_state.sent();_tmp=Bn.hasBeenAborted(this.lifeCycleSignal);if(_tmp)return[3,3];n.stopSystem();return[4,gn.waitTweenAsync(e/10*9,this.lifeCycleSignal)];case 2:_tmp=(_state.sent(),Bn.hasBeenAborted(this.lifeCycleSignal)||(t.node.setPosition(0,0,t.node.position.z),t.node.active=!1));_state.label=3;case 3:_tmp;return[2]}})}),function(e,t){return n.apply(this,arguments)})},{key:"animateCoinExplode",value:(t=Ee(function(e,t){var n,i,a,o,r;return _ts_generator(this,function(_state){switch(_state.label){case 0:n=[-200,200],i=[-200,200],a=ie(n[0],n[1]),o=ie(i[0],i[1]);e.setPosition(0,0,e.position.z),e.setScale(Y.ZERO);r=new Y(a,o,e.position.z);return[4,Promise.all([gn.runTweenAsync(k(e).delay(.1*t).to(.8*t,{scale:Y.ONE},{easing:"elasticOut"}),this.collectionAnimSignal),gn.runTweenAsync(k(e).to(t,{position:r},{easing:"circOut"}),this.collectionAnimSignal)])];case 1:_state.sent();return[2]}})}),function(e,n){return t.apply(this,arguments)})},{key:"getCoinsFromPlayerData",value:function value(){var _$e=XS.getGameData();this.coins=_$e?_$e.coins:0}},{key:"getCoins",value:function value(){return this.coins}},{key:"updateCoins",value:function value(e){var t,n;if(console.info("updateCoins",e.coins,null===(t=e.collectionAnimation)||void 0===t?void 0:t.animateTextOnly),this.coins>QS&&(this.coins=QS),e.coins!==this.coins){var i=Math.max(0,e.coins-this.coins);this.coins=e.coins,XS.setGameData({coins:this.coins});var a=e.collectionAnimation;if(void 0===a||a.animateTextOnly)this.node.scene.emit(Co.COIN_CHANGED,we(we({},e),{},{collectionAnimation:{animateTextOnly:!0,signal:this.collectionAnimSignal}}));else{null===(n=this.collectionAnimSignal)||void 0===n||n.abort();var o=a.floatDuration,r=void 0===o?$S:o,_$s=a.flyDuration,l=void 0===_$s?ew:_$s,u=a.signal,c=void 0===u?new Bn:u,h=a.target,d=void 0===h?this.targetContainer:h;this.collectionAnimSignal=c,this.targetContainer=d;var p=we(we({},e),{},{collectionAnimation:{floatDuration:r,flyDuration:l,animateTextOnly:!1,signal:c,target:d}});this.node.scene.emit(Co.COIN_CHANGED,p),this.handleCollectionAnim(i,r,l)}}}},{key:"addCoins",value:function value(e){this.updateCoins(we(we({},e),{},{coins:this.coins+e.coins}))}},{key:"removeCoins",value:function value(e){this.coins<e.coins?this.node.scene.emit(Co.REMOVE_COINS_FAILED):(this.updateCoins(we(we({},e),{},{coins:this.coins-e.coins})),this.node.scene.emit(Co.REMOVE_COINS_SUCCESS))}},{key:"emitCoinAmount",value:function value(){this.node.scene.emit(Co.COIN_CHANGED,{coins:this.coins})}},{key:"getShortAmount",value:function value(e){return Math.min(e,ZS)}},{key:"untilFinishesCollectAnim",value:function value(){return null===this.collectionAnimSignal?Promise.resolve():this.collectionAnimSignal.untilAborted()}},{key:"setTargetContainer",value:function value(e){this.targetContainer=e}},{key:"getTargetContainer",value:function value(){return this.targetContainer}},{key:"onDestroy",value:function value(){var _$e,t;null===(_$e=this.collectionAnimSignal)||void 0===_$e||_$e.abort(),null===(t=this.lifeCycleSignal)||void 0===t||t.abort()}}]),s}(y)).prototype,"coinPrefab",[LS],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),BS=Ye(MS.prototype,"coinTextPopup",[OS],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),FS=Ye(MS.prototype,"coinAnimContainer",[DS],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),NS=MS))||NS)||NS);n._RF.pop(),n._RF.push({},"d2a57+mB4NG9rcdh+dy1VPe","traverse4",void 0),n._RF.pop(),n._RF.push({},"ca614iJ+X5LrL1rX/wDQDTD","shuffle",void 0),n._RF.pop(),n._RF.push({},"1cf4cygDSdP5JL+7w3wIJL7","traverseRandom",void 0),n._RF.pop(),n._RF.push({},"1faa9NgJrBE7p8Zs/HBWrZn","pad",void 0),n._RF.pop(),n._RF.push({},"f3b1eQ+t3FJYa35I0oznLiF","ParticleProperties",void 0);var nw,iw,aw,ow,rw,sw=Ae(function e(){Ce(this,e),this.lifeCurrent=0,this.life=0,this.velocityX=0,this.velocityY=0,this.alpha=255,this.totalRotation=0,this.lastChange=0,this.currentFrame=0});n._RF.pop(),n._RF.push({},"32b8eGxcghFHZOi1WYXHCjF","BaseParticle",void 0);var lw,uw,cw,hw,dw,pw,yw,fw=i.ccclass,vw=i.property,mw=(nw=fw("BaseParticle"),iw=vw(A),nw((rw=Ye((ow=function(e){Ie(n,e);var t=xe(n);function n(){var _$e;Ce(this,n);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return je(_$e=t.call.apply(t,[this].concat(a)),"sprite",rw,Ne(_$e)),_$e.properties=new sw,_$e}return Ae(n,[{key:"__preload",value:function value(){this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function value(){if(!this.sprite)throw new Error("BaseParticle: Sprite not found")}},{key:"manualInit",value:function value(e,t){this.manager=e;var _$n=t.tint,i=t.velocityX,a=t.velocityY,r=t.totalRotation,s=t.lifespan,l=t.startAngle,u=t.scale;this.properties.lastChange=0;var c=new o;o.fromHEX(c,_$n),this.sprite.color=c,this.properties.velocityX=i,this.properties.velocityY=a,this.properties.life=s,this.properties.lifeCurrent=s,this.properties.totalRotation=r,this.node.angle=l,this.node.setScale(u,u,1)}},{key:"manualUpdate",value:function value(e){return this.computeVelocity(e),this.node.setPosition(this.node.position.x+this.properties.velocityX*e,this.node.position.y+this.properties.velocityY*e,0),this.node.angle+=this.properties.totalRotation*e/this.properties.life,this.properties.lifeCurrent-=e,this.properties.lifeCurrent<=0}},{key:"computeVelocity",value:function value(e){var t=this.properties,_$n=t.velocityX,i=t.velocityY;i+=this.manager.getGravityY()*e,this.properties.velocityX=_$n,this.properties.velocityY=i}}]),n}(y)).prototype,"sprite",[iw],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),aw=ow))||aw);n._RF.pop(),n._RF.push({},"b6123+a2K1LoY60oZO9SYKX","StarConfetti",void 0);var gw=i.ccclass,bw=i.property,Sw=(lw=gw("StarConfetti"),uw=bw([D]),cw=bw([D]),lw((pw=Ye((dw=function(e){Ie(n,e);var t=xe(n);function n(){var _$e;Ce(this,n);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return je(_$e=t.call.apply(t,[this].concat(a)),"starXFrames",pw,Ne(_$e)),je(_$e,"starYFrames",yw,Ne(_$e)),_$e.msPerFrame=.15,_$e.isYoyo=!1,_$e.isGravityChanged=!1,_$e}return Ae(n,[{key:"manualInit",value:function value(e,t){Fe(Pe(n.prototype),"manualInit",this).call(this,e,t),this.msPerFrame=.15,this.isYoyo=!1,this.isGravityChanged=!1}},{key:"manualUpdate",value:function value(e){var t=Fe(Pe(n.prototype),"manualUpdate",this).call(this,e);return this.updateGravity(),this.updateVelocity(),this.updateFrameRate(),this.updateFrames(e),t}},{key:"updateGravity",value:function value(){if(!(this.properties.lifeCurrent>this.properties.life-2||this.isGravityChanged)){this.isGravityChanged=!0;this.properties.velocityX/=3,this.manager.setGravityY(-23745/667)}}},{key:"updateVelocity",value:function value(){if(!(this.properties.lifeCurrent>this.properties.life-2)){this.properties.velocityX>0?this.properties.velocityX+=z.randomRangeInt(-12,6):this.properties.velocityX+=z.randomRangeInt(-6,12)}}},{key:"updateFrames",value:function value(e){if(this.properties.lastChange+=e,this.properties.lastChange>=this.msPerFrame){this.isYoyo?this.properties.currentFrame--:this.properties.currentFrame++,this.properties.currentFrame<0&&(this.isYoyo=!1,this.properties.currentFrame=1),this.properties.currentFrame>=4&&(this.isYoyo=!0,this.properties.currentFrame-=1);var t=Math.random()>.5?this.starXFrames:this.starYFrames;this.sprite.spriteFrame=t[this.properties.currentFrame],this.properties.lastChange-=this.msPerFrame}}},{key:"updateFrameRate",value:function value(){this.properties.lifeCurrent<this.properties.life-2?this.msPerFrame=.15:this.msPerFrame=z.randomRangeInt(300,600)/1e3}}]),n}(mw)).prototype,"starXFrames",[uw],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return[]}}),yw=Ye(dw.prototype,"starYFrames",[cw],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return[]}}),hw=dw))||hw);n._RF.pop(),n._RF.push({},"9caadUsaKtPEoOe+T2+pqtd","Properties",void 0);var ww,kw=Ae(function e(){Ce(this,e),this.delay=200,this.timeScale=2,this.tints=["#F1D171","#97E1FD","#7765D1","#ED4440","#F9E02A"],this.speedX={min:1583/75,max:1583*.24},this.speedY={min:1139.76,max:1219.76},this.gravityY=-664.86,this.lifespan={min:5,max:8},this.rotate={totalRotation:1080,random:!0},this.scale={min:.6,max:1},this.originGravityY=-664.86});n._RF.pop(),n._RF.push({},"d1648PsavVBn7B059PS5fj6","BaseEmitter",void 0);var Ew,Cw=(0,i.ccclass)("BaseEmitter")(ww=function(e){Ie(n,e);var t=xe(n);function n(){var _$e;Ce(this,n);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return(_$e=t.call.apply(t,[this].concat(a))).properties=new kw,_$e}return Ae(n,[{key:"getGravityY",value:function value(){return this.properties.gravityY}},{key:"setGravityY",value:function value(e){this.properties.gravityY=e}}]),n}(y))||ww;n._RF.pop(),n._RF.push({},"654983p4rREVKci1CE8cSJ2","ConfettiEmitter",void 0);var Tw,Aw,Rw,Iw,Pw,_w,Lw,Ow,Dw,Nw,Mw,xw=(0,i.ccclass)("ConfettiEmitter")(Ew=function(e){Ie(a,e);var t,n,i=xe(a);function a(){var _$e;Ce(this,a);for(var t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];return(_$e=i.call.apply(i,[this].concat(n))).activeStarConfetti=[],_$e}return Ae(a,[{key:"__preload",value:function value(){this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function value(){St.lazyValidateProperties(this)}},{key:"createConfettiPool",value:(n=Ee(function(){var _$e,_;return _ts_generator(this,function(_state){switch(_state.label){case 0:_$e=this;_=this;return[4,li.loadPrefabAsync("particles/StarConfetti")];case 1:_.starConfettiPrefab=_state.sent(),this.starConfettiPool=new cd(function(){var t=l(_$e.starConfettiPrefab);return _$e.node.addChild(t),t.active=!1,t},0,function(t){var n=t.getComponent(Sw);n?(_$e.activeStarConfetti.push(n),t.active=!0):console.error("StarConfetti not found")},function(e){e.getComponent(Sw)?e.active=!1:console.error("StarConfetti not found")},function(e){e.isValid&&e.destroy()}),this.properties.timeScale=1.5,this.properties.gravityY=688.605,this.properties.lifespan.min=4,this.properties.lifespan.max=6,this.properties.rotate.totalRotation=1800;return[2]}})}),function(){return n.apply(this,arguments)})},{key:"runEffect",value:(t=Ee(function(e,t,n){var _tmp,i,_$a,o,r,s,l,u,c,h,d,p,y;return _ts_generator(this,function(_state){switch(_state.label){case 0:_tmp=this.starConfettiPool;if(_tmp)return[3,2];return[4,this.createConfettiPool()];case 1:_tmp=_state.sent();_state.label=2;case 2:_tmp,this.properties.gravityY=this.properties.originGravityY;for(i=0;i<e;i++){_$a=this.starConfettiPool.alloc(),o=_$a.getComponent(Sw);if(!o)return[2,void console.error("StarConfetti not found")];_$a.setPosition(t.clone());r=this.properties.tints[Math.floor(Math.random()*this.properties.tints.length)],s=Math.random()*(this.properties.speedX.max-this.properties.speedX.min),l=Math.random()*(this.properties.speedY.max-this.properties.speedY.min)+this.properties.speedY.min,u=Math.random()*(this.properties.lifespan.max-this.properties.lifespan.min)+this.properties.lifespan.min,c=this.properties.rotate.random?180*Math.random():0,h=Math.random()*(this.properties.scale.max-this.properties.scale.min)+this.properties.scale.min,d={tint:r,velocityX:s,velocityY:l,lifespan:u,totalRotation:this.properties.rotate.totalRotation,startAngle:c,scale:h};o.manualInit(this,d);p=this.starConfettiPool.alloc(),y=p.getComponent(Sw);if(!y)return[2,void console.error("StarConfetti not found")];p.setPosition(n.clone()),d.velocityX=-s,y.manualInit(this,d)}return[2]}})}),function(e,n,i){return t.apply(this,arguments)})},{key:"clearEffect",value:function value(){var _$e,t=We(this.activeStarConfetti);try{for(t.s();!(_$e=t.n()).done;){var n=_$e.value;this.starConfettiPool.free(n.node)}}catch(e){t.e(e)}finally{t.f()}this.activeStarConfetti=[]}},{key:"update",value:function value(e){var t=this,n=e*this.properties.timeScale,i=[];this.activeStarConfetti.forEach(function(e){e.manualUpdate(n)&&i.push(e)}),i.forEach(function(e){t.starConfettiPool.free(e.node),t.activeStarConfetti.splice(t.activeStarConfetti.indexOf(e),1)})}}]),a}(Cw))||Ew;n._RF.pop(),n._RF.push({},"78c97IkjeJFQohPZudvcfeS","Ribbon",void 0);var Bw,Fw,zw,Gw,Uw,Hw=i.ccclass,Vw=i.property,qw=GameCore.Utils.Array,Ww=(Tw=Hw("Ribbon"),Aw=Vw([D]),Rw=Vw([D]),Iw=Vw([D]),Pw=Vw([D]),Tw((Ow=Ye((Lw=function(e){Ie(n,e);var t=xe(n);function n(){var _$e;Ce(this,n);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return je(_$e=t.call.apply(t,[this].concat(a)),"ribbonA",Ow,Ne(_$e)),je(_$e,"ribbonB",Dw,Ne(_$e)),je(_$e,"ribbonC",Nw,Ne(_$e)),je(_$e,"ribbonD",Mw,Ne(_$e)),_$e.useFrames=[],_$e.msPerFrame=.15,_$e.isYoyo=!1,_$e.isGravityChanged=!1,_$e.points=[],_$e}return Ae(n,[{key:"manualInit",value:function value(e,t){Fe(Pe(n.prototype),"manualInit",this).call(this,e,t),this.msPerFrame=.15,this.isYoyo=!1,this.isGravityChanged=!1,this.points=qw.fillWith(10,function(){return{x:0,y:0}});var i=Math.random();this.useFrames=i<.25?this.ribbonA:i<.5?this.ribbonB:i<.75?this.ribbonC:this.ribbonD,this.sprite.enabled=!1}},{key:"manualUpdate",value:function value(e){var t=Fe(Pe(n.prototype),"manualUpdate",this).call(this,e);return this.updateFrames(e),this.updatePoints(),this.updateGravity(),this.updateVelocity(),t}},{key:"updateFrames",value:function value(e){this.properties.lastChange+=e,this.properties.lastChange>=this.msPerFrame&&(this.isYoyo?this.properties.currentFrame--:this.properties.currentFrame++,this.properties.currentFrame<0&&(this.isYoyo=!1,this.properties.currentFrame=1),this.properties.currentFrame>=this.useFrames.length&&(this.isYoyo=!0,this.properties.currentFrame-=1),this.sprite.spriteFrame=this.useFrames[this.properties.currentFrame],this.properties.lastChange-=this.msPerFrame)}},{key:"updatePoints",value:function value(){if(!this.isGravityChanged){this.points.shift();var _$e=this.node.worldPosition,t=_$e.x,_$n=_$e.y;this.points.push({x:t,y:_$n})}}},{key:"updateGravity",value:function value(){if(!(this.properties.lifeCurrent>this.properties.life-2||this.isGravityChanged)){this.isGravityChanged=!0,this.points=[],this.sprite.enabled=!0,this.properties.velocityX/=3;this.manager.setGravityY(-23745/667)}}},{key:"updateVelocity",value:function value(){if(!this.isGravityChanged){this.properties.lifeCurrent>this.properties.life-1.8?this.properties.velocityX+=z.randomRangeInt(-24,24):this.properties.velocityX>0?this.properties.velocityX+=z.randomRangeInt(-20,12):this.properties.velocityX+=z.randomRangeInt(-12,20)}}},{key:"getGlobalPoints",value:function value(){return this.points}},{key:"getColor",value:function value(){return this.sprite.color}}]),n}(mw)).prototype,"ribbonA",[Aw],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return[]}}),Dw=Ye(Lw.prototype,"ribbonB",[Rw],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return[]}}),Nw=Ye(Lw.prototype,"ribbonC",[Iw],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return[]}}),Mw=Ye(Lw.prototype,"ribbonD",[Pw],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return[]}}),_w=Lw))||_w);n._RF.pop(),n._RF.push({},"f2427J2HhBKdpkcqDn2Vv5H","RibbonEmitter",void 0);var Kw,jw,Yw,Xw,Jw,Qw,Zw,$w=i.ccclass,ek=i.property,tk=(Bw=$w("RibbonEmitter"),Fw=ek(q),Bw((Uw=Ye((Gw=function(e){Ie(a,e);var t,n,i=xe(a);function a(){var _$e;Ce(this,a);for(var t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];return je(_$e=i.call.apply(i,[this].concat(n)),"graphics",Uw,Ne(_$e)),_$e.activeRibbonConfetti=[],_$e}return Ae(a,[{key:"__preload",value:function value(){this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function value(){St.lazyValidateProperties(this)}},{key:"createConfettiPool",value:(n=Ee(function(){var _$e,_;return _ts_generator(this,function(_state){switch(_state.label){case 0:_$e=this;_=this;return[4,li.loadPrefabAsync("particles/Ribbon")];case 1:_.ribbonPrefab=_state.sent(),this.ribbonConfettiPool=new cd(function(){var t=l(_$e.ribbonPrefab);return _$e.node.addChild(t),t.active=!1,t},0,function(t){var n=t.getComponent(Ww);n?(_$e.activeRibbonConfetti.push(n),t.active=!0):console.error("StarConfetti not found")},function(e){e.getComponent(Ww)?e.active=!1:console.error("StarConfetti not found")},function(e){e.destroy()});return[2]}})}),function(){return n.apply(this,arguments)})},{key:"runEffect",value:(t=Ee(function(e,t,n){var _tmp,i,_$a,o,r,s,l,u,c,h,d,p,y;return _ts_generator(this,function(_state){switch(_state.label){case 0:_tmp=this.ribbonConfettiPool;if(_tmp)return[3,2];return[4,this.createConfettiPool()];case 1:_tmp=_state.sent();_state.label=2;case 2:_tmp,this.properties.gravityY=this.properties.originGravityY;for(i=0;i<e;i++){_$a=this.ribbonConfettiPool.alloc(),o=_$a.getComponent(Ww);if(!o)return[2,void console.error("StarConfetti not found")];_$a.setPosition(t.clone());r=this.properties.tints[Math.floor(Math.random()*this.properties.tints.length)],s=Math.random()*(this.properties.speedX.max-this.properties.speedX.min),l=Math.random()*(this.properties.speedY.max-this.properties.speedY.min)+this.properties.speedY.min,u=Math.random()*(this.properties.lifespan.max-this.properties.lifespan.min)+this.properties.lifespan.min,c=this.properties.rotate.random?180*Math.random():0,h=Math.random()*(this.properties.scale.max-this.properties.scale.min)+this.properties.scale.min,d={tint:r,velocityX:s,velocityY:l,lifespan:u,totalRotation:this.properties.rotate.totalRotation,startAngle:c,scale:h};o.manualInit(this,d);p=this.ribbonConfettiPool.alloc(),y=p.getComponent(Ww);if(!y)return[2,void console.error("StarConfetti not found")];p.setPosition(n.clone()),d.velocityX=-s,y.manualInit(this,d)}return[2]}})}),function(e,n,i){return t.apply(this,arguments)})},{key:"clearEffect",value:function value(){var _$e,t=We(this.activeRibbonConfetti);try{for(t.s();!(_$e=t.n()).done;){var n=_$e.value;this.ribbonConfettiPool.free(n.node)}}catch(e){t.e(e)}finally{t.f()}this.activeRibbonConfetti=[]}},{key:"update",value:function value(e){var t=this,n=e*this.properties.timeScale;this.graphics.clear();var i=[];this.activeRibbonConfetti.forEach(function(e){e.manualUpdate(n)&&i.push(e),t.drawGraphics(e.getGlobalPoints(),e.getColor())}),i.forEach(function(e){t.ribbonConfettiPool.free(e.node),t.activeRibbonConfetti.splice(t.activeRibbonConfetti.indexOf(e),1)})}},{key:"drawGraphics",value:function value(e,t){if(this.graphics.node.active){var n,i=We(e);try{for(i.s();!(n=i.n()).done;){if(0===n.value.y)return}}catch(e){i.e(e)}finally{i.f()}if(!(e.length<2)){this.graphics.strokeColor=t;var _$a=new Y(e[0].x,e[0].y,0);_$a=this.node.inverseTransformPoint(_$a,_$a),this.graphics.moveTo(_$a.x,_$a.y);for(var o=1;o<e.length;o++)_$a.x=e[o].x,_$a.y=e[o].y,_$a=this.node.inverseTransformPoint(_$a,_$a),this.graphics.lineTo(_$a.x,_$a.y);this.graphics.stroke()}}}}]),a}(Cw)).prototype,"graphics",[Fw],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),zw=Gw))||zw);n._RF.pop(),n._RF.push({},"f7cfcFAL8tBE70g2A0+qMTR","PaperConfetti",void 0);var nk,ik=i.ccclass,ak=i.property,ok=(Kw=ik("PaperConfetti"),jw=ak(xw),Yw=ak(tk),Kw((Qw=Ye((Jw=function(e){Ie(n,e);var t=xe(n);function n(){var _$e;Ce(this,n);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return(_$e=t.call.apply(t,[this].concat(a))).spawnLeftPos=new Y(-375,-791.5,0),_$e.spawnRightPos=new Y(375,-791.5,0),je(_$e,"confettiEmitter",Qw,Ne(_$e)),je(_$e,"ribbonEmitter",Zw,Ne(_$e)),_$e}return Ae(n,[{key:"__preload",value:function value(){this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function value(){if(!this.confettiEmitter)throw new Error("PaperConfetti: ConfettiEmitter not found");if(!this.ribbonEmitter)throw new Error("PaperConfetti: RibbonEmitter not found")}},{key:"runEffect",value:function value(){var _$e=this;this.scheduleOnce(function(){_$e.confettiEmitter.runEffect(25,_$e.spawnLeftPos,_$e.spawnRightPos)},.2),this.ribbonEmitter.runEffect(20,this.spawnLeftPos,this.spawnRightPos)}},{key:"clearEffect",value:function value(){this.unscheduleAllCallbacks(),this.confettiEmitter.clearEffect(),this.ribbonEmitter.clearEffect()}}]),n}(y)).prototype,"confettiEmitter",[jw],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Zw=Ye(Jw.prototype,"ribbonEmitter",[Yw],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Xw=Jw))||Xw);n._RF.pop(),n._RF.push({},"4a9beTdMntC0q9yngb8a2go","BootScene",void 0);var rk,sk,lk,uk,ck,hk,dk,pk,yk,fk,vk,mk=i.ccclass,gk=i.disallowMultiple,bk=GameCore,Sk=bk.Events,wk=bk.Configs,kk=bk.Utils,Ek=kk.Time,Ck=kk.Valid,Tk=globalThis.game,Ak=Tk.ads,Rk=Tk.player,Ik=Tk.event;mk("BootScene")(nk=gk(nk=function(e){Ie(i,e);var t,n=xe(i);function i(){var _$e;Ce(this,i);for(var t=arguments.length,a=new Array(t),o=0;o<t;o++)a[o]=arguments[o];return(_$e=n.call.apply(n,[this].concat(a))).processWhenGameSdkStarted=function(){_$e.setupGameData()},_$e.processPreloadAssets=function(){_$e.loadCurrentPlayerTheme().catch(function(e){return console.error("loadCurrentPlayerTheme",e)})},_$e.handleShowAdWhenLoadGame=Ee(function(){var t,n,_$i,a,o,r,_tmp,s,e;return _ts_generator(this,function(_state){switch(_state.label){case 0:t=wk.Ads,n=t.Enabled,_$i=t.ShowAdOnLoad;if(!n)return[3,7];a=_$i.Enabled,o=_$i.DelaySeconds,r=_$i.PlacementId;if(!a)return[3,7];_state.label=1;case 1:_state.trys.push([1,5,6,7]);_tmp=o>0;if(!_tmp)return[3,3];return[4,Ek.sleepAsync(1e3*o)];case 2:_tmp=_state.sent();_state.label=3;case 3:_tmp;s=Ak.getAdByPlacementId(r);if(!s)return[2];return[4,_$e.showAdWhenLoadGame(s)];case 4:_state.sent();return[3,7];case 5:e=_state.sent();console.warn("handleShowAdWhenLoadGame failed",e);return[3,7];case 6:kv.preloadAds();return[7];case 7:return[2]}})}),_$e.handlePauseAudio=function(){Ik.on(Sk.VISIBILITY_HIDDEN,_$e.handleMuteAudio),Ik.on(Sk.VISIBILITY_VISIBLE,_$e.handleUnMuteAudio),Ik.on(Sk.VISIBILITY_VISIBLE,_$e.handleForceEngineRunning)},_$e.handleMuteAudio=function(){Pi.muteAudio(!0)},_$e.handleUnMuteAudio=function(){Ak.isAdFullSizeShowing()||Pi.muteAudio(!1)},_$e.handleForceEngineRunning=function(){p.resume()},_$e}return Ae(i,[{key:"__preload",value:function value(){this.setupAndroidPlatformAds(),this.processCrazyGamesLoadingStart(),this.validateRequiredComponents(),this.listenEvents()}},{key:"validateRequiredComponents",value:function value(){St.lazyValidateProperties(this)}},{key:"onLoad",value:function value(){this.handlePauseAudio(),this.processPreloadAssets(),wk.Core.StartSDKAfterLoadGame||Mu.showLoadingFullScreen(Sl)}},{key:"start",value:function value(){this.processCrazyGamesLoadingStop()}},{key:"listenEvents",value:function value(){Ik.once(Sk.GAME_SDK_STARTED,this.processWhenGameSdkStarted),Ik.once(Sk.GAME_READY,this.handleShowAdWhenLoadGame)}},{key:"setupGameData",value:function value(){var _$e=Rk.getGameData();if(_$e){var t=_$e.totalLevel,n=we(we({},_$e),{},{totalLevel:0===t?80:t});Rk.setGameData(n)}}},{key:"loadCurrentPlayerTheme",value:function value(){var _$e=xl.mapOrder,t=_$e[0],n=Rk.getGameData();console.log("loadCurrentPlayerTheme",n);var _$i=null==n?void 0:n.level;if(!Ck.isNumber(_$i))return li.loadThemeAsync(t.theme);var a,o=We(_$e);try{for(o.s();!(a=o.n()).done;){var r=a.value;if((_$i-=r.levelCount)<=0){t=r;break}}}catch(e){o.e(e)}finally{o.f()}return li.loadThemeAsync(t.theme)}},{key:"showAdWhenLoadGame",value:(t=Ee(function(e){var t,n,e1;return _ts_generator(this,function(_state){switch(_state.label){case 0:_state.trys.push([0,3,4,5]);t=e.type,n=e.placementId;return[4,Ak.loadAdAsync(t,n)];case 1:_state.sent(),Pi.muteAudio(!0);return[4,Ak.showAdAsync(t,n)];case 2:_state.sent();return[3,5];case 3:e1=_state.sent();console.warn("showAdWhenLoadGame failed",e1);return[3,5];case 4:Pi.muteAudio(!1);return[7];case 5:return[2]}})}),function(e){return t.apply(this,arguments)})},{key:"processCrazyGamesLoadingStart",value:function value(){"gameLoadingStart"in GameSDK.extra&&GameSDK.extra.gameLoadingStart()}},{key:"processCrazyGamesLoadingStop",value:function value(){"gameLoadingStop"in GameSDK.extra&&GameSDK.extra.gameLoadingStop()}},{key:"setupAndroidPlatformAds",value:function value(){}}]),i}(y))||nk);n._RF.pop(),n._RF.push({},"29f874DL75LO5NzzNYZvHDh","RigidBodyObject",void 0);var Pk,_k,Lk,Ok,Dk,Nk,Mk,xk,Bk,Fk=i.ccclass,zk=i.property,Gk=(rk=Fk("RigidBodyObject"),sk=zk(E),lk=zk(Q),uk=zk(E),ck=zk(H),rk((pk=Ye((dk=function(e){Ie(n,e);var t=xe(n);function n(){var _$e;Ce(this,n);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return je(_$e=t.call.apply(t,[this].concat(a)),"gravityScale",pk,Ne(_$e)),je(_$e,"linearVelocity",yk,Ne(_$e)),je(_$e,"bounce",fk,Ne(_$e)),je(_$e,"simulate",vk,Ne(_$e)),_$e}return Ae(n,[{key:"onLoad",value:function value(){this.canvas=this.node.scene.getComponentInChildren(r).getComponent(s),this.uiTransform=this.node.getComponent(s)}},{key:"update",value:function value(e){if(this.simulate){this.applyGravity();var t=this.node.worldPosition.clone();t.add(new Y(this.linearVelocity.x*e,this.linearVelocity.y*e,0)),t=this.applyBounce(t),this.node.setWorldPosition(t)}}},{key:"applyForce",value:function value(e){this.linearVelocity.add(e)}},{key:"applyGravity",value:function value(){var _$e=new Q(0,-9.8*this.gravityScale);this.applyForce(_$e)}},{key:"applyBounce",value:function value(e){var t=this.uiTransform.getBoundingBoxToWorld();t.yMin<0&&(e.y=t.height/2,this.linearVelocity.y*=-this.bounce),t.xMin<0&&(e.x=t.width/2,this.linearVelocity.x*=-1);var _$n=this.canvas.width;return t.xMax>_$n&&(e.x=_$n-t.width/2,this.linearVelocity.x*=-1),e}}]),n}(y)).prototype,"gravityScale",[sk],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return 1}}),yk=Ye(dk.prototype,"linearVelocity",[lk],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return new Q(0,0)}}),fk=Ye(dk.prototype,"bounce",[uk],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),vk=Ye(dk.prototype,"simulate",[ck],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),hk=dk))||hk);n._RF.pop(),n._RF.push({},"93d88BQCU5B0L/TmaCaYNfm","AnimSkipOverlay",void 0);var Uk,Hk,Vk,qk,Wk,Kk,jk,Yk,Xk,Jk=i.ccclass,Qk=i.property,Zk=i.disallowMultiple,$k=function $k(){},eE=(Pk=Jk("AnimSkipOverlay"),_k=Qk(x),Lk=Qk(x),Ok=Qk(d),Pk(Dk=Zk((Mk=Ye((Nk=function(e){Ie(a,e);var t,n,i=xe(a);function a(){var _$e;Ce(this,a);for(var t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];return je(_$e=i.call.apply(i,[this].concat(n)),"containerUIOpacity",Mk,Ne(_$e)),je(_$e,"maskUIOpacity",xk,Ne(_$e)),je(_$e,"skipButton",Bk,Ne(_$e)),_$e.isOpened=!1,_$e.currentCallback=$k,_$e}return Ae(a,[{key:"__preload",value:function value(){this.validateRequiredComponents(),this.containerUIOpacity.node.active=!1,this.skipButton.interactable=!1}},{key:"onSkipButtonPress",value:function value(){this.currentCallback(),this.close()}},{key:"validateRequiredComponents",value:function value(){St.lazyValidateProperties(this)}},{key:"open",value:(n=Ee(function(e){var t,n,i,_$a,o;return _ts_generator(this,function(_state){switch(_state.label){case 0:this.containerUIOpacity.node.active=!0;t=e.onSkip,n=e.opacity,i=void 0===n?255:n,_$a=e.transitionDuration,o=void 0===_$a?.2:_$a;this.maskUIOpacity.opacity=i;return[4,this.animateUIOpacity(0,255,o)];case 1:_state.sent(),this.currentCallback=t,this.skipButton.interactable=!0,this.isOpened=!0,this.node.scene.emit(_a,e);return[2]}})}),function(e){return n.apply(this,arguments)})},{key:"close",value:(t=Ee(function(){var _$e;var _arguments=arguments;return _ts_generator(this,function(_state){switch(_state.label){case 0:_$e=_arguments.length>0&&void 0!==_arguments[0]?_arguments[0]:.2;this.skipButton.interactable=!1,this.currentCallback=$k;return[4,this.animateUIOpacity(255,0,_$e)];case 1:_state.sent(),this.maskUIOpacity.opacity=0,this.containerUIOpacity.node.active=!1,this.isOpened=!1,this.node.scene.emit(La);return[2]}})}),function(){return t.apply(this,arguments)})},{key:"animateUIOpacity",value:function value(e,t,n){return this.containerUIOpacity.opacity=e,gn.runTweenAsync(k(this.containerUIOpacity).to(n,{opacity:t}))}},{key:"untilClosed",value:function value(){var _$e=this;return!1===this.isOpened?Promise.resolve():new Promise(function(t){_$e.node.scene.once(La,t)})}}]),a}(y)).prototype,"containerUIOpacity",[_k],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),xk=Ye(Nk.prototype,"maskUIOpacity",[Lk],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Bk=Ye(Nk.prototype,"skipButton",[Ok],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Dk=Nk))||Dk)||Dk);n._RF.pop(),n._RF.push({},"755d1r2cMRLvo4fObNWxss/","CoinContainer",void 0);var tE,nE,iE,aE,oE,rE,sE,lE,uE,cE,hE,dE,pE,yE,fE,vE,mE,gE=i.ccclass,bE=i.property,SE=GameCore.Utils.Number,wE=(Uk=gE("CoinContainer"),Hk=bE(u),Vk=bE(A),qk=bE(x),Uk((jk=Ye((Kk=function(e){Ie(o,e);var t,n,i,a=xe(o);function o(){var _$e;Ce(this,o);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return je(_$e=a.call.apply(a,[this].concat(n)),"coinLabel",jk,Ne(_$e)),je(_$e,"coinIcon",Yk,Ne(_$e)),je(_$e,"explosionCircle",Xk,Ne(_$e)),_$e.currentCoin=0,_$e}return Ae(o,[{key:"setCoinText",value:function value(e){this.coinLabel.string=e}},{key:"handleAddCoinButton",value:function value(){Mu.openScreen(ki.GET_COIN_SCREEN,{quantity:sl})}},{key:"onLoad",value:function value(){this.validateRequiredComponents(),this.listenToEvents()}},{key:"validateRequiredComponents",value:function value(){St.lazyValidateProperties(this)}},{key:"listenToEvents",value:function value(){this.node.scene.on(Co.COIN_CHANGED,this.updateCoins,this)}},{key:"updateCoins",value:(i=Ee(function(e){var t,n,i,a,_$o,r;return _ts_generator(this,function(_state){switch(_state.label){case 0:n=e.coins,i=e.collectionAnimation;if(!(void 0!==i&&!1!==this.node.activeInHierarchy))return[3,4];a=i.signal;if(!(null===(t=this.animAbortSignal)||void 0===t||t.abort(),this.animAbortSignal=null!=a?a:new Bn,i.animateTextOnly))return[3,2];return[4,this.animateCoinText(n,0,a)];case 1:return[2,(_state.sent(),void this.setCoins(n))];case 2:_$o=i.flyDuration,r=i.floatDuration+_$o;return[4,this.animateCoinText(n,r,a)];case 3:_state.sent(),this.setCoins(n);return[3,5];case 4:this.setCoins(n);_state.label=5;case 5:return[2]}})}),function(e){return i.apply(this,arguments)})},{key:"setCoins",value:function value(e){this.setCoinText(SE.getShortNumber(e,3)),this.currentCoin=e}},{key:"animateCoinText",value:(n=Ee(function(e,t,n){var i,a;return _ts_generator(this,function(_state){switch(_state.label){case 0:i=this,a=this.currentCoin;return[4,gn.waitTweenAsync(t,n)];case 1:_state.sent(),Pi.playSound(vi.COLLECT_COINS);return[4,gn.runOnUpdateAsync(this.node,1,function(t){var _$n=Math.round(a+(e-a)*t);i.setCoinText(SE.getShortNumber(_$n,3))},n)];case 2:_state.sent();return[2]}})}),function(e,t,i){return n.apply(this,arguments)})},{key:"emitExplodeEffect",value:(t=Ee(function(e){return _ts_generator(this,function(_state){switch(_state.label){case 0:this.explosionCircle.opacity=255,this.explosionCircle.node.setScale(0,0);return[4,Promise.all([gn.runTweenAsync(k(this.explosionCircle.node).to(.4,{scale:new Y(3,3,3)},{easing:"quadOut"}),e),gn.runTweenAsync(k(this.explosionCircle).delay(.2).to(.2,{opacity:0}),e)])];case 1:_state.sent(),this.explosionCircle.node.setScale(0,0),this.explosionCircle.opacity=0;return[2]}})}),function(e){return t.apply(this,arguments)})},{key:"getCoinIconWorldPosition",value:function value(){return this.coinIcon.node.worldPosition}},{key:"getCoinIconWorldScale",value:function value(){return this.coinIcon.node.worldScale}},{key:"onDestroy",value:function value(){var _$e;null===(_$e=this.animAbortSignal)||void 0===_$e||_$e.abort()}}]),o}(y)).prototype,"coinLabel",[Hk],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Yk=Ye(Kk.prototype,"coinIcon",[Vk],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Xk=Ye(Kk.prototype,"explosionCircle",[qk],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Wk=Kk))||Wk);n._RF.pop(),n._RF.push({},"a1833nGls5Ac4p0tpu/jEqi","ItemContainer",void 0);var kE,EE,CE,TE,AE,RE,IE,PE,_E,LE,OE,DE,NE,ME,xE,BE,FE,zE,GE,UE,HE,VE=i.ccclass,qE=i.property,WE=globalThis.game.player,KE=[1e3,1500];tE=VE("ItemContainer"),nE=qE({type:a,group:"Hint"}),iE=qE({type:u,group:"Hint"}),aE=qE({type:a,group:"Thunder"}),oE=qE({type:u,group:"Thunder"}),rE=qE({type:a,group:"Storm"}),sE=qE({type:u,group:"Storm"}),lE=qE(P),tE((hE=Ye((cE=function(e){Ie(u,e);var t,n,i,a,o,s=xe(u);function u(){var _$e;Ce(this,u);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return je(_$e=s.call.apply(s,[this].concat(n)),"hintNode",hE,Ne(_$e)),je(_$e,"hintLabel",dE,Ne(_$e)),_$e.hintCollection=[],je(_$e,"thunderNode",pE,Ne(_$e)),je(_$e,"thunderLabel",yE,Ne(_$e)),_$e.thunderCollection=[],je(_$e,"stormNode",fE,Ne(_$e)),je(_$e,"stormLabel",vE,Ne(_$e)),_$e.stormCollection=[],je(_$e,"itemPrefab",mE,Ne(_$e)),_$e}return Ae(u,[{key:"onLoad",value:function value(){this.canvas=this.node.scene.getComponentInChildren(r).node,this.widget=this.getComponent(C),this.defaultRightWidget=this.widget.right,this.uiOpacity=this.getComponent(x),this.validateRequiredComponents(),this.listenToEvents()}},{key:"start",value:function value(){this.prepareItemCollection()}},{key:"validateRequiredComponents",value:function value(){St.lazyValidateProperties(this)}},{key:"listenToEvents",value:function value(){this.node.scene.on(Co.ADD_ITEMS,this.handleAddItems,this)}},{key:"prepareItemCollection",value:function value(){for(var _$e=0;_$e<9;_$e++){var t=l(this.itemPrefab),n=l(this.itemPrefab),i=l(this.itemPrefab);t.parent=this.canvas,n.parent=this.canvas,i.parent=this.canvas,t.active=!1,n.active=!1,i.active=!1,this.hintCollection.push(t.getComponent(Gk)),this.thunderCollection.push(n.getComponent(Gk)),this.stormCollection.push(i.getComponent(Gk))}}},{key:"updateStatus",value:function value(e){var t=e.items;this.hintLabel.string="".concat(t.hint),this.thunderLabel.string="".concat(t.thunder),this.stormLabel.string="".concat(t.storm)}},{key:"show",value:(o=Ee(function(){var _$e;return _ts_generator(this,function(_state){switch(_state.label){case 0:this.uiOpacity.opacity=255;_$e=k(this.widget).to(1.5,{right:0},{easing:"quadOut"});return[4,gn.runTweenAsync(_$e,this.animAbortSignal)];case 1:_state.sent(),this.widget.right=0;return[2]}})}),function(){return o.apply(this,arguments)})},{key:"hide",value:(a=Ee(function(){var _$e;return _ts_generator(this,function(_state){switch(_state.label){case 0:_$e=k(this.widget).to(1,{right:this.defaultRightWidget},{easing:"quadIn"});return[4,gn.runTweenAsync(_$e)];case 1:_state.sent(),this.uiOpacity.opacity=0;return[2]}})}),function(){return a.apply(this,arguments)})},{key:"handleAddItems",value:(i=Ee(function(e){var t,n,i,a,o;return _ts_generator(this,function(_state){switch(_state.label){case 0:n=this;this.animAbortSignal=null!==(t=e.signal)&&void 0!==t?t:new Bn;i=WE.getGameData();if(!i)return[3,3];this.updateStatus(i);a=this.show(),o=e.items.map(function(e){return n.animateItemCollection(e.item,e.quantity,1.5)});return[4,Promise.all([a].concat(He(o)))];case 1:_state.sent(),i.items=we(we({},i.items),{},{hint:i.items.hint+e.items[0].quantity,thunder:i.items.thunder+e.items[1].quantity,storm:i.items.storm+e.items[2].quantity}),WE.setGameData(i),this.updateStatus(i);return[4,this.hide()];case 2:_state.sent();_state.label=3;case 3:return[2]}})}),function(e){return i.apply(this,arguments)})},{key:"animateItemCollection",value:(n=Ee(function(e,t,n){var i,a,o;return _ts_generator(this,function(_state){switch(_state.label){case 0:i=this,a=this.getItemCollection(e).slice(0,t);if(!(0!==a.length))return[3,2];o=a.map(function(t,a){t.node.active=!0,t.node.position=new Y(0,0,t.node.position.z),t.linearVelocity=new Q(0,0),t.simulate=!0;var o=ie(Math.PI/3,2*Math.PI/3),r=ie(KE[0],KE[1])*Math.cos(o),s=ie(KE[0],KE[1])*Math.sin(o);t.applyForce(new Q(r,s));var l=i.getTargetNode(e);if(l)return t.getComponent(A).spriteFrame=l.getComponent(A).spriteFrame,i.getItemAnimation(t,l,n+.03*a)});return[4,Promise.all(o)];case 1:_state.sent();_state.label=2;case 2:return[2]}})}),function(e,t,i){return n.apply(this,arguments)})},{key:"getItemCollection",value:function value(e){switch(e){case"hint":return this.hintCollection;case"thunder":return this.thunderCollection;case"storm":return this.stormCollection;default:return[]}}},{key:"getTargetNode",value:function value(e){switch(e){case"hint":return this.hintNode;case"thunder":return this.thunderNode;case"storm":return this.stormNode;default:return null}}},{key:"getItemAnimation",value:(t=Ee(function(e,t){var n,i,a;var _arguments=arguments;return _ts_generator(this,function(_state){switch(_state.label){case 0:n=_arguments.length>2&&void 0!==_arguments[2]?_arguments[2]:0;e.node.scale=new Y(2,2,2);return[4,gn.waitTweenAsync(n,this.animAbortSignal)];case 1:_state.sent();i=e.node.worldPosition.clone(),a=k(e.node).to(1,{scale:t.scale},{onUpdate:function onUpdate(n,a){if(n&&a){var o=M.cubicIn(a);t&&(e.node.worldPosition=i.lerp(t.worldPosition,o))}},onComplete:function onComplete(){e.node.setPosition(0,0),e.node.active=!1}});return[4,gn.runTweenAsync(a,this.animAbortSignal)];case 2:_state.sent(),e.node.scale=t.scale.clone(),e.node.setPosition(0,0),e.node.active=!1;return[2]}})}),function(e,n){return t.apply(this,arguments)})},{key:"onDestroy",value:function value(){var _$e;null===(_$e=this.animAbortSignal)||void 0===_$e||_$e.abort()}}]),u}(y)).prototype,"hintNode",[nE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),dE=Ye(cE.prototype,"hintLabel",[iE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),pE=Ye(cE.prototype,"thunderNode",[aE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),yE=Ye(cE.prototype,"thunderLabel",[oE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),fE=Ye(cE.prototype,"stormNode",[rE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),vE=Ye(cE.prototype,"stormLabel",[sE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),mE=Ye(cE.prototype,"itemPrefab",[lE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),uE=cE));n._RF.pop(),n._RF.push({},"ba822axo49BibgkqkEhhqVp","DashboardPage",void 0);var jE,YE,XE,JE,QE,ZE,$E,eC,tC,nC,iC,aC=i.ccclass,oC=i.property,rC=i.disallowMultiple,sC=i.requireComponent,lC=(kE=aC("DashboardPage"),EE=sC(C),CE=sC(x),TE=oC({type:a,displayName:"Page's container"}),AE=oC({type:a,displayName:"Placeholder"}),RE=oC({displayName:"Don't load page",tooltip:"Tell the component to not preload the page even if it hasn't loaded yet"}),IE=oC({type:P,displayName:"Page prefab",visible:function visible(){return!this.hasLoaded}}),PE=oC({displayName:"Darken background"}),_E=oC({type:g,min:0,max:255,displayName:"Background opacity",visible:function visible(){return this.darkenBackground}}),LE=oC({displayName:"Use navbar shadow"}),OE=oC({type:g,min:0,max:255,displayName:"Navbar shadow opacity",visible:function visible(){return this.useNavbarShadow}}),kE(DE=rC(DE=EE(DE=CE((ME=Ye((NE=function(e){Ie(a,e);var t,n,i=xe(a);function a(){var _$e;Ce(this,a);for(var t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];return je(_$e=i.call.apply(i,[this].concat(n)),"container",ME,Ne(_$e)),je(_$e,"placeholder",xE,Ne(_$e)),je(_$e,"hasLoaded",BE,Ne(_$e)),je(_$e,"pagePrefab",FE,Ne(_$e)),je(_$e,"darkenBackground",zE,Ne(_$e)),je(_$e,"backgroundOpacity",GE,Ne(_$e)),je(_$e,"useNavbarShadow",UE,Ne(_$e)),je(_$e,"navbarShadowOpacity",HE,Ne(_$e)),_$e}return Ae(a,[{key:"onLoad",value:function value(){this.containerUIOpacity=this.container.getComponent(x),this.placeholderUIOpacity=this.placeholder.getComponent(x),this.widgetComponent=this.node.getComponent(C),this.uiOpacity=this.node.getComponent(x),this.validateRequiredComponents();var _$e=this.container.getComponent(T);this.layoutComponents=_$e?[_$e]:[],this.widgetComponents=[this.widgetComponent].concat(He(this.container.getComponentsInChildren(C)))}},{key:"start",value:function value(){this.container.active=!0,this.placeholder.active=!0}},{key:"getWidget",value:function value(){return this.widgetComponent}},{key:"updateWidgets",value:function value(){this.widgetComponents.forEach(function(e){e.updateAlignment()})}},{key:"updateLayouts",value:function value(){this.layoutComponents.forEach(function(e){e.updateLayout()})}},{key:"show",value:function value(){this.uiOpacity.opacity=255}},{key:"hide",value:function value(){this.uiOpacity.opacity=0}},{key:"mount",value:(n=Ee(function(){var _tmp;return _ts_generator(this,function(_state){switch(_state.label){case 0:_tmp=this.hasLoaded;if(_tmp)return[3,2];return[4,this.create()];case 1:_tmp=_state.sent();_state.label=2;case 2:_tmp,this.placeholderUIOpacity.opacity=0,this.containerUIOpacity.opacity=255,Ii.trackCurrentPage(this.node.name,!0);return[2]}})}),function(){return n.apply(this,arguments)})},{key:"unmount",value:function value(){255===this.placeholderUIOpacity.opacity&&0===this.containerUIOpacity.opacity||(this.placeholderUIOpacity.opacity=255,this.containerUIOpacity.opacity=0)}},{key:"transitionIn",value:function value(){return Promise.resolve()}},{key:"transitionOut",value:function value(){return Promise.resolve()}},{key:"hasLoadedPage",value:function value(){return this.hasLoaded}},{key:"getContainer",value:function value(){return this.container}},{key:"getDarkenBackground",value:function value(){return this.darkenBackground?this.backgroundOpacity:0}},{key:"getNavbarShadow",value:function value(){return this.useNavbarShadow?this.navbarShadowOpacity:0}},{key:"create",value:(t=Ee(function(){var _$e,t,n,i,_$a;return _ts_generator(this,function(_state){switch(_state.label){case 0:if(!(this.pagePrefab&&!this.hasLoaded))return[3,2];n=l(this.pagePrefab),i=n.getComponentsInChildren(C);(_$e=this.widgetComponents).push.apply(_$e,He(i));_$a=n.getComponentsInChildren(T);(t=this.layoutComponents).push.apply(t,He(_$a)),this.container.addChild(n);return[4,gn.waitTweenAsync(0)];case 1:_state.sent(),this.hasLoaded=!0;_state.label=2;case 2:return[2]}})}),function(){return t.apply(this,arguments)})},{key:"validateRequiredComponents",value:function value(){St.lazyValidateProperties(this)}}]),a}(y)).prototype,"container",[TE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),xE=Ye(NE.prototype,"placeholder",[AE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),BE=Ye(NE.prototype,"hasLoaded",[RE],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return!1}}),FE=Ye(NE.prototype,"pagePrefab",[IE],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return null}}),zE=Ye(NE.prototype,"darkenBackground",[PE],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return!1}}),GE=Ye(NE.prototype,"backgroundOpacity",[_E],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return 150}}),UE=Ye(NE.prototype,"useNavbarShadow",[LE],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return!1}}),HE=Ye(NE.prototype,"navbarShadowOpacity",[OE],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return 150}}),DE=NE))||DE)||DE)||DE)||DE);n._RF.pop(),n._RF.push({},"18bbbp5z2VHVKp4jjjmsAhu","ThemeProgressBar",void 0);var uC,cC,hC,dC,pC,yC,fC,vC,mC,gC,bC,SC,wC,kC,EC,CC=i.ccclass,TC=i.property,AC=(jE=CC("ThemeProgressBar"),YE=TC(a),XE=TC(a),JE=TC(a),QE=TC(a),jE((eC=Ye(($E=function(e){Ie(n,e);var t=xe(n);function n(){var _$e;Ce(this,n);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return je(_$e=t.call.apply(t,[this].concat(a)),"progressBar",eC,Ne(_$e)),je(_$e,"progressText",tC,Ne(_$e)),je(_$e,"leftCap",nC,Ne(_$e)),je(_$e,"rightCap",iC,Ne(_$e)),_$e}return Ae(n,[{key:"onLoad",value:function value(){this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function value(){if(!this.progressBar)throw new Error("ThemeProgressBar: progressBar not found");if(!this.progressText)throw new Error("ThemeProgressBar: progressText not found");if(!this.leftCap)throw new Error("ThemeProgressBar: leftCap not found");if(!this.rightCap)throw new Error("ThemeProgressBar: rightCap not found")}},{key:"setProgress",value:function value(e,t){e<=0?(this.leftCap.active=!1,this.rightCap.active=!1):(this.leftCap.active=!0,this.rightCap.active=!0);var _$n=this.progressBar.getComponent(X);if(!_$n)throw new Error("ThemeProgressBar: progressBarComponent not found");_$n.progress=e/t;var i=this.progressText.getComponent(u);if(!i)throw new Error("ThemeProgressBar: progressTextComponent not found");i.string="".concat(e,"/").concat(t)}}]),n}(y)).prototype,"progressBar",[YE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),tC=Ye($E.prototype,"progressText",[XE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),nC=Ye($E.prototype,"leftCap",[JE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),iC=Ye($E.prototype,"rightCap",[QE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ZE=$E))||ZE);n._RF.pop(),n._RF.push({},"e62f9TdkTxOyJy6vcnplnCB","LockAnimator",void 0);var RC,IC,PC,_C,LC,OC,DC,NC,MC,xC,BC,FC,zC,GC,UC,HC,VC,qC,WC,KC,jC,YC,XC=i.ccclass,JC=i.disallowMultiple,QC=i.property,ZC=[50,160],$C=(uC=XC("LockAnimator"),cC=QC(oe),hC=QC(v),dC=QC(L),pC=QC(L),yC=QC(zs),fC=QC({type:g,min:0}),uC(vC=JC((gC=Ye((mC=function(e){Ie(a,e);var t,n,i=xe(a);function a(){var _$e;Ce(this,a);for(var t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];return je(_$e=i.call.apply(i,[this].concat(n)),"floatingParticles",gC,Ne(_$e)),je(_$e,"iconAnimation",bC,Ne(_$e)),je(_$e,"lockClip",SC,Ne(_$e)),je(_$e,"unlockClip",wC,Ne(_$e)),je(_$e,"trailTemplate",kC,Ne(_$e)),je(_$e,"trailCount",EC,Ne(_$e)),_$e.trails=[],_$e}return Ae(a,[{key:"onLoad",value:function value(){this.validateRequiredComponents(),this.prepareTrails(),this.floatingParticles.node.active=!1}},{key:"unlock",value:(n=Ee(function(e){return _ts_generator(this,function(_state){switch(_state.label){case 0:this.floatingParticles.node.active=!0,this.floatingParticles.resetSystem();return[4,this.playAnimation(this.unlockClip.name,e)];case 1:_state.sent(),this.floatingParticles.stopSystem();return[2]}})}),function(e){return n.apply(this,arguments)})},{key:"fireExplosionParticles",value:function value(){this.explodeTrails()}},{key:"lock",value:function value(){this.playAnimation(this.lockClip.name),this.floatingParticles.node.active&&this.floatingParticles.stopSystem()}},{key:"explodeTrails",value:function value(){var _$e=this;return Promise.all(this.trails.map(function(t){return gn.runTweenAsync(_$e.getExplodeTrail(t))}))}},{key:"getExplodeTrail",value:function value(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=ie(0,2*Math.PI),i=ie(ZC[0],ZC[1])*Math.cos(n),_$a=ie(ZC[0],ZC[1])*Math.sin(n),o=new Y(i,_$a,e.node.position.z),r=e.node.scale.clone();return k(e.node).delay(t).call(function(){e.node.setPosition(0,0),e.reset(),e.node.active=!0}).to(.5,{position:o.clone()},{easing:"expoOut"}).to(.5,{scale:new Y(0,0,1)},{easing:"expoIn"}).call(function(){e.node.setPosition(0,0),e.node.scale=r,e.reset(),e.node.active=!1})}},{key:"prepareTrails",value:function value(){this.trailTemplate.node.active=!1;for(var _$e=0;_$e<this.trailCount;_$e++){var t=l(this.trailTemplate.node);t.setParent(this.node),t.active=!1,this.trails.push(t.getComponent(zs))}}},{key:"validateRequiredComponents",value:function value(){St.lazyValidateProperties(this)}},{key:"playAnimation",value:(t=Ee(function(e,t){var n;return _ts_generator(this,function(_state){n=this;return[2,t&&null!=t&&t.aborted?Promise.resolve():new Promise(function(i){n.iconAnimation.once(v.EventType.FINISHED,function(){i()}),null==t||t.addAbortListener(function(){n.iconAnimation.off(v.EventType.FINISHED),n.iconAnimation.stop(),i()}),n.iconAnimation.play(e)})]})}),function(e,n){return t.apply(this,arguments)})}]),a}(y)).prototype,"floatingParticles",[cC],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),bC=Ye(mC.prototype,"iconAnimation",[hC],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),SC=Ye(mC.prototype,"lockClip",[dC],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wC=Ye(mC.prototype,"unlockClip",[pC],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),kC=Ye(mC.prototype,"trailTemplate",[yC],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),EC=Ye(mC.prototype,"trailCount",[fC],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return 0}}),vC=mC))||vC)||vC);n._RF.pop(),n._RF.push({},"aef0d6qo8hNUJ7qNl2wuT29","ThemeBlock",void 0);var eT,tT,nT,iT,aT,oT,rT,sT,lT,uT,cT,hT=i.ccclass,dT=i.property,pT={progress:0,max:10,isLocked:!0,themeId:Gl.SUMMER,skin:zl},yT=(RC=hT("ThemeBlock"),IC=dT(a),PC=dT(x),_C=dT(a),LC=dT(x),OC=dT($C),DC=dT(a),NC=dT(A),MC=dT([A]),xC=dT(u),BC=dT(H),RC((GC=Ye((zC=function(e){Ie(r,e);var t,n,i,a,o=xe(r);function r(){var _$e;Ce(this,r);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return je(_$e=o.call.apply(o,[this].concat(n)),"mask",GC,Ne(_$e)),je(_$e,"nodeUIOpacity",UC,Ne(_$e)),je(_$e,"progressBar",HC,Ne(_$e)),je(_$e,"backgroundUI",VC,Ne(_$e)),je(_$e,"lockAnimator",qC,Ne(_$e)),je(_$e,"themeLoadingRing",WC,Ne(_$e)),je(_$e,"themeSprite",KC,Ne(_$e)),je(_$e,"tileBlockIconSprite",jC,Ne(_$e)),je(_$e,"titleLabel",YC,Ne(_$e)),_$e.visibilityTween=null,_$e.isVisible=!1,_$e.payload=pT,_$e}return Ae(r,[{key:"isLocked",get:function get(){return this.payload.isLocked},set:function set(e){this.payload.isLocked=e,this.updateThemeBlockDisplay()}},{key:"getSkinName",value:function value(){return this.payload.skin}},{key:"__preload",value:function value(){this.uiTransform=this.getComponent(s),this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function value(){St.lazyValidateProperties(this)}},{key:"updateThemeBlockDisplay",value:function value(){var _$e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:pT;this.payload=_$e;var t=_$e.progress,n=_$e.max,i=_$e.isLocked,a=_$e.themeId,o=_$e.skin;this.updateTitle(a),this.updateSkinAsync(o),this.updateThemeAsync(a);var _$r=this.progressBar.getComponent(AC);if(!_$r)throw new Error("ThemeBlock: progressBarComponent not found");this.mask.active=i,this.progressBar.active=!i,this.lockAnimator.node.active=i,i||_$r.setProgress(t,n)}},{key:"playUnlockAnim",value:(a=Ee(function(e){var t,n,i,a;var _arguments=arguments;return _ts_generator(this,function(_state){switch(_state.label){case 0:t=_arguments.length>1&&void 0!==_arguments[1]?_arguments[1]:pT;this.payload=we(we({},t),{},{isLocked:!1});n=t.progress,i=t.max,a=this.progressBar.getComponent(AC);if(!a)throw new Error("ThemeBlock: progressBarComponent not found");this.mask.active=!0,this.progressBar.active=!1,this.lockAnimator.node.active=!0,a.setProgress(n,i);return[4,this.animateUnlockedState(e)];case 1:_state.sent();return[2]}})}),function(e){return a.apply(this,arguments)})},{key:"updateTitle",value:function value(e){switch(e){case Gl.SUMMER:this.titleLabel.string="Summer";break;case Gl.WINTER:this.titleLabel.string="Winter";break;case Gl.AUTUMN:this.titleLabel.string="Autumn"}}},{key:"updateSkinAsync",value:(i=Ee(function(e){var t,n;return _ts_generator(this,function(_state){switch(_state.label){case 0:t=this;return[4,li.loadSkinPreviewAsync(e)];case 1:n=_state.sent();this.tileBlockIconSprite&&n.forEach(function(e,n){e&&(t.tileBlockIconSprite[n].spriteFrame=e)});return[2]}})}),function(e){return i.apply(this,arguments)})},{key:"updateThemeAsync",value:(n=Ee(function(e){var t;return _ts_generator(this,function(_state){switch(_state.label){case 0:return[4,li.loadThemePreviewAsync(e)];case 1:t=_state.sent();this.themeSprite&&t&&(this.themeSprite.spriteFrame=t,this.themeLoadingRing&&(this.themeLoadingRing.active=!1));return[2]}})}),function(e){return n.apply(this,arguments)})},{key:"animateUnlockedState",value:(t=Ee(function(e){var t,n,i;return _ts_generator(this,function(_state){switch(_state.label){case 0:n=this.mask.getComponent(x),i=this.progressBar.getComponent(x);if(!n)throw new Error("ThemeBlock: maskUIOpacity not found");if(!i)throw new Error("ThemeBlock: progressBarUIOpacity not found");this.mask.active=!0,n.opacity=null!==(t=n.opacity)&&void 0!==t?t:255,this.progressBar.active=!0,i.opacity=0;return[4,this.lockAnimator.unlock(e)];case 1:_state.sent(),this.lockAnimator.node.active=!1;return[4,Promise.all([gn.runTweenAsync(k(n).to(.25,{opacity:0}),e),gn.runTweenAsync(k(i).to(.25,{opacity:255}),e)])];case 2:_state.sent(),this.mask.active=!1,n.opacity=0,i.opacity=255;return[2]}})}),function(e){return t.apply(this,arguments)})},{key:"getUITransform",value:function value(){return this.uiTransform}},{key:"setVisible",value:function value(e){var t;this.isVisible!==e&&(this.isVisible=e,null===(t=this.visibilityTween)||void 0===t||t.stop(),this.visibilityTween=k(this.nodeUIOpacity).to(.05,{opacity:e?255:0}).start())}}]),r}(y)).prototype,"mask",[IC],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),UC=Ye(zC.prototype,"nodeUIOpacity",[PC],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),HC=Ye(zC.prototype,"progressBar",[_C],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),VC=Ye(zC.prototype,"backgroundUI",[LC],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),qC=Ye(zC.prototype,"lockAnimator",[OC],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),WC=Ye(zC.prototype,"themeLoadingRing",[DC],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),KC=Ye(zC.prototype,"themeSprite",[NC],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),jC=Ye(zC.prototype,"tileBlockIconSprite",[MC],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return[]}}),YC=Ye(zC.prototype,"titleLabel",[xC],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ye(zC.prototype,"isLocked",[BC],Object.getOwnPropertyDescriptor(zC.prototype,"isLocked"),zC.prototype),FC=zC))||FC);n._RF.pop(),n._RF.push({},"b3a4dy5XgpIT6stybzgYjnu","CollectionsContent",void 0);var fT,vT=i.ccclass,mT=i.property,gT=globalThis.game.storage,bT=GameCore.Utils.Array,ST=(eT=vT("CollectionsContent"),tT=mT(Zo),nT=mT(ue),iT=mT(Ca),aT=mT({type:E,displayName:"Offset from top of scroll view",tooltip:"The offset between the first theme tab and the top of the scroll view"}),eT((sT=Ye((rT=function(e){Ie(o,e);var t,n,i,a=xe(o);function o(){var _$e;Ce(this,o);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return(_$e=a.call.apply(a,[this].concat(n))).animateThemeTabUnlock=null,je(_$e,"panelAnimator",sT,Ne(_$e)),je(_$e,"themeScrollView",lT,Ne(_$e)),je(_$e,"contentOpacity",uT,Ne(_$e)),_$e.themeBlocks=[],_$e.preservedScrollPosition=new Q,je(_$e,"offsetFromTopOfScrollView",cT,Ne(_$e)),_$e.updateBlocksVisibility=function(){var t=_$e.uiTransform.getBoundingBoxToWorld(),n=t.yMax,i=t.yMin;_$e.themeBlocks.forEach(function(e){var t=e.getUITransform().getBoundingBoxToWorld(),a=t.yMax,_$o=t.yMin,r=a<i||_$o>n;e.setVisible(!r)})},_$e.hideContent=function(){_$e.contentOpacity.changeStateFade(!1,.1)},_$e.showContent=function(){_$e.contentOpacity.changeStateFade(!0,.1)},_$e}return Ae(o,[{key:"__preload",value:function value(){var _$e,t;this.uiTransform=this.getComponent(s),this.themeBlocks=null!==(_$e=null===(t=this.themeScrollView.content)||void 0===t?void 0:t.getComponentsInChildren(yT))&&void 0!==_$e?_$e:[],this.validateRequiredComponents()}},{key:"listenEvents",value:function value(){this.themeScrollView.node.on(ue.EventType.SCROLLING,this.updateBlocksVisibility),this.node.scene.on(Co.HIDE_UI,this.hideContent),this.node.scene.on(Co.SHOW_UI,this.showContent)}},{key:"unlistenEvents",value:function value(){this.themeScrollView.node.off(ue.EventType.SCROLLING,this.updateBlocksVisibility),this.unlistenUIEvents()}},{key:"unlistenUIEvents",value:function value(){this.node.scene.off(Co.HIDE_UI,this.hideContent),this.node.scene.off(Co.SHOW_UI,this.showContent)}},{key:"init",value:function value(e){0!==e.length&&this.getThemeTabs().forEach(function(t,n){return t.updateThemeBlockDisplay(e[n])})}},{key:"preserveScrollPosition",value:function value(){this.themeScrollView.stopAutoScroll(),this.preservedScrollPosition.set(this.themeScrollView.getScrollOffset())}},{key:"restoreScrollPosition",value:function value(){this.themeScrollView.scrollToOffset(this.preservedScrollPosition,0)}},{key:"updateUnlockedProgress",value:function value(e){var t=this,n=gT.getStorageData("collection","animateMapPackUnlock"),i=gT.getStorageData("collection","lastMapPack");e.forEach(function(e,a){var _$o=e.skin,r=e.progress,s=e.max,l=e.isLocked;if(r<s&&!l&&n&&i!==a+1)return t.animateThemeTabUnlock=e,gT.setStorageData("collection","animateMapPackUnlock",!1),gT.setStorageData("collection","lastMapPack",a+1),void t.setProgressToThemeTab(_$o,we(we({},e),{},{isLocked:!0}));t.setProgressToThemeTab(_$o,e)})}},{key:"shouldAnimateThemeTabUnlock",value:function value(){return null!==this.animateThemeTabUnlock}},{key:"playThemeTabUnlockAnim",value:(i=Ee(function(e){var t;return _ts_generator(this,function(_state){switch(_state.label){case 0:if(!this.animateThemeTabUnlock)return[3,2];t=this.findThemeTab(this.animateThemeTabUnlock.skin);if(void 0===t)throw new Error("CollectionsContent: ThemeTab not found");return[4,t.playUnlockAnim(e,we(we({},this.animateThemeTabUnlock),{},{isLocked:!0}))];case 1:_state.sent(),this.animateThemeTabUnlock=null;_state.label=2;case 2:return[2]}})}),function(e){return i.apply(this,arguments)})},{key:"scrollToCurrentUnlockingTheme",value:(n=Ee(function(e,t){var n,i;return _ts_generator(this,function(_state){switch(_state.label){case 0:n=this.findThemeTab(e);if(!n)return[3,2];i=-n.node.position.y-this.offsetFromTopOfScrollView;return[4,this.scrollToOffset(new Q(0,i),2,t)];case 1:_state.sent();_state.label=2;case 2:return[2]}})}),function(e,t){return n.apply(this,arguments)})},{key:"scrollToOffset",value:(t=Ee(function(e,t,n){return _ts_generator(this,function(_state){switch(_state.label){case 0:this.themeScrollView.scrollToOffset(e,t);return[4,gn.waitTweenAsync(t,n)];case 1:_state.sent(),n.aborted&&(this.themeScrollView.stopAutoScroll(),this.themeScrollView.scrollToOffset(e,0));return[2]}})}),function(e,n,i){return t.apply(this,arguments)})},{key:"setProgressToThemeTab",value:function value(e,t){var n=this.findThemeTab(e);if(void 0===n)throw new Error("CollectionsContent: ThemeTab not found");n.updateThemeBlockDisplay(t)}},{key:"findThemeTab",value:function value(e){return bT.search(this.getThemeTabs(),function(t){return t.getSkinName()===e})}},{key:"getThemeTabs",value:function value(){return this.themeScrollView.content.getComponentsInChildren(yT)}},{key:"enableUIAnimator",value:function value(){this.panelAnimator.enabled=!0}},{key:"disableUIAnimator",value:function value(){this.panelAnimator.enabled=!1}},{key:"validateRequiredComponents",value:function value(){St.lazyValidateProperties(this)}}]),o}(y)).prototype,"panelAnimator",[tT],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),lT=Ye(rT.prototype,"themeScrollView",[nT],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),uT=Ye(rT.prototype,"contentOpacity",[iT],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),cT=Ye(rT.prototype,"offsetFromTopOfScrollView",[aT],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return 407.5}}),oT=rT))||oT);n._RF.pop(),n._RF.push({},"dab8cbliOBAeZ7iVs959mBm","CollectionsPage",void 0);var wT,kT,ET,CT,TT,AT,RT,IT,PT,_T,LT,OT,DT,NT,MT,xT,BT,FT,zT,GT,UT,HT,VT,qT,WT,KT,jT,YT=(0,i.ccclass)("CollectionsPage")(fT=function(e){Ie(o,e);var t,n,i,a=xe(o);function o(){var _$e;Ce(this,o);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return(_$e=a.call.apply(a,[this].concat(n))).payload=null,_$e}return Ae(o,[{key:"setPayload",value:function value(e){this.payload=e}},{key:"mount",value:(i=Ee(function(){var _$e;return _ts_generator(this,function(_state){switch(_state.label){case 0:if(!!this.pagePrefab)return[3,2];return[4,li.loadPrefabAsync(Fn.COLLECTIONS_PAGE)];case 1:_$e=_state.sent();_$e&&this.node&&(this.pagePrefab=_$e);_state.label=2;case 2:return[4,Fe(Pe(o.prototype),"mount",this).call(this)];case 3:if(_state.sent(),this.containerUIOpacity.opacity=0,!this.themeContent&&(this.themeContent=this.container.getComponentInChildren(ST),!this.themeContent))throw new Error("No theme content found");this.payload&&this.themeContent.init(this.payload);return[2]}})}),function(){return i.apply(this,arguments)})},{key:"transitionIn",value:(n=Ee(function(){var _$e,t,n;return _ts_generator(this,function(_state){switch(_state.label){case 0:_$e=this;return[4,Fe(Pe(o.prototype),"transitionIn",this).call(this)];case 1:_state.sent(),this.themeContent.restoreScrollPosition(),this.themeContent.updateBlocksVisibility(),this.themeContent.enableUIAnimator(),this.themeContent.listenEvents();t=gn.runTweenAsync(k(this.containerUIOpacity).to(.2,{opacity:255})),n=new Promise(function(t){_$e.node.scene.emit(Co.SHOW_UI,{onComplete:function onComplete(){t()}})});return[4,Promise.all([t,n])];case 2:_state.sent();return[2]}})}),function(){return n.apply(this,arguments)})},{key:"transitionOut",value:(t=Ee(function(){var _$e;return _ts_generator(this,function(_state){switch(_state.label){case 0:_$e=this;return[4,Fe(Pe(o.prototype),"transitionOut",this).call(this)];case 1:_state.sent(),this.themeContent.preserveScrollPosition(),this.themeContent.unlistenUIEvents();return[4,new Promise(function(t){_$e.node.scene.emit(Co.HIDE_UI,{onComplete:function onComplete(){t()}})})];case 2:_state.sent(),this.themeContent.disableUIAnimator(),this.themeContent.unlistenEvents();return[2]}})}),function(){return t.apply(this,arguments)})}]),o}(lC))||fT;n._RF.pop(),n._RF.push({},"2381b1mKt1PUq5W+fsaaOYP","PageManager",void 0);var XT,JT,QT,ZT,$T,eA,tA,nA,iA,aA,oA,rA,sA,lA=i.ccclass,uA=i.property,cA=i.disallowMultiple,hA=i.requireComponent,dA=GameCore.Utils.Array,pA=(wT=lA("PageManagerItem"),kT=uA(lC),ET=uA({type:N(Mn)}),wT((AT=Ye((TT=Ae(function e(){Ce(this,e),je(this,"page",AT,this),je(this,"pageType",RT,this)})).prototype,"page",[kT],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),RT=Ye(TT.prototype,"pageType",[ET],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),CT=TT))||CT),yA=(IT=lA("PageManager"),PT=hA(s),_T=uA({type:x,displayName:"Background Mask",group:"Background Mask"}),LT=uA({type:E,displayName:"Transition duration",group:"Background Mask"}),OT=uA({type:E,displayName:"Transition delay",group:"Background Mask"}),DT=uA({type:x,displayName:"Nav Bar Shadow",group:"Nav Bar Shadow"}),NT=uA({type:E,displayName:"Transition duration",group:"Nav Bar Shadow"}),MT=uA({type:E,displayName:"Transition delay",group:"Nav Bar Shadow"}),xT=uA({type:[pA]}),BT=uA({type:N(Mn)}),IT(FT=cA(FT=PT((GT=Ye((zT=function(e){Ie(r,e);var t,n,i,a,o=xe(r);function r(){var _$e;Ce(this,r);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return je(_$e=o.call.apply(o,[this].concat(n)),"backgroundMask",GT,Ne(_$e)),je(_$e,"backgroundMaskTransitionDuration",UT,Ne(_$e)),je(_$e,"backgroundMaskTransitionDelay",HT,Ne(_$e)),je(_$e,"navBarShadow",VT,Ne(_$e)),je(_$e,"navBarShadowTransitionDuration",qT,Ne(_$e)),je(_$e,"navBarShadowTransitionDelay",WT,Ne(_$e)),je(_$e,"pageItems",KT,Ne(_$e)),je(_$e,"currentScreen",jT,Ne(_$e)),_$e}return Ae(r,[{key:"unmountAndHideAll",value:function value(){var _$e=this;this.pageItems.forEach(function(t){var n=t.page;t.pageType!==_$e.currentScreen&&(n.unmount(),n.hide())})}},{key:"onLoad",value:function value(){this.uiTransform=this.getComponent(s),this.validateRequiredComponents()}},{key:"updateCollectionsContentPayload",value:function value(e){var t=this.getPage(Mn.collections);t&&_instanceof(t,YT)&&t.setPayload(e)}},{key:"navigate",value:(a=Ee(function(e,t,n){var i,a,o,_$r,s,l,u,c,h,d,p,y,f,v,_tmp,m;return _ts_generator(this,function(_state){switch(_state.label){case 0:i=e.from,a=e.to;if(!(null===i))return[3,5];o=this.getPage(this.currentScreen);o.show();return[4,o.mount()];case 1:_state.sent();return[4,null==t?void 0:t(o)];case 2:_state.sent(),this.node.scene.emit(Dn,{from:null,to:a});return[4,o.transitionIn()];case 3:_state.sent();return[4,null==n?void 0:n(o)];case 4:return[2,(_state.sent(),void(this.currentScreen=a))];case 5:if(i!==this.currentScreen)throw new Error("PageManager: Cannot navigate from a different screen. Perhaps you forgot to update the currentScreen property.");_$r=this.getPage(this.currentScreen),s=this.getPage(a);if(!s||!_$r)throw new Error("PageManager: Cannot navigate to/from a null page. Perhaps you forgot to add the page to the pageItems array in the editor.");l=this.uiTransform.width,u=this.getPageIndex(i),c=this.getPageIndex(a),h=Math.min(u,c),d=Math.max(u,c),p=(d-h)*l,y=u<c?1:-1,f=this.pageItems.slice(h,d+1);f.forEach(function(e,t){var _$n=e.page;_$n.show(),_$n.getWidget().enabled=!1,_$n.node.position=new Y((t+h-u)*l,_$n.node.position.y,_$n.node.position.z)});v=!1;_tmp=s.hasLoadedPage();if(_tmp)return[3,7];v=!0,Mu.showLoadingScreen();return[4,gn.waitTweenAsync(.5)];case 6:_tmp=_state.sent();_state.label=7;case 7:_tmp;return[4,s.mount()];case 8:_state.sent();return[4,null==t?void 0:t(s)];case 9:_state.sent(),this.node.scene.emit(Dn,{from:i,to:a});return[4,Promise.all([_$r.transitionOut(),this.transition(p,y,f),this.handleBackgroundMask(this.backgroundMaskTransitionDuration,s.getDarkenBackground()),this.handleNavBarShadow(this.navBarShadowTransitionDuration,s.getNavbarShadow())])];case 10:_state.sent();m=s.getWidget();m.enabled=!0,m.left=0,m.right=0,s.updateWidgets(),s.updateLayouts(),f.forEach(function(e){e.pageType!==a&&(e.page.unmount(),e.page.hide())}),this.currentScreen=a;return[4,s.transitionIn()];case 11:_state.sent();return[4,null==n?void 0:n(s)];case 12:_state.sent(),v&&Mu.closeLoadingScreen();return[2]}})}),function(e,t,n){return a.apply(this,arguments)})},{key:"getPage",value:function value(e){var t=this.getPageIndex(e);return-1!==t?this.pageItems[t].page:null}},{key:"handleBackgroundMask",value:(i=Ee(function(e,t){return _ts_generator(this,function(_state){switch(_state.label){case 0:return[4,gn.runTweenAsync(k(this.backgroundMask).delay(this.backgroundMaskTransitionDelay).to(e,{opacity:t}).start())];case 1:_state.sent();return[2]}})}),function(e,t){return i.apply(this,arguments)})},{key:"handleNavBarShadow",value:(n=Ee(function(e,t){return _ts_generator(this,function(_state){switch(_state.label){case 0:return[4,gn.runTweenAsync(k(this.navBarShadow).delay(this.navBarShadowTransitionDelay).to(e,{opacity:t}).start())];case 1:_state.sent();return[2]}})}),function(e,t){return n.apply(this,arguments)})},{key:"getPageIndex",value:function value(e){return dA.searchIndex(this.pageItems,function(t){return t.pageType===e})}},{key:"transition",value:(t=Ee(function(e,t,n){return _ts_generator(this,function(_state){switch(_state.label){case 0:return[4,Promise.all(n.map(function(n){var i=n.page;return gn.runTweenAsync(k(i.node).to(.5,{position:new Y(i.node.position.x-e*t,i.node.position.y,i.node.position.z)},{easing:M.quintInOut}))}))];case 1:_state.sent();return[2]}})}),function(e,n,i){return t.apply(this,arguments)})},{key:"validateRequiredComponents",value:function value(){if(!this.uiTransform)throw new Error("PageManager requires UITransform component");if(!this.backgroundMask)throw new Error("PageManager requires background mask")}}]),r}(y)).prototype,"backgroundMask",[_T],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),UT=Ye(zT.prototype,"backgroundMaskTransitionDuration",[LT],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return .5}}),HT=Ye(zT.prototype,"backgroundMaskTransitionDelay",[OT],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return .3}}),VT=Ye(zT.prototype,"navBarShadow",[DT],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),qT=Ye(zT.prototype,"navBarShadowTransitionDuration",[NT],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return .5}}),WT=Ye(zT.prototype,"navBarShadowTransitionDelay",[MT],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return .3}}),KT=Ye(zT.prototype,"pageItems",[xT],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return[]}}),jT=Ye(zT.prototype,"currentScreen",[BT],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return Mn.home}}),FT=zT))||FT)||FT)||FT);n._RF.pop(),n._RF.push({},"500274Qu9dAjJwYv27wMaMU","StarProgressBar",void 0);var fA,vA,mA,gA,bA,SA,wA=i.ccclass,kA=i.property,EA=(XT=wA("StarProgressBar"),JT=kA(xr),QT=kA(u),ZT=kA(g),$T=kA(g),eA=kA(m),XT((iA=Ye((nA=function(e){Ie(i,e);var t,n=xe(i);function i(){var _$e;Ce(this,i);for(var t=arguments.length,a=new Array(t),o=0;o<t;o++)a[o]=arguments[o];return je(_$e=n.call.apply(n,[this].concat(a)),"progressBar",iA,Ne(_$e)),je(_$e,"progressLabel",aA,Ne(_$e)),je(_$e,"current",oA,Ne(_$e)),je(_$e,"total",rA,Ne(_$e)),je(_$e,"separator",sA,Ne(_$e)),_$e}return Ae(i,[{key:"setRange",value:function value(e,t){this.total=t,this.current=e,this.updateProgress()}},{key:"onLoad",value:function value(){this.validateRequiredComponents()}},{key:"updateProgress",value:function value(){this.progressBar.progress=Math.min(this.current,this.total)/this.total,this.updateProgressLabel()}},{key:"updateProgressLabel",value:function value(){this.progressLabel.string="".concat(this.current).concat(this.separator).concat(this.total)}},{key:"animateTo",value:(t=Ee(function(e,t,n){var _$i,a,o,r,s;return _ts_generator(this,function(_state){switch(_state.label){case 0:_$i=this,a=Math.min(e,this.total)/this.total,o=this.current,r=1,s=k(this.progressBar).to(3,{progress:a},{easing:"quadOut",onUpdate:function onUpdate(t,a){a&&(_$i.current=o+Math.floor((e-o)*a),null==n||n(_$i.current),_$i.current===o-r&&(r++,k(_$i.progressLabel.node).to(.05,{scale:new Y(1.2,1.2,1.2)}).to(.05,{scale:Y.ONE}).start()),_$i.updateProgressLabel())}});null==t||t.addAbortListener(function(){_$i.current=e,_$i.updateProgress()});return[4,gn.runTweenAsync(s,t)];case 1:_state.sent();return[2]}})}),function(e,n,i){return t.apply(this,arguments)})},{key:"validateRequiredComponents",value:function value(){if(!this.progressBar)throw new Error("JourneyProgressBar: Missing required component TapperedProgressBar");if(!this.progressLabel)throw new Error("JourneyProgressBar: Missing required component Label")}}]),i}(y)).prototype,"progressBar",[JT],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),aA=Ye(nA.prototype,"progressLabel",[QT],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),oA=Ye(nA.prototype,"current",[ZT],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),rA=Ye(nA.prototype,"total",[$T],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),sA=Ye(nA.prototype,"separator",[eA],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),tA=nA))||tA);n._RF.pop(),n._RF.push({},"83036ocqiZHXrI3Aq0dBJRD","EventButton",void 0);var CA,TA,AA,RA,IA,PA,_A,LA,OA,DA,NA,MA=i.ccclass,xA=i.property,BA=(fA=MA("EventButton"),vA=xA({type:N(Tb)}),mA=xA(H),fA((SA=Ye((bA=function(e){Ie(n,e);var t=xe(n);function n(){var _$e;Ce(this,n);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return je(_$e=t.call.apply(t,[this].concat(a)),"eventType",SA,Ne(_$e)),_$e._isAvailable=!1,_$e}return Ae(n,[{key:"isAvailable",get:function get(){return this._isAvailable},set:function set(e){this._isAvailable=e,this.fakeClick()}},{key:"handleClick",value:function value(){this.node.scene.emit(Nn,{type:this.eventType})}},{key:"setAnimationState",value:function value(e){this.animationController.setValue("RESET-SPECIAL",this._isAvailable),Fe(Pe(n.prototype),"setAnimationState",this).call(this,e)}}]),n}(Sa)).prototype,"eventType",[vA],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return Tb.STAR_CHEST}}),Ye(bA.prototype,"isAvailable",[mA],Object.getOwnPropertyDescriptor(bA.prototype,"isAvailable"),bA.prototype),gA=bA))||gA);n._RF.pop(),n._RF.push({},"87a11fQFYVFcphsqf5ivVof","DashboardHeader",void 0);var FA,zA,GA,UA,HA,VA,qA,WA,KA,jA,YA,XA,JA,QA,ZA,$A,eR,tR,nR=i.ccclass,iR=i.property,aR=globalThis.game.player,oR=(CA=nR("DashboardHeader"),TA=iR({type:EA,displayName:"Progress bar",group:"Star Chest"}),AA=iR({type:BA,displayName:"Button Component",group:"Star Chest"}),RA=iR({type:L,displayName:"Default Rest animation",group:"Star Chest"}),IA=iR({type:L,displayName:"Special Rest animation",group:"Star Chest"}),CA((LA=Ye((_A=function(e){Ie(n,e);var t=xe(n);function n(){var _$e;Ce(this,n);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return je(_$e=t.call.apply(t,[this].concat(a)),"starProgressBar",LA,Ne(_$e)),je(_$e,"chestButton",OA,Ne(_$e)),je(_$e,"defaultRestAnimation",DA,Ne(_$e)),je(_$e,"specialRestAnimation",NA,Ne(_$e)),_$e.handleStarsUpdateEvent=function(t){var _$n,i;void 0!==(t=null!==(_$n=t)&&void 0!==_$n?_$n:null===(i=aR.getGameData())||void 0===i?void 0:i.stars)&&(_$e.starProgressBar.setRange(t,20),_$e.updateStarChestButtonAnimation(t))},_$e}return Ae(n,[{key:"__preload",value:function value(){this.validateRequiredComponents(),W.on(_n,this.handleStarsUpdateEvent)}},{key:"onDestroy",value:function value(){W.off(_n,this.handleStarsUpdateEvent)}},{key:"updateStarProgress",value:function value(e){this.handleStarsUpdateEvent(e)}},{key:"updateStarChestButtonAnimation",value:function value(e){this.chestButton.isAvailable=e>=20}},{key:"validateRequiredComponents",value:function value(){if(!this.starProgressBar)throw new Error("DashboardHeader: starProgressBar not found");if(!this.chestButton)throw new Error("DashboardHeader: chestButton not found");if(!this.defaultRestAnimation)throw new Error("DashboardHeader: defaultRestAnimation not found");if(!this.specialRestAnimation)throw new Error("DashboardHeader: specialRestAnimation not found")}}]),n}(y)).prototype,"starProgressBar",[TA],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),OA=Ye(_A.prototype,"chestButton",[AA],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),DA=Ye(_A.prototype,"defaultRestAnimation",[RA],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),NA=Ye(_A.prototype,"specialRestAnimation",[IA],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),PA=_A))||PA);n._RF.pop(),n._RF.push({},"3b954Re2cRHvYJeBVAukYp9","JourneyLevelAvatar",void 0);var rR,sR,lR,uR,cR,hR,dR,pR,yR,fR,vR,mR,gR=i.ccclass,bR=i.property,SR=i.executeInEditMode,wR=(FA=gR("JourneyLevelAvatar"),zA=bR({type:A,displayName:"Avatar node"}),GA=bR(a),UA=bR(v),HA=bR(x),VA=bR({type:L,group:"Animation"}),qA=bR({type:L,group:"Animation"}),WA=bR({type:L,group:"Animation"}),KA=bR({type:D,displayName:"Avatar sprite"}),FA(jA=SR((XA=Ye((YA=function(e){Ie(o,e);var t,n,i,a=xe(o);function o(){var _$e;Ce(this,o);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return je(_$e=a.call.apply(a,[this].concat(n)),"sprite",XA,Ne(_$e)),je(_$e,"lockIcon",JA,Ne(_$e)),je(_$e,"animation",QA,Ne(_$e)),je(_$e,"opacity",ZA,Ne(_$e)),je(_$e,"flashAnimation",$A,Ne(_$e)),je(_$e,"unlockAnimation",eR,Ne(_$e)),je(_$e,"spawnAnimation",tR,Ne(_$e)),_$e}return Ae(o,[{key:"avatarSprite",get:function get(){var _$e,t;return null!==(_$e=null===(t=this.sprite)||void 0===t?void 0:t.spriteFrame)&&void 0!==_$e?_$e:null},set:function set(e){this.sprite&&(this.sprite.spriteFrame=e)}},{key:"playUnlockAnimation",value:(i=Ee(function(){var _$e,t,n,i,a,_$o,r,s,l,u,c;return _ts_generator(this,function(_state){switch(_state.label){case 0:_$e=this.playAnimation(this.unlockAnimation),t=this.lockIcon.position.x,n=this.lockIcon.position.y,i=[45,135],a=(Math.random()*(i[1]-i[0])+i[0])*(Math.PI/180),_$o=this.lockIcon.position.x+150*Math.cos(a),r=this.lockIcon.position.y+150*Math.sin(a),s=n-400,l=gn.runTweenAsync(k(this.lockIcon).delay(.3).to(.2,{position:new Y(_$o,r,this.lockIcon.position.z)},{easing:"sineOut"}).to(.4,{position:new Y(_$o,s,this.lockIcon.position.z)},{easing:"cubicIn"})),u=[0,360],c=gn.runTweenAsync(k(this.lockIcon).delay(.3).to(.6,{eulerAngles:new Y(0,0,Math.random()*(u[1]-u[0])*(_$o>t?-1:1))},{easing:"sineOut"}));return[4,Promise.all([_$e,l,c])];case 1:_state.sent(),this.lockIcon.position=new Y(t,n,this.lockIcon.position.z),this.lockIcon.eulerAngles=new Y(0,0,0);return[2]}})}),function(){return i.apply(this,arguments)})},{key:"playFlashAnimation",value:(n=Ee(function(){var _$e,t,n;return _ts_generator(this,function(_state){switch(_state.label){case 0:_$e=this.node.position.y,t=this.playAnimation(this.flashAnimation),n=gn.runTweenAsync(k(this.node).to(.1,{position:new Y(this.node.position.x,this.node.position.y+10,this.node.position.z)},{easing:"sineOut"}).to(.1,{position:new Y(this.node.position.x,_$e,this.node.position.z)},{easing:"sineIn"}));return[4,Promise.all([t,n])];case 1:_state.sent();return[2]}})}),function(){return n.apply(this,arguments)})},{key:"playSpawnAnimation",value:function value(){this.opacity.opacity=255,this.playAnimation(this.spawnAnimation)}},{key:"hideImmediately",value:function value(){this.opacity.opacity=0,this.node.setScale(Y.ZERO)}},{key:"playAnimation",value:(t=Ee(function(e){return _ts_generator(this,function(_state){switch(_state.label){case 0:return[4,gn.runAnimationAsync(this.animation,e.name)];case 1:_state.sent();return[2]}})}),function(e){return t.apply(this,arguments)})},{key:"onLoad",value:function value(){this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function value(){var _$e=this;if(!this.sprite)throw new Error("JourneyLevelAvatar: Avatar node is required");if(!this.lockIcon)throw new Error("JourneyLevelAvatar: Lock icon is required");if(!this.flashAnimation)throw new Error("JourneyLevelAvatar: Flash animation is required");if(!this.unlockAnimation)throw new Error("JourneyLevelAvatar: Unlock animation is required");if(!this.animation)throw new Error("JourneyLevelAvatar: Animation component is required");if(!this.animation.clips.some(function(t){return null!==t&&(t.name===_$e.flashAnimation.name||t.name===_$e.unlockAnimation.name||t.name===_$e.spawnAnimation.name)}))throw new Error("JourneyLevelAvatar: Animation component does not contain required animations")}}]),o}(y)).prototype,"sprite",[zA],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return null}}),JA=Ye(YA.prototype,"lockIcon",[GA],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),QA=Ye(YA.prototype,"animation",[UA],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ZA=Ye(YA.prototype,"opacity",[HA],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),$A=Ye(YA.prototype,"flashAnimation",[VA],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),eR=Ye(YA.prototype,"unlockAnimation",[qA],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),tR=Ye(YA.prototype,"spawnAnimation",[WA],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ye(YA.prototype,"avatarSprite",[KA],Object.getOwnPropertyDescriptor(YA.prototype,"avatarSprite"),YA.prototype),jA=YA))||jA)||jA);n._RF.pop(),n._RF.push({},"a392bibG75JPKzG0y2ZS2YY","JourneyProgressBar",void 0);var kR,ER,CR,TR,AR,RR,IR,PR,_R,LR,OR,DR,NR,MR,xR,BR,FR,zR,GR,UR,HR,VR,qR=i.ccclass,WR=i.property,KR=i.executeInEditMode,jR=(rR=qR("JourneyProgressBar"),sR=WR(xr),lR=WR(u),uR=WR(x),cR=WR(g),hR=WR(g),dR=WR(m),rR(pR=KR((fR=Ye((yR=function(e){Ie(i,e);var t,n=xe(i);function i(){var _$e;Ce(this,i);for(var t=arguments.length,a=new Array(t),o=0;o<t;o++)a[o]=arguments[o];return je(_$e=n.call.apply(n,[this].concat(a)),"progressBar",fR,Ne(_$e)),je(_$e,"progressLabel",vR,Ne(_$e)),je(_$e,"labelUIOpacity",mR,Ne(_$e)),_$e.currentProgress=10,_$e.totalProgress=10,_$e.labelSeparator="/",_$e}return Ae(i,[{key:"total",get:function get(){return this.totalProgress}},{key:"current",get:function get(){return this.currentProgress}},{key:"separator",get:function get(){return this.labelSeparator},set:function set(e){this.labelSeparator=e,this.updateProgress()}},{key:"setRange",value:function value(e,t){this.totalProgress=t,e>t&&(e=t),this.currentProgress=e,this.updateProgress()}},{key:"onLoad",value:function value(){this.validateRequiredComponents()}},{key:"animateTo",value:(t=Ee(function(e){var t,n,_$i,a,o,r,s,l,u,c,h,d,p,y,f,v;return _ts_generator(this,function(_state){switch(_state.label){case 0:t=this,n=e.nextCurr,_$i=e.nextTotal,a=e.numberOfProgressBar,o=void 0===a?0:a,r=e.onProgressBarPassed,s=e.signal,l=n/_$i,u=k(this.labelUIOpacity).to(.2,{opacity:0}),c=k(this.labelUIOpacity).to(.2,{opacity:255}),h=o<1?1:Math.sqrt(o)+1,d=0===o?l:o+l,p=1,y=this.progressBar.progress,f=d,v=gn.runOnUpdateAsync(this.node,h,function(e){var n=M.sineInOut(e),_$i=ce(y,f,n);t.progressBar.progress=_$i%1,_$i>p&&(p=0===_$i?1:Math.ceil(_$i),null==r||r())},s);return[4,Promise.all([gn.runTweenAsync(u,s),v])];case 1:_state.sent(),this.currentProgress=n,this.totalProgress=_$i,this.updateProgress();return[4,gn.runTweenAsync(c,s)];case 2:return[2,(_state.sent(),this.labelUIOpacity.opacity=255,l)]}})}),function(e){return t.apply(this,arguments)})},{key:"updateProgress",value:function value(){this.progressBar.progress=this.currentProgress/this.totalProgress,this.progressLabel.string="".concat(this.currentProgress).concat(this.separator).concat(this.totalProgress)}},{key:"validateRequiredComponents",value:function value(){if(!this.progressBar)throw new Error("JourneyProgressBar: Missing required component TapperedProgressBar");if(!this.progressLabel)throw new Error("JourneyProgressBar: Missing required component Label")}}]),i}(y)).prototype,"progressBar",[sR],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),vR=Ye(yR.prototype,"progressLabel",[lR],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),mR=Ye(yR.prototype,"labelUIOpacity",[uR],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ye(yR.prototype,"total",[cR],Object.getOwnPropertyDescriptor(yR.prototype,"total"),yR.prototype),Ye(yR.prototype,"current",[hR],Object.getOwnPropertyDescriptor(yR.prototype,"current"),yR.prototype),Ye(yR.prototype,"separator",[dR],Object.getOwnPropertyDescriptor(yR.prototype,"separator"),yR.prototype),pR=yR))||pR)||pR);n._RF.pop(),n._RF.push({},"8a41bfxLylDhLk57kewW14A","JourneyProgressAnimator",void 0);var YR,XR,JR,QR,ZR,$R,eI,tI,nI,iI,aI,oI,rI,sI,lI,uI,cI,hI=i.ccclass,dI=i.property,pI=GameCore.Utils.Array,yI=(kR=hI("ProgressConfiguration"),ER=dI(D),CR=dI(m),kR((RR=Ye((AR=Ae(function e(){Ce(this,e),je(this,"avatar",RR,this),je(this,"themeId",IR,this)})).prototype,"avatar",[ER],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),IR=Ye(AR.prototype,"themeId",[CR],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),TR=AR))||TR),fI=(PR=hI("JourneyProgressAnimator"),_R=dI(jR),LR=dI(a),OR=dI(A),DR=dI(wR),NR=dI(yI),MR=dI({type:E,displayName:"Next Level Y Offset on Animation",group:"Unlocked Animation"}),PR((FR=Ye((BR=function(e){Ie(r,e);var t,n,i,a,o=xe(r);function r(){var _$e;Ce(this,r);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return je(_$e=o.call.apply(o,[this].concat(n)),"progressBar",FR,Ne(_$e)),je(_$e,"currentLevelAvatarNode",zR,Ne(_$e)),je(_$e,"currentLevelAvatar",GR,Ne(_$e)),je(_$e,"nextLevelAvatar",UR,Ne(_$e)),je(_$e,"progressConfigs",HR,Ne(_$e)),je(_$e,"nextLevelYOffset",VR,Ne(_$e)),_$e.isAnimating=!1,_$e}return Ae(r,[{key:"setRange",value:function value(e,t){this.progressBar.setRange(e,t)}},{key:"animateTo",value:(a=Ee(function(e,t){var _tmp;return _ts_generator(this,function(_state){switch(_state.label){case 0:if(this.isAnimating)return[2,(console.warn("JourneyProgressAnimator: animation already in progress"),Promise.resolve())];this.isAnimating=!0;_tmp=e!==this.progressBar.current;if(!_tmp)return[3,2];return[4,this.progressBar.animateTo({nextCurr:e,nextTotal:this.progressBar.total,signal:t})];case 1:_tmp=_state.sent();_state.label=2;case 2:_tmp,this.isAnimating=!1;return[2]}})}),function(e,t){return a.apply(this,arguments)})},{key:"animateToNextLevel",value:(i=Ee(function(e){var t,n,i,a,o,_$r,s,l,u;return _ts_generator(this,function(_state){switch(_state.label){case 0:t=this,n=e.nextCurr,i=e.nextTotal,a=e.mapsPassed,o=e.signal;if(!this.isAnimating)return[3,1];console.warn("JourneyProgressAnimator: animation already in progress");return[3,7];case 1:this.isAnimating=!0;_$r=a.length-2;if(!(0===_$r))return[3,3];return[4,this.progressBar.animateTo({nextCurr:n,nextTotal:i,signal:o})];case 2:return[2,(_state.sent(),void(this.isAnimating=!1))];case 3:return[4,this.animateTargetAvaToCenter(o)];case 4:_state.sent();s=1;return[4,this.progressBar.animateTo({signal:o,nextCurr:n,nextTotal:i,numberOfProgressBar:_$r,onProgressBarPassed:function onProgressBarPassed(){if(1===s)return t.nextLevelAvatar.playUnlockAnimation(),void(s+=1);if(s>=a.length)throw new Error("JourneyProgressAnimator: currThemeIndex out of bounds");t.nextLevelAvatar.playFlashAnimation(),t.setNextLevelAvatar(a[s].theme),s+=1}})];case 5:_state.sent();return[4,this.animateTargetAvaToPrev(o)];case 6:_state.sent();l=a[a.length-1].theme,u=a[a.length-2].theme;this.setCurrentLevelAvatar(u),this.nextLevelAvatar.hideImmediately(),this.moveTargetAvaToOriginal(),this.nextLevelAvatar.avatarSprite=this.getSpriteFrameByThemeId(l),this.nextLevelAvatar.playSpawnAnimation(),this.isAnimating=!1;_state.label=7;case 7:return[2]}})}),function(e){return i.apply(this,arguments)})},{key:"animateTargetAvaToCenter",value:(n=Ee(function(e){var t;return _ts_generator(this,function(_state){switch(_state.label){case 0:t=new Y(0,this.nextLevelYOffset+this.nextLevelAvatar.node.position.y,this.nextLevelAvatar.node.position.z);return[4,gn.runTweenAsync(k(this.nextLevelAvatar.node).to(1,{position:t},{easing:"cubicInOut"}),e)];case 1:_state.sent(),this.nextLevelAvatar.node.position=t;return[2]}})}),function(e){return n.apply(this,arguments)})},{key:"moveTargetAvaToOriginal",value:function value(){this.nextLevelAvatar.node.position=this.originalNextLevelAvatarPosition.clone()}},{key:"animateTargetAvaToPrev",value:(t=Ee(function(e){var t;return _ts_generator(this,function(_state){switch(_state.label){case 0:t=this.currentLevelAvatarNode.position.clone();return[4,gn.runTweenAsync(k(this.nextLevelAvatar.node).to(1,{position:t},{easing:"cubicInOut"}),e)];case 1:_state.sent(),this.nextLevelAvatar.node.position=t;return[2]}})}),function(e){return t.apply(this,arguments)})},{key:"getSpriteFrameByThemeId",value:function value(e){var t=pI.search(this.progressConfigs,function(t){return t.themeId===e});if(!t)throw new Error("JourneyProgressController: config not found for themeId ".concat(e));return t.avatar}},{key:"setAvatar",value:function value(e,t){var n=this.getSpriteFrameByThemeId(e);_instanceof(t,wR)?t.avatarSprite=n:t.spriteFrame=n}},{key:"setCurrentLevelAvatar",value:function value(e){this.setAvatar(e,this.currentLevelAvatar)}},{key:"setNextLevelAvatar",value:function value(e){this.setAvatar(e,this.nextLevelAvatar)}},{key:"onLoad",value:function value(){this.validateRequiredComponents(),this.originalNextLevelAvatarPosition=this.nextLevelAvatar.node.position.clone()}},{key:"validateRequiredComponents",value:function value(){St.lazyValidateProperties(this)}}]),r}(y)).prototype,"progressBar",[_R],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),zR=Ye(BR.prototype,"currentLevelAvatarNode",[LR],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),GR=Ye(BR.prototype,"currentLevelAvatar",[OR],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),UR=Ye(BR.prototype,"nextLevelAvatar",[DR],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),HR=Ye(BR.prototype,"progressConfigs",[NR],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return[]}}),VR=Ye(BR.prototype,"nextLevelYOffset",[MR],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return 0}}),xR=BR))||xR);n._RF.pop(),n._RF.push({},"c2ddaEnKBVFvrM5x5nbfT7h","HomeContent",void 0);var vI,mI,gI,bI,SI,wI,kI,EI,CI,TI,AI,RI,II,PI,_I,LI=i.ccclass,OI=i.property,DI=globalThis.game.storage,NI=(YR=LI("HomeContent"),XR=OI(u),JR=OI(d),QR=OI(fI),ZR=OI(Zo),$R=OI(oR),eI=OI(x),tI=OI(wE),YR((aI=Ye((iI=function(e){Ie(a,e);var t,n,i=xe(a);function a(){var _$e;Ce(this,a);for(var t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];return je(_$e=i.call.apply(i,[this].concat(n)),"playButtonLabel",aI,Ne(_$e)),je(_$e,"playButton",oI,Ne(_$e)),je(_$e,"journeyProgressAnimator",rI,Ne(_$e)),je(_$e,"panelAnimator",sI,Ne(_$e)),je(_$e,"dashboardHeader",lI,Ne(_$e)),je(_$e,"overlayDuringAnim",uI,Ne(_$e)),je(_$e,"coinContainer",cI,Ne(_$e)),_$e}return Ae(a,[{key:"__preload",value:function value(){this.validateRequiredComponents()}},{key:"getCoinContainer",value:function value(){return this.coinContainer}},{key:"handlePlayButtonPress",value:function value(){this.playButton.interactable=!1,this.node.scene.emit(Ln)}},{key:"setPlayButtonLabel",value:function value(e){this.playButtonLabel.string=e}},{key:"updateStarProgress",value:function value(e){this.dashboardHeader.updateStarProgress(e)}},{key:"setUnlockProgress",value:function value(e){this.setProgress(e),this.updateCurrentMapInStorage(e)}},{key:"prepareUnlockProgressAnimation",value:function value(e,t,n,i){var _$a=this;if(e.id===t.id){this.setProgress(we(we({},t),{},{progress:e.progress})),this.updateCurrentMapInStorage(t);var o=t.progress;return Ee(function(){return _ts_generator(this,function(_state){switch(_state.label){case 0:_$a.playButton.interactable=!1;return[4,_$a.showOwnOverlay(i)];case 1:_state.sent();return[4,_$a.journeyProgressAnimator.animateTo(o,i)];case 2:_state.sent();return[4,_$a.hideOwnOverlay(i)];case 3:_state.sent(),_$a.playButton.interactable=!0;return[2]}})})}return this.setProgress(e),this.updateCurrentMapInStorage(t),Ee(function(){return _ts_generator(this,function(_state){switch(_state.label){case 0:_$a.playButton.interactable=!1;return[4,_$a.showOwnOverlay(i)];case 1:_state.sent();return[4,_$a.journeyProgressAnimator.animateToNextLevel({nextCurr:t.progress,nextTotal:t.max,mapsPassed:n,signal:i})];case 2:_state.sent();return[4,_$a.hideOwnOverlay(i)];case 3:_state.sent(),_$a.playButton.interactable=!0;return[2]}})})}},{key:"hideOwnOverlay",value:(n=Ee(function(e){return _ts_generator(this,function(_state){switch(_state.label){case 0:return[4,gn.runTweenAsync(k(this.overlayDuringAnim).to(.3,{opacity:0}),e)];case 1:_state.sent(),this.overlayDuringAnim.opacity=0;return[2]}})}),function(e){return n.apply(this,arguments)})},{key:"showOwnOverlay",value:(t=Ee(function(e){return _ts_generator(this,function(_state){switch(_state.label){case 0:return[4,gn.runTweenAsync(k(this.overlayDuringAnim).to(.3,{opacity:150}),e)];case 1:_state.sent();return[2]}})}),function(e){return t.apply(this,arguments)})},{key:"setProgress",value:function value(e){var t=e.currentTheme,n=e.nextTheme,i=e.progress,_$a=e.max;this.journeyProgressAnimator.setCurrentLevelAvatar(t),this.journeyProgressAnimator.setNextLevelAvatar(null!=n?n:t),this.journeyProgressAnimator.setRange(i,_$a)}},{key:"updateCurrentMapInStorage",value:function value(e){DI.setStorageData("dashboard","animateToCurrentLevel",!1),DI.setStorageData("dashboard","lastMapPayload",e)}},{key:"enableUIAnimator",value:function value(){this.panelAnimator.enabled=!0}},{key:"disableUIAnimator",value:function value(){this.panelAnimator.enabled=!1}},{key:"validateRequiredComponents",value:function value(){St.lazyValidateProperties(this)}}]),a}(y)).prototype,"playButtonLabel",[XR],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),oI=Ye(iI.prototype,"playButton",[JR],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),rI=Ye(iI.prototype,"journeyProgressAnimator",[QR],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),sI=Ye(iI.prototype,"panelAnimator",[ZR],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),lI=Ye(iI.prototype,"dashboardHeader",[$R],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),uI=Ye(iI.prototype,"overlayDuringAnim",[eI],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),cI=Ye(iI.prototype,"coinContainer",[tI],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),nI=iI))||nI);n._RF.pop(),n._RF.push({},"f555belwQ1NHJr4np65OtcU","NavManager",void 0);var MI,xI,BI,FI,zI,GI,UI,HI,VI,qI,WI,KI,jI,YI=i.ccclass,XI=i.property,JI=globalThis.game.ads,QI=GameCore.Utils.Array,ZI=(vI=YI("NavManager"),mI=XI(a),gI=XI(a),bI=XI(Rn),SI=XI(H),wI=XI({type:C,visible:function visible(){return this.useOffsetWhenSAB}}),kI=XI({type:E,visible:function visible(){return this.useOffsetWhenSAB}}),vI((TI=Ye((CI=function(e){Ie(s,e);var t,n,i,a,o,r=xe(s);function s(){var _$e;Ce(this,s);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return je(_$e=r.call.apply(r,[this].concat(n)),"selectorNode",TI,Ne(_$e)),je(_$e,"selectedButtonNode",AI,Ne(_$e)),je(_$e,"autoLayout",RI,Ne(_$e)),je(_$e,"useOffsetWhenSAB",II,Ne(_$e)),je(_$e,"offsetWidget",PI,Ne(_$e)),je(_$e,"offsetWhenSAB",_I,Ne(_$e)),_$e.navButtons=[],_$e.isNavigating=!1,_$e}return Ae(s,[{key:"currentButton",get:function get(){return this.selectedButton}},{key:"onLoad",value:function value(){var _$e;this.navButtons=this.node.getComponentsInChildren("NavButton"),this.selectedButton=null===(_$e=this.selectedButtonNode)||void 0===_$e?void 0:_$e.getComponentInChildren("NavButton"),St.lazyValidateProperties(this)}},{key:"start",value:function value(){this.useOffsetWhenSAB&&JI.getSafeAreaBottom(ua.cssSizeToWorldSize(1))>0&&(this.offsetWidget.bottom=this.offsetWhenSAB)}},{key:"select",value:(o=Ee(function(e){var t;return _ts_generator(this,function(_state){t=this;if(!this.isNavigating){if(!QI.has(this.navButtons,e))throw new Error("NavManager: Button not found");if(e!==this.selectedButton){if(!e.isWIP)return[2,(this.isNavigating=!0,this.node.scene.emit(On,{from:this.selectedButton.buttonType,to:e.buttonType}),new Promise(function(n){t.node.scene.once(Dn,function(){var i=t.selectedButton.deselect();t.autoLayout.selectedIndex=t.navButtons.indexOf(e),t.selectedButton=e;var a=t.autoLayout.getSelectedWorldX()-e.getSelectedWorldDistanceX(),o=t.playSelectorAnimation(a),r=e.select();Promise.all([i,r,o]).then(function(){t.isNavigating=!1,n()})})}))];this.handleWIPButton()}}return[2]})}),function(e){return o.apply(this,arguments)})},{key:"selectUsingSceneTransition",value:(a=Ee(function(e){var _tmp,_tmp1;return _ts_generator(this,function(_state){switch(_state.label){case 0:_tmp=this.isNavigating;if(_tmp)return[3,4];if(!QI.has([Mn.store],e.buttonType))return[3,1];_tmp1=this.handleWIPButton();return[3,3];case 1:return[4,this.select(e)];case 2:_tmp1=_state.sent();_state.label=3;case 3:_tmp=_tmp1;_state.label=4;case 4:_tmp;return[2]}})}),function(e){return a.apply(this,arguments)})},{key:"selectByType",value:(i=Ee(function(e){var t;return _ts_generator(this,function(_state){switch(_state.label){case 0:t=QI.search(this.navButtons,function(t){return t.buttonType===e});if(!t)throw new Error("NavManager: Button not found");return[4,this.selectUsingSceneTransition(t)];case 1:_state.sent();return[2]}})}),function(e){return i.apply(this,arguments)})},{key:"handleWIPButton",value:function value(){Mu.openScreen(ki.STAR_CHEST_SCREEN)}},{key:"selectDefaultNavBtn",value:(n=Ee(function(){var _$e,t;return _ts_generator(this,function(_state){_$e=this;if(!this.currentButton||!QI.has(this.navButtons,this.currentButton))throw new Error("NavManager: Button not found");t=this.currentButton.buttonType;return[2,(this.node.scene.emit(On,{from:null,to:t}),new Promise(function(t){_$e.node.scene.once(Dn,function(){_$e.autoLayout.selectedIndex=_$e.navButtons.indexOf(_$e.currentButton);var n=_$e.navButtons.map(function(t){return t===_$e.currentButton?t.select(!1):t.deselect(!1,!0)}),i=_$e.autoLayout.getSelectedWorldX()-_$e.currentButton.getSelectedWorldDistanceX();_$e.selectorNode.worldPosition=new Y(i,_$e.selectorNode.worldPosition.y,0),Promise.all(n).then(function(){t()})})}))]})}),function(){return n.apply(this,arguments)})},{key:"playSelectorAnimation",value:(t=Ee(function(e){var t,n,i,a;return _ts_generator(this,function(_state){switch(_state.label){case 0:t=this,n=new Y(1,1,1),i=this.selectorNode.worldPosition.clone(),a=new Y(1.2*n.x,.8*n.y,1);return[4,gn.runTweenAsync(k(this.selectorNode).to(.3,{worldPosition:new Y(e,i.y,0)},{easing:"quintInOut",onUpdate:function onUpdate(e,i){if(void 0!==i){var o=t.calculateCurrentSquashScale(n,a,i);t.selectorNode.scale=o}}}))];case 1:_state.sent();return[2]}})}),function(e){return t.apply(this,arguments)})},{key:"setIgnoreInput",value:function value(){var _$e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.navButtons.forEach(function(t){var n=t.getComponentInChildren(d);n&&(n.interactable=!_$e)})}},{key:"calculateCurrentSquashScale",value:function value(e,t,n){var i=this.splitIntoSquashRatio(n);return e.clone().lerp(t,i)}},{key:"splitIntoSquashRatio",value:function value(e){return e<.5?2*e:1-2*(e-.5)}}]),s}(y)).prototype,"selectorNode",[mI],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),AI=Ye(CI.prototype,"selectedButtonNode",[gI],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),RI=Ye(CI.prototype,"autoLayout",[bI],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),II=Ye(CI.prototype,"useOffsetWhenSAB",[SI],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return!1}}),PI=Ye(CI.prototype,"offsetWidget",[wI],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_I=Ye(CI.prototype,"offsetWhenSAB",[kI],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return 0}}),EI=CI))||EI);n._RF.pop(),n._RF.push({},"d48a1TnKg1F4YRzzKmQOD5k","DashboardScene",void 0);var $I,eP,tP,nP,iP,aP=i.ccclass,oP=i.disallowMultiple,rP=i.property,sP=globalThis.game,lP=sP.event,uP=sP.storage,cP=sP.player,hP=sP.leaderboard,dP=GameCore,pP=dP.Events,yP=dP.Match.Modes,fP=dP.Configs.DailyRewards,vP=dP.Utils,mP=vP.Time,gP=vP.Json,bP=vP.Array;MI=aP("DashboardScene"),xI=rP(tw),BI=rP(ZI),FI=rP(pi),zI=rP(yA),GI=rP(eE),MI(UI=oP((VI=Ye((HI=function(e){Ie(l,e);var t,n,i,a,o,r,s=xe(l);function l(){var _$e;Ce(this,l);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return je(_$e=s.call.apply(s,[this].concat(n)),"coinManager",VI,Ne(_$e)),je(_$e,"navManager",qI,Ne(_$e)),je(_$e,"bgComp",WI,Ne(_$e)),je(_$e,"pageManager",KI,Ne(_$e)),je(_$e,"pageAnimSkipOverlay",jI,Ne(_$e)),_$e.firstNavigation=!0,_$e.isFirstNavToCollections=!0,_$e.playBgAnim=Ee(function(){var t,n,i,a,o,r,s,e;return _ts_generator(this,function(_state){switch(_state.label){case 0:n=uP.getStorage("dashboard");if(null==n)throw new Error("DashboardScene: dashboardStorage not found");i=null!==(t=n.animateToCurrentLevel)&&void 0!==t&&t,a=we({},n.lastMapPayload),o=Yl.getCurrentMapProgress(),r=a.currentTheme===o.currentTheme&&a.nextTheme===o.nextTheme,s=o.currentTheme;if(!(i&&!r))return[3,5];return[4,gn.waitTweenAsync(2)];case 1:_state.sent();_state.label=2;case 2:_state.trys.push([2,4,,5]);return[4,_$e.bgComp.animateToNextTheme(s)];case 3:_state.sent();return[3,5];case 4:e=_state.sent();return[3,5];case 5:return[2]}})}),_$e.handlePlayButtonPress=Ee(function(){var t,n,i,a,_,_tmp,o,e;return _ts_generator(this,function(_state){switch(_state.label){case 0:_state.trys.push([0,4,,5]);n=Yl.getCurrentMapProgress(),i=(null!==(t=cP.getGameData())&&void 0!==t?t:{}).level,a=void 0===i?1:i;_=Promise.all;return[4,uu.setMatchCustomDataAsync({level:a})];case 1:_tmp=[_state.sent()];return[4,uu.startMatchAsync(yP.SINGLE)];case 2:return[4,_.apply(Promise,[_tmp.concat([_state.sent()])])];case 3:_state.sent(),_$e.updateCurrentMapInStorage(n),uP.setStorageData("collection","lastMapPack",n.id),uP.setStorageData("collection","animateMapPackUnlock",!1);o=uP.getStorage("leaderboard_content").lastTabOpened;_$e.getPlayerLeader(o).then(function(e){if(e){var t=e.score,n=e.rank;uP.setStorageData("leaderboard_content","previousScore",t),uP.setStorageData("leaderboard_content","previousRank",n)}}),bu.switchScene(wl,{level:a});return[3,5];case 4:e=_state.sent();return[2,void console.error(e)];case 5:return[2]}})}),_$e.onNavigate=function(){var t=Ee(function(t){var _;return _ts_generator(this,function(_state){switch(_state.label){case 0:_=(_$e.firstNavigation&&(_$e.firstNavigation=!1,_$e.pageManager.unmountAndHideAll()),t.to);switch(_){case Mn.store:return[3,1];case Mn.collections:return[3,3];case Mn.tournaments:return[3,5];case Mn.leaderboard:return[3,7];case Mn.home:return[3,9]}return[3,11];case 1:_$e.navManager.setIgnoreInput();return[4,_$e.pageManager.navigate(t)];case 2:_state.sent(),_$e.handleNavigateToStore(),_$e.navManager.setIgnoreInput(!1);return[3,12];case 3:return[4,_$e.onNavigateToCollections(we(we({},t),{},{to:Mn.collections}))];case 4:_state.sent();return[3,12];case 5:return[4,_$e.onNavigateToTournaments(t)];case 6:_state.sent();return[3,12];case 7:return[4,_$e.onNavigateToLeaderboard(we(we({},t),{},{to:Mn.leaderboard}))];case 8:_state.sent();return[3,12];case 9:return[4,_$e.handleNavigateToHome(t)];case 10:_state.sent();return[3,12];case 11:throw new Error("DashboardScene: Unhandled page name");case 12:return[2]}})});return function(e){return t.apply(this,arguments)}}(),_$e.handleEventButtonPress=function(e){switch(e.type){case Tb.STAR_CHEST:Mu.openScreen(ki.STAR_CHEST_SCREEN);break;case Tb.BALLOON:Mu.showNotificationScreen("Coming soon!");break;default:throw new Error("DashboardScene: Unhandled event button type")}},_$e}return Ae(l,[{key:"__preload",value:function value(){this.panelAnimationController=this.getComponent(Vo),this.validateRequiredComponents(),this.listenNavigationEvents(),this.listenDashboardEvents(),this.panelAnimationController.init()}},{key:"listenNavigationEvents",value:function value(){this.node.scene.on(On,this.onNavigate)}},{key:"listenDashboardEvents",value:function value(){this.node.scene.on(Ln,this.handlePlayButtonPress),this.node.scene.on(Nn,this.handleEventButtonPress)}},{key:"onLoad",value:function value(){this.coinManager.init(this.pageAnimSkipOverlay),Yl.init(),this.setPlayerLevel(),this.initBgComp(),this.pageManager.updateCollectionsContentPayload(Yl.getCollectionUnlockProgress())}},{key:"setPlayerLevel",value:function value(){var _$e,t=(null!==(_$e=cP.getGameData())&&void 0!==_$e?_$e:{}).level,n=void 0===t?1:t;n=0===n?1:n,cP.setGameData({level:n})}},{key:"start",value:function value(){cP.getPlayerSetting("music")&&Pi.playMusic(),this.playBgAnim(),this.navManager.selectDefaultNavBtn(),this.updateVolumeBackgroundMusic(),this.scheduleOnce(this.preloadScenes,2)}},{key:"preloadScenes",value:function value(){bu.preloadGameScene()}},{key:"initBgComp",value:function value(){var _$e,t=uP.getStorage("dashboard");if(null==t)throw new Error("DashboardScene: dashboardStorage not found");var n=null!==(_$e=t.animateToCurrentLevel)&&void 0!==_$e&&_$e,i=we({},t.lastMapPayload),a=Yl.getCurrentMapProgress(),o=i.currentTheme===a.currentTheme&&i.nextTheme===a.nextTheme,r=a.currentTheme;n&&!o?this.bgComp.setCurrentTheme(i.currentTheme):this.bgComp.setCurrentTheme(r)}},{key:"getPlayerLeader",value:(r=Ee(function(e){var t,n,i;return _ts_generator(this,function(_state){switch(_state.label){case 0:t="global"==e?yl:fl;if(!t)return[2,null];n=cP.getPlayerId();return[4,hP.getLeadersByPlayerIdsAsync(t,[n])];case 1:i=_state.sent();return[2,0===i.length?null:i[0]]}})}),function(e){return r.apply(this,arguments)})},{key:"updateCurrentMapInStorage",value:function value(e){uP.setStorageData("dashboard","animateToCurrentLevel",!1),uP.setStorageData("dashboard","lastMapPayload",e)}},{key:"updateVolumeBackgroundMusic",value:function value(){Pi.turnUpMusic()}},{key:"checkDailyRewardsOpenable",value:function value(){var _$e=cP.getPlayerData().dailyRewarded,t=_$e.logDays,n=void 0===t?[]:t,i=_$e.lastRewarded,a=void 0===i?0:i;if(n.length>fP.MaxDays)return!0;if(fP.MockTime>0&&Date.now()-a>=1e3*fP.MockTime)return!0;return!mP.isToday(a)}},{key:"validateRequiredComponents",value:function value(){St.lazyValidateProperties(this)}},{key:"handleNavigateToStore",value:function value(){}},{key:"onNavigateToCollections",value:(o=Ee(function(e){var t,n,i,a,o,_tmp,_tmp1,_tmp2;return _ts_generator(this,function(_state){switch(_state.label){case 0:this.navManager.setIgnoreInput();n=Yl.getCollectionUnlockProgress(),i=this.getCurrentUnlockingTheme();return[4,this.pageManager.navigate(e,function(e){return(t=e.getContainer().getComponentInChildren(ST)).updateUnlockedProgress(n),Promise.resolve()})];case 1:if(_state.sent(),void 0===t)throw new Error("CollectionsContent not found");a=new Bn,o=t.shouldAnimateThemeTabUnlock();_tmp=o;if(!_tmp)return[3,3];return[4,this.pageAnimSkipOverlay.open({onSkip:function onSkip(){return a.abort()},opacity:200})];case 2:_tmp=_state.sent();_state.label=3;case 3:_tmp;_tmp1=this.isFirstNavToCollections&&null!==i;if(!_tmp1)return[3,5];return[4,t.scrollToCurrentUnlockingTheme(i.skin,a)];case 4:_tmp1=(_state.sent(),this.isFirstNavToCollections=!1);_state.label=5;case 5:_tmp1;return[4,t.playThemeTabUnlockAnim(a)];case 6:_state.sent();_tmp2=o;if(!_tmp2)return[3,8];return[4,this.pageAnimSkipOverlay.close()];case 7:_tmp2=_state.sent();_state.label=8;case 8:_tmp2,a.abort(),this.navManager.setIgnoreInput(!1);return[2]}})}),function(e){return o.apply(this,arguments)})},{key:"onNavigateToTournaments",value:(a=Ee(function(e){return _ts_generator(this,function(_state){switch(_state.label){case 0:this.navManager.setIgnoreInput();return[4,this.pageManager.navigate(e)];case 1:_state.sent(),this.navManager.setIgnoreInput(!1);return[2]}})}),function(e){return a.apply(this,arguments)})},{key:"onNavigateToLeaderboard",value:(i=Ee(function(e){return _ts_generator(this,function(_state){switch(_state.label){case 0:this.navManager.setIgnoreInput();return[4,this.pageManager.navigate(e)];case 1:_state.sent(),this.navManager.setIgnoreInput(!1);return[2]}})}),function(e){return i.apply(this,arguments)})},{key:"setHomeDataAndGetNavAnim",value:function value(){var _$e,t,n,i,a,o=this,r=this.pageManager.getPage(Mn.home).getContainer().getComponentInChildren(NI);this.coinManager.setTargetContainer(r.getCoinContainer());var s=null!==(_$e=null===(t=cP.getGameData())||void 0===t?void 0:t.level)&&void 0!==_$e?_$e:1,_$l="Level ".concat(s);r.setPlayButtonLabel(_$l),this.coinManager.emitCoinAmount();var u=null!==(n=null===(i=cP.getGameData())||void 0===i?void 0:i.stars)&&void 0!==n?n:0;r.updateStarProgress(u);var c=uP.getStorage("dashboard");if(null==c)throw new Error("DashboardScene: dashboardStorage not found");var h=null!==(a=c.animateToCurrentLevel)&&void 0!==a&&a,d=we({},c.lastMapPayload),p=we({},Yl.getCurrentMapProgress());if(uP.getStorage("tournament").animateTournamentLeader)return r.setUnlockProgress(p),Ee(function(){return _ts_generator(this,function(_state){switch(_state.label){case 0:return[4,o.navManager.selectByType(Mn.tournaments)];case 1:_state.sent();return[2]}})});if(gP.encode(d)===gP.encode(p))r.setUnlockProgress(p);else if(h){var y=bP.searchIndex(xl.mapOrder,function(e){return e.id===d.id}),f=bP.searchIndex(xl.mapOrder,function(e){return e.id===p.id}),v=y===f;if(-1===y||-1===f)throw new Error("DashboardScene: map not found");if(!(y>f)){var m=xl.mapOrder.slice(y,f+2),g=new Bn,b=r.prepareUnlockProgressAnimation(d,p,m,g);return Ee(function(){var _tmp;return _ts_generator(this,function(_state){switch(_state.label){case 0:return[4,o.pageAnimSkipOverlay.open({onSkip:function onSkip(){return g.abort()},opacity:150})];case 1:_state.sent();return[4,b()];case 2:_state.sent();_tmp=g.aborted||v;if(_tmp)return[3,4];return[4,o.navManager.selectByType(Mn.collections)];case 3:_tmp=_state.sent();_state.label=4;case 4:_tmp;return[4,o.pageAnimSkipOverlay.close()];case 5:_state.sent();return[2]}})})}r.setUnlockProgress(p)}else r.setUnlockProgress(p)}},{key:"handleNavigateToHome",value:(n=Ee(function(e){var t,n,i;return _ts_generator(this,function(_state){switch(_state.label){case 0:i=this;this.navManager.setIgnoreInput();return[4,this.pageManager.navigate(e,Ee(function(){return _ts_generator(this,function(_state){n=i.setHomeDataAndGetNavAnim();return[2]})}))];case 1:_state.sent(),this.navManager.setIgnoreInput(!1);return[4,this.tryOpenDailyRewardsScreen()];case 2:_state.sent();return[4,this.coinManager.untilFinishesCollectAnim()];case 3:_state.sent();return[4,this.pageAnimSkipOverlay.untilClosed()];case 4:_state.sent();return[4,null===(t=n)||void 0===t?void 0:t()];case 5:_state.sent();return[2]}})}),function(e){return n.apply(this,arguments)})},{key:"tryOpenDailyRewardsScreen",value:(t=Ee(function(){return _ts_generator(this,function(_state){if(this.checkDailyRewardsOpenable())return[2,(Mu.openScreen(ki.DAILY_REWARDS_SCREEN),new Promise(function(e){lP.on(pP.CLOSED_SCREEN,function t(n){n.screenName===Ei[ki.DAILY_REWARDS_SCREEN]&&(e(),lP.off(pP.CLOSED_SCREEN,t))})}))];return[2]})}),function(){return t.apply(this,arguments)})},{key:"getCurrentUnlockingTheme",value:function value(){var _$e=Yl.getCollectionUnlockProgress();if(0===_$e.length)return null;var t,n=_$e[0],i=We(_$e);try{for(i.s();!(t=i.n()).done;){var a=t.value;a.isLocked||(n=a)}}catch(e){i.e(e)}finally{i.f()}return n}}]),l}(y)).prototype,"coinManager",[xI],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),qI=Ye(HI.prototype,"navManager",[BI],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),WI=Ye(HI.prototype,"bgComp",[FI],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),KI=Ye(HI.prototype,"pageManager",[zI],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),jI=Ye(HI.prototype,"pageAnimSkipOverlay",[GI],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),UI=HI))||UI);n._RF.pop(),n._RF.push({},"53f87ljsxFJUKsBbXk8WVkJ","HomePage",void 0);var SP,wP=i.ccclass,kP=i.property,EP=globalThis.game.player,CP=GameCore.Utils.Number;$I=wP("HomePage"),eP=kP({type:u,group:"Placeholders"}),$I((iP=Ye((nP=function(e){Ie(r,e);var t,n,i,a,o=xe(r);function r(){var _$e;Ce(this,r);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return je(_$e=o.call.apply(o,[this].concat(n)),"coinLabel",iP,Ne(_$e)),_$e}return Ae(r,[{key:"__preload",value:function value(){var _$e;null===(_$e=Fe(Pe(r.prototype),"__preload",this))||void 0===_$e||_$e.call(this),this.validateOwnRequiredComponents(),this.listenToCoinUpdateEvent()}},{key:"listenToCoinUpdateEvent",value:function value(){this.node.scene.on(Co.COIN_CHANGED,this.updateplaceholderCoins,this)}},{key:"updateplaceholderCoins",value:(a=Ee(function(e){return _ts_generator(this,function(_state){this.coinLabel.string=CP.getShortNumber(e.coins,3);return[2]})}),function(e){return a.apply(this,arguments)})},{key:"mount",value:(i=Ee(function(){var _$e,t,n;return _ts_generator(this,function(_state){switch(_state.label){case 0:return[4,Fe(Pe(r.prototype),"mount",this).call(this)];case 1:if(_state.sent(),!this.homeContent&&(this.homeContent=this.container.getComponentInChildren(NI),!this.homeContent))throw new Error("HomePage: homeContent not found");n=null!==(_$e=null===(t=EP.getGameData())||void 0===t?void 0:t.coins)&&void 0!==_$e?_$e:0;this.updateplaceholderCoins({coins:n});return[2]}})}),function(){return i.apply(this,arguments)})},{key:"transitionIn",value:(n=Ee(function(){return _ts_generator(this,function(_state){switch(_state.label){case 0:return[4,Fe(Pe(r.prototype),"transitionIn",this).call(this)];case 1:_state.sent(),this.homeContent.enableUIAnimator();return[2]}})}),function(){return n.apply(this,arguments)})},{key:"transitionOut",value:(t=Ee(function(){return _ts_generator(this,function(_state){switch(_state.label){case 0:this.homeContent.disableUIAnimator();return[4,Fe(Pe(r.prototype),"transitionOut",this).call(this)];case 1:_state.sent();return[2]}})}),function(){return t.apply(this,arguments)})},{key:"validateOwnRequiredComponents",value:function value(){if(!this.coinLabel)throw new Error("HomePage: coinLabel not found")}}]),r}(lC)).prototype,"coinLabel",[eP],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),tP=nP));n._RF.pop(),n._RF.push({},"332aaP3dkhKxZNHiMFB1bKn","LeaderboardIsEmpty",void 0);var TP,AP,RP,IP,PP,_P,LP,OP,DP,NP,MP,xP,BP,FP,zP,GP,UP,HP,VP,qP,WP=(0,i.ccclass)("LeaderboardIsEmpty")(SP=function(e){Ie(i,e);var t,n=xe(i);function i(){return Ce(this,i),n.apply(this,arguments)}return Ae(i,[{key:"onLoad",value:function value(){this.uiOpacity=this.getComponent(x),this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function value(){St.lazyValidateProperties(this)}},{key:"show",value:(t=Ee(function(){var _$e,t,n;return _ts_generator(this,function(_state){switch(_state.label){case 0:this.uiOpacity.opacity=255;_$e=this.node.position.clone(),t=k(this.node);t.to(.05,{position:_$e.clone().add3f(5,0,0)}),t.to(.05,{position:_$e.clone().add3f(-5,0,0)});n=k(this.node).repeat(2,t);n.to(.05,{position:_$e});return[4,gn.runTweenAsync(n)];case 1:_state.sent();return[2]}})}),function(){return t.apply(this,arguments)})},{key:"hide",value:function value(){this.uiOpacity.opacity=0}}]),i}(y))||SP;n._RF.pop(),n._RF.push({},"aa4b0d0u0hLeqd3+/PQZ/QD","SwitchButton",void 0);var KP,jP,YP,XP,JP,QP,ZP,$P=i.ccclass,e_=i.property,t_=i.requireComponent,n_=globalThis.game.analytics,i_=GameCore,a_=i_.Utils.Array,o_=i_.Plugins.Analytics.Events,r_=(TP=$P("SwitchButton"),AP=t_([d,v]),RP=e_(H),IP=e_(a),PP=e_(a),_P=e_(H),LP=e_({visible:function visible(){return this.useSound},type:gi}),OP=e_(H),DP=e_({visible:function visible(){return this.useDesktopHover},type:L}),NP=e_({visible:function visible(){return this.useDesktopHover},type:L}),TP(MP=AP((BP=Ye((xP=function(e){Ie(n,e);var t=xe(n);function n(){var _$e;Ce(this,n);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return je(_$e=t.call.apply(t,[this].concat(a)),"enable",BP,Ne(_$e)),je(_$e,"nodeOn",FP,Ne(_$e)),je(_$e,"nodeOff",zP,Ne(_$e)),je(_$e,"useSound",GP,Ne(_$e)),je(_$e,"soundKey",UP,Ne(_$e)),je(_$e,"useDesktopHover",HP,Ne(_$e)),je(_$e,"mouseEnterClip",VP,Ne(_$e)),je(_$e,"mouseLeaveClip",qP,Ne(_$e)),_$e.isMouseLeaved=!1,_$e.onMouseEnter=function(t){_$e.useDesktopHover&&_$e.buttonComponent.interactable&&(_$e.isMouseLeaved=!1,_$e.animationComponent.play(_$e.mouseEnterClip.name))},_$e.onMouseLeave=function(t){_$e.useDesktopHover&&_$e.buttonComponent.interactable&&(_$e.isMouseLeaved||(_$e.isMouseLeaved=!0,_$e.animationComponent.play(_$e.mouseLeaveClip.name)))},_$e}return Ae(n,[{key:"__preload",value:function value(){this.buttonComponent=this.getComponent(d),this.animationComponent=this.getComponent(v),this.validateRequiredComponents()}},{key:"onLoad",value:function value(){var _$e=this.animationComponent.clips.map(function(e){return null==e?void 0:e.name}).filter(function(e){return null!=e&&"string"==typeof e});this.useDesktopHover&&(a_.has(_$e,this.mouseEnterClip.name)||this.animationComponent.addClip(this.mouseEnterClip),a_.has(_$e,this.mouseLeaveClip.name)||this.animationComponent.addClip(this.mouseLeaveClip))}},{key:"validateRequiredComponents",value:function value(){St.lazyValidateProperties(this)}},{key:"onEnable",value:function value(){this.node.on(a.EventType.MOUSE_ENTER,this.onMouseEnter),this.node.on(a.EventType.MOUSE_LEAVE,this.onMouseLeave)}},{key:"onDisable",value:function value(){this.node.off(a.EventType.MOUSE_ENTER,this.onMouseEnter),this.node.off(a.EventType.MOUSE_LEAVE,this.onMouseLeave)}},{key:"switch",value:function value(){return!!this.node.active&&(n_.event(o_.BUTTON_CLICK,{button_name:this.node.name,enable:!this.enable}),this.useSound&&Pi.playSound(wi[this.soundKey]),this.updateStatus(!this.enable))}},{key:"setEnabled",value:function value(e){this.node.active&&this.updateStatus(e)}},{key:"updateStatus",value:function value(e){return this.enable===e||(this.onMouseLeave(null),this.enable=e,this.nodeOn.active=e,this.nodeOff.active=!e),this.enable}}]),n}(y)).prototype,"enable",[RP],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return!0}}),FP=Ye(xP.prototype,"nodeOn",[IP],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),zP=Ye(xP.prototype,"nodeOff",[PP],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),GP=Ye(xP.prototype,"useSound",[_P],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return!0}}),UP=Ye(xP.prototype,"soundKey",[LP],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return gi[vi.BUTTON_CLICK]}}),HP=Ye(xP.prototype,"useDesktopHover",[OP],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return!0}}),VP=Ye(xP.prototype,"mouseEnterClip",[DP],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),qP=Ye(xP.prototype,"mouseLeaveClip",[NP],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),MP=xP))||MP)||MP);n._RF.pop(),n._RF.push({},"2871awUXL9J0I+rBEFNHN7o","Tabs",void 0);var s_,l_,u_,c_,h_,d_=i.ccclass,p_=i.property,y_=globalThis.game.analytics,f_=GameCore.Plugins.Analytics.Events,v_=(KP=d_("Tabs"),jP=p_(r_),YP=p_(r_),KP((QP=Ye((JP=function(e){Ie(n,e);var t=xe(n);function n(){var _$e;Ce(this,n);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return je(_$e=t.call.apply(t,[this].concat(a)),"tabWorld",QP,Ne(_$e)),je(_$e,"tabFriends",ZP,Ne(_$e)),_$e}return Ae(n,[{key:"onLoad",value:function value(){this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function value(){if(!this.tabWorld)throw new Error("Tabs: tabWorld not found");if(!this.tabFriends)throw new Error("Tabs: tabFriends not found")}},{key:"setInteractableButtons",value:function value(e){this.tabWorld.getComponent(d).interactable=e,this.tabFriends.getComponent(d).interactable=e}},{key:"updateStatus",value:function value(e){this.tabWorld.setEnabled("global"===e),this.tabFriends.setEnabled("friends"===e)}},{key:"handleTabWorldSelect",value:function value(){this.tabWorld.setEnabled(!0),this.tabFriends.setEnabled(!1),y_.event(f_.BUTTON_CLICK,{button_name:this.node.name,screen_name:Ii.getCurrentPage()}),this.node.scene.emit(Rb.WORLD_TAB_SELECTED)}},{key:"handleTabFriendsSelect",value:function value(){this.tabWorld.setEnabled(!1),this.tabFriends.setEnabled(!0),y_.event(f_.BUTTON_CLICK,{button_name:this.node.name,screen_name:Ii.getCurrentPage()}),this.node.scene.emit(Rb.FRIENDS_TAB_SELECTED)}}]),n}(y)).prototype,"tabWorld",[jP],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ZP=Ye(JP.prototype,"tabFriends",[YP],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),XP=JP))||XP);n._RF.pop(),n._RF.push({},"69c90PvoTtGfZyDw8FbbOvV","LeaderSkeleton",void 0);var m_,g_,b_,S_,w_,k_,E_,C_,T_,A_,R_,I_,P_,__,L_,O_,D_,N_,M_,x_,B_,F_,z_,G_,U_,H_,V_,q_,W_,K_,j_,Y_,X_,J_,Q_,Z_,$_,eL,tL,nL,iL,aL=i.ccclass,oL=i.disallowMultiple,rL=i.property,sL=(s_=aL("LeaderSkeleton"),l_=rL(a),s_(u_=oL((h_=Ye((c_=function(e){Ie(a,e);var t,n,i=xe(a);function a(){var _$e;Ce(this,a);for(var t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];return je(_$e=i.call.apply(i,[this].concat(n)),"container",h_,Ne(_$e)),_$e}return Ae(a,[{key:"__preload",value:function value(){this.uiOpacity=this.getComponent(x),this.validateRequiredComponents()}},{key:"hide",value:(n=Ee(function(e){var t;return _ts_generator(this,function(_state){switch(_state.label){case 0:t=this;return[4,gn.runTweenAsync(k(this.uiOpacity).to(.2,{opacity:0}).call(function(){t.node.active=!1}),e)];case 1:_state.sent();return[2]}})}),function(e){return n.apply(this,arguments)})},{key:"show",value:(t=Ee(function(e,t){var n,i,_$a,o;return _ts_generator(this,function(_state){switch(_state.label){case 0:this.node.active=!0,this.node.scale=new Y(.8,.8,.8),this.uiOpacity.opacity=0;n=this.container.position.clone();this.container.position=new Y(n.x,n.y-100,n.z);i=k(this.node).delay(e);i.to(.2,{scale:Y.ONE},{easing:"cubicOut"});_$a=k(this.container).delay(e);_$a.to(.2,{position:n},{easing:"cubicOut"});o=k(this.uiOpacity).delay(e);o.to(.2,{opacity:255},{easing:"cubicOut"});return[4,Promise.all([gn.runTweenAsync(i,t),gn.runTweenAsync(_$a,t),gn.runTweenAsync(o,t)])];case 1:_state.sent();return[2]}})}),function(e,n){return t.apply(this,arguments)})},{key:"validateRequiredComponents",value:function value(){if(!this.uiOpacity)throw new Error("UIOpacity component is not attached to the same node");if(!this.container)throw new Error("Container is not attached to the same node")}}]),a}(y)).prototype,"container",[l_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),u_=c_))||u_)||u_);n._RF.pop(),n._RF.push({},"53da1+ne4RJ4p0kTjp52K/1","Leader",void 0);var lL,uL,cL,hL,dL,pL,yL,fL,vL,mL,gL,bL,SL,wL=i.ccclass,kL=i.property,EL=GameCore.Utils.Number,CL=(m_=wL("Leader"),g_=kL(u),b_=kL(x),S_=kL({type:a,group:"Container"}),w_=kL({type:A,group:"Background"}),k_=kL({type:D,group:"Background"}),E_=kL({type:A,group:"Rank"}),C_=kL({type:u,group:"Rank"}),T_=kL({type:D,group:"Rank"}),A_=kL({type:D,group:"Rank"}),R_=kL({type:D,group:"Rank"}),I_=kL({type:D,group:"Rank"}),P_=kL({type:A,group:"Avatar"}),__=kL({type:x,group:"Avatar"}),L_=kL({type:A,group:"Score"}),O_=kL({type:u,group:"Score"}),D_=kL({type:D,group:"Score"}),N_=kL({type:x,group:"Score"}),M_=kL({type:x}),x_=kL({type:s}),m_((z_=Ye((F_=function(e){Ie(l,e);var t,n,i,a,r,s=xe(l);function l(){var _$e;Ce(this,l);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return je(_$e=s.call.apply(s,[this].concat(n)),"nameLabel",z_,Ne(_$e)),je(_$e,"nameOpacity",G_,Ne(_$e)),je(_$e,"container",U_,Ne(_$e)),je(_$e,"background",H_,Ne(_$e)),je(_$e,"highlightBackground",V_,Ne(_$e)),je(_$e,"rankSprite",q_,Ne(_$e)),je(_$e,"rankLabel",W_,Ne(_$e)),je(_$e,"goldRank",K_,Ne(_$e)),je(_$e,"silverRank",j_,Ne(_$e)),je(_$e,"bronzeRank",Y_,Ne(_$e)),je(_$e,"highlightRank",X_,Ne(_$e)),je(_$e,"avatar",J_,Ne(_$e)),je(_$e,"avatarOpacity",Q_,Ne(_$e)),je(_$e,"scoreBackground",Z_,Ne(_$e)),je(_$e,"scoreLabel",$_,Ne(_$e)),je(_$e,"highlightScoreBackground",eL,Ne(_$e)),je(_$e,"scoreOpacity",tL,Ne(_$e)),je(_$e,"uiOpacity",nL,Ne(_$e)),je(_$e,"uiTransform",iL,Ne(_$e)),_$e}return Ae(l,[{key:"onLoad",value:function value(){this.defaultBackground=this.background.spriteFrame,this.defaultRank=this.rankSprite.spriteFrame,this.defaultScoreBackground=this.scoreBackground.spriteFrame,this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function value(){St.lazyValidateProperties(this)}},{key:"updateInfo",value:function value(e,t){this.updateBackground(e),this.updateRank(e,t),this.resetPhoto(),this.updateUsername(e),this.updateScore(e)}},{key:"updateBackground",value:function value(e){this.background.spriteFrame=e.isHighlight?this.highlightBackground:this.defaultBackground}},{key:"updateRank",value:function value(e,t){var n=e.rank;if(this.rankLabel.string!==n.toString()){this.rankLabel.string=t&&n>t?"".concat(t,"+"):n.toString(),this.rankSprite.spriteFrame=this.defaultRank;var i=new o(Ob);switch(e.isHighlight&&(this.rankSprite.spriteFrame=this.highlightRank,i=new o(Nb)),n){case 1:this.rankSprite.spriteFrame=this.goldRank,i=new o(Ib);break;case 2:this.rankSprite.spriteFrame=this.silverRank,i=new o(Pb);break;case 3:this.rankSprite.spriteFrame=this.bronzeRank,i=new o(_b)}this.rankLabel.shadowColor=i,this.rankLabel.outlineColor=i}}},{key:"setPhoto",value:function value(e){e&&this.node.active&&(e.packable=!0,this.avatar.spriteFrame=e)}},{key:"resetPhoto",value:(r=Ee(function(){var _$e;return _ts_generator(this,function(_state){switch(_state.label){case 0:if(!!this.defaultAvatar)return[3,2];return[4,li.loadSpriteFrameAsync("images/avatar-bg/spriteFrame")];case 1:_$e=_state.sent();if(!_$e)return[2];this.defaultAvatar=_$e;_state.label=2;case 2:this.avatar.spriteFrame=this.defaultAvatar;return[2]}})}),function(){return r.apply(this,arguments)})},{key:"updateUsername",value:function value(e){this.nameLabel.string=e.name,this.nameLabel.color=new o(e.isHighlight?Db:Lb)}},{key:"updateScore",value:function value(e){var t=Math.floor(e.score);this.scoreLabel.string=EL.getShortNumber(t,7);var n=this.scoreLabel.getComponent(u);n.outlineColor=new o(e.isHighlight?Nb:Ob),n.shadowColor=new o(e.isHighlight?Nb:Ob),this.scoreBackground.spriteFrame=e.isHighlight?this.highlightScoreBackground:this.defaultScoreBackground}},{key:"runShowUpAnimation",value:(a=Ee(function(e,t){var n,i,a,o,r,s;var _arguments=arguments;return _ts_generator(this,function(_state){switch(_state.label){case 0:n=this,i=_arguments.length>2&&void 0!==_arguments[2]?_arguments[2]:.3;this.node.scale=new Y(.8,.8,.8),this.setOpacity(0);a=this.container.position.clone();this.container.position=new Y(a.x,a.y-100,a.z);o=k(this.node).delay(t);o.to(i,{scale:Y.ONE},{easing:"elasticOut"});r=k(this.container).delay(t);r.to(i,{position:a},{easing:"backOut"});s=k(this.uiOpacity).delay(t);s.to(i,{opacity:255},{easing:"cubicOut",onUpdate:function onUpdate(){n.nameOpacity.opacity=n.uiOpacity.opacity,n.scoreOpacity.opacity=n.uiOpacity.opacity,n.avatarOpacity.opacity=n.uiOpacity.opacity}}),e.addAbortListener(function(){n.node.scale=Y.ONE,n.container.position=a,n.uiOpacity.opacity=255,n.avatar.node.active=!0});return[4,Promise.all([gn.runTweenAsync(o,e),gn.runTweenAsync(r,e),gn.runTweenAsync(s,e)])];case 1:_state.sent();return[2]}})}),function(e,t){return a.apply(this,arguments)})},{key:"runWorldPositionAnimation",value:(i=Ee(function(e,t){var n;return _ts_generator(this,function(_state){switch(_state.label){case 0:n=k(this.node).to(t,{worldPosition:e},{easing:"quadOut"});return[4,gn.runTweenAsync(n)];case 1:_state.sent();return[2]}})}),function(e,t){return i.apply(this,arguments)})},{key:"runScaleAnimation",value:(n=Ee(function(e,t,n){var i;return _ts_generator(this,function(_state){switch(_state.label){case 0:i=k(this.node).to(n,{scale:new Y(t,t,t)},{easing:"backOut"});return[4,gn.runTweenAsync(i,e)];case 1:_state.sent();return[2]}})}),function(e,t,i){return n.apply(this,arguments)})},{key:"runUpdateDataAnimation",value:(t=Ee(function(e,t,n,i,a){var o;return _ts_generator(this,function(_state){switch(_state.label){case 0:o=this;return[4,gn.runOnUpdateAsync(this.node,a,function(a){var r=Math.floor(e+(t-e)*a),s=Math.floor(n+(i-n)*a);o.updateRank({rank:r,isHighlight:!0}),o.updateScore({score:s,isHighlight:!0})})];case 1:_state.sent();return[2]}})}),function(e,n,i,a,o){return t.apply(this,arguments)})},{key:"setOpacity",value:function value(e){this.uiOpacity.opacity=e,this.nameOpacity.opacity=e,this.scoreOpacity.opacity=e,this.avatarOpacity.opacity=e}}]),l}(y)).prototype,"nameLabel",[g_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),G_=Ye(F_.prototype,"nameOpacity",[b_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),U_=Ye(F_.prototype,"container",[S_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),H_=Ye(F_.prototype,"background",[w_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),V_=Ye(F_.prototype,"highlightBackground",[k_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),q_=Ye(F_.prototype,"rankSprite",[E_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),W_=Ye(F_.prototype,"rankLabel",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),K_=Ye(F_.prototype,"goldRank",[T_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),j_=Ye(F_.prototype,"silverRank",[A_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Y_=Ye(F_.prototype,"bronzeRank",[R_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),X_=Ye(F_.prototype,"highlightRank",[I_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),J_=Ye(F_.prototype,"avatar",[P_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Q_=Ye(F_.prototype,"avatarOpacity",[__],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Z_=Ye(F_.prototype,"scoreBackground",[L_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),$_=Ye(F_.prototype,"scoreLabel",[O_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),eL=Ye(F_.prototype,"highlightScoreBackground",[D_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),tL=Ye(F_.prototype,"scoreOpacity",[N_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),nL=Ye(F_.prototype,"uiOpacity",[M_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),iL=Ye(F_.prototype,"uiTransform",[x_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),B_=F_))||B_);n._RF.pop(),n._RF.push({},"173acdyc/VOnLkPsoSfdfnr","Leaders",void 0);var TL,AL,RL,IL,PL,_L,LL,OL,DL,NL,ML,xL,BL,FL,zL,GL,UL,HL=i.ccclass,VL=i.property,qL=globalThis.game,WL=qL.player,KL=qL.frameCapture,jL=GameCore.Utils.Image,YL=(lL=HL("Leaders"),uL=VL(P),cL=VL(a),hL=VL(T),dL=VL(s),pL=VL(g),lL((vL=Ye((fL=function(e){Ie(u,e);var t,n,i,a,o,r=xe(u);function u(){var _$e;Ce(this,u);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return je(_$e=r.call.apply(r,[this].concat(n)),"leaderPrefab",vL,Ne(_$e)),je(_$e,"inactiveNodeContainer",mL,Ne(_$e)),je(_$e,"layout",gL,Ne(_$e)),je(_$e,"viewport",bL,Ne(_$e)),je(_$e,"maxLeader",SL,Ne(_$e)),_$e.cachedPhotos=new Map,_$e.leaderData=[],_$e.leaderPoolArray=[],_$e.playerLeader=null,_$e.isHidden=!0,_$e}return Ae(u,[{key:"onLoad",value:function value(){this.uiTransform=this.getComponent(s),this.batchNodes=this.getComponents(Ys),this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function value(){St.lazyValidateProperties(this)}},{key:"__preload",value:function value(){this.currentPlayerId=WL.getPlayerId();for(var _$e=0;_$e<this.maxLeader;_$e++){var t=this.createLeader();this.leaderPoolArray.push(t)}var n=this.leaderPoolArray[0].uiTransform.contentSize;this.leaderContentHeight=n.height+this.layout.spacingY}},{key:"createLeader",value:function value(){var _$e=l(this.leaderPrefab);return this.addLeaderToInactiveNode(_$e),_$e.getComponent(CL)}},{key:"updateData",value:(o=Ee(function(e){var t;return _ts_generator(this,function(_state){switch(_state.label){case 0:t=this;if(this.playerLeader=null,this.isHidden=!1,this.leaderData=e,this.leaderData.sort(function(e,t){return t.score-e.score}),null==WL)throw new Error("Player is not defined");this.batchNodes.every(function(e){return e.enabled=!0});return[4,Promise.all(this.leaderData.map(function(e,n){var i=e.playerId,a=e.photo,o=e.score,r=e.name,s=t.currentPlayerId===i;t.leaderData[n].rank=n+1;var l=t.maxLeader-1;if(!(n>=l)||s){var _$u=s&&n>l-1?t.leaderPoolArray[l]:t.leaderPoolArray[n];return t.layout.node.addChild(_$u.node),_$u.setOpacity(0),s&&(t.playerLeader=_$u),_$u.updateInfo({isHighlight:s,name:r,photo:a,rank:n+1,score:o},l),t.getAndSetLeaderPhoto({playerId:i,url:a,leader:_$u})}}))];case 1:_state.sent();return[2]}})}),function(e){return o.apply(this,arguments)})},{key:"getAndSetLeaderPhoto",value:(a=Ee(function(e){var t,n,i,a,o,e1;return _ts_generator(this,function(_state){switch(_state.label){case 0:t=e.playerId,n=e.url,i=e.leader;if(!("default"!==n))return[3,4];if(!this.cachedPhotos.has(t))return[3,1];i.setPhoto(this.cachedPhotos.get(t));return[3,4];case 1:_state.trys.push([1,3,,4]);return[4,this.loadAvatarImage(n,85,85,t)];case 2:a=_state.sent();if(!a)return[2];o=D.createWithImage(a);this.cachedPhotos.set(t,o),i.setPhoto(o);return[3,4];case 3:e1=_state.sent();if(_instanceof(e1,DOMException)&&"AbortError"===e1.name)return[2,void console.info("Leaders: getAndSetLeaderPhoto was aborted")];throw e1;case 4:return[2]}})}),function(e){return a.apply(this,arguments)})},{key:"removeLeaders",value:function value(){var _$e=this;this.isHidden=!0,this.getActiveLeaders().forEach(function(t){t.resetPhoto(),_$e.addLeaderToInactiveNode(t.node)}),this.batchNodes.every(function(e){return e.enabled=!1})}},{key:"getActiveLeaders",value:function value(){var _$e=this;return this.leaderPoolArray.filter(function(t){return t.node.parent===_$e.layout.node})}},{key:"getActiveLeaderChildren",value:function value(){return this.layout.getComponentsInChildren(CL)}},{key:"showLeaders",value:(i=Ee(function(e){var t,n,i,a;return _ts_generator(this,function(_state){switch(_state.label){case 0:t=this;if(!!this.isHidden)return[3,2];n=this.getActiveLeaders();if(!!(n.length<1))return[3,2];i=Math.ceil(this.viewport.contentSize.height/this.leaderContentHeight),a=Math.min(n.length,i);return[4,Promise.all(n.map(function(){var n=Ee(function(n,i){var _tmp,_tmp1;return _ts_generator(this,function(_state){switch(_state.label){case 0:_tmp=t.isHidden;if(_tmp)return[3,3];_tmp1=i<a;if(!_tmp1)return[3,2];return[4,n.runShowUpAnimation(e,.1*i,.3)];case 1:_tmp1=_state.sent();_state.label=2;case 2:_tmp=_tmp1;_state.label=3;case 3:_tmp;return[2]}})});return function(e,t){return n.apply(this,arguments)}}()))];case 1:_state.sent();_state.label=2;case 2:return[2]}})}),function(e){return i.apply(this,arguments)})},{key:"runUpdateLeadersRankAnimation",value:(n=Ee(function(e,t){var n,i,a,o,r,s,l;return _ts_generator(this,function(_state){switch(_state.label){case 0:n=null!=e?e:0,i=null!=t?t:this.leaderData.length;i=Math.min(i,100);for(a=this.getActiveLeaderChildren(),o=this.leaderContentHeight,r=[],s=n;s<i;s++){a[s].updateRank({rank:s+1,isHighlight:!1});l=a[s].node.worldPosition.clone();r.push(a[s].runWorldPositionAnimation(l.add3f(0,-o,0),.25))}return[4,Promise.all(r)];case 1:_state.sent();return[2]}})}),function(e,t){return n.apply(this,arguments)})},{key:"getLeaderData",value:function value(){return this.leaderData}},{key:"getPlayerLeader",value:function value(){return this.playerLeader}},{key:"getLeaderByRank",value:function value(e){return this.getActiveLeaders()[e-1]||null}},{key:"getLeaderDataByRank",value:function value(e){return this.leaderData[e-1]||null}},{key:"updateVisibility",value:function value(){var _$e=this.viewport.getBoundingBoxToWorld(),t=_$e.yMax,n=_$e.yMin;this.getActiveLeaders().forEach(function(e){var i=e.uiTransform;if(void 0!==i){var a=i.getBoundingBoxToWorld(),o=a.yMax,r=a.yMin,s=o<n||r>t;e.setOpacity(s?0:255)}})}},{key:"loadAvatarImage",value:(t=Ee(function(e,t,n,i){var a,_tmp,e1;return _ts_generator(this,function(_state){switch(_state.label){case 0:_state.trys.push([0,5,,6]);return[4,KL.captureAsync({width:t,height:n,name:"LeaderAvatar",renderOptions:Re({},i,{name:i,type:"image",depth:0,position:[0,0],size:[t,n],image:e})})];case 1:a=_state.sent();if(!a)return[3,3];return[4,jL.loadImage(a)];case 2:_tmp=_state.sent();return[3,4];case 3:_tmp=null;_state.label=4;case 4:return[2,_tmp];case 5:e1=_state.sent();return[2,null];case 6:return[2]}})}),function(e,n,i,a){return t.apply(this,arguments)})},{key:"addLeaderToInactiveNode",value:function value(e){this.inactiveNodeContainer.addChild(e),e.getComponent(CL).setOpacity(0)}}]),u}(y)).prototype,"leaderPrefab",[uL],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),mL=Ye(fL.prototype,"inactiveNodeContainer",[cL],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),gL=Ye(fL.prototype,"layout",[hL],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),bL=Ye(fL.prototype,"viewport",[dL],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),SL=Ye(fL.prototype,"maxLeader",[pL],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),yL=fL))||yL);n._RF.pop(),n._RF.push({},"2aa67vEWR9HaJkCtpsuUyRX","LeaderboardContent",void 0);var XL,JL=i.ccclass,QL=i.property,ZL=globalThis.game,$L=ZL.storage,eO=ZL.leaderboard,tO=ZL.player,nO=GameCore,iO=nO.Utils,aO=iO.Object,oO=iO.Array,rO=nO.Configs.Leaderboards,sO=(TL=JL("LeaderboardContent"),AL=QL(Zo),RL=QL(v_),IL=QL(YL),PL=QL(ue),_L=QL({type:[sL]}),LL=QL(WP),OL=QL(Ca),TL((ML=Ye((NL=function(e){Ie(c,e);var t,n,i,a,o,r,l,u=xe(c);function c(){var _$e;Ce(this,c);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return je(_$e=u.call.apply(u,[this].concat(n)),"panelAnimator",ML,Ne(_$e)),je(_$e,"tabs",xL,Ne(_$e)),je(_$e,"leaders",BL,Ne(_$e)),je(_$e,"scrollview",FL,Ne(_$e)),je(_$e,"leaderSkeletons",zL,Ne(_$e)),je(_$e,"leaderboardIsEmpty",GL,Ne(_$e)),je(_$e,"contentOpacity",UL,Ne(_$e)),_$e.isHidden=!0,_$e.currentLb=null,_$e.animAbortSignal=null,_$e.fetchAbortController=null,_$e.handleUpdateVisibility=function(){_$e.leaders.updateVisibility()},_$e.handleFriendsTabSelected=Ee(function(){return _ts_generator(this,function(_state){switch(_state.label){case 0:$L.setStorageData("leaderboard_content","lastTabOpened","friends"),_$e.cleanupSideEffects();return[4,_$e.updateStatus("friends")];case 1:_state.sent();return[2]}})}),_$e.handleWorldTabSelected=Ee(function(){return _ts_generator(this,function(_state){switch(_state.label){case 0:$L.setStorageData("leaderboard_content","lastTabOpened","global"),_$e.cleanupSideEffects();return[4,_$e.updateStatus("global")];case 1:_state.sent();return[2]}})}),_$e.hideContent=function(){_$e.contentOpacity.changeStateFade(!1,.1)},_$e.showContent=function(){_$e.contentOpacity.changeStateFade(!0,.1)},_$e}return Ae(c,[{key:"onLoad",value:function value(){this.uiTransform=this.getComponent(s),this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function value(){St.lazyValidateProperties(this)}},{key:"enableUIAnimator",value:function value(){this.panelAnimator.enabled=!0}},{key:"disableUIAnimator",value:function value(){this.panelAnimator.enabled=!1}},{key:"listenEvents",value:function value(){this.node.scene.on(Rb.FRIENDS_TAB_SELECTED,this.handleFriendsTabSelected),this.node.scene.on(Rb.WORLD_TAB_SELECTED,this.handleWorldTabSelected),this.node.scene.on(Co.HIDE_UI,this.hideContent),this.node.scene.on(Co.SHOW_UI,this.showContent),this.scrollview.node.on(ue.EventType.SCROLLING,this.handleUpdateVisibility)}},{key:"unlistenEvents",value:function value(){this.node.scene.off(Rb.FRIENDS_TAB_SELECTED,this.handleFriendsTabSelected),this.node.scene.off(Rb.WORLD_TAB_SELECTED,this.handleWorldTabSelected),this.unlistenUIEvents(),this.scrollview.node.off(ue.EventType.SCROLLING,this.handleUpdateVisibility)}},{key:"unlistenUIEvents",value:function value(){this.node.scene.off(Co.HIDE_UI,this.hideContent),this.node.scene.off(Co.SHOW_UI,this.showContent)}},{key:"loadLeaderboard",value:(l=Ee(function(e,t){var n,_tmp;return _ts_generator(this,function(_state){switch(_state.label){case 0:if(t.aborted)return[2,null];n=this.getLeaderboardName(e);if(!n)return[3,2];return[4,eO.requestLeaderboardAsync(n,rO.Limit)];case 1:_tmp=(_state.sent(),t.aborted?null:eO.getLeaderboard(n));return[3,3];case 2:_tmp=null;_state.label=3;case 3:return[2,_tmp]}})}),function(e,t){return l.apply(this,arguments)})},{key:"getLeaderboardName",value:function value(e){return"friends"===e?fl:yl}},{key:"loadMoreLeaderboard",value:(r=Ee(function(e,t){var n,_tmp;return _ts_generator(this,function(_state){switch(_state.label){case 0:if(t.aborted)return[2,null];n=this.getLeaderboardName(e);if(!n)return[3,2];return[4,eO.loadMoreLeaderboardAsync(n,1e3)];case 1:_tmp=(_state.sent(),t.aborted?null:eO.getLeaderboard(n));return[3,3];case 2:_tmp=null;_state.label=3;case 3:return[2,_tmp]}})}),function(e,t){return r.apply(this,arguments)})},{key:"showLoading",value:(o=Ee(function(e){var t;var _arguments=arguments;return _ts_generator(this,function(_state){switch(_state.label){case 0:t=_arguments.length>1&&void 0!==_arguments[1]?_arguments[1]:0;this.scrollview.scrollToTop(0),this.scrollview.enabled=!1;return[4,Promise.all([this.leaderSkeletons.map(function(n,i){return n.show(i*t,e)})])];case 1:_state.sent();return[2]}})}),function(e){return o.apply(this,arguments)})},{key:"hideLoading",value:(a=Ee(function(e){return _ts_generator(this,function(_state){switch(_state.label){case 0:return[4,Promise.all(this.leaderSkeletons.map(function(t){return t.hide(e)}))];case 1:_state.sent();return[2]}})}),function(e){return a.apply(this,arguments)})},{key:"enter",value:function value(){this.listenEvents(),this.isHidden=!1;var _$e=$L.getStorageData("leaderboard_content","lastTabOpened");"friends"===_$e&&this.handleFriendsTabSelected(),"global"===_$e&&this.handleWorldTabSelected()}},{key:"hide",value:function value(){this.isHidden=!0}},{key:"cleanup",value:function value(){this.unlistenEvents(),this.cleanupSideEffects()}},{key:"cleanupSideEffects",value:function value(){var _$e,t;null===(_$e=this.animAbortSignal)||void 0===_$e||_$e.abort(),this.animAbortSignal=null,null===(t=this.fetchAbortController)||void 0===t||t.abort(),this.fetchAbortController=null,this.leaders.removeLeaders(),this.leaderboardIsEmpty.hide()}},{key:"isAborted",value:function value(){var _$e,t,n,i,a=null===(_$e=null===(t=this.animAbortSignal)||void 0===t?void 0:t.aborted)||void 0===_$e||_$e,o=null===(n=null===(i=this.fetchAbortController)||void 0===i?void 0:i.signal.aborted)||void 0===n||n;return a||o}},{key:"updateStatus",value:(i=Ee(function(e){var t,_tmp,_,n,i,a,o,r,s,l,u,_$c,h,d,p;return _ts_generator(this,function(_state){switch(_state.label){case 0:if(null!==this.animAbortSignal||null!==this.fetchAbortController)throw new Error("LeaderboardContent: LeaderboardContent is already loading. Please handle cancelling gracefully.");_tmp=!this.isHidden;if(!_tmp)return[3,3];this.tabs.updateStatus(e),this.animAbortSignal=new Bn,this.fetchAbortController=new AbortController;return[4,this.showLoading(this.animAbortSignal)];case 1:_state.sent();_=this;return[4,this.loadLeaderboard(e,this.animAbortSignal)];case 2:_tmp=(_.currentLb=_state.sent(),this.currentLb);_state.label=3;case 3:if(!_tmp)return[3,10];if(0===aO.vals(this.currentLb.leaders).length)return[2,(this.leaderboardIsEmpty.show(),this.tabs.setInteractableButtons(!0),void this.hideLoading(this.animAbortSignal))];n=tO.getPlayerId(),i=this.currentLb.leaders[n];if(!!i)return[3,5];a=this.getLeaderboardName(e);if(!a)return[3,5];return[4,eO.getLeadersByPlayerIdsAsync(a,[n])];case 4:o=_state.sent();o.length>0&&(i=o[0],this.currentLb.leaders[n]=i);_state.label=5;case 5:r=$L.getStorage("leaderboard_content"),s=r.previousScore,l=r.previousRank,u=null!==(t=i)&&void 0!==t?t:{},_$c=u.score,h=u.rank;s&&s<_$c&&l&&l!==h&&(this.currentLb.leaders[n].score=s);d=aO.vals(this.currentLb.leaders);li.setBlockInput(!0),this.tabs.setInteractableButtons(!1);return[4,this.hideLoading(this.animAbortSignal)];case 6:if(_state.sent(),this.isAborted())return[2,(li.setBlockInput(!1),void this.tabs.setInteractableButtons(!0))];this.leaders.updateData(d),this.scrollview.enabled=!0;return[4,this.leaders.showLeaders(this.animAbortSignal)];case 7:if(_state.sent(),this.isAborted())return[2,(li.setBlockInput(!1),void this.tabs.setInteractableButtons(!0))];p=this.leaders.getPlayerLeader();if(!p)return[2,(li.setBlockInput(!1),void this.tabs.setInteractableButtons(!0))];return[4,this.scrollToLeader(p,1)];case 8:if(_state.sent(),this.isAborted())return[2,(li.setBlockInput(!1),void this.tabs.setInteractableButtons(!0))];return[4,this.runPlayerRankChangeAnimation(this.animAbortSignal,_$c)];case 9:if(_state.sent(),this.isAborted())return[2,(li.setBlockInput(!1),void this.tabs.setInteractableButtons(!0))];$L.setStorageData("leaderboard_content","previousScore",_$c),$L.setStorageData("leaderboard_content","previousRank",h),li.setBlockInput(!1),this.tabs.setInteractableButtons(!0);_state.label=10;case 10:return[2]}})}),function(e){return i.apply(this,arguments)})},{key:"runPlayerRankChangeAnimation",value:(n=Ee(function(e,t){var n,i,a,o,r,s,l,u,_$c,h,d,p,y,f;return _ts_generator(this,function(_state){switch(_state.label){case 0:n=$L.getStorage("leaderboard_content").previousScore;if(!(n&&!(n>=t)))return[3,6];i=this.leaders.getLeaderData(),a=oO.searchIndex(i,function(e){return e.playerId===tO.getPlayerId()});if(!(-1!==a))return[3,6];o=i[a],r=o.score,s=o.rank;o.score=t,i.sort(function(e,t){return t.score-e.score}),i.forEach(function(e,t){e.rank=t+1});l=this.leaders.getPlayerLeader();if(!l)return[3,6];if(!(s!==o.rank))return[3,5];u=this.leaders.getLeaderByRank(o.rank);if(!u)return[3,4];this.leaders.layout.enabled=!1;return[4,l.runScaleAnimation(e,1.1,.5)];case 1:_state.sent();_$c=Math.min(.5*(s-o.rank),2),h=[l.runUpdateDataAnimation(s,o.rank,r,o.score,_$c),this.scrollToLeader(u,_$c)],d=this.uiTransform.contentSize.height,p=this.scrollview.getMaxScrollOffset().y,y=-u.node.position.y-d/2,f=Y.ZERO;y<0?f=new Y(l.node.worldPosition.x,d+u.node.position.y,l.node.worldPosition.z):this.scrollview.getScrollOffset().y>=p-5&&(f=y<p?new Y(l.node.worldPosition.x,d/2,l.node.worldPosition.z):u.node.worldPosition),f.equals(Y.ZERO)||h.push(l.runWorldPositionAnimation(f,_$c));return[4,Promise.all(h)];case 2:_state.sent();return[4,Promise.all([l.runScaleAnimation(e,1,.25),l.node.setSiblingIndex(o.rank-1),this.leaders.runUpdateLeadersRankAnimation(o.rank,s)])];case 3:_state.sent(),this.leaders.layout.enabled=!0,this.leaders.layout.updateLayout();_state.label=4;case 4:return[3,6];case 5:l.updateScore({score:o.score,isHighlight:!0});_state.label=6;case 6:return[2]}})}),function(e,t){return n.apply(this,arguments)})},{key:"scrollToLeader",value:(t=Ee(function(e,t){var n,i,a,o;return _ts_generator(this,function(_state){n=this.uiTransform.contentSize,i=new Q(0,-e.node.position.y-n.height/2),a=this.scrollview.getScrollOffset().clone();i.y=Math.max(i.y,0),a.y=Math.max(a.y,0);o=i.y-a.y;if(!(Math.abs(o)<5))return[2,(this.scrollview.scrollToOffset(i,t),gn.waitTweenAsync(t))];return[2]})}),function(e,n){return t.apply(this,arguments)})}]),c}(y)).prototype,"panelAnimator",[AL],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),xL=Ye(NL.prototype,"tabs",[RL],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),BL=Ye(NL.prototype,"leaders",[IL],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),FL=Ye(NL.prototype,"scrollview",[PL],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),zL=Ye(NL.prototype,"leaderSkeletons",[_L],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return[]}}),GL=Ye(NL.prototype,"leaderboardIsEmpty",[LL],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),UL=Ye(NL.prototype,"contentOpacity",[OL],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),DL=NL))||DL);n._RF.pop(),n._RF.push({},"ae514KD4phHMYC0AD3CIw68","LeaderboardPage",void 0);var lO,uO,cO,hO,dO,pO,yO,fO,vO,mO,gO,bO,SO,wO,kO,EO,CO;(0,i.ccclass)("LeaderboardPage")(XL=function(e){Ie(o,e);var t,n,i,a=xe(o);function o(){return Ce(this,o),a.apply(this,arguments)}return Ae(o,[{key:"mount",value:(i=Ee(function(){var _$e;return _ts_generator(this,function(_state){switch(_state.label){case 0:if(!!this.pagePrefab)return[3,2];return[4,li.loadPrefabAsync(Fn.LEADERBOARD_PAGE)];case 1:_$e=_state.sent();_$e&&this.node&&(this.pagePrefab=_$e);_state.label=2;case 2:return[4,Fe(Pe(o.prototype),"mount",this).call(this)];case 3:if(_state.sent(),this.containerUIOpacity.opacity=0,this.content=this.container.getComponentInChildren(sO),!this.content)throw new Error("LeaderboardPage: Leaders not found");return[2]}})}),function(){return i.apply(this,arguments)})},{key:"transitionIn",value:(n=Ee(function(){var _$e,t,n;return _ts_generator(this,function(_state){switch(_state.label){case 0:_$e=this;return[4,Fe(Pe(o.prototype),"transitionIn",this).call(this)];case 1:_state.sent(),this.content.enableUIAnimator();t=gn.runTweenAsync(k(this.containerUIOpacity).to(.2,{opacity:255})),n=new Promise(function(t){_$e.node.scene.emit(Co.SHOW_UI,{onComplete:function onComplete(){t()}})});return[4,Promise.all([t,n])];case 2:_state.sent(),this.content.enter();return[2]}})}),function(){return n.apply(this,arguments)})},{key:"transitionOut",value:(t=Ee(function(){var _$e;return _ts_generator(this,function(_state){switch(_state.label){case 0:_$e=this;return[4,Fe(Pe(o.prototype),"transitionOut",this).call(this)];case 1:_state.sent(),this.content.unlistenUIEvents();return[4,new Promise(function(t){_$e.node.scene.emit(Co.HIDE_UI,{onComplete:function onComplete(){t()}})})];case 2:_state.sent(),this.content.disableUIAnimator();return[2]}})}),function(){return t.apply(this,arguments)})},{key:"unmount",value:function value(){var _$e,t;null===(_$e=this.content)||void 0===_$e||_$e.hide(),null===(t=this.content)||void 0===t||t.cleanup(),Fe(Pe(o.prototype),"unmount",this).call(this)}}]),o}(lC));n._RF.pop(),n._RF.push({},"8cd04RxbahLDaxq9FJf6hBh","TournamentBlock",void 0);var TO,AO,RO,IO,PO,_O=i.ccclass,LO=i.property,OO=globalThis.game,DO=OO.leaderboard,NO=OO.player,MO=GameCore.Utils.Time,xO=(lO=_O("TournamentBlock"),uO=LO(a),cO=LO(u),hO=LO(u),dO=LO(u),pO=LO(u),yO=LO(s),fO=LO({type:[A]}),lO((gO=Ye((mO=function(e){Ie(o,e);var t,n,i,a=xe(o);function o(){var _$e;Ce(this,o);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return je(_$e=a.call.apply(a,[this].concat(n)),"container",gO,Ne(_$e)),je(_$e,"titleLabel",bO,Ne(_$e)),je(_$e,"timeLabel",SO,Ne(_$e)),je(_$e,"playerCountLabel",wO,Ne(_$e)),je(_$e,"playButtonLabel",kO,Ne(_$e)),je(_$e,"uiTransform",EO,Ne(_$e)),je(_$e,"banners",CO,Ne(_$e)),_$e}return Ae(o,[{key:"onLoad",value:function value(){this.uiOpacity=this.node.getComponent(x),this.validateRequiredComponents()}},{key:"activateThemeBanner",value:function value(e){var t=!1;this.banners.forEach(function(n){n.node.active=n.node.name.toLowerCase()===e,n.node.active&&(t=!0)}),t||this.banners.forEach(function(e){e.node.active=e.node.name.toLowerCase()===Gl.SUMMER})}},{key:"validateRequiredComponents",value:function value(){St.lazyValidateProperties(this)}},{key:"updateInfo",value:(i=Ee(function(e){var t,n,i,a,_$o,r,s,e1,l,u,c,h;return _ts_generator(this,function(_state){switch(_state.label){case 0:this.payload=e;t=e.endTime,n=e.title,i=e.payload,a=i.leaderboardId,_$o=i.themeId;if(!a)return[3,5];this.setPlayerCountWaiting(),this.updateTitle(n),this.updateEndTime(t),this.updateTournamentBanner(_$o);r={leaders:[],isPlayerInTournament:!1};_state.label=1;case 1:_state.trys.push([1,3,,4]);return[4,this.getLeadersPayload(a)];case 2:s=_state.sent();s&&(r=s);return[3,4];case 3:e1=_state.sent();console.error("Fetch lb for tournament ".concat(n),e1);return[3,4];case 4:this.leadersPayload=r;l=this.leadersPayload,u=l.leaders,c=l.isPlayerInTournament,h=u.length;this.updatePlayerCount(h),this.updatePlayButtonLabel(c);_state.label=5;case 5:return[2]}})}),function(e){return i.apply(this,arguments)})},{key:"updateTitle",value:function value(e){e&&(this.titleLabel.string=e)}},{key:"updateEndTime",value:function value(e){var t=MO.getRelativeTime(e);this.timeLabel.string="Ends ".concat(t)}},{key:"updatePlayerCount",value:function value(e){this.playerCountLabel.string="".concat(e," ")+(e>1?"players":"player")}},{key:"setPlayerCountWaiting",value:function value(){this.playerCountLabel.string="Loading..."}},{key:"updateTournamentBanner",value:function value(e){e?this.activateThemeBanner(e):this.activateThemeBanner(Gl.SUMMER)}},{key:"updatePlayButtonLabel",value:function value(e){this.playButtonLabel.string=e?"Continue":"Join"}},{key:"getLeadersPayload",value:(n=Ee(function(e){var t,n,i,a,_$o,r,s,l;return _ts_generator(this,function(_state){switch(_state.label){case 0:t=DO.getLeaderboardName(e);if(!t)return[2,null];return[4,DO.requestLeaderboardAsync(t,0)];case 1:_state.sent();n=DO.getLeaderboard(t);if(!n)return[2,null];a=GameCore.Utils.Object.vals(n.leaders),_$o=NO.getPlayerId(),r={leaders:[],player:void 0,isPlayerInTournament:!1},s=We(a);try{for(s.s();!(i=s.n()).done;){l=i.value;l.playerId===_$o?(r.player=l,r.isPlayerInTournament=!0,r.leaders.push(l)):r.leaders.push(l)}}catch(e){s.e(e)}finally{s.f()}return[2,r]}})}),function(e){return n.apply(this,arguments)})},{key:"runShowPopUpAnimation",value:(t=Ee(function(e,t,n){var i,a,_$o,r,s;return _ts_generator(this,function(_state){switch(_state.label){case 0:i=this;this.node.scale=new Y(.8,.8,.8),this.uiOpacity.opacity=0;a=this.container.position.clone();this.container.position=new Y(a.x,a.y-100,a.z);_$o=k(this.node).delay(e);_$o.to(t,{scale:Y.ONE},{easing:"elasticOut"});r=k(this.container).delay(e);r.to(t,{position:a},{easing:"backOut"});s=k(this.uiOpacity).delay(e);s.to(t,{opacity:255},{easing:"cubicOut"}),n.addAbortListener(function(){i.node.scale=Y.ONE,i.container.position=a,i.uiOpacity.opacity=255});return[4,Promise.all([gn.runTweenAsync(_$o,n),gn.runTweenAsync(r,n),gn.runTweenAsync(s,n)])];case 1:_state.sent();return[2]}})}),function(e,n,i){return t.apply(this,arguments)})},{key:"handleOnTournamentClicked",value:function value(){var _$e=this.payload.id||"";if(Wu.validateTournamentExpired(_$e))return this.node.scene.emit(Cl.RELOAD_TOURNAMENT),void Mu.showNotificationScreen("Tournament has ended",2);try{var t=JSON.stringify(this.payload);Mu.showTournamentDetailScreen(t,"tournament_start")}catch(e){console.warn("handleOnTournamentClicked",e)}}}]),o}(y)).prototype,"container",[uO],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),bO=Ye(mO.prototype,"titleLabel",[cO],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),SO=Ye(mO.prototype,"timeLabel",[hO],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wO=Ye(mO.prototype,"playerCountLabel",[dO],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),kO=Ye(mO.prototype,"playButtonLabel",[pO],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),EO=Ye(mO.prototype,"uiTransform",[yO],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),CO=Ye(mO.prototype,"banners",[fO],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return[]}}),vO=mO))||vO);n._RF.pop(),n._RF.push({},"a409buwLfZLQq7cmBGiqhF5","TournamentBlockSkeleton",void 0);var BO,FO,zO,GO,UO,HO,VO,qO,WO,KO,jO,YO=i.ccclass,XO=i.property,JO=(TO=YO("TournamentBlockSkeleton"),AO=XO(a),TO((PO=Ye((IO=function(e){Ie(a,e);var t,n,i=xe(a);function a(){var _$e;Ce(this,a);for(var t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];return je(_$e=i.call.apply(i,[this].concat(n)),"container",PO,Ne(_$e)),_$e}return Ae(a,[{key:"__preload",value:function value(){this.uiOpacity=this.getComponent(x),this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function value(){St.lazyValidateProperties(this)}},{key:"hide",value:(n=Ee(function(e){var t;return _ts_generator(this,function(_state){switch(_state.label){case 0:t=this;return[4,gn.runTweenAsync(k(this.uiOpacity).to(.2,{opacity:0}).call(function(){t.node.active=!1}),e)];case 1:_state.sent();return[2]}})}),function(e){return n.apply(this,arguments)})},{key:"show",value:(t=Ee(function(e,t){var n,i,_$a,o,r;return _ts_generator(this,function(_state){switch(_state.label){case 0:n=this;this.node.active=!0,this.node.scale=new Y(.8,.8,.8),this.uiOpacity.opacity=0;i=this.container.position.clone();this.container.position=new Y(i.x,i.y-100,i.z);_$a=k(this.node).delay(e);_$a.to(.2,{scale:Y.ONE},{easing:"elasticOut"});o=k(this.container).delay(e);o.to(.2,{position:i},{easing:"backOut"});r=k(this.uiOpacity).delay(e);r.to(.2,{opacity:255},{easing:"cubicOut"}),t.addAbortListener(function(){n.node.scale=Y.ONE,n.container.position=i,n.uiOpacity.opacity=255});return[4,Promise.all([gn.runTweenAsync(_$a,t),gn.runTweenAsync(o,t),gn.runTweenAsync(r,t)])];case 1:_state.sent();return[2]}})}),function(e,n){return t.apply(this,arguments)})}]),a}(y)).prototype,"container",[AO],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),RO=IO))||RO);n._RF.pop(),n._RF.push({},"5f82fye3oxHQrxKbP9TC2di","TournamentsBoard",void 0);var QO,ZO,$O,eD,tD,nD=i.ccclass,iD=i.property,aD=globalThis.game.player,oD=(BO=nD("TournamentsBoard"),FO=iD(P),zO=iD(a),GO=iD(T),UO=iD(a),BO((qO=Ye((VO=function(e){Ie(i,e);var t,n=xe(i);function i(){var _$e;Ce(this,i);for(var t=arguments.length,a=new Array(t),o=0;o<t;o++)a[o]=arguments[o];return je(_$e=n.call.apply(n,[this].concat(a)),"tournamentBlockPrefab",qO,Ne(_$e)),_$e.tournamentBlockArray=[],je(_$e,"inactiveNodeContainer",WO,Ne(_$e)),je(_$e,"layout",KO,Ne(_$e)),je(_$e,"createTournamentButton",jO,Ne(_$e)),_$e}return Ae(i,[{key:"onLoad",value:function value(){this.uiTransform=this.getComponent(s),this.uiOpacity=this.getComponent(x),this.validateRequiredComponents()}},{key:"start",value:function value(){for(var _$e=0;_$e<20;_$e++)this.addTournamentBlock();this.tournamentBlockContentHeight=this.tournamentBlockArray[0].uiTransform.contentSize.height+this.layout.spacingY}},{key:"validateRequiredComponents",value:function value(){St.lazyValidateProperties(this)}},{key:"updateData",value:function value(e){var t=this,n=!1;e.forEach(function(e,i){var a=t.tournamentBlockArray[i];e.payload.playerId===aD.getPlayerId()&&(n=!0),a||(a=t.addTournamentBlock()),a.updateInfo(e),t.layout.node.addChild(a.node)}),n||this.setCreateTournamentButtonActive(!0)}},{key:"addTournamentBlock",value:function value(){var _$e=l(this.tournamentBlockPrefab);this.inactiveNodeContainer.addChild(_$e);var t=_$e.getComponent(xO);return this.tournamentBlockArray.push(t),t}},{key:"removeTournamentBlocks",value:function value(){var _$e=this;this.getActiveTournamentBlocks().forEach(function(t){_$e.inactiveNodeContainer.addChild(t.node)}),this.setCreateTournamentButtonActive(!1)}},{key:"getActiveTournamentBlocks",value:function value(){var _$e=this;return this.tournamentBlockArray.filter(function(t){return t.node.parent===_$e.layout.node})}},{key:"setCreateTournamentButtonActive",value:function value(e){e?this.layout.node.addChild(this.createTournamentButton):this.layout.node.removeChild(this.createTournamentButton),this.createTournamentButton.active=e}},{key:"showTournamentBlocks",value:(t=Ee(function(e,t){var n,_$i,a;return _ts_generator(this,function(_state){switch(_state.label){case 0:n=this.getActiveTournamentBlocks();if(!!(n.length<1))return[3,2];_$i=Math.ceil(e/this.tournamentBlockContentHeight),a=Math.min(n.length,_$i);return[4,Promise.all(n.map(function(){var _$e=Ee(function(e,n){var _tmp;return _ts_generator(this,function(_state){switch(_state.label){case 0:if(!(n>=a))return[3,2];return[4,e.runShowPopUpAnimation(.1*n,.3,t)];case 1:_tmp=_state.sent();return[3,3];case 2:_tmp=e.uiOpacity.opacity=255;_state.label=3;case 3:_tmp;return[2]}})});return function(t,n){return _$e.apply(this,arguments)}}()))];case 1:_state.sent();_state.label=2;case 2:return[2]}})}),function(e,n){return t.apply(this,arguments)})},{key:"updateVisibility",value:function value(){var _$e=this.uiTransform.getBoundingBoxToWorld(),t=_$e.yMax,n=_$e.yMin;this.getActiveTournamentBlocks().forEach(function(e){var _$i=e.uiTransform;if(void 0!==_$i){var a=_$i.getBoundingBoxToWorld(),o=a.yMax,r=a.yMin,s=o<n||r>t;e.uiOpacity.opacity=s?0:255}})}}]),i}(y)).prototype,"tournamentBlockPrefab",[FO],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),WO=Ye(VO.prototype,"inactiveNodeContainer",[zO],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),KO=Ye(VO.prototype,"layout",[GO],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),jO=Ye(VO.prototype,"createTournamentButton",[UO],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),HO=VO))||HO);n._RF.pop(),n._RF.push({},"f8a7b0St3FAkb1PvvvJTLCh","TournamentsNotAvailable",void 0);var rD,sD,lD,uD,cD,hD,dD,pD,yD,fD,vD,mD,gD,bD,SD,wD=i.ccclass,kD=i.property,ED=(QO=wD("TournamentsNotAvailable"),ZO=kD(d),QO((tD=Ye((eD=function(e){Ie(i,e);var t,n=xe(i);function i(){var _$e;Ce(this,i);for(var t=arguments.length,a=new Array(t),o=0;o<t;o++)a[o]=arguments[o];return je(_$e=n.call.apply(n,[this].concat(a)),"createButton",tD,Ne(_$e)),_$e}return Ae(i,[{key:"onLoad",value:function value(){this.uiOpacity=this.getComponent(x),this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function value(){St.lazyValidateProperties(this)}},{key:"show",value:(t=Ee(function(){var _$e,t,n;return _ts_generator(this,function(_state){switch(_state.label){case 0:this.createButton.interactable=!0,this.uiOpacity.opacity=255;_$e=this.node.position.clone(),t=k(this.node);t.to(.05,{position:_$e.clone().add3f(5,0,0)}),t.to(.05,{position:_$e.clone().add3f(-5,0,0)});n=k(this.node).repeat(2,t);n.to(.05,{position:_$e});return[4,gn.runTweenAsync(n)];case 1:_state.sent();return[2]}})}),function(){return t.apply(this,arguments)})},{key:"hide",value:function value(){this.createButton.interactable=!1,this.uiOpacity.opacity=0}}]),i}(y)).prototype,"createButton",[ZO],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),$O=eD))||$O);n._RF.pop(),n._RF.push({},"199fcQ5IEZFbJCfSrGNrGDQ","TournamentContent",void 0);var CD,TD=i.ccclass,AD=i.property,RD=globalThis.game,ID=RD.storage,PD=RD.match,_D=GameCore.Utils,LD=_D.Object,OD=_D.Array,DD=(rD=TD("TournamentContent"),sD=AD({type:Zo}),lD=AD(oD),uD=AD(ED),cD=AD(ue),hD=AD({type:[JO]}),dD=AD(Ca),rD((fD=Ye((yD=function(e){Ie(r,e);var t,n,i,a,o=xe(r);function r(){var _$e;Ce(this,r);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return je(_$e=o.call.apply(o,[this].concat(n)),"panelAnimator",fD,Ne(_$e)),je(_$e,"tournamentsBoard",vD,Ne(_$e)),je(_$e,"tournamentsNotAvailable",mD,Ne(_$e)),je(_$e,"scrollView",gD,Ne(_$e)),je(_$e,"skeletons",bD,Ne(_$e)),je(_$e,"contentOpacity",SD,Ne(_$e)),_$e.animAbortSignal=null,_$e.softAbortSignal=null,_$e.hideContent=function(){_$e.contentOpacity.changeStateFade(!1,.1)},_$e.showContent=function(){_$e.contentOpacity.changeStateFade(!0,.1)},_$e}return Ae(r,[{key:"onLoad",value:function value(){this.uiTransform=this.node.getComponent(s),this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function value(){St.lazyValidateProperties(this)}},{key:"listenEvents",value:function value(){this.scrollView.node.on(ue.EventType.SCROLLING,this.onScrolling,this),this.node.scene.on(Cl.RELOAD_TOURNAMENT,this.reload,this),this.node.scene.on(Co.HIDE_UI,this.hideContent),this.node.scene.on(Co.SHOW_UI,this.showContent)}},{key:"unlistenEvents",value:function value(){this.scrollView.node.off(ue.EventType.SCROLLING,this.onScrolling,this),this.node.scene.off(Cl.RELOAD_TOURNAMENT,this.reload,this),this.unlistenUIEvents()}},{key:"unlistenUIEvents",value:function value(){this.node.scene.off(Co.HIDE_UI,this.hideContent),this.node.scene.off(Co.SHOW_UI,this.showContent)}},{key:"onScrolling",value:function value(){this.tournamentsBoard.updateVisibility()}},{key:"enableUIAnimator",value:function value(){this.panelAnimator.enabled=!0}},{key:"disableUIAnimator",value:function value(){this.panelAnimator.enabled=!1}},{key:"enter",value:(a=Ee(function(){var _$e,t,_tmp,_tmp1,_tmp2;return _ts_generator(this,function(_state){switch(_state.label){case 0:if(this.listenEvents(),null!==this.animAbortSignal||null!==this.softAbortSignal)throw new Error("TournamentContent: TournamentContent is already running");this.animAbortSignal=new Bn,this.softAbortSignal=new Bn;return[4,this.showLoading(this.animAbortSignal)];case 1:if(!(_state.sent(),!this.isAborted()))return[3,9];return[4,Wu.requestTournamentDataAsync()];case 2:t=_state.sent();_tmp=this.isAborted();if(_tmp)return[3,8];return[4,this.hideLoading(this.animAbortSignal)];case 3:_state.sent();_tmp1=this.isAborted();if(_tmp1)return[3,7];if(!(0!==t.length||null!==(_$e=this.softAbortSignal)&&void 0!==_$e&&_$e.aborted))return[3,5];this.tryShowTournamentResult(),this.scrollView.enabled=!0,this.tournamentsBoard.updateData(t);return[4,this.tournamentsBoard.showTournamentBlocks(this.uiTransform.contentSize.height-this.tournamentsBoard.layout.paddingTop,this.animAbortSignal)];case 4:_tmp2=_state.sent();return[3,6];case 5:_tmp2=this.tournamentsNotAvailable.show();_state.label=6;case 6:_tmp1=_tmp2;_state.label=7;case 7:_tmp=_tmp1;_state.label=8;case 8:_tmp;_state.label=9;case 9:return[2]}})}),function(){return a.apply(this,arguments)})},{key:"showLoading",value:(i=Ee(function(e){return _ts_generator(this,function(_state){switch(_state.label){case 0:this.scrollView.scrollToTop(0),this.scrollView.enabled=!1;return[4,Promise.all([this.skeletons.map(function(t){return t.show(0,e)})])];case 1:_state.sent();return[2]}})}),function(e){return i.apply(this,arguments)})},{key:"hideLoading",value:(n=Ee(function(e){return _ts_generator(this,function(_state){switch(_state.label){case 0:return[4,Promise.all([this.skeletons.map(function(t){return t.hide(e)})])];case 1:_state.sent();return[2]}})}),function(e){return n.apply(this,arguments)})},{key:"tryShowTournamentResult",value:function value(){try{if(!ID.getStorage("tournament").animateTournamentLeader)return;var _$e=Wu.getAllTournamentData(),t=PD.getMatchState().customData.tournamentId;if(!t)throw new Error("Tournament ID not found");var n=OD.search(_$e,function(e){return e.id===t});if(!n)throw new Error("Tournament not found");var i=JSON.stringify(n);Mu.showTournamentDetailScreen(i,"tournament_end")}catch(e){ID.setStorageData("tournament","animateTournamentLeader",!1),console.warn("showTournamentResult",e)}}},{key:"processCreateTournament",value:(t=Ee(function(){var e;return _ts_generator(this,function(_state){switch(_state.label){case 0:_state.trys.push([0,2,,3]);return[4,uu.processCreateTournamentAsync()];case 1:_state.sent();return[3,3];case 2:e=_state.sent();if(!LD.hasOwn(e,"code"))return[2,void Mu.showNotificationScreen("Sorry. Unknown error. Failed to Create Tournament")];if("USER_INPUT"===e.code)return[2];"INVALID_OPERATION"===e.code?Mu.showNotificationScreen(e.message):Mu.showNotificationScreen("Sorry. Unknown error. Failed to Create Tournament");return[3,3];case 3:this.reload();return[2]}})}),function(){return t.apply(this,arguments)})},{key:"isAborted",value:function value(){var _$e,t;return null===(_$e=null===(t=this.animAbortSignal)||void 0===t?void 0:t.aborted)||void 0===_$e||_$e}},{key:"cleanup",value:function value(){var _$e;this.unlistenEvents(),null===(_$e=this.animAbortSignal)||void 0===_$e||_$e.abort(),this.animAbortSignal=null,this.tournamentsBoard.removeTournamentBlocks(),this.tournamentsNotAvailable.hide()}},{key:"softAbort",value:function value(){var _$e;null===(_$e=this.softAbortSignal)||void 0===_$e||_$e.abort(),this.softAbortSignal=null}},{key:"reload",value:function value(){this.softAbort(),this.cleanup(),this.enter()}}]),r}(y)).prototype,"panelAnimator",[sD],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),vD=Ye(yD.prototype,"tournamentsBoard",[lD],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),mD=Ye(yD.prototype,"tournamentsNotAvailable",[uD],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),gD=Ye(yD.prototype,"scrollView",[cD],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),bD=Ye(yD.prototype,"skeletons",[hD],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return[]}}),SD=Ye(yD.prototype,"contentOpacity",[dD],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),pD=yD))||pD);n._RF.pop(),n._RF.push({},"bce5eh0LHVP2bCJ6u+kFjuA","TournamentPage",void 0);var ND,MD,xD,BD,FD,zD;(0,i.ccclass)("TournamentPage")(CD=function(e){Ie(o,e);var t,n,i,a=xe(o);function o(){return Ce(this,o),a.apply(this,arguments)}return Ae(o,[{key:"mount",value:(i=Ee(function(){var _$e;return _ts_generator(this,function(_state){switch(_state.label){case 0:if(!!this.pagePrefab)return[3,2];return[4,li.loadPrefabAsync(Fn.TOURNAMENTS_PAGE)];case 1:_$e=_state.sent();_$e&&this.node&&(this.pagePrefab=_$e);_state.label=2;case 2:return[4,Fe(Pe(o.prototype),"mount",this).call(this)];case 3:if(_state.sent(),this.containerUIOpacity.opacity=0,this.content=this.container.getComponentInChildren(DD),!this.content)throw new Error("LeaderboardPage: Leaders not found");return[2]}})}),function(){return i.apply(this,arguments)})},{key:"transitionIn",value:(n=Ee(function(){var _$e,t,n;return _ts_generator(this,function(_state){switch(_state.label){case 0:_$e=this;return[4,Fe(Pe(o.prototype),"transitionIn",this).call(this)];case 1:_state.sent(),this.content.enableUIAnimator();t=gn.runTweenAsync(k(this.containerUIOpacity).to(.2,{opacity:255})),n=new Promise(function(t){_$e.node.scene.emit(Co.SHOW_UI,{onComplete:function onComplete(){t()}})});return[4,Promise.all([t,n])];case 2:_state.sent(),this.content.enter();return[2]}})}),function(){return n.apply(this,arguments)})},{key:"transitionOut",value:(t=Ee(function(){var _$e,t;return _ts_generator(this,function(_state){switch(_state.label){case 0:t=this;null===(_$e=this.content)||void 0===_$e||_$e.softAbort(),this.content.unlistenUIEvents();return[4,Fe(Pe(o.prototype),"transitionOut",this).call(this)];case 1:_state.sent();return[4,new Promise(function(e){t.node.scene.emit(Co.HIDE_UI,{onComplete:function onComplete(){e()}})})];case 2:_state.sent(),this.content.disableUIAnimator();return[2]}})}),function(){return t.apply(this,arguments)})},{key:"unmount",value:function value(){var _$e;null===(_$e=this.content)||void 0===_$e||_$e.cleanup(),Fe(Pe(o.prototype),"unmount",this).call(this)}}]),o}(lC));n._RF.pop(),n._RF.push({},"b8271vI+3pO9q8SKMYpqLKv","EventBadge",void 0);var GD,UD,HD,VD,qD,WD,KD,jD,YD,XD=i.ccclass,JD=i.property;ND=XD("EventBadge"),MD=JD(u),xD=JD(m),ND((zD=Ye((FD=function(e){Ie(n,e);var t=xe(n);function n(){var _$e;Ce(this,n);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return je(_$e=t.call.apply(t,[this].concat(a)),"label",zD,Ne(_$e)),_$e}return Ae(n,[{key:"text",get:function get(){return this.label.string},set:function set(e){this.label.string=e}},{key:"onLoad",value:function value(){this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function value(){if(!this.label)throw new Error("EventBadge: Missing required component Label")}}]),n}(y)).prototype,"label",[MD],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ye(FD.prototype,"text",[xD],Object.getOwnPropertyDescriptor(FD.prototype,"text"),FD.prototype),BD=FD));n._RF.pop(),n._RF.push({},"7712cs4XLJAgpKqlO3gPqkF","EventProgressBar",void 0);var QD,ZD,$D,eN,tN,nN,iN,aN,oN,rN,sN,lN,uN,cN,hN,dN,pN,yN,fN,vN,mN,gN,bN,SN,wN,kN,EN,CN,TN,AN,RN,IN,PN,_N,LN,ON,DN,NN,MN,xN,BN,FN,zN,GN,UN,HN=i.ccclass,VN=i.property;GD=HN("EventProgressBar"),UD=VN(xr),HD=VN(u),VD=VN(m),qD=VN({range:[0,1,.01],slide:!0,tooltip:"i18n:progress.progress"}),GD((jD=Ye((KD=function(e){Ie(n,e);var t=xe(n);function n(){var _$e;Ce(this,n);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return je(_$e=t.call.apply(t,[this].concat(a)),"progressBar",jD,Ne(_$e)),je(_$e,"progressLabel",YD,Ne(_$e)),_$e}return Ae(n,[{key:"text",get:function get(){return this.progressLabel.string},set:function set(e){this.progressLabel.string=e}},{key:"progress",get:function get(){return this.progressBar.progress},set:function set(e){this.progressBar.progress=e}},{key:"__preload",value:function value(){}},{key:"onLoad",value:function value(){this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function value(){if(!this.progressBar)throw new Error("EventProgressBar: Missing required component TapperedProgressBar");if(!this.progressLabel)throw new Error("EventProgressBar: Missing required component Label")}}]),n}(y)).prototype,"progressBar",[UD],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),YD=Ye(KD.prototype,"progressLabel",[HD],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ye(KD.prototype,"text",[VD],Object.getOwnPropertyDescriptor(KD.prototype,"text"),KD.prototype),Ye(KD.prototype,"progress",[qD],Object.getOwnPropertyDescriptor(KD.prototype,"progress"),KD.prototype),WD=KD));n._RF.pop(),n._RF.push({},"7741dWPNcdHRqGVvif/L/MP","NavButton",void 0);var qN,WN,KN,jN,YN,XN,JN,QN=i.ccclass,ZN=i.property,$N=i.executeInEditMode,eM=globalThis.game.analytics,tM=GameCore.Plugins.Analytics.Events;QD=QN("NavButton"),ZD=ZN(H),$D=ZN({group:{name:"Animation"},displayName:"Is Selected",tooltip:"This is for the editor only and will be ignored at runtime",editorOnly:!0}),eN=ZN({type:E,group:{name:"Animation"}}),tN=ZN({type:E,group:{name:"Animation"}}),nN=ZN({type:E,group:{name:"Animation"}}),iN=ZN({type:E,group:{name:"Animation"}}),aN=ZN({type:E,group:{name:"Animation"}}),oN=ZN({group:{name:"Animation"}}),rN=ZN({type:E,group:{name:"Animation"}}),sN=ZN({type:E,group:{name:"Animation"}}),lN=ZN({group:{name:"Animation"}}),uN=ZN({type:E,group:{name:"Animation"}}),cN=ZN({type:E,group:{name:"Animation"}}),hN=ZN({type:E,group:{name:"Animation"}}),dN=ZN({type:E,group:{name:"Animation"}}),pN=ZN({type:s}),yN=ZN(a),fN=ZN(x),vN=ZN({type:s}),mN=ZN({type:N(Mn)}),gN=ZN(ZI),QD(bN=$N((wN=Ye((SN=function(e){Ie(o,e);var t,n,i=xe(o);function o(){var _$e;Ce(this,o);for(var t=arguments.length,n=new Array(t),a=0;a<t;a++)n[a]=arguments[a];return je(_$e=i.call.apply(i,[this].concat(n)),"wip",wN,Ne(_$e)),je(_$e,"isSelectedInEditor",kN,Ne(_$e)),je(_$e,"animationDuration",EN,Ne(_$e)),je(_$e,"selectedSpacing",CN,Ne(_$e)),je(_$e,"deselectedSpacing",TN,Ne(_$e)),je(_$e,"selectedIconY",AN,Ne(_$e)),je(_$e,"selectedIconX",RN,Ne(_$e)),je(_$e,"selectedIconScale",IN,Ne(_$e)),je(_$e,"deselectedIconY",PN,Ne(_$e)),je(_$e,"deselectedIconX",_N,Ne(_$e)),je(_$e,"deselectedIconScale",LN,Ne(_$e)),je(_$e,"selectedTextY",ON,Ne(_$e)),je(_$e,"selectedTextX",DN,Ne(_$e)),je(_$e,"deselectedTextY",NN,Ne(_$e)),je(_$e,"deselectedTextX",MN,Ne(_$e)),je(_$e,"spacer",xN,Ne(_$e)),je(_$e,"icon",BN,Ne(_$e)),je(_$e,"text",FN,Ne(_$e)),je(_$e,"uiTransform",zN,Ne(_$e)),je(_$e,"screenType",GN,Ne(_$e)),je(_$e,"navManager",UN,Ne(_$e)),_$e.isSelected=!1,_$e.onMouseEnter=function(t){_$e.isSelected||_$e.playHoverOnAnimation()},_$e.onMouseLeave=function(t){_$e.isSelected||_$e.playHoverOffAnimation()},_$e}return Ae(o,[{key:"isWIP",get:function get(){return this.wip}},{key:"buttonType",get:function get(){return this.screenType}},{key:"update",value:function value(){}},{key:"onEnable",value:function value(){this.node.on(a.EventType.MOUSE_ENTER,this.onMouseEnter),this.node.on(a.EventType.MOUSE_LEAVE,this.onMouseLeave)}},{key:"onDisable",value:function value(){this.node.off(a.EventType.MOUSE_ENTER,this.onMouseEnter),this.node.off(a.EventType.MOUSE_LEAVE,this.onMouseLeave)}},{key:"onEditorUpdate",value:function value(){null!==this.icon&&void 0!==this.icon&&null!==this.text&&void 0!==this.icon&&null!==this.spacer&&void 0!==this.spacer&&(this.isSelectedInEditor?(this.icon.setScale(this.selectedIconScale),this.icon.setPosition(this.selectedIconX,this.selectedIconY,0),this.text.node.setPosition(this.selectedTextX,this.selectedTextY,0),this.spacer.width=this.selectedSpacing,this.text.opacity=255):(this.icon.setScale(this.deselectedIconScale),this.icon.setPosition(this.deselectedIconX,this.deselectedIconY,0),this.text.node.setPosition(this.deselectedTextX,this.deselectedTextY,0),this.spacer.width=this.deselectedSpacing,this.text.opacity=0))}},{key:"setSelected",value:function value(){var _$e,t;this.isSelected||(Pi.playSound(vi.PATCH_SHIFT),this.navManager.selectUsingSceneTransition(this),eM.event(tM.BUTTON_CLICK,{button_name:null!==(_$e=null===(t=this.node.parent)||void 0===t?void 0:t.name)&&void 0!==_$e?_$e:this.node.name,screen_name:Ii.getCurrentPage()}))}},{key:"select",value:(n=Ee(function(){var _$e,_tmp;var _arguments=arguments;return _ts_generator(this,function(_state){switch(_state.label){case 0:_$e=!(_arguments.length>0&&void 0!==_arguments[0])||_arguments[0];if(this.isSelected)throw new Error("NavButton: Already selected");this.isSelected=!0;if(!_$e)return[3,2];return[4,gn.runTweenAsync(this.playSelectAnimation())];case 1:_tmp=_state.sent();return[3,3];case 2:_tmp=(this.icon.setScale(this.selectedIconScale),this.icon.setPosition(this.selectedIconX,this.selectedIconY,0),this.text.node.setPosition(this.selectedTextX,this.selectedTextY,0),this.spacer.width=this.selectedSpacing,this.text.opacity=255);_state.label=3;case 3:_tmp;return[2]}})}),function(){return n.apply(this,arguments)})},{key:"deselect",value:(t=Ee(function(){var _$e,t,_tmp;var _arguments=arguments;return _ts_generator(this,function(_state){switch(_state.label){case 0:_$e=!(_arguments.length>0&&void 0!==_arguments[0])||_arguments[0],t=_arguments.length>1&&void 0!==_arguments[1]&&_arguments[1];if(!this.isSelected&&!t)throw new Error("NavButton: Already deselected");this.isSelected=!1;if(!_$e)return[3,2];return[4,gn.runTweenAsync(this.deselectAnimation())];case 1:_tmp=_state.sent();return[3,3];case 2:_tmp=(this.icon.setScale(this.deselectedIconScale),this.icon.setPosition(this.deselectedIconX,this.deselectedIconY,0),this.text.node.setPosition(this.deselectedTextX,this.deselectedTextY,0),this.spacer.width=this.deselectedSpacing,this.text.opacity=0);_state.label=3;case 3:_tmp;return[2]}})}),function(){return t.apply(this,arguments)})},{key:"getSelectedWorldDistanceX",value:function value(){var _$e=new Y(this.selectedIconX,this.selectedIconY,0),t=new Y(this.deselectedIconX,this.deselectedIconY,0),n=this.node.scale.clone();this.node.scale=this.selectedIconScale;var i=this.uiTransform.convertToWorldSpaceAR(_$e),a=this.uiTransform.convertToWorldSpaceAR(t);return this.node.scale=n,a.x-i.x}},{key:"playHoverOnAnimation",value:function value(){var _$e=k(this.icon);return _$e.to(.1,{scale:this.deselectedIconScale.clone().add3f(.1,.1,0)},{easing:"cubicIn"}),gn.runTweenAsync(_$e)}},{key:"playHoverOffAnimation",value:function value(){var _$e=k(this.icon);return _$e.to(.1,{scale:this.deselectedIconScale},{easing:"cubicOut"}),gn.runTweenAsync(_$e)}},{key:"playSelectAnimation",value:function value(){var _$e=this;return k(this.spacer).to(this.animationDuration,{width:this.selectedSpacing},{easing:"linear",onUpdate:function onUpdate(t,n){if(void 0!==n){var i=M.quintInOut(n),a=M.backOut(n),_$o=M.linear(n),r=n<.5?2*n:1,s=_$e.deselectedIconY+(_$e.selectedIconY-_$e.deselectedIconY)*a,l=_$e.deselectedIconX+(_$e.selectedIconX-_$e.deselectedIconX)*_$o;_$e.icon.setPosition(l,s,0);var u=_$e.deselectedIconScale.clone().lerp(_$e.selectedIconScale,i);_$e.icon.setScale(u.x,u.y,_$e.icon.scale.z);var c=255*r,h=_$e.deselectedTextY+(_$e.selectedTextY-_$e.deselectedTextY)*_$o,d=_$e.deselectedTextX+(_$e.selectedTextX-_$e.deselectedTextX)*_$o;_$e.text.opacity=c,_$e.text.node.setPosition(d,h,0)}}})}},{key:"deselectAnimation",value:function value(){var _$e=this;return k(this.spacer).to(this.animationDuration,{width:this.deselectedSpacing},{easing:"linear",onUpdate:function onUpdate(t,n){if(void 0!==n){var i=ce(_$e.selectedIconY,_$e.deselectedIconY,n),a=ce(_$e.selectedIconX,_$e.deselectedIconX,n);_$e.icon.setPosition(a,i,0);var _$o=ce(255,0,n<.5?2*n:1);_$e.text.opacity=_$o;var r=ce(_$e.selectedTextY,_$e.deselectedTextY,n),s=ce(_$e.selectedTextX,_$e.deselectedTextX,n);_$e.text.node.setPosition(s,r,0);var l=_$e.selectedIconScale.clone().lerp(_$e.deselectedIconScale,M.quintInOut(n));_$e.icon.setScale(l.x,l.y,_$e.icon.scale.z)}}})}},{key:"onLoad",value:function value(){this.uiTransform=this.getComponent(s),this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function value(){St.lazyValidateProperties(this)}}]),o}(y)).prototype,"wip",[ZD],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return!1}}),kN=Ye(SN.prototype,"isSelectedInEditor",[$D],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return!1}}),EN=Ye(SN.prototype,"animationDuration",[eN],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return .3}}),CN=Ye(SN.prototype,"selectedSpacing",[tN],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return 150}}),TN=Ye(SN.prototype,"deselectedSpacing",[nN],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return 88}}),AN=Ye(SN.prototype,"selectedIconY",[iN],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return 20}}),RN=Ye(SN.prototype,"selectedIconX",[aN],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return 0}}),IN=Ye(SN.prototype,"selectedIconScale",[oN],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return new Y(1,1,1)}}),PN=Ye(SN.prototype,"deselectedIconY",[rN],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return 0}}),_N=Ye(SN.prototype,"deselectedIconX",[sN],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return 0}}),LN=Ye(SN.prototype,"deselectedIconScale",[lN],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return new Y(.8,.8,1)}}),ON=Ye(SN.prototype,"selectedTextY",[uN],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return-10}}),DN=Ye(SN.prototype,"selectedTextX",[cN],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return 0}}),NN=Ye(SN.prototype,"deselectedTextY",[hN],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return 0}}),MN=Ye(SN.prototype,"deselectedTextX",[dN],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return 0}}),xN=Ye(SN.prototype,"spacer",[pN],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),BN=Ye(SN.prototype,"icon",[yN],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),FN=Ye(SN.prototype,"text",[fN],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),zN=Ye(SN.prototype,"uiTransform",[vN],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),GN=Ye(SN.prototype,"screenType",[mN],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),UN=Ye(SN.prototype,"navManager",[gN],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),bN=SN))||bN);n._RF.pop(),n._RF.push({},"9b83boaSv9PE6mRFqy0MSI8","GameScene",void 0);var nM,iM,aM,oM,rM,sM,lM,uM,cM,hM,dM,pM,yM,fM,vM,mM=i.ccclass,gM=i.property,bM=i.disallowMultiple,SM=globalThis.game,wM=SM.audio,kM=SM.player,EM=za;qN=mM("GameScene"),WN=gM(eE),KN=gM(tw),qN(jN=bM((XN=Ye((YN=function(e){Ie(n,e);var t=xe(n);function n(){var _$e;Ce(this,n);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return je(_$e=t.call.apply(t,[this].concat(a)),"animSkipOverlay",XN,Ne(_$e)),je(_$e,"coinManager",JN,Ne(_$e)),_$e.handleGameExit=function(){kv.hideBannerAds(),bu.switchScene(kl)},_$e.handleShowResults=function(){bu.switchScene(El)},_$e.handleGameMaskWhenLayoutChanged=function(e){var t=I("Canvas/Game/GameObjects");if(t){var _$n=t.getComponent(he);_$n&&(_$n.enabled=e===EM.Landscape)}},_$e.attemptCallSubscribeBot=function(){"subscribeBotAsync"in GameSDK.extra&&GameSDK.extra.subscribeBotAsync().catch(function(e){console.warn("subscribeBotAsync",e)})},_$e}return Ae(n,[{key:"__preload",value:function value(){this.validateRequiredComponents(),this.listenGameEvents(),kv.showBannerAds()}},{key:"onLoad",value:function value(){this.coinManager.init(this.animSkipOverlay)}},{key:"validateRequiredComponents",value:function value(){St.lazyValidateProperties(this)}},{key:"listenGameEvents",value:function value(){W.on(Ia,this.handleGameMaskWhenLayoutChanged),this.node.scene.on(Co.GAME_EXIT,this.handleGameExit),this.node.scene.on(Co.SHOW_CHALLENGE_RESULTS,this.handleShowResults)}},{key:"start",value:function value(){this.scheduleOnce(this.attemptCallSubscribeBot,.5),kM.getPlayerSetting("music")&&Pi.playMusic(),this.updateVolumeBackgroundMusic(),this.scheduleOnce(this.preloadScenes,2)}},{key:"preloadScenes",value:function value(){bu.preloadDashboardScene()}},{key:"updateVolumeBackgroundMusic",value:function value(){wM.setVolume(1,"global_music")}}]),n}(y)).prototype,"animSkipOverlay",[WN],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),JN=Ye(YN.prototype,"coinManager",[KN],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),jN=YN))||jN);n._RF.pop(),n._RF.push({},"48081huyTZGu5rme4u8PrdR","Item",void 0);var CM,TM,AM,RM,IM,PM,_M,LM=i.ccclass,OM=i.property;nM=LM("ItemButton"),iM=OM(H),aM=OM(d),oM=OM({type:g}),rM=OM(u),sM=OM(a),lM=OM(a),nM((hM=Ye((cM=function(e){Ie(n,e);var t=xe(n);function n(){var _$e;Ce(this,n);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return je(_$e=t.call.apply(t,[this].concat(a)),"isDebug",hM,Ne(_$e)),je(_$e,"button",dM,Ne(_$e)),je(_$e,"quantity",pM,Ne(_$e)),je(_$e,"quantityLabel",yM,Ne(_$e)),je(_$e,"plusNode",fM,Ne(_$e)),je(_$e,"quantityNode",vM,Ne(_$e)),_$e}return Ae(n,[{key:"__preload",value:function value(){this.item=this.getComponent(iv),this.validateRequiredComponents()}},{key:"start",value:function value(){this.quantity=this.item.loadQuantity(),this.quantityLabel.string="".concat(this.quantity),this.validateButton(),this.node.scene.on(Co.GRID_CREATE,this.validateButton,this),this.node.scene.on(Co.GRID_MATCH_SUCCESS,this.validateButton,this),this.node.scene.on(Co.GRID_CLEAR,this.validateButton,this)}},{key:"validateRequiredComponents",value:function value(){if(!this.item)throw new Error("Item: BaseItem component not found");if(!this.button)throw new Error("Item: Button component not found");if(!this.quantityLabel)throw new Error("Item: Quantity label not found");if(!this.plusNode)throw new Error("Item: Plus node not found");if(!this.quantityNode)throw new Error("Item: Quantity node not found")}},{key:"validateButton",value:function value(){var _$e=this;console.log("VALIDATE BUTTON"),this.canActivate().then(function(t){_$e.button.interactable=!0,_$e.plusNode.active=0==_$e.quantity,_$e.quantityNode.active=_$e.quantity>0})}},{key:"activate",value:function value(){var _$e=this;return new Promise(function(t){if(_$e.quantity<=0)return _$e.handleShowAddItemScreen(),void t();_$e.item.activate().then(function(){_$e.isDebug||(_$e.quantity--,_$e.quantityLabel.string="".concat(_$e.quantity),_$e.item.saveQuantity()),_$e.validateButton(),t()})})}},{key:"canActivate",value:function value(){return Promise.resolve(!0)}},{key:"addQuantity",value:function value(e){this.quantity+=e,this.quantityLabel.string="".concat(this.quantity),this.item.saveQuantity(),this.validateButton()}},{key:"clearQuantity",value:function value(){this.quantity=0,this.quantityLabel.string="".concat(this.quantity),this.item.saveQuantity(),this.validateButton()}},{key:"handleShowAddItemScreen",value:function value(){Mu.openScreen(ki.GET_ITEM_SCREEN,{item:tl.HINT,quantity:1})}}]),n}(y)).prototype,"isDebug",[iM],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return!1}}),dM=Ye(cM.prototype,"button",[aM],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),pM=Ye(cM.prototype,"quantity",[oM],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return 0}}),yM=Ye(cM.prototype,"quantityLabel",[rM],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),fM=Ye(cM.prototype,"plusNode",[sM],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),vM=Ye(cM.prototype,"quantityNode",[lM],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),uM=cM));n._RF.pop(),n._RF.push({},"0c0b4cnFOFJ6pJmGNHnMo7m","ComboEffect",void 0);var DM,NM,MM,xM,BM,FM,zM,GM=i.ccclass,UM=i.property;CM=GM("ComboEffect"),TM=UM(x),AM=UM(oe),CM((PM=Ye((IM=function(e){Ie(n,e);var t=xe(n);function n(){var _$e;Ce(this,n);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return je(_$e=t.call.apply(t,[this].concat(a)),"circleOpacity",PM,Ne(_$e)),je(_$e,"particle",_M,Ne(_$e)),_$e}return Ae(n,[{key:"onLoad",value:function value(){this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function value(){if(!this.circleOpacity)throw new Error("ComboEffect requires a circleOpacity component");if(!this.particle)throw new Error("ComboEffect requires a particle component")}},{key:"start",value:function value(){this.node.scene.on(Co.COMBO_UPDATED,this.handleOnComboUpdated,this)}},{key:"handleOnComboUpdated",value:function value(e){e>1&&(this.circleOpacity.node.scale=Y.ZERO,this.circleOpacity.opacity=127.5,this.particle.resetSystem(),k(this.circleOpacity.node).to(.2,{scale:new Y(1.3,1.3,1.3)},{easing:"quadOut"}).start(),k(this.circleOpacity).delay(.2).to(.2,{opacity:0},{easing:"expoIn"}).start())}}]),n}(y)).prototype,"circleOpacity",[TM],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_M=Ye(IM.prototype,"particle",[AM],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),RM=IM));n._RF.pop(),n._RF.push({},"0506aJZ1EdPqJejQ2PpB980","ComboLabel",void 0);var HM,VM,qM,WM,KM,jM,YM,XM,JM,QM=i.ccclass,ZM=i.property;DM=QM("ComboLabel"),NM=ZM(u),MM=ZM(a),DM((FM=Ye((BM=function(e){Ie(n,e);var t=xe(n);function n(){var _$e;Ce(this,n);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return je(_$e=t.call.apply(t,[this].concat(a)),"comboNumber",FM,Ne(_$e)),je(_$e,"comboContainer",zM,Ne(_$e)),_$e}return Ae(n,[{key:"onLoad",value:function value(){this.opacity=this.getComponent(x),this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function value(){St.lazyValidateProperties(this)}},{key:"start",value:function value(){this.node.scene.on(Co.COMBO_UPDATED,this.handleOnComboUpdated,this)}},{key:"handleOnComboUpdated",value:function value(e){0===e?this.opacity.opacity=0:e>1?(this.opacity.opacity=255,this.comboNumber.string="".concat(e),k(this.comboContainer).to(.1,{scale:new Y(1.3,1.3,1.3)},{easing:"sineIn"}).to(.1,{scale:Y.ONE},{easing:"sineOut"}).start()):this.opacity.opacity=0}}]),n}(y)).prototype,"comboNumber",[NM],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),zM=Ye(BM.prototype,"comboContainer",[MM],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),xM=BM));n._RF.pop(),n._RF.push({},"51871oF8CFOkp81rgCf90UQ","ComboPopup",void 0);var $M,ex,tx,nx,ix,ax,ox,rx,sx,lx=i.ccclass,ux=i.property;HM=lx("ComboPopup"),VM=ux(A),qM=ux(D),WM=ux(v),HM((YM=Ye((jM=function(e){Ie(n,e);var t=xe(n);function n(){var _$e;Ce(this,n);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return je(_$e=t.call.apply(t,[this].concat(a)),"textSprite",YM,Ne(_$e)),je(_$e,"comboSprites",XM,Ne(_$e)),je(_$e,"animation",JM,Ne(_$e)),_$e}return Ae(n,[{key:"onLoad",value:function value(){this.validateRequiredComponents()}},{key:"start",value:function value(){this.node.scene.on(Co.COMBO_UPDATED,this.handleOnComboUpdated,this)}},{key:"validateRequiredComponents",value:function value(){if(!this.textSprite)throw new Error("ComboPopup: textSprite not found");if(0===this.comboSprites.length)throw new Error("ComboPopup: comboSprites not found");if(!this.animation)throw new Error("ComboPopup: animation not found")}},{key:"handleOnComboUpdated",value:function value(e){if(!(e<2)){for(var t=this.comboSprites.length-1;t>=0;t--)if(e>=t+2){this.textSprite.spriteFrame=this.comboSprites[t],this.animation.play();break}}}}]),n}(y)).prototype,"textSprite",[VM],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),XM=Ye(jM.prototype,"comboSprites",[qM],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return[]}}),JM=Ye(jM.prototype,"animation",[WM],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),KM=jM));n._RF.pop(),n._RF.push({},"a0819yK3HpO2505QqLUOChz","PlayerScore",void 0);var cx,hx,dx,px,yx,fx,vx,mx,gx,bx,Sx,wx,kx,Ex,Cx,Tx=i.ccclass,Ax=i.property,Rx=GameCore.Utils.Image,Ix=($M=Tx("PlayerScore"),ex=Ax(a),tx=Ax(u),nx=Ax(A),$M((ox=Ye((ax=function(e){Ie(i,e);var t,n=xe(i);function i(){var _$e;Ce(this,i);for(var t=arguments.length,a=new Array(t),o=0;o<t;o++)a[o]=arguments[o];return je(_$e=n.call.apply(n,[this].concat(a)),"crown",ox,Ne(_$e)),je(_$e,"playerScore",rx,Ne(_$e)),je(_$e,"avatar",sx,Ne(_$e)),_$e}return Ae(i,[{key:"showCrown",value:function value(e){this.crown.active=e}},{key:"setPlayerScore",value:function value(e){this.playerScore.string=e.toString()}},{key:"playWaitingAnimation",value:function value(){var _$e=this,t=0;this.playerScore.schedule(function(){t=(t+1)%4;var n=Array(t+1).join(".");_$e.playerScore.string="Waiting"+n},.5);var n=this.playerScore.getComponent(x),_$i=k(n).to(1,{opacity:130},{easing:"sineInOut"}).to(1,{opacity:255},{easing:"sineInOut"}).delay(.25);this.waitingAnimation=k(n).repeatForever(_$i).start()}},{key:"stopWaitingAnimation",value:function value(){this.playerScore.unscheduleAllCallbacks(),this.waitingAnimation&&this.waitingAnimation.stop(),this.playerScore.getComponent(x).opacity=255}},{key:"loadPhoto",value:(t=Ee(function(e){var t,n,e1;return _ts_generator(this,function(_state){switch(_state.label){case 0:_state.trys.push([0,2,,3]);return[4,Rx.loadImage(e)];case 1:t=_state.sent();if(!t)throw new Error("Failed to load image");n=D.createWithImage(t);if(!n)throw new Error("Failed to create sprite frame");n.packable=!0,this.avatar.spriteFrame=n;return[3,3];case 2:e1=_state.sent();return[2,void console.error(e1)];case 3:return[2]}})}),function(e){return t.apply(this,arguments)})}]),i}(y)).prototype,"crown",[ex],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),rx=Ye(ax.prototype,"playerScore",[tx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),sx=Ye(ax.prototype,"avatar",[nx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ix=ax))||ix);n._RF.pop(),n._RF.push({},"4b062RYQK5PQbgs7yH66gDw","ChallengeResultScene",void 0);var Px,_x,Lx,Ox,Dx,Nx,Mx,xx,Bx,Fx=i.ccclass,zx=i.disallowMultiple,Gx=i.property,Ux=globalThis.game,Hx=Ux.match,Vx=Ux.player,qx=Ux.monitorError,Wx="Waiting",Kx=GameCore.Dtos.Match.Data;cx=Fx("ChallengeResultScene"),hx=Gx(g),dx=Gx({type:Ix,group:"Score"}),px=Gx({type:Ix,group:"Score"}),yx=Gx(ok),fx=Gx(u),vx=Gx(hv),cx(mx=zx((bx=Ye((gx=function(e){Ie(i,e);var t,n=xe(i);function i(){var _$e;Ce(this,i);for(var t=arguments.length,a=new Array(t),o=0;o<t;o++)a[o]=arguments[o];return je(_$e=n.call.apply(n,[this].concat(a)),"pollingInterval",bx,Ne(_$e)),je(_$e,"playerScore",Sx,Ne(_$e)),je(_$e,"opponentScore",wx,Ne(_$e)),je(_$e,"paperConfetti",kx,Ne(_$e)),je(_$e,"titleText",Ex,Ne(_$e)),je(_$e,"levelManager",Cx,Ne(_$e)),_$e.goToDashboardScene=function(){kv.hideBannerAds(),bu.switchScene(kl)},_$e.pollMatchState=Ee(function(){var _$t,n,_$i,a,o,r,s,l,u,c,h,d,p,y,f,v,m,t;return _ts_generator(this,function(_state){switch(_state.label){case 0:_state.trys.push([0,2,,3]);_$t=Hx.getMatchState().id;if(null===_$t)throw new Error("Match id is not found");n=Vx.getPlayerId(),_$i=Date.now();return[4,Hx.api.getMatchAPI().getMatchDetailByIdAsync(_$t)];case 1:a=_state.sent(),o=Date.now(),r=Math.max(0,o-_$i,_$e.pollingInterval),s=new Kx(a).toObject(),l=s.blackPlayerId,u=s.blackPlayerScore,c=s.whitePlayerScore,h=s.blackPlayerFinish,d=s.whitePlayerFinish,p=n===l?u:c,y=n===l?c:u,f=n===l?h:d,v=n===l?d:h,m=h&&d;if(_$e.playerScore.setPlayerScore(p),_$e.opponentScore.setPlayerScore(y),_$e.playerScore.showCrown(m&&p>y),_$e.opponentScore.showCrown(m&&y>p),_$e.stopWaitingAnimation(),_$e.playerScore.stopWaitingAnimation(),_$e.opponentScore.stopWaitingAnimation(),m)if(p===y)_$e.titleText.string="Draw";else if(p>y)_$e.titleText.string="You Win";else{if(!(p<y))return[2];_$e.titleText.string="You Lose"}else _$e.titleText.string=Wx,_$e.playWaitingAnimation(),f||_$e.playerScore.playWaitingAnimation(),v||_$e.opponentScore.playWaitingAnimation();_$e.scheduleOnce(_$e.pollMatchState,r);return[3,3];case 2:t=_state.sent();console.warn("ResultScene: Error on pollMatchState",t),_$e.scheduleOnce(_$e.pollMatchState,_$e.pollingInterval);return[3,3];case 3:return[2]}})}),_$e}return Ae(i,[{key:"__preload",value:function value(){this.validateRequiredComponents(),this.listenEvents(),kv.showBannerAds()}},{key:"validateRequiredComponents",value:function value(){St.lazyValidateProperties(this)}},{key:"onLoad",value:function value(){try{var _$e=Hx.getMatchState(),t=_$e.customData,n=t.playerId,_$i=t.opponentId;if(null===n||null===_$i)throw new Error("ResultScene: playerId is ".concat(n," and opponentId is ").concat(_$i,". Expected to not be null."));var a=Vx.getPlayer().photo,o=_$e.profiles[n],r=o.score,s=void 0===r?0:r,l=o.finished,u=void 0!==l&&l,c=_$e.profiles[_$i],h=c.photo,d=c.score,p=void 0===d?0:d,y=c.finished,f=void 0!==y&&y,v=u&&f,m=v&&s>p,g=v&&p>s;this.playerScore.loadPhoto(a),this.opponentScore.loadPhoto(h),this.playerScore.setPlayerScore(s),this.opponentScore.setPlayerScore(p),this.playerScore.showCrown(m),this.opponentScore.showCrown(g),u&&f?s===p?this.titleText.string="Draw":m?this.titleText.string="You Win":g&&(this.titleText.string="You Lose"):(this.titleText.string=Wx,this.playWaitingAnimation(),u||this.playerScore.playWaitingAnimation(),f||this.opponentScore.playWaitingAnimation())}catch(e){console.warn("ResultScene: Error on load",e),this.goToDashboardScene()}}},{key:"listenEvents",value:function value(){this.node.scene.on(Da,this.goToDashboardScene),this.node.scene.on(Oa,this.onReplayButtonPressed,this)}},{key:"start",value:function value(){var _$e=this;this.scheduleOnce(this.pollMatchState,this.pollingInterval),this.scheduleOnce(function(){_$e.paperConfetti.runEffect()},.2)}},{key:"onDestroy",value:function value(){this.unschedule(this.pollMatchState)}},{key:"onReplayButtonPressed",value:(t=Ee(function(){var _$e,t,n,_$i,a,o,r,s,l,u,c,h,d,e;return _ts_generator(this,function(_state){switch(_state.label){case 0:t=(null!==(_$e=Vx.getGameData())&&void 0!==_$e?_$e:{}).level,n=void 0===t?1:t;n=Math.max(1,n);return[4,this.levelManager.loadLevelData(n)];case 1:_$i=_state.sent();_state.label=2;case 2:_state.trys.push([2,4,,5]);if(!_$i)throw new Error("Level data is not found");a=Hx.getMatchState().customData.opponentId;if(!a)throw new Error("Opponent id is not found");Mu.showLoadingScreen();o=Qh.generateFen(_$i),r=_$i.mode,s=void 0===r?"":r,l=_$i.rules,u=void 0===l?{addRandomTilesPerMove:0,maxSpaceOfPair:0}:l,c=_$i.time,h=void 0===c?0:c,d=_$i.level;return[4,Hx.challenge.friend.processAsync({playerId:Vx.getPlayerId(),opponentId:a,extraData:{level:d,fen:o,gravity:s,rules:u,time:h}})];case 3:_state.sent(),Mu.closeLoadingScreen(),this.goToGameScene();return[3,5];case 4:e=_state.sent();console.warn("ReplayChallengeFriend",e),Mu.closeLoadingScreen(),Mu.showNotificationScreen("Sorry, you cannot replay\nat this time.",2),null==qx||qx.sendException(_instanceof(e,Error)?e:new Error("ReplayChallengeFriend"+JSON.stringify(e))),this.scheduleOnce(this.goToDashboardScene,2);return[3,5];case 5:return[2]}})}),function(){return t.apply(this,arguments)})},{key:"onHomeButtonPressed",value:function value(){this.goToDashboardScene()}},{key:"goToGameScene",value:function value(){bu.switchScene(wl)}},{key:"playWaitingAnimation",value:function value(){var _$e=this,t=0;this.titleText.schedule(function(){t=(t+1)%4;var n=Array(t+1).join(".");_$e.titleText.string=Wx+n},.5);var n=this.titleText.getComponent(x),_$i=k(n).to(1,{opacity:130},{easing:"sineInOut"}).to(1,{opacity:255},{easing:"sineInOut"}).delay(.25);this.waitingAnimation=k(n).repeatForever(_$i).start()}},{key:"stopWaitingAnimation",value:function value(){this.titleText.unscheduleAllCallbacks(),this.waitingAnimation&&this.waitingAnimation.stop(),this.titleText.getComponent(x).opacity=255}}]),i}(y)).prototype,"pollingInterval",[hx],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return 15}}),Sx=Ye(gx.prototype,"playerScore",[dx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wx=Ye(gx.prototype,"opponentScore",[px],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),kx=Ye(gx.prototype,"paperConfetti",[yx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ex=Ye(gx.prototype,"titleText",[fx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Cx=Ye(gx.prototype,"levelManager",[vx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),mx=gx))||mx);n._RF.pop(),n._RF.push({},"acb0egHPppFmYJalVNrDDv/","BaseScreen",void 0);var jx,Yx=i.ccclass,Xx=i.property,Jx=i.disallowMultiple,Qx=GameCore.Events,Zx=globalThis.game.event,$x=(Px=Yx("BaseScreen"),_x=Xx(a),Lx=Xx(a),Ox=Xx(x),Px(Dx=Jx((Mx=Ye((Nx=function(e){Ie(n,e);var t=xe(n);function n(){var _$e;Ce(this,n);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return je(_$e=t.call.apply(t,[this].concat(a)),"container",Mx,Ne(_$e)),je(_$e,"backgroundMask",xx,Ne(_$e)),je(_$e,"screenOpacity",Bx,Ne(_$e)),_$e.data={},_$e}return Ae(n,[{key:"__preload",value:function value(){this.animation=this.getComponent(v),this.validateRequiredComponents(),this.initializeNodes()}},{key:"initializeNodes",value:function value(){var _$e=this.getMaskOpacity(),t=this.getContainerOpacity();_$e&&t&&(_$e.opacity=0,t.opacity=0)}},{key:"validateRequiredComponents",value:function value(){St.lazyValidateProperties(this)}},{key:"setScreenOpacity",value:function value(e){this.screenOpacity.opacity=e}},{key:"open",value:function value(e){e&&(this.data=e),this.show(),this.runAnimation("OpenScreen")}},{key:"close",value:function value(){var _$e=this;this.node.active&&(this.animation.once(v.EventType.FINISHED,function(){Zx.emit(Qx.CLOSED_SCREEN,{screenName:_$e.node.name}),_$e.hide()}),this.runAnimation("CloseScreen"))}},{key:"runAnimation",value:function value(e){if(!this.isAnimationExist(e))throw new Error("".concat(this.node.name,": Animation component must have ").concat(e," clip"));this.animation.play(e)}},{key:"isAnimationExist",value:function value(e){return this.animation.clips.some(function(t){return!(!t||t.name!==e)})}},{key:"getMaskOpacity",value:function value(){var _$e=this.backgroundMask.getComponent(x);return _$e||(console.warn("BaseScreen: maskOpacity not found"),null)}},{key:"getContainerOpacity",value:function value(){var _$e=this.container.getComponent(x);return _$e||(console.warn("BaseScreen: containerOpacity not found"),null)}},{key:"show",value:function value(){this.setScreenOpacity(255);var _$e=this.node.getComponent(C);_$e&&(_$e.enabled=!0,_$e.updateAlignment(),this.node.getComponentsInChildren(C).forEach(function(e){e.updateAlignment()}))}},{key:"hide",value:function value(){this.setScreenOpacity(0),this.node.setWorldPosition(new Y(-1e3,-1e3,0));var _$e=this.node.getComponent(C);_$e&&(_$e.enabled=!1)}}]),n}(y)).prototype,"container",[_x],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),xx=Ye(Nx.prototype,"backgroundMask",[Lx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Bx=Ye(Nx.prototype,"screenOpacity",[Ox],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Dx=Nx))||Dx)||Dx);n._RF.pop(),n._RF.push({},"f3521L4Mn5I3bhxr0QZJ9y9","BackgroundMask",void 0);var eB,tB,nB,iB,aB,oB=i.ccclass,rB=i.requireComponent;oB("BackgroundMask")(jx=rB([x])(jx=function(e){Ie(n,e);var t=xe(n);function n(){return Ce(this,n),t.apply(this,arguments)}return Ae(n,[{key:"onLoad",value:function value(){var _$e=this.getComponent(x);_$e?(this.opacity=_$e,this.updateMaskAlpha()):console.warn("BackgroundMask: UIOpacity not found")}},{key:"updateMaskAlpha",value:function value(){var _$e,t,_$n=this.opacity.opacity/255;_$e=_$n,(t=document.getElementById("app-mask"))&&(t.style.background="rgb(0 0 0 / ".concat(_$e,")"))}}]),n}(y))||jx);n._RF.pop(),n._RF.push({},"d25c5ZVzYVC/YcfG5prmRdB","Screens",void 0);var sB,lB,uB,cB,hB,dB,pB,yB,fB,vB,mB,gB,bB,SB,wB=i.ccclass,kB=i.property,EB=(eB=wB("Screens"),tB=kB({type:N(ki)}),eB((aB=Ye((iB=function(e){Ie(n,e);var t=xe(n);function n(){var _$e;Ce(this,n);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return je(_$e=t.call.apply(t,[this].concat(a)),"screenKeys",aB,Ne(_$e)),_$e}return Ae(n)}(y)).prototype,"screenKeys",[tB],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return[]}}),nB=iB))||nB);n._RF.pop(),n._RF.push({},"cecf2nUBzhIWZw7uJgVliXz","CongratulationScreen",void 0);var CB,TB,AB,RB,IB,PB,_B,LB,OB,DB,NB,MB,xB,BB,FB,zB,GB,UB,HB,VB,qB,WB=i.ccclass,KB=i.property,jB=i.disallowMultiple,YB=i.requireComponent,XB=GameCore.Events,JB=globalThis.game.event;sB=WB("CongratulationScreen"),lB=YB($x),uB=KB(a),cB=KB(a),hB=KB(d),dB=KB(d),pB=KB(d),sB(yB=jB(yB=lB((vB=Ye((fB=function(e){Ie(n,e);var t=xe(n);function n(){var _$e;Ce(this,n);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return je(_$e=t.call.apply(t,[this].concat(a)),"congratulation",vB,Ne(_$e)),je(_$e,"confirmation",mB,Ne(_$e)),je(_$e,"closeButtonComponent",gB,Ne(_$e)),je(_$e,"yesButtonComponent",bB,Ne(_$e)),je(_$e,"noButtonComponent",SB,Ne(_$e)),_$e.handleOpeningScreen=function(t){if(!_$e.screen)throw new Error("CongratulationScreen: screen not found");_$e.validateEventPayload(t)&&(_$e.closeButtonComponent.interactable=!0,_$e.yesButtonComponent.interactable=!0,_$e.noButtonComponent.interactable=!0)},_$e.handleOpenedScreen=function(t){_$e.validateEventPayload(t)&&_$e.open()},_$e}return Ae(n,[{key:"__preload",value:function value(){this.enabled=!1,this.screen=this.getComponent($x),this.confirmationUIOpacity=this.confirmation.getComponent(x),this.validateRequiredComponents(),this.listenScreenEvents()}},{key:"onDestroy",value:function value(){this.unListenScreenEvents()}},{key:"validateRequiredComponents",value:function value(){St.lazyValidateProperties(this)}},{key:"listenScreenEvents",value:function value(){JB.on(XB.OPENING_SCREEN,this.handleOpeningScreen),JB.on(XB.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"unListenScreenEvents",value:function value(){JB.off(XB.OPENING_SCREEN,this.handleOpeningScreen),JB.off(XB.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"validateEventPayload",value:function value(e){return e.screenName===this.node.name}},{key:"open",value:function value(){this.confirmation.active=!1,this.congratulation.active=!0}},{key:"close",value:function value(){this.closeButtonComponent.interactable=!1,this.yesButtonComponent.interactable=!1,this.noButtonComponent.interactable=!1,Mu.closeScreen(Ci[this.node.name])}},{key:"handleStartOver",value:function value(){this.confirmation.active=!0,this.congratulation.active=!1,k(this.confirmationUIOpacity).set({opacity:0}).to(.2,{opacity:255}).start(),k(this.confirmation).set({scale:new Y(.8,.8,.8)}).to(.2,{scale:new Y(1,1,1)},{easing:"backOut"}).start()}},{key:"handleYesStartOver",value:function value(){this.close(),this.node.scene.emit(Co.START_OVER)}},{key:"handleNoStartOver",value:function value(){this.requestGameReplay()}},{key:"handleClickedClose",value:function value(){this.requestGameReplay()}},{key:"requestGameReplay",value:function value(){this.close(),this.node.scene.emit(Co.GAME_REPLAY,{level:this.screen.data.level})}}]),n}(y)).prototype,"congratulation",[uB],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),mB=Ye(fB.prototype,"confirmation",[cB],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),gB=Ye(fB.prototype,"closeButtonComponent",[hB],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),bB=Ye(fB.prototype,"yesButtonComponent",[dB],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),SB=Ye(fB.prototype,"noButtonComponent",[pB],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),yB=fB))||yB)||yB);n._RF.pop(),n._RF.push({},"01c067hcjNDc7prJzSE6UEq","DayBlock",void 0);var QB,ZB,$B,eF,tF,nF,iF,aF,oF,rF,sF=i.ccclass,lF=i.property,uF=(CB=sF("DayBlock"),TB=lF({type:A,group:"Background"}),AB=lF({type:A,group:"Background"}),RB=lF({type:D,group:"Background"}),IB=lF({type:D,group:"Background"}),PB=lF(u),_B=lF(u),LB=lF(a),OB=lF(a),DB=lF(a),CB((xB=Ye((MB=function(e){Ie(n,e);var t=xe(n);function n(){var _$e;Ce(this,n);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return je(_$e=t.call.apply(t,[this].concat(a)),"background",xB,Ne(_$e)),je(_$e,"topBackground",BB,Ne(_$e)),je(_$e,"blueBackground",FB,Ne(_$e)),je(_$e,"blueTopBackground",zB,Ne(_$e)),je(_$e,"dayLabel",GB,Ne(_$e)),je(_$e,"coinLabel",UB,Ne(_$e)),je(_$e,"rewardItemsNode",HB,Ne(_$e)),je(_$e,"checkNode",VB,Ne(_$e)),je(_$e,"glowNodes",qB,Ne(_$e)),_$e}return Ae(n,[{key:"onLoad",value:function value(){this.uiOpacity=this.getComponent(x),this.initDefaultProperties(),this.validateRequiredComponents()}},{key:"initDefaultProperties",value:function value(){this.defaultBackground=this.background.spriteFrame,this.defaultTopBackground=this.topBackground.spriteFrame,this.defaultDayLabelOutlineColor=new o(this.dayLabel.outlineColor),this.blueDayLabelOutlineColor=new o("#3469bf")}},{key:"validateRequiredComponents",value:function value(){St.lazyValidateProperties(this)}},{key:"updateInfo",value:function value(e){this.updateBackground(e),this.updateDayLabel(e),this.coinLabel.string=e.value.toString(),this.updateRewardItems(e)}},{key:"updateBackground",value:function value(e){if(this.blueTopBackground&&this.blueBackground)switch(e.status){case"ready":this.background.spriteFrame=this.blueBackground,this.topBackground.spriteFrame=this.blueTopBackground;break;case"waiting":this.background.spriteFrame=this.defaultBackground,this.topBackground.spriteFrame=this.blueTopBackground;break;case"rewarded":this.background.spriteFrame=this.defaultBackground,this.topBackground.spriteFrame=this.defaultTopBackground}}},{key:"updateDayLabel",value:function value(e){this.dayLabel.string="Day ".concat(e.day.toString());var t=this.defaultDayLabelOutlineColor;"rewarded"!==e.status&&(t=this.blueDayLabelOutlineColor),this.dayLabel.outlineColor=t,this.dayLabel.shadowColor=t}},{key:"updateRewardItems",value:function value(e){switch(e.status){case"ready":this.rewardItemsNode.active=!0,this.checkNode.active=!1,this.setGlowNodesActive(!0);break;case"waiting":this.rewardItemsNode.active=!0,this.checkNode.active=!1,this.setGlowNodesActive(!1);break;case"rewarded":this.rewardItemsNode.active=!1,this.checkNode.active=!0,this.setGlowNodesActive(!1)}}},{key:"setGlowNodesActive",value:function value(e){this.glowNodes&&this.glowNodes.forEach(function(t){t.active=e})}}]),n}(y)).prototype,"background",[TB],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),BB=Ye(MB.prototype,"topBackground",[AB],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),FB=Ye(MB.prototype,"blueBackground",[RB],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),zB=Ye(MB.prototype,"blueTopBackground",[IB],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),GB=Ye(MB.prototype,"dayLabel",[PB],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),UB=Ye(MB.prototype,"coinLabel",[_B],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),HB=Ye(MB.prototype,"rewardItemsNode",[LB],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),VB=Ye(MB.prototype,"checkNode",[OB],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),qB=Ye(MB.prototype,"glowNodes",[DB],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return[]}}),NB=MB))||NB);n._RF.pop(),n._RF.push({},"cc662r8eR5Al6FdOBdcAkHG","DailyRewardsScreen",void 0);var cF,hF=i.ccclass,dF=i.property,pF=i.requireComponent,yF=GameCore,fF=yF.Events,vF=yF.Utils,mF=vF.Object,gF=vF.Array,bF=yF.Configs.DailyRewards,SF=globalThis.game,wF=SF.event,kF=SF.dailyRewards,EF=SF.player,CF=SF.monitorError;QB=hF("DailyRewardsScreen"),ZB=pF($x),$B=dF(d),eF=dF(d),tF=dF([uF]),QB(nF=ZB((aF=Ye((iF=function(e){Ie(s,e);var t,n,i,a,o,r=xe(s);function s(){var _$e;Ce(this,s);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return(_$e=r.call.apply(r,[this].concat(n))).rewardsData=[],_$e.debugScreenOpened=!1,_$e.debugUpdatedRewardsData=!1,je(_$e,"claimButton",aF,Ne(_$e)),je(_$e,"claimX2Button",oF,Ne(_$e)),je(_$e,"dailyBlocks",rF,Ne(_$e)),_$e.handleOpeningScreen=function(t){_$e.validateEventPayload(t)},_$e.handleOpenedScreen=function(){var t=Ee(function(t){var _tmp;return _ts_generator(this,function(_state){switch(_state.label){case 0:_tmp=_$e.validateEventPayload(t);if(!_tmp)return[3,2];_$e.setInteractableButtons(!1);return[4,_$e.open()];case 1:_tmp=(_state.sent(),_$e.setInteractableButtons(!0));_state.label=2;case 2:_tmp;return[2]}})});return function(e){return t.apply(this,arguments)}}(),_$e}return Ae(s,[{key:"__preload",value:function value(){this.enabled=!1,this.screen=this.getComponent($x),this.validateRequiredComponents(),this.listenScreenEvents()}},{key:"onDestroy",value:function value(){this.unListenScreenEvents()}},{key:"validateRequiredComponents",value:function value(){St.lazyValidateProperties(this)}},{key:"listenScreenEvents",value:function value(){wF.on(fF.OPENING_SCREEN,this.handleOpeningScreen),wF.on(fF.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"unListenScreenEvents",value:function value(){wF.off(fF.OPENING_SCREEN,this.handleOpeningScreen),wF.off(fF.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"validateEventPayload",value:function value(e){return(null!=e?e:{}).screenName===this.node.name}},{key:"open",value:(o=Ee(function(){return _ts_generator(this,function(_state){switch(_state.label){case 0:this.debugScreenOpened=!0,this.node.scene.emit(Co.HIDE_UI),this.resetState();return[4,this.updateRewardsData()];case 1:_state.sent(),this.loginDailyRewards(),this.updateDayBlocks();return[4,this.runPopUpAnimation()];case 2:_state.sent();return[2]}})}),function(){return o.apply(this,arguments)})},{key:"close",value:function value(){wF.emit(fF.CLOSE_SCREEN,{screenName:this.node.name}),this.node.scene.emit(Co.SHOW_UI)}},{key:"resetState",value:function value(){this.dailyBlocks.forEach(function(e){e.uiOpacity.opacity=0,e.node.scale=new Y(1.2,1.2,1.2)})}},{key:"runPopUpAnimation",value:(a=Ee(function(){var _$e;return _ts_generator(this,function(_state){switch(_state.label){case 0:_$e=this;this.screen.container||console.warn("DailyRewardScreen: screen not found");return[4,Promise.all(this.dailyBlocks.map(function(t,n){return _$e.runAppearTween(t,.15*n)}))];case 1:_state.sent();return[2]}})}),function(){return a.apply(this,arguments)})},{key:"runAppearTween",value:(i=Ee(function(e,t){var n,i;return _ts_generator(this,function(_state){switch(_state.label){case 0:n=k(e.uiOpacity).delay(t).to(.3,{opacity:255},{easing:"quadOut"}),i=k(e.node).delay(t).to(.3,{scale:Y.ONE},{easing:"backOut"});return[4,Promise.all([gn.runTweenAsync(n),gn.runTweenAsync(i)])];case 1:_state.sent();return[2]}})}),function(e,t){return i.apply(this,arguments)})},{key:"handleOnClaim",value:function value(){var _$e=this.getCurrentRewardData();if(!_$e)return null==CF||CF.sendException(new Error("DailyRewardsScreen: rewardData not found"),{nodeIsActive:this.node.activeInHierarchy,nodeHasParent:null!==this.node.parent&&void 0!==this.node.parent,hasLoadedRewardsData:this.debugUpdatedRewardsData,hasOpenedScreen:this.debugScreenOpened}),void Mu.showNotificationScreen("Unable to validate rewards. Please try again later...",2);this.claimReward(_$e)}},{key:"handleOnClaimX2",value:(n=Ee(function(){var _$e;return _ts_generator(this,function(_state){switch(_state.label){case 0:_$e=this.getCurrentRewardData();if(!_$e)return[2,(null==CF||CF.sendException(new Error("DailyRewardsScreen: rewardData not found"),{nodeIsActive:this.node.activeInHierarchy,nodeHasParent:null!==this.node.parent&&void 0!==this.node.parent,hasLoadedRewardsData:this.debugUpdatedRewardsData,hasOpenedScreen:this.debugScreenOpened}),void Mu.showNotificationScreen("Unable to validate rewards. Please try again later...",2))];return[4,kv.showRewardVideoAdAsync({})];case 1:_state.sent()&&this.claimReward(_$e,!0);return[2]}})}),function(){return n.apply(this,arguments)})},{key:"getCurrentRewardData",value:function value(){return gF.search(this.rewardsData,function(e){return"ready"===e.status})}},{key:"claimReward",value:function value(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=e.value*(t?2:1),i=new Bn;if(this.node.scene.emit(Co.ADD_COINS,{coins:n,collectionAnimation:{animateTextOnly:!1,signal:i}}),e.items){var a=e.items.hint*(t?2:1),o=e.items.thunder*(t?2:1),r=e.items.storm*(t?2:1),_$s=EF.getGameData();_$s?(EF.setGameData({items:{hint:_$s.items.hint+a,thunder:_$s.items.thunder+o,storm:_$s.items.storm+r,pliers:_$s.items.pliers}}),this.close()):this.close()}else this.close()}},{key:"updateRewardsData",value:(t=Ee(function(){var _$e,t;return _ts_generator(this,function(_state){switch(_state.label){case 0:return[4,kF.requestDailyRewardsAsync()];case 1:_state.sent();for(_$e=we({},kF.getDailyRewards()),t=0;t<bF.MaxDays;t++)_$e[t]=we(we({},_$e[t]),{},{value:ll[t].value,items:ll[t].items});_$e&&(this.rewardsData=mF.vals(_$e),this.debugUpdatedRewardsData=!0,console.log("DailyRewardsScreen: rewardsData",this.rewardsData));return[2]}})}),function(){return t.apply(this,arguments)})},{key:"loginDailyRewards",value:function value(){kF.logLoginReward()}},{key:"updateDayBlocks",value:function value(){var _$e=this;this.dailyBlocks.length>this.rewardsData.length&&(console.warn("DailyRewardsScreen: dailyBlocks not enough"),null==CF||CF.sendException(new Error("DailyRewardsScreen: dailyBlocks not enough"),{dailyBlocksCount:this.dailyBlocks.length,rewardsDataCount:this.rewardsData.length,nodeIsActive:this.node.activeInHierarchy,nodeHasParent:null!==this.node.parent&&void 0!==this.node.parent,hasLoadedRewardsData:this.debugUpdatedRewardsData,hasOpenedScreen:this.debugScreenOpened})),this.dailyBlocks.forEach(function(t,n){if(!(n>=_$e.rewardsData.length)){var i=_$e.rewardsData[n],a=i.id,o=i.type,r=i.value,_$s=i.status;t.updateInfo({day:a,type:o,value:r,status:_$s})}})}},{key:"setInteractableButtons",value:function value(e){this.claimButton.interactable=e,this.claimX2Button.interactable=e}}]),s}(y)).prototype,"claimButton",[$B],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),oF=Ye(iF.prototype,"claimX2Button",[eF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),rF=Ye(iF.prototype,"dailyBlocks",[tF],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return[]}}),nF=iF))||nF);n._RF.pop(),n._RF.push({},"5a6aeaMAdtMGYA8B1wIuhDa","DayBlockRed",void 0);var TF,AF,RF,IF,PF,_F,LF,OF,DF,NF;(0,i.ccclass)("DayBlockRed")(cF=function(e){Ie(n,e);var t=xe(n);function n(){return Ce(this,n),t.apply(this,arguments)}return Ae(n,[{key:"updateBackground",value:function value(e){if(this.blueTopBackground&&this.blueBackground)switch(e.status){case"ready":this.background.spriteFrame=this.blueBackground,this.topBackground.spriteFrame=this.blueTopBackground;break;case"waiting":this.background.spriteFrame=this.defaultBackground,this.topBackground.spriteFrame=this.defaultTopBackground}}},{key:"updateDayLabel",value:function value(e){this.dayLabel.string="Day ".concat(e.day.toString());var t=this.defaultDayLabelOutlineColor;"ready"===e.status&&(t=this.blueDayLabelOutlineColor),this.dayLabel.shadowColor=t,this.dayLabel.outlineColor=t}}]),n}(uF));n._RF.pop(),n._RF.push({},"6fed95tFh5MRKzFqaFB2Ts8","GetCoinScreen",void 0);var MF,xF,BF,FF,zF,GF,UF,HF,VF,qF=i.ccclass,WF=i.property,KF=i.requireComponent,jF=globalThis.game.event,YF=GameCore.Events;TF=qF("GetCoinScreen"),AF=KF($x),RF=WF(u),IF=WF(d),PF=WF(d),TF(_F=AF((OF=Ye((LF=function(e){Ie(i,e);var t,n=xe(i);function i(){var _$e;Ce(this,i);for(var t=arguments.length,a=new Array(t),o=0;o<t;o++)a[o]=arguments[o];return je(_$e=n.call.apply(n,[this].concat(a)),"quantityLabel",OF,Ne(_$e)),je(_$e,"closeButtonComponent",DF,Ne(_$e)),je(_$e,"getNowButtonComponent",NF,Ne(_$e)),_$e.handleOpeningScreen=function(t){console.log("GetCoinScreen.OPENING_SCREEN",t),_$e.validateEventPayload(t)&&(_$e.closeButtonComponent.interactable=!0,_$e.getNowButtonComponent.interactable=!0,_$e.updateStatus())},_$e.handleOpenedScreen=function(t){_$e.validateEventPayload(t)&&_$e.open()},_$e}return Ae(i,[{key:"__preload",value:function value(){this.enabled=!1,this.screen=this.getComponent($x),this.validateRequiredComponents(),this.listenScreenEvents()}},{key:"onDestroy",value:function value(){this.unListenScreenEvents()}},{key:"validateRequiredComponents",value:function value(){St.lazyValidateProperties(this)}},{key:"listenScreenEvents",value:function value(){jF.on(YF.OPENING_SCREEN,this.handleOpeningScreen),jF.on(YF.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"unListenScreenEvents",value:function value(){jF.off(YF.OPENING_SCREEN,this.handleOpeningScreen),jF.off(YF.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"validateEventPayload",value:function value(e){return"screenName"in e&&e.screenName===this.node.name&&(this.payload=e,!0)}},{key:"open",value:function value(){this.updateStatus(),this.runPopUpAnimation(),this.node.scene.emit(Co.HIDE_UI)}},{key:"close",value:function value(){this.closeButtonComponent.interactable=!1,this.getNowButtonComponent.interactable=!1,jF.emit(YF.CLOSE_SCREEN,{screenName:this.node.name}),this.node.scene.emit(Co.SHOW_UI)}},{key:"updateStatus",value:function value(){this.updateCoinQuantity()}},{key:"runPopUpAnimation",value:function value(){this.screen.container||console.warn("GetCoinScreen: screen not found")}},{key:"updateCoinQuantity",value:function value(){var _$e=this.getQuantity();_$e&&this.updateQuantityLabel(_$e)}},{key:"updateQuantityLabel",value:function value(e){this.quantityLabel.string="x".concat(e.toString())}},{key:"getQuantity",value:function value(){if(!this.payload||!("screenData"in this.payload))return 0;var _$e=this.payload.screenData;return _$e&&"quantity"in _$e&&_$e.quantity&&"number"==typeof _$e.quantity?_$e.quantity:0}},{key:"handleAddCoin",value:function value(){var _$e=this.getQuantity();this.node.scene.emit(Co.ADD_COINS,{coins:_$e,collectionAnimation:{animateTextOnly:!1}}),this.close()}},{key:"handleGetNowButtonClicked",value:(t=Ee(function(){return _ts_generator(this,function(_state){switch(_state.label){case 0:Pi.stopAllSounds();return[4,kv.showRewardVideoAdAsync({})];case 1:_state.sent()&&this.handleAddCoin();return[2]}})}),function(){return t.apply(this,arguments)})}]),i}(y)).prototype,"quantityLabel",[RF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),DF=Ye(LF.prototype,"closeButtonComponent",[IF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),NF=Ye(LF.prototype,"getNowButtonComponent",[PF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_F=LF))||_F);n._RF.pop(),n._RF.push({},"91e6dGDvN1FKLi7g/JQPwl8","ItemCollectionFX",void 0);var XF,JF,QF,ZF,$F,ez,tz,nz,iz,az,oz,rz,sz,lz,uz,cz,hz,dz,pz,yz,fz,vz,mz,gz,bz,Sz=i.ccclass,wz=i.property,kz=(MF=Sz("ItemCollectionFX"),xF=wz(A),BF=wz(x),FF=wz(oe),MF((UF=Ye((GF=function(e){Ie(n,e);var t=xe(n);function n(){var _$e;Ce(this,n);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return je(_$e=t.call.apply(t,[this].concat(a)),"sprite",UF,Ne(_$e)),je(_$e,"glowUIOpacity",HF,Ne(_$e)),je(_$e,"particles",VF,Ne(_$e)),_$e}return Ae(n,[{key:"__preload",value:function value(){St.lazyValidateProperties(this)}},{key:"playExplosionParticles",value:function value(){this.particles.resetSystem()}}]),n}(y)).prototype,"sprite",[xF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),HF=Ye(GF.prototype,"glowUIOpacity",[BF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),VF=Ye(GF.prototype,"particles",[FF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),zF=GF))||zF);n._RF.pop(),n._RF.push({},"f016fTAlsNKRYkdu72AyCLI","GetItemScreen",void 0);var Ez,Cz,Tz,Az,Rz,Iz,Pz,_z,Lz,Oz,Dz,Nz,Mz,xz,Bz,Fz,zz,Gz,Uz,Hz,Vz,qz,Wz,Kz,jz,Yz,Xz,Jz,Qz,Zz,$z=i.ccclass,eG=i.property,tG=globalThis.game,nG=tG.event,iG=tG.player,aG=tG.analytics,oG=GameCore,rG=oG.Events,sG=oG.Utils,lG=sG.Object,uG=sG.Array,cG=oG.Plugins.Analytics.Events;XF=$z("GetItemScreen"),JF=eG(P),QF=eG(A),ZF=eG(A),$F=eG(A),ez=eG(A),tz=eG(u),nz=eG(u),iz=eG(u),az=eG(d),oz=eG(d),rz=eG(d),XF((uz=Ye((lz=function(e){Ie(s,e);var t,n,i,a,o,r=xe(s);function s(){var _$e;Ce(this,s);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return je(_$e=r.call.apply(r,[this].concat(n)),"itemFxPrefab",uz,Ne(_$e)),je(_$e,"hintSprite",cz,Ne(_$e)),je(_$e,"stormSprite",hz,Ne(_$e)),je(_$e,"pliersSprite",dz,Ne(_$e)),je(_$e,"thunderSprite",pz,Ne(_$e)),je(_$e,"titleLabel",yz,Ne(_$e)),je(_$e,"descriptionLabel",fz,Ne(_$e)),je(_$e,"coinLabel",vz,Ne(_$e)),je(_$e,"closeButtonComponent",mz,Ne(_$e)),je(_$e,"buyItemButtonComponent",gz,Ne(_$e)),je(_$e,"getNowButtonComponent",bz,Ne(_$e)),_$e.handleOpeningScreen=function(t){if(!_$e.screen)throw new Error("GetItemScreen: screen not found");if(_$e.validateEventPayload(t)){_$e.closeButtonComponent.interactable=!0,_$e.getNowButtonComponent.interactable=!0,_$e.buyItemButtonComponent.interactable=!0;var n=_$e.getItemType();n&&_$e.updateStatus(n)}},_$e.handleOpenedScreen=function(t){_$e.validateEventPayload(t)&&_$e.open()},_$e}return Ae(s,[{key:"__preload",value:function value(){this.enabled=!1,this.screen=this.getComponent($x),this.validateRequiredComponents(),this.listenScreenEvents()}},{key:"onDestroy",value:function value(){this.unListenScreenEvents()}},{key:"validateRequiredComponents",value:function value(){St.lazyValidateProperties(this)}},{key:"listenScreenEvents",value:function value(){nG.on(rG.OPENING_SCREEN,this.handleOpeningScreen),nG.on(rG.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"unListenScreenEvents",value:function value(){nG.off(rG.OPENING_SCREEN,this.handleOpeningScreen),nG.off(rG.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"validateEventPayload",value:function value(e){return(null!=e?e:{}).screenName===this.node.name&&(this.payload=e,!0)}},{key:"open",value:function value(){this.node.scene.emit(Co.GAME_PAUSE)}},{key:"close",value:function value(){this.closeButtonComponent.interactable=!1,this.buyItemButtonComponent.interactable=!1,this.getNowButtonComponent.interactable=!1,nG.emit(rG.CLOSE_SCREEN,{screenName:this.node.name}),this.node.scene.emit(Co.GAME_RESUME)}},{key:"updateStatus",value:function value(e){this.updateItemIcon(e),this.updateTitle(e),this.updateDescription(),this.updateButtons(e)}},{key:"updateItemIcon",value:function value(e){switch([this.hintSprite,this.stormSprite,this.thunderSprite,this.pliersSprite].forEach(function(e){e.node.active=!1}),e){case tl.HINT:this.activeIcon=this.hintSprite;break;case tl.STORM:this.activeIcon=this.stormSprite;break;case tl.THUNDER:this.activeIcon=this.thunderSprite;break;case tl.PLIERS:this.activeIcon=this.pliersSprite}this.activeIcon.node.active=!0}},{key:"updateTitle",value:function value(e){var t=e.charAt(0).toUpperCase()+e.slice(1);this.titleLabel.string=t}},{key:"updateDescription",value:function value(){var _$e,t=null===(_$e=this.payload.screenData)||void 0===_$e?void 0:_$e.message;t&&(this.descriptionLabel.string=t)}},{key:"updateButtons",value:function value(e){var t=this.canBuyItem(e);this.buyItemButtonComponent.node.active=t,this.getNowButtonComponent.node.active=!t,t&&(this.coinLabel.string="".concat(3*ol[e]))}},{key:"canBuyItem",value:function value(e){var t=iG.getGameData();return!!t&&t.coins>=3*ol[e]}},{key:"getItemType",value:function value(){var _$e=this.payload.screenData;return _$e&&_$e.item&&uG.has(lG.vals(tl),_$e.item)?_$e.item:null}},{key:"handleAddItem",value:(o=Ee(function(){var _$e,t;return _ts_generator(this,function(_state){_$e=this,t=this.getItemType();t&&(aG.event(cG.EARN_ITEM,{item_name:t,value:3}),this.node.scene.emit(Co.ADD_ITEM,{animate:function animate(){return _$e.animateAddItem(t)},item:t,quantity:3}));return[2]})}),function(){return o.apply(this,arguments)})},{key:"animateAddItem",value:(a=Ee(function(e){var t,n,i,a,o,r;return _ts_generator(this,function(_state){switch(_state.label){case 0:t=this.activeIcon.spriteFrame,n=Ue(this.createItemCollectionNode(t),2),i=n[0],a=n[1],o=this.getItemButtonWorldPosition(e),r=new Y(.5,.5,.5);a.glowUIOpacity.opacity=150;return[4,this.playScaleUpItemAnim(i,a)];case 1:_state.sent();return[4,gn.runTweenAsync(k(a.glowUIOpacity).to(.8,{opacity:0},{easing:"cubicIn"}))];case 2:_state.sent();return[4,this.playMoveCloseToItemButtonAnim(i,o,r)];case 3:_state.sent();return[4,this.playJumpAnim(i,r,o)];case 4:_state.sent(),Pi.playSound("sounds/clicks"),i.destroy();return[2]}})}),function(e){return a.apply(this,arguments)})},{key:"playJumpAnim",value:(i=Ee(function(e,t,n){var i,a;return _ts_generator(this,function(_state){switch(_state.label){case 0:i=n.clone().add3f(0,70,0),a=t.clone().multiplyScalar(1.3);return[4,Promise.all([gn.runTweenAsync(k(e).to(.3,{worldPosition:i},{easing:"cubicOut"})),gn.runTweenAsync(k(e).to(.3,{scale:a},{easing:"cubicOut"}))])];case 1:_state.sent();return[4,gn.runTweenAsync(k(e).to(.5,{worldPosition:n},{easing:"cubicIn"}))];case 2:_state.sent();return[2]}})}),function(e,t,n){return i.apply(this,arguments)})},{key:"playMoveCloseToItemButtonAnim",value:function value(e,t,n){var i=t.clone().add3f(0,30,0);return gn.runTweenAsync(k(e).to(1,{worldPosition:i,scale:n},{easing:"cubicInOut"}))}},{key:"createItemCollectionNode",value:function value(e){var t=l(this.itemFxPrefab),n=t.getComponent(kz);return t.setParent(this.node.parent),n.sprite.spriteFrame=e,t.setWorldPosition(this.activeIcon.node.worldPosition.clone()),[t,n]}},{key:"playScaleUpItemAnim",value:function value(e,t){return e.setScale(Y.ZERO),gn.runTweenAsync(k(e).delay(.2).call(function(){t.playExplosionParticles(),Pi.playSound("sounds/item_reward")}).to(.1,{scale:new Y(.8,1.2,1)}).to(.1,{scale:new Y(1.2,.8,1)}).to(.1,{scale:new Y(1,1,1)}))}},{key:"getItemButtonWorldPosition",value:function value(e){return this.getItemButton(e).worldPosition.clone()}},{key:"handleGetNowButtonClicked",value:(n=Ee(function(){return _ts_generator(this,function(_state){switch(_state.label){case 0:this.stopAllSounds();return[4,kv.showRewardVideoAdAsync({})];case 1:_state.sent()&&(this.handleAddItem(),this.close());return[2]}})}),function(){return n.apply(this,arguments)})},{key:"handleBuyItemButtonClicked",value:(t=Ee(function(){return _ts_generator(this,function(_state){this.node.scene.emit(Co.REMOVE_COINS,{coins:3*ol[this.getItemType()],collectionAnimation:{animateTextOnly:!0}}),this.handleAddItem(),this.close();return[2]})}),function(){return t.apply(this,arguments)})},{key:"stopAllSounds",value:function value(){var _$e;null===(_$e=I("Sound"))||void 0===_$e||null===(_$e=_$e.getComponent(Jt))||void 0===_$e||_$e.stopAll()}},{key:"getItemButton",value:function value(e){switch(e){case tl.HINT:return I("Canvas/UI/Footer/HintItemButton");case tl.STORM:return I("Canvas/UI/Footer/StormItemButton");case tl.THUNDER:return I("Canvas/UI/Footer/ThunderItemButton");case tl.PLIERS:return I("Canvas/UI/Footer/PliersItemButton")}}}]),s}(y)).prototype,"itemFxPrefab",[JF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),cz=Ye(lz.prototype,"hintSprite",[QF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),hz=Ye(lz.prototype,"stormSprite",[ZF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),dz=Ye(lz.prototype,"pliersSprite",[$F],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),pz=Ye(lz.prototype,"thunderSprite",[ez],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),yz=Ye(lz.prototype,"titleLabel",[tz],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),fz=Ye(lz.prototype,"descriptionLabel",[nz],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),vz=Ye(lz.prototype,"coinLabel",[iz],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),mz=Ye(lz.prototype,"closeButtonComponent",[az],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),gz=Ye(lz.prototype,"buyItemButtonComponent",[oz],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),bz=Ye(lz.prototype,"getNowButtonComponent",[rz],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),sz=lz));n._RF.pop(),n._RF.push({},"31829DUddVEq6NgIYHvnI68","LevelCompleteScreen",void 0);var hG,dG=i.ccclass,pG=i.property,yG=i.requireComponent,fG=GameCore,vG=fG.Events,mG=fG.Utils.Valid,gG=globalThis.game,bG=gG.event,SG=gG.player,wG="Coin Container";Ez=dG("LevelCompleteScreen"),Cz=yG($x),Tz=pG(wE),Az=pG(a),Rz=pG(u),Iz=pG(a),Pz=pG(a),_z=pG(d),Lz=pG(a),Oz=pG(v),Dz=pG(a),Nz=pG({type:v,group:wG}),Mz=pG({type:L,group:wG}),xz=pG({type:L,group:wG}),Bz=pG(ok),Ez(Fz=Cz((Gz=Ye((zz=function(e){Ie(r,e);var t,n,i,a,o=xe(r);function r(){var _$e;Ce(this,r);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return(_$e=o.call.apply(o,[this].concat(n))).levelId=1,_$e.coins=40,_$e.currentCoin=0,je(_$e,"coinContainer",Gz,Ne(_$e)),je(_$e,"playButton",Uz,Ne(_$e)),je(_$e,"coinText",Hz,Ne(_$e)),je(_$e,"levelText",Vz,Ne(_$e)),je(_$e,"nextLevelText",qz,Ne(_$e)),je(_$e,"playButtonComponent",Wz,Ne(_$e)),je(_$e,"wellDoneText",Kz,Ne(_$e)),je(_$e,"coinAnimation",jz,Ne(_$e)),je(_$e,"playButtonContainer",Yz,Ne(_$e)),je(_$e,"coinContainerAnimation",Xz,Ne(_$e)),je(_$e,"coinContainerEnterClip",Jz,Ne(_$e)),je(_$e,"coinContainerExitClip",Qz,Ne(_$e)),je(_$e,"paperConfetti",Zz,Ne(_$e)),_$e.handleOpeningScreen=function(t){if(!_$e.screen)throw new Error("StarChestScreen: screen not found");_$e.validateEventPayload(t)&&(_$e.playButtonComponent.interactable=!0)},_$e.handleOpenedScreen=function(t){_$e.validateEventPayload(t)&&_$e.open()},_$e}return Ae(r,[{key:"__preload",value:function value(){this.enabled=!1,this.screen=this.getComponent($x),this.validateRequiredComponents(),this.listenScreenEvents()}},{key:"onLoad",value:function value(){var _$e=this,t=this.screen.open;this.screen.open=function(n){_$e.overrideOpenHandler(t,n)}}},{key:"onDestroy",value:function value(){this.unListenScreenEvents()}},{key:"validateRequiredComponents",value:function value(){St.lazyValidateProperties(this)}},{key:"listenScreenEvents",value:function value(){bG.on(vG.OPENING_SCREEN,this.handleOpeningScreen),bG.on(vG.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"unListenScreenEvents",value:function value(){bG.off(vG.OPENING_SCREEN,this.handleOpeningScreen),bG.off(vG.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"validateEventPayload",value:function value(e){var t=null!=e?e:{},n=t.screenName,i=t.screenData;return n===this.node.name&&!!mG.isObject(i)&&(mG.isNumber(i.level)&&(this.levelId=i.level,this.coins=this.levelId<5?nl:il),mG.isNumber(i.currentCoin)&&(this.currentCoin=i.currentCoin),!0)}},{key:"open",value:function value(){this.updateComponents(),this.node.scene.emit(Co.HIDE_UI)}},{key:"close",value:(a=Ee(function(){return _ts_generator(this,function(_state){switch(_state.label){case 0:return[4,gn.runAnimationAsync(this.coinContainerAnimation,this.coinContainerExitClip.name)];case 1:_state.sent(),bG.emit(vG.CLOSE_SCREEN,{screenName:this.node.name});return[4,kv.showInterstitialAdAsync({forLevel:this.screen.data.level})];case 2:_state.sent(),this.handleNextLevel();return[2]}})}),function(){return a.apply(this,arguments)})},{key:"overrideOpenHandler",value:(i=Ee(function(e,t){var n,i;return _ts_generator(this,function(_state){switch(_state.label){case 0:i=this;this.screen.setScreenOpacity(255),this.coinText.string="x0",this.playButtonComponent.interactable=!1,this.paperConfetti.runEffect();return[4,this.animateWellDoneText()];case 1:_state.sent(),this.playButtonContainer.setScale(0,0,this.playButtonContainer.scale.z),e.call(this.screen,t),null===(n=this.screen.getComponent(v))||void 0===n||n.once(v.EventType.FINISHED,function(){i.animateCoin()});return[2]}})}),function(e,t){return i.apply(this,arguments)})},{key:"handleNextLevel",value:function value(){var _$e=this.screen.data.level;if(_$e){var t=SG.getGameData();if(t)_$e>=t.totalLevel?this.node.scene.emit(Co.MAX_LEVEL):this.node.scene.emit(Co.NEXT_LEVEL);else console.warn("LevelCompleteScreen: gameData not found")}else console.warn("LevelCompleteScreen: level not found")}},{key:"updateComponents",value:function value(){this.updateLevelText(),this.updateCoinContainer()}},{key:"updateCoinContainer",value:function value(){this.coinContainer.updateCoins({coins:this.currentCoin})}},{key:"updateLevelText",value:function value(){var _$e=SG.getGameData();if(_$e){this.levelText.getComponent(u).string="Level ".concat(this.levelId),console.log("LevelCompleteScreen: updateLevelText",this.levelId);var t=this.levelId+1>_$e.totalLevel?"Complete":"Level ".concat(this.levelId+1);this.nextLevelText.getComponent(u).string=t}else console.warn("LevelCompleteScreen: gameData not found")}},{key:"updateCoinString",value:function value(){this.coinText.string="x".concat(this.coins),console.log("LevelCompleteScreen: updateCoinString",this.coins)}},{key:"animateCoin",value:(n=Ee(function(){var _$e,_tmp;return _ts_generator(this,function(_state){switch(_state.label){case 0:_$e=this;if(!this.screen.container)return[3,4];this.coinAnimation.play();return[4,gn.runOnUpdateAsync(this.node,.8,function(t){var n=ce(0,_$e.coins,t),i=Math.floor(n);_$e.coinText.string="x".concat(i)})];case 1:_state.sent();return[4,this.animateCoinCollection()];case 2:_state.sent();return[4,gn.runTweenAsync(this.showPlayButton())];case 3:_tmp=(_state.sent(),this.updateCoinString());return[3,5];case 4:_tmp=console.warn("LevelCompleteScreen: screen not found");_state.label=5;case 5:_tmp;return[2]}})}),function(){return n.apply(this,arguments)})},{key:"animateCoinCollection",value:(t=Ee(function(){return _ts_generator(this,function(_state){switch(_state.label){case 0:return[4,gn.runAnimationAsync(this.coinContainerAnimation,this.coinContainerEnterClip.name)];case 1:_state.sent(),this.node.scene.emit(Co.ADD_COINS,{coins:this.coins,collectionAnimation:{animateTextOnly:!1,target:this.coinContainer}});return[2]}})}),function(){return t.apply(this,arguments)})},{key:"showPlayButton",value:function value(){var _$e=this;return k(this.playButtonContainer).call(function(){_$e.playButtonContainer.setScale(0,0,_$e.playButtonContainer.scale.z)}).to(.5,{scale:new Y(1,1,1)},{easing:"backOut"}).call(function(){_$e.playButtonComponent.interactable=!0})}},{key:"handleClickedPlay",value:function value(){this.playButtonComponent.interactable=!1,this.close()}},{key:"animateWellDoneText",value:function value(){var _$e=this,t=this.wellDoneText.position.clone(),n=k(this.wellDoneText).call(function(){_$e.wellDoneText.setPosition(0,0,_$e.wellDoneText.position.z),_$e.wellDoneText.setScale(0,0,_$e.wellDoneText.scale.z)}).to(.5,{scale:new Y(1.5,1.5,1)},{easing:"cubicOut"}).to(.5,{scale:new Y(1,1,1)},{easing:"backOut"}).to(.5,{position:t},{easing:"backOut"});return gn.runTweenAsync(n)}}]),r}(y)).prototype,"coinContainer",[Tz],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Uz=Ye(zz.prototype,"playButton",[Az],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Hz=Ye(zz.prototype,"coinText",[Rz],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Vz=Ye(zz.prototype,"levelText",[Iz],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),qz=Ye(zz.prototype,"nextLevelText",[Pz],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Wz=Ye(zz.prototype,"playButtonComponent",[_z],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Kz=Ye(zz.prototype,"wellDoneText",[Lz],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),jz=Ye(zz.prototype,"coinAnimation",[Oz],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Yz=Ye(zz.prototype,"playButtonContainer",[Dz],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Xz=Ye(zz.prototype,"coinContainerAnimation",[Nz],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Jz=Ye(zz.prototype,"coinContainerEnterClip",[Mz],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Qz=Ye(zz.prototype,"coinContainerExitClip",[xz],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Zz=Ye(zz.prototype,"paperConfetti",[Bz],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Fz=zz))||Fz);n._RF.pop(),n._RF.push({},"61985gSEDBMY6nVNc9Q1D6W","LoadingScreen",void 0);var kG,EG,CG,TG,AG,RG,IG,PG,_G=i.ccclass,LG=i.disallowMultiple,OG=i.requireComponent,DG=GameCore.Events,NG=globalThis.game.event;_G("LoadingScreen")(hG=LG(hG=OG($x)(hG=function(e){Ie(n,e);var t=xe(n);function n(){var _$e;Ce(this,n);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return(_$e=t.call.apply(t,[this].concat(a))).handleOpeningScreen=function(t){_$e.validateEventPayload(t)&&(_$e.enabled=!0)},_$e.handleOpenedScreen=function(t){_$e.validateEventPayload(t)&&_$e.open()},_$e.handleClosingScreen=function(t){_$e.validateEventPayload(t)&&_$e.unscheduleAllCallbacks()},_$e.handleClosedScreen=function(t){_$e.validateEventPayload(t)&&(_$e.enabled=!1)},_$e.handleOnCloseScreen=function(){Mu.closeScreen(Ci[_$e.node.name])},_$e}return Ae(n,[{key:"onLoad",value:function value(){this.enabled=!1,this.screen=this.getComponent($x),this.validateRequiredComponents(),this.listenScreenEvents()}},{key:"onDestroy",value:function value(){this.unListenScreenEvents()}},{key:"validateRequiredComponents",value:function value(){St.lazyValidateProperties(this)}},{key:"listenScreenEvents",value:function value(){NG.on(DG.OPENING_SCREEN,this.handleOpeningScreen),NG.on(DG.OPENED_SCREEN,this.handleOpenedScreen),NG.on(DG.CLOSING_SCREEN,this.handleClosingScreen),NG.on(DG.CLOSED_SCREEN,this.handleClosedScreen)}},{key:"unListenScreenEvents",value:function value(){NG.off(DG.OPENING_SCREEN,this.handleOpeningScreen),NG.off(DG.OPENED_SCREEN,this.handleOpenedScreen),NG.off(DG.CLOSING_SCREEN,this.handleClosingScreen),NG.off(DG.CLOSED_SCREEN,this.handleClosedScreen)}},{key:"validateEventPayload",value:function value(e){return e.screenName===this.node.name}},{key:"open",value:function value(){if(this.enabled){var _$e=this.screen.data.duration;_$e&&_$e>0&&this.scheduleOnce(this.handleOnCloseScreen,_$e)}}}]),n}(y))||hG)||hG);n._RF.pop(),n._RF.push({},"6460akNFfhP9pDOT2Z0+s2R","NotificationScreen",void 0);var MG,xG,BG,FG,zG,GG,UG,HG,VG=i.ccclass,qG=i.disallowMultiple,WG=i.requireComponent,KG=i.property,jG=GameCore,YG=jG.Events,XG=jG.Utils.Valid,JG=globalThis.game.event;kG=VG("NotificationScreen"),EG=WG($x),CG=KG(u),TG=KG(d),kG(AG=qG(AG=EG((IG=Ye((RG=function(e){Ie(n,e);var t=xe(n);function n(){var _$e;Ce(this,n);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return je(_$e=t.call.apply(t,[this].concat(a)),"message",IG,Ne(_$e)),je(_$e,"touchZone",PG,Ne(_$e)),_$e.enableCloseOnTouch=!0,_$e.handleOpeningScreen=function(t){_$e.validateEventPayload(t)&&_$e.updateScreenData(t)},_$e.handleClosingScreen=function(t){_$e.validateEventPayload(t)&&_$e.unscheduleAllCallbacks()},_$e}return Ae(n,[{key:"__preload",value:function value(){this.listenScreenEvents()}},{key:"onDestroy",value:function value(){this.unListenScreenEvents()}},{key:"onLoad",value:function value(){this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function value(){St.lazyValidateProperties(this)}},{key:"listenScreenEvents",value:function value(){JG.on(YG.OPENING_SCREEN,this.handleOpeningScreen),JG.on(YG.CLOSING_SCREEN,this.handleClosingScreen)}},{key:"unListenScreenEvents",value:function value(){JG.off(YG.OPENING_SCREEN,this.handleOpeningScreen),JG.off(YG.CLOSING_SCREEN,this.handleClosingScreen)}},{key:"validateEventPayload",value:function value(e){return e.screenName===this.node.name}},{key:"updateScreenData",value:function value(e){var t=this,_$n=e.screenData;XG.isObject(_$n)?(_$n.message&&(this.message.string=_$n.message),_$n.duration&&_$n.duration>0&&this.scheduleOnce(function(){Mu.closeScreen(Ci[t.node.name])},_$n.duration),!1===_$n.enableCloseOnTouch?this.enableCloseOnTouch=!1:this.enableCloseOnTouch=!0):console.warn("NotificationScreen: screenData not found")}},{key:"handleClickedClose",value:function value(){this.unscheduleAllCallbacks(),Mu.closeScreen(Ci[this.node.name])}},{key:"closeOnTouch",value:function value(){this.enableCloseOnTouch&&this.handleClickedClose()}}]),n}(y)).prototype,"message",[CG],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),PG=Ye(RG.prototype,"touchZone",[TG],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),AG=RG))||AG)||AG);n._RF.pop(),n._RF.push({},"7129ca71jRMGaTHxWhEL4F4","QuitLevelScreen",void 0);var QG,ZG,$G,eU,tU,nU,iU,aU,oU,rU,sU,lU,uU,cU,hU,dU,pU,yU,fU,vU,mU,gU,bU=i.ccclass,SU=i.property,wU=i.requireComponent,kU=GameCore.Events,EU=globalThis.game.event;MG=bU("QuitLevelScreen"),xG=wU($x),BG=SU(d),FG=SU(d),MG(zG=xG((UG=Ye((GG=function(e){Ie(n,e);var t=xe(n);function n(){var _$e;Ce(this,n);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return je(_$e=t.call.apply(t,[this].concat(a)),"noButton",UG,Ne(_$e)),je(_$e,"yesButton",HG,Ne(_$e)),_$e.handleOpeningScreen=function(t){_$e.validateEventPayload(t)&&(_$e.noButton.interactable=!0,_$e.yesButton.interactable=!0)},_$e.handleOpenedScreen=function(t){_$e.validateEventPayload(t)&&_$e.open()},_$e}return Ae(n,[{key:"__preload",value:function value(){this.enabled=!1,this.screen=this.getComponent($x),this.validateRequiredComponents(),this.listenScreenEvents()}},{key:"onDestroy",value:function value(){this.unListenScreenEvents()}},{key:"validateRequiredComponents",value:function value(){St.lazyValidateProperties(this)}},{key:"listenScreenEvents",value:function value(){EU.on(kU.OPENING_SCREEN,this.handleOpeningScreen),EU.on(kU.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"unListenScreenEvents",value:function value(){EU.off(kU.OPENING_SCREEN,this.handleOpeningScreen),EU.off(kU.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"validateEventPayload",value:function value(e){return(null!=e?e:{}).screenName===this.node.name}},{key:"open",value:function value(){this.runPopUpAnimation(),this.node.scene.emit(Co.HIDE_UI)}},{key:"close",value:function value(){this.noButton.interactable=!1,this.yesButton.interactable=!1,Mu.closeScreen(Ci[this.node.name]),this.node.scene.emit(Co.SHOW_UI),this.node.scene.emit(Co.GAME_RESUME)}},{key:"runPopUpAnimation",value:function value(){this.screen.container||console.warn("StartLevelScreen: screen not found")}},{key:"handleClickedNo",value:function value(){this.close()}},{key:"handleClickedYes",value:function value(){this.node.scene.emit(Co.GAME_EXIT)}}]),n}(y)).prototype,"noButton",[BG],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),HG=Ye(GG.prototype,"yesButton",[FG],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),zG=GG))||zG);n._RF.pop(),n._RF.push({},"85907Tnp/NBq7myeciP/4h3","RescuesScreen",void 0);var CU,TU,AU,RU,IU,PU,_U,LU,OU,DU,NU,MU,xU,BU,FU,zU,GU,UU,HU,VU,qU,WU,KU,jU,YU,XU,JU=i.ccclass,QU=i.property,ZU=i.disallowMultiple,$U=i.requireComponent,eH=GameCore.Events,tH=globalThis.game,nH=tH.event,iH=tH.player;QG=JU("RescuesScreen"),ZG=$U($x),$G=QU(x),eU=QU([a]),tU=QU(u),nU=QU(u),iU=QU(a),aU=QU(a),oU=QU(v),rU=QU(a),sU=QU(a),QG(lU=ZU(lU=ZG((cU=Ye((uU=function(e){Ie(s,e);var t,n,i,a,o,r=xe(s);function s(){var _$e;Ce(this,s);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return je(_$e=r.call.apply(r,[this].concat(n)),"adOpacity",cU,Ne(_$e)),je(_$e,"animNodes",hU,Ne(_$e)),je(_$e,"titleLabel",dU,Ne(_$e)),je(_$e,"descriptionLabel",pU,Ne(_$e)),je(_$e,"timer",yU,Ne(_$e)),je(_$e,"bomb",fU,Ne(_$e)),je(_$e,"bombAnim",vU,Ne(_$e)),je(_$e,"replayButton",mU,Ne(_$e)),je(_$e,"buyTimeButton",gU,Ne(_$e)),_$e.handleOpeningScreen=function(t){if(!_$e.screen)throw new Error("RescuesScreen: screen not found");_$e.validateEventPayload(t)},_$e.handleOpenedScreen=function(t){_$e.validateEventPayload(t)&&_$e.open()},_$e}return Ae(s,[{key:"__preload",value:function value(){this.enabled=!1,this.screen=this.getComponent($x),this.validateRequiredComponents(),this.listenScreenEvents()}},{key:"onDestroy",value:function value(){this.unListenScreenEvents()}},{key:"validateRequiredComponents",value:function value(){St.lazyValidateProperties(this)}},{key:"listenScreenEvents",value:function value(){nH.on(eH.OPENING_SCREEN,this.handleOpeningScreen),nH.on(eH.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"unListenScreenEvents",value:function value(){nH.off(eH.OPENING_SCREEN,this.handleOpeningScreen),nH.off(eH.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"validateEventPayload",value:function value(e){return e.screenName===this.node.name&&(this.payload=e,!0)}},{key:"open",value:(o=Ee(function(){return _ts_generator(this,function(_state){switch(_state.label){case 0:return[4,this.resetState()];case 1:_state.sent(),this.runOpenAnimation(),this.node.scene.emit(Co.HIDE_UI);return[2]}})}),function(){return o.apply(this,arguments)})},{key:"close",value:function value(){nH.emit(eH.CLOSE_SCREEN,{screenName:this.node.name})}},{key:"resetState",value:(a=Ee(function(){var _$e,t,n,i;return _ts_generator(this,function(_state){t=(null===(_$e=this.payload.screenData)||void 0===_$e?void 0:_$e.failKey)===Yu;this.titleLabel.string=t?"Boom!":"Time's Up!",this.descriptionLabel.string=t?"The bomb exploded!":"Restart or add 2 minutes?",this.timer.active=!t,this.bomb.active=t,t&&this.bombAnim.play();n=iH.getGameData();if(n){i=n.coins>=rl;this.replayButton.active=!i,this.buyTimeButton.active=i,this.adOpacity.opacity=0}return[2]})}),function(){return a.apply(this,arguments)})},{key:"runOpenAnimation",value:(i=Ee(function(){var _$e,_tmp;return _ts_generator(this,function(_state){switch(_state.label){case 0:_$e=this;if(!this.screen.container)return[3,3];return[4,Promise.all(this.animNodes.map(function(t,n){_$e.runAppearTween(t,.1*n)}))];case 1:_state.sent();return[4,this.runShowAdContainer()];case 2:_tmp=_state.sent();return[3,4];case 3:_tmp=console.warn("TimeUpScreen: screen not found");_state.label=4;case 4:_tmp;return[2]}})}),function(){return i.apply(this,arguments)})},{key:"runAppearTween",value:(n=Ee(function(e,t){return _ts_generator(this,function(_state){switch(_state.label){case 0:return[4,gn.runTweenAsync(k(e).set({scale:new Y(0,0,0)}).delay(t).to(1,{scale:new Y(1,1,1)},{progress:function progress(e,t,n,i){return e+(t-e)*gn.elasticOut(i,.1,.45)}}))];case 1:_state.sent();return[2]}})}),function(e,t){return n.apply(this,arguments)})},{key:"runShowAdContainer",value:function value(){var _$e=k(this.adOpacity);return _$e.delay(1),_$e.to(.5,{opacity:255}),gn.runTweenAsync(_$e)}},{key:"handleClickReplayButton",value:function value(){this.close(),this.node.scene.emit(Co.GAME_REPLAY,{level:this.screen.data.level})}},{key:"handleClickBuyTimeButton",value:function value(){this.node.scene.emit(Co.REMOVE_COINS,{coins:rl,collectionAnimation:{animateTextOnly:!0}}),this.startRescue()}},{key:"handleClickAdButton",value:(t=Ee(function(){return _ts_generator(this,function(_state){switch(_state.label){case 0:return[4,kv.showRewardVideoAdAsync({})];case 1:_state.sent()&&this.startRescue();return[2]}})}),function(){return t.apply(this,arguments)})},{key:"startRescue",value:function value(){this.node.scene.emit(Co.SHOW_UI),this.node.scene.emit(Co.RESCUE_START),this.close()}}]),s}(y)).prototype,"adOpacity",[$G],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),hU=Ye(uU.prototype,"animNodes",[eU],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return[]}}),dU=Ye(uU.prototype,"titleLabel",[tU],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),pU=Ye(uU.prototype,"descriptionLabel",[nU],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),yU=Ye(uU.prototype,"timer",[iU],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),fU=Ye(uU.prototype,"bomb",[aU],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),vU=Ye(uU.prototype,"bombAnim",[oU],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),mU=Ye(uU.prototype,"replayButton",[rU],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),gU=Ye(uU.prototype,"buyTimeButton",[sU],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),lU=uU))||lU)||lU);n._RF.pop(),n._RF.push({},"61932YLC/5CFrE0eD0ez8Zg","SettingsScreen",void 0);var aH,oH,rH,sH,lH,uH,cH,hH,dH,pH,yH,fH,vH,mH,gH,bH,SH,wH,kH,EH,CH,TH,AH,RH=i.ccclass,IH=i.property,PH=i.requireComponent,_H=GameCore,LH=_H.Events,OH=_H.Utils.Device,DH=globalThis.game,NH=DH.player,MH=DH.event;CU=RH("SettingsScreen"),TU=PH($x),AU=IH(a),RU=IH(a),IU=IH(a),PU=IH(r_),_U=IH(r_),LU=IH(r_),OU=IH(d),DU=IH(d),NU=IH(d),MU=IH(d),xU=IH(a),CU(BU=TU((zU=Ye((FU=function(e){Ie(i,e);var t,n=xe(i);function i(){var _$e;Ce(this,i);for(var t=arguments.length,a=new Array(t),o=0;o<t;o++)a[o]=arguments[o];return je(_$e=n.call.apply(n,[this].concat(a)),"musicSetting",zU,Ne(_$e)),je(_$e,"soundSetting",GU,Ne(_$e)),je(_$e,"vibrateSetting",UU,Ne(_$e)),je(_$e,"musicSwitch",HU,Ne(_$e)),je(_$e,"soundSwitch",VU,Ne(_$e)),je(_$e,"vibrateSwitch",qU,Ne(_$e)),je(_$e,"closeButtonComponent",WU,Ne(_$e)),je(_$e,"continueButtonComponent",KU,Ne(_$e)),je(_$e,"restartButtonComponent",jU,Ne(_$e)),je(_$e,"inviteFriendsButtonComponent",YU,Ne(_$e)),je(_$e,"animNodes",XU,Ne(_$e)),_$e.triggerSequence="",_$e.handleOpeningScreen=function(t){_$e.validateSwitchScreenPayload(t)&&(_$e.closeButtonComponent.interactable=!0,_$e.continueButtonComponent.interactable=!0,_$e.restartButtonComponent.interactable=!0,_$e.inviteFriendsButtonComponent.interactable=!0,_$e.updateStatus())},_$e.handleOpenedScreen=function(t){_$e.validateSwitchScreenPayload(t)&&_$e.open()},_$e.handleResetSequence=function(){_$e.triggerSequence=""},_$e.handleTriggerUnlockKey=function(t){if("code"in t){var n=t.code,_$i=hl.UNLOCK_SEQUENCE;"number"==typeof n&&-1!==_$i.indexOf(n.toString())&&(_$e.triggerSequence+=n.toString(),console.log("SettingsScreen: handleTriggerUnlockKey",n,_$e.triggerSequence,_$e.triggerSequence===_$i),_$e.triggerSequence===_$i&&(_$e.node.scene.emit(hl.Events.UNLOCK_DEV_TOOLS),_$e.node.off(hl.Events.TRIGGER_UNLOCK_KEY)))}},_$e.updateVibrateButton=function(){var t=_$e.vibrateSetting.getComponentInChildren(d),n=_$e.vibrateSetting.getComponentInChildren(r_),_$i=_$e.vibrateSetting.getComponentInChildren(Ca);if(t&&n&&_$i)if(OH.isMobile()){var a,o=null!==(a=NH.getPlayerSetting("vibrate"))&&void 0!==a&&a;n.setEnabled(o)}else t.interactable=!1,n.setEnabled(!1),_$i.changeState(!1);else console.warn("SettingsScreen: vibrate button missing components")},_$e}return Ae(i,[{key:"onLoad",value:function value(){this.enabled=!1,this.screen=this.getComponent($x),this.validateRequiredComponents(),this.listenScreenEvents(),this.listenUnlockDevTools()}},{key:"onDestroy",value:function value(){this.unListenScreenEvents(),this.unListenUnlockDevTools()}},{key:"validateRequiredComponents",value:function value(){St.lazyValidateProperties(this)}},{key:"listenScreenEvents",value:function value(){MH.on(LH.OPENING_SCREEN,this.handleOpeningScreen),MH.on(LH.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"unListenScreenEvents",value:function value(){MH.off(LH.OPENING_SCREEN,this.handleOpeningScreen),MH.off(LH.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"validateSwitchScreenPayload",value:function value(e){return e.screenName===this.node.name}},{key:"listenUnlockDevTools",value:function value(){this.node.off(hl.Events.TRIGGER_UNLOCK_KEY),this.node.on(hl.Events.TRIGGER_RESET_SEQUENCE,this.handleResetSequence),this.node.on(hl.Events.TRIGGER_UNLOCK_KEY,this.handleTriggerUnlockKey)}},{key:"unListenUnlockDevTools",value:function value(){this.node.off(hl.Events.TRIGGER_RESET_SEQUENCE,this.handleResetSequence),this.node.off(hl.Events.TRIGGER_UNLOCK_KEY,this.handleTriggerUnlockKey)}},{key:"open",value:function value(){this.updateStatus(),this.runPopUpAnimation(),this.node.emit(hl.Events.TRIGGER_RESET_SEQUENCE),this.node.scene.emit(Co.HIDE_UI)}},{key:"close",value:function value(){this.closeButtonComponent.interactable=!1,this.continueButtonComponent.interactable=!1,this.restartButtonComponent.interactable=!1,this.inviteFriendsButtonComponent.interactable=!1,this.node.emit(hl.Events.TRIGGER_RESET_SEQUENCE),Mu.closeScreen(Ci[this.node.name])}},{key:"updateStatus",value:function value(){var _$e,t,n,_$i={music:null!==(_$e=NH.getPlayerSetting("music"))&&void 0!==_$e&&_$e,sound:null!==(t=NH.getPlayerSetting("sound"))&&void 0!==t&&t,vibrate:null!==(n=NH.getPlayerSetting("vibrate"))&&void 0!==n&&n};this.musicSwitch?this.soundSwitch?(this.musicSwitch.setEnabled(_$i.music),this.soundSwitch.setEnabled(_$i.sound),"GameDistributions"!==GameSDK.getSDKName()&&this.scheduleOnce(this.updateVibrateButton,.1)):console.warn("SettingsScreen: soundSwitch not found"):console.warn("SettingsScreen: musicSwitch not found")}},{key:"runPopUpAnimation",value:function value(){var _$e=this;this.screen.container||console.warn("SettingsScreen: screen not found"),this.animNodes.forEach(function(t,n){_$e.runAppearTween(t,.1*n)})}},{key:"runAppearTween",value:function value(e,t){var n=k(e);n.set({scale:new Y(0,0,0)}),n.delay(t),n.to(1,{scale:new Y(1,1,1)},{progress:function progress(e,t,n,i){return e+(t-e)*gn.elasticOut(i,.1,.45)}}),n.start()}},{key:"switchMusicButton",value:function value(){if(this.musicSwitch){var _$e=this.musicSwitch.switch();NH.setSetting("music",_$e),this.node.emit(hl.Events.TRIGGER_UNLOCK_KEY,{code:_$e?1:0}),_$e?Pi.playMusic():Pi.pauseMusic()}else console.warn("SettingsScreen: musicSwitch not found")}},{key:"switchSoundButton",value:function value(){if(this.soundSwitch){var _$e=this.soundSwitch.switch();NH.setSetting("sound",_$e),this.node.emit(hl.Events.TRIGGER_UNLOCK_KEY,{code:_$e?3:2})}else console.warn("SettingsScreen: soundSwitch not found")}},{key:"switchVibrateButton",value:function value(){if(this.vibrateSwitch){var _$e=this.vibrateSwitch.switch();NH.setSetting("vibrate",_$e)}else console.warn("SettingsScreen: vibrateSwitch not found")}},{key:"handleClickedResume",value:function value(){this.resumeGame()}},{key:"handleClickedClose",value:function value(){this.resumeGame()}},{key:"handleClickedReplayGame",value:function value(){this.restartGame()}},{key:"handleClickedInviteFriends",value:(t=Ee(function(){return _ts_generator(this,function(_state){switch(_state.label){case 0:if(!("MsGames"===GameSDK.getSDKName()))return[3,2];Mu.showLoadingScreen();return[4,GameSDK.extra.shareAsync()];case 1:return[2,(_state.sent(),void Mu.closeLoadingScreen())];case 2:this.close(),this.node.scene.emit(Co.INVITE_FRIENDS);return[2]}})}),function(){return t.apply(this,arguments)})},{key:"resumeGame",value:function value(){this.close(),this.node.scene.emit(Co.GAME_RESUME),this.node.scene.emit(Co.SHOW_UI)}},{key:"restartGame",value:function value(){var _$e;this.close(),this.node.scene.emit(Co.GAME_RESUME);var t=(null!==(_$e=NH.getGameData())&&void 0!==_$e?_$e:{}).level,n=void 0===t?1:t;this.node.scene.emit(Co.GAME_REPLAY,{level:n})}}]),i}(y)).prototype,"musicSetting",[AU],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),GU=Ye(FU.prototype,"soundSetting",[RU],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),UU=Ye(FU.prototype,"vibrateSetting",[IU],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),HU=Ye(FU.prototype,"musicSwitch",[PU],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),VU=Ye(FU.prototype,"soundSwitch",[_U],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),qU=Ye(FU.prototype,"vibrateSwitch",[LU],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),WU=Ye(FU.prototype,"closeButtonComponent",[OU],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),KU=Ye(FU.prototype,"continueButtonComponent",[DU],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),jU=Ye(FU.prototype,"restartButtonComponent",[NU],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),YU=Ye(FU.prototype,"inviteFriendsButtonComponent",[MU],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),XU=Ye(FU.prototype,"animNodes",[xU],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return[]}}),BU=FU))||BU);n._RF.pop(),n._RF.push({},"891d37NJ6lLdp3CNLPHxZ6d","StarChest",void 0);var xH,BH,FH,zH,GH,UH,HH,VH,qH,WH,KH,jH,YH,XH,JH,QH,ZH,$H,eV,tV,nV=i.ccclass,iV=i.property,aV=(aH=nV("StarChest"),oH=iV(A),rH=iV(x),sH=iV(oe),lH=iV(x),uH=iV(x),cH=iV({type:E,readonly:!0,displayName:"Starting Offset X",group:"Reward Animations"}),hH=iV({type:E,readonly:!0,displayName:"Starting Offset Y",group:"Reward Animations"}),dH=iV({type:E,displayName:"Centered Offset X",group:"Reward Animations"}),pH=iV({type:E,displayName:"Centered Offset Y",group:"Reward Animations"}),yH=iV({type:E,min:0,displayName:"Starting Scale",group:"Reward Animations"}),fH=iV({type:E,min:0,displayName:"Ending Scale",group:"Reward Animations"}),aH((gH=Ye((mH=function(e){Ie(s,e);var t,n,i,a,o,r=xe(s);function s(){var _$e;Ce(this,s);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return je(_$e=r.call.apply(r,[this].concat(n)),"sprite",gH,Ne(_$e)),je(_$e,"glowOpacity",bH,Ne(_$e)),je(_$e,"explosionParticles",SH,Ne(_$e)),je(_$e,"circle",wH,Ne(_$e)),je(_$e,"uiOpacity",kH,Ne(_$e)),_$e.ogCenterX=0,_$e.ogCenterY=0,je(_$e,"endingOffsetX",EH,Ne(_$e)),je(_$e,"endingOffsetY",CH,Ne(_$e)),je(_$e,"startingScale",TH,Ne(_$e)),je(_$e,"endingScale",AH,Ne(_$e)),_$e}return Ae(s,[{key:"startingOffsetX",get:function get(){return this.node.position.x}},{key:"startingOffsetY",get:function get(){return this.node.position.y}},{key:"__preload",value:function value(){this.validateRequiredComponents(),this.ogCenterX=this.startingOffsetX,this.ogCenterY=this.startingOffsetY}},{key:"validateRequiredComponents",value:function value(){St.lazyValidateProperties(this)}},{key:"moveToCenter",value:(o=Ee(function(e){var t;return _ts_generator(this,function(_state){switch(_state.label){case 0:t=new Y(this.endingOffsetX,this.endingOffsetY,this.node.position.z);return[4,gn.runTweenAsync(k(this.node).to(.7,{position:t},{easing:"quintInOut"}),e)];case 1:_state.sent(),this.node.position=t;return[2]}})}),function(e){return o.apply(this,arguments)})},{key:"respawnAtStartingState",value:function value(){this.node.position=new Y(this.ogCenterX,this.ogCenterY,this.node.position.z),this.glowOpacity.opacity=0,this.sprite.node.setScale(this.startingScale,this.startingScale,this.startingScale),this.glowOpacity.node.setScale(this.startingScale,this.startingScale,this.startingScale),this.uiOpacity.opacity=255}},{key:"scale",value:(a=Ee(function(e,t){var n,i;return _ts_generator(this,function(_state){switch(_state.label){case 0:n=this.startingScale+(this.endingScale-this.startingScale)*e,i=new Y(n,n,n);return[4,Promise.all([gn.runTweenAsync(k(this.sprite.node).to(.2,{scale:i},{easing:"backOut"}),t),gn.runTweenAsync(k(this.glowOpacity.node).to(.2,{scale:i},{easing:"backOut"}),t)])];case 1:_state.sent(),this.sprite.node.setScale(i),this.glowOpacity.node.setScale(i);return[2]}})}),function(e,t){return a.apply(this,arguments)})},{key:"startShaking",value:function value(){var _$e=this,t=this.node.position.clone();this.shakingTween={ogPos:t,tw:k(this.node).to(.1,{},{onUpdate:function onUpdate(n,i){if(i){var a=t.x+10*(i-.5);_$e.node.position=new Y(a,t.y,t.z)}}}).repeatForever().start()}}},{key:"stopShaking",value:function value(){this.shakingTween&&(this.shakingTween.tw.stop(),this.node.position=this.shakingTween.ogPos,this.shakingTween=void 0)}},{key:"glow",value:(i=Ee(function(e){var t;return _ts_generator(this,function(_state){switch(_state.label){case 0:t=this.sprite.node.scale.clone().multiplyScalar(1.1);return[4,Promise.all([gn.runTweenAsync(k(this.sprite.node).to(.2,{scale:t},{easing:"cubicInOut"}),e),gn.runTweenAsync(k(this.glowOpacity.node).to(.2,{scale:t}),e),gn.runTweenAsync(k(this.glowOpacity).to(.5,{opacity:255}),e)])];case 1:_state.sent();return[2]}})}),function(e){return i.apply(this,arguments)})},{key:"explode",value:(n=Ee(function(e){var t,n,i,a;return _ts_generator(this,function(_state){switch(_state.label){case 0:t=this,n=new Y(8,8,8),i=function(){var i=Ee(function(){return _ts_generator(this,function(_state){switch(_state.label){case 0:t.circle.opacity=255,t.circle.node.setScale(Y.ZERO);return[4,Promise.all([gn.runTweenAsync(k(t.circle).to(.3,{opacity:0}),e),gn.runTweenAsync(k(t.circle.node).to(.3,{scale:n},{easing:"cubicOut"}),e)])];case 1:_state.sent(),t.circle.opacity=0,t.circle.node.scale=n;return[2]}})});return function(){return i.apply(this,arguments)}}(),a=function(){var n=Ee(function(){return _ts_generator(this,function(_state){switch(_state.label){case 0:return[4,Promise.all([gn.runTweenAsync(k(t.glowOpacity.node).to(.3,{scale:Y.ZERO},{easing:"cubicOut"}),e),gn.runTweenAsync(k(t.sprite.node).to(.3,{scale:Y.ZERO},{easing:"cubicOut"}),e)])];case 1:_state.sent(),t.sprite.node.setScale(Y.ZERO),t.glowOpacity.node.setScale(Y.ZERO);return[2]}})});return function(){return n.apply(this,arguments)}}();return[4,Promise.all([this.explodeParticles(e),i(),a()])];case 1:_state.sent();return[2]}})}),function(e){return n.apply(this,arguments)})},{key:"explodeParticles",value:(t=Ee(function(e){var _tmp;return _ts_generator(this,function(_state){switch(_state.label){case 0:_tmp=e.aborted;if(_tmp)return[3,2];this.explosionParticles.node.active=!0,this.explosionParticles.resetSystem();return[4,gn.waitTweenAsync(1)];case 1:_tmp=(_state.sent(),this.explosionParticles.node.active=!1);_state.label=2;case 2:_tmp;return[2]}})}),function(e){return t.apply(this,arguments)})}]),s}(y)).prototype,"sprite",[oH],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),bH=Ye(mH.prototype,"glowOpacity",[rH],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),SH=Ye(mH.prototype,"explosionParticles",[sH],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wH=Ye(mH.prototype,"circle",[lH],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),kH=Ye(mH.prototype,"uiOpacity",[uH],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ye(mH.prototype,"startingOffsetX",[cH],Object.getOwnPropertyDescriptor(mH.prototype,"startingOffsetX"),mH.prototype),Ye(mH.prototype,"startingOffsetY",[hH],Object.getOwnPropertyDescriptor(mH.prototype,"startingOffsetY"),mH.prototype),EH=Ye(mH.prototype,"endingOffsetX",[dH],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return 0}}),CH=Ye(mH.prototype,"endingOffsetY",[pH],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return 0}}),TH=Ye(mH.prototype,"startingScale",[yH],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return .5}}),AH=Ye(mH.prototype,"endingScale",[fH],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return 1}}),vH=mH))||vH);n._RF.pop(),n._RF.push({},"e414bczbutHJKcOfhl1sc4p","StarChestScreen",void 0);var oV,rV,sV,lV,uV,cV,hV,dV,pV,yV,fV,vV,mV,gV,bV=i.ccclass,SV=i.property,wV=i.requireComponent,kV=GameCore.Events,EV=globalThis.game,CV=EV.event,TV=EV.player;xH=bV("StarChestScreen"),BH=wV($x),FH=SV(EA),zH=SV(u),GH=SV(d),UH=SV(v),HH=SV(aV),VH=SV(x),qH=SV(eE),WH=SV(u),xH(KH=BH((YH=Ye((jH=function(e){Ie(r,e);var t,n,i,a,o=xe(r);function r(){var _$e;Ce(this,r);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return je(_$e=o.call.apply(o,[this].concat(n)),"starProgressBar",YH,Ne(_$e)),je(_$e,"buttonLabel",XH,Ne(_$e)),je(_$e,"button",JH,Ne(_$e)),je(_$e,"chestAnimation",QH,Ne(_$e)),je(_$e,"starChest",ZH,Ne(_$e)),je(_$e,"chestUnlockFXMask",$H,Ne(_$e)),je(_$e,"skipOverlay",eV,Ne(_$e)),je(_$e,"messageLabel",tV,Ne(_$e)),_$e.handleOpeningScreen=function(t){if(!_$e.screen)throw new Error("StarChestScreen: screen not found");_$e.validateEventPayload(t)},_$e.handleOpenedScreen=function(t){_$e.validateEventPayload(t)&&_$e.open()},_$e}return Ae(r,[{key:"__preload",value:function value(){this.enabled=!1,this.screen=this.getComponent($x),this.validateRequiredComponents(),this.listenScreenEvents()}},{key:"onDestroy",value:function value(){this.unListenScreenEvents()}},{key:"validateRequiredComponents",value:function value(){St.lazyValidateProperties(this)}},{key:"listenScreenEvents",value:function value(){CV.on(kV.OPENING_SCREEN,this.handleOpeningScreen),CV.on(kV.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"unListenScreenEvents",value:function value(){CV.off(kV.OPENING_SCREEN,this.handleOpeningScreen),CV.off(kV.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"validateEventPayload",value:function value(e){return(null!=e?e:{}).screenName===this.node.name}},{key:"open",value:function value(){this.runPopUpAnimation(),this.node.scene.emit(Co.HIDE_UI);var _$e=TV.getGameData();if(_$e){var t=_$e.stars;this.numChestAvailable=Math.floor(t/20),this.starProgressBar.setRange(t,20),this.buttonLabel.string=this.numChestAvailable?"Open":"Continue",this.messageLabel.string=this.numChestAvailable?"Congrats, you have enough stars to open the chest!":"Win more stars to open!",this.button.interactable=!0,this.numChestAvailable?this.chestAnimation.play():this.chestAnimation.stop(),this.chestUnlockFXMask.node.active=!1,this.chestUnlockFXMask.opacity=0,this.starChest.respawnAtStartingState()}}},{key:"close",value:function value(){CV.emit(kV.CLOSE_SCREEN,{screenName:this.node.name}),this.node.scene.emit(Co.SHOW_UI)}},{key:"runPopUpAnimation",value:function value(){this.screen.container||console.warn("StarChestScreen: screen not found")}},{key:"handleClickButton",value:(a=Ee(function(){var _$e,t,n;return _ts_generator(this,function(_state){switch(_state.label){case 0:if(!(0!==this.numChestAvailable))return[3,5];Pi.turnDownMusic();_$e=TV.getGameData();if(!_$e)return[3,4];this.button.interactable=!1;t=_$e.stars;TV.setGameData({stars:_$e.stars-20*this.numChestAvailable});n=new Bn;return[4,this.skipOverlay.open({opacity:200,onSkip:function onSkip(){return n.abort()}})];case 1:_state.sent();return[4,this.handleUnlockAnimation(t,_$e.stars,n)];case 2:_state.sent();return[4,this.skipOverlay.close()];case 3:_state.sent(),Pi.turnUpMusic(),W.emit(_n),this.close();_state.label=4;case 4:return[3,6];case 5:this.close();_state.label=6;case 6:return[2]}})}),function(){return a.apply(this,arguments)})},{key:"handleUnlockAnimation",value:(i=Ee(function(e,t,n){var i,a,o,_$r;return _ts_generator(this,function(_state){switch(_state.label){case 0:i=this;return[4,Promise.all([this.starChest.moveToCenter(n),this.fadeInChestUnlockFX(n)])];case 1:_state.sent(),this.chestAnimation.stop(),this.starChest.startShaking(),Pi.playSound(vi.STAR_CHEST_DRUM_ROLL,{loop:!0});return[4,gn.waitTweenAsync(0)];case 2:_state.sent();a=e,o=this.numChestAvailable;return[4,Promise.all([this.starProgressBar.animateTo(t,n,function(e){var _$t;a-e>=20&&(a=e,o--,i.starChest.scale((_$t=o,i.numChestAvailable>2?1-_$t/i.numChestAvailable:.35*(1-_$t/i.numChestAvailable)),n),Pi.playSound(vi.STAR_CHEST_OPEN))})])];case 3:_state.sent();return[4,gn.waitTweenAsync(1,n)];case 4:_state.sent(),this.starChest.stopShaking();return[4,this.starChest.glow(n)];case 5:_state.sent(),Pi.stopSound(vi.STAR_CHEST_DRUM_ROLL);_$r=al*this.numChestAvailable;this.node.scene.emit(Co.ADD_COINS,{coins:_$r,collectionAnimation:{animateTextOnly:!1,floatDuration:3,signal:n}});return[4,this.starChest.explode(n)];case 6:_state.sent();return[4,gn.waitTweenAsync(1,n)];case 7:_state.sent();return[4,Promise.all([this.fadeOutChestUnlockFX(n)])];case 8:_state.sent();return[2]}})}),function(e,t,n){return i.apply(this,arguments)})},{key:"fadeInChestUnlockFX",value:(n=Ee(function(e){return _ts_generator(this,function(_state){switch(_state.label){case 0:this.chestUnlockFXMask.node.active=!0;return[4,gn.runTweenAsync(k(this.chestUnlockFXMask).to(.5,{opacity:150}),e)];case 1:_state.sent();return[2]}})}),function(e){return n.apply(this,arguments)})},{key:"fadeOutChestUnlockFX",value:(t=Ee(function(e){return _ts_generator(this,function(_state){switch(_state.label){case 0:return[4,gn.runTweenAsync(k(this.chestUnlockFXMask).to(.3,{opacity:0}),e)];case 1:_state.sent(),this.chestUnlockFXMask.opacity=0,this.chestUnlockFXMask.node.active=!1;return[2]}})}),function(e){return t.apply(this,arguments)})}]),r}(y)).prototype,"starProgressBar",[FH],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),XH=Ye(jH.prototype,"buttonLabel",[zH],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),JH=Ye(jH.prototype,"button",[GH],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),QH=Ye(jH.prototype,"chestAnimation",[UH],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ZH=Ye(jH.prototype,"starChest",[HH],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),$H=Ye(jH.prototype,"chestUnlockFXMask",[VH],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),eV=Ye(jH.prototype,"skipOverlay",[qH],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),tV=Ye(jH.prototype,"messageLabel",[WH],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),KH=jH))||KH);n._RF.pop(),n._RF.push({},"ecbb9MLxRlP2Kv7swFe9AXo","StartLevelScreen",void 0);var AV,RV,IV,PV,_V,LV=i.ccclass,OV=i.property,DV=i.requireComponent,NV=GameCore.Events,MV=globalThis.game.event;oV=LV("StartLevelScreen"),rV=DV($x),sV=OV(a),lV=OV(a),uV=OV(a),cV=OV(a),hV=OV(d),oV(dV=rV((yV=Ye((pV=function(e){Ie(n,e);var t=xe(n);function n(){var _$e;Ce(this,n);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return je(_$e=t.call.apply(t,[this].concat(a)),"playButton",yV,Ne(_$e)),je(_$e,"goalText",fV,Ne(_$e)),je(_$e,"levelText",vV,Ne(_$e)),je(_$e,"missionText",mV,Ne(_$e)),je(_$e,"playButtonComponent",gV,Ne(_$e)),_$e.handleOpeningScreen=function(t){if(!_$e.screen)throw new Error("StartLevelScreen: screen not found");_$e.validateEventPayload(t)&&(_$e.playButtonComponent.interactable=!0)},_$e.handleOpenedScreen=function(t){_$e.validateEventPayload(t)&&_$e.open()},_$e}return Ae(n,[{key:"__preload",value:function value(){this.enabled=!1,this.screen=this.getComponent($x),this.validateRequiredComponents(),this.listenScreenEvents()}},{key:"onDestroy",value:function value(){this.unListenScreenEvents()}},{key:"validateRequiredComponents",value:function value(){St.lazyValidateProperties(this)}},{key:"listenScreenEvents",value:function value(){MV.on(NV.OPENING_SCREEN,this.handleOpeningScreen),MV.on(NV.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"unListenScreenEvents",value:function value(){MV.off(NV.OPENING_SCREEN,this.handleOpeningScreen),MV.off(NV.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"validateEventPayload",value:function value(e){var t=null!=e?e:{},_$n=t.screenName,i=t.screenData;return _$n===this.node.name&&(null!=i&&i.level&&(this.levelId=i.level),null!=i&&i.mission&&(this.mission=i.mission),!0)}},{key:"open",value:function value(){this.updateComponents(),this.runPopUpAnimation(),this.node.scene.emit(Co.HIDE_UI)}},{key:"close",value:function value(){this.playButtonComponent.interactable=!1,MV.emit(NV.CLOSE_SCREEN,{screenName:this.node.name}),this.node.scene.emit(Co.SHOW_UI)}},{key:"updateComponents",value:function value(){this.updateGoalText(),this.updateLevelText(),this.updateDescriptionText()}},{key:"updateGoalText",value:function value(){var _$e=this.mission.mission;this.goalText.getComponent(u).string=_$e>1?"Goals":"Goal"}},{key:"updateLevelText",value:function value(){this.levelText.getComponent(u).string="Level ".concat(this.levelId)}},{key:"updateDescriptionText",value:function value(){this.missionText.getComponent(u).string=this.mission.description}},{key:"runPopUpAnimation",value:function value(){this.screen.container||console.warn("StartLevelScreen: screen not found")}},{key:"handleClickedPlay",value:function value(){this.node.scene.emit(Co.GAME_START),this.close()}}]),n}(y)).prototype,"playButton",[sV],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),fV=Ye(pV.prototype,"goalText",[lV],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),vV=Ye(pV.prototype,"levelText",[uV],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),mV=Ye(pV.prototype,"missionText",[cV],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),gV=Ye(pV.prototype,"playButtonComponent",[hV],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),dV=pV))||dV);n._RF.pop(),n._RF.push({},"fe274iMNmBCzZ13Ie1nGU1R","TournamentLeaderSkeleton",void 0);var xV,BV,FV,zV,GV,UV,HV,VV,qV,WV,KV,jV,YV,XV,JV,QV,ZV,$V,eq,tq,nq,iq,aq,oq,rq,sq,lq=i.ccclass,uq=i.property,cq=(AV=lq("TournamentLeaderSkeleton"),RV=uq(a),AV((_V=Ye((PV=function(e){Ie(a,e);var t,n,i=xe(a);function a(){var _$e;Ce(this,a);for(var t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];return je(_$e=i.call.apply(i,[this].concat(n)),"container",_V,Ne(_$e)),_$e}return Ae(a,[{key:"__preload",value:function value(){this.uiOpacity=this.getComponent(x),this.validateRequiredComponents()}},{key:"hide",value:(n=Ee(function(e){var t;return _ts_generator(this,function(_state){switch(_state.label){case 0:t=this;return[4,gn.runTweenAsync(k(this.uiOpacity).to(.2,{opacity:0}).call(function(){t.node.active=!1}),e)];case 1:_state.sent();return[2]}})}),function(e){return n.apply(this,arguments)})},{key:"show",value:(t=Ee(function(e,t){var n,i,_$a,o;return _ts_generator(this,function(_state){switch(_state.label){case 0:this.node.active=!0,this.node.scale=new Y(.8,.8,.8),this.uiOpacity.opacity=0;n=this.container.position.clone();this.container.position=new Y(n.x,n.y-100,n.z);i=k(this.node).delay(e);i.to(.2,{scale:Y.ONE},{easing:"elasticOut"});_$a=k(this.container).delay(e);_$a.to(.2,{position:n},{easing:"backOut"});o=k(this.uiOpacity).delay(e);o.to(.2,{opacity:255},{easing:"cubicOut"});return[4,Promise.all([gn.runTweenAsync(i,t),gn.runTweenAsync(_$a,t),gn.runTweenAsync(o,t)])];case 1:_state.sent();return[2]}})}),function(e,n){return t.apply(this,arguments)})},{key:"validateRequiredComponents",value:function value(){if(!this.uiOpacity)throw new Error("UIOpacity component is not attached to the same node");if(!this.container)throw new Error("Container is not attached to the same node")}}]),a}(y)).prototype,"container",[RV],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),IV=PV))||IV);n._RF.pop(),n._RF.push({},"cdaa9B4pK9PFrDmP6/GQcMn","TournamentDetailScreen",void 0);var hq,dq=i.ccclass,pq=i.property,yq=i.requireComponent,fq=GameCore,vq=fq.Events,mq=fq.Utils,gq=mq.Object,bq=mq.Time,Sq=mq.Number,wq=mq.Array,kq=globalThis.game,Eq=kq.event,Cq=kq.storage,Tq=kq.player,Aq=kq.leaderboard;xV=dq("TournamentDetailScreen"),BV=yq($x),FV=pq(u),zV=pq(u),GV=pq(u),UV=pq(YL),HV=pq(s),VV=pq({type:a,group:"Buttons"}),qV=pq({type:a,group:"Buttons"}),WV=pq({type:a,group:"Buttons"}),KV=pq({type:[cq]}),jV=pq({type:[A]}),YV=pq(ok),xV(XV=BV((QV=Ye((JV=function(e){Ie(y,e);var t,n,i,a,o,r,s,l,u,c,h,d,p=xe(y);function y(){var _$e;Ce(this,y);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return je(_$e=p.call.apply(p,[this].concat(n)),"titleLabel",QV,Ne(_$e)),je(_$e,"timeLabel",ZV,Ne(_$e)),je(_$e,"playerCountLabel",$V,Ne(_$e)),je(_$e,"tournamentLeaders",eq,Ne(_$e)),je(_$e,"viewport",tq,Ne(_$e)),je(_$e,"playButton",nq,Ne(_$e)),je(_$e,"continueButton",iq,Ne(_$e)),je(_$e,"replayButton",aq,Ne(_$e)),je(_$e,"leaderSkeletons",oq,Ne(_$e)),je(_$e,"banners",rq,Ne(_$e)),je(_$e,"paperConfetti",sq,Ne(_$e)),_$e.animAbortSignal=null,_$e.fetchAbortController=null,_$e.leadersPayload=null,_$e.handleOpeningScreen=function(t){if(!_$e.screen)throw new Error("TournamentDetailScreen: screen not found");_$e.validateEventPayload(t)},_$e.handleOpenedScreen=function(t){_$e.validateEventPayload(t)&&_$e.open()},_$e}return Ae(y,[{key:"__preload",value:function value(){this.enabled=!1,this.screen=this.getComponent($x),this.tournamentScrollView=this.tournamentLeaders.node.getComponent(ue),this.validateRequiredComponents(),this.listenScreenEvents()}},{key:"onDestroy",value:function value(){this.unListenScreenEvents()}},{key:"validateRequiredComponents",value:function value(){St.lazyValidateProperties(this)}},{key:"listenScreenEvents",value:function value(){Eq.on(vq.OPENING_SCREEN,this.handleOpeningScreen),Eq.on(vq.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"unListenScreenEvents",value:function value(){Eq.off(vq.OPENING_SCREEN,this.handleOpeningScreen),Eq.off(vq.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"updateVisibility",value:function value(){this.tournamentLeaders.updateVisibility()}},{key:"validateEventPayload",value:function value(e){return(null!=e?e:{}).screenName===this.node.name&&(this.payload=e,!0)}},{key:"open",value:function value(){if(this.updateButtonVisibility(),this.setPlayerCountWaiting(),this.runPopUpAnimation(),this.node.scene.emit(Co.HIDE_UI),this.tournamentScrollView.node.on(ue.EventType.SCROLLING,this.updateVisibility,this),null!==this.animAbortSignal)throw new Error("TournamentContent: TournamentContent is already loading. Please handle cancelling gracefully.");this.animAbortSignal=new Bn,this.updateInfo(this.animAbortSignal)}},{key:"close",value:function value(){Mu.closeTournamentDetailScreen(),this.node.scene.emit(Co.SHOW_UI),this.tournamentScrollView.node.off(ue.EventType.SCROLLING,this.updateVisibility,this),this.cleanup()}},{key:"cleanup",value:function value(){var _$e,t;null===(_$e=this.fetchAbortController)||void 0===_$e||_$e.abort(),null===(t=this.animAbortSignal)||void 0===t||t.abort(),this.animAbortSignal=null,this.fetchAbortController=null,this.tournamentLeaders.removeLeaders()}},{key:"runPopUpAnimation",value:function value(){this.screen.container||console.warn("StartLevelScreen: screen not found")}},{key:"updateInfo",value:(d=Ee(function(e){var t,n,i,a,o,r,s,l,u,c,h,d,p,_$y,f,v,_,m,g,b,S,w,_tmp;return _ts_generator(this,function(_state){switch(_state.label){case 0:a=null===(t=this.payload)||void 0===t||null===(t=t.screenData)||void 0===t?void 0:t.tournament;if(!a)return[3,7];o=JSON.parse(a);o.id=o.id.toString(),this.tournamentPayload=o;r=this.tournamentPayload,s=r.endTime,l=r.payload,u=r.title,c=l.leaderboardId,h=void 0===c?"":c,d=l.themeId;this.updateTitle(u),this.updateEndTime(s),this.updateTournamentBanner(d);p=Cq.getStorage("tournament"),_$y=p.previousScore,f=p.previousRank,v=p.animateTournamentLeader;this.updateButtonsVisibility(v);return[4,this.showLoading(e)];case 1:_state.sent();_=this;return[4,this.getLeadersPayload(h)];case 2:if(_.leadersPayload=_state.sent(),!this.leadersPayload)return[2,(this.updatePlayerCount(0),void this.hideLoading(e))];m=this.leadersPayload,g=m.player,b=m.leaders;this.updatePlayerCount(b.length);S=null!==(n=null==g?void 0:g.score)&&void 0!==n?n:0,w=null!==(i=null==g?void 0:g.rank)&&void 0!==i?i:0;g&&v&&_$y&&_$y<S&&f&&f!==w&&(wq.search(b,function(e){return e.playerId===g.playerId}).score=_$y);return[4,this.hideLoading(e)];case 3:_state.sent(),this.tournamentLeaders.updateData(b);return[4,this.runShowUpAnimation(e)];case 4:_state.sent();_tmp=v;if(!_tmp)return[3,6];Cq.setStorageData("tournament","animateTournamentLeader",!1);return[4,this.runPlayerRankChangeAnimation(e,S)];case 5:_tmp=_state.sent();_state.label=6;case 6:_tmp;_state.label=7;case 7:return[2]}})}),function(e){return d.apply(this,arguments)})},{key:"updateTournamentBanner",value:function value(e){e?this.activateThemeBanner(e):this.activateThemeBanner(Gl.SUMMER)}},{key:"activateThemeBanner",value:function value(e){var t=!1;this.banners.forEach(function(n){n.node.active=n.node.name.toLowerCase()===e,n.node.active&&(t=!0)}),t||this.banners.forEach(function(e){e.node.active=e.node.name.toLowerCase()===Gl.SUMMER})}},{key:"showLoading",value:(h=Ee(function(e){var t;var _arguments=arguments;return _ts_generator(this,function(_state){switch(_state.label){case 0:t=_arguments.length>1&&void 0!==_arguments[1]?_arguments[1]:0;return[4,Promise.all([this.leaderSkeletons.map(function(n,i){return n.show(i*t,e)})])];case 1:_state.sent();return[2]}})}),function(e){return h.apply(this,arguments)})},{key:"hideLoading",value:(c=Ee(function(e){return _ts_generator(this,function(_state){switch(_state.label){case 0:return[4,Promise.all(this.leaderSkeletons.map(function(t){return t.hide(e)}))];case 1:_state.sent();return[2]}})}),function(e){return c.apply(this,arguments)})},{key:"runShowUpAnimation",value:(u=Ee(function(e){var t,_tmp;return _ts_generator(this,function(_state){switch(_state.label){case 0:return[4,this.tournamentLeaders.showLeaders(e)];case 1:_state.sent();t=this.tournamentLeaders.getPlayerLeader();_tmp=t;if(!_tmp)return[3,3];return[4,this.scrollToLeader(t,1)];case 2:_tmp=_state.sent();_state.label=3;case 3:_tmp;return[2]}})}),function(e){return u.apply(this,arguments)})},{key:"runPlayerRankChangeAnimation",value:(l=Ee(function(e,t){var n,i,a,o,r,s,l,u,c,h,d,p,_$y;return _ts_generator(this,function(_state){switch(_state.label){case 0:n=this.tournamentLeaders.getLeaderData(),i=wq.search(n,function(e){return e.playerId===Tq.getPlayerId()});if(!i)return[3,4];a=i.score,o=i.rank;if(!(a!==t))return[3,4];i.score=t,n.sort(function(e,t){return t.score-e.score}),n.forEach(function(e,t){e.rank=t+1});r=this.tournamentLeaders.getPlayerLeader();if(!r)return[3,4];s=this.tournamentLeaders.getLeaderByRank(i.rank);if(!s)return[3,4];this.tournamentLeaders.layout.enabled=!1,r.node.setParent(this.node,!0);return[4,r.runScaleAnimation(e,1.1,.5)];case 1:_state.sent(),i.rank<=10&&Pi.playSound(vi.STAR_CHEST_DRUM_ROLL);l=Math.min(.5*(o-i.rank),2),u=[r.runUpdateDataAnimation(o,i.rank,a,i.score,l),this.scrollToLeader(s,l)],c=this.viewport.contentSize.height,h=this.viewport.getBoundingBoxToWorld(),d=this.tournamentScrollView.getMaxScrollOffset().y,p=-s.node.position.y-c/2,_$y=Y.ZERO;p<0?_$y=new Y(r.node.worldPosition.x,h.yMax+s.node.position.y,r.node.worldPosition.z):this.tournamentScrollView.getScrollOffset().y>=d-5&&(_$y=p<d?new Y(r.node.worldPosition.x,h.center.y,r.node.worldPosition.z):s.node.worldPosition),_$y.equals(Y.ZERO)||u.push(r.runWorldPositionAnimation(_$y,l));return[4,Promise.all(u)];case 2:_state.sent(),Pi.stopSound(vi.STAR_CHEST_DRUM_ROLL);return[4,Promise.all([r.runScaleAnimation(e,1,.25),r.node.setParent(this.tournamentLeaders.layout.node,!0),r.node.setSiblingIndex(i.rank-1),this.tournamentLeaders.runUpdateLeadersRankAnimation(i.rank,o),this.runPaperConfettiEffect(i.rank)])];case 3:_state.sent(),this.tournamentLeaders.layout.enabled=!0,this.tournamentLeaders.layout.updateLayout();_state.label=4;case 4:return[2]}})}),function(e,t){return l.apply(this,arguments)})},{key:"runPaperConfettiEffect",value:function value(e){e>10||(this.paperConfetti.runEffect(),Pi.playSound(vi.LEADERBOARD_TRIUMPH))}},{key:"scrollToLeader",value:(s=Ee(function(e,t){var n,i,a,o;return _ts_generator(this,function(_state){n=this.tournamentLeaders.uiTransform.contentSize,i=new Q(0,-e.node.position.y-n.height/2),a=this.tournamentScrollView.getScrollOffset().clone();i.y=Math.max(i.y,0),a.y=Math.max(a.y,0);o=i.y-a.y;if(!(Math.abs(o)<5))return[2,(this.tournamentScrollView.scrollToOffset(i,t),gn.waitTweenAsync(t))];return[2]})}),function(e,t){return s.apply(this,arguments)})},{key:"updateTitle",value:function value(e){e&&(this.titleLabel.string=e)}},{key:"updateEndTime",value:function value(e){var t=bq.getRelativeTime(e);t=(t=t.replace("seconds","secs").replace("second","sec")).replace("minutes","mins").replace("minute","min"),this.timeLabel.string="Ends ".concat(t)}},{key:"updatePlayerCount",value:function value(e){var t=Sq.getShortNumber(e,3);this.playerCountLabel.string="".concat(t," ")+(e>1?"players":"player")}},{key:"setPlayerCountWaiting",value:function value(){this.playerCountLabel.string="Loading..."}},{key:"getLeadersPayload",value:(r=Ee(function(e){var t,n,i,a,o,r,s,l;return _ts_generator(this,function(_state){switch(_state.label){case 0:t=Aq.getLeaderboardName(e);if(!t)return[2,null];return[4,Aq.requestLeaderboardAsync(t,0)];case 1:_state.sent();n=Aq.getLeaderboard(t);if(!n)return[2,null];a=gq.vals(n.leaders),o=Tq.getPlayerId(),r={leaders:[],player:void 0,isPlayerInTournament:!1},s=We(a);try{for(s.s();!(i=s.n()).done;){l=i.value;l.playerId===o?(r.player=l,r.isPlayerInTournament=!0,r.leaders.push(l)):r.leaders.push(l)}}catch(e){s.e(e)}finally{s.f()}return[2,r]}})}),function(e){return r.apply(this,arguments)})},{key:"updateButtonsVisibility",value:function value(e){this.playButton.active=!e,this.continueButton.active=e,this.replayButton.active=e}},{key:"handleOnPlay",value:(o=Ee(function(){var _$e,e,e1;return _ts_generator(this,function(_state){switch(_state.label){case 0:_$e=this.tournamentPayload.id||"";if(Wu.validateTournamentExpired(_$e))return[2,(this.close(),this.node.scene.emit(Cl.RELOAD_TOURNAMENT),void Mu.showNotificationScreen("Tournament has ended",2))];_state.label=1;case 1:_state.trys.push([1,4,,9]);Mu.showLoadingNotificationScreen();return[4,uu.setMatchCustomDataAsync({level:1,score:0})];case 2:_state.sent();return[4,this.processJoinTournament()];case 3:_state.sent();return[3,9];case 4:e=_state.sent();if(gq.hasOwn(e,"code")&&"USER_INPUT"===e.code)return[2,void Mu.closeNotificationScreen()];_state.label=5;case 5:_state.trys.push([5,7,,8]);return[4,this.processContinueTournament()];case 6:_state.sent();return[3,8];case 7:e1=_state.sent();if(gq.hasOwn(e1,"code")&&"USER_INPUT"===e1.code)return[2,void Mu.closeNotificationScreen()];console.error("processPlayButtonPressed",e1),Mu.showNotificationScreen("Sorry, you cannot join\nat this time.",2);return[3,8];case 8:return[3,9];case 9:return[2]}})}),function(){return o.apply(this,arguments)})},{key:"processJoinTournament",value:(a=Ee(function(){var e;return _ts_generator(this,function(_state){switch(_state.label){case 0:_state.trys.push([0,2,,3]);return[4,this.joinTournamentAsync()];case 1:_state.sent(),bu.switchScene(wl,{level:1});return[3,3];case 2:e=_state.sent();throw console.warn("processJoinTournament",e),e;case 3:return[2]}})}),function(){return a.apply(this,arguments)})},{key:"processContinueTournament",value:(i=Ee(function(){var e;return _ts_generator(this,function(_state){switch(_state.label){case 0:_state.trys.push([0,2,,3]);return[4,this.continueTournamentAsync()];case 1:_state.sent(),bu.switchScene(wl,{level:1});return[3,3];case 2:e=_state.sent();throw console.warn("processContinueTournament",e),e;case 3:return[2]}})}),function(){return i.apply(this,arguments)})},{key:"joinTournamentAsync",value:(n=Ee(function(){var _$e;return _ts_generator(this,function(_state){switch(_state.label){case 0:_$e=this.tournamentPayload.id||"";return[4,uu.joinTournamentAsync(_$e)];case 1:_state.sent();return[2]}})}),function(){return n.apply(this,arguments)})},{key:"continueTournamentAsync",value:(t=Ee(function(){var _$e,t;return _ts_generator(this,function(_state){switch(_state.label){case 0:t=null!==(_$e=GameSDK.context.getID())&&void 0!==_$e?_$e:"";return[4,uu.continueTournamentAsync(t)];case 1:_state.sent();return[2]}})}),function(){return t.apply(this,arguments)})},{key:"updateButtonVisibility",value:function value(){var _$e,t,n=(null!==(_$e=null===(t=this.payload)||void 0===t?void 0:t.screenData)&&void 0!==_$e?_$e:{}).tournamentContextType;switch(void 0===n?"tournament_start":n){case"tournament_end":this.playButton.active=!1,this.continueButton.active=!0,this.replayButton.active=!0;break;case"tournament_start":this.playButton.active=!0,this.continueButton.active=!1,this.replayButton.active=!1}}}]),y}(y)).prototype,"titleLabel",[FV],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ZV=Ye(JV.prototype,"timeLabel",[zV],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),$V=Ye(JV.prototype,"playerCountLabel",[GV],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),eq=Ye(JV.prototype,"tournamentLeaders",[UV],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),tq=Ye(JV.prototype,"viewport",[HV],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),nq=Ye(JV.prototype,"playButton",[VV],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),iq=Ye(JV.prototype,"continueButton",[qV],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),aq=Ye(JV.prototype,"replayButton",[WV],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),oq=Ye(JV.prototype,"leaderSkeletons",[KV],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return[]}}),rq=Ye(JV.prototype,"banners",[jV],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return[]}}),sq=Ye(JV.prototype,"paperConfetti",[YV],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),XV=JV))||XV);n._RF.pop(),n._RF.push({},"36d58kn8v5POaqgX4C8S3ct","TournamentLeader",void 0);(0,i.ccclass)("TournamentLeader")(hq=function(e){Ie(n,e);var t=xe(n);function n(){return Ce(this,n),t.apply(this,arguments)}return Ae(n)}(CL));n._RF.pop(),n._RF.push({},"43001Am3F9GVZjL3Nj2K44h","CoreManager",void 0);var Rq=GameCore.Events,Iq=globalThis.game,Pq=Iq.event,_q=Iq.monitorError,Lq=function(){function e(){var t=this;Ce(this,e),this.callbackCoreBooting=null,this.callbackCoreStarting=null,this.callbackCoreReady=null,this.handleWhenCoreBooting=function(){if(!t.callbackCoreBooting)return console.error("Core: Booting callback is not set"),void(null==_q||_q.sendException(new Error("Core: Booting callback is not set")));console.info("\uD83D\uDE80 Core: Boot"),t.callbackCoreBooting(),t.callbackCoreBooting=null},this.handleWhenCoreStarting=function(){if(!t.callbackCoreStarting)return console.error("Core: Starting callback is not set"),void(null==_q||_q.sendException(new Error("Core: Starting callback is not set")));console.info("\uD83D\uDE80 Core: Starting"),t.callbackCoreStarting(),t.callbackCoreStarting=null},this.handleWhenCoreReady=function(){if(!t.callbackCoreReady)return console.error("Core: Ready callback is not set"),void(null==_q||_q.sendException(new Error("Core: Ready callback is not set")));console.info("\uD83D\uDE80 Core: Ready"),t.callbackCoreReady(),t.callbackCoreReady=null}}return Ae(e,[{key:"init",value:function value(){this.listenEvents(),console.info("Core Manager: Initialized")}},{key:"listenEvents",value:function value(){Pq.once(Rq.CORE_BOOTING,this.handleWhenCoreBooting),Pq.once(Rq.CORE_STARTING,this.handleWhenCoreStarting),Pq.once(Rq.CORE_READY,this.handleWhenCoreReady)}},{key:"requestStart",value:function value(){Pq.emit(Rq.REQUEST_CORE_START)}},{key:"onCoreBoot",value:function value(e){this.callbackCoreBooting=e,Pq.getEventEmitCount(Rq.CORE_BOOTING)>0&&(Pq.off(Rq.CORE_BOOTING,this.handleWhenCoreBooting),this.handleWhenCoreBooting())}},{key:"onCoreStart",value:function value(e){this.callbackCoreStarting=e,Pq.getEventEmitCount(Rq.CORE_STARTING)>0&&(Pq.off(Rq.CORE_STARTING,this.handleWhenCoreStarting),this.handleWhenCoreStarting())}},{key:"onCoreReady",value:function value(e){this.callbackCoreReady=e,Pq.getEventEmitCount(Rq.CORE_READY)>0&&(Pq.off(Rq.CORE_READY,this.handleWhenCoreReady),this.handleWhenCoreReady())}}]),e}();n._RF.pop(),n._RF.push({},"b4ad5mMokdAa6EVNGzNedpF","EngineManager",void 0);var Oq=GameCore,Dq=Oq.Configs.GameEngine.DynamicAtlas,Nq=Oq.Utils.Valid,Mq=function(){function e(){var t=this;Ce(this,e),this.overrideSettings=function(){fe.overrideSettings(ve.Category.ENGINE,"debug",Nq.isDebugger())},this.handleResizeView=function(e){le.instance.resizeWithBrowserSize(!1);var n=e.width,i=e.height;t.resizeView(n,i)},this.handleViewResized=function(e){var t=e.width,n=e.height;le.instance.resizeWithBrowserSize(!0),console.info("✨ New View Size",{width:t,height:n})}}return Ae(e,[{key:"init",value:function value(){this.overrideSettings(),this.setupAutoAtlas(),this.setupBatcherLimit(),this.setupDynamicAtlas(),this.listenEvents(),console.info("Engine Manager: Initialized")}},{key:"listenEvents",value:function value(){W.on(Ta,this.handleResizeView),W.on(Aa,this.handleViewResized)}},{key:"setupAutoAtlas",value:function value(){de.instance.cacheAsset=!0}},{key:"setupDynamicAtlas",value:function value(){switch(j.os){case j.OS.IOS:this.setupDynamicAtlasForIOS();break;case j.OS.ANDROID:this.setupDynamicAtlasForAndroid();break;default:this.setupDynamicAtlasForDesktop()}}},{key:"setDynamicAtlas",value:function value(e){var t=e.Enabled,n=e.AutoAtlasSize,i=e.MaxAtlasCount,a=e.MaxAtlasSize,o=e.MaxFrameSize;if(pe.instance.enabled=t,pe.instance.textureSize=a,pe.instance.maxFrameSize=o,pe.instance.maxAtlasCount=i,pe.instance.textureBleeding=!0,n){var r=this.getMaxTextureSize();if(!r)return;pe.instance.maxAtlasCount=1,pe.instance.textureSize=r}}},{key:"getMaxTextureSize",value:function value(){if(!p.root)return-1;var _$e=p.root.device.capabilities.maxTextureSize;return _$e>8192?7168:_$e-1024}},{key:"setupDynamicAtlasForIOS",value:function value(){var _$e=Dq.IOS;this.setDynamicAtlas(_$e)}},{key:"setupDynamicAtlasForAndroid",value:function value(){var _$e=Dq.Android;this.setDynamicAtlas(_$e)}},{key:"setupDynamicAtlasForDesktop",value:function value(){var _$e=Dq.Desktop;this.setDynamicAtlas(_$e)}},{key:"setupBatcherLimit",value:function value(){ye.BATCHER2D_MEM_INCREMENT=288,ye.MAX_LABEL_CANVAS_POOL_SIZE=125}},{key:"resizeView",value:function value(e,t){var n,i=window.devicePixelRatio,a=i>=2?2/i:1,o=e*i*a,r=t*i*a;null===(n=p.root)||void 0===n||n.resize(o,r),F.windowSize=new z.Size(o,r),p.once(Z.EVENT_AFTER_UPDATE,function(){W.emit(Aa,{width:o,height:r})})}}]),e}();n._RF.pop();var xq,Bq=new(function(){function e(){Ce(this,e),this._registry={},this._moduleCache={}}return Ae(e,[{key:"define",value:function value(e,t,n){this._registry[e]={factory:t,resolveMap:n}}},{key:"require",value:function value(e){return this._require(e)}},{key:"throwInvalidWrapper",value:function value(e,t){throw new Error("Module '".concat(e,"' imported from '").concat(t,"' is expected be an ESM-wrapped CommonJS module but it doesn't."))}},{key:"_require",value:function value(e,t){var n=this._moduleCache[e];if(n)return n.exports;var i={id:e,exports:{}};return this._moduleCache[e]=i,this._tryModuleLoad(i,e),i.exports}},{key:"_resolve",value:function value(e,t){return this._resolveFromInfos(e,t)||this._throwUnresolved(e,t)}},{key:"_resolveFromInfos",value:function value(e,t){var n,i;return e in cjsInfos?e:t&&null!==(n=null===(i=cjsInfos[t])||void 0===i?void 0:i.resolveCache[e])&&void 0!==n?n:void 0}},{key:"_tryModuleLoad",value:function value(e,t){var n=!0;try{this._load(e,t),n=!1}finally{n&&delete this._moduleCache[t]}}},{key:"_load",value:function value(e,t){var n=this._loadWrapper(t),i=n.factory,a=n.resolveMap,o=this._createRequire(e),r=a?this._createRequireWithResolveMap("function"==typeof a?a():a,o):o;i(e.exports,r,e)}},{key:"_loadWrapper",value:function value(e){return e in this._registry?this._registry[e]:this._loadHostProvidedModules(e)}},{key:"_loadHostProvidedModules",value:function value(e){return{factory:function factory(t,n,i){if("undefined"==typeof require)throw new Error("Current environment does not provide a require() for requiring '".concat(e,"'."));try{i.exports=require(e)}catch(t){throw new Error("Exception thrown when calling host defined require('".concat(e,"')."),{cause:t})}}}}},{key:"_createRequire",value:function value(e){var t=this;return function(n){return t._require(n,e)}}},{key:"_createRequireWithResolveMap",value:function value(e,t){return function(n){var i=e[n];if(i)return t(i);throw new Error("Unresolved specifier "+n)}}},{key:"_throwUnresolved",value:function value(e,t){throw new Error("Unable to resolve ".concat(e," from ").concat(parent,"."))}}]),e}());function Fq(e){return(Fq="function"==typeof Symbol&&"symbol"==_type_of(Symbol.iterator)?function Fq(e){return typeof e==="undefined"?"undefined":_type_of(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e==="undefined"?"undefined":_type_of(e)})(e)}var zq="file:///D:/VSCode%20Project/tile-connect-remaster-game/node_modules/resize-observer-polyfill/dist/ResizeObserver.js";Bq.define(zq,function(e,t,n,i,a){!function(t,i){"object"===Fq(e)&&void 0!==n?n.exports=i():"function"==typeof define&&define.amd?define(i):t.ResizeObserver=i()}(this,function(){var _$e=function(){if("undefined"!=typeof Map)return Map;function e(e,t){var _$n=-1;return e.some(function(e,i){return e[0]===t&&(_$n=i,!0)}),_$n}return function(){function t(){this.__entries__=[]}return Object.defineProperty(t.prototype,"size",{get:function get(){return this.__entries__.length},enumerable:!0,configurable:!0}),t.prototype.get=function(t){var _$n=e(this.__entries__,t),i=this.__entries__[_$n];return i&&i[1]},t.prototype.set=function(t,n){var i=e(this.__entries__,t);~i?this.__entries__[i][1]=n:this.__entries__.push([t,n])},t.prototype.delete=function(t){var _$n=this.__entries__,i=e(_$n,t);~i&&_$n.splice(i,1)},t.prototype.has=function(t){return!!~e(this.__entries__,t)},t.prototype.clear=function(){this.__entries__.splice(0)},t.prototype.forEach=function(e,t){void 0===t&&(t=null);for(var _$n=0,i=this.__entries__;_$n<i.length;_$n++){var a=i[_$n];e.call(t,a[1],a[0])}},t}()}(),t="undefined"!=typeof window&&"undefined"!=typeof document&&window.document===document,_$n="undefined"!=typeof global&&global.Math===Math?global:"undefined"!=typeof self&&self.Math===Math?self:"undefined"!=typeof window&&window.Math===Math?window:Function("return this")(),i="function"==typeof requestAnimationFrame?requestAnimationFrame.bind(_$n):function i(e){return setTimeout(function(){return e(Date.now())},1e3/60)};var a=["top","right","bottom","left","width","height","size","weight"],o="undefined"!=typeof MutationObserver,r=function(){function e(){this.connected_=!1,this.mutationEventsAdded_=!1,this.mutationsObserver_=null,this.observers_=[],this.onTransitionEnd_=this.onTransitionEnd_.bind(this),this.refresh=function(e,t){var _$n=!1,a=!1,o=0;function r(){_$n&&(_$n=!1,e()),a&&l()}function s(){i(r)}function l(){var _$e=Date.now();if(_$n){if(_$e-o<2)return;a=!0}else _$n=!0,a=!1,setTimeout(s,t);o=_$e}return l}(this.refresh.bind(this),20)}return e.prototype.addObserver=function(e){~this.observers_.indexOf(e)||this.observers_.push(e),this.connected_||this.connect_()},e.prototype.removeObserver=function(e){var t=this.observers_,_$n=t.indexOf(e);~_$n&&t.splice(_$n,1),!t.length&&this.connected_&&this.disconnect_()},e.prototype.refresh=function(){this.updateObservers_()&&this.refresh()},e.prototype.updateObservers_=function(){var _$e=this.observers_.filter(function(e){return e.gatherActive(),e.hasActive()});return _$e.forEach(function(e){return e.broadcastActive()}),_$e.length>0},e.prototype.connect_=function(){t&&!this.connected_&&(document.addEventListener("transitionend",this.onTransitionEnd_),window.addEventListener("resize",this.refresh),o?(this.mutationsObserver_=new MutationObserver(this.refresh),this.mutationsObserver_.observe(document,{attributes:!0,childList:!0,characterData:!0,subtree:!0})):(document.addEventListener("DOMSubtreeModified",this.refresh),this.mutationEventsAdded_=!0),this.connected_=!0)},e.prototype.disconnect_=function(){t&&this.connected_&&(document.removeEventListener("transitionend",this.onTransitionEnd_),window.removeEventListener("resize",this.refresh),this.mutationsObserver_&&this.mutationsObserver_.disconnect(),this.mutationEventsAdded_&&document.removeEventListener("DOMSubtreeModified",this.refresh),this.mutationsObserver_=null,this.mutationEventsAdded_=!1,this.connected_=!1)},e.prototype.onTransitionEnd_=function(e){var t=e.propertyName,_$n=void 0===t?"":t;a.some(function(e){return!!~_$n.indexOf(e)})&&this.refresh()},e.getInstance=function(){return this.instance_||(this.instance_=new e),this.instance_},e.instance_=null,e}(),s=function s(e,t){for(var _$n=0,i=Object.keys(t);_$n<i.length;_$n++){var a=i[_$n];Object.defineProperty(e,a,{value:t[a],enumerable:!1,writable:!1,configurable:!0})}return e},l=function l(e){return e&&e.ownerDocument&&e.ownerDocument.defaultView||_$n},u=f(0,0,0,0);function c(e){return parseFloat(e)||0}function h(e){for(var t=[],_$n=1;_$n<arguments.length;_$n++)t[_$n-1]=arguments[_$n];return t.reduce(function(t,n){return t+c(e["border-"+n+"-width"])},0)}function d(e){var t=e.clientWidth,_$n=e.clientHeight;if(!t&&!_$n)return u;var i=l(e).getComputedStyle(e),a=function(e){for(var t={},_$n=0,i=["top","right","bottom","left"];_$n<i.length;_$n++){var a=i[_$n],o=e["padding-"+a];t[a]=c(o)}return t}(i),o=a.left+a.right,r=a.top+a.bottom,s=c(i.width),d=c(i.height);if("border-box"===i.boxSizing&&(Math.round(s+o)!==t&&(s-=h(i,"left","right")+o),Math.round(d+r)!==_$n&&(d-=h(i,"top","bottom")+r)),!function(e){return e===l(e).document.documentElement}(e)){var p=Math.round(s+o)-t,y=Math.round(d+r)-_$n;1!==Math.abs(p)&&(s-=p),1!==Math.abs(y)&&(d-=y)}return f(a.left,a.top,s,d)}var p="undefined"!=typeof SVGGraphicsElement?function p(e){return _instanceof(e,l(e).SVGGraphicsElement)}:function(e){return _instanceof(e,l(e).SVGElement)&&"function"==typeof e.getBBox};function y(e){return t?p(e)?function(e){var t=e.getBBox();return f(0,0,t.width,t.height)}(e):d(e):u}function f(e,t,n,i){return{x:e,y:t,width:n,height:i}}var v=function(){function e(e){this.broadcastWidth=0,this.broadcastHeight=0,this.contentRect_=f(0,0,0,0),this.target=e}return e.prototype.isActive=function(){var _$e=y(this.target);return this.contentRect_=_$e,_$e.width!==this.broadcastWidth||_$e.height!==this.broadcastHeight},e.prototype.broadcastRect=function(){var _$e=this.contentRect_;return this.broadcastWidth=_$e.width,this.broadcastHeight=_$e.height,_$e},e}(),m=function m(e,t){var _$n,i,a,o,r,l,u,c=(i=(_$n=t).x,a=_$n.y,o=_$n.width,r=_$n.height,l="undefined"!=typeof DOMRectReadOnly?DOMRectReadOnly:Object,u=Object.create(l.prototype),s(u,{x:i,y:a,width:o,height:r,top:a,right:i+o,bottom:r+a,left:i}),u);s(this,{target:e,contentRect:c})},g=function(){function t(t,n,i){if(this.activeObservations_=[],this.observations_=new _$e,"function"!=typeof t)throw new TypeError("The callback provided as parameter 1 is not a function.");this.callback_=t,this.controller_=n,this.callbackCtx_=i}return t.prototype.observe=function(e){if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");if("undefined"!=typeof Element&&_instanceof(Element,Object)){if(!_instanceof(e,l(e).Element))throw new TypeError('parameter 1 is not of type "Element".');var _$t=this.observations_;_$t.has(e)||(_$t.set(e,new v(e)),this.controller_.addObserver(this),this.controller_.refresh())}},t.prototype.unobserve=function(e){if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");if("undefined"!=typeof Element&&_instanceof(Element,Object)){if(!_instanceof(e,l(e).Element))throw new TypeError('parameter 1 is not of type "Element".');var _$t=this.observations_;_$t.has(e)&&(_$t.delete(e),_$t.size||this.controller_.removeObserver(this))}},t.prototype.disconnect=function(){this.clearActive(),this.observations_.clear(),this.controller_.removeObserver(this)},t.prototype.gatherActive=function(){var _$e=this;this.clearActive(),this.observations_.forEach(function(t){t.isActive()&&_$e.activeObservations_.push(t)})},t.prototype.broadcastActive=function(){if(this.hasActive()){var _$e=this.callbackCtx_,_$t=this.activeObservations_.map(function(e){return new m(e.target,e.broadcastRect())});this.callback_.call(_$e,_$t,_$e),this.clearActive()}},t.prototype.clearActive=function(){this.activeObservations_.splice(0)},t.prototype.hasActive=function(){return this.activeObservations_.length>0},t}(),b="undefined"!=typeof WeakMap?new WeakMap:new _$e,S=function e(t){if(!_instanceof(this,e))throw new TypeError("Cannot call a class as a function.");if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");var _$n=r.getInstance(),i=new g(t,_$n,this);b.set(this,i)};return["observe","unobserve","disconnect"].forEach(function(e){S.prototype[e]=function(){var t;return(t=b.get(this))[e].apply(t,arguments)}}),void 0!==_$n.ResizeObserver?_$n.ResizeObserver:S}),xq=n.exports},{}),Bq.require(zq),n._RF.push({},"9f0a0l1uXlNwqKEKardFRyv","LayoutManager",void 0);var Gq=za,Uq=Ga,Hq=Uq.Portrait,Vq=Uq.Landscape,qq=GameCore.Utils.Function,Wq=function(){function e(){var t=this;Ce(this,e),this.currentLayout="",this.handleViewResizeBySystem=function(e){console.info("\uD83D\uDCF1 View resize by system"),window.devicePixelRatio=e||window.devicePixelRatio,t.setupOrientationByScreenSize(),t.resizeGameView()},this.handleViewResize=qq.debounce(function(){console.info("\uD83D\uDCF1 View resize by window"),t.setupOrientationByScreenSize(),t.resizeGameView()},200),this.handleBodyResize=qq.debounce(function(){t.resizeGameDiv()&&(console.info("\uD83D\uDCF1 View resize by body"),t.setupOrientationByScreenSize(),t.resizeGameView())},200)}return Ae(e,[{key:"init",value:function value(){this.listenResizeEvent(),this.listenObserverEvent(),this.setupResolutionPolicy(),W.emit(Ra),console.info("Layout Manager: Initialized")}},{key:"listenResizeEvent",value:function value(){j.isBrowser?(F.on("window-resize",this.handleViewResize,this),F.on("orientation-change",this.handleViewResize,this)):j.isMobile?window.addEventListener("resize",this.handleViewResize,{capture:!1,passive:!0}):console.warn("LayoutManager: Not support this platform"),W.on(Ra,this.handleViewResizeBySystem)}},{key:"listenObserverEvent",value:function value(){new xq(this.handleBodyResize).observe(document.body)}},{key:"setupResolutionPolicy",value:function value(){le.instance.resizeWithBrowserSize(!0),le.instance.setOrientation(ye.ORIENTATION_AUTO),le.instance.setResolutionPolicy(me.ContentStrategy.FIXED_WIDTH),le.instance.setResolutionPolicy(me.ContainerStrategy.EQUAL_TO_FRAME),this.resolutionPolicy=le.instance.getResolutionPolicy()}},{key:"setupOrientationByScreenSize",value:function value(){var _$e=this.getScreenRatio();this.resolutionPolicy.setContentStrategy(me.ContentStrategy.FIXED_WIDTH),_$e<1?this.setPortraitView():this.setLandscapeView()}},{key:"resizeGameDiv",value:function value(){var _$e=document.getElementById("GameDiv");if(!_$e)return!1;var t=ua.getScreenWidthCss(),n=ua.getScreenHeightCss(),i=_$e.getBoundingClientRect(),a=i.width,o=i.height;return(t!==a||n!==o)&&(_$e.style.width="".concat(t,"px"),_$e.style.height="".concat(n,"px"),!0)}},{key:"resizeGameView",value:function value(){var _$e=ua.getScreenWidthCss(),t=ua.getScreenHeightCss();W.emit(Ta,{width:_$e,height:t})}},{key:"setPortraitView",value:function value(){var _$e=Hq.WIDTH,t=Hq.HEIGHT;this.currentLayout=Gq.Portrait,this.changeDesignResolutionSize(_$e,t)}},{key:"setLandscapeView",value:function value(){var _$e=Vq.WIDTH,t=Vq.HEIGHT;this.currentLayout=Gq.Landscape,this.changeDesignResolutionSize(_$e,t)}},{key:"changeDesignResolutionSize",value:function value(e,t){le.instance.setDesignResolutionSize(e,t,this.resolutionPolicy),W.emit(Ia,this.currentLayout),console.info("\uD83D\uDCF1 Change layout to",this.currentLayout)}},{key:"getScreenRatio",value:function value(){return ua.getScreenWidthCss()/ua.getScreenHeightCss()}}]),e}();n._RF.pop(),n._RF.push({},"535cbXcmXdEzLn3H3LOIS27","MatchManager",void 0);var Kq=GameCore,jq=Kq.Utils,Yq=jq.Valid,Xq=jq.Object,Jq=jq.Array,Qq=Kq.Dtos.Match,Zq=Qq.CustomData,$q=Qq.Data,eW=["code","cols","encoding","idSize","rows"],tW=["addRandomTilesPerMove","maxSpaceOfPair"],nW=function(){function e(){Ce(this,e)}return Ae(e,[{key:"init",value:function value(){console.info("Match Manager: Initialized")}},{key:"setupDefaultMatchData",value:function value(){this.setupMatchData(),this.setupMatchCustomData()}},{key:"setupMatchCustomData",value:function value(){Zq.addDefaultData(gl),Zq.addValidateFunction("score",function(e){if(!Yq.isNumber(e)||e<0)throw new Error("score ".concat(e," is invalid"))})}},{key:"setupMatchData",value:function value(){var _$e=this;$q.addDefaultData(ul),$q.addValidateFunction("extraData",function(t){if(null!=t){if(!Yq.isObject(t))throw new Error("extraData ".concat(t," must be a record of string keys"));var n=t,i=Object.keys(n);if(!Jq.has(i,"level"))throw new Error("extraData.level is missing");if(!Yq.isNumber(n.level))throw new Error("extraData.level ".concat(n.level," must be a number"));if(!Jq.has(i,"fen"))throw new Error("extraData.fen is missing");if(_$e.validateFen(n.fen),!Jq.has(i,"gravity"))throw new Error("extraData.gravity is missing");if(!Yq.isString(n.gravity))throw new Error("extraData.gravity ".concat(n.gravity," must be a string"));if(!Jq.has(i,"rules"))throw new Error("extraData.rules is missing");if(_$e.validateLevelRules(n.rules),!Jq.has(i,"time"))throw new Error("extraData.time is missing");if(!Yq.isNumber(n.time))throw new Error("extraData.time ".concat(n.time," must be a number"))}})}},{key:"validateFen",value:function value(e){if(!Yq.isObject(e))throw new Error("extraData.fen ".concat(e," must be a record of string keys"));var t=this.validateKeys(e,eW);if(!Yq.isNumber(t.idSize))throw new Error("fen.idSize must be a number");if(!Yq.isString(t.code))throw new Error("fen.code must be a string");if(!Yq.isNumber(t.rows))throw new Error("fen.rows must be a number");if(!Yq.isNumber(t.cols))throw new Error("fen.cols must be a number");if(!Yq.isObject(t.encoding))throw new Error("fen.encoding must be a record of string keys");var n=this.validateKeys(t.encoding,Xq.vals(_c));Object.entries(n).forEach(function(e){var t=Ue(e,2),n=t[0],i=t[1];if(!Yq.isString(i))throw new Error("fen.encoding.".concat(n," ").concat(i," must be a string"))})}},{key:"validateLevelRules",value:function value(e){if(!Yq.isObject(e))throw new Error("extraData.rules ".concat(e," must be a record of string keys"));var t=this.validateKeys(e,tW);if(!Yq.isNumber(t.addRandomTilesPerMove))throw new Error("rules.addRandomTilesPerMove must be a number");if(!Yq.isNumber(t.maxSpaceOfPair))throw new Error("rules.maxSpaceOfPair must be a number")}},{key:"validateKeys",value:function value(e,t){return Object.keys(e).forEach(function(e){if(!Jq.has(t,e))throw new Error("Key ".concat(e," is missing"))}),e}}]),e}();n._RF.pop(),n._RF.push({},"d675ctpYslBHp4qqiYEki+q","PlayerManager",void 0);var iW=GameCore,aW=iW.Utils,oW=aW.Valid,rW=aW.Array,sW=aW.Object,lW=iW.Dtos,uW=globalThis.game.player,cW=function(){function e(){Ce(this,e)}return Ae(e,[{key:"init",value:function value(){console.info("Player Manager: Initialized")}},{key:"setupDefaultGameData",value:function value(){var _$e=lW.Player;_$e.Data.addDefaultData(bl),_$e.GameData.addDefaultData(pl),_$e.GameData.addValidateFunction("stars",function(e){if(!oW.isNumber(e)||e<0)throw new Error("stars ".concat(e," is invalid"))}),_$e.GameData.addValidateFunction("totalLevel",function(e){if(!oW.isNumber(e)||e<1)throw new Error("totalLevel ".concat(e," is invalid"))}),_$e.GameData.addValidateFunction("levelVersion",function(e){if(!oW.isNumber(e)||e<0)throw new Error("levelVersion ".concat(e," is invalid"))}),_$e.GameData.addValidateFunction("lastRewardedItems",function(e){if(!oW.isNumber(e)||e<0)throw new Error("lastRewardedItems ".concat(e," is invalid"))}),_$e.GameData.addValidateFunction("lastCreateTournamentShown",function(e){if(!oW.isNumber(e)||e<0)throw new Error("lastCreateTournamentShown ".concat(e," is invalid"))}),_$e.GameData.addValidateFunction("guideItemShowed",function(e){if(!Array.isArray(e))throw new Error("guideItemShowed ".concat(e," is invalid"))}),_$e.GameData.addValidateFunction("items",function(e){if(!oW.isObject(e))throw new Error("items ".concat(e," is invalid"));var t=Object.keys(e),n=sW.vals(e);if(!rW.has(t,tl.HINT))throw new Error("item ".concat(tl.HINT," not found"));if(!rW.has(t,tl.THUNDER))throw new Error("item ".concat(tl.THUNDER," not found"));if(!rW.has(t,tl.STORM))throw new Error("item ".concat(tl.STORM," not found"));if(!rW.has(t,tl.PLIERS))throw new Error("item ".concat(tl.PLIERS," not found"));n.forEach(function(e){if(!oW.isNumber(e)||e<0)throw new Error("item ".concat(e," is invalid"))})}),_$e.GameData.addValidateFunction("skins",function(e){if(!oW.isObject(e))throw new Error("skins ".concat(e," is invalid"))})}},{key:"requestConnectedPlayers",value:function value(){uW.requestConnectedPlayers().catch(function(e){console.warn("player.requestConnectedPlayers",e)})}}]),e}();n._RF.pop(),n._RF.push({},"51079bCfn9MZK6cuxbahS7M","AdaptivePerformance",void 0);var hW=GameCore,dW=hW.Events,pW=hW.Utils.Valid,yW=globalThis.game,fW=yW.event,vW=yW.adaptivePerformance,mW=function(){function e(){var t=this;Ce(this,e),this.handleBeginFrame=function(){p.on(Z.EVENT_AFTER_UPDATE,t.lateUpdate),p.on(Z.EVENT_BEFORE_UPDATE,t.updateActualFPS)},this.handleAfterSceneLaunch=function(e){vW&&vW.trackingScene(e.name)},this.handleRequestResizeGame=function(e){var t=e.forcePixelRatio;pW.isNumber(t)&&W.emit(Ra,t)},this.lateUpdate=function(){var _$e=1e3*W.deltaTime;null==vW||vW.updatePostStepDeltaTime(_$e)},this.updateActualFPS=function(){var _$e,t=null===(_$e=p.root)||void 0===_$e?void 0:_$e.fps;pW.isNumber(t)&&(null==vW||vW.updateActualFPS(t))}}return Ae(e,[{key:"init",value:function value(){vW&&this.listenEvents()}},{key:"listenEvents",value:function value(){fW.on(dW.REQUEST_RESIZE_GAME,this.handleRequestResizeGame),p.once(Z.EVENT_BEGIN_FRAME,this.handleBeginFrame),p.on(Z.EVENT_AFTER_SCENE_LAUNCH,this.handleAfterSceneLaunch)}}]),e}();n._RF.pop(),n._RF.push({},"0bbd4wf2fRDcKljBcls6K8a","CanvasRecorder",void 0);var gW=globalThis.game.canvasRecorder,bW=function(){function e(){Ce(this,e)}return Ae(e,[{key:"init",value:function value(){if(W.canvas&&gW){gW.setCanvas(W.canvas);var _$e=gW.getOptions(),t=gW.waitNextFrame;gW.waitNextFrame=Ee(function(){var _tmp;return _ts_generator(this,function(_state){switch(_state.label){case 0:if(!_$e.syncFps)return[3,1];_tmp=new Promise(function(e){p.once(Z.EVENT_AFTER_RENDER,e),W.pause(),W.step()});return[3,3];case 1:W.resume();return[4,t.call(gW)];case 2:_tmp=(_state.sent(),Promise.resolve());_state.label=3;case 3:return[2,_tmp]}})})}}}]),e}();n._RF.pop(),n._RF.push({},"4a29byVcRpBGogGcAwYASiP","CocosStats",void 0);var SW=function(){function e(){var t=this;Ce(this,e),this.hideCocosStats=function(){clearInterval(t.waiter),t.waiter=setInterval(t.checkProfilerReady,100)},this.checkProfilerReady=function(){if(K){K._showFPS=!1;var _$e=K._rootNode;_$e&&(_$e.active=!1,_$e.isValid&&(_$e.destroyAllChildren(),_$e.removeAllChildren(),_$e.destroy(),clearInterval(t.waiter)))}}}return Ae(e,[{key:"init",value:function value(){K&&p.on(Z.EVENT_BEFORE_SCENE_LAUNCH,this.hideCocosStats)}}]),e}();n._RF.pop(),n._RF.push({},"49a72YoKFFCKbOm5Xgp9R+k","DynamicAssets",void 0);var wW=GameCore,kW=wW.Configs.GameEngine.DynamicAssets,EW=wW.Events,CW=wW.Utils.Array,TW=globalThis.game.event,AW=[".png",".jpg",".jpeg",".webp"],RW=function(){function e(){var t=this;Ce(this,e),this.useHighQuality=!1,this.upgradableAssets=new Map,this.requestUpdateDynamicAssets=function(){W.emit(Ma)},this.collectUpgradableAssets=function(e){var n,i=We(e.output=e.input);try{for(i.s();!(n=i.n()).done;){var a=n.value;if(CW.has(AW,a.ext)&&!t.upgradableAssets.has(a.uuid)){t.useHighQuality&&(a.url=t.replaceAssetUrl(a.url),a.requestUpgrade=!0);var o={uuid:a.uuid,url:a.url,options:a.options,upgraded:a.upgraded,requestUpgrade:a.requestUpgrade,ext:a.ext};t.upgradableAssets.set(a.uuid,o)}}}catch(e){i.e(e)}finally{i.f()}},this.replaceAssetUrl=function(e){return t.useHighQuality?e.replace("native/","native32/"):e},this.handleUpgradeQuality=function(){t.useHighQuality=!0;var _$e=0,n=0,i=de.instance,a=i.assets,o=i.loadAny,r=0;t.upgradableAssets.forEach(function(i){if(i.upgraded||i.requestUpgrade)_$e++;else{n++;var s=a.get(i.uuid);_instanceof(s,O)?(i.url=t.replaceAssetUrl(i.url),console.info("DynamicAssets: Process upgrade quality",i.uuid,i,s),o(i,i.options,function(e,a){r++,e?console.warn("DynamicAssets: Upgrade error",e):(s.reset(a),i.upgraded=!0,t.upgradableAssets.set(i.uuid,i),console.info("DynamicAssets: Upgrade done",i.uuid,a,s),r>=n&&t.requestUpdateDynamicAssets())})):console.warn("DynamicAssets: Asset not found",i.uuid)}}),console.warn("DynamicAssets: Upgradable Assets Info",{needUpgrade:n,upgraded:_$e,total:t.upgradableAssets.size})}}return Ae(e,[{key:"init",value:function value(){var _$e=kW.Enabled;console.info("DynamicAssets: init",{EDITOR:false,Enabled:_$e}),_$e&&(de.instance.transformPipeline.insert(this.collectUpgradableAssets,3),this.listenEvents())}},{key:"listenEvents",value:function value(){var _$e=this;W.on(Na,this.handleUpgradeQuality),TW.on(EW.SCENE_LAUNCHED,function(t){var n=t.sceneName,i=[Sl];CW.has(i,n)||_$e.handleUpgradeQuality()})}}]),e}();n._RF.pop(),n._RF.push({},"15ecbqnx5lFtYRSJp2lOLCm","DynamicAtlas",void 0);var IW=GameCore,PW=IW.Configs.GameEngine.DynamicAtlas,_W=IW.Utils.Array,LW=IW.Events,OW=globalThis.game.event,DW=function(){function e(){var t=this;Ce(this,e),this.drawInfo=[],this.atlasInfo=null,this.lastRenderTime=0,this.updateRenderTime=function(){t.lastRenderTime=performance.now()},this.checkRenderTimeHighers=function(){var _$e=performance.now()-t.lastRenderTime;_$e>8&&(p.off(Z.EVENT_AFTER_RENDER,t.checkRenderTimeHighers),console.warn("DynamicAtlas: Laggy frame detected, render time is ".concat(_$e.toFixed(2),"ms")),t.requestUpdateDynamicAtlas(),setTimeout(function(){p.on(Z.EVENT_AFTER_RENDER,t.checkRenderTimeHighers)},2e3))},this.requestUpdateDynamicAtlas=function(){p.once(Z.EVENT_AFTER_RENDER,t.updateDynamicAtlas)},this.updateDynamicAtlas=function(){var _$e=p.getScene();if(_$e){var n=_$e.getComponentsInChildren(ge),i=[],a={};n.forEach(function(e){if(e.enabled&&e.node.activeInHierarchy&&"spriteFrame"in e&&_instanceof(e.spriteFrame,D)){var t=e.spriteFrame,n=t.uuid,o=t.packable,r=t.texture,s=t.original;if(o)if(_instanceof(r,be)){var l=r.getId(),u=r.width,c=r.height,h=(null==s?void 0:s._texture)||{width:0,height:0},d=h.width,p=h.height;if(s){var y=s._texture.getId();if(l===y)return void console.warn("DynamicAtlas: Skip original texture",e.name,{ori:s._texture,tex:r});l=y}var f=s?d:u,v=s?p:c;if(f<=1||v<=1)console.warn("DynamicAtlas: Skip invalid texture size",e.name,{w:f,h:v});else{var m={id:l,w:f+=2,h:v+=2,x:-1,y:-1};a[l]?a[l].components.push(e):(i.push(m),a[l]=we(we({},m),{},{name:n,components:[e]}))}}else console.warn("DynamicAtlas: Skip non-texture2d texture",e.name);else console.warn("DynamicAtlas: Skip non-packable texture",e.name)}}),console.info("DynamicAtlas: collect info",a),i.length<1||(console.info("DynamicAtlas: process textures",i),t.drawInfo=[],t.atlasInfo=null,t.generateDrawInfo(i),t.atlasInfo?(t.updateAtlasData(),t.refreshComponents(n)):console.warn("DynamicAtlas: Atlas info not found",{textures:i}))}},this.generateDrawInfo=function(e){if(!(e.length<1)){console.info("DynamicAtlas: generate draw info",e);var n=pe.instance.textureSize;if(t.calculateOptimizedAtlas(e,n),t.atlasInfo){var i=t.atlasInfo.textures;if(i.forEach(function(e){t.drawInfo.push(e)}),e.length>i.length){var a=e.filter(function(e){return!i.some(function(t){return t.id===e.id})});console.warn("DynamicAtlas: Missing textures",a),t.generateDrawInfo(a)}}else console.warn("DynamicAtlas: Atlas info not found",{textures:e})}},this.calculateOptimizedAtlas=function(e,n){var i=function(e){var t,_$n=0,i=0,a=We(e);try{for(a.s();!(t=a.n()).done;){var o=t.value;_$n+=o.w*o.h,i=Math.max(i,o.w)}}catch(e){a.e(e)}finally{a.f()}e.sort(function(e,t){return t.h-e.h});var r,s=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(_$n/.95)),i),h:1/0}],l=0,u=0,c=We(e);try{for(c.s();!(r=c.n()).done;)for(var h=r.value,d=s.length-1;d>=0;d--){var p=s[d];if(!(h.w>p.w||h.h>p.h)){if(h.x=p.x,h.y=p.y,u=Math.max(u,h.y+h.h),l=Math.max(l,h.x+h.w),h.w===p.w&&h.h===p.h){var y=s.pop();d<s.length&&(s[d]=y)}else h.h===p.h?(p.x+=h.w,p.w-=h.w):h.w===p.w?(p.y+=h.h,p.h-=h.h):(s.push({x:p.x+h.w,y:p.y,w:p.w-h.w,h:h.h}),p.y+=h.h,p.h-=h.h);break}}}catch(e){c.e(e)}finally{c.f()}return{w:l,h:u,fill:_$n/(l*u)||0}}(e),a=i.w,o=i.h,r=i.fill;a>n||o>n?e.pop()?t.calculateOptimizedAtlas(e,n):console.warn("DynamicAtlas: Texture size is too big",a,o,n):t.atlasInfo={textures:e,atlasSize:n,packedInfo:{width:a,height:o,fillRate:r}}},this.drawTexture=function(e,n,i){var a=n.texture,o=a.getId(),r=_W.search(He(t.drawInfo),function(e){return e.id===o})||{x:-1,y:-1},s=r.x,l=r.y;if(!(s<0||l<0)){var u=e._innerTextureInfos[o];u||(i&&(e._texture.drawTextureAt(a.image,s-1,l),e._texture.drawTextureAt(a.image,s+1,l),e._texture.drawTextureAt(a.image,s,l-1),e._texture.drawTextureAt(a.image,s,l+1)),e._texture.drawTextureAt(a.image,s,l),e._count++,e._innerTextureInfos[o]={texture:a,x:s,y:l});var c=n.rect,h=c.x,d=c.y;h+=(null==u?void 0:u.x)||s,d+=(null==u?void 0:u.y)||l;var p={texture:e._texture,x:h,y:d};return e._innerSpriteFrames.push(n),p}},this.refreshComponents=function(e){e.forEach(function(e){e.node.active&&(e.node.active=!1,e.node.active=!0)})}}return Ae(e,[{key:"init",value:function value(){var _$e=PW.TextureAtlasOptimize;_$e&&(console.info("DynamicAtlas: init",{TextureAtlasOptimize:_$e}),this.listenEvents(),this.overrideDynamicAtlas())}},{key:"listenEvents",value:function value(){OW.on(LW.SCENE_LAUNCHED,this.requestUpdateDynamicAtlas),W.on(Ma,this.requestUpdateDynamicAtlas),p.on(Z.EVENT_BEFORE_RENDER,this.updateRenderTime),p.on(Z.EVENT_AFTER_RENDER,this.checkRenderTimeHighers)}},{key:"overrideDynamicAtlas",value:function value(){var _$e=this,t=pe.instance;pe.instance.insertSpriteFrame=function(n){if(t._atlasIndex>=t._maxAtlasCount)return null;if(!n||n.original)return null;if(!n.packable)return null;var i=_$e.getAtlas(),a=i?i.insertSpriteFrame(n):null;return!a&&t._atlasIndex<t._maxAtlasCount?(i=_$e.getAtlas())?i.insertSpriteFrame(n):null:a}}},{key:"createAtlas",value:function value(){return pe.instance.newAtlas()}},{key:"getAtlas",value:function value(){var _$e=this,t=pe.instance,n=t._atlases,i=void 0===n?[]:n,a=t._atlasIndex,o=t.textureBleeding,r=i[a];return r||(r=this.createAtlas()),r.originalInsertSpriteFrame||(r.originalInsertSpriteFrame=r.insertSpriteFrame,r.insertSpriteFrame=function(t){return _$e.drawTexture(r,t,o)}),r}},{key:"updateAtlasData",value:function value(){if(this.atlasInfo){console.info("DynamicAtlas: atlas info",this.atlasInfo);var _$e=this.atlasInfo.packedInfo;pe.instance.reset();var t=this.getAtlas();if(t){var n=_$e.width,i=_$e.height,a=Math.max(n,i);t._texture.initWithSize(a,a),console.info("DynamicAtlas: Resize texture",a,t._texture)}}}}]),e}();n._RF.pop();var NW={text:{level:"Level",settings:"SETTINGS",music:"Music",sound:"Sound",vibrate:"Vibrate",resume:"CONTINUE",on:"ON",off:"OFF",notification:"Notification",adsNotComplete:"Sorry, No Rewards!\nYou have cancelled the ad!",loadingAds:"Loading ads...",loading:"Loading...",load:"Loading",rewardNotReady:"No ads to display!",next:"NEXT",completed:"COMPLETED",tryAgain:"TRY AGAIN",retry:"RETRY",congratulation:"CONGRATULATION",you_have_pass_all_levels:"You have passed all levels.",please_come_back_later:"Please come back later,\nwe will update soon!",start_over:"START OVER",confirmation:"CONFIRMATION",are_you_sure_to_start_over:"ARE YOU SURE TO START OVER?",you_will_play_the_game_again:"You will play the game again\nfrom the beginning, at level 1.",no:"NO",yes:"YES"},texture:{image:"image"}};n._RF.push({},"14b76Yew19JgY7K+L9F5mmu","Languages",void 0);var MW=GameCore.Events,xW=globalThis.game,BW=xW.event,FW=xW.language,zW=function(){function e(){var t=this;Ce(this,e),this.handleLanguageChanged=function(){var _$e=Ee(function(e){var n;return _ts_generator(this,function(_state){n=e.locale;W.emit("update-language",n),t.updateComponentInEditor();return[2]})});return function(t){return _$e.apply(this,arguments)}}()}var n,i,a;return Ae(e,[{key:"init",value:function value(){var _$e=this;this.addLanguage("en").then(function(){_$e.setLanguage("en"),_$e.listenEvent()})}},{key:"listenEvent",value:function value(){BW.on(MW.LANGUAGE_CHANGED,this.handleLanguageChanged)}},{key:"addLanguage",value:(a=Ee(function(e){var t;return _ts_generator(this,function(_state){switch(_state.label){case 0:return[4,this.getLangData(e)];case 1:t=_state.sent();FW.add(e,t);return[2]}})}),function(e){return a.apply(this,arguments)})},{key:"setLanguage",value:function value(e){FW.choose(e)}},{key:"getLangData",value:(i=Ee(function(e){return _ts_generator(this,function(_state){switch(e){case"en":return[2,NW];case"ru":return[2,this.loadLanguageAsync(e)];default:throw new Error("Language ".concat(e," not supported"))}return[2]})}),function(e){return i.apply(this,arguments)})},{key:"loadLanguageAsync",value:(n=Ee(function(e){var n;return _ts_generator(this,function(_state){switch(_state.label){case 0:return[4,t.import("db://assets/resources/locales/".concat(e,".json"))];case 1:n=_state.sent().default;FW.add(e,n);return[2]}})}),function(e){return n.apply(this,arguments)})},{key:"updateComponentInEditor",value:function value(){}}]),e}();n._RF.pop(),n._RF.push({},"fb33bK/6Y5FAas5AwmmBM/X","Leaderboards",void 0);var GW=GameCore,UW=GW.Configs,HW=UW.Mockup,VW=HW.Leaderboards,qW=HW.GameSDK.Player,WW=UW.Leaderboards,KW=GW.Utils.Number,jW=globalThis.game.leaderboard,YW=function(){function e(){var t=this;Ce(this,e),this.handleWhenGameSDKStarted=function(){VW.Enabled?t.setupLeaderboardsMockup():t.setupLeaderboards()}}var t,n,i,a,o;return Ae(e,[{key:"init",value:function value(){this.handleWhenGameSDKStarted()}},{key:"setupLeaderboards",value:(o=Ee(function(){return _ts_generator(this,function(_state){this.setupLeaderboardByConfigs();return[2]})}),function(){return o.apply(this,arguments)})},{key:"setupLeaderboardByConfigs",value:function value(){var _$e=WW.LeaderboardId;_$e?(jW.addLeaderboard({name:yl,type:"global",autoSortRank:!0,leaderboardId:_$e}),jW.addLeaderboard({name:fl,type:"friends",autoSortRank:!0,leaderboardId:_$e})):console.warn("LeaderboardId in Configs is not set")}},{key:"setupLeaderboardsMockup",value:(a=Ee(function(){return _ts_generator(this,function(_state){this.setupMockGlobalLeaderboard(),this.setupMockFriendsLeaderboard(),this.setupMockGlobalTournamentLeaderboard();return[2]})}),function(){return a.apply(this,arguments)})},{key:"setupMockGlobalLeaderboard",value:(i=Ee(function(){var _$e,t,n,i;return _ts_generator(this,function(_state){switch(_state.label){case 0:_$e=yl,t=vl;return[4,jW.createLeaderboardAsync({_id:t,name:_$e,numberOfLeaders:100})];case 1:n=_state.sent();jW.addLeaderboard({name:_$e,type:"global",autoSortRank:!0,leaderboardId:n});return[4,jW.requestLeaderboardAsync(_$e,10)];case 2:_state.sent();i=jW.getLeaderboard(_$e);console.info("setupGlobalLeaderboard fetch new",i,i&&Object.keys(i.leaders).length),i=jW.getLeaderboard(_$e),console.info("setupGlobalLeaderboard load more",i,i&&Object.keys(i.leaders).length);return[2]}})}),function(){return i.apply(this,arguments)})},{key:"setupMockFriendsLeaderboard",value:(n=Ee(function(){var _$e,t,n,i,a,o;return _ts_generator(this,function(_state){switch(_state.label){case 0:_$e=fl,t=ml,n=0,i=qW.ConnectedPlayers;i.Enabled&&(n=KW.random(i.NumOfPlayers));return[4,jW.createLeaderboardAsync({_id:t,name:_$e,numberOfLeaders:n})];case 1:a=_state.sent();jW.addLeaderboard({name:_$e,type:"friends",autoSortRank:!0,leaderboardId:a});return[4,jW.requestLeaderboardAsync(_$e,10)];case 2:_state.sent();o=jW.getLeaderboard(_$e);console.info("setupFriendsLeaderboard done",o);return[2]}})}),function(){return n.apply(this,arguments)})},{key:"setupMockGlobalTournamentLeaderboard",value:(t=Ee(function(){var _$e;return _ts_generator(this,function(_state){switch(_state.label){case 0:return[4,Wu.requestTournamentDataAsync()];case 1:_$e=_state.sent();_$e.forEach(function(e){var t=e.payload.leaderboardId;t&&(jW.isExistLeaderboardId(t)||jW.addLeaderboard({type:"tournament",name:t,autoSortRank:!0,leaderboardId:t}))}),console.info("setupGlobalTournamentLeaderboard done",_$e);return[2]}})}),function(){return t.apply(this,arguments)})}]),e}();n._RF.pop(),n._RF.push({},"e7bf73g4jJGuI9FqvW5YBsS","PerformanceMonitor",void 0);var XW=GameCore,JW=XW.Configs.PerformanceMonitor,QW=XW.Utils,ZW=XW.Events,$W=globalThis.game.event,eK=function(){function e(){var t=this;Ce(this,e),this.markName="FPS Tracking",this.handleStartTraceFps=function(){t.startTraceFps()},this.handleLateUpdate=function(){if(t.mark){if(t.fpsTraceDuration-=W.deltaTime,t.fpsTraceDuration<=0&&!t.traceStopped)return t.traceStopped=!0,t.unListenEvents(),t.updateFPS(),void t.mark.stop(t.markName);t.fpsTraceIntervalTimer-=W.deltaTime,t.fpsTraceIntervalTimer>0||(t.fpsTraceIntervalTimer=t.fpsTraceInterval,t.updateFPS(),t.mark.stop(t.markName),t.startTraceFps())}}}return Ae(e,[{key:"mark",get:function get(){return JW.FpsTracking?QW.Mark:null}},{key:"init",value:function value(){var _$e=JW.FpsTracking,t=_$e.TrackingDuration,n=_$e.TrackingInterval;this.fpsTraceDuration=null!=t?t:60,this.fpsTraceInterval=null!=n?n:10,this.fpsTraceIntervalTimer=this.fpsTraceInterval,this.traceStopped=!1,this.listenEvents()}},{key:"listenEvents",value:function value(){$W.once(ZW.GAME_READY,this.handleStartTraceFps),p.on(Z.EVENT_AFTER_UPDATE,this.handleLateUpdate)}},{key:"unListenEvents",value:function value(){p.off(Z.EVENT_AFTER_UPDATE,this.handleLateUpdate)}},{key:"startTraceFps",value:function value(){this.mark&&(this.mark.measure(this.markName),this.mark.start(this.markName))}},{key:"updateFPS",value:function value(){var _$e,t;if(this.mark){var n=this.getFPS(),i=this.getDrawCalls(),a=this.getDeviceRender(),o=this.getTextureMemory();this.minFps=Math.min(null!==(_$e=this.minFps)&&void 0!==_$e?_$e:n,n),this.maxFps=Math.max(null!==(t=this.maxFps)&&void 0!==t?t:0,n),this.mark.putMetric(this.markName,"FPS Metric",n),this.mark.putAttr(this.markName,"Page Title",document.title),this.mark.putAttr(this.markName,"Device Render",a),this.mark.putAttr(this.markName,"Draw Calls",i.toString()),this.mark.putAttr(this.markName,"Texture Memory",o.toFixed(2)),this.mark.putAttr(this.markName,"Min FPS",this.minFps.toString()),this.mark.putAttr(this.markName,"Max FPS",this.maxFps.toString()),console.info("FPS: ".concat(n," Min: ").concat(this.minFps," Max: ").concat(this.maxFps,", draw calls: ").concat(i,", texture memory: ").concat(o.toFixed(2),"MB"))}}},{key:"getFPS",value:function value(){if(!p.root)return 0;var _$e=p.root.fps;return Math.floor(_$e)||0}},{key:"getDrawCalls",value:function value(){return p.root&&p.root.device.numDrawCalls||0}},{key:"getDeviceRender",value:function value(){return p.root&&p.root.device.renderer||"Unknown"}},{key:"getTextureMemory",value:function value(){return p.root&&p.root.device.memoryStatus.textureSize/1048576||0}}]),e}();n._RF.pop(),n._RF.push({},"58248LBip1DBrMjK0UWw2rM","RemoteConfig",void 0);var tK=GameCore.Events,nK=globalThis.game.event,iK=function(){function e(){Ce(this,e),this.handleHotReload=function(){W.restart()},this.handleUpdateConfig=function(e){if("Gameplay"===e.type){W.emit(Pa,e.config);var t=e.id,n=e.type;nK.emit(tK.REMOTE_CONFIG_UPDATED,{id:t,type:n})}}}return Ae(e,[{key:"init",value:function value(){this.listenEvents()}},{key:"listenEvents",value:function value(){nK.on(tK.REQUEST_HOT_RELOAD,this.handleHotReload),nK.on(tK.REQUEST_UPDATE_CONFIG,this.handleUpdateConfig)}}]),e}();n._RF.pop(),n._RF.push({},"c34a93D1BREiKms1T21AkQS","PluginsManager",void 0);var aK=function(){function e(){Ce(this,e)}return Ae(e,[{key:"init",value:function value(){console.info("Plugins Manager: Initialized"),this.initCocosStats(),this.initDynamicAtlas()}},{key:"initLanguages",value:function value(){(new zW).init()}},{key:"initCocosStats",value:function value(){(new SW).init()}},{key:"initLeaderboards",value:function value(){(new YW).init()}},{key:"initRemoteConfig",value:function value(){(new iK).init()}},{key:"initDynamicAtlas",value:function value(){(new DW).init()}},{key:"initDynamicAssets",value:function value(){(new RW).init()}},{key:"initCanvasRecorder",value:function value(){(new bW).init()}},{key:"initPerformanceMonitor",value:function value(){(new eK).init()}},{key:"initAdaptivePerformance",value:function value(){(new mW).init()}}]),e}();n._RF.pop(),n._RF.push({},"ac8b03T+rFB061sXoEEsCUH","SceneManager",void 0);var oK=globalThis.game,rK=oK.event,sK=oK.monitorError,lK=GameCore,uK=lK.Events,cK=lK.Configs.PerformanceMonitor,hK=lK.Utils.Mark,dK=function(){function e(){var t=this;Ce(this,e),this.markName="Load Scene",this.queueLoadScene={},this.callbackSwitchScene=null,this.switchScene=function(){var _$e=Ee(function(e){var n,i,a;return _ts_generator(this,function(_state){n=e.sceneName,i=e.sceneData,a=t.correctSceneName(n);console.info("Switching",a,null!=i?i:{}),a&&(Mu.showLoadingFullScreen(a),t.startScene({sceneName:a,sceneData:i}));return[2]})});return function(t){return _$e.apply(this,arguments)}}(),this.preloadScene=function(e,n){var i=e.sceneName;t.startMeasure(i),p.preloadScene(i,t.onSceneProgress,t.onScenePreloaded(i,n))},this.startMeasure=function(e){t.mark&&(t.queueLoadScene[e]&&(t.mark.putAttr(t.markName,"Canceled","true"),t.stopMeasure(e)),console.groupCollapsed("\uD83D\uDCE6 Load scene progress"),t.mark.measure(t.markName),t.mark.putAttr(t.markName,"Cancel","false"),t.mark.putAttr(t.markName,"Success","false"),t.mark.putMetric(t.markName,e),t.mark.start(t.markName),t.queueLoadScene[e]=!0)},this.stopMeasure=function(e){t.mark&&t.queueLoadScene[e]&&(t.mark.rmAttr(t.markName,"File"),t.mark.putAttr(t.markName,"Success","true"),t.mark.stop(t.markName),t.queueLoadScene[e]=!1,console.groupEnd())},this.onSceneProgress=function(e,n,i){var a=e/n;t.mark&&t.mark.putAttr(t.markName,"Last File","".concat(i.id," (").concat(i.ext,")"));var o=Math.floor(70*a+30);GameSDK.setLoadingProgress(o)},this.onScenePreloaded=function(e,t){return function(n){n?console.warn("SceneManager.onScenePreloaded",{sceneName:e,error:n}):(t&&t(e,n),rK.emit(uK.SCENE_LOADED,{sceneName:e,isPreload:!0}))}},this.onDirectorLoadScene=function(e){return function(n,i){if(n)console.warn("SceneManager.onSceneLoaded",n);else if(null!=i&&i.scene){var a=i.name;t.handleBeforeSceneLaunch(i,e)(),p.once(Z.EVENT_AFTER_SCENE_LAUNCH,t.handleSceneLaunched(a,e))}else console.warn("SceneManager.onSceneLoaded","Scene not found")}},this.handleBeforeSceneLaunch=function(e,n){return function(){t.setSceneData(e,null!=n?n:{}),W.emit(Ra),rK.emit(uK.SCENE_LOADED,{sceneName:e.name})}},this.handleSceneLaunched=function(e,n){return function(){var i;Mu.hideLoadingFullScreen(e),Ii.switchSceneTracking(),null==sK||sK.addMetadata({currentScene:e}),null===(i=t.callbackSwitchScene)||void 0===i||i.call(t,{sceneName:e,sceneData:n}),rK.emit(uK.SCENE_LAUNCHED,{sceneName:e})}},this.handleSceneLoaded=function(e){var n=e.sceneName;t.stopMeasure(n)}}return Ae(e,[{key:"init",value:function value(){this.listenEvents(),console.info("Scene Manager: Initialized")}},{key:"listenEvents",value:function value(){rK.on(uK.SWITCH_SCENE,this.switchScene),rK.on(uK.PRELOAD_SCENE,this.preloadScene),rK.on(uK.SCENE_LOADED,this.handleSceneLoaded)}},{key:"correctSceneName",value:function value(e){var t=this.getCurrentScene();return t&&e===t.name?null:e}},{key:"startScene",value:function value(e){var t=this,n=e.sceneName,i=e.sceneData;this.preloadScene({sceneName:n},function(e,a){e===n&&(a?console.warn("SceneManager.startScene",{sceneName:n,error:a}):p.loadScene(n,t.onDirectorLoadScene(i)))})}},{key:"mark",get:function get(){return cK.LoadResources?hK:null}},{key:"getCurrentScene",value:function value(){return p.getScene()}},{key:"getLoadedScenes",value:function value(){var _$e=this,t=[];return Object.keys(this.queueLoadScene).map(function(n){_$e.queueLoadScene[n]||t.push(n)}),t}},{key:"onSwitchScene",value:function value(e){this.callbackSwitchScene=e}},{key:"setSceneData",value:function value(e,t){if(t&&("data"in e||e.scene.attr({data:{}}),"data"in e)){var n=e.data||{};e.scene.attr({data:we(we({},n),t)}),console.info("SceneManager.setSceneData",{sceneName:e.name,sceneData:t,currentData:n})}}}]),e}();n._RF.pop(),n._RF.push({},"617b2SRAL5CyL75C998xBnx","ScreenManager",void 0);var pK=globalThis.game,yK=pK.event,fK=pK.monitorError,vK=GameCore,mK=vK.Events,gK=vK.Utils.Object,bK=function(){function e(){var t=this;Ce(this,e),this.screens={},this.handleOpenScreen=function(e){var n=e.screenName,i=e.screenData;t.openScreen(n,i)},this.handleCloseScreen=function(e){var n=e.screenName;t.closeScreen(n)}}var t,n,i,a;return Ae(e,[{key:"init",value:function value(){this.listenEvents(),console.info("Screen Manager: Initialized")}},{key:"listenEvents",value:function value(){yK.on(mK.OPEN_SCREEN,this.handleOpenScreen),yK.on(mK.CLOSE_SCREEN,this.handleCloseScreen)}},{key:"reorderScreens",value:function value(){var _$e=gK.vals(this.screens).filter(function(e){return"ready"===e.state});_$e.sort(function(e,t){return e.order-t.order});for(var t=0;t<_$e.length;t++){var n=_$e[t];n.order=t,n.comp.node.setSiblingIndex(n.order)}}},{key:"addScreenKeys",value:function value(e,t){var n=this;e.forEach(function(e,i){n.screens[Ei[e]]&&(n.screens[Ei[e]].order=i),n.screens[Ei[e]]={state:"key",parent:t,key:e,order:i}})}},{key:"addScreens",value:function value(e){var t=this;e.forEach(function(e,n){t.screens[e.node.name]={state:"ready",comp:e,order:n}})}},{key:"preloadScreens",value:(a=Ee(function(){var _$e;return _ts_generator(this,function(_state){switch(_state.label){case 0:_$e=gK.vals(this.screens).reduce(function(e,t){if("key"===t.state){var n=li.loadPrefabAsync("screens/".concat(Ei[t.key]));e.push(n)}return e},[]);return[4,Promise.all(_$e)];case 1:return[2,_state.sent()]}})}),function(){return a.apply(this,arguments)})},{key:"getScreen",value:(i=Ee(function(e){var t,n,i,a,o,r,s;return _ts_generator(this,function(_state){switch(_state.label){case 0:t=this.screens[e];if(null==t)return[2,(null==fK||fK.sendException(new Error("ScreenManager.openScreen Screen ".concat(e," not found")),{screenName:e,screens:this.getScreensAsMetadata()}),null)];if("ready"===t.state)return[2,t.comp];console.info("ScreenManager.getScreen","Screen ".concat(e," not found in cache, instantiating it..."));n=t.parent,i=t.key,a=t.order;return[4,li.loadPrefabAsync("screens/".concat(Ei[i]))];case 1:o=_state.sent();if(!o)return[2,(null==fK||fK.sendException(new Error("ScreenManager.getScreen: Failed to load Screen ".concat(e," prefab...")),{screenName:e,screens:this.getScreensAsMetadata()}),null)];r=l(o);r.name=e,n.addChild(r),r.active=!1;s=r.getComponent($x);return[2,s?(this.screens[e]={state:"ready",comp:s,order:a},this.reorderScreens(),s):(null==fK||fK.sendException(new Error("ScreenManager.getScreen: Screen ".concat(e," prefab doesn't have BaseScreen component...")),{screenName:e,screens:this.getScreensAsMetadata()}),null)]}})}),function(e){return i.apply(this,arguments)})},{key:"getScreensAsMetadata",value:function value(){var _$e=this;return Object.keys(this.screens).map(function(t){var n=_$e.screens[t];return"ready"===n.state?"".concat(n.comp.node.name,"(loaded)"):"".concat(Ei[n.key],"(notloaded)")}).join(", ")}},{key:"clearScreens",value:function value(){this.screens={}}},{key:"openScreen",value:(n=Ee(function(e,t){var n,i,e1;return _ts_generator(this,function(_state){switch(_state.label){case 0:_state.trys.push([0,3,,4]);li.setBlockInput(!0);return[4,this.getScreen(e)];case 1:n=_state.sent();if(li.setBlockInput(!1),null==n||!n.node)return[2,void console.warn("ScreenManager.openScreen","Screen ".concat(e," not found"))];n.node.active=!0,n.node.setPosition(new Y(0,0,0));i={screenName:e,screenData:t};yK.emit(mK.OPENING_SCREEN,i),Ii.trackCurrentPage(e,!0),null==fK||fK.addMetadata({currentScreen:e});return[4,gn.waitTweenAsync(0)];case 2:_state.sent(),n.open(t),yK.emit(mK.OPENED_SCREEN,i);return[3,4];case 3:e1=_state.sent();console.error("ScreenManager.openScreen",e1);return[3,4];case 4:return[2]}})}),function(e,t){return n.apply(this,arguments)})},{key:"closeScreen",value:(t=Ee(function(e){var t,n,i,e1;return _ts_generator(this,function(_state){switch(_state.label){case 0:_state.trys.push([0,2,,3]);return[4,this.getScreen(e)];case 1:n=_state.sent();if(!n)return[2,void console.warn("ScreenManager.closeScreen","Screen ".concat(e," not found"))];if(null===(t=n.node)||void 0===t||!t.active)return[2];i={screenName:e};yK.emit(mK.CLOSING_SCREEN,i),n.close(),Ii.trackCurrentPage(e,!1),null==fK||fK.removeMetadata("currentScreen");return[3,3];case 2:e1=_state.sent();console.error("ScreenManager.closeScreen",e1);return[3,3];case 3:return[2]}})}),function(e){return t.apply(this,arguments)})},{key:"closeAllScreens",value:function value(){var _$e=this;Object.keys(this.screens).forEach(function(t){"ready"===_$e.screens[t].state&&_$e.closeScreen(t)})}}]),e}();n._RF.pop(),n._RF.push({},"a851bnZR1RCUILrjMPf7nMm","CorecosSystem",void 0);var SK=GameCore,wK=SK.Configs.Core,kK=SK.Events,EK=SK.Plugins.Analytics.Events,CK=globalThis.game,TK=CK.context,AK=CK.storage,RK=CK.event,IK=CK.analytics,PK=CK.monitorError;new(function(){function e(){var t=this;Ce(this,e),this.coreManager=new Lq,this.matchManager=new nW,this.sceneManager=new dK,this.screenManager=new bK,this.engineManager=new Mq,this.layoutManager=new Wq,this.playerManager=new cW,this.pluginsManager=new aK,this.handleWhenCoreBoot=function(){W.inited?t.handleCocosInit():W.once(Se.EVENT_POST_PROJECT_INIT,t.handleCocosInit)},this.handleCocosInit=function(){t.coreManager.requestStart()},this.handleWhenCoreStart=function(){t.playerManager.setupDefaultGameData(),t.matchManager.setupDefaultMatchData(),console.groupEnd()},this.handleWhenCoreReady=function(){t.initPlugins(),console.groupEnd(),wK.StartSDKAfterLoadGame?RK.once(kK.SCENE_LOADED,t.handleStartGameWhenMainSceneReady):t.processStartGame(),t.preloadScenes()},this.handleStartGameWhenMainSceneReady=function(){t.processStartGame()},this.handleSwitchScene=function(e){var n=e.sceneName,i=t.sceneManager.getCurrentScene();if((null==i?void 0:i.name)===n){t.screenManager.closeAllScreens(),t.screenManager.clearScreens();var a=null==i?void 0:i.getComponentsInChildren($x);if(a.length>0){var o=a.map(function(e){return e.node.name}).join(", ");console.info("\uD83D\uDCFA Loaded Screens in ".concat(n,": ").concat(o)),t.screenManager.addScreens(a)}var r=null==i?void 0:i.getComponentInChildren(EB);if(r){var s=r.screenKeys.filter(function(e){return!a.some(function(t){return t.node.name===Ei[e]})});if(0!==s.length){var l=s.map(function(e){return Ei[e]}).join(", ");console.info("\uD83D\uDCFA Lazy-loading Screens in ".concat(n,": ").concat(l)),t.screenManager.addScreenKeys(s,r.node),t.screenManager.preloadScreens()}}}},console.groupCollapsed("\uD83D\uDCE6 Corecos System"),console.info("Corecos Initializing..."),this.listenEvents(),this.initManagers(),console.groupEnd()}var t,n;return Ae(e,[{key:"initManagers",value:function value(){this.coreManager.init(),this.engineManager.init(),this.layoutManager.init(),this.sceneManager.init(),this.screenManager.init(),this.playerManager.init(),this.matchManager.init(),this.pluginsManager.init()}},{key:"listenEvents",value:function value(){this.coreManager.onCoreBoot(this.handleWhenCoreBoot),this.coreManager.onCoreStart(this.handleWhenCoreStart),this.coreManager.onCoreReady(this.handleWhenCoreReady),this.sceneManager.onSwitchScene(this.handleSwitchScene)}},{key:"preloadScenes",value:function value(){"solo"===AK.getStorageData("context","sessionContextType")?bu.preloadDashboardScene():bu.preloadGameScene()}},{key:"processStartGame",value:(n=Ee(function(){return _ts_generator(this,function(_state){switch(_state.label){case 0:console.groupEnd(),IK.event(EK.LOAD_COMPLETE);return[4,this.startGameAsync()];case 1:_state.sent(),this.startProcessContextData(),this.playerManager.requestConnectedPlayers(),IK.event(EK.APP_READY,{success:!0}),RK.emit(kK.GAME_READY);return[2]}})}),function(){return n.apply(this,arguments)})},{key:"startGameAsync",value:(t=Ee(function(){var e;return _ts_generator(this,function(_state){switch(_state.label){case 0:_state.trys.push([0,2,,3]);return[4,GameSDK.startGameAsync()];case 1:_state.sent(),IK.event(EK.GAME_SDK_READY,{success:!0});return[3,3];case 2:e=_state.sent();console.warn("GameSDK.startGameAsync",e),IK.event(EK.GAME_SDK_READY,{success:!1}),_instanceof(e,Error)&&(null==PK||PK.sendException(e));return[3,3];case 3:return[2]}})}),function(){return t.apply(this,arguments)})},{key:"startProcessContextData",value:function value(){RK.getEventEmitCount(kK.PLAYER_INFO_LOADED)?TK.processContextData().catch(function(e){console.error("startProcessContextData",e)}):RK.once(kK.PLAYER_INFO_LOADED,this.startProcessContextData)}},{key:"initPlugins",value:function value(){this.pluginsManager.initLeaderboards(),this.pluginsManager.initDynamicAssets(),this.pluginsManager.initCanvasRecorder(),this.pluginsManager.initPerformanceMonitor(),this.pluginsManager.initAdaptivePerformance()}}]),e}()),n._RF.pop()}}});(function(r){r("virtual:///prerequisite-imports/start-scene","chunks:///start-scene.js")})(function(mid,cid){System.register(mid,[cid],function(_export,_context){return{setters:[function(_m){var _exportObj={};for(var _key in _m){if(_key!=="default"&&_key!=="__esModule")_exportObj[_key]=_m[_key]}_export(_exportObj)}],execute:function execute(){}}})});