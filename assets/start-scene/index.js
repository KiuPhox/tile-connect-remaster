System.register("chunks:///start-scene.js",["cc"],(function(e,t){var n,i,a,r,o,s,l,u,c,h,p,d,f,v,y,m,g,b,w,k,S,E,C,T,A,x,R,I,P,_,L,O,D,M,N,F,B,G,z,U,H,V,q,W,K,j,Y,X,$,Q,J,Z,ee,te,ne,ie,ae,re,oe,se,le,ue,ce,he,pe,de,fe,ve,ye,me,ge,be,we;return{setters:[function(e){n=e.cclegacy,i=e._decorator,a=e.Node,r=e.Color,o=e.Canvas,s=e.UITransform,l=e.instantiate,u=e.Label,c=e.RichText,h=e.Toggle,p=e.Button,d=e.director,f=e.Component,v=e.isCCObject,y=e.Animation,m=e.CCString,g=e.CCInteger,b=e.AudioSource,w=e.resources,k=e.AudioClip,S=e.tween,E=e.CCFloat,C=e.Widget,T=e.Layout,A=e.Sprite,x=e.ccenum,R=e.find,I=e.Prefab,P=e.JsonAsset,_=e.AnimationClip,L=e.ImageAsset,O=e.SpriteFrame,D=e.Enum,M=e.easing,N=e.UIOpacity,F=e.view,B=e.screen,G=e.math,z=e.EventHandler,U=e.animation,H=e.CCBoolean,V=e.Input,q=e.Graphics,W=e.game,K=e.profiler,j=e.sys,Y=e.Vec3,X=e.ProgressBar,$=e.Font,Q=e.Vec2,J=e.Director,Z=e.Layers,ee=e.randomRangeInt,te=e.pseudoRandomRangeInt,ne=e.pseudoRandom,ie=e.randomRange,ae=e.Pool,re=e.ParticleSystem2D,oe=e.HorizontalTextAlignment,se=e.Tween,le=e.View,ue=e.ScrollView,ce=e.lerp,he=e.Mask,pe=e.AssetManager,de=e.DynamicAtlasManager,fe=e.macro,ve=e.settings,ye=e.Settings,me=e.ResolutionPolicy,ge=e.UIRenderer,be=e.Texture2D,we=e.Game}],execute:function(){function e(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function ke(t){for(var n=1;n<arguments.length;n++){var i=null!=arguments[n]?arguments[n]:{};n%2?e(Object(i),!0).forEach((function(e){Re(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):e(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}function Se(){
/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */
Se=function(){return t};var e,t={},n=Object.prototype,i=n.hasOwnProperty,a=Object.defineProperty||function(e,t,n){e[t]=n.value},r="function"==typeof Symbol?Symbol:{},o=r.iterator||"@@iterator",s=r.asyncIterator||"@@asyncIterator",l=r.toStringTag||"@@toStringTag";function u(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{u({},"")}catch(e){u=function(e,t,n){return e[t]=n}}function c(e,t,n,i){var r=t&&t.prototype instanceof y?t:y,o=Object.create(r.prototype),s=new I(i||[]);return a(o,"_invoke",{value:T(e,n,s)}),o}function h(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}t.wrap=c;var p="suspendedStart",d="executing",f="completed",v={};function y(){}function m(){}function g(){}var b={};u(b,o,(function(){return this}));var w=Object.getPrototypeOf,k=w&&w(w(P([])));k&&k!==n&&i.call(k,o)&&(b=k);var S=g.prototype=y.prototype=Object.create(b);function E(e){["next","throw","return"].forEach((function(t){u(e,t,(function(e){return this._invoke(t,e)}))}))}function C(e,t){function n(a,r,o,s){var l=h(e[a],e,r);if("throw"!==l.type){var u=l.arg,c=u.value;return c&&"object"==typeof c&&i.call(c,"__await")?t.resolve(c.__await).then((function(e){n("next",e,o,s)}),(function(e){n("throw",e,o,s)})):t.resolve(c).then((function(e){u.value=e,o(u)}),(function(e){return n("throw",e,o,s)}))}s(l.arg)}var r;a(this,"_invoke",{value:function(e,i){function a(){return new t((function(t,a){n(e,i,t,a)}))}return r=r?r.then(a,a):a()}})}function T(t,n,i){var a=p;return function(r,o){if(a===d)throw new Error("Generator is already running");if(a===f){if("throw"===r)throw o;return{value:e,done:!0}}for(i.method=r,i.arg=o;;){var s=i.delegate;if(s){var l=A(s,i);if(l){if(l===v)continue;return l}}if("next"===i.method)i.sent=i._sent=i.arg;else if("throw"===i.method){if(a===p)throw a=f,i.arg;i.dispatchException(i.arg)}else"return"===i.method&&i.abrupt("return",i.arg);a=d;var u=h(t,n,i);if("normal"===u.type){if(a=i.done?f:"suspendedYield",u.arg===v)continue;return{value:u.arg,done:i.done}}"throw"===u.type&&(a=f,i.method="throw",i.arg=u.arg)}}}function A(t,n){var i=n.method,a=t.iterator[i];if(a===e)return n.delegate=null,"throw"===i&&t.iterator.return&&(n.method="return",n.arg=e,A(t,n),"throw"===n.method)||"return"!==i&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+i+"' method")),v;var r=h(a,t.iterator,n.arg);if("throw"===r.type)return n.method="throw",n.arg=r.arg,n.delegate=null,v;var o=r.arg;return o?o.done?(n[t.resultName]=o.value,n.next=t.nextLoc,"return"!==n.method&&(n.method="next",n.arg=e),n.delegate=null,v):o:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,v)}function x(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function R(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function I(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(x,this),this.reset(!0)}function P(t){if(t||""===t){var n=t[o];if(n)return n.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var a=-1,r=function n(){for(;++a<t.length;)if(i.call(t,a))return n.value=t[a],n.done=!1,n;return n.value=e,n.done=!0,n};return r.next=r}}throw new TypeError(typeof t+" is not iterable")}return m.prototype=g,a(S,"constructor",{value:g,configurable:!0}),a(g,"constructor",{value:m,configurable:!0}),m.displayName=u(g,l,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===m||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,g):(e.__proto__=g,u(e,l,"GeneratorFunction")),e.prototype=Object.create(S),e},t.awrap=function(e){return{__await:e}},E(C.prototype),u(C.prototype,s,(function(){return this})),t.AsyncIterator=C,t.async=function(e,n,i,a,r){void 0===r&&(r=Promise);var o=new C(c(e,n,i,a),r);return t.isGeneratorFunction(n)?o:o.next().then((function(e){return e.done?e.value:o.next()}))},E(S),u(S,l,"Generator"),u(S,o,(function(){return this})),u(S,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),n=[];for(var i in t)n.push(i);return n.reverse(),function e(){for(;n.length;){var i=n.pop();if(i in t)return e.value=i,e.done=!1,e}return e.done=!0,e}},t.values=P,I.prototype={constructor:I,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(R),!t)for(var n in this)"t"===n.charAt(0)&&i.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var n=this;function a(i,a){return s.type="throw",s.arg=t,n.next=i,a&&(n.method="next",n.arg=e),!!a}for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r],s=o.completion;if("root"===o.tryLoc)return a("end");if(o.tryLoc<=this.prev){var l=i.call(o,"catchLoc"),u=i.call(o,"finallyLoc");if(l&&u){if(this.prev<o.catchLoc)return a(o.catchLoc,!0);if(this.prev<o.finallyLoc)return a(o.finallyLoc)}else if(l){if(this.prev<o.catchLoc)return a(o.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return a(o.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var a=this.tryEntries[n];if(a.tryLoc<=this.prev&&i.call(a,"finallyLoc")&&this.prev<a.finallyLoc){var r=a;break}}r&&("break"===e||"continue"===e)&&r.tryLoc<=t&&t<=r.finallyLoc&&(r=null);var o=r?r.completion:{};return o.type=e,o.arg=t,r?(this.method="next",this.next=r.finallyLoc,v):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),v},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),R(n),v}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var i=n.completion;if("throw"===i.type){var a=i.arg;R(n)}return a}}throw new Error("illegal catch attempt")},delegateYield:function(t,n,i){return this.delegate={iterator:P(t),resultName:n,nextLoc:i},"next"===this.method&&(this.arg=e),v}},t}function Ee(e,t,n,i,a,r,o){try{var s=e[r](o),l=s.value}catch(e){return void n(e)}s.done?t(l):Promise.resolve(l).then(i,a)}function Ce(e){return function(){var t=this,n=arguments;return new Promise((function(i,a){var r=e.apply(t,n);function o(e){Ee(r,i,a,o,s,"next",e)}function s(e){Ee(r,i,a,o,s,"throw",e)}o(void 0)}))}}function Te(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Ae(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,je(i.key),i)}}function xe(e,t,n){return t&&Ae(e.prototype,t),n&&Ae(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function Re(e,t,n){return(t=je(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Ie(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&_e(e,t)}function Pe(e){return(Pe=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _e(e,t){return(_e=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function Le(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function Oe(e,t,n){return(Oe=Le()?Reflect.construct.bind():function(e,t,n){var i=[null];i.push.apply(i,t);var a=new(Function.bind.apply(e,i));return n&&_e(a,n.prototype),a}).apply(null,arguments)}function De(e){var t="function"==typeof Map?new Map:void 0;return(De=function(e){if(null===e||(n=e,-1===Function.toString.call(n).indexOf("[native code]")))return e;var n;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,i)}function i(){return Oe(e,arguments,Pe(this).constructor)}return i.prototype=Object.create(e.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),_e(i,e)})(e)}function Me(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Ne(e,t){if(t&&("object"==typeof t||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return Me(e)}function Fe(e){var t=Le();return function(){var n,i=Pe(e);if(t){var a=Pe(this).constructor;n=Reflect.construct(i,arguments,a)}else n=i.apply(this,arguments);return Ne(this,n)}}function Be(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Pe(e)););return e}function Ge(){return(Ge="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,n){var i=Be(e,t);if(i){var a=Object.getOwnPropertyDescriptor(i,t);return a.get?a.get.call(arguments.length<3?e:n):a.value}}).apply(this,arguments)}function ze(e,t,n,i){return(ze="undefined"!=typeof Reflect&&Reflect.set?Reflect.set:function(e,t,n,i){var a,r=Be(e,t);if(r){if((a=Object.getOwnPropertyDescriptor(r,t)).set)return a.set.call(i,n),!0;if(!a.writable)return!1}if(a=Object.getOwnPropertyDescriptor(i,t)){if(!a.writable)return!1;a.value=n,Object.defineProperty(i,t,a)}else Re(i,t,n);return!0})(e,t,n,i)}function Ue(e,t,n,i,a){if(!ze(e,t,n,i||e)&&a)throw new TypeError("failed to set property");return n}function He(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var i,a,r,o,s=[],l=!0,u=!1;try{if(r=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;l=!1}else for(;!(l=(i=r.call(n)).done)&&(s.push(i.value),s.length!==t);l=!0);}catch(e){u=!0,a=e}finally{try{if(!l&&null!=n.return&&(o=n.return(),Object(o)!==o))return}finally{if(u)throw a}}return s}}(e,t)||qe(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Ve(e){return function(e){if(Array.isArray(e))return We(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||qe(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function qe(e,t){if(e){if("string"==typeof e)return We(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?We(e,t):void 0}}function We(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function Ke(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=qe(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0,a=function(){};return{s:a,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,r=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw r}}}}function je(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}function Ye(e,t,n,i){n&&Object.defineProperty(e,t,{enumerable:n.enumerable,configurable:n.configurable,writable:n.writable,value:n.initializer?n.initializer.call(i):void 0})}function Xe(e,t,n,i,a){var r={};return Object.keys(i).forEach((function(e){r[e]=i[e]})),r.enumerable=!!r.enumerable,r.configurable=!!r.configurable,("value"in r||r.initializer)&&(r.writable=!0),r=n.slice().reverse().reduce((function(n,i){return i(e,t,n)||n}),r),a&&void 0!==r.initializer&&(r.value=r.initializer?r.initializer.call(a):void 0,r.initializer=void 0),void 0===r.initializer&&(Object.defineProperty(e,t,r),r=null),r}var $e,Qe,Je,Ze,et,tt,nt,it,at;n._RF.push({},"b2bd1+njXxJxaFY3ymm06WU","debug-view-runtime-control",void 0);var rt=i.ccclass,ot=i.property;$e=rt("internal.DebugViewRuntimeControl"),Qe=ot(a),Je=ot(a),Ze=ot(a),$e((nt=Xe((tt=function(e){Ie(n,e);var t=Fe(n);function n(){var e;Te(this,n);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return Ye(e=t.call.apply(t,[this].concat(a)),"compositeModeToggle",nt,Me(e)),Ye(e,"singleModeToggle",it,Me(e)),Ye(e,"EnableAllCompositeModeButton",at,Me(e)),e._single=0,e.strSingle=["No Single Debug","Vertex Color","Vertex Normal","Vertex Tangent","World Position","Vertex Mirror","Face Side","UV0","UV1","UV Lightmap","Project Depth","Linear Depth","Fragment Normal","Fragment Tangent","Fragment Binormal","Base Color","Diffuse Color","Specular Color","Transparency","Metallic","Roughness","Specular Intensity","IOR","Direct Diffuse","Direct Specular","Direct All","Env Diffuse","Env Specular","Env All","Emissive","Light Map","Shadow","AO","Fresnel","Direct Transmit Diffuse","Direct Transmit Specular","Env Transmit Diffuse","Env Transmit Specular","Transmit All","Direct Internal Specular","Env Internal Specular","Internal All","Fog"],e.strComposite=["Direct Diffuse","Direct Specular","Env Diffuse","Env Specular","Emissive","Light Map","Shadow","AO","Normal Map","Fog","Tone Mapping","Gamma Correction","Fresnel","Transmit Diffuse","Transmit Specular","Internal Specular","TT"],e.strMisc=["CSM Layer Coloration","Lighting With Albedo"],e.compositeModeToggleList=[],e.singleModeToggleList=[],e.miscModeToggleList=[],e.textComponentList=[],e.labelComponentList=[],e.textContentList=[],e._currentColorIndex=0,e.strColor=["<color=#ffffff>","<color=#000000>","<color=#ff0000>","<color=#00ff00>","<color=#0000ff>"],e.color=[r.WHITE,r.BLACK,r.RED,r.GREEN,r.BLUE],e}return xe(n,[{key:"start",value:function(){if(this.node.parent.getComponent(o)){var e=this.node.parent.getComponent(s),t=.5*e.width,n=.5*e.height,i=.1*t-t,a=n-.1*n,d=this.node.getChildByName("MiscMode"),f=l(d);f.parent=this.node,f.name="Buttons";var v=l(d);v.parent=this.node,v.name="Titles";for(var y=0;y<2;y++){var m=l(this.EnableAllCompositeModeButton.getChildByName("Label"));m.setPosition(i+(y>0?450:150),a,0),m.setScale(.75,.75,.75),m.parent=v;var g=m.getComponent(u);g.string=y?"----------Composite Mode----------":"----------Single Mode----------",g.color=r.WHITE,g.overflow=0,this.labelComponentList[this.labelComponentList.length]=g}a-=20;for(var b=0,w=0;w<this.strSingle.length;w++,b++){w===this.strSingle.length>>1&&(i+=200,b=0);var k=w?l(this.singleModeToggle):this.singleModeToggle;k.setPosition(i,a-20*b,0),k.setScale(.5,.5,.5),k.parent=this.singleModeToggle.parent;var S=k.getComponentInChildren(c);S.string=this.strSingle[w],this.textComponentList[this.textComponentList.length]=S,this.textContentList[this.textContentList.length]=S.string,k.on(h.EventType.TOGGLE,this.toggleSingleMode,this),this.singleModeToggleList[w]=k}i+=200,this.EnableAllCompositeModeButton.setPosition(i+15,a,0),this.EnableAllCompositeModeButton.setScale(.5,.5,.5),this.EnableAllCompositeModeButton.on(p.EventType.CLICK,this.enableAllCompositeMode,this),this.EnableAllCompositeModeButton.parent=f;var E=this.EnableAllCompositeModeButton.getComponentInChildren(u);this.labelComponentList[this.labelComponentList.length]=E;var C=l(this.EnableAllCompositeModeButton);C.setPosition(i+90,a,0),C.setScale(.5,.5,.5),C.on(p.EventType.CLICK,this.changeTextColor,this),C.parent=f,(E=C.getComponentInChildren(u)).string="TextColor",this.labelComponentList[this.labelComponentList.length]=E;var T=l(this.EnableAllCompositeModeButton);T.setPosition(i+200,a,0),T.setScale(.5,.5,.5),T.on(p.EventType.CLICK,this.hideUI,this),T.parent=this.node.parent,(E=T.getComponentInChildren(u)).string="Hide UI",this.labelComponentList[this.labelComponentList.length]=E,this.hideButtonLabel=E,a-=40;for(var A=0;A<this.strMisc.length;A++){var x=l(this.compositeModeToggle);x.setPosition(i,a-20*A,0),x.setScale(.5,.5,.5),x.parent=d;var R=x.getComponentInChildren(c);R.string=this.strMisc[A],this.textComponentList[this.textComponentList.length]=R,this.textContentList[this.textContentList.length]=R.string,x.getComponent(h).isChecked=!!A,x.on(h.EventType.TOGGLE,A?this.toggleLightingWithAlbedo:this.toggleCSMColoration,this),this.miscModeToggleList[A]=x}a-=150;for(var I=0;I<this.strComposite.length;I++){var P=I?l(this.compositeModeToggle):this.compositeModeToggle;P.setPosition(i,a-20*I,0),P.setScale(.5,.5,.5),P.parent=this.compositeModeToggle.parent;var _=P.getComponentInChildren(c);_.string=this.strComposite[I],this.textComponentList[this.textComponentList.length]=_,this.textContentList[this.textContentList.length]=_.string,P.on(h.EventType.TOGGLE,this.toggleCompositeMode,this),this.compositeModeToggleList[I]=P}}else console.error("debug-view-runtime-control should be child of Canvas")}},{key:"isTextMatched",value:function(e,t){var n=new String(e),i=n.search(">");return-1===i?e===t:(n=(n=n.substr(i+1)).substr(0,n.search("<")))===t}},{key:"toggleSingleMode",value:function(e){for(var t=d.root.debugView,n=e.getComponentInChildren(c),i=0;i<this.strSingle.length;i++)this.isTextMatched(n.string,this.strSingle[i])&&(t.singleMode=i)}},{key:"toggleCompositeMode",value:function(e){for(var t=d.root.debugView,n=e.getComponentInChildren(c),i=0;i<this.strComposite.length;i++)this.isTextMatched(n.string,this.strComposite[i])&&t.enableCompositeMode(i,e.isChecked)}},{key:"toggleLightingWithAlbedo",value:function(e){d.root.debugView.lightingWithAlbedo=e.isChecked}},{key:"toggleCSMColoration",value:function(e){d.root.debugView.csmLayerColoration=e.isChecked}},{key:"enableAllCompositeMode",value:function(e){var t=d.root.debugView;t.enableAllCompositeMode(!0);for(var n=0;n<this.compositeModeToggleList.length;n++){this.compositeModeToggleList[n].getComponent(h).isChecked=!0}var i=this.miscModeToggleList[0].getComponent(h);i.isChecked=!1,t.csmLayerColoration=!1,(i=this.miscModeToggleList[1].getComponent(h)).isChecked=!0,t.lightingWithAlbedo=!0}},{key:"hideUI",value:function(e){var t=this.node.getChildByName("Titles"),n=!t.active;this.singleModeToggleList[0].parent.active=n,this.miscModeToggleList[0].parent.active=n,this.compositeModeToggleList[0].parent.active=n,this.EnableAllCompositeModeButton.parent.active=n,t.active=n,this.hideButtonLabel.string=n?"Hide UI":"Show UI"}},{key:"changeTextColor",value:function(e){this._currentColorIndex++,this._currentColorIndex>=this.strColor.length&&(this._currentColorIndex=0);for(var t=0;t<this.textComponentList.length;t++)this.textComponentList[t].string=this.strColor[this._currentColorIndex]+this.textContentList[t]+"</color>";for(var n=0;n<this.labelComponentList.length;n++)this.labelComponentList[n].color=this.color[this._currentColorIndex]}},{key:"onLoad",value:function(){}},{key:"update",value:function(e){}}]),n}(f)).prototype,"compositeModeToggle",[Qe],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),it=Xe(tt.prototype,"singleModeToggle",[Je],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),at=Xe(tt.prototype,"EnableAllCompositeModeButton",[Ze],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),et=tt));n._RF.pop(),n._RF.push({},"95972yG/ulEg4gycbc+QB5Y","ComponentUtils",void 0);var st,lt,ut,ct,ht,pt,dt,ft,vt,yt=GameCore.Utils,mt=yt.Array,gt=yt.Object,bt=yt.Valid,wt=["cc.Mask","cc.Label","cc.Canvas","cc.Camera","cc.Layout","cc.Button","cc.Sprite","cc.Widget","cc.Renderer","cc.Animation","cc.UIOpacity"],kt=function(){function e(){Te(this,e),this.validComponentCalled={}}return xe(e,[{key:"validateRequiredComponents",value:function(e){var t,n=e.name,i=e.constructor,a=Ke(this.getRequiredComponentNames(i));try{for(a.s();!(t=a.n()).done;){var r=t.value;if(!e.getComponent(r))throw new Error(`${n}: Missing required ${r} component`)}}catch(e){a.e(e)}finally{a.f()}}},{key:"validateRequiredProperties",value:function(e){var t,n=e.name,i=e.constructor,a=Ke(this.getRequiredPropNames(i));try{for(a.s();!(t=a.n()).done;){var r=t.value;if(!gt.hasOwn(e,r))throw new Error(`${n}: Missing required ${r} property`);var o=this.getProperty(r,e);if(!v(o))throw new Error(`${n}: ${r} property is not a cc object`)}}catch(e){a.e(e)}finally{a.f()}}},{key:"validateCustomProperties",value:function(e){var t,n=e.name,i=Ke(this.getCustomPropNames(e));try{for(i.s();!(t=i.n()).done;){var a=t.value;if(!gt.hasOwn(e,a))throw new Error(`${n}: Missing required ${a} property`);var r=this.getProperty(a,e);if(!v(r))throw new Error(`${n}: ${a} property is not a cc object`)}}catch(e){i.e(e)}finally{i.f()}}},{key:"getProperty",value:function(e,t){var n;if(gt.hasOwn(t,e))return(null!==(n=Object.getOwnPropertyDescriptor(t,e))&&void 0!==n?n:{}).value}},{key:"getProps",value:function(e){if(!gt.hasOwn(e,"__props__"))return[];var t=e.__props__;return Array.isArray(t)?t:[]}},{key:"getRequiredPropNames",value:function(e){return this.getProps(e).filter((function(t){return"node"!==t&&(!!gt.hasOwn(e,t)&&(!!v(e[t])&&!t.startsWith("_")))}))}},{key:"getBaseComponentName",value:function(e){for(var t=0,n=wt;t<n.length;t++){var i=n[t];if(i.indexOf(e)>=0)return i}return e}},{key:"getRequiredComponentNames",value:function(e){var t=this;if(!gt.hasOwn(e,"_requireComponent"))return[];var n=e._requireComponent;return Array.isArray(n)?n.map((function(e){return t.getBaseComponentName(e)})):[]}},{key:"getCustomPropNames",value:function(e){var t=this,n=Object.keys(e),i=this.getProps(e.constructor);return mt.difference(n,i).filter((function(e){return!e.startsWith("_")})).filter((function(n){if(!gt.hasOwn(e,n))return!1;var i=t.getProperty(n,e);return!(!bt.isObject(i)||!v(i))}))}}],[{key:"inst",get:function(){return this._instance||(this._instance=new e),this._instance}},{key:"lazyValidateProperties",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(t){var n=e.constructor,i=n.name;if(!this.inst.validComponentCalled[i])try{this.inst.validateRequiredComponents(e),this.inst.validateRequiredProperties(e),this.inst.validateCustomProperties(e)}catch(t){e.enabled=!1,console.error(t)}finally{this.inst.validComponentCalled[i]=!0}}}}]),e}();try{new kt}catch(e){console.error("ComponentUtils",e)}n._RF.pop(),n._RF.push({},"60ac3vor0dMT5bXi8D3VSJN","BubbleAnimation",void 0);var St=i.ccclass,Et=i.property;st=St("BubbleAnimation"),lt=Et(y),ut=Et(m),ct=Et(g),st((dt=Xe((pt=function(e){Ie(n,e);var t=Fe(n);function n(){var e;Te(this,n);for(var i=arguments.length,a=new Array(i),r=0;r<i;r++)a[r]=arguments[r];return Ye(e=t.call.apply(t,[this].concat(a)),"animation",dt,Me(e)),Ye(e,"clipName",ft,Me(e)),Ye(e,"repeat",vt,Me(e)),e.currentRepeat=-1,e}return xe(n,[{key:"__preload",value:function(){this.animation=this.getComponent(y),this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){kt.lazyValidateProperties(this)}},{key:"play",value:function(){var e=this;this.animation&&(this.animation.clips.find((function(t){return(null==t?void 0:t.name)===e.clipName}))?(this.currentRepeat=-1,this.animation.play(this.clipName)):console.warn(`BubbleAnimation: Animation component must have ${this.clipName} clip`))}},{key:"onBubbleAnimationLoop",value:function(){this.animation&&-1!==this.repeat&&(this.currentRepeat++,this.currentRepeat>this.repeat&&this.animation.stop())}}]),n}(f)).prototype,"animation",[lt],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ft=Xe(pt.prototype,"clipName",[ut],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"Bubble"}}),vt=Xe(pt.prototype,"repeat",[ct],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return-1}}),ht=pt));n._RF.pop(),n._RF.push({},"cc0a5OvhdRCMZRZuRscaz+7","AudioPlayer",void 0);var Ct=function(e){Ie(n,GameCore.Plugins.Audio.BaseAudioPlayer);var t=Fe(n);function n(e,i){var a;return Te(this,n),(a=t.call(this,e)).audioSource=i,a}return xe(n,[{key:"play",value:function(e){if(e){var t=e.volume,n=void 0===t?1:t,i=e.loop,a=void 0!==i&&i;this.audioSource.volume=n,this.audioSource.loop=a}this.audioSource.play()}},{key:"pause",value:function(){this.audioSource.pause()}},{key:"resume",value:function(){this.audioSource.state===b.AudioState.PAUSED&&this.audioSource.play()}},{key:"stop",value:function(){this.audioSource.stop()}},{key:"setVolume",value:function(e){this.audioSource.volume=e}},{key:"getAudioSource",value:function(){return this.audioSource}}]),n}();n._RF.pop(),n._RF.push({},"8b5ecHv/+BJiorK1kiVbTcf","AudioChannel",void 0);var Tt=function(e){Ie(i,e);var t,n=Fe(i);function i(e,t){var a;return Te(this,i),(a=n.call(this,t)).allowMultipleTracking={},a.handleLoadedAudio=function(e,t){var n=a.node.addComponent(b);return n.clip=t,n.playOnAwake=!1,new Ct(e,n)},a.node=e,a}return xe(i,[{key:"playing",value:function(e){var t,n=null===(t=this.getAudioClip(e))||void 0===t?void 0:t.audioPlayer;return!!n&&n.getAudioSource().state===b.AudioState.PLAYING}},{key:"onLoadAudio",value:(t=Ce(Se().mark((function e(t,n){var i=this;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,n){w.load(t,k,(function(a,r){try{if(a)throw new Error(a.message);if(!i.node.isValid)return;var o=i.handleLoadedAudio(t,r);e(o)}catch(a){a instanceof Error?n(a):n(new Error("Audio load: Unknown error"))}}))})));case 1:case"end":return e.stop()}}),e)}))),function(e,n){return t.apply(this,arguments)})},{key:"playWithRealConfig",value:function(e,t){if(this.isCanPlay(t)){if(t){var n=t.volume,i=void 0===n?1:n,a=t.allowMultiple,r=void 0!==a&&a;if(t.volume=this.getVolume()*i,r)return void this.requestDuplicateAudioPlayer(e.getKey(),e.getAudioSource().clip,t).play(t)}e.play(t)}}},{key:"isCanPlay",value:function(e){var t=this;if(e){var n=e.checkList;if((void 0===n?[]:n).some((function(e){var n=t.getAudioClip(e);return!!n&&n.audioPlayer.getAudioSource().state===b.AudioState.PLAYING})))return!1}return!0}},{key:"requestDuplicateAudioPlayer",value:function(e,t,n){var i=this.getDuplicateAudioFromPool(e);if(i){if(n){var a=i.key,r=n.volume,o=void 0===r?1:r;this.setAudioClip(a,{volume:o})}return i.audioPlayer}var s=`${e}_${this.allowMultipleTracking[e].currentPostFix}`,l=this.handleLoadedAudio(s,t);return this.allowMultipleTracking[e].list.push({audioPlayer:l,key:s}),this.allowMultipleTracking[e].currentPostFix+=1,this.setAudioClip(s,{audioPlayer:l,volume:1}),l}},{key:"getDuplicateAudioFromPool",value:function(e){if(this.allowMultipleTracking[e]){var t=this.allowMultipleTracking[e].list.find((function(e){return e.audioPlayer.getAudioSource().state!==b.AudioState.PLAYING}));if(t)return t}else this.allowMultipleTracking[e]={currentPostFix:1,list:[]};return null}}]),i}(GameCore.Plugins.Audio.BaseChannelManager);n._RF.pop();var At,xt,Rt,It,Pt;n._RF.push({},"1a025mmN7BL7r5cF6gWR4b/","Music",void 0);var _t,Lt,Ot,Dt,Mt,Nt=i.ccclass,Ft=i.property,Bt=globalThis.game,Gt=Bt.audio,zt=Bt.player,Ut=(At=Nt("Music"),xt=Ft(m),At((Pt=Xe((It=function(e){Ie(n,e);var t=Fe(n);function n(){var e;Te(this,n);for(var i=arguments.length,a=new Array(i),r=0;r<i;r++)a[r]=arguments[r];return Ye(e=t.call.apply(t,[this].concat(a)),"channelId",Pt,Me(e)),e.channel=null,e}return xe(n,[{key:"__preload",value:function(){this.makePersistent(),this.channel=new Tt(this.node,this.channelId),Gt.addChannel(this.channel)}},{key:"makePersistent",value:function(){d.addPersistRootNode(this.node)}},{key:"playing",value:function(e){var t,n;return null!==(t=null===(n=this.channel)||void 0===n?void 0:n.playing(e))&&void 0!==t&&t}},{key:"play",value:function(e,t){var n;this.isMusicEnable()&&(null!==(n=t)&&void 0!==n&&n.loop||(t=ke(ke({},t),{},{loop:!0})),Gt.play(e,t,this.channelId))}},{key:"isMusicEnable",value:function(){return!!zt.getPlayerSetting("music")}},{key:"setVolume",value:function(e){Gt.setVolume(e,this.channelId)}},{key:"pause",value:function(e){Gt.pause(e,this.channelId)}},{key:"resume",value:function(e){this.isMusicEnable()&&Gt.resume(e,this.channelId)}},{key:"stop",value:function(e){Gt.stop(e,this.channelId)}},{key:"mute",value:function(e){e?Gt.mute(this.channelId):Gt.unmute(this.channelId)}}]),n}(f)).prototype,"channelId",[xt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"global_music"}}),Rt=It))||Rt);n._RF.pop(),n._RF.push({},"1299a7X1XNNEKxSKMV6E5jQ","Sound",void 0);var Ht=i.ccclass,Vt=i.property,qt=globalThis.game,Wt=qt.audio,Kt=qt.player,jt=(_t=Ht("Sound"),Lt=Vt(m),_t((Mt=Xe((Dt=function(e){Ie(n,e);var t=Fe(n);function n(){var e;Te(this,n);for(var i=arguments.length,a=new Array(i),r=0;r<i;r++)a[r]=arguments[r];return Ye(e=t.call.apply(t,[this].concat(a)),"channelId",Mt,Me(e)),e.channel=null,e}return xe(n,[{key:"__preload",value:function(){this.channel=new Tt(this.node,this.channelId),Wt.addChannel(this.channel)}},{key:"onLoad",value:function(){""===this.channelId&&(this.channelId=this.node.uuid)}},{key:"makePersistent",value:function(){d.addPersistRootNode(this.node)}},{key:"removePersistent",value:function(){d.removePersistRootNode(this.node)}},{key:"play",value:function(e,t){this.isSoundEnable()&&Wt.play(e,t,this.channelId)}},{key:"isSoundEnable",value:function(){return!!Kt.getPlayerSetting("sound")}},{key:"setVolume",value:function(e){Wt.setVolume(e,this.channelId)}},{key:"pause",value:function(e){Wt.pause(e,this.channelId)}},{key:"resume",value:function(e){this.isSoundEnable()&&Wt.resume(e,this.channelId)}},{key:"stop",value:function(e){Wt.stop(e,this.channelId)}},{key:"stopAll",value:function(){Wt.stopAll(this.channelId)}},{key:"mute",value:function(e){e?Wt.mute(this.channelId):Wt.unmute(this.channelId)}}]),n}(f)).prototype,"channelId",[Lt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),Ot=Dt))||Ot);n._RF.pop(),n._RF.push({},"99b8eEF6WlE8pzPfD+whiJu","AnimUtils",void 0);var Yt,Xt,$t,Qt,Jt,Zt,en,tn,nn,an,rn,on,sn,ln,un,cn,hn,pn,dn,fn,vn=function(){function e(){Te(this,e)}return xe(e,null,[{key:"inst",get:function(){return this._instance||(this._instance=new e),this._instance}},{key:"elasticOut",value:function(e,t,n){if(void 0===t&&(t=.1),void 0===n&&(n=.1),0===e)return 0;if(1===e)return 1;var i=n/4;return t<1?t=1:i=n*Math.asin(1/t)/(2*Math.PI),t*Math.pow(2,-10*e)*Math.sin((e-i)*(2*Math.PI)/n)+1}},{key:"easeOutExpo",value:function(e){return 1===e?1:1-Math.pow(2,-10*e)}},{key:"easeInExpo",value:function(e){return 0===e?0:Math.pow(2,10*e-10)}},{key:"runTweenAsync",value:function(e,t){return new Promise((function(n){var i=e.call((function(){n({tween:e})})).start();t&&(t.aborted?(i.stop(),n({tween:e})):t.addAbortListener((function(){i.stop(),n({tween:e})})))}))}},{key:"waitTweenAsync",value:function(e,t){return new Promise((function(n){var i=S({});i.delay(e),i.call((function(){n()})),i.start(),t&&(t.aborted?(i.stop(),n()):t.addAbortListener((function(){i.stop(),n()})))}))}},{key:"runAnimationAsync",value:function(e,t){return new Promise((function(n){e.play(t),e.once(y.EventType.FINISHED,(function(){n()}))}))}}]),e}();try{new vn}catch(e){console.error("AnimUtils",e)}n._RF.pop(),n._RF.push({},"84a2dB5IaRJ8JB+n9yXfBc7","AutoLayout",void 0);var yn,mn,gn,bn,wn,kn=i.ccclass,Sn=i.property,En=(Yt=kn("AutoLayoutWrappee"),Xt=Sn({type:s}),$t=Sn({type:s}),Yt((Zt=Xe((Jt=xe((function e(){Te(this,e),Ye(this,"wrapeeContainer",Zt,this),Ye(this,"wrapee",en,this)}))).prototype,"wrapeeContainer",[Xt],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),en=Xe(Jt.prototype,"wrapee",[$t],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Qt=Jt))||Qt),Cn=(tn=kn("AutoLayout"),nn=Sn({displayName:"Use Auto Layout"}),an=Sn({type:[En],displayName:"Children",visible(){return this.useAutoLayout}}),rn=Sn({visible:!1,serializable:!0}),on=Sn({type:g,displayName:"Selected Index",visible(){return this.useAutoLayout}}),sn=Sn({type:E,displayName:"Deselected Icon Width",group:"Edge Icons",visible(){return this.useAutoLayout}}),ln=Sn({visible:!1,serializable:!0}),tn((hn=Xe((cn=function(e){Ie(i,e);var t,n=Fe(i);function i(){var e;Te(this,i);for(var t=arguments.length,a=new Array(t),r=0;r<t;r++)a[r]=arguments[r];return Ye(e=n.call.apply(n,[this].concat(a)),"useAutoLayout",hn,Me(e)),Ye(e,"children",pn,Me(e)),e.mappedChildren=[],Ye(e,"selected",dn,Me(e)),Ye(e,"deselectedIconW",fn,Me(e)),e.tweens=[],e}return xe(i,[{key:"selectedIndex",get:function(){return this.selected},set:function(e){this.selected=e,this.updateLayout(!0)}},{key:"deselectedIconWidth",get:function(){return this.deselectedIconW},set:function(e){this.deselectedIconW=e,this.updateLayout(!0)}},{key:"__preload",value:function(){this.mappedChildren=this.children.map((function(e){var t=e.wrapeeContainer.getComponent(C);if(!t)throw new Error("AutoLayout: Widget component not found");return ke(ke({},e),{},{wrapeeContainerWidget:t})}))}},{key:"updateLayout",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];(this._layoutDirty||e)&&(this.updateChildrenAnchors(),this.mappedChildren.forEach((function(e){return e.wrapeeContainerWidget.updateAlignment()}))),Ge(Pe(i.prototype),"updateLayout",this).call(this,e)}},{key:"getSelectedWorldX",value:function(){var e=this.mappedChildren[this.selectedIndex].wrapeeContainer;return 0===this.selectedIndex||this.selectedIndex===this.children.length-1?e.getBoundingBoxToWorld().xMin+this.getAnchorX(this.selectedIndex)*e.width:e.getBoundingBoxToWorld().center.x}},{key:"getAnchorX",value:function(e){if(e<this.selectedIndex)return 0;if(e>this.selectedIndex)return 1;if(0===e){var t=this.mappedChildren[e].wrapeeContainer.width,n=this.deselectedIconWidth/2,i=this.paddingLeft;return((i+t+(t-n+this.spacingX))/2-i)/t}if(e===this.children.length-1){var a=this.mappedChildren[e].wrapeeContainer.width,r=a-this.deselectedIconWidth/2+this.spacingX;return((r+a+this.paddingRight)/2-r)/a}return.5}},{key:"updateChildrenAnchors",value:(t=Ce(Se().mark((function e(){var t=this;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.tweens.forEach((function(e){return e.stop()})),this.tweens=[],e.next=4,Promise.all([this.children.flatMap((function(e,n){return t.getChildrenAnchorsTweens(e,t.getAnchorX(n))})).map((function(e){return vn.runTweenAsync(e)}))]);case 4:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"updateChildrenAnchorsEditor",value:function(){var e=this;this.children.forEach((function(t,n){var i=e.getAnchorX(n);t.wrapee.setAnchorPoint(i,t.wrapee.anchorY),t.wrapeeContainer.setAnchorPoint(i,t.wrapeeContainer.anchorY)}))}},{key:"getChildrenAnchorsTweens",value:function(e,t){return[S(e.wrapee).to(.3,{anchorX:t},{easing:"sineInOut"}).call((function(){e.wrapee.setAnchorPoint(t,e.wrapee.anchorY)})),S(e.wrapeeContainer).to(.3,{anchorX:t},{easing:"sineInOut"}).call((function(){e.wrapeeContainer.setAnchorPoint(t,e.wrapeeContainer.anchorY)}))]}}]),i}(T)).prototype,"useAutoLayout",[nn],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),pn=Xe(cn.prototype,"children",[an],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),dn=Xe(cn.prototype,"selected",[rn],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Xe(cn.prototype,"selectedIndex",[on],Object.getOwnPropertyDescriptor(cn.prototype,"selectedIndex"),cn.prototype),Xe(cn.prototype,"deselectedIconWidth",[sn],Object.getOwnPropertyDescriptor(cn.prototype,"deselectedIconWidth"),cn.prototype),fn=Xe(cn.prototype,"deselectedIconW",[ln],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),un=cn))||un);n._RF.pop(),n._RF.push({},"ca427NpeqpC3bUoGTd9I/BM","Background",void 0);var Tn=i.ccclass,An=i.property;yn=Tn("Background"),mn=An({type:A}),yn((wn=Xe((bn=function(e){Ie(n,e);var t=Fe(n);function n(){var e;Te(this,n);for(var i=arguments.length,a=new Array(i),r=0;r<i;r++)a[r]=arguments[r];return Ye(e=t.call.apply(t,[this].concat(a)),"sprite",wn,Me(e)),e}return xe(n,[{key:"__preload",value:function(){this.validateRequiredComponents(),this.listenGameEvents()}},{key:"validateRequiredComponents",value:function(){kt.lazyValidateProperties(this)}},{key:"listenGameEvents",value:function(){}}]),n}(f)).prototype,"sprite",[mn],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),gn=bn));n._RF.pop(),n._RF.push({},"bf320amyc1I86bS3oK0M9NR","DashboardEvents",void 0);var xn="STARS_UPDATED",Rn="PLAY_BUTTON_PRESS",In="REQUEST_NAVIGATION",Pn="REQUEST_NAVIGATION_ANIMATION",_n="DASHBOARD_EVENTS_BUTTON_PRESS";n._RF.pop(),n._RF.push({},"68b8bf0Va5JT7NVPECDNC5l","DashboardScreens",void 0);var Ln=function(e){return e[e.store=0]="store",e[e.collections=1]="collections",e[e.home=2]="home",e[e.leaderboard=3]="leaderboard",e[e.tournaments=4]="tournaments",e}(Ln||{});x(Ln),n._RF.pop(),n._RF.push({},"a0756pde9lOeoJ4TckTOcMV","AnimAbortSignal",void 0);var On=function(){function e(){Te(this,e),this.isAborted=!1,this.abortReason="",this.eventTarget=new EventTarget}var t;return xe(e,[{key:"aborted",get:function(){return this.isAborted}},{key:"reason",get:function(){return this.abortReason}},{key:"addAbortListener",value:function(e){this.eventTarget.addEventListener("abort",e)}},{key:"removeAbortListener",value:function(e){this.eventTarget.removeEventListener("abort",e)}},{key:"abort",value:function(e){this.isAborted||(this.isAborted=!0,this.abortReason=e,this.eventTarget.dispatchEvent(new Event("abort")))}},{key:"untilAborted",value:(t=Ce(Se().mark((function e(){var t=this;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.isAborted){e.next=2;break}return e.abrupt("return");case 2:return e.abrupt("return",new Promise((function(e){t.addAbortListener((function(){return e()}))})));case 3:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}],[{key:"hasBeenAborted",value:function(e){return null==e||e.aborted}}]),e}();n._RF.pop(),n._RF.push({},"a6e4bjV/RVH17qBEx1mZaFg","ResourcePaths",void 0);var Dn=function(e){return e.BOMB_RESCUE_PREFAB="game-objects/bomb/BombRescue",e.BOMB_EXPLODE_PREFAB="game-objects/bomb/BombExplode",e.BOMB_DEFUSE_PREFAB="game-objects/bomb/DefuseExplode",e.COLLECTIONS_CONTENT_PREFAB="game-objects/dashboard-scene/CollectionsContent",e.CLOUD_IDLE_ANIM="animations/CloudIdle",e.TORNADO_IDLE_ANIM="animations/TornadoIdle",e.TILE_BREAK_ANIM="animations/TileBreak",e.TILE_CLEAR_ANIM="animations/TileClear",e.TILE_SHAKE_ANIM="animations/TileShake",e.TILE_SKIN_FOLDER="loadable/tiles",e.TILE_SKIN_PREVIEW_FOLDER="loadable/tiles-preview",e.ITEM_POPUP_FOLDER="loadable/item-popup",e.SUMMER_BG="images/bg/summer",e.AUTUMN_BG="images/bg/autumn",e.WINTER_BG="images/bg/winter",e.SUMMER_BG_PREVIEW="images/preview/summer",e.AUTUMN_BG_PREVIEW="images/preview/autumn",e.WINTER_BG_PREVIEW="images/preview/winter",e.COLLECTIONS_PAGE="pages/CollectionsContent",e.LEADERBOARD_PAGE="pages/LeaderboardContent",e.TOURNAMENTS_PAGE="pages/TournamentsContent",e.LEVEL_DATA_FOLDER="levels-json",e}(Dn||{});n._RF.pop(),n._RF.push({},"2a657+TsltMe4rrDmyWGrLy","ThemeResourcesPath",void 0);var Mn={summer:Dn.SUMMER_BG,autumn:Dn.AUTUMN_BG,winter:Dn.WINTER_BG},Nn={summer:Dn.SUMMER_BG_PREVIEW,autumn:Dn.AUTUMN_BG_PREVIEW,winter:Dn.WINTER_BG_PREVIEW};n._RF.pop(),n._RF.push({},"669a1OtNF9EDrMRLWTjxk4B","GeneralUtils",void 0);var Fn,Bn,Gn,zn,Un,Hn,Vn,qn,Wn,Kn,jn,Yn,Xn,$n,Qn,Jn,Zn,ei,ti,ni,ii,ai=function(){function e(){Te(this,e)}var t,n,i,a,r,o,s,l,u,c;return xe(e,null,[{key:"inst",get:function(){return this._instance||(this._instance=new e),this._instance}},{key:"setBlockInput",value:function(e){var t=R("Canvas/InputBlocker");t?t.active=e:console.warn("InputBlocker not found")}},{key:"getBlockInput",value:function(){var e=R("Canvas/InputBlocker");return e?e.active:(console.warn("InputBlocker not found"),!1)}},{key:"loadPrefabAsync",value:function(e){var t=w.getInfoWithPath(e,I);if(t&&null!==w.get(t.path,I)){var n=w.get(t.path,I);if(null!==n)return Promise.resolve(n)}return new Promise((function(t){w.load(e,I,(function(e,n){e&&t(null),t(n)}))}))}},{key:"loadJsonAsync",value:(c=Ce(Se().mark((function e(t){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e){var n=w.getInfoWithPath(t,P);if(n&&null!==w.get(n.path,P)){var i=w.get(n.path,P);null!==i&&e(i.json)}w.load(t,P,(function(t,n){t&&e(null),n&&n.json||e(null),e(n.json)}))})));case 1:case"end":return e.stop()}}),e)}))),function(e){return c.apply(this,arguments)})},{key:"loadAnimClipAsync",value:(u=Ce(Se().mark((function e(t){var n,i;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(n=w.getInfoWithPath(t,_))||null===w.get(n.path,_)){e.next=5;break}if(null===(i=w.get(n.path,_))){e.next=5;break}return e.abrupt("return",Promise.resolve(i));case 5:return e.abrupt("return",new Promise((function(e){w.load(t,_,(function(t,n){t&&e(null),e(n)}))})));case 6:case"end":return e.stop()}}),e)}))),function(e){return u.apply(this,arguments)})},{key:"loadImageSpriteFrameAsync",value:(l=Ce(Se().mark((function e(t){var n,i;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(n=w.getInfoWithPath(t,L))||null===w.get(n.path,L)){e.next=5;break}if(null===(i=w.get(n.path,L))){e.next=5;break}return e.abrupt("return",Promise.resolve(O.createWithImage(i)));case 5:return e.abrupt("return",new Promise((function(e){w.load(t,L,(function(t,n){t&&e(null),e(O.createWithImage(n))}))})));case 6:case"end":return e.stop()}}),e)}))),function(e){return l.apply(this,arguments)})},{key:"loadSpriteFrameAsync",value:(s=Ce(Se().mark((function e(t){var n,i,a,r=arguments;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=!(r.length>1&&void 0!==r[1])||r[1],!(i=w.getInfoWithPath(t,O))||null===w.get(i.path,O)){e.next=7;break}if(null===(a=w.get(i.path,O))){e.next=7;break}return a.packable=n,e.abrupt("return",Promise.resolve(a));case 7:return e.abrupt("return",new Promise((function(e){w.load(t,O,(function(t,i){!t&&i?(i.packable=n,e(i)):e(null)}))})));case 8:case"end":return e.stop()}}),e)}))),function(e){return s.apply(this,arguments)})},{key:"loadSpriteFramesDirAsync",value:(o=Ce(Se().mark((function e(t){var n,i,a,r,o,s;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!((n=w.getDirWithPath(t,O)).length>0)){e.next=23;break}i=[],a=Ke(n),e.prev=4,a.s();case 6:if((r=a.n()).done){e.next=14;break}if(o=r.value,s=w.get(o.path,O)){e.next=11;break}return e.abrupt("return",this.loadSpriteFramesFromDirAsync(t));case 11:i.push(s);case 12:e.next=6;break;case 14:e.next=19;break;case 16:e.prev=16,e.t0=e.catch(4),a.e(e.t0);case 19:return e.prev=19,a.f(),e.finish(19);case 22:return e.abrupt("return",i);case 23:return e.abrupt("return",this.loadSpriteFramesFromDirAsync(t));case 24:case"end":return e.stop()}}),e,this,[[4,16,19,22]])}))),function(e){return o.apply(this,arguments)})},{key:"loadSpriteFramesFromDirAsync",value:(r=Ce(Se().mark((function e(t){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e){w.loadDir(t,O,(function(t,n){t&&e([]),e(n)}))})));case 1:case"end":return e.stop()}}),e)}))),function(e){return r.apply(this,arguments)})},{key:"lazyLoadDashboardSceneResourcesAsync",value:(a=Ce(Se().mark((function t(){return Se().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",e.loadPrefabAsync(Dn.COLLECTIONS_CONTENT_PREFAB));case 1:case"end":return t.stop()}}),t)}))),function(){return a.apply(this,arguments)})},{key:"loadThemeAsync",value:(i=Ce(Se().mark((function e(t){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.loadSpriteFrameAsync(`${Mn[t]}/spriteFrame`));case 1:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})},{key:"loadThemePreviewAsync",value:(n=Ce(Se().mark((function e(t){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.loadSpriteFrameAsync(`${Nn[t]}/spriteFrame`));case 1:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"loadSkinPreviewAsync",value:(t=Ce(Se().mark((function e(t){var n,i,a;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(n=[],i=1;i<=4;i++)a=`${Dn.TILE_SKIN_PREVIEW_FOLDER}/${t.replace(/-/g,"_")}_${i}/spriteFrame`,n.push(this.loadSpriteFrameAsync(a));return e.abrupt("return",Promise.all(n));case 4:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})}]),e}();try{new ai}catch(e){console.error("GeneralUtils",e)}n._RF.pop(),n._RF.push({},"ab9cd/wERRKYqhDoYtJ1L3w","MultiBackground",void 0);var ri=i.ccclass,oi=i.property,si=globalThis.game.monitorError,li=(Fn=ri("MultiBackground"),Bn=oi({type:A}),Gn=oi({type:A}),zn=oi({type:s}),Un=oi({type:s}),Hn=oi({type:s}),Vn=oi(g),qn=oi(C),Wn=oi({type:D(Ln)}),Kn=oi({type:D(Ln)}),Fn((Xn=Xe((Yn=function(e){Ie(a,e);var t,n,i=Fe(a);function a(){var e;Te(this,a);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return Ye(e=i.call.apply(i,[this].concat(n)),"background1",Xn,Me(e)),Ye(e,"background2",$n,Me(e)),Ye(e,"screenUiTransform",Qn,Me(e)),Ye(e,"background1Uitransform",Jn,Me(e)),Ye(e,"background2UiTransform",Zn,Me(e)),Ye(e,"backgroundNudgeAmount",ei,Me(e)),Ye(e,"nudgeableWidget",ti,Me(e)),Ye(e,"pageOrder",ni,Me(e)),Ye(e,"homePage",ii,Me(e)),e.currentThemeId="",e.tryNudgeBackground=function(t){var n=t.to,i=e.getDirection(e.homePage,n),a=Math.sign(i),r=Math.abs(i),o=e.backgroundNudgeAmount*r,s=Math.min(e.background1Uitransform.width,e.background2UiTransform.width),l=Math.max(0,(s-e.screenUiTransform.width)/2),u=Math.min(l,o)*a;S(e.nudgeableWidget).to(.5,{horizontalCenter:u},{easing:M.cubicInOut}).start()},e}return xe(a,[{key:"onLoad",value:function(){this.currentBackground=this.background1,this.nextBackground=this.background2,kt.lazyValidateProperties(this),this.listenToNavigationEvents()}},{key:"onDestroy",value:function(){var e;null===(e=this.tweenSignal)||void 0===e||e.abort(),this.unlistenToNavigationEvents()}},{key:"listenToNavigationEvents",value:function(){this.node.scene.on(Pn,this.tryNudgeBackground)}},{key:"unlistenToNavigationEvents",value:function(){this.node.scene.off(Pn,this.tryNudgeBackground)}},{key:"getDirection",value:function(e,t){var n=this.pageOrder.indexOf(e),i=this.pageOrder.indexOf(t);return-1===n||-1===i?(null==si||si.sendException(new Error("MultiBackground.getDirection: fromIndex or toIndex is -1")),0):n-i}},{key:"setCurrentTheme",value:(n=Ce(Se().mark((function e(t){var n;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,ai.loadThemeAsync(t);case 2:if(n=e.sent){e.next=6;break}return null==si||si.sendException(new Error(`MultiBackground.setCurrentTheme: Failed to load theme ${t}'s sprite.`)),e.abrupt("return");case 6:n.packable=!1,this.background1.spriteFrame=n,this.background2.spriteFrame=n,this.currentThemeId=t;case 10:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"animateToNextTheme",value:(t=Ce(Se().mark((function e(t){var n,i,a,r;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.currentThemeId!==t){e.next=2;break}return e.abrupt("return",Promise.resolve());case 2:return e.next=4,ai.loadThemeAsync(t);case 4:if(i=e.sent){e.next=8;break}return null==si||si.sendException(new Error(`MultiBackground.animateToNextTheme: Failed to load theme ${t}'s sprite.`)),e.abrupt("return");case 8:if(i.packable=!1,this.currentThemeId=t,this.nextBackground.node.active=!0,this.nextBackground.spriteFrame=i,this.nextBackground.node.setSiblingIndex(1),a=this.nextBackground.getComponent(N)){e.next=16;break}throw new Error(`${this.nextBackground.node.name} UIOpacity is required`);case 16:return a.opacity=0,null===(n=this.tweenSignal)||void 0===n||n.abort(),this.tweenSignal=new On,e.next=21,vn.runTweenAsync(S(a).to(1,{opacity:255}),this.tweenSignal);case 21:if(!this.tweenSignal.aborted){e.next=23;break}return e.abrupt("return");case 23:this.currentBackground.node.active=!1,r=this.currentBackground,this.currentBackground=this.nextBackground,this.nextBackground=r;case 27:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})}]),a}(f)).prototype,"background1",[Bn],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),$n=Xe(Yn.prototype,"background2",[Gn],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Qn=Xe(Yn.prototype,"screenUiTransform",[zn],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Jn=Xe(Yn.prototype,"background1Uitransform",[Un],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Zn=Xe(Yn.prototype,"background2UiTransform",[Hn],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ei=Xe(Yn.prototype,"backgroundNudgeAmount",[Vn],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 50}}),ti=Xe(Yn.prototype,"nudgeableWidget",[qn],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ni=Xe(Yn.prototype,"pageOrder",[Wn],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),ii=Xe(Yn.prototype,"homePage",[Kn],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Ln.home}}),jn=Yn))||jn);n._RF.pop(),n._RF.push({},"d159egaUVVLHKLg1UL865ub","SoundKeys",void 0);var ui={BUTTON_CLICK:"sounds/use_item_click",BOMB_DEFUSE:"sounds/bomb_defuse",BOMB_EXPLODE_1:"sounds/bomb_explode_1",BOMB_EXPLODE_2:"sounds/bomb_explode_2",CLICKS:"sounds/clicks",CLOSE_POPUP_CLICK:"sounds/close_popup_click",COLLECT_STARS:"sounds/collect_stars",COMBO_1:"sounds/combo_1",COMBO_2:"sounds/combo_2",COMBO_3:"sounds/combo_3",COMBO_4:"sounds/combo_4",COMBO_5:"sounds/combo_5",DAILY_REWARD:"sounds/daily_reward",EXTRA_TIME_SPAWN:"sounds/extra_time_spawn",GIFT_CHARGE:"sounds/gift_charge",GIFT_EXPLODE:"sounds/gift_explode",GIFT_REVEAL:"sounds/gift_reveal",HINT_ITEM:"sounds/hint_item",INVALID_MATCH:"sounds/invalid_match",LEVEL_COMPLETE:"sounds/level_complete",LEVEL_FAIL:"sounds/level_fail",LEVEL_START:"sounds/level_start",PROGRESS_STAR:"sounds/progress_star",RESCUE_TIMER:"sounds/rescue_timer",ROCKET_FLY:"sounds/rocket_fly",SHUFFLE_ITEM:"sounds/shuffle_item",THREE_STARS:"sounds/three_stars",TICKING_BOMB_BEFORE_EXPLODE:"sounds/ticking_bomb_before_explode",TILE_SELECT:"sounds/tile_select",USE_ITEM_CLICK:"sounds/use_item_click",BG_MUSIC:"musics/bg_music",PATCH_SHIFT:"sounds/patch_shift",THUNDERBOLT:"sounds/thunderbolt",WIND:"sounds/wind",COLLECT_COINS:"sounds/collect_coins",COLLECT_STOCK_COINS:"sounds/collect_stock_coins",LEVEL_FAIL_TIMEOUT:"sounds/level_fail_timeout",STAR_CHEST_DRUM_ROLL:"sounds/star_chest_drum_roll",STAR_CHEST_OPEN:"sounds/star_chest_open",LEADERBOARD_TRIUMPH:"sounds/leaderboard_triumph",ITEM_REWARD:"sounds/item_reward"},ci=Object.values(ui),hi=ci.reduce((function(e,t,n){return ke(ke({},e),{},{[t]:n})}),{});x(hi);var pi=ci;n._RF.pop(),n._RF.push({},"0eeb868JeVE67iFwhbkRCmE","ScreenKeys",void 0);var di=function(e){return e[e.RESCUES_SCREEN=0]="RESCUES_SCREEN",e[e.LOADING_SCREEN=1]="LOADING_SCREEN",e[e.GET_ITEM_SCREEN=2]="GET_ITEM_SCREEN",e[e.GET_COIN_SCREEN=3]="GET_COIN_SCREEN",e[e.SETTINGS_SCREEN=4]="SETTINGS_SCREEN",e[e.START_LEVEL_SCREEN=5]="START_LEVEL_SCREEN",e[e.NOTIFICATION_SCREEN=6]="NOTIFICATION_SCREEN",e[e.LEVEL_COMPLETE_SCREEN=7]="LEVEL_COMPLETE_SCREEN",e[e.CONGRATULATION_SCREEN=8]="CONGRATULATION_SCREEN",e[e.QUIT_LEVEL_SCREEN=9]="QUIT_LEVEL_SCREEN",e[e.TOURNAMENT_DETAIL_SCREEN=10]="TOURNAMENT_DETAIL_SCREEN",e[e.DAILY_REWARDS_SCREEN=11]="DAILY_REWARDS_SCREEN",e[e.STAR_CHEST_SCREEN=12]="STAR_CHEST_SCREEN",e}(di||{}),fi={[di.RESCUES_SCREEN]:"RescuesScreen",[di.LOADING_SCREEN]:"LoadingScreen",[di.GET_ITEM_SCREEN]:"GetItemScreen",[di.GET_COIN_SCREEN]:"GetCoinScreen",[di.SETTINGS_SCREEN]:"SettingsScreen",[di.START_LEVEL_SCREEN]:"StartLevelScreen",[di.NOTIFICATION_SCREEN]:"NotificationScreen",[di.LEVEL_COMPLETE_SCREEN]:"LevelCompleteScreen",[di.CONGRATULATION_SCREEN]:"CongratulationScreen",[di.QUIT_LEVEL_SCREEN]:"QuitLevelScreen",[di.TOURNAMENT_DETAIL_SCREEN]:"TournamentDetailScreen",[di.DAILY_REWARDS_SCREEN]:"DailyRewardsScreen",[di.STAR_CHEST_SCREEN]:"StarChestScreen"},vi={[fi[di.RESCUES_SCREEN]]:di.RESCUES_SCREEN,[fi[di.LOADING_SCREEN]]:di.LOADING_SCREEN,[fi[di.GET_ITEM_SCREEN]]:di.GET_ITEM_SCREEN,[fi[di.GET_COIN_SCREEN]]:di.GET_COIN_SCREEN,[fi[di.SETTINGS_SCREEN]]:di.SETTINGS_SCREEN,[fi[di.START_LEVEL_SCREEN]]:di.START_LEVEL_SCREEN,[fi[di.NOTIFICATION_SCREEN]]:di.NOTIFICATION_SCREEN,[fi[di.LEVEL_COMPLETE_SCREEN]]:di.LEVEL_COMPLETE_SCREEN,[fi[di.CONGRATULATION_SCREEN]]:di.CONGRATULATION_SCREEN,[fi[di.QUIT_LEVEL_SCREEN]]:di.QUIT_LEVEL_SCREEN,[fi[di.TOURNAMENT_DETAIL_SCREEN]]:di.TOURNAMENT_DETAIL_SCREEN,[fi[di.DAILY_REWARDS_SCREEN]]:di.DAILY_REWARDS_SCREEN,[fi[di.STAR_CHEST_SCREEN]]:di.STAR_CHEST_SCREEN},yi=[di[di.NOTIFICATION_SCREEN],di[di.LOADING_SCREEN]];n._RF.pop(),n._RF.push({},"09bc071ZcpI978b1NdKUaqD","AnalyticsUtils",void 0);var mi=globalThis.game.analytics,gi=function(){function e(){Te(this,e)}return xe(e,null,[{key:"inst",get:function(){return this._instance||(this._instance=new e),this._instance}},{key:"trackCurrentPage",value:function(e,t){if(-1===yi.indexOf(e)&&(t||-1!==this.trackingPages.indexOf(e))){this.trackingPages=this.trackingPages.filter((function(t){return t!==e})),t&&this.trackingPages.push(e);var n=this.getCurrentPage();mi.pageview(n)}}},{key:"switchSceneTracking",value:function(){this.trackingPages=[];var e=this.getCurrentPage();mi.pageview(e)}},{key:"getCurrentPage",value:function(){var e,t;return this.trackingPages.length>0?this.trackingPages[this.trackingPages.length-1]:null!==(e=null===(t=d.getScene())||void 0===t?void 0:t.name)&&void 0!==e?e:"Unknown Scene"}}]),e}();gi.trackingPages=[];try{new gi}catch(e){console.error("AnalyticsUtils",e)}n._RF.pop(),n._RF.push({},"31871PLRYRJu7yCCX5F6lWK","AudioUtils",void 0);var bi=function(){function e(){Te(this,e)}return xe(e,[{key:"sound",get:function(){var e,t;return null!==(e=null===(t=R("Sound"))||void 0===t?void 0:t.getComponent(jt))&&void 0!==e?e:null}},{key:"music",get:function(){var e,t;return null!==(e=null===(t=R("Music"))||void 0===t?void 0:t.getComponent(Ut))&&void 0!==e?e:null}}],[{key:"inst",get:function(){return this._instance||(this._instance=new e),this._instance}},{key:"muteAudio",value:function(e){this.muteMusic(e),this.muteSound(e)}},{key:"playSound",value:function(e,t){var n;null===(n=this.inst.sound)||void 0===n||n.play(e,t)}},{key:"pauseSound",value:function(e){var t;null===(t=this.inst.sound)||void 0===t||t.pause(e)}},{key:"resumeSound",value:function(e){var t;null===(t=this.inst.sound)||void 0===t||t.resume(e)}},{key:"stopSound",value:function(e){var t;null===(t=this.inst.sound)||void 0===t||t.stop(e)}},{key:"stopAllSounds",value:function(){var e;null===(e=this.inst.sound)||void 0===e||e.stopAll()}},{key:"muteSound",value:function(e){var t;null===(t=this.inst.sound)||void 0===t||t.mute(e)}},{key:"playMusic",value:function(){var e,t,n=arguments.length>0&&void 0!==arguments[0]&&arguments[0];!n&&null!==(e=this.inst.music)&&void 0!==e&&e.playing(ui.BG_MUSIC)||null===(t=this.inst.music)||void 0===t||t.play(ui.BG_MUSIC)}},{key:"pauseMusic",value:function(){var e;null===(e=this.inst.music)||void 0===e||e.pause(ui.BG_MUSIC)}},{key:"muteMusic",value:function(e){var t;null===(t=this.inst.music)||void 0===t||t.mute(e)}},{key:"turnUpMusic",value:function(){var e;null===(e=this.inst.music)||void 0===e||e.setVolume(.8)}},{key:"turnDownMusic",value:function(){var e;null===(e=this.inst.music)||void 0===e||e.setVolume(.4)}},{key:"turnOffMusic",value:function(){var e;null===(e=this.inst.music)||void 0===e||e.setVolume(0)}}]),e}();try{new bi}catch(e){console.error("AudioUtils",e)}n._RF.pop(),n._RF.push({},"05faedSJ2NHFqLe9b3g4RIl","CocosUtils",void 0);var wi,ki,Si,Ei,Ci,Ti,Ai,xi,Ri,Ii,Pi,_i,Li,Oi,Di,Mi,Ni,Fi,Bi,Gi,zi,Ui,Hi,Vi,qi,Wi,Ki,ji,Yi,Xi,$i,Qi,Ji,Zi=function(){function e(){Te(this,e)}return xe(e,[{key:"getWindowSizeVsWorldGameRatio",value:function(){var e=F.getVisibleSize();return B.windowSize.width/window.devicePixelRatio/e.width}},{key:"getBoundingBoxTo",value:function(e,t){var n=G.mat4();G.Mat4.fromSRT(n,t.getRotation(),t.getPosition(),t.getScale());var i=t.getComponent(s);if(!i)throw new Error("Node must have UITransform component");var a=i.anchorPoint,r=i.contentSize,o=r.width,l=r.height,u=new G.Rect(-a.x*o,-a.y*l,o,l),c=G.mat4();if(G.Mat4.multiply(c,e,n),u.transformMat4(c),!t.children||0===t.children.length)return u;var h,p=t.children,d=t.getWorldMatrix(),f=Ke(p);try{for(f.s();!(h=f.n()).done;){var v=h.value;if(null!=v&&v.active)if(v.getComponent(s)){var y=this.getBoundingBoxTo(d,v);y&&G.Rect.union(u,u,y)}}}catch(e){f.e(e)}finally{f.f()}return u}}],[{key:"inst",get:function(){return this._instance||(this._instance=new e),this._instance}},{key:"getBoundingBoxToWorld",value:function(e){if(e.parent){var t=e.parent.getWorldMatrix();return this.inst.getBoundingBoxTo(t,e)}var n=e.getComponent(s);if(!n)throw new Error("Node must have UITransform component");return n.getBoundingBox()}},{key:"worldSizeToCssSize",value:function(e){return e*this.inst.getWindowSizeVsWorldGameRatio()}},{key:"cssSizeToWorldSize",value:function(e){return e/this.inst.getWindowSizeVsWorldGameRatio()}},{key:"getScreenWidthCss",value:function(){var e=document,t=e.body,n=e.documentElement,i=t.clientWidth,a=n.clientWidth;return Math.max(a,i)||0}},{key:"getScreenHeightCss",value:function(){var e=document,t=e.body,n=e.documentElement,i=t.clientHeight,a=n.clientHeight;return Math.max(a,i)||0}}]),e}();try{new Zi}catch(e){console.error("CocosUtils",e)}n._RF.pop(),n._RF.push({},"ef63ctZn6BPAout9ufUgFVq","ExtendedButton",void 0);var ea,ta,na,ia,aa=i.ccclass,ra=i.property,oa=i.disallowMultiple,sa=i.executionOrder,la=globalThis.game.analytics,ua=(wi=aa("ExtendedButton"),ki=sa(111),Si=ra(z),Ei=ra(z),Ci=ra(U.AnimationController),Ti=ra({override:!0,visible:!1}),Ai=ra({override:!0,visible:!1}),xi=ra({override:!0,visible:!1}),Ri=ra({override:!0,visible:!1}),Ii=ra({override:!0,visible:!1}),Pi=ra({override:!0,visible:!1}),_i=ra({override:!0,visible:!1}),Li=ra({override:!0,visible:!1}),Oi=ra({override:!0,visible:!1}),Di=ra({override:!0,visible:!1}),Mi=ra({override:!0,visible:!1}),Ni=ra(H),Fi=ra(H),Bi=ra(H),Gi=ra({visible(){return this.makeSound},type:hi}),zi=ra({tooltip:"Add a delay after click to prevent spamming (not apply for cancel click)"}),Ui=ra({visible(){return this.disableSpamClick},tooltip:"Delay time in seconds"}),wi(Hi=oa(Hi=ki((qi=Xe((Vi=function(e){Ie(n,e);var t=Fe(n);function n(){var e;Te(this,n);for(var i=arguments.length,a=new Array(i),r=0;r<i;r++)a[r]=arguments[r];return Ye(e=t.call.apply(t,[this].concat(a)),"clickStartEvents",qi,Me(e)),Ye(e,"clickEndEvents",Wi,Me(e)),Ye(e,"animationController",Ki,Me(e)),Ye(e,"useDesktopHover",ji,Me(e)),Ye(e,"emitAnalyticsEvents",Yi,Me(e)),Ye(e,"makeSound",Xi,Me(e)),Ye(e,"soundKey",$i,Me(e)),Ye(e,"disableSpamClick",Qi,Me(e)),Ye(e,"disableSpamDelay",Ji,Me(e)),e.currentClickBoundingBox=null,e.hasDown=!1,e.hasUp=!1,e.hasFinishClickCycle=!1,e.onTouchStart=function(t){e.interactable&&(e.hasDown||(e.currentClickBoundingBox=Zi.getBoundingBoxToWorld(e.node),e.handleDown(t)))},e.onTouchEnd=function(t){e.interactable&&e.hasDown&&(e.hasUp||e.handleUp(t))},e.onTouchCancel=function(t){var n,i;if(e.interactable&&e.hasDown&&!e.hasUp){var a=t.getUILocation();null!==(n=null===(i=e.currentClickBoundingBox)||void 0===i?void 0:i.contains(a))&&void 0!==n&&n?e.handleUp(t):(e.hasUp=!0,e.hasFinishClickCycle=!0,e.handleResetButtonState(),e.emitClickEndEvents(t))}},e.onMouseEnter=function(t){e.useDesktopHover&&e.interactable&&(e.hasDown||(e.hasFinishClickCycle=!1,e.setAnimationState("HOVER")))},e.onMouseLeave=function(t){e.useDesktopHover&&e.interactable&&(e.hasDown||e.hasUp||e.hasFinishClickCycle||e.handleResetButtonState())},e.handleResetButtonState=function(){e.hasDown=!1,e.hasUp=!1,e.setAnimationState("RESET")},e}return xe(n,[{key:"transition",get:function(){return p.Transition.NONE},set:function(e){Ue(Pe(n.prototype),"transition",p.Transition.NONE,this,!0)}},{key:"normalColor",get:function(){return Ge(Pe(n.prototype),"normalColor",this)},set:function(e){Ue(Pe(n.prototype),"normalColor",e,this,!0)}},{key:"pressedColor",get:function(){return Ge(Pe(n.prototype),"pressedColor",this)},set:function(e){Ue(Pe(n.prototype),"pressedColor",e,this,!0)}},{key:"hoverColor",get:function(){return Ge(Pe(n.prototype),"hoverColor",this)},set:function(e){Ue(Pe(n.prototype),"hoverColor",e,this,!0)}},{key:"disabledColor",get:function(){return Ge(Pe(n.prototype),"disabledColor",this)},set:function(e){Ue(Pe(n.prototype),"disabledColor",e,this,!0)}},{key:"normalSprite",get:function(){return Ge(Pe(n.prototype),"normalSprite",this)},set:function(e){Ue(Pe(n.prototype),"normalSprite",e,this,!0)}},{key:"pressedSprite",get:function(){return Ge(Pe(n.prototype),"pressedSprite",this)},set:function(e){Ue(Pe(n.prototype),"pressedSprite",e,this,!0)}},{key:"hoverSprite",get:function(){return Ge(Pe(n.prototype),"hoverSprite",this)},set:function(e){Ue(Pe(n.prototype),"hoverSprite",e,this,!0)}},{key:"disabledSprite",get:function(){return Ge(Pe(n.prototype),"disabledSprite",this)},set:function(e){Ue(Pe(n.prototype),"disabledSprite",e,this,!0)}},{key:"duration",get:function(){return Ge(Pe(n.prototype),"duration",this)},set:function(e){Ue(Pe(n.prototype),"duration",e,this,!0)}},{key:"zoomScale",get:function(){return Ge(Pe(n.prototype),"zoomScale",this)},set:function(e){Ue(Pe(n.prototype),"zoomScale",e,this,!0)}},{key:"__preload",value:function(){Ge(Pe(n.prototype),"__preload",this).call(this),kt.lazyValidateProperties(this)}},{key:"onDestroy",value:function(){var e;null===(e=Ge(Pe(n.prototype),"onDestroy",this))||void 0===e||e.call(this)}},{key:"onEnable",value:function(){var e;null===(e=Ge(Pe(n.prototype),"onEnable",this))||void 0===e||e.call(this),this.node.off(V.EventType.TOUCH_END,this._onTouchEnded,this),this.node.on(a.EventType.TOUCH_START,this.onTouchStart),this.node.on(a.EventType.TOUCH_END,this.onTouchEnd),this.node.on(a.EventType.TOUCH_CANCEL,this.onTouchCancel),this.node.on(a.EventType.MOUSE_ENTER,this.onMouseEnter),this.node.on(a.EventType.MOUSE_LEAVE,this.onMouseLeave)}},{key:"onDisable",value:function(){var e;null===(e=Ge(Pe(n.prototype),"onDisable",this))||void 0===e||e.call(this),this.node.off(a.EventType.TOUCH_START,this.onTouchStart),this.node.off(a.EventType.TOUCH_END,this.onTouchEnd),this.node.off(a.EventType.TOUCH_CANCEL,this.onTouchCancel),this.node.off(a.EventType.MOUSE_ENTER,this.onMouseEnter),this.node.off(a.EventType.MOUSE_LEAVE,this.onMouseLeave),this.unschedule(this.handleResetButtonState),this.handleResetButtonState()}},{key:"handleDown",value:function(e){this.hasDown=!0,this.setAnimationState("DOWN"),this.makeSound&&bi.playSound(pi[this.soundKey]),this.emitClickStartEvents(e)}},{key:"emitClickStartEvents",value:function(e){this.clickStartEvents.forEach((function(t){t.emit([e,t.customEventData])}))}},{key:"emitClickEndEvents",value:function(e){this.clickEndEvents.forEach((function(t){t.emit([e,t.customEventData])}))}},{key:"handleUp",value:function(e){this.hasUp=!0,this.hasFinishClickCycle=!0,this.setAnimationState("RESET"),this.disableSpamClick?this.scheduleOnce(this.handleResetButtonState,this.disableSpamDelay):this.handleResetButtonState(),this.emitButtonEvents(e),this.emitClickEndEvents(e)}},{key:"emitButtonEvents",value:function(e){this.interactable&&(this.emitAnalyticsEvents&&la.event(GameCore.Plugins.Analytics.Events.BUTTON_CLICK,{button_name:this.node.name,screen_name:gi.getCurrentPage()}),this.clickEvents.forEach((function(t){t.emit([e,t.customEventData])})))}},{key:"setAnimationState",value:function(e){this.animationController.setValue("DOWN","DOWN"===e),this.animationController.setValue("HOVER","HOVER"===e),this.animationController.setValue("RESET","RESET"===e)}},{key:"fakeClick",value:function(){var e=this;this.setAnimationState("DOWN"),this.scheduleOnce((function(){e.setAnimationState("RESET")}),0)}},{key:"resetButtonState",value:function(){this.handleResetButtonState()}}]),n}(p)).prototype,"clickStartEvents",[Si],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Wi=Xe(Vi.prototype,"clickEndEvents",[Ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Ki=Xe(Vi.prototype,"animationController",[Ci],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Xe(Vi.prototype,"transition",[Ti],Object.getOwnPropertyDescriptor(Vi.prototype,"transition"),Vi.prototype),Xe(Vi.prototype,"normalColor",[Ai],Object.getOwnPropertyDescriptor(Vi.prototype,"normalColor"),Vi.prototype),Xe(Vi.prototype,"pressedColor",[xi],Object.getOwnPropertyDescriptor(Vi.prototype,"pressedColor"),Vi.prototype),Xe(Vi.prototype,"hoverColor",[Ri],Object.getOwnPropertyDescriptor(Vi.prototype,"hoverColor"),Vi.prototype),Xe(Vi.prototype,"disabledColor",[Ii],Object.getOwnPropertyDescriptor(Vi.prototype,"disabledColor"),Vi.prototype),Xe(Vi.prototype,"normalSprite",[Pi],Object.getOwnPropertyDescriptor(Vi.prototype,"normalSprite"),Vi.prototype),Xe(Vi.prototype,"pressedSprite",[_i],Object.getOwnPropertyDescriptor(Vi.prototype,"pressedSprite"),Vi.prototype),Xe(Vi.prototype,"hoverSprite",[Li],Object.getOwnPropertyDescriptor(Vi.prototype,"hoverSprite"),Vi.prototype),Xe(Vi.prototype,"disabledSprite",[Oi],Object.getOwnPropertyDescriptor(Vi.prototype,"disabledSprite"),Vi.prototype),Xe(Vi.prototype,"duration",[Di],Object.getOwnPropertyDescriptor(Vi.prototype,"duration"),Vi.prototype),Xe(Vi.prototype,"zoomScale",[Mi],Object.getOwnPropertyDescriptor(Vi.prototype,"zoomScale"),Vi.prototype),ji=Xe(Vi.prototype,"useDesktopHover",[Ni],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),Yi=Xe(Vi.prototype,"emitAnalyticsEvents",[Fi],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),Xi=Xe(Vi.prototype,"makeSound",[Bi],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),$i=Xe(Vi.prototype,"soundKey",[Gi],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return hi[ui.BUTTON_CLICK]}}),Qi=Xe(Vi.prototype,"disableSpamClick",[zi],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),Ji=Xe(Vi.prototype,"disableSpamDelay",[Ui],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.5}}),Hi=Vi))||Hi)||Hi)||Hi);n._RF.pop(),n._RF.push({},"0e570DdAIZPKY6DNtNerFmX","OpacityToggler",void 0);var ca=i.ccclass,ha=i.requireComponent,pa=i.property,da=ca("OpacityToggler")(ea=ha([N])((na=Xe((ta=function(e){Ie(i,e);var t,n=Fe(i);function i(){var e;Te(this,i);for(var t=arguments.length,a=new Array(t),r=0;r<t;r++)a[r]=arguments[r];return Ye(e=n.call.apply(n,[this].concat(a)),"activeValue",na,Me(e)),Ye(e,"inActiveValue",ia,Me(e)),e.signal=new On,e}return xe(i,[{key:"__preload",value:function(){this.opacityComponent=this.getComponent(N),this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){kt.lazyValidateProperties(this)}},{key:"changeState",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.signal.abort(),this.opacityComponent.opacity=e?this.activeValue:this.inActiveValue}},{key:"changeStateFade",value:(t=Ce(Se().mark((function e(){var t,n,i,a=arguments;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=a.length>0&&void 0!==a[0]&&a[0],n=a.length>1&&void 0!==a[1]?a[1]:.2,this.signal.abort(),this.signal=new On,i=t?this.activeValue:this.inActiveValue,e.next=7,vn.runTweenAsync(S(this.opacityComponent).to(n,{opacity:i}),this.signal);case 7:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),i}(f)).prototype,"activeValue",[pa],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 255}}),ia=Xe(ta.prototype,"inActiveValue",[pa],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 128}}),ea=ta))||ea)||ea;n._RF.pop(),n._RF.push({},"244e9OHsmpDnpHQKeLzgiiX","GameEvents",void 0);var fa="view-resize",va="view-resized",ya="request-view-resize",ma="layout-changed",ga="gameplay-update-config",ba="opened-skip-overlay",wa="closed-skip-overlay",ka="result-scene-replay",Sa="result-scene-home",Ea="upgrade-quality",Ca="upgrade-dynamic-atlas";n._RF.pop(),n._RF.push({},"5c76fxO2ppOqYp4WNO+Kavm","GameWorld",void 0);var Ta,Aa,xa,Ra={Portrait:"portrait",Landscape:"landscape"},Ia={Portrait:{WIDTH:750,HEIGHT:1583},Landscape:{WIDTH:1920,HEIGHT:1583}};n._RF.pop(),n._RF.push({},"7ef37Q3PZpKYaeik5JzGwNy","DebugResolution",void 0);var Pa,_a,La,Oa,Da,Ma,Na,Fa,Ba,Ga,za,Ua,Ha,Va,qa,Wa,Ka,ja,Ya,Xa,$a=i.ccclass,Qa=i.property,Ja=i.requireComponent,Za=i.disallowMultiple,er=i.executeInEditMode,tr=Ia,nr=tr.Portrait,ir=tr.Landscape;$a("DebugResolution")(Ta=Za(Ta=Ja([q])(Ta=er(!0)(((xa=function(e){Ie(n,e);var t=Fe(n);function n(){var e;Te(this,n);for(var i=arguments.length,a=new Array(i),r=0;r<i;r++)a[r]=arguments[r];return(e=t.call.apply(t,[this].concat(a))).handleLayoutChange=function(){var t;null===(t=e.graphics)||void 0===t||t.clear(),e.start()},e}return xe(n,[{key:"drawPortrait",get:function(){return n._drawPortrait},set:function(e){e!==n._drawPortrait&&(e?this.drawPortraitResolution():this.graphics.clear(),n._drawPortrait=e,n._drawLandscape&&this.drawLandscapeResolution())}},{key:"drawLandscape",get:function(){return n._drawLandscape},set:function(e){e!==n._drawLandscape&&(e?this.drawLandscapeResolution():this.graphics.clear(),n._drawLandscape=e,n._drawPortrait&&this.drawPortraitResolution())}},{key:"__preload",value:function(){this.graphics=this.getComponent(q),this.validateRequiredComponents(),this.listenGameEvents()}},{key:"validateRequiredComponents",value:function(){kt.lazyValidateProperties(this)}},{key:"listenGameEvents",value:function(){W.on(ma,this.handleLayoutChange)}},{key:"start",value:function(){this.drawPortrait&&this.drawPortraitResolution(),this.drawLandscape&&this.drawLandscapeResolution()}},{key:"drawPortraitResolution",value:function(){var e=this.graphics,t=nr.WIDTH,n=nr.HEIGHT,i=-t/2,a=-n/2;e.strokeColor=r.GREEN,e.rect(i,a,t,n),e.stroke()}},{key:"drawLandscapeResolution",value:function(){var e=this.graphics,t=ir.WIDTH,n=ir.HEIGHT,i=-t/2,a=-n/2;e.strokeColor=r.CYAN,e.rect(i,a,t,n),e.stroke()}}]),n}(f))._drawPortrait=!0,xa._drawLandscape=!0,Xe((Aa=xa).prototype,"drawPortrait",[Qa],Object.getOwnPropertyDescriptor(Aa.prototype,"drawPortrait"),Aa.prototype),Xe(Aa.prototype,"drawLandscape",[Qa],Object.getOwnPropertyDescriptor(Aa.prototype,"drawLandscape"),Aa.prototype),Ta=Aa))||Ta)||Ta)||Ta);n._RF.pop(),n._RF.push({},"0e2d6yn/BVObK1kyTJ5a09a","GameStats",void 0);var ar=i.ccclass,rr=i.executionOrder,or=i.property,sr=GameCore.Utils,lr=r.RED,ur=r.BLACK,cr=r.MAGENTA;Pa=ar("GameStats"),_a=rr(-1e3),La=or(u),Oa=or(u),Da=or(u),Ma=or(u),Na=or(u),Fa=or(u),Ba=or(u),Ga=or(u),Pa(za=_a((Ha=Xe((Ua=function(e){Ie(n,e);var t=Fe(n);function n(){var e;Te(this,n);for(var i=arguments.length,a=new Array(i),r=0;r<i;r++)a[r]=arguments[r];return Ye(e=t.call.apply(t,[this].concat(a)),"fpsLabel",Ha,Me(e)),Ye(e,"drawCountLabel",Va,Me(e)),Ye(e,"logicTimeLabel",qa,Me(e)),Ye(e,"physicTimeLabel",Wa,Me(e)),Ye(e,"renderTimeLabel",Ka,Me(e)),Ye(e,"objectMemoryUsageLabel",ja,Me(e)),Ye(e,"textureMemoryUsageLabel",Ya,Me(e)),Ye(e,"devicePixelRatioLabel",Xa,Me(e)),e.refreshInterval=.5,e.handleMouseDown=function(){e.bg.enabled=!e.bg.enabled},e.waitForStats=function(){K.stats&&(e.unschedule(e.waitForStats),e.node.active=!0,e.stats=K.stats,e.startUpdateStats())},e.updateStats=function(){e.updateFps(),e.updateDrawCalls(),e.updateLogicTime(),e.updatePhysicTime(),e.updateRenderTime(),e.updateObjectMemoryUsage(),e.updateTextureMemoryUsage(),e.updateDevicePixelRatio()},e}return xe(n,[{key:"__preload",value:function(){this.bg=this.getComponent(A),this.validateRequiredComponents(),this.listenInputEvents()}},{key:"validateRequiredComponents",value:function(){kt.lazyValidateProperties(this)}},{key:"listenInputEvents",value:function(){this.node.on(V.EventType.TOUCH_START,this.handleMouseDown)}},{key:"start",value:function(){this.bg.enabled=!1,this.node.active=!1,K&&sr.Valid.isDebugger()&&(K.showStats(),this.schedule(this.waitForStats,.5,20))}},{key:"startUpdateStats",value:function(){this.schedule(this.updateStats,this.refreshInterval)}},{key:"updateFps",value:function(){var e=this.getFps();this.updateFpsColor(e),this.fpsLabel.string=`FPS: ${e}`}},{key:"updateFpsColor",value:function(e){this.fpsLabel.color=e<30?lr:e<48?cr:ur}},{key:"updateDrawCalls",value:function(){var e=this.getDrawCalls();this.updateDrawCallsColor(e),this.drawCountLabel.string=`Draw Calls: ${e}`}},{key:"updateDrawCallsColor",value:function(e){var t=j.os===j.OS.IOS,n=t?80:25,i=t?60:15;this.drawCountLabel.color=e>n?lr:e>i?cr:ur}},{key:"updateLogicTime",value:function(){var e=this.getLogicTime();this.updateLogicTimeColor(e),this.logicTimeLabel.string=`Logic Time: ${e.toFixed(2)}ms`}},{key:"updateLogicTimeColor",value:function(e){this.logicTimeLabel.color=e>10?lr:e>5?cr:ur}},{key:"updatePhysicTime",value:function(){var e=this.getPhysicTime();this.updatePhysicTimeColor(e),this.physicTimeLabel.string=`Physic Time: ${e.toFixed(2)}ms`}},{key:"updatePhysicTimeColor",value:function(e){this.physicTimeLabel.color=e>10?lr:e>5?cr:ur}},{key:"updateRenderTime",value:function(){var e=this.getRenderTime();this.updateRenderTimeColor(e),this.renderTimeLabel.string=`Render Time: ${e.toFixed(2)}ms`}},{key:"updateRenderTimeColor",value:function(e){this.renderTimeLabel.color=e>10?lr:e>5?cr:ur}},{key:"updateObjectMemoryUsage",value:function(){var e=this.getObjectMemoryUsage();this.updateObjectMemoryUsageColor(e),this.objectMemoryUsageLabel.string=`Object Mem: ${e.toFixed(2)}MB`}},{key:"updateObjectMemoryUsageColor",value:function(e){this.objectMemoryUsageLabel.color=e>40?lr:e>25?cr:ur}},{key:"updateTextureMemoryUsage",value:function(){var e=this.getTextureMemoryUsage();this.updateTextureMemoryUsageColor(e),this.textureMemoryUsageLabel.string=`Texture Mem: ${e.toFixed(2)}MB`}},{key:"updateTextureMemoryUsageColor",value:function(e){this.textureMemoryUsageLabel.color=e>50?lr:e>35?cr:ur}},{key:"updateDevicePixelRatio",value:function(){var e=this.getDevicePixelRatio();this.updateDevicePixelRatioColor(e),this.devicePixelRatioLabel.string=`Device Pixel Ratio: ${e}`}},{key:"updateDevicePixelRatioColor",value:function(e){this.devicePixelRatioLabel.color=e>2?lr:e<=1?cr:ur}},{key:"getFps",value:function(){var e=this.stats.fps.counter;return Math.floor(e.value)||0}},{key:"getDrawCalls",value:function(){return this.stats.draws.counter.value||0}},{key:"getLogicTime",value:function(){var e=this.stats.logic.counter;return Math.floor(1e3*e.value)/1e3||0}},{key:"getPhysicTime",value:function(){var e=this.stats.physics.counter;return Math.floor(1e3*e.value)/1e3||0}},{key:"getRenderTime",value:function(){var e=this.stats.render.counter;return Math.floor(1e3*e.value)/1e3||0}},{key:"getObjectMemoryUsage",value:function(){var e=this.stats.bufferMemory.counter;return Math.floor(1e3*e.value)/1e3||0}},{key:"getTextureMemoryUsage",value:function(){var e=this.stats.textureMemory.counter;return Math.floor(1e3*e.value)/1e3||0}},{key:"getDevicePixelRatio",value:function(){return window.devicePixelRatio||0}}]),n}(f)).prototype,"fpsLabel",[La],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Va=Xe(Ua.prototype,"drawCountLabel",[Oa],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),qa=Xe(Ua.prototype,"logicTimeLabel",[Da],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Wa=Xe(Ua.prototype,"physicTimeLabel",[Ma],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ka=Xe(Ua.prototype,"renderTimeLabel",[Na],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ja=Xe(Ua.prototype,"objectMemoryUsageLabel",[Fa],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ya=Xe(Ua.prototype,"textureMemoryUsageLabel",[Ba],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Xa=Xe(Ua.prototype,"devicePixelRatioLabel",[Ga],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),za=Ua))||za);n._RF.pop(),n._RF.push({},"ca922n1V0RLioEyUJg8hQXH","GameEvents",void 0);var hr,pr=function(e){return e.INVITE_FRIENDS="invite-friends",e.REPLAY_FRIENDS="replay-friends",e.SHOW_CHALLENGE_RESULTS="show-challenge-results",e.NEXT_LEVEL="next-level",e.MAX_LEVEL="max-level",e.START_OVER="start-over",e.SELECT_LEVEL="select-level",e.GAME_START="game-start",e.GAME_PAUSE="game-pause",e.GAME_RESUME="game-resume",e.GAME_REPLAY="game-replay",e.GAME_FINISH="game-finish",e.GAME_EXIT="game-exit",e.USE_ITEM="use-item",e.SKIP_LEVEL="skip-level",e.ADD_ITEM="add-item",e.ADD_ITEMS="add-items",e.ADD_COINS="add-coins",e.REMOVE_COINS="remove-coins",e.REMOVE_COINS_SUCCESS="remove-coins-success",e.REMOVE_COINS_FAILED="remove-coins-failed",e.COIN_CHANGED="coin-changed",e.ADD_STARS="add-stars",e.PAUSE_TIME="pause-time",e.RESUME_TIME="resume-time",e.TIME_OUT="time-out",e.HALF_TIME="half-time",e.RESCUE_START="rescue-time",e.RESCUE_FINISHED="clock-animation-finished",e.APPLY_GRAVITY="apply-gravity",e.IDLE_ENTER="idle-enter",e.IDLE_EXIT="idle-exit",e.GRID_MATCH="grid-match",e.GRID_MATCH_SUCCESS="grid-match-success",e.GRID_MATCH_FAIL="grid-match-fail",e.GRID_CLEAR="grid-clear",e.GRID_CREATE="grid-create",e.GRID_RESIZE="grid-resize",e.TILE_CLICK="tile-click",e.BOMB_EXPLODE="bomb-explode",e.SHOW_HINT="show-hint",e.ADD_COMBO="add-combo",e.COMBO_UPDATED="combo-updated",e.COMBO_ENDED="combo-ended",e.ADD_SCORE="add-score",e.SCORE_UPDATED="score-updated",e.REGISTER_ANIMATOR="register-animator",e.UNREGISTER_ANIMATOR="unregister-animator",e.SHOW_UI="show-ui",e.HIDE_UI="hide-ui",e.AUTO_PLAY="auto-play",e.GUIDE_MASK_CLICKED="guide-mask-clicked",e}(pr||{});n._RF.pop(),n._RF.push({},"8249dDH5xBEc4nnCGRgSjaW","PanelAnimationController",void 0);var dr,fr,vr,yr,mr,gr,br,wr,kr,Sr,Er,Cr,Tr,Ar,xr,Rr,Ir,Pr,_r=(0,i.ccclass)("PanelAnimationController")(hr=function(e){Ie(n,e);var t=Fe(n);function n(){var e;Te(this,n);for(var i=arguments.length,a=new Array(i),r=0;r<i;r++)a[r]=arguments[r];return(e=t.call.apply(t,[this].concat(a))).animators=new Set,e.handleRegistration=function(t){if(!t)throw new Error("Invalid event payload.");e.animators.has(t)&&console.warn("Animator already registered."),e.animators.add(t)},e.handleUnregistration=function(t){if(!t)throw new Error("Invalid event payload.");e.animators.has(t)||console.warn("Animator not registered."),e.animators.delete(t)},e.handleShowUIs=function(t){var n,i=!1,a=[],r=Ke(e.animators.values());try{for(r.s();!(n=r.n()).done;){var o,s=n.value;if(!s.isReadyForAnimation()&&!i)i=!0,null==t||null===(o=t.fallback)||void 0===o||o.call(t);a.push(s.handleShowUI())}}catch(e){r.e(e)}finally{r.f()}void 0!==(null==t?void 0:t.onComplete)&&a.length>0&&Promise.all(a).then(t.onComplete)},e.handleHideUIs=function(t){var n,i=!1,a=[],r=Ke(e.animators.values());try{for(r.s();!(n=r.n()).done;){var o,s=n.value;if(!s.isReadyForAnimation()&&!i)i=!0,null==t||null===(o=t.fallback)||void 0===o||o.call(t);a.push(s.handleHideUI())}}catch(e){r.e(e)}finally{r.f()}void 0!==(null==t?void 0:t.onComplete)&&a.length>0&&Promise.all(a).then(t.onComplete)},e}return xe(n,[{key:"init",value:function(){this.node.scene.off(pr.REGISTER_ANIMATOR),this.node.scene.off(pr.UNREGISTER_ANIMATOR),this.node.scene.off(pr.SHOW_UI),this.node.scene.off(pr.HIDE_UI),this.node.scene.on(pr.REGISTER_ANIMATOR,this.handleRegistration),this.node.scene.on(pr.UNREGISTER_ANIMATOR,this.handleUnregistration),this.node.scene.on(pr.SHOW_UI,this.handleShowUIs),this.node.scene.on(pr.HIDE_UI,this.handleHideUIs)}}]),n}(f))||hr;n._RF.pop(),n._RF.push({},"f190aWZvVlGiplYX4XrZG3a","PanelAnimator",void 0);var Lr,Or,Dr,Mr,Nr=i.ccclass,Fr=i.property,Br=(dr=Nr("AnimationConfig"),fr=Fr({type:[C]}),dr((mr=Xe((yr=function(){function e(){Te(this,e),Ye(this,"startHidden",mr,this),Ye(this,"nodes",gr,this),Ye(this,"posOffset",br,this),Ye(this,"showEase",wr,this),Ye(this,"hideEase",kr,this),Ye(this,"showDuration",Sr,this),Ye(this,"hideDuration",Er,this)}return xe(e,[{key:"setConfig",value:function(e){e&&Object.assign(this,e)}}]),e}()).prototype,"startHidden",[Fr],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),gr=Xe(yr.prototype,"nodes",[fr],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),br=Xe(yr.prototype,"posOffset",[Fr],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),wr=Xe(yr.prototype,"showEase",[Fr],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"backOut"}}),kr=Xe(yr.prototype,"hideEase",[Fr],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"backIn"}}),Sr=Xe(yr.prototype,"showDuration",[Fr],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Er=Xe(yr.prototype,"hideDuration",[Fr],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),vr=yr))||vr),Gr=(Cr=Nr("PanelAnimator"),Tr=Fr({type:Br,displayName:"Top animation nodes"}),Ar=Fr({type:Br,displayName:"Bottom animation nodes"}),Cr((Ir=Xe((Rr=function(e){Ie(a,e);var t,n,i=Fe(a);function a(){var e;Te(this,a);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return Ye(e=i.call.apply(i,[this].concat(n)),"topConfig",Ir,Me(e)),Ye(e,"botConfig",Pr,Me(e)),e.isReady=!1,e}return xe(a,[{key:"onEnable",value:function(){this.node.scene.emit(pr.REGISTER_ANIMATOR,this)}},{key:"onDisable",value:function(){this.node.scene.emit(pr.UNREGISTER_ANIMATOR,this)}},{key:"onLoad",value:function(){this.topAnimator=this.createAnimator(this.topConfig,"top"),this.botAnimator=this.createAnimator(this.botConfig,"bottom"),this.initUIPos(),this.isReady=!0}},{key:"initUIPos",value:function(){this.topAnimator.switchState(this.topConfig.startHidden?"hidden":"shown",!0),this.botAnimator.switchState(this.botConfig.startHidden?"hidden":"shown",!0)}},{key:"isReadyForAnimation",value:function(){return this.isReady}},{key:"handleShowUI",value:(n=Ce(Se().mark((function e(){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.isReady){e.next=3;break}return console.warn(`${this.node.name}'s ${this.name}: not ready`),e.abrupt("return");case 3:return e.abrupt("return",Promise.all([this.topAnimator.switchState("shown"),this.botAnimator.switchState("shown")]));case 4:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"handleHideUI",value:(t=Ce(Se().mark((function e(){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.isReady){e.next=3;break}return console.warn(`${this.node.name}'s ${this.name}: not ready`),e.abrupt("return");case 3:return e.abrupt("return",Promise.all([this.topAnimator.switchState("hidden"),this.botAnimator.switchState("hidden")]));case 4:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"createAnimator",value:function(e,t){var n=e.nodes,i=e.posOffset,r=e.showEase,o=e.hideEase,s=e.showDuration,l=e.hideDuration,u=n.map((function(e){return"top"===t&&e.isAlignTop?{mode:"top",value:e.top}:"bottom"===t&&e.isAlignBottom?{mode:"bottom",value:e.bottom}:{mode:"position",value:e.node.position.y}})),c=n.map((function(e){return"top"===t&&e.isAlignTop?{mode:"top",value:e.top+i}:"bottom"===t&&e.isAlignBottom?{mode:"bottom",value:e.bottom-i}:{mode:"position",value:e.node.position.y+i}})),h="shown";return{switchState:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(h===e)return Promise.resolve(null);h=e;var i="hidden"===e?u:c,p="hidden"===e?c:u,d="hidden"===e?l:s,f="hidden"===e?o:r;return t?(n.forEach((function(e,t){var n=i[t],a=p[t].value;"top"===n.mode&&(e.top=a),"bottom"===n.mode&&(e.bottom=a),"position"===n.mode&&(e.node.position=new Y(e.node.position.x,a,e.node.position.z))})),Promise.resolve(null)):Promise.all(n.map((function(e,t){var n=i[t],r=p[t].value;return vn.runTweenAsync(a.getTween({widget:e,config:n,target:r,easing:f,duration:d}))})))}}}},{key:"setAnimator",value:function(e){var t=e.topConfig,n=e.botConfig,i=new Br,a=new Br;i.setConfig(t),a.setConfig(n),this.topConfig=i,this.botConfig=a,this.topAnimator=this.createAnimator(this.topConfig,"top"),this.botAnimator=this.createAnimator(this.botConfig,"bottom"),this.initUIPos()}}],[{key:"getTween",value:function(e){var t=e.widget,n=e.config,i=e.target,a=e.easing,r=e.duration;return"top"===n.mode?S(t).call((function(){t.top=n.value})).to(r,{top:i},{easing:a}):"bottom"===n.mode?S(t).call((function(){t.bottom=n.value})).to(r,{bottom:i},{easing:a}):S(t.node.position).call((function(){t.node.position=new Y(t.node.position.x,n.value,t.node.position.z)})).to(r,{y:i},{easing:a})}}]),a}(f)).prototype,"topConfig",[Tr],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Br}}),Pr=Xe(Rr.prototype,"botConfig",[Ar],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Br}}),xr=Rr))||xr);n._RF.pop(),n._RF.push({},"6ea01hdw/9MHb28SCDAiRss","ResizeWithBannerAd",void 0);var zr,Ur,Hr,Vr,qr,Wr,Kr,jr,Yr,Xr,$r,Qr=i.ccclass,Jr=i.requireComponent,Zr=i.property,eo=globalThis.game,to=eo.ads,no=eo.event;Qr("ResizeWithBannerAd")(Lr=Jr(C)((Dr=Xe((Or=function(e){Ie(n,e);var t=Fe(n);function n(){var e;Te(this,n);for(var i=arguments.length,a=new Array(i),r=0;r<i;r++)a[r]=arguments[r];return Ye(e=t.call.apply(t,[this].concat(a)),"willShowBanner",Dr,Me(e)),Ye(e,"includeSAB",Mr,Me(e)),e.handleAdShow=function(t){var n,i=t.placementId;null!==i&&((null===(n=to.getAdByPlacementId(i))||void 0===n?void 0:n.type)===GameCore.Plugins.Ads.Types.BANNER&&e.resizeToFitBannerAd())},e.handleAdClose=function(t){var n,i=t.placementId;null!==i&&((null===(n=to.getAdByPlacementId(i))||void 0===n?void 0:n.type)===GameCore.Plugins.Ads.Types.BANNER&&e.updateWidgets(to.getSafeAreaBottom(Zi.cssSizeToWorldSize(1))))},e}return xe(n,[{key:"__preload",value:function(){this.widget=this.getComponent(C),kt.lazyValidateProperties(this),no.on(GameCore.Events.AD_SHOWING,this.handleAdShow),no.on(GameCore.Events.AD_CLOSED,this.handleAdClose)}},{key:"onDestroy",value:function(){no.off(GameCore.Events.AD_SHOWING,this.handleAdShow),no.off(GameCore.Events.AD_CLOSED,this.handleAdClose)}},{key:"start",value:function(){var e=to.getSafeAreaBottom(Zi.cssSizeToWorldSize(1));this.willShowBanner||n.isBannerAdShowing()?this.resizeToFitBannerAd():e>0&&this.includeSAB&&this.updateWidgets(e)}},{key:"resizeToFitBannerAd",value:function(){var e=this,t=GameCore.Configs.Ads,n=t.Enabled,i=t.BannerDisplayAdOptions;if(n)if(this.widget.isAlignBottom){var a=null,r=null,o=null,s=null,l=Zi.cssSizeToWorldSize(1);i.forEach((function(t){var n=t.PlacementId,i=t.Position,u=t.BannerWidth;if(to.canbeShowBannerAd(n))switch(i){case"top":a=to.getBannerHeight(n,l);break;case"bottom":r=to.getBannerHeight(n,l,e.includeSAB);break;case"left":if(void 0===u)break;var c=u;"getBannerOffset"in GameSDK.extra&&(c+=GameSDK.extra.getBannerOffset()),o=c*l;break;case"right":if(void 0===u)break;var h=u;"getBannerOffset"in GameSDK.extra&&(h+=GameSDK.extra.getBannerOffset()),s=h*l}})),this.updateWidgets(a,r,o,s)}else console.warn("Widget does not align to bottom, ResizeWithBannerAds will have no effect!")}},{key:"updateWidgets",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;this.widget.top=null!=e?e:this.widget.top,this.widget.bottom=null!=t?t:this.widget.bottom,this.widget.left=null!=n?n:this.widget.left,this.widget.right=null!=i?i:this.widget.right,this.widget.updateAlignment();var a=this.getComponentsInChildren(C);a.forEach((function(e){e.updateAlignment()}))}}],[{key:"isBannerAdShowing",value:function(){return to.enabled&&to.getAdStatus(GameCore.Plugins.Ads.Types.BANNER)===GameCore.Plugins.Ads.Status.SHOWING}}]),n}(f)).prototype,"willShowBanner",[Zr],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Mr=Xe(Or.prototype,"includeSAB",[Zr],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),Lr=Or))||Lr);n._RF.pop(),n._RF.push({},"3d28fQaHU5Lm4/Zyq/Jd2b6","TapperedProgressBar",void 0);var io,ao,ro,oo,so,lo,uo,co,ho,po,fo=i.ccclass,vo=i.property,yo=i.executeInEditMode,mo=i.requireComponent,go=(zr=fo("TapperedProgressBar"),Ur=mo(N),Hr=vo({type:N,displayName:"Fill opacity"}),Vr=vo({type:A,displayName:"Left Cap",tooltip:"If assigned, will be displayed when progress is larger than 0%"}),qr=vo({type:A,displayName:"Right Cap",tooltip:"If assigned, will be displayed when progress is at 100%"}),Wr=vo({range:[0,1,.01],slide:!0,tooltip:"i18n:progress.progress",override:!0}),zr(Kr=yo(Kr=Ur((Yr=Xe((jr=function(e){Ie(n,e);var t=Fe(n);function n(){var e;Te(this,n);for(var i=arguments.length,a=new Array(i),r=0;r<i;r++)a[r]=arguments[r];return Ye(e=t.call.apply(t,[this].concat(a)),"uiOpacity",Yr,Me(e)),Ye(e,"leftCap",Xr,Me(e)),Ye(e,"rightCap",$r,Me(e)),e}return xe(n,[{key:"progress",get:function(){return Ge(Pe(n.prototype),"progress",this)},set:function(e){Ue(Pe(n.prototype),"progress",e,this,!0),this.updateAppearance()}},{key:"updateAppearance",value:function(){if(null!==this.uiOpacity)if(this.progress<=0)this.uiOpacity.opacity=0;else if(this.progress>.1)this.uiOpacity.opacity=255;else{var e=Math.floor(this.progress/.05*255);this.uiOpacity.opacity=e}}},{key:"start",value:function(){this.updateAppearance()}}]),n}(X)).prototype,"uiOpacity",[Hr],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Xr=Xe(jr.prototype,"leftCap",[Vr],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),$r=Xe(jr.prototype,"rightCap",[qr],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Xe(jr.prototype,"progress",[Wr],Object.getOwnPropertyDescriptor(jr.prototype,"progress"),jr.prototype),Kr=jr))||Kr)||Kr)||Kr);n._RF.pop(),n._RF.push({},"bce15LcVrxOfYMa9rbXN/qi","Localize",void 0);var bo,wo,ko,So,Eo,Co,To,Ao,xo,Ro=i.ccclass,Io=i.property,Po=i.requireComponent,_o=i.executeInEditMode,Lo=i.disallowMultiple,Oo=globalThis.game.language;io=Ro("Localize"),ao=Po(u),ro=_o(!0),oo=Io({visible:!0}),so=Io({group:{name:"Fonts",id:"fonts",displayOrder:1},type:$}),lo=Io({group:{name:"Fonts",id:"fonts",displayOrder:2},type:$}),io(uo=Lo(uo=ao(uo=ro((Xe((co=function(e){Ie(n,e);var t=Fe(n);function n(){var e;Te(this,n);for(var i=arguments.length,a=new Array(i),r=0;r<i;r++)a[r]=arguments[r];return Ye(e=t.call.apply(t,[this].concat(a)),"enFont",ho,Me(e)),Ye(e,"ruFont",po,Me(e)),e.handleLanguageChanged=function(){e.updateTransToNode()},e}return xe(n,[{key:"key",get:function(){return this._key},set:function(e){e&&(this._key=e,this.updateTransToNode())}},{key:"__preload",value:function(){this.label=this.getComponent(u),this.validateRequiredComponents(),this.updateTransToNode()}},{key:"validateRequiredComponents",value:function(){kt.lazyValidateProperties(this)}},{key:"start",value:function(){this.listenEvent()}},{key:"listenEvent",value:function(){W.on("update-language",this.handleLanguageChanged)}},{key:"updateTransToNode",value:function(){if(this.node.active&&this._key)try{var e=Oo.getText(this._key),t=this.getFontByLang();this.label.font=t,this.label.string=e,this.node.emit("update-trans",e)}catch(e){console.warn(e)}}},{key:"getFontByLang",value:function(){if(!this.enFont||!this.ruFont)throw new Error("Font is not found");switch(Oo.getCurrentLocale()){case"en":return this.enFont;case"ru":return this.ruFont;default:return this.enFont}}}]),n}(f)).prototype,"key",[oo],Object.getOwnPropertyDescriptor(co.prototype,"key"),co.prototype),ho=Xe(co.prototype,"enFont",[so],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),po=Xe(co.prototype,"ruFont",[lo],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),uo=co))||uo)||uo)||uo);n._RF.pop(),n._RF.push({},"aef305TaZhKVo1f4/qH1kf+","SecondOrderDynamics",void 0);var Do,Mo,No,Fo,Bo,Go,zo,Uo,Ho,Vo=i.ccclass,qo=i.property,Wo=function(){function e(t,n){var i;Te(this,e),n=null!==(i=n)&&void 0!==i?i:{response:1,dampen:1,eager:1},this.k1=e.calcK1(n),this.k2=e.calcK2(n),this.k3=e.calcK3(n),this.xp=t.clone(),this.y=t.clone(),this.yd=new Q(0,0)}return xe(e,[{key:"update",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;null===n&&(n=new Q((t.x-this.xp.x)/e,(t.y-this.xp.y)/e),this.xp.x=t.x,this.xp.y=t.y);var i=Math.max(this.k2,e*e/2+e*this.k1/2,e*this.k1);return this.y.x=this.y.x+e*this.yd.x,this.y.y=this.y.y+e*this.yd.y,this.yd.x=this.yd.x+e*(t.x+this.k3*n.x-this.y.x-this.k1*this.yd.x)/i,this.yd.y=this.yd.y+e*(t.y+this.k3*n.y-this.y.y-this.k1*this.yd.y)/i,this.y}},{key:"setDynamics",value:function(t){this.k1=e.calcK1(t),this.k2=e.calcK2(t),this.k3=e.calcK3(t)}},{key:"reset",value:function(e){this.xp.set(e.x,e.y),this.y.set(e.x,e.y),this.yd.set(0,0)}},{key:"currentState",get:function(){return this.y}}],[{key:"calcK1",value:function(e){return e.dampen/(Math.PI*e.response)}},{key:"calcK2",value:function(e){return 1/(2*Math.PI*e.response*(2*Math.PI*e.response))}},{key:"calcK3",value:function(e){return e.eager*e.dampen/(2*Math.PI*e.response)}}]),e}(),Ko=(bo=Vo("SODConfig"),wo=qo({type:E,displayName:"Responsiveness",tooltip:"Higher values will result shorter response times."}),ko=qo({type:E,displayName:"Dampening",tooltip:"Higher values will result in less overshoot and oscillation."}),So=qo({type:E,displayName:"Eagerness",tooltip:"Higher values will result in more overshoot and oscillation, negative values will result in anticipation."}),bo((To=Xe((Co=xe((function e(){Te(this,e),Ye(this,"response",To,this),Ye(this,"dampen",Ao,this),Ye(this,"eager",xo,this)}))).prototype,"response",[wo],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 200}}),Ao=Xe(Co.prototype,"dampen",[ko],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 20}}),xo=Xe(Co.prototype,"eager",[So],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Eo=Co))||Eo);n._RF.pop(),n._RF.push({},"e9e74FEHyRLvar32WZD/F11","Trail",void 0);var jo,Yo,Xo,$o,Qo,Jo,Zo,es,ts,ns,is,as,rs,os,ss,ls,us,cs,hs,ps,ds,fs,vs,ys,ms,gs,bs=i.ccclass,ws=i.property,ks=(Do=bs("Trail"),Mo=ws({type:a,displayName:"Target"}),No=ws({type:q,displayName:"Graphics"}),Fo=ws({type:[Ko],displayName:"Trail Nodes"}),Do((zo=Xe((Go=function(e){Ie(n,e);var t=Fe(n);function n(){var e;Te(this,n);for(var i=arguments.length,a=new Array(i),r=0;r<i;r++)a[r]=arguments[r];return Ye(e=t.call.apply(t,[this].concat(a)),"target",zo,Me(e)),Ye(e,"graphics",Uo,Me(e)),Ye(e,"trailNodes",Ho,Me(e)),e.trailNodeInstances=[],e}return xe(n,[{key:"reset",value:function(){var e,t=Ke(this.trailNodeInstances);try{for(t.s();!(e=t.n()).done;){e.value.reset(new Q(this.node.worldPosition.x,this.node.worldPosition.y))}}catch(e){t.e(e)}finally{t.f()}this.graphics.clear()}},{key:"onLoad",value:function(){this.validateRequiredComponents(),this.spawnTrailNodes()}},{key:"update",value:function(e){this.graphics.clear();var t=this.trailNodeInstances[0];this.drawTrail(e,t,this.target.worldPosition.x,this.target.worldPosition.y);for(var n=1;n<this.trailNodeInstances.length;n++){var i=this.trailNodeInstances[n-1],a=this.trailNodeInstances[n];this.drawTrail(e,a,i.currentState.x,i.currentState.y)}}},{key:"drawTrail",value:function(e,t,n,i){var a=this.graphics,r=new Q(n,i),o=t.update(e,r),s=new Y(r.x,r.y,0),l=new Y(o.x,o.y,0);a.node.inverseTransformPoint(s,s),a.node.inverseTransformPoint(l,l),a.moveTo(s.x,s.y),a.lineTo(l.x,l.y),a.stroke()}},{key:"spawnTrailNodes",value:function(){var e,t=Ke(this.trailNodes);try{for(t.s();!(e=t.n()).done;){var n=e.value,i=new Q(this.node.worldPosition.x,this.node.worldPosition.y),a=new Wo(i,n);this.trailNodeInstances.push(a)}}catch(e){t.e(e)}finally{t.f()}}},{key:"validateRequiredComponents",value:function(){if(!this.target)throw new Error("Target is not set");if(!this.graphics)throw new Error("Graphics is not set");0===this.trailNodes.length&&console.warn("No trail nodes are set")}}]),n}(f)).prototype,"target",[Mo],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Uo=Xe(Go.prototype,"graphics",[No],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ho=Xe(Go.prototype,"trailNodes",[Fo],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Bo=Go))||Bo);n._RF.pop(),n._RF.push({},"a2260jBMJFPCrn/Q4Vo4iB1","BatchNodes",void 0);var Ss,Es=i.ccclass,Cs=i.executionOrder,Ts=i.property,As="Batch By Name",xs="Batch Label",Rs="Batch Sprite",Is=(jo=Es("BatchNodes"),Yo=Cs(99999),Xo=Ts({group:{name:As}}),$o=Ts({type:[g],group:{name:As}}),Qo=Ts({type:[m],group:{name:As}}),Jo=Ts({group:{name:xs}}),Zo=Ts({group:{name:xs}}),es=Ts({group:{name:xs}}),ts=Ts({group:{name:Rs}}),ns=Ts({group:{name:Rs}}),is=Ts({readonly:!0}),as=Ts({readonly:!0}),rs=Ts({readonly:!0}),jo(os=Yo((ls=Xe((ss=function(e){Ie(n,e);var t=Fe(n);function n(){var e;Te(this,n);for(var i=arguments.length,a=new Array(i),r=0;r<i;r++)a[r]=arguments[r];return Ye(e=t.call.apply(t,[this].concat(a)),"batchByName",ls,Me(e)),Ye(e,"depthNames",us,Me(e)),Ye(e,"listName",cs,Me(e)),Ye(e,"batchLabel",hs,Me(e)),Ye(e,"depthLabel",ps,Me(e)),Ye(e,"typeLabel",ds,Me(e)),Ye(e,"batchSprite",fs,Me(e)),Ye(e,"depthSprite",vs,Me(e)),Ye(e,"batchAllNodes",ys,Me(e)),Ye(e,"batchDepth",ms,Me(e)),Ye(e,"checkOverlap",gs,Me(e)),e.batchNode={},e.labelChildren=[],e.spriteChildren=[],e.allChildren=[],e.nameChildren=[],e.originalParents={},e.isInited=!1,e.onAfterUpdate=function(){e.isInited&&e.hierarchyChildren()},e.onAfterRender=function(){e.isInited&&e.restoreOriginalChildren()},e}return xe(n,[{key:"__preload",value:function(){this.enabled&&(d.on(J.EVENT_AFTER_UPDATE,this.onAfterUpdate),d.on(J.EVENT_AFTER_RENDER,this.onAfterRender))}},{key:"onDestroy",value:function(){d.off(J.EVENT_AFTER_UPDATE,this.onAfterUpdate),d.off(J.EVENT_AFTER_RENDER,this.onAfterRender)}},{key:"onLoad",value:function(){this.enabled&&(this.setupBatchNodes(this.node),this.isInited=!0)}},{key:"onEnable",value:function(){d.on(J.EVENT_AFTER_UPDATE,this.onAfterUpdate),d.on(J.EVENT_AFTER_RENDER,this.onAfterRender),this.setupBatchNodes(this.node),this.isInited=!0}},{key:"onDisable",value:function(){this.restoreOriginalChildren(),d.off(J.EVENT_AFTER_UPDATE,this.onAfterUpdate),d.off(J.EVENT_AFTER_RENDER,this.onAfterRender),this.isInited=!1}},{key:"setupBatchNodes",value:function(e){this.allChildren=[],this.nameChildren=[],this.labelChildren=[],this.spriteChildren=[],this.saveOriginalChildren(e),this.createGlobalNodes(e),this.createGlobalNameNodes(e),this.createGlobalLabelNode(e),this.createGlobalSpriteNode(e),this.sortGlobalNodes()}},{key:"sortGlobalNodes",value:function(){var e,t,n,i=this;null===(e=this.batchNode.node)||void 0===e||e.setSiblingIndex(0),null===(t=this.batchNode.label)||void 0===t||t.setSiblingIndex(this.depthLabel),null===(n=this.batchNode.sprite)||void 0===n||n.setSiblingIndex(this.depthSprite),this.listName.forEach((function(e,t){var n;null===(n=i.batchNode[e])||void 0===n||n.setSiblingIndex(i.depthNames[t])}))}},{key:"createGlobalNodes",value:function(e){if(this.batchAllNodes){var t=new a("GlobalBatchNode");t.active=!0,this.batchNode.node=t,e.addChild(t)}}},{key:"createGlobalNameNodes",value:function(e){var t=this;this.batchByName&&this.listName.forEach((function(n){if(!t.batchNode[n]){var i=new a(n);i.active=!0,t.batchNode[n]=i,e.addChild(i)}}))}},{key:"createGlobalLabelNode",value:function(e){if(this.batchLabel){var t=new a("GlobalLabelNode");t.active=!0,this.batchNode.label=t,e.addChild(t)}}},{key:"createGlobalSpriteNode",value:function(e){if(this.batchSprite){var t=new a("GlobalSpriteNode");t.active=!0,this.batchNode.sprite=t,e.addChild(t)}}},{key:"saveOriginalParents",value:function(){var e=this;[].concat(Ve(this.labelChildren),Ve(this.spriteChildren)).forEach((function(t){t.node.parent&&(e.originalParents[t.uuid]=t.node.parent)})),this.nameChildren.forEach((function(t){t.parent&&(e.originalParents[t.uuid]=t.parent)}))}},{key:"saveOriginalChildren",value:function(e){var t=this;e.children.forEach((function(e){t.saveLabelChildren(e),t.saveSpriteChildren(e),t.saveNodeChildrenByName(e),t.saveNodeChildrenByType(e)})),this.saveOriginalParents()}},{key:"saveLabelChildren",value:function(e){var t;if(this.batchLabel){var n=e.getComponentsInChildren(u);"char"===this.typeLabel&&n.filter((function(e){return e.cacheMode===u.CacheMode.CHAR})),0!==n.length&&(t=this.labelChildren).push.apply(t,Ve(n))}}},{key:"saveSpriteChildren",value:function(e){var t;if(this.batchSprite){var n=e.getComponentsInChildren(A);0!==n.length&&(t=this.spriteChildren).push.apply(t,Ve(n))}}},{key:"saveNodeChildrenByName",value:function(e){var t=this;this.batchByName&&e.children.forEach((function(e){-1!==t.listName.indexOf(e.name)?t.nameChildren.push(e):t.saveNodeChildrenByName(e)}))}},{key:"saveNodeChildrenByType",value:function(e){var t,n=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(this.batchAllNodes){var a=e.getComponentsInChildren(f);(t=this.allChildren).push.apply(t,Ve(a)),this.batchDepth>0&&i<this.batchDepth&&this.allChildren.forEach((function(e){n.saveNodeChildrenByType(e.node,n.batchDepth)}))}}},{key:"hierarchyChildren",value:function(){var e,t=this;this.labelChildren.forEach((function(n){n.node.isValid&&n.node.activeInHierarchy&&(e=t.batchNode.label,n.node.isChildOf(e)||(n.node.setParent(e,!0),n.node.layer=Z.Enum.UI_2D))})),this.spriteChildren.forEach((function(n){n.node.isValid&&n.node.activeInHierarchy&&(e=t.batchNode.sprite,n.node.isChildOf(e)||(n.node.setParent(e,!0),n.node.layer=Z.Enum.UI_2D))})),this.allChildren.forEach((function(n){n.node.isValid&&n.node.activeInHierarchy&&(e=t.batchNode.node,n.node.isChildOf(e)||(n.node.setParent(e,!0),n.node.layer=Z.Enum.UI_2D))})),this.allChildren.sort((function(e,t){var n=e.constructor.name,i=t.constructor.name;return n<i?-1:n>i?1:0})),this.nameChildren.forEach((function(n){if(n.isValid&&n.activeInHierarchy&&n.isTransformDirty()){var i=n.getComponent(N);i&&i.opacity<1||(e=t.batchNode[n.name],n.isChildOf(e)||(n.setParent(e,!0),n.layer=Z.Enum.UI_2D))}}))}},{key:"restoreOriginalChildren",value:function(){var e=this,t=[].concat(Ve(this.labelChildren),Ve(this.spriteChildren));t.length>0&&t.forEach((function(t){var n=e.originalParents[t.uuid];n&&(t.node.isChildOf(n)||t.node.setParent(n,!0))})),this.nameChildren.forEach((function(t){var n=e.originalParents[t.uuid];n&&(t.isChildOf(n)||t.setParent(n,!0))}))}}]),n}(f)).prototype,"batchByName",[Xo],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),us=Xe(ss.prototype,"depthNames",[$o],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),cs=Xe(ss.prototype,"listName",[Qo],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),hs=Xe(ss.prototype,"batchLabel",[Jo],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),ps=Xe(ss.prototype,"depthLabel",[Zo],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),ds=Xe(ss.prototype,"typeLabel",[es],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"char"}}),fs=Xe(ss.prototype,"batchSprite",[ts],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),vs=Xe(ss.prototype,"depthSprite",[ns],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),ys=Xe(ss.prototype,"batchAllNodes",[is],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),ms=Xe(ss.prototype,"batchDepth",[as],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),gs=Xe(ss.prototype,"checkOverlap",[rs],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),os=ss))||os)||os);n._RF.pop(),n._RF.push({},"9b958Lf6PFClb/JuJfTLzxG","Vibrate",void 0);var Ps=i.ccclass,_s=GameCore.Utils,Ls=globalThis.game.player,Os=Ps("Vibrate")(Ss=function(e){Ie(n,e);var t=Fe(n);function n(){return Te(this,n),t.apply(this,arguments)}return xe(n,[{key:"vibrate",value:function(e){if(this.isVibrateEnable()&&!_s.Browser.vibrate(e)){if("performHapticFeedbackAsync"in GameSDK.extra)return void GameSDK.extra.performHapticFeedbackAsync();console.warn("Vibrate failed")}}},{key:"isVibrateEnable",value:function(){return!!Ls.getPlayerSetting("vibrate")}}]),n}(f))||Ss;n._RF.pop(),n._RF.push({},"358fdIqjFdNzZGa95REWt2F","Ads",void 0);var Ds=1/6;n._RF.pop(),n._RF.push({},"542caJcCPRMI5EaOkgOzhek","ItemKeys",void 0);var Ms={HINT:"hint",THUNDER:"thunder",STORM:"storm",PLIERS:"pliers"};n._RF.pop(),n._RF.push({},"62927KYr+tCcIzOaPtVc/q8","CoinData",void 0);var Ns=10,Fs=50,Bs=100,Gs={[Ms.HINT]:80,[Ms.THUNDER]:200,[Ms.STORM]:150,[Ms.PLIERS]:150},zs=200,Us=40;n._RF.pop(),n._RF.push({},"8328a20Ku5GF4anma0sBaxm","DailyRewardsData",void 0);var Hs={0:{id:1,type:"coin",value:20},1:{id:2,type:"coin",value:30},2:{id:3,type:"coin",value:50},3:{id:4,type:"coin",value:100},4:{id:5,type:"coin",value:150},5:{id:6,type:"coin",value:200},6:{id:7,type:"coin",value:250,items:{hint:3,thunder:3,storm:3,pliers:0}}};n._RF.pop(),n._RF.push({},"8875b8IrVpJWJr/45aS1gql","DefaultRespMatchData",void 0);var Vs=ke(ke({},GameCore.Dtos.Match.Data.getDefaultData()),{},{extraData:null});n._RF.pop(),n._RF.push({},"ad867amogBFGJo9jp78EnQP","DevTools",void 0);var qs=function(e){return e.UNLOCK_DEV_TOOLS="unlock-dev-tools",e.TRIGGER_UNLOCK_KEY="trigger-unlock-key",e.TRIGGER_RESET_SEQUENCE="trigger-reset-sequence",e}(qs||{}),Ws={Events:qs,UNLOCK_SEQUENCE:"101013012031"};n._RF.pop(),n._RF.push({},"7decaASyaFOAp2izq8DsREg","TotalLevel",void 0);n._RF.pop(),n._RF.push({},"f8533KH/fxOfYqya9sgLrSj","GameData",void 0);var Ks={level:0,coins:0,stars:0,totalLevel:80,levelVersion:0,lastRewardedItems:0,lastCreateTournamentShown:0,guideItemShowed:[],items:{[Ms.HINT]:0,[Ms.THUNDER]:0,[Ms.STORM]:0,[Ms.PLIERS]:0},skins:{}};n._RF.pop(),n._RF.push({},"52b52FNwvhBKY/becAy420o","Leaderboard",void 0);var js="global-leaderboard-key",Ys="friends-leaderboard-key",Xs="global-leaderboard-id",$s="friends-leaderboard-id";n._RF.pop(),n._RF.push({},"3b9bcPJBxpNOqG2I6exTOVn","MatchCustomData",void 0);var Qs=ke(ke({},GameCore.Dtos.Match.CustomData.getDefaultData()),{},{score:0});n._RF.pop(),n._RF.push({},"074c4KXFZ1Pq6d+66PrLd2+","PlayerData",void 0);var Js={score:0,endlessScore:0,settings:{sound:!0,music:!0,vibrate:!0,language:"en"},gameData:Ks,isFirstLogin:!0,dailyRewarded:{logDays:[],lastRewarded:0}};n._RF.pop(),n._RF.push({},"32598ObpVZK/pecmWIdcs+7","SceneKeys",void 0);var Zs="BootScene",el="GameScene",tl="DashboardScene",nl="ChallengeResultScene";n._RF.pop(),n._RF.push({},"f16ffbXQPtDK58g6BNFwzJv","Tournament",void 0);var il=function(e){return e.RELOAD_TOURNAMENT="reload-tournament",e}(il||{});n._RF.pop(),n._RF.push({},"598f2UgQ+NGBYLWv34s6Vev","renderCustomResultChallenge",void 0);var al=GameCore,rl=al.Configs,ol=al.Utils.Object,sl=rl.FrameCapture,ll=sl.Enabled,ul=sl.WideframeConfigs,cl=function(){var e=Ce(Se().mark((function e(t){var n,i,a,r,o;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(ll){e.next=3;break}return console.warn("FrameCapture is not enabled"),e.abrupt("return",null);case 3:if(n=pl(t)){e.next=6;break}return e.abrupt("return",null);case 6:return hl(n,ul.CustomResultChallenge),i=window.game.frameCapture,a=ul.CustomResultChallenge,r=a.Width,o=a.Height,e.abrupt("return",i.captureAsync({name:"CustomResultChallenge",width:r,height:o,renderOptions:n}));case 10:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),hl=function(e,t){var n=t.Width,i=t.Height,a=t.Wideframe;e.wideframe={name:"custom-result-challenge",type:"image",depth:0,image:a,size:[n,i],position:[0,0]}},pl=function(e){try{var t=e.playerId,n=void 0===t?"10":t,i=e.playerPhoto,a=void 0===i?"":i,r=e.playerScore,o=void 0===r?0:r,s=e.opponentId,l=void 0===s?"20":s,u=e.opponentPhoto,c=void 0===u?"":u,h=e.opponentScore,p=void 0===h?0:h,d=e.isPlayerFinished,f=e.isOpponentFinished,v=ul.CustomResultChallenge.RenderOptions,y=ol.camelCaseKeys(ol.clone(v)),m=y.playerPhoto,g=y.opponentPhoto,b=o===p,w=o>p,k=null!=d?d:f,S=d&&f;return"image"===m.type&&(m.name=`${n}`,m.image=a),"image"===g.type&&(g.name=`${l}`,g.image=c),k&&dl(y,{playerScore:o,opponentScore:p,isPlayerFinished:d,isOpponentFinished:f}),!S||b?(delete y.leftCrown,delete y.rightCrown,y):(w?delete y.rightCrown:delete y.leftCrown,y)}catch(e){return console.warn("getRenderOptionsShareScore",e),null}},dl=function(e,t){var n=e.leftScore,i=e.rightScore,a=t.playerScore,r=void 0===a?0:a,o=t.opponentScore,s=void 0===o?0:o,l=t.isPlayerFinished,u=t.isOpponentFinished;"text"===n.type&&(n.text=l?`${r}`:"???"),"text"===i.type&&(i.text=u?`${s}`:"???")};n._RF.pop(),n._RF.push({},"ad7acMQ2iJNKKA2RkT+nGNI","CommonError",void 0);var fl=function(e){Ie(n,e);var t=Fe(n);function n(e,i){var a;return Te(this,n),(a=t.call(this,i)).code=e,a}return xe(n)}(De(Error));n._RF.pop(),n._RF.push({},"5ff78u05/tPepABfMzNaOjM","PlayerHasTournamentError",void 0);var vl=function(e){Ie(n,e);var t=Fe(n);function n(e,i){var a;return Te(this,n),(a=t.call(this,"PLAYER_HAS_TOURNAMENT","Player has a tournament")).playerId=e,a.tournamentId=i,a}return xe(n)}(fl);n._RF.pop(),n._RF.push({},"e14dbcdc89LQJIggfi5qO6U","MapData",void 0);var yl={themeNames:["summer","autumn","winter"],skinNames:["cakes","car","cosmetics","flower","fruit","ice-cream","sport","tool"],mapOrder:[{id:1,theme:"summer",skin:"fruit",levelCount:10},{id:2,theme:"autumn",skin:"flower",levelCount:10},{id:3,theme:"winter",skin:"tool",levelCount:10},{id:4,theme:"summer",skin:"sport",levelCount:10},{id:5,theme:"autumn",skin:"cosmetics",levelCount:10},{id:6,theme:"winter",skin:"ice-cream",levelCount:10},{id:7,theme:"summer",skin:"cakes",levelCount:10},{id:8,theme:"autumn",skin:"car",levelCount:10}]};n._RF.pop(),n._RF.push({},"c0656MbbYRE+KSk63rv74ZI","SkinKeys",void 0);var ml="cakes",gl="flower",bl="fruit";n._RF.pop(),n._RF.push({},"3f1dbbPrPVBy5lNYySV74Qq","ThemeKeys",void 0);var wl={SUMMER:"summer",AUTUMN:"autumn",WINTER:"winter"};x(wl),n._RF.pop(),n._RF.push({},"6093adbLQZKpqgUpTV/sHj1","ThemeUtils",void 0);var kl=globalThis.game,Sl=kl.player,El=kl.storage,Cl={currentProgress:0,maxProgress:10,isLocked:!0,themeId:"summer"},Tl={id:0,currentSkin:ml,currentTheme:wl.SUMMER,nextSkin:null,nextTheme:null,progress:0,max:10},Al={skin:"cakes",themeId:"summer",progress:0,max:10,isLocked:!0},xl=function(){function e(){Te(this,e),this.mapData=yl,this.playerSkinProgress=null}return xe(e,[{key:"initDashboardSceneStorage",value:function(){var e=El.getStorage("dashboard");if(null==e){var t=this.getCurrentMapProgressInstance();El.addStorage("dashboard",{lastMapPayload:t,numOfMapsPassed:0,animateToCurrentLevel:!1});var n=El.getStorage("collection");if(null==n){El.addStorage("collection",{lastMapPack:t.id,animateMapPackUnlock:!1});var i=El.getStorage("leaderboard_content");if(null==i){El.addStorage("leaderboard_content",{lastTabOpened:"global"});var a=El.getStorage("tournament");null==a&&El.addStorage("tournament",{animateTournamentLeader:!1})}}}}},{key:"getCurrentMapProgressInstance",value:function(){if(null===this.playerSkinProgress)return console.warn("getCurrentMapProgress: playerSkinProgress not found. Have you called init()?"),Tl;for(var e=this.mapData.mapOrder,t=void 0,n=void 0,i=void 0,a=void 0,r=0,o=0,s=0,l=0;l<e.length;l++){var u=this.playerSkinProgress[e[l].skin];if(u.currentProgress<u.maxProgress){var c,h,p,d;s=e[l].id,t=e[l].skin,n=e[l].theme,i=null!==(c=null===(h=e[l+1])||void 0===h?void 0:h.skin)&&void 0!==c?c:t,a=null!==(p=null===(d=e[l+1])||void 0===d?void 0:d.theme)&&void 0!==p?p:n,r=u.currentProgress,o=u.maxProgress;break}}if(void 0===t||void 0===i||void 0===n||void 0===a){var f=e[e.length-1];return s=f.id,t=f.skin,n=f.theme,i=f.skin,a=f.theme,r=f.levelCount,o=f.levelCount,console.log("getMapCurrentProgress: all skin completed"),{id:s,currentSkin:t,currentTheme:n,nextSkin:i,nextTheme:a,progress:r,max:o}}return console.log("getMapCurrentProgress",t,i,r,o),{id:s,currentSkin:t,currentTheme:n,nextSkin:i,nextTheme:a,progress:r,max:o}}},{key:"getUnlockedSkinsInstance",value:function(){if(null===this.playerSkinProgress||void 0===this.playerSkinProgress)return console.warn("getUnlockedSkins: playerSkinProgress not found. Have you called init()?"),["cakes"];for(var e=[],t=0,n=Object.keys(this.playerSkinProgress);t<n.length;t++){var i=n[t];this.playerSkinProgress[i].isLocked||e.push(i)}return console.log("getUnlockedSkins",e),e}},{key:"getLevelSkinInstance",value:function(e){var t,n=null!=e?e:1,i=this.mapData.mapOrder,a=0,r=Ke(i);try{for(r.s();!(t=r.n()).done;){var o=t.value;if(a+o.levelCount>=n)return console.log("getMapSkin",o.skin),o.skin;a+=o.levelCount}}catch(e){r.e(e)}finally{r.f()}var s=i[i.length-1];return console.log("getMapSkin",s.skin),s.skin}},{key:"getLevelThemeInstance",value:function(e){var t,n=null!=e?e:1,i=this.mapData.mapOrder,a=0,r=Ke(i);try{for(r.s();!(t=r.n()).done;){var o=t.value;if(a+o.levelCount>=n)return console.log("getMapTheme",o.theme),o.theme;a+=o.levelCount}}catch(e){r.e(e)}finally{r.f()}var s=i[i.length-1];return console.log("getMapTheme",s.theme),s.theme}},{key:"getCollectionUnlockProgressInstance",value:function(){if(null===this.playerSkinProgress)return console.warn("getCollectionUnlockProgress: playerSkinProgress not found. Have you called init()?"),[Al];for(var e=[],t=0,n=Object.entries(this.playerSkinProgress);t<n.length;t++){var i=n[t],a=i[1],r=a.currentProgress,o=a.maxProgress,s=a.isLocked,l=a.themeId;e.push({progress:r,max:o,isLocked:s,skin:i[0],themeId:l})}return e}},{key:"updatePlayerSkinProgress",value:function(){var e=Sl.getGameData();if(null!=e&&e.skins&&Object.keys(e.skins).length>0){this.playerSkinProgress={};for(var t=0,n=Object.keys(e.skins);t<n.length;t++){var i=n[t];this.playerSkinProgress[i]=ke(ke({},Cl),e.skins[i])}}else{console.log("getPlayerSkinProgress: playerData not found, use data from level");var a=this.mapData.mapOrder;this.playerSkinProgress={};var r,o=Ke(a);try{for(o.s();!(r=o.n()).done;){var s=r.value;this.playerSkinProgress[s.skin]={themeId:s.theme,currentProgress:0,maxProgress:s.levelCount,isLocked:!0}}}catch(e){o.e(e)}finally{o.f()}this.updatePlayerSkinProgressByLevel(),console.log(this.playerSkinProgress)}}},{key:"updatePlayerSkinProgressByLevel",value:function(){var e,t=Sl.getGameData(),n=(null!==(e=null==t?void 0:t.level)&&void 0!==e?e:1)-1,i=this.mapData.mapOrder;this.playerSkinProgress[i[0].skin].isLocked=!1;var a,r=Ke(i);try{for(r.s();!(a=r.n()).done;){var o=a.value,s=o.levelCount,l=o.skin;if(!(n<=0)){var u=n-s>=0?s:n;n-=u,console.log("getPlayerSkinProgressByLevel",l,u),this.increaseProgressInstance(l,u,!1)}}}catch(e){r.e(e)}finally{r.f()}}},{key:"increaseProgressInstance",value:function(e,t,n){if(null!==this.playerSkinProgress)if(this.playerSkinProgress[e]){var i=this.playerSkinProgress[e],a=i.currentProgress,r=i.maxProgress,o=a+t>r?r:a+t;if(o>0&&(this.playerSkinProgress[e].isLocked=!1),o===r){var s,l=this.mapData.mapOrder,u=l.findIndex((function(t){return t.skin===e})),c=null===(s=l[u+1])||void 0===s?void 0:s.skin;c&&this.unlockSkinInstance(c,!1)}this.playerSkinProgress[e].currentProgress=o,this.playerSkinProgress[e].maxProgress=r,n&&this.syncPlayerSkinProgress()}else console.warn("increaseProgress: skin not found",e);else console.warn("increaseProgress: playerSkinProgress not found. Have you called init()?")}},{key:"unlockSkinInstance",value:function(e,t){null!==this.playerSkinProgress?this.playerSkinProgress[e]?(this.playerSkinProgress[e].isLocked=!1,t&&this.syncPlayerSkinProgress()):console.warn("unlockSkin: skin not found",e):console.warn("unlockSkin: playerSkinProgress not found. Have you called init()?")}},{key:"syncPlayerSkinProgress",value:function(){Sl.setGameData({skins:this.playerSkinProgress})}}],[{key:"getInstance",value:function(){return this._instance||(this._instance=new e),this._instance}},{key:"init",value:function(){var e=this.getInstance();e.updatePlayerSkinProgress(),e.initDashboardSceneStorage()}},{key:"getCurrentMapProgress",value:function(){return this.getInstance().getCurrentMapProgressInstance()}},{key:"getUnlockedSkins",value:function(){return this.getInstance().getUnlockedSkinsInstance()}},{key:"getLevelSkin",value:function(e){return this.getInstance().getLevelSkinInstance(e)}},{key:"getLevelTheme",value:function(e){return this.getInstance().getLevelThemeInstance(e)}},{key:"getCollectionUnlockProgress",value:function(){return this.getInstance().getCollectionUnlockProgressInstance()}},{key:"increaseProgress",value:function(e,t,n){this.getInstance().increaseProgressInstance(e,t,n)}},{key:"unlockSkin",value:function(e,t){this.getInstance().unlockSkinInstance(e,t)}}]),e}();n._RF.pop(),n._RF.push({},"0397cr2IpZEwbRzwQhlVHMO","MatchUtils",void 0);var Rl=globalThis.game,Il=Rl.match,Pl=Rl.player,_l=Rl.leaderboard,Ll=Rl.frameCapture,Ol=GameCore.Utils,Dl=Ol.Object,Ml=Ol.Valid,Nl=GameCore.Match.Modes,Fl=["Champion","Ultimate","Grand","Elite","Master's","Premier","Epic","Pro's","Supreme","Legendary","Victory","Prime","Titan's","Hero's","Star's"],Bl=function(){function e(){Te(this,e)}var t,n,i,a,r,o,s,l,u,c,h,p,d,f,v,y,m,g,b;return xe(e,[{key:"processStartSingleModeAsync",value:(b=Ce(Se().mark((function e(){var t;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=Pl.getPlayerId(),e.next=3,Il.single.start.processAsync({playerId:t});case 3:case"end":return e.stop()}}),e)}))),function(){return b.apply(this,arguments)})},{key:"processFinishSingleModeAsync",value:(g=Ce(Se().mark((function e(){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Il.single.finish.processAsync();case 2:case"end":return e.stop()}}),e)}))),function(){return g.apply(this,arguments)})},{key:"processStartTournamentModeAsync",value:(m=Ce(Se().mark((function e(){var t,n;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=Pl.getPlayerId(),n=GameSDK.context.getID(),e.next=4,Il.tournament.continue.processAsync({playerId:t,contextId:n});case 4:case"end":return e.stop()}}),e)}))),function(){return m.apply(this,arguments)})},{key:"processFinishTournamentModeAsync",value:(y=Ce(Se().mark((function e(){var t,n;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=Pl.getPlayerId(),n=Pl.getBestScore(),e.next=4,Il.tournament.finish.processAsync({playerId:t,bestScore:n});case 4:case"end":return e.stop()}}),e)}))),function(){return y.apply(this,arguments)})},{key:"processStartChallengeModeAsync",value:(v=Ce(Se().mark((function e(){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.processContinueChallengeAsync();case 3:e.next=15;break;case 5:if(e.prev=5,e.t0=e.catch(0),Dl.hasOwn(e.t0,"name")&&!Ml.isString(e.t0.name)){e.next=9;break}throw e.t0;case 9:if("PlayerHasFinishedMatch"!==e.t0.name){e.next=12;break}return e.next=12,this.processChallengeNewOpponentAsync();case 12:if("PlayerNotJoinInMatch"!==e.t0.name){e.next=15;break}return e.next=15,this.processJoinChallengeAsync();case 15:case"end":return e.stop()}}),e,this,[[0,5]])}))),function(){return v.apply(this,arguments)})},{key:"processFinishChallengeModeAsync",value:(f=Ce(Se().mark((function e(t){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return Ll.addWideframeRender("renderResultChallenge",Ll.wideframe.renderResultChallenge),e.next=3,Il.challenge.finish.processAsync(t);case 3:case"end":return e.stop()}}),e)}))),function(e){return f.apply(this,arguments)})},{key:"processContinueChallengeAsync",value:(d=Ce(Se().mark((function e(){var t,n,i,a,r,o;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.getMatchState(),n=t.id,i=t.customData,a=i.playerId,r=i.opponentId,Ml.isString(n)){e.next=4;break}throw new Error("Invalid match id");case 4:if(Ml.isString(a)){e.next=6;break}throw new Error("Invalid player id");case 6:if(Ml.isString(r)){e.next=8;break}throw new Error("Invalid opponent id");case 8:if(o=GameSDK.context.getID()){e.next=11;break}throw new Error("Cannot get contextId");case 11:return e.next=13,Il.challenge.continue.processAsync({matchId:n,contextId:o,playerId:a,opponentId:r});case 13:case"end":return e.stop()}}),e,this)}))),function(){return d.apply(this,arguments)})},{key:"processChallengeNewOpponentAsync",value:(p=Ce(Se().mark((function e(){var t,n,i,a;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=Pl.getConnectedPlayerIds(100,0),n=Math.floor(Math.random()*t.length),i=Pl.getPlayerId(),a=t[n],e.next=6,Il.challenge.friend.processAsync({playerId:i,opponentId:a});case 6:case"end":return e.stop()}}),e)}))),function(){return p.apply(this,arguments)})},{key:"processJoinChallengeAsync",value:(h=Ce(Se().mark((function e(){var t,n,i,a,r;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.getMatchState(),n=t.id,i=t.customData,a=i.playerId,r=i.opponentId,Ml.isString(n)){e.next=4;break}throw new Error("Invalid match id");case 4:if(Ml.isString(a)){e.next=6;break}throw new Error("Invalid player id");case 6:if(Ml.isString(r)){e.next=8;break}throw new Error("Invalid opponent id");case 8:return e.next=10,Il.challenge.join.processAsync({matchId:n,playerId:a,opponentId:r});case 10:case"end":return e.stop()}}),e,this)}))),function(){return h.apply(this,arguments)})},{key:"getMatchState",value:function(){var e=Il.getMatchState();if(!e)throw new Error("Match state not found");return e}}],[{key:"inst",get:function(){return this._instance||(this._instance=new e),this._instance}},{key:"startMatchAsync",value:(c=Ce(Se().mark((function e(t){var n;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.prev=0,n=null!=t?t:this.getMatchMode(),e.t0=n,e.next=e.t0===Nl.SINGLE?5:e.t0===Nl.TOURNAMENT?8:e.t0===Nl.CHALLENGE_FRIEND?11:14;break;case 5:return e.next=7,this.inst.processStartSingleModeAsync();case 7:return e.abrupt("break",16);case 8:return e.next=10,this.inst.processStartTournamentModeAsync();case 10:return e.abrupt("break",16);case 11:return e.next=13,this.inst.processStartChallengeModeAsync();case 13:return e.abrupt("break",16);case 14:return e.next=16,this.inst.processStartSingleModeAsync();case 16:e.next=21;break;case 18:e.prev=18,e.t1=e.catch(0),console.warn("startMatchAsync",e.t1);case 21:case"end":return e.stop()}}),e,this,[[0,18]])}))),function(e){return c.apply(this,arguments)})},{key:"setProfileMatchDataAsync",value:(u=Ce(Se().mark((function e(t){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Il.handler.setProfileData(t);case 3:e.next=8;break;case 5:e.prev=5,e.t0=e.catch(0),console.warn("setProfileMatchDataAsync",e.t0);case 8:case"end":return e.stop()}}),e,null,[[0,5]])}))),function(e){return u.apply(this,arguments)})},{key:"setMatchCustomDataAsync",value:(l=Ce(Se().mark((function e(t){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Il.handler.setMatchCustomData(t);case 3:e.next=8;break;case 5:e.prev=5,e.t0=e.catch(0),console.warn("setMatchCustomDataAsync",e.t0);case 8:case"end":return e.stop()}}),e,null,[[0,5]])}))),function(e){return l.apply(this,arguments)})},{key:"setLeaderboardScoreAsync",value:(s=Ce(Se().mark((function e(t){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Il.handler.setLeaderboardScore(t);case 3:e.next=8;break;case 5:e.prev=5,e.t0=e.catch(0),console.warn("setLeaderboardScoreAsync",e.t0);case 8:case"end":return e.stop()}}),e,null,[[0,5]])}))),function(e){return s.apply(this,arguments)})},{key:"finishMatchAsync",value:(o=Ce(Se().mark((function e(t){var n;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.prev=0,n=this.getMatchMode(),e.t0=n,e.next=e.t0===Nl.SINGLE?5:e.t0===Nl.TOURNAMENT?8:e.t0===Nl.CHALLENGE_FRIEND?11:14;break;case 5:return e.next=7,this.inst.processFinishSingleModeAsync();case 7:return e.abrupt("break",16);case 8:return e.next=10,this.inst.processFinishTournamentModeAsync();case 10:return e.abrupt("break",16);case 11:return e.next=13,this.inst.processFinishChallengeModeAsync(t);case 13:return e.abrupt("break",16);case 14:return e.next=16,this.inst.processFinishSingleModeAsync();case 16:e.next=21;break;case 18:e.prev=18,e.t1=e.catch(0),console.warn("finishMatchAsync",e.t1);case 21:case"end":return e.stop()}}),e,this,[[0,18]])}))),function(e){return o.apply(this,arguments)})},{key:"joinTournamentAsync",value:(r=Ce(Se().mark((function e(t){var n;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=Pl.getPlayerId(),e.next=3,Il.tournament.join.processAsync({tournamentId:t,playerId:n});case 3:case"end":return e.stop()}}),e)}))),function(e){return r.apply(this,arguments)})},{key:"continueTournamentAsync",value:(a=Ce(Se().mark((function e(t){var n;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=Pl.getPlayerId(),e.next=3,Il.tournament.continue.processAsync({playerId:n,contextId:t});case 3:case"end":return e.stop()}}),e)}))),function(e){return a.apply(this,arguments)})},{key:"createTournamentName",value:function(){var e=`${Fl[G.randomRangeInt(0,Fl.length-1)]} Tournament`;return`${GameCore.Utils.String.removeDiacritics(e)}`}},{key:"getShortName",value:function(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:50,i=e.split(" "),a=0,r="",o=Ke(i);try{for(o.s();!(t=o.n()).done;){var s=t.value;if(a+s.length+1>n)break;r+=`${s} `,a+=s.length+1}}catch(e){o.e(e)}finally{o.f()}return r.slice(0,-1)}},{key:"createTournamentPayload",value:function(){var e,t,n,i=GameCore.Utils.String.generateObjectId(),a=Pl.getPlayerId(),r=Pl.getPlayer().name,o=Pl.getGameData(),s=null!==(e=null==o?void 0:o.level)&&void 0!==e?e:1,l=xl.getLevelTheme(s),u=this.inst.getMatchState().profiles;return{score:null!==(t=null===(n=(void 0===u?{}:u)[a])||void 0===n?void 0:n.score)&&void 0!==t?t:0,playerId:a,mode:Nl.TOURNAMENT,name:this.createTournamentName(),leaderboardId:i,payload:{playerId:a,playerName:r,leaderboardId:i,themeId:l}}}},{key:"getTournamentsAsync",value:(i=Ce(Se().mark((function e(){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,GameSDK.tournament.getTournamentsAsync();case 3:return e.abrupt("return",e.sent);case 6:return e.prev=6,e.t0=e.catch(0),console.error(e.t0),e.abrupt("return",[]);case 10:case"end":return e.stop()}}),e,null,[[0,6]])}))),function(){return i.apply(this,arguments)})},{key:"processCreateTournamentAsync",value:(n=Ce(Se().mark((function e(){var t,n,i,a;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getTournamentsAsync();case 2:if(t=e.sent,!(n=t.find((function(e){var t,n=JSON.parse(null!==(t=e.getPayload())&&void 0!==t?t:"{}");return"DEFAULT"===e.getTournamentType()&&n.playerId===Pl.getPlayerId()})))){e.next=6;break}throw new vl(Pl.getPlayerId(),n.getID());case 6:return i=this.createTournamentPayload(),Pl.setGameData({lastCreateTournamentShown:Date.now()}),e.next=10,Il.tournament.create.processAsync(i);case 10:a=i.leaderboardId,_l.addLeaderboard({name:a,type:"tournament",autoSortRank:!0,leaderboardId:a});case 12:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"getMatchMode",value:function(){var e=this.inst.getMatchState();return Ml.isString(e.mode)?e.mode:null}},{key:"getMatchCustomData",value:function(){var e=this.inst.getMatchState();return Ml.isObject(e.customData)?e.customData:null}},{key:"getMatchExtraDataAsync",value:(t=Ce(Se().mark((function e(t){var n,i,a;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Il.api.getMatchAPI().getMatchDetailByIdAsync(t);case 2:return n=e.sent,i=new GameCore.Dtos.Match.Data(n).toObject(),a=i.extraData,e.abrupt("return",a);case 6:case"end":return e.stop()}}),e)}))),function(e){return t.apply(this,arguments)})},{key:"updateMatchStateAfterLevelFinish",value:function(e,t){this.setMatchCustomDataAsync({level:e,score:t});var n=Pl.getPlayerId();this.setProfileMatchDataAsync({id:n,score:t})}}]),e}();try{new Bl}catch(e){console.error("MatchUtils",e)}n._RF.pop(),n._RF.push({},"97ca9J9nzNCeIjC1l+ZT/Hm","SceneUtils",void 0);var Gl,zl,Ul,Hl,Vl,ql,Wl,Kl=globalThis.game.event,jl=GameCore.Events,Yl=function(){function e(){Te(this,e)}return xe(e,null,[{key:"inst",get:function(){return this._instance||(this._instance=new e),this._instance}},{key:"switchScene",value:function(e,t){Kl.emit(jl.SWITCH_SCENE,{sceneName:e,sceneData:t})}},{key:"preloadScene",value:function(e){Kl.emit(jl.PRELOAD_SCENE,{sceneName:e})}},{key:"preloadDashboardScene",value:function(){this.preloadScene(tl)}},{key:"switchToDashboardScene",value:function(e){this.switchScene(tl,e)}},{key:"preloadGameScene",value:function(){this.preloadScene(el)}},{key:"switchToGameScene",value:function(e){this.switchScene(el,e)}},{key:"getSceneData",value:function(e){return"data"in e.scene&&e.scene.data||{}}}]),e}();try{new Yl}catch(e){console.error("SceneUtils",e)}n._RF.pop(),n._RF.push({},"46b8aK6CThLtpMhZPEfDrNs","LoadingFullScreen",void 0);var Xl,$l,Ql,Jl,Zl,eu=i.ccclass,tu=i.property,nu=(Gl=eu("LoadingFullScreen"),zl=tu(X),Ul=tu(u),Gl((ql=Xe((Vl=function(e){Ie(a,e);var t,n,i=Fe(a);function a(){var e;Te(this,a);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return Ye(e=i.call.apply(i,[this].concat(n)),"progressBar",ql,Me(e)),Ye(e,"loadingText",Wl,Me(e)),e}return xe(a,[{key:"__preload",value:function(){this.uiOpacity=this.getComponent(N),this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){kt.lazyValidateProperties(this)}},{key:"runLoadingTextAnimation",value:function(){var e=this,t=0;this.schedule((function(){t=t>2?0:t+1,e.loadingText.string="Loading"+".".repeat(t)}),.5)}},{key:"stopLoadingTextAnimation",value:function(){this.unscheduleAllCallbacks()}},{key:"show",value:(n=Ce(Se().mark((function e(){var t,n;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.uiOpacity.opacity=0,this.progressBar.progress=0,t=S(this.uiOpacity).to(.2,{opacity:255},{easing:"cubicOut"}),n=S(this.progressBar).to(8,{progress:.9},{easing:"cubicOut"}),this.runLoadingTextAnimation(),vn.runTweenAsync(t),e.next=8,vn.runTweenAsync(n);case 8:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"hide",value:(t=Ce(Se().mark((function e(){var t,n;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.uiOpacity&&this.progressBar){e.next=2;break}return e.abrupt("return");case 2:return this.uiOpacity.opacity=255,this.progressBar.progress=.9,t=S(this.uiOpacity).to(.15,{opacity:0},{easing:"cubicIn"}),n=S(this.progressBar).to(.2,{progress:1},{easing:"cubicIn"}),this.runLoadingTextAnimation(),e.next=9,vn.runTweenAsync(n);case 9:return this.stopLoadingTextAnimation(),e.next=12,vn.runTweenAsync(t);case 12:this.node.active=!1;case 13:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),a}(f)).prototype,"progressBar",[zl],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Wl=Xe(Vl.prototype,"loadingText",[Ul],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Hl=Vl))||Hl);n._RF.pop(),n._RF.push({},"74caciRBKZLu7ymXYJK2GYy","Loading",void 0);var iu=i.ccclass,au=i.property,ru=(Xl=iu("Loading"),$l=au(I),Xl((Zl=Xe((Jl=function(e){Ie(a,e);var t,n,i=Fe(a);function a(){var e;Te(this,a);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return Ye(e=i.call.apply(i,[this].concat(n)),"loadingPrefab",Zl,Me(e)),e.loadingNode=null,e}return xe(a,[{key:"__preload",value:function(){this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){kt.lazyValidateProperties(this)}},{key:"onLoad",value:function(){this.makePersistent()}},{key:"makePersistent",value:function(){d.addPersistRootNode(this.node)}},{key:"createLoadingFullScreen",value:function(){var e,t=R("Canvas");if(t&&!t.getChildByName("Loading")){this.loadingNode||(this.loadingNode=l(this.loadingPrefab));var n=l._clone(this.loadingNode);this.loadingFullScreen=n.getComponent(nu),this.node.active=!1,null===(e=R("Canvas"))||void 0===e||e.addChild(n)}}},{key:"show",value:(n=Ce(Se().mark((function e(){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.createLoadingFullScreen(),!this.node.active){e.next=3;break}return e.abrupt("return");case 3:return this.node.active=!0,e.next=6,this.loadingFullScreen.show();case 6:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"hide",value:(t=Ce(Se().mark((function e(){var t;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!==(t=this.node)&&void 0!==t&&t.active){e.next=2;break}return e.abrupt("return");case 2:if(this.loadingFullScreen){e.next=4;break}return e.abrupt("return");case 4:return e.next=6,this.loadingFullScreen.hide();case 6:this.node.active=!1;case 7:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),a}(f)).prototype,"loadingPrefab",[$l],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ql=Jl))||Ql);n._RF.pop(),n._RF.push({},"a0dcdDZxhZImZ8Cfg4Dc7SJ","ScreenUtils",void 0);var ou=globalThis.game.event,su=GameCore.Events,lu=function(){function e(){Te(this,e),this.showedScreens=[]}var t,n;return xe(e,null,[{key:"inst",get:function(){return this._instance||(this._instance=new e),this._instance}},{key:"openScreen",value:function(e,t){var n=fi[e];ou.emit(su.OPEN_SCREEN,{screenName:n,screenData:t})}},{key:"closeScreen",value:function(e){var t=fi[e];ou.emit(su.CLOSE_SCREEN,{screenName:t})}},{key:"showLoadingScreen",value:function(e){this.openScreen(di.LOADING_SCREEN,{duration:e})}},{key:"closeLoadingScreen",value:function(){this.closeScreen(di.LOADING_SCREEN)}},{key:"showNotificationScreen",value:function(e,t){this.openScreen(di.NOTIFICATION_SCREEN,{message:e,duration:t})}},{key:"closeNotificationScreen",value:function(){this.closeScreen(di.NOTIFICATION_SCREEN)}},{key:"addShowedScene",value:function(e){-1===this.inst.showedScreens.indexOf(e)&&this.inst.showedScreens.push(e)}},{key:"showLoadingFullScreen",value:(n=Ce(Se().mark((function e(t){var n;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(-1===this.inst.showedScreens.indexOf(t)){e.next=2;break}return e.abrupt("return");case 2:if(this.addShowedScene(t),n=R("Loading")){e.next=6;break}return e.abrupt("return");case 6:return n.active=!0,e.next=9,n.getComponent(ru).show();case 9:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"hideLoadingFullScreen",value:(t=Ce(Se().mark((function e(t){var n;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(-1===this.inst.showedScreens.indexOf(t)){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,null===(n=R("Loading"))||void 0===n?void 0:n.getComponent(ru).hide();case 4:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"showLoadingNotificationScreen",value:function(){this.openScreen(di.NOTIFICATION_SCREEN,{message:"Loading",enableCloseOnTouch:!1})}},{key:"showTournamentDetailScreen",value:function(e,t){this.openScreen(di.TOURNAMENT_DETAIL_SCREEN,{tournament:e,tournamentContextType:t})}},{key:"closeTournamentDetailScreen",value:function(){this.closeScreen(di.TOURNAMENT_DETAIL_SCREEN)}}]),e}();try{new lu}catch(e){console.error("ScreenUtils",e)}n._RF.pop(),n._RF.push({},"d6fb7/+FFxLs7k5w6K38JYb","TournamentUtils",void 0);var uu=GameCore,cu=uu.Utils,hu=uu.Configs,pu=globalThis.game,du=pu.leaderboard,fu=pu.player,vu=function(){function e(){var t=this;Te(this,e),this.globalTournamentLBData=[],this.playerTournaments=[],this.tournamentData=[],this.maxTimeRefetch=5e3,this.lastFetchTournamentsData=0,this.lastFetchGlobalTournament=0,this.fetchGlobalTournamentLeaderboardAsync=Ce(Se().mark((function e(){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,!(Date.now()-t.lastFetchGlobalTournament>t.maxTimeRefetch)){e.next=7;break}return e.next=5,du.requestLeaderboardsAsync({limit:100,type:"world_tournament_leaderboard"});case 5:t.globalTournamentLBData=e.sent,t.globalTournamentLBData.sort((function(e,t){return e.expireTime-t.expireTime}));case 7:e.next=12;break;case 9:e.prev=9,e.t0=e.catch(0),console.warn("fetchGlobalTournamentLeaderboardAsync",e.t0);case 12:return e.abrupt("return",t.globalTournamentLBData);case 13:case"end":return e.stop()}}),e,null,[[0,9]])}))),this.fetchTournamentsAsync=Ce(Se().mark((function e(){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,!(Date.now()-t.lastFetchTournamentsData>t.maxTimeRefetch)){e.next=7;break}return e.next=5,GameSDK.tournament.getTournamentsAsync();case 5:t.playerTournaments=e.sent,t.playerTournaments.sort((function(e,t){return e.getEndTime()-t.getEndTime()}));case 7:e.next=12;break;case 9:e.prev=9,e.t0=e.catch(0),console.warn("fetchTournamentsAsync",e.t0);case 12:return e.abrupt("return",t.playerTournaments);case 13:case"end":return e.stop()}}),e,null,[[0,9]])})))}var t;return xe(e,[{key:"processPlayerTournamentData",value:function(){var e,t=[],n=Ke(this.playerTournaments);try{for(n.s();!(e=n.n()).done;){var i,a,r=e.value,o=`${r.getID()}`,s=r.getContextID(),l=r.getEndTime(),u=this.parseTournamentPayload(r.getPayload());if(this.validateGameSDKTournamentPayload(u))if(!(l<Date.now()/1e3)&&"PAGE_HOSTED"!==r.getTournamentType()){var c=null!==(i=u.playerName)&&void 0!==i?i:"Player",h={id:o,title:null!==(a=r.getTitle())&&void 0!==a?a:this.createDefaultTournamentName(c),endTime:l,contextId:s,payload:u};t.push(h)}}}catch(e){n.e(e)}finally{n.f()}return t}},{key:"processGlobalTournamentLeaderboardData",value:function(){var e=[];if(hu.Mockup.Leaderboards.Enabled){for(var t=0;t<this.playerTournaments.length;t++){var n,i=this.playerTournaments[t],a=i.getTournamentType();if("PAGE_HOSTED"===a){var r=`${i.getID()}`,o=i.getContextID(),s=i.getEndTime(),l=this.parseTournamentPayload(i.getPayload()),u={id:r,title:null!==(n=i.getTitle())&&void 0!==n?n:"Global Tournament",endTime:s,contextId:o,payload:l,tournamentType:a};e.push(u)}}return e}for(var c=0;c<this.globalTournamentLBData.length;c++){var h,p={tournamentId:"",contextId:""},d=this.globalTournamentLBData[c];try{p=JSON.parse(d.description)}catch(e){continue}if(this.validateExpireTime(d)&&this.validateGlobalTournamentPayload(p)){var f={id:p.tournamentId,title:d.name,endTime:this.getTournamentEndTime(d),contextId:p.contextId,payload:{playerId:"global",playerName:"global",leaderboardId:d._id,themeId:null!==(h=p.themeId)&&void 0!==h?h:wl.SUMMER}};e.push(f)}}return e}},{key:"validateGlobalTournamentPayload",value:function(e){var t=e.tournamentId,n=e.contextId;return!(!cu.Valid.isString(t)||""===t)&&!(!cu.Valid.isString(n)||""===n)}},{key:"getTournamentEndTime",value:function(e){var t=new Date(e.createdAt).getTime();return Math.round((1e3*e.expireTime+t)/1e3)}},{key:"validateExpireTime",value:function(e){return 1e3*this.getTournamentEndTime(e)-Date.now()>0}},{key:"validateGameSDKTournamentPayload",value:function(e){return!(!cu.Valid.isString(e.playerId)||""===e.playerId)&&(!(!cu.Valid.isString(e.playerName)||""===e.playerName)&&!(!cu.Valid.isString(e.leaderboardId)||""===e.leaderboardId))}},{key:"createDefaultTournamentName",value:function(e){var t=e.substring(0,7),n=`${t.split(" ")[0]||t}'s Tournament`;return`${GameCore.Utils.String.removeDiacritics(n)}`}},{key:"parseTournamentPayload",value:function(e){if("string"!=typeof e)return{};try{return JSON.parse(e)}catch(e){return{}}}}],[{key:"getInstance",value:function(){return this._instance||(this._instance=new e),this._instance}},{key:"requestTournamentDataAsync",value:(t=Ce(Se().mark((function e(){var t,n,i;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.getInstance(),e.next=3,Promise.all([t.fetchTournamentsAsync(),t.fetchGlobalTournamentLeaderboardAsync()]);case 3:return n=t.processPlayerTournamentData(),i=t.processGlobalTournamentLeaderboardData(),t.tournamentData=[].concat(Ve(n),Ve(i)),t.tournamentData.sort((function(e,t){return e.endTime-t.endTime})),t.tournamentData.forEach((function(e){var t=e.payload.leaderboardId;t&&(du.isExistLeaderboardId(t)||du.addLeaderboard({type:"tournament",name:t,autoSortRank:!0,leaderboardId:t}))})),e.abrupt("return",t.tournamentData);case 9:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"getAllTournamentData",value:function(){return this.getInstance().tournamentData}},{key:"getTournamentDataById",value:function(e){return this.getInstance().tournamentData.find((function(t){return t.id===e}))}},{key:"getPlayerTournamentData",value:function(){var e=this.getInstance(),t=fu.getPlayerId();return e.tournamentData.filter((function(e){return e.payload.playerId===t}))}},{key:"getFriendsTournamentData",value:function(){var e=this.getInstance(),t=fu.getPlayerId();return e.tournamentData.filter((function(e){var n=e.payload;return n.playerId!==t&&"global"!==n.playerId}))}},{key:"getGlobalTournamentData",value:function(){return this.getInstance().tournamentData.filter((function(e){return"global"===e.payload.playerId}))}},{key:"validateTournamentExpired",value:function(e){var t=this.getTournamentDataById(e);return!!t&&t.endTime<Date.now()/1e3}}]),e}();n._RF.pop(),n._RF.push({},"d90c4WisP9LybAFqNuS6imZ","FailKeys",void 0);var yu,mu="time",gu="bomb";n._RF.pop(),n._RF.push({},"44b50YkamZDD5fO9vdZKeG7","InputController",void 0);var bu=(0,i.ccclass)("InputController")(yu=function(e){Ie(n,e);var t=Fe(n);function n(){var e;Te(this,n);for(var i=arguments.length,a=new Array(i),r=0;r<i;r++)a[r]=arguments[r];return(e=t.call.apply(t,[this].concat(a))).handleElementPointerDown=function(){},e.handleElementPointerUp=function(e){},e}return xe(n,[{key:"onLoad",value:function(){this.listenInputEvents()}},{key:"listenInputEvents",value:function(){j.os!==j.OS.WINDOWS&&j.os!==j.OS.OSX||(document.addEventListener("pointerup",this.handleElementPointerUp),document.addEventListener("pointerdown",this.handleElementPointerDown))}},{key:"onDestroy",value:function(){j.os!==j.OS.WINDOWS&&j.os!==j.OS.OSX||(document.removeEventListener("pointerup",this.handleElementPointerUp),document.removeEventListener("pointerdown",this.handleElementPointerDown))}}]),n}(f))||yu;n._RF.pop(),n._RF.push({},"7f144HjLfBLWbFvbRFCCt8e","Directions",void 0);var wu={Up:{x:0,y:1},Down:{x:0,y:-1},Left:{x:-1,y:0},Right:{x:1,y:0}};n._RF.pop(),n._RF.push({},"361eckT3VBO5ZFyetePNmNY","LevelGravity",void 0);var ku="fall-down",Su="fly-up",Eu="push-left",Cu="push-right",Tu="put-column-middle",Au="put-row-middle";function xu(e){for(var t=e.array,n=e.isLighter,i=e.out,a=void 0===i?new Set:i,r=0;r<t.length;r++)if(n(t.get(r)))for(var o=r+1;o<t.length;o++)if(!n(t.get(o))){t.swap(r,o),a.add(t.get(r));break}return a}n._RF.pop(),n._RF.push({},"cf506DevntPeIl9QrpMEBY0","Grid",void 0);var Ru=function(){function e(t){var n;Te(this,e),this.array=[];var i=null!=t?t:{},a=i.width,r=void 0===a?1:a,o=i.height,s=void 0===o?1:o,l=t instanceof e?t.array:null!==(n=null==t?void 0:t.content)&&void 0!==n?n:[];if(l.length!==r*s)throw new Error("Invalid content length");this.width=r,this.height=s,this.array=Ve(l)}return xe(e,[{key:"asArray",value:function(){return this.array}},{key:"get",value:function(e,t){return this.array[t*this.width+e]}},{key:"set",value:function(e,t,n){this.array[t*this.width+e]=n}},{key:"isInBounds",value:function(e,t){return e>=0&&e<this.width&&t>=0&&t<this.height}},{key:"forEach",value:function(e){for(var t=0;t<this.height;t++)for(var n=0;n<this.width;n++)e(this.get(n,t),n,t)}},{key:"map",value:function(e){for(var t=[],n=0;n<this.height;n++)for(var i=0;i<this.width;i++)t.push(e(this.get(i,n),i,n));return t}},{key:"reduce",value:function(e,t){for(var n=t,i=0;i<this.height;i++)for(var a=0;a<this.width;a++)n=e(n,this.get(a,i),a,i);return n}},{key:"swap",value:function(e,t){var n=He(e,2),i=n[0],a=n[1],r=He(t,2),o=r[0],s=r[1],l=this.get(i,a);this.set(i,a,this.get(o,s)),this.set(o,s,l)}},{key:"shuffle",value:function(e){for(var t,n=Ve(e=null!==(t=e)&&void 0!==t?t:this.map((function(e,t,n){return[t,n]}))),i=new Set,a=n.length-1;a>0;a--){var r=ee(0,a+1),o=[n[r],n[a]];n[a]=o[0],n[r]=o[1],i.add(this.get(n[a][0],n[a][1])),i.add(this.get(n[r][0],n[r][1]))}for(var s=0;s<n.length;s++){var l=He(e[s],2),u=l[0],c=l[1],h=He(n[s],2),p=h[0],d=h[1];this.swap([u,c],[p,d])}return i}},{key:"toShuffled",value:function(t){var n=new e({width:this.width,height:this.height,content:this.array}),i=n.shuffle(t);return[n,i]}},{key:"gravitate",value:function(e){var t=this,n=He(e.rowRange,2),i=n[0],a=n[1],r=He(e.colRange,2),o=r[0],s=r[1],l=e.direction,u=e.isLighter,c=e.onSwap,h=e.out,p=void 0===h?new Set:h,d=s-o+1,f=a-i+1;switch(l){case wu.Up:for(var v=function(e){xu({array:{length:f,get:function(n){return t.get(e,a-n)},swap:function(n,i){var r=t.get(e,a-n),o=t.get(e,a-i);t.swap([e,a-n],[e,a-i]),null==c||c(r,o)}},isLighter:u,out:p})},y=o;y<=s;y++)v(y);return p;case wu.Down:for(var m=function(e){xu({array:{length:f,get:function(n){return t.get(e,i+n)},swap:function(n,a){var r=t.get(e,i+n),o=t.get(e,i+a);t.swap([e,i+n],[e,i+a]),null==c||c(r,o)}},isLighter:u,out:p})},g=o;g<=s;g++)m(g);return p;case wu.Left:for(var b=function(e){xu({array:{length:d,get:function(n){return t.get(o+n,e)},swap:function(n,i){var a=t.get(o+n,e),r=t.get(o+i,e);t.swap([o+n,e],[o+i,e]),null==c||c(a,r)}},isLighter:u,out:p})},w=i;w<=a;w++)b(w);return p;case wu.Right:for(var k=function(e){xu({array:{length:d,get:function(n){return t.get(s-n,e)},swap:function(n,i){var a=t.get(s-n,e),r=t.get(s-i,e);t.swap([s-n,e],[s-i,e]),null==c||c(a,r)}},isLighter:u,out:p})},S=i;S<=a;S++)k(S);return p;default:throw new Error("Invalid direction")}}},{key:"toGravitated",value:function(){var t=new e({width:this.width,height:this.height,content:this.array}),n=t.gravitate.apply(t,arguments);return[t,n]}},{key:"toRotated",value:function(){for(var t=new e({width:this.height,height:this.width,content:new Array(this.width*this.height)}),n=0;n<this.height;n++)for(var i=0;i<this.width;i++)t.set(this.height-1-n,i,this.get(i,n));return t}}]),e}();n._RF.pop(),n._RF.push({},"4046cPYak1BDIVFKksVPsnk","index",void 0),n._RF.pop(),n._RF.push({},"c517dy1TKlPd7mHxulLPv1G","TileSpecialTypes",void 0);var Iu,Pu,_u,Lu,Ou,Du,Mu,Nu,Fu,Bu,Gu,zu,Uu,Hu,Vu,qu,Wu,Ku,ju,Yu,Xu,$u,Qu,Ju,Zu,ec={bomb:"bomb",star:"star",none:"none"};n._RF.pop(),n._RF.push({},"ea140gA27tJa4LD9MT3t93/","Tile",void 0);var tc=i.ccclass,nc=i.property,ic=i.requireComponent,ac=(Iu=tc("Tile"),Pu=ic([s]),_u=ic([N]),Lu=nc(A),Ou=nc(A),Du=nc(A),Mu=nc(a),Nu=nc({type:s,displayName:"Background's UI Transform"}),Fu=nc({type:N,displayName:"This UI Opacity"}),Bu=nc(N),Gu=nc(N),zu=nc(ua),Uu=nc(y),Iu(Hu=Pu(Hu=_u((qu=Xe((Vu=function(e){Ie(h,e);var t,n,i,a,r,o,s,l,u,c=Fe(h);function h(){var e;Te(this,h);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return Ye(e=c.call.apply(c,[this].concat(n)),"icon",qu,Me(e)),Ye(e,"bombComponent",Wu,Me(e)),Ye(e,"starComponent",Ku,Me(e)),Ye(e,"background",ju,Me(e)),Ye(e,"bgUITransform",Yu,Me(e)),Ye(e,"uiOpacity",Xu,Me(e)),Ye(e,"shineOpacity",$u,Me(e)),Ye(e,"glowOpacity",Qu,Me(e)),Ye(e,"button",Ju,Me(e)),Ye(e,"animationComponent",Zu,Me(e)),e.id=null,e.isEmpty=!1,e.coord=new Q,e.restoreSignal=new On,e}return xe(h,[{key:"onLoad",value:function(){kt.lazyValidateProperties(this),this.special=this.createSpecialHandler(ec.none)}},{key:"update",value:function(e){var t;(null===(t=this.special)||void 0===t?void 0:t.type)===ec.bomb&&this.special.update(e)}},{key:"onDestroy",value:function(){var e,t;(null===(e=this.special)||void 0===e?void 0:e.type)===ec.bomb&&(null===(t=this.special)||void 0===t||t.onDestroy())}},{key:"setIgnoreInput",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.button.interactable=!e}},{key:"getCoord",value:function(){return this.coord}},{key:"setCoord",value:function(e,t){this.coord.set(e,t)}},{key:"isSimilarTo",value:function(e){return this.id===e.id}},{key:"inSamePositionAs",value:function(e,t){return e instanceof h?this.coord.equals(e.getCoord()):this.coord.x===e&&this.coord.y===t}},{key:"isHidden",value:function(){return this.isEmpty}},{key:"getSize",value:function(){return[this.bgUITransform.width,this.bgUITransform.height]}},{key:"onClick",value:function(){this.isHidden()||this.node.scene.emit(pr.TILE_CLICK,this)}},{key:"setIdentity",value:function(e){this.id=e,this.icon.spriteFrame=e;var t=He(this.getSize(),2),n=t[0],i=t[1],a=e.originalSize,r=a.width,o=a.height,s=Math.max(r/(.7*n),o/(.7*i));s>1&&this.icon.node.setScale(new Y(1/s,1/s,1))}},{key:"setSpecialType",value:function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ec.none,n=arguments.length>1?arguments[1]:void 0;null===(e=this.special)||void 0===e||e.switch(t,n)}},{key:"setFocused",value:(u=Ce(Se().mark((function e(t){var n,i,a;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=S(this.shineOpacity).to(.2,{opacity:t?255:0},{easing:"quadIn"}),this.shineOpacity.node.scale=t?Y.ZERO:Y.ONE,i=S(this.shineOpacity.node).to(.2,{scale:t?Y.ONE:Y.ZERO},{easing:"quadOut"}),t?((a=S(this.glowOpacity).to(2,{opacity:150})).to(2,{opacity:20}),this.glowOpacityTween=S(this.glowOpacity).repeatForever(a).start()):(this.glowOpacityTween&&this.glowOpacityTween.stop(),this.glowOpacity.opacity=0),e.next=6,Promise.all([vn.runTweenAsync(n),vn.runTweenAsync(i)]);case 6:case"end":return e.stop()}}),e,this)}))),function(e){return u.apply(this,arguments)})},{key:"setEmpty",value:function(){var e,t,n=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.isEmpty){var i;if(this.restoreSignal.abort(),this.isEmpty=!0,this.setIgnoreInput(!0),this.button.resetButtonState(),n)return this.uiOpacity.opacity=0,void(null===(i=this.special)||void 0===i||i.switch(ec.none));(null===(e=this.special)||void 0===e?void 0:e.type)===ec.star&&this.special.clear(),null===(t=this.special)||void 0===t||t.switch(ec.none),this.uiOpacity.opacity=0}}},{key:"setHint",value:(l=Ce(Se().mark((function e(t){var n;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t){e.next=6;break}return e.next=3,this.loadShakeClip();case 3:this.shakeClip&&this.runAnimation(this.shakeClip.name),e.next=10;break;case 6:return this.animationComponent.stop(),n=S(this.background).to(.1,{scale:Y.ONE,eulerAngles:Y.ZERO}),e.next=10,vn.runTweenAsync(n);case 10:case"end":return e.stop()}}),e,this)}))),function(e){return l.apply(this,arguments)})},{key:"playClearFX",value:(s=Ce(Se().mark((function e(t){var n;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=null,"clear"!==t){e.next=7;break}return e.next=4,this.loadClearClip();case 4:n=this.clearClip,e.next=10;break;case 7:return e.next=9,this.loadBreakClip();case 9:n=this.breakClip;case 10:if(null===n){e.next=13;break}return e.next=13,this.runAnimation(n.name);case 13:case"end":return e.stop()}}),e,this)}))),function(e){return s.apply(this,arguments)})},{key:"restore",value:(o=Ce(Se().mark((function e(t){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.restoreSignal.abort(),this.restoreSignal=new On,this.isEmpty=!1,this.setIgnoreInput(!0),t&&this.setIdentity(t),this.uiOpacity.opacity=255,this.node.setScale(Y.ZERO),this.button.fakeClick(),e.next=10,vn.runTweenAsync(S(this.node).to(.3,{scale:Y.ONE},{easing:"backOut"}),this.restoreSignal);case 10:this.node.setScale(Y.ONE),this.setIgnoreInput(!1);case 12:case"end":return e.stop()}}),e,this)}))),function(e){return o.apply(this,arguments)})},{key:"sync",value:(r=Ce(Se().mark((function e(t){var n,i,a,r,o,s,l,u,c;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.duration,i=void 0===n?.3:n,a=t.delay,r=void 0===a?0:a,o=t.easing,s=void 0===o?"cubicOut":o,l=t.getTargetPosition,u=l(this.coord),c=new Y(u.x,u.y,this.node.position.z),e.next=5,vn.runTweenAsync(S(this.node).delay(r).to(i,{position:c},{easing:s}));case 5:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"fly",value:(a=Ce(Se().mark((function e(t){var n,i,a,r,o,s,l,u,c,h,p,d,f,v,y,m,g,b=this;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=300,i=Math.sqrt(Math.pow(this.node.position.x,2)+Math.pow(this.node.position.y,2)),a=Math.max(n-.7*i,0),r=i/1e3,o=this.node.position.clone(),s=t.getTilePosition(this.coord),l=new Y(s.x,s.y,this.node.position.z),u=this.background,c=2,h=1,p=360,d=.0025*a,f=0,v=new Y(0,0,0),y=.75-d,(g=S(m={value:0,prevElapsed:0})).delay(r),g.to(.5,{value:0},{progress:function(e,t,n,i){var a=(c*=-1)*i,r=o.clone();return r.x+=a,b.node.setPosition(r),n}}),g.to(d,{value:1},{progress:function(e,t,i,r){var o=vn.easeOutExpo(r),s=d*r-m.prevElapsed,l=d*r,c=a*o;b.setHeight(c,n);var f=b.node.position.clone();h+=.1,Y.rotateZ(f,f,new Y(0,0,0),h*Math.PI*s),b.node.setPosition(new Y(f.x,f.y,f.z));var v=(p+=10)*s;return u.angle+=v,m.prevElapsed=l,i}}),g.call((function(){v.set((b.node.position.x+l.x)/2,(b.node.position.y+l.y)/2,0),m.prevElapsed=0,u.angle%=360,u.angle-=360,f=u.angle})),g.to(y,{value:0},{progress:function(e,t,i,r){var o=y*r-m.prevElapsed,s=y*r,l=a*(1-r);b.setHeight(l,n);var c=b.node.position.clone();return Y.rotateZ(c,c,v,Math.PI/y*o),b.node.setPosition(new Y(c.x,c.y,c.z)),u.angle+=-f/y*o,m.prevElapsed=s,i}}),g.call((function(){b.node.setPosition(l),b.setHeight(0,n),u.angle=0})),e.abrupt("return",vn.runTweenAsync(g));case 25:case"end":return e.stop()}}),e,this)}))),function(e){return a.apply(this,arguments)})},{key:"loadBreakClip",value:(i=Ce(Se().mark((function e(){var t;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.breakClip){e.next=2;break}return e.abrupt("return",Promise.resolve());case 2:return e.next=4,ai.loadAnimClipAsync(Dn.TILE_BREAK_ANIM);case 4:if(t=e.sent){e.next=7;break}return e.abrupt("return",Promise.resolve());case 7:this.breakClip=t,this.animationComponent.addClip(this.breakClip);case 9:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"loadClearClip",value:(n=Ce(Se().mark((function e(){var t;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.clearClip){e.next=2;break}return e.abrupt("return",Promise.resolve());case 2:return e.next=4,ai.loadAnimClipAsync(Dn.TILE_CLEAR_ANIM);case 4:if(t=e.sent){e.next=7;break}return e.abrupt("return",Promise.resolve());case 7:this.clearClip=t,this.animationComponent.addClip(this.clearClip);case 9:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"loadShakeClip",value:(t=Ce(Se().mark((function e(){var t;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.shakeClip){e.next=2;break}return e.abrupt("return",Promise.resolve());case 2:return e.next=4,ai.loadAnimClipAsync(Dn.TILE_SHAKE_ANIM);case 4:if(t=e.sent){e.next=7;break}return e.abrupt("return",Promise.resolve());case 7:this.shakeClip=t,this.animationComponent.addClip(this.shakeClip);case 9:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"runAnimation",value:function(e){var t=this;return this.animationComponent.play(e),new Promise((function(e){t.animationComponent.once(y.EventType.FINISHED,(function(){e()}))}))}},{key:"setHeight",value:function(e,t){var n=this.background;n.setPosition(new Y(n.position.x,e,0)),n.setScale(new Y(1+e/t*.3,1+e/t*.3,1))}},{key:"createSpecialHandler",value:function(e,t){var n=this;switch(e){case ec.bomb:return this.createBombHandler(null!=t?t:90);case ec.star:return this.createStarHandler();default:return{type:ec.none,switch:function(e,t){n.special=n.createSpecialHandler(e,t)}}}}},{key:"createBombHandler",value:function(e){var t=this,n=!1,i=e,a=function(){n=!0},r=function(){n=!1};this.node.scene.on(pr.TILE_CLICK,a),this.node.scene.on(pr.USE_ITEM,a),this.node.scene.on(pr.RESUME_TIME,a),this.node.scene.on(pr.PAUSE_TIME,r),this.node.scene.on(pr.TIME_OUT,r),this.bombComponent.node.active=!0;var o=function(){n=!1,t.bombComponent.node.active=!1,i=e,t.node.scene.off(pr.TILE_CLICK,a),t.node.scene.off(pr.USE_ITEM,a),t.node.scene.off(pr.GAME_RESUME,a),t.node.scene.off(pr.GAME_PAUSE,r),t.node.scene.off(pr.TIME_OUT,r)};return{type:ec.bomb,update:function(a){n&&(i-=a,t.bombComponent.fillRange=-i/e,i<=0&&(n=!1,t.bombComponent.node.active=!1,t.node.scene.emit(pr.BOMB_EXPLODE,t),t.setEmpty()))},cleanup:o,onDestroy:function(){t.node.scene.off(pr.TILE_CLICK,a),t.node.scene.off(pr.USE_ITEM,a),t.node.scene.off(pr.GAME_RESUME,a),t.node.scene.off(pr.GAME_PAUSE,r),t.node.scene.off(pr.TIME_OUT,r)},switch:function(e,n){o(),t.special=t.createSpecialHandler(e,n)},detonateImmediately:function(){i=0}}}},{key:"createStarHandler",value:function(){var e=this;this.starComponent.node.active=!0;var t=function(){e.starComponent.node.active=!1};return{type:ec.star,clear:function(){e.starComponent.node.active=!1;var t=e.node.worldPosition,n=t.x,i=t.y;e.node.scene.emit(pr.ADD_STARS,{startAnimationAt:[n,i]})},cleanup:t,switch:function(n){t(),e.special=e.createSpecialHandler(n)}}}}]),h}(f)).prototype,"icon",[Lu],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Wu=Xe(Vu.prototype,"bombComponent",[Ou],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ku=Xe(Vu.prototype,"starComponent",[Du],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ju=Xe(Vu.prototype,"background",[Mu],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Yu=Xe(Vu.prototype,"bgUITransform",[Nu],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Xu=Xe(Vu.prototype,"uiOpacity",[Fu],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),$u=Xe(Vu.prototype,"shineOpacity",[Bu],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Qu=Xe(Vu.prototype,"glowOpacity",[Gu],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ju=Xe(Vu.prototype,"button",[zu],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Zu=Xe(Vu.prototype,"animationComponent",[Uu],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Hu=Vu))||Hu)||Hu)||Hu);function rc(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a=n.x,r=n.y,o=He(t,2),s=o[0],l=o[1],u=s*(a-(e.width-1)/2)+i*(a-e.width/2),c=l*(r-(e.height-1)/2)+i*(r-e.height/2);return-1===a&&(u+=t[0]/4),a===e.width&&(u-=t[0]/4),-1===r&&(c+=t[1]/4),r===e.height&&(c-=t[1]/4),{x:u,y:c}}function oc(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0],n=He(e,2),i=n[0],a=n[1],r=He(t,2),o=r[0],s=r[1],l=1-o,u=1-s,c=i*l,h=a*u;return[c,h]}function sc(e){for(var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=e.split("-"),i=[],a=0;a<n.length;){var r=null,o=n[a];switch(o){case"normal":a+=1;break;case"fall":r=ku,a+=2;break;case"fly":r=Su,a+=2;break;case"push":"left"===n[a+1]?(r=Eu,a+=2):(r=Cu,a+=2);break;case"put":"columns"===n[a+1]?(r=Tu,a+=3):(r=Au,a+=3)}r&&(t&&(r=lc(r)),i.push(r))}return i}function lc(e){switch(e){case ku:return Cu;case Su:return Eu;case Eu:return ku;case Cu:return Su;case Tu:return Au;case Au:return Tu}}function uc(e){return(e instanceof Ru?e.asArray():e).filter((function(e){return!e.isHidden()}))}function cc(e){return(e instanceof Ru?e.asArray():e).filter((function(e){return e.isHidden()}))}function hc(e,t){var n=t.getCoord(),i=n.x,a=n.y;return Object.values(wu).reduce((function(t,n){var r=n.x,o=n.y,s=i+r,l=a+o;return e.isInBounds(s,l)&&t.push(e.get(s,l)),t}),[])}function pc(e){return Array.isArray(e)}function dc(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Date.now(),n=pc(e)?e:e.asArray();return n[te(t,0,n.length)]}function fc(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Date.now(),n=e instanceof Ru?e.asArray():e,i=dc(n,t),a=n.find((function(e){return e.isSimilarTo(i)&&!e.inSamePositionAs(i)}));if(void 0===a)throw new Error("Could not find a matching tile");return[i,a]}n._RF.pop(),n._RF.push({},"d6995j9hvVJYKs6vvV+rs1I","index",void 0),n._RF.pop(),n._RF.push({},"cb8ddC2w59DpqVoQENbYYcU","calcBoardScale",void 0),n._RF.pop(),n._RF.push({},"305c7LJx+ROLI4g8tTiAFyb","calcTilePosition",void 0),n._RF.pop(),n._RF.push({},"c522ca1UPhDYaToWf66t1X2","calcTileSize",void 0),n._RF.pop(),n._RF.push({},"37667B66RZBc5chlMqN6mH8","parseLevelGravity",void 0),n._RF.pop(),n._RF.push({},"f0f0bXgdxJHIJWOmA6n0Ood","getUncleared",void 0),n._RF.pop(),n._RF.push({},"a90bcq22hlMzbYdivjPpm0h","getBombTiles",void 0),n._RF.pop(),n._RF.push({},"92e23drVfRIgbDVZLTSdEkI","getCleared",void 0),n._RF.pop(),n._RF.push({},"7105bfR+Y5F1a0SDiMXZ9mV","getNearbyTiles",void 0),n._RF.pop(),n._RF.push({},"d1b9bBg+dBA+7n/Sz+RCIAX","getRandomTile",void 0),n._RF.pop(),n._RF.push({},"c4bf3uyS1pEdrTrwDEXeuZP","getRandomPair",void 0),n._RF.pop(),n._RF.push({},"cf8d6gfx2ZIsqm978cNLWaV","pseudoRandomIterable",void 0);var vc=function(e){return e};function yc(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:vc;return Se().mark((function i(){var a,r;return Se().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:a=t,e<=0&&(e=1/0),r=0;case 3:if(!(r<e)){i.next=10;break}return i.next=6,n(a);case 6:a=1e9*ne(a);case 7:r++,i.next=3;break;case 10:case"end":return i.stop()}}),i)}))()}function mc(e){return Array.isArray(e)}function gc(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Date.now(),i=mc(e)?e:e.asArray();if(i.length<t)return new Set(i);for(var a=new Set,r=yc(-1,n),o=r.next();a.size<t;){if(o.done)throw new Error("RNG exhausted");a.add(dc(i,o.value)),o=r.next()}return a}n._RF.pop(),n._RF.push({},"718b6Wu0pdGVK5KYSUDctVX","getRandomTiles",void 0),n._RF.pop(),n._RF.push({},"17ccarKybRNwYcZnBQhCUYy","index",void 0),n._RF.pop(),n._RF.push({},"bab6dqrPz9AaaBN5cy+QzPj","assignSpecialTiles",void 0);var bc=[1,4];function wc(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Date.now(),i=t.specials,a=i.bomb,r=te.apply(void 0,[n].concat(bc)),o=gc(e,a,n),s=e.asArray().filter((function(e){return!o.has(e)})),l=gc(s,r,n);o.forEach((function(e){var n=2*t.time/3;e.setSpecialType(ec.bomb,n)})),l.forEach((function(e){return e.setSpecialType(ec.star)}))}function kc(e){var t=e.levelData,n=t.columns,i=t.rows,a=e.identities,r=e.createTile,o=e.seed,s=function(e,t,n){var i,a=[],r=Ke(yc(t/2,e,(function(e){return te(e,0,n.length)})));try{for(r.s();!(i=r.n()).done;){var o=i.value;a.push(n[o]),a.push(n[o])}}catch(e){r.e(e)}finally{r.f()}return GameCore.Utils.Array.shuffle(a),a}(void 0===o?Date.now():o,n*i,a).map((function(e){var t=r(e);return t.setIdentity(e),t}));return new Ru({width:n,height:i,content:s})}function Sc(e){var t=e.customFen,n=e.identities,i=e.createTile,a=t.idSize,r=t.cols,o=t.rows,s=t.code;if(n.length<t.idSize)throw new Error(`Invalid grid code. There are not enough identities/frames ${n.length} to fill it according to fen code ${a}`);var l=s.split(":");if(l.length!==o)throw new Error("Invalid grid code");var u=/[a-zA-Z]+\d+|./g,c=/[a-zA-Z]+/,h=/\d+/,p=l.reduceRight((function(e,a){var r,o=[],s=Ke(a.matchAll(u));try{for(s.s();!(r=s.n()).done;){var l,p,d=r.value[0],f=null===(l=h.exec(d))||void 0===l?void 0:l[0],v=f?parseInt(f,10):void 0,y=v&&v<n.length?n[v]:void 0,m=i(y||n[0]),g=null===(p=c.exec(d))||void 0===p?void 0:p[0],b=g?Ec(g,t.encoding):void 0;b&&y?m.setSpecialType(b):m.setEmpty(),o.push(m)}}catch(e){s.e(e)}finally{s.f()}return e.concat(o)}),[]);return new Ru({width:r,height:o,content:p})}function Ec(e,t){var n=Object.entries(t).find((function(t){var n=He(t,2);n[0];return n[1]===e}));if(void 0===n)throw new Error(`Invalid special type ${e}`);return n[0]}function Cc(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Date.now(),n=e.asArray(),i=dc(e,t),a=hc(e,i);if(!a.some((function(e){return e.isSimilarTo(i)}))){var r=dc(a,t),o=n.find((function(e){return!e.inSamePositionAs(i)&&!e.inSamePositionAs(r)&&e.isSimilarTo(r)}));o.setIdentity(i.id),r.setIdentity(i.id)}}n._RF.pop(),n._RF.push({},"228efPdzUNCMp4yYcBs9r+3","index",void 0),n._RF.pop(),n._RF.push({},"09be7lmGLNMvIObiqskePhz","createGrid",void 0),n._RF.pop(),n._RF.push({},"5d998xlab9FLIpvw+sXMIYw","createGridFromFen",void 0),n._RF.pop(),n._RF.push({},"30de5d+cW5OjKyEubKVREbU","createRotatedGrid",void 0),n._RF.pop(),n._RF.push({},"9ceb6vNbn9PKozkdGjjZD67","ensureOneMatch",void 0),n._RF.pop(),n._RF.push({},"89318H0TDxMlJsVFwuKgrh3","index",void 0),n._RF.pop(),n._RF.push({},"fb4a9VOCxBBvpXFCcSt4P3J","NewbieSteps",void 0);var Tc=[{startTile:{x:0,y:1},endTile:{x:3,y:1},description:"Tap to connect"},{startTile:{x:2,y:2},endTile:{x:3,y:0},description:"Connect similar tiles with less than 2 turns"},{startTile:{x:0,y:0},endTile:{x:3,y:3},description:"Connect similar tiles with less than 2 turns"},{startTile:{x:0,y:4},endTile:{x:2,y:3},description:"More than 2 turns are NOT allowed"},{startTile:{x:1,y:4},endTile:{x:1,y:2},description:"There's obstacle between the tiles"}];function Ac(e,t){return e[0]===t[0]&&e[1]===t[1]}function xc(e){return new Q(e[0],e[1])}function Rc(e,t){return e.x>=-1&&e.x<t.width+1&&e.y>=-1&&e.y<t.height+1}function Ic(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Pc;return t.map((function(t){return[e.tile[0]+t.x,e.tile[1]+t.y]}))}n._RF.pop(),n._RF.push({},"627d5N3oStP8q9+ABNqnHBq","getBestPath",void 0);var Pc=[wu.Up,wu.Down,wu.Left,wu.Right],_c=function(){function e(t,n){var i;if(Te(this,e),this.f=0,this.g=0,this.h=0,n&&Ac(t,n.tile))throw new Error("Tile cannot be its own parent");this.tile=t,this.parent=n;var a=e.calcDirection(this),r=n&&a&&n.cache.direction&&!a.equals(n.cache.direction)?1:0;this.cache={direction:a,turns:r+(null!==(i=null==n?void 0:n.cache.turns)&&void 0!==i?i:0)}}return xe(e,[{key:"getKey",value:function(){var e;return`x:${this.tile[0]},y:${this.tile[1]},d:${null===(e=this.cache.direction)||void 0===e?void 0:e.toString()}`}},{key:"equals",value:function(e){return this.getKey()===e.getKey()}}],[{key:"calcDirection",value:function(e){if(e.parent){var t=e.parent.tile,n=e.tile;return new Q(n[0]-t[0],n[1]-t[1])}return null}}]),e}();function Lc(e,t){var n=e.tile,i=t.tile;return Math.abs(n[0]-i[0])+Math.abs(n[1]-i[1])}function Oc(e,t){var n,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],a=[],r=Ke(Pc);try{var o=function(){var r=n.value,o={x:t[0]+r.x,y:t[1]+r.y};if(e.isInBounds(o.x,o.y))return(e.get(o.x,o.y).isHidden()||i.find((function(e){return Ac(e,[o.x,o.y])})))&&a.push(r),1;Rc(o,e)&&a.push(r)};for(r.s();!(n=r.n()).done;)o()}catch(e){r.e(e)}finally{r.f()}return a}function Dc(e,t,n,i){if(i){var a=Tc[4].startTile,r=Tc[4].endTile;if(t[0]===a.x&&t[1]===a.y&&n[0]===r.x&&n[1]===r.y)return[{a:a,b:r}];if(t[0]===r.x&&t[1]===r.y&&n[0]===a.x&&n[1]===a.y)return[{a:a,b:r}]}return function(e,t,n){var i=[],a=[],r=new _c(t,null),o=new _c(n,null),s=[o.tile];for(i.push(r);i.length>0;){var l=i.shift();if(a.push(l),Ac(l.tile,o.tile)){for(var u=[],c=l,h=l,p=l.parent;p;)p.cache.turns!==h.cache.turns&&(u.unshift({a:xc(p.tile),b:xc(c.tile)}),c=p),h=p,p=p.parent;return u.unshift({a:xc(h.tile),b:xc(c.tile)}),u}var d,f=Ke(Ic(l,Oc(e,l.tile,s)));try{var v=function(){var e=d.value,t=new _c(e,l);if(t.cache.turns>8)return 0;var n=Ac(t.tile,o.tile),r=a.some((function(e){return e.equals(t)}));if(i.some((function(e){return e.equals(t)}))||r&&!n)return 0;t.g=l.g+1+t.cache.turns,t.h=Lc(t,o),t.f=t.g+t.h,i.push(t)};for(f.s();!(d=f.n()).done;)v()}catch(e){f.e(e)}finally{f.f()}i.sort((function(e,t){return e.f-t.f}))}var y=r.tile,m=o.tile;return y[0]===m[0]||y[1]===m[1]?[{a:xc(y),b:xc(m)}]:[{a:xc(y),b:{x:y[0],y:m[1]}},{a:{x:y[0],y:m[1]},b:xc(m)}]}(e,t,n)}n._RF.pop(),n._RF.push({},"b622ea7Aw5LT5yfRAx8qSap","getErrorPath",void 0),n._RF.pop(),n._RF.push({},"716f6/ILpZCPp1nebbdk8Oj","getGridFen",void 0);var Mc={[ec.bomb]:"b",[ec.star]:"s",[ec.none]:"t"};function Nc(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Mc,n=e.width,i=e.height,a=[],r=new Map,o=i-1;o>=0;o--){for(var s=[],l=0;l<n;l++){var u,c,h=e.get(l,o),p=h.isHidden()?null:h.id;if(null!==p){var d=null!==(u=null===(c=h.special)||void 0===c?void 0:c.type)&&void 0!==u?u:ec.none,f=t[d];if(!r.has(p)){var v=r.size.toString();r.set(p,v)}var y=`${f}${r.get(p)}`;s.push(y)}else s.push(".")}a.push(s.join(""))}return{code:a.join(":"),idSize:r.size,encoding:t,rows:i,cols:n}}function Fc(e){return e.reduce((function(e,t,n,i){return t.inSamePositionAs(n,i)||e.push([t,[n,i]]),e}),[])}n._RF.pop(),n._RF.push({},"badfeEqwgFEorJVHO9tJSXZ","getOutOfSync",void 0),n._RF.pop();var Bc=Se().mark(Gc);function Gc(e,t){var n,i,a,r,o,s,l,u;return Se().wrap((function(c){for(;;)switch(c.prev=c.next){case 0:n=0,i=e-1,a=0,r=t-1;case 4:if(!(n<=i&&a<=r)){c.next=39;break}o=n;case 6:if(!(o<=i)){c.next=12;break}return c.next=9,{x:o,y:a};case 9:o++,c.next=6;break;case 12:a++,s=a;case 14:if(!(s<=r)){c.next=20;break}return c.next=17,{x:i,y:s};case 17:s++,c.next=14;break;case 20:i--,l=i;case 22:if(!(l>=n)){c.next=28;break}return c.next=25,{x:l,y:r};case 25:l--,c.next=22;break;case 28:r--,u=r;case 30:if(!(u>=a)){c.next=36;break}return c.next=33,{x:n,y:u};case 33:u--,c.next=30;break;case 36:n++,c.next=4;break;case 39:case"end":return c.stop()}}),Bc)}n._RF.push({},"cd0d548/WxD7KCyW2hwySVO","traverseSpiralIn",void 0),n._RF.pop(),n._RF.push({},"373ceVkYCtMTrQObvzJgg7s","getValidPath",void 0);var zc,Uc,Hc,Vc,qc,Wc,Kc,jc,Yc,Xc,$c=function(){function e(t,n){Te(this,e),this.coord=new Q(t,n)}return xe(e,[{key:"isHidden",value:function(){return!0}},{key:"isSimilarTo",value:function(){return!1}}]),e}();function Qc(e){return new Q(e[0],e[1])}function Jc(e,t,n){if(void 0===t||void 0===n)return function(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Gc,i=[],a=Ke(n(e.width,e.height));try{for(a.s();!(t=a.n()).done;){var r=t.value,o=e.get(r.x,r.y);o.isHidden()||i.push([o,[r.x,r.y]])}}catch(e){a.e(e)}finally{a.f()}var s,l=[],u=function(){var t=He(i.shift(),2),n=t[0],a=t[1];if(l.find((function(e){return th(e,a)})))return 0;l.push(a);for(var r,o=function(){var t=He(u[s],2),i=t[0],r=t[1];if(!i.isSimilarTo(n)||l.find((function(e){return th(e,r)})))return 0;var o=Jc(e,a,r);return null!==o?{v:{v:o}}:void 0},s=0,u=i;s<u.length;s++)if(0!==(r=o())&&r)return r.v};for(;i.length>0;)if(0!==(s=u())&&s)return s.v;return null}(e);var i,a=[t[0]+1,t[1]+1],r=[n[0]+1,n[1]+1],o=function(e){var t=new Array(e.width+2).fill(null).map((function(e,t){return new $c(t-1,-1)})),n=new Array(e.width+2).fill(null).map((function(t,n){return new $c(n-1,e.height)})),i=new Array(e.height).fill(null).map((function(e,t){return new $c(-1,t)})),a=new Array(e.height).fill(null).map((function(t,n){return new $c(e.width,n)})),r=function(r,o){var s=r-1,l=o-1;return-1===s?i[l]:s===e.width?a[l]:-1===l?t[s]:l===e.height?n[s]:e.get(s,l)};return{get:(e,t)=>r(e,t),width:e.width+2,height:e.height+2}}(e),s=[a,r];if(a[0]===r[0]&&ih(o,s,a[1],r[1],a[0])||a[1]===r[1]&&ah(o,s,a[0],r[0],a[1]))return sh([{a:Qc(a),b:Qc(r)}],{x:-1,y:-1});var l=a[1]<=r[1]?a:r,u=a[1]<=r[1]?r:a,c=a[0]<=r[0]?a:r,h=a[0]<=r[0]?r:a,p=[],d=[];return-1===(i=rh(o,s,1,Qc(l),Qc(u)))&&-1===(i=rh(o,s,-1,Qc(l),Qc(u)))||(p=[{a:Qc(a),b:{x:a[0],y:i}},{a:{x:a[0],y:i},b:{x:r[0],y:i}},{a:{x:r[0],y:i},b:Qc(r)}]),-1===(i=oh(o,s,1,Qc(c),Qc(h)))&&-1===(i=oh(o,s,-1,Qc(c),Qc(h)))||(p=[{a:Qc(a),b:{x:i,y:a[1]}},{a:{x:i,y:a[1]},b:{x:i,y:r[1]}},{a:{x:i,y:r[1]},b:Qc(r)}]),-1!==(i=function(e,t,n,i){for(var a=n.y+1;a<i.y;a++)if(ih(e,t,n.y,a,n.x)&&ah(e,t,n.x,i.x,a)&&ih(e,t,a,i.y,i.x))return a;return-1}(o,s,Qc(l),Qc(u)))?d=[{a:Qc(a),b:{x:a[0],y:i}},{a:{x:a[0],y:i},b:{x:r[0],y:i}},{a:{x:r[0],y:i},b:Qc(r)}]:-1!==(i=function(e,t,n,i){for(var a=n.x+1;a<i.x;a++)if(ah(e,t,n.x,a,n.y)&&ih(e,t,n.y,i.y,a)&&ah(e,t,a,i.x,i.y))return a;return-1}(o,s,Qc(c),Qc(h)))&&(d=[{a:Qc(a),b:{x:i,y:a[1]}},{a:{x:i,y:a[1]},b:{x:i,y:r[1]}},{a:{x:i,y:r[1]},b:Qc(r)}]),p.length>0&&d.length>0?sh(Zc(p)<=Zc(d)?p:d,{x:-1,y:-1}):p.length>0?sh(p,{x:-1,y:-1}):d.length>0?sh(d,{x:-1,y:-1}):null}function Zc(e){var t,n=0,i=Ke(e);try{for(i.s();!(t=i.n()).done;){n+=eh(t.value)}}catch(e){i.e(e)}finally{i.f()}return n}function eh(e){return e.a.x===e.b.x?Math.abs(e.a.y-e.b.y):e.a.y===e.b.y?Math.abs(e.a.x-e.b.x):0}function th(e,t){return e[0]===t[0]&&e[1]===t[1]}function nh(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],i=e.get.apply(e,Ve(t));return i.isHidden()||n.some((function(e){return th(e,t)}))}function ih(e,t,n,i,a){for(var r=Math.min(n,i),o=Math.max(n,i),s=r;s<=o;s++)if(!nh(e,[a,s],t))return!1;return!0}function ah(e,t,n,i,a){for(var r=Math.min(n,i),o=Math.max(n,i),s=r;s<=o;s++)if(!nh(e,[s,a],t))return!1;return!0}function rh(e,t,n,i,a){var r=1===n?a.y:i.y,o=1===n?i.x:a.x;if(ih(e,t,i.y,a.y,o))for(;r>=0&&r<e.height&&nh(e,[i.x,r],t)&&nh(e,[a.x,r],t);){if(ah(e,t,i.x,a.x,r))return r;r+=n}return-1}function oh(e,t,n,i,a){var r=1===n?a.x:i.x,o=1===n?i.y:a.y;if(ah(e,t,i.x,a.x,o))for(;r>=0&&r<e.width&&nh(e,[r,i.y],t)&&nh(e,[r,a.y],t);){if(ih(e,t,i.y,a.y,r))return r;r+=n}return-1}function sh(e,t){return e.map((function(e){return{a:{x:e.a.x+t.x,y:e.a.y+t.y},b:{x:e.b.x+t.x,y:e.b.y+t.y}}}))}n._RF.pop(),n._RF.push({},"0cceagmIDZNoZTxP8hBPplh","Board",void 0);var lh,uh=i.ccclass,ch=i.property,hh=i.requireComponent,ph=globalThis.game.monitorError,dh=(zc=uh("Board"),Uc=hh(s),Hc=ch(ac),Vc=ch(a),qc=ch({displayName:"Tile Spacing",group:"Create config"}),zc(Wc=Uc((jc=Xe((Kc=function(e){Ie(a,e);var t,n,i=Fe(a);function a(){var e;Te(this,a);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return Ye(e=i.call.apply(i,[this].concat(n)),"tilePrefab",jc,Me(e)),Ye(e,"tilesHolder",Yc,Me(e)),Ye(e,"tileTrim",Xc,Me(e)),e.tileSize=[0,0],e.selectedTile=null,e.layoutType="portrait",e.parsedGravityRules=[],e.normalMatches=0,e.normalMatchesSinceLastSpawn=0,e.spawnAttempts=0,e.hintPath=null,e.hintTiles=null,e.animationQueue=[],e.isConsumingAnimation=!1,e.handleViewResized=function(){e.updateTilesHolderScale()},e.onLayoutChanged=function(t){e.layoutType=t},e}return xe(a,[{key:"onLoad",value:function(){this.uiTransform=this.getComponent(s),kt.lazyValidateProperties(this),this.tilePrefab.node.active=!1,this.listenLayoutevents()}},{key:"onDestroy",value:function(){this.unlistenLayoutevents()}},{key:"create",value:function(e,t){var n=this,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Date.now(),a=Ve(e);GameCore.Utils.Array.shuffle(a),e=a.slice(0,t.colors),this.levelData=t,this.parsedGravityRules=sc(t.mode,this.layoutType===Ra.Landscape);var r=function(e){var t=l(n.tilePrefab.node),i=t.getComponent(ac);return i.setIdentity(e),n.tilesHolder.addChild(t),t.active=!0,i},o=!1;if(void 0!==t.customFen)try{o=!0,this.grid=Sc({customFen:t.customFen,identities:e,createTile:r}),this.grid.forEach((function(e,t,n){e.setCoord(t,n),e.setIgnoreInput(!1),e.node.setSiblingIndex(0)}))}catch(e){console.error("Error creating grid from custom fen",e,"falling back to random grid"),o=!1}o||(this.grid=kc({levelData:t,seed:i,identities:e,createTile:r}),this.grid.forEach((function(e,t,n){e.setCoord(t,n),e.setIgnoreInput(!1),e.node.setSiblingIndex(0)})),Cc(this.grid,i),wc(this.grid,t,i)),this.handleBoardLayout();var s=[this.tileTrim.x,this.tileTrim.y];this.tileSize=oc(this.tilePrefab.getSize(),s),this.updateTilesHolderScale(),this.node.scene.emit(pr.GRID_CREATE,this),this.selectedTile=null,this.animationQueue=[],this.normalMatches=0,this.normalMatchesSinceLastSpawn=0,this.spawnAttempts=0,this.hintPath=null,this.processGameplayCycle()}},{key:"updateTilesHolderScale",value:function(){if(this.grid){var e=[this.grid.width,this.grid.height],t=[this.uiTransform.width,this.uiTransform.height],n=function(e,t,n){var i=He(e,2),a=i[0],r=i[1],o=He(t,2),s=o[0],l=o[1],u=He(n,2),c=u[0]/(a*s),h=u[1]/(r*l);return Math.min(c,h)}(e,this.tilePrefab.getSize(),t);this.tilesHolder.setScale(n,n),this.node.scene.emit(pr.GRID_RESIZE,n)}}},{key:"handleBoardLayout",value:function(){var e,t;this.layoutType===Ra.Landscape&&0!==this.levelData.level&&(this.grid=(e=this.grid,(t=e.toRotated()).forEach((function(e,t,n){e.setCoord(t,n)})),t))}},{key:"destroyTiles",value:function(){var e;null===(e=this.grid)||void 0===e||e.forEach((function(e){return e.node.destroy()}))}},{key:"animateTilesAppear",value:function(){var e=this,t=function(t,n){var i=Q.ZERO.clone();return e.parsedGravityRules.forEach((function(a){var r=e.getPrimitiveDirection(t,n,a);i.subtract2f(r.x,r.y)})),i.normalize()};return new Promise((function(n){var i=function(){var i=Ce(Se().mark((function i(){return Se().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,Promise.all(e.grid.map((function(n,i,a){var r=ie(0,.5),o=n.node.scale.clone(),s=t(i,a),l=rc(e.grid,e.tileSize,{x:i,y:a}),u=s.multiplyScalar(100).add2f(l.x,l.y);return n.node.setPosition(u.x,u.y),n.node.setScale(0,0),Promise.all([vn.runTweenAsync(S(n.node).delay(r).to(.5,{scale:o},{easing:"elasticOut"})),n.sync({getTargetPosition:function(t){return rc(e.grid,e.tileSize,t)},easing:"backOut",duration:.5,delay:r})])})));case 2:n();case 3:case"end":return i.stop()}}),i)})));return function(){return i.apply(this,arguments)}}();e.animationQueue.push(i),e.consumeAnimationQueue()}))}},{key:"handleTileClick",value:function(e){if(!e.isHidden()){if(this.selectedTile===e)return this.selectedTile=null,void e.setFocused(!1);if(!this.selectedTile)return this.selectedTile=e,void e.setFocused(!0);if(!this.selectedTile.isSimilarTo(e))return this.selectedTile.setFocused(!1),this.selectedTile=e,void e.setFocused(!0);this.selectedTile.setFocused(!1),this.match(this.selectedTile,e),this.selectedTile=null}}},{key:"clearSelectedTile",value:function(){this.selectedTile&&(this.selectedTile.setFocused(!1),this.selectedTile=null)}},{key:"match",value:function(e,t){var n=[e.getCoord().x,e.getCoord().y],i=[t.getCoord().x,t.getCoord().y],a=Jc(this.grid,n,i);if(null===a){bi.playSound(ui.INVALID_MATCH),this.shakeGrid();var r=0===this.levelData.level,o=Dc(this.grid,n,i,r);return this.node.scene.emit(pr.GRID_MATCH,[e,t]),void this.node.scene.emit(pr.GRID_MATCH_FAIL,o)}this.node.scene.emit(pr.GRID_MATCH,[e,t]),this.node.scene.emit(pr.GRID_MATCH_SUCCESS,a,[e,t]),this.clear([[e,t]],"clear")}},{key:"clear",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"clear";this.normalMatches+=e.length,e.forEach((function(e){var i=He(e,2),a=i[0],r=i[1];a.setEmpty(),r.setEmpty(),a.playClearFX(n),r.playClearFX(n),t.node.scene.emit(pr.GRID_CLEAR,[a,r])})),this.processGameplayCycle()}},{key:"showHint",value:function(){if(this.hintPath){var e=this.hintPath[0].a,t=this.hintPath[this.hintPath.length-1].b,n=this.getTileAt(e.x,e.y),i=this.getTileAt(t.x,t.y);n.setHint(!0),i.setHint(!0),this.hintTiles=[n,i]}}},{key:"hideHint",value:function(){if(this.hintTiles){var e=He(this.hintTiles,2),t=e[0],n=e[1];t.setHint(!1),n.setHint(!1),this.hintTiles=null}}},{key:"getHintPath",value:function(){return this.hintPath}},{key:"getTileAt",value:function(e,t){return this.grid.isInBounds(e,t)?this.grid.get(e,t):null}},{key:"getAnyTileWorldPosition",value:function(e,t){var n=rc(this.grid,this.tileSize,{x:e,y:t});this.tilePrefab.node.setPosition(n.x,n.y);var i=this.tilePrefab.node.getWorldPosition();return{x:i.x,y:i.y}}},{key:"getTileSize",value:function(){return this.tileSize}},{key:"getGridSize",value:function(){return[this.grid.width,this.grid.height]}},{key:"getUncleared",value:function(){return uc(this.grid)}},{key:"getCleared",value:function(){return cc(this.grid)}},{key:"getBombTiles",value:function(){return uc((e=this.grid)instanceof Ru?e.asArray():e).filter((function(e){var t;return(null===(t=e.special)||void 0===t?void 0:t.type)===ec.bomb}));var e}},{key:"getPairs",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=[],i=t?uc(this.grid):cc(this.grid),a=function(){var e=He(fc(i),2),t=e[0],a=e[1];n.push([t,a]),i=i.filter((function(e){return e!==t&&e!==a}))};n.length<e;)a();return n}},{key:"setIgnoreInput",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.grid.forEach((function(t){return t.setIgnoreInput(e)}))}},{key:"processShuffleRequest",value:function(e){var t=this.processShuffleStep(this.grid,!0,e);this.grid=t[0],this.hintPath=t[1],this.consumeAnimationQueue()}},{key:"getCurrentFen",value:function(){return Nc(this.grid)}},{key:"generateFenFromCurrentLevel",value:function(e){return a.generateFen(null!=e?e:this.levelData)}},{key:"listenLayoutevents",value:function(){W.on(va,this.handleViewResized),W.on(ma,this.onLayoutChanged)}},{key:"unlistenLayoutevents",value:function(){W.off(va,this.handleViewResized),W.off(ma,this.onLayoutChanged)}},{key:"shakeGrid",value:(n=Ce(Se().mark((function e(){var t,n,i;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.tilesHolder.position.clone(),n=S(this.tilesHolder).to(.05,{position:t.clone().add3f(ie(5,10),ie(5,10),0)}).to(.05,{position:t.clone().subtract3f(ie(5,10),ie(5,10),0)}),i=S(this.tilesHolder).repeat(2,n).to(.05,{position:t}),e.next=5,vn.runTweenAsync(i);case 5:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"processGameplayCycle",value:function(){var e=uc(this.grid);if(0!==e.length){var t=this.grid,n=e.length>=2&&this.spawnAttempts<this.levelData.rules.addRandomTilesPerMove&&this.normalMatches>=5,i=this.normalMatchesSinceLastSpawn>=2;n&&(i?(this.spawnAttempts++,this.normalMatchesSinceLastSpawn=0,this.processSpawnStep()):this.normalMatchesSinceLastSpawn++),e.length>14&&(t=this.processGravitationStep(t));var a=this.processShuffleStep(t);this.consumeAnimationQueue(),this.grid=a[0],this.hintPath=a[1]}}},{key:"processSpawnStep",value:function(){var e=He(gc(cc(this.grid),2),2),t=e[0],n=e[1];t.restore(),n.restore(t.id)}},{key:"processGravitationStep",value:function(e){var t,n=this,i=e,a=[],r=Ke(this.parsedGravityRules);try{var o=function(){var e=t.value,r=Fc(i=n.toGravitated(i,e));if(0===r.length)return 1;r.forEach((function(e){var t=He(e,2),n=t[0],i=t[1],a=i[0],r=i[1];n.setCoord(a,r)})),i.forEach((function(e){e.node.setSiblingIndex(0)}));var o=function(){var e=Ce(Se().mark((function e(){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all(r.map((function(e){var t=He(e,2),a=t[0],r=He(t[1],2),o=r[0],s=r[1];return a.sync({delay:.25,duration:.25,getTargetPosition:function(){return rc(i,n.tileSize,{x:o,y:s})}})})));case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();a.push(o)};for(r.s();!(t=r.n()).done;)o()}catch(e){r.e(e)}finally{r.f()}var s=function(){var e=Ce(Se().mark((function e(){var t,n,i;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=0,n=a;case 1:if(!(t<n.length)){e.next=8;break}return i=n[t],e.next=5,i();case 5:t++,e.next=1;break;case 8:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return this.animationQueue.push(s),i}},{key:"toGravitated",value:function(e,t){var n=new Ru(e),i=e.height-1,a=e.width-1,r=[0,i],o=[0,a],s=Math.floor(e.height/2),l=Math.floor(e.width/2),u=function(e){return e.isHidden()};switch(t){case ku:n.gravitate({rowRange:r,colRange:o,direction:wu.Down,isLighter:u});break;case Su:n.gravitate({rowRange:r,colRange:o,direction:wu.Up,isLighter:u});break;case Eu:n.gravitate({rowRange:r,colRange:o,direction:wu.Left,isLighter:u});break;case Cu:n.gravitate({rowRange:r,colRange:o,direction:wu.Right,isLighter:u});break;case Tu:n.gravitate({rowRange:r,colRange:[l,a],direction:wu.Left,isLighter:u,out:n.gravitate({rowRange:r,colRange:[0,l-1],direction:wu.Right,isLighter:u})});break;case Au:n.gravitate({rowRange:[s,i],colRange:o,direction:wu.Down,isLighter:u,out:n.gravitate({rowRange:[0,s-1],colRange:o,direction:wu.Up,isLighter:u})})}return n}},{key:"getPrimitiveDirection",value:function(e,t,n){var i=Math.floor(this.grid.height/2),a=Math.floor(this.grid.width/2);switch(n){case ku:return wu.Down;case Su:return wu.Up;case Eu:return wu.Left;case Cu:return wu.Right;case Tu:return e>=a?wu.Left:wu.Right;case Au:return t>=i?wu.Down:wu.Up}}},{key:"processShuffleStep",value:function(e){var t,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2?arguments[2]:void 0,a=Jc(e),r=uc(e).map((function(e){var t=e.getCoord();return[t.x,t.y]}));if(null!==a&&!n)return[e,a];var o=100;do{var s=e.toShuffled(r),l=He(s,1);a=Jc(t=l[0]),o--}while(null===a&&o>0);if(o<=0)return null==ph||ph.sendException(new Error("No paths found after 100 shuffle attempts"),{message:"No paths found after 100 shuffle attempts",levelData:this.levelData,gridAsArray:t.asArray()}),this.node.scene.emit(pr.GAME_EXIT),[e,a];var u=Fc(t);if(0===u.length)return[t,a];u.forEach((function(e){var t=He(e,2),n=t[0],i=He(t[1],2),a=i[0],r=i[1];n.setCoord(a,r)}));var c=void 0!==i?function(){return i(e,t)}:this.createShuffleAnimationHandler(e,t);return this.animationQueue.push(c),[t,a]}},{key:"createShuffleAnimationHandler",value:function(e,t){var n=this,i=function(){var i=Ce(Se().mark((function i(){return Se().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,Promise.all(e.map((function(e,i,a){return e.sync({duration:.4,easing:"smooth",getTargetPosition:function(){return rc(t,n.tileSize,{x:i,y:a},10)}})})));case 2:case"end":return i.stop()}}),i)})));return function(){return i.apply(this,arguments)}}(),a=function(){var e=Ce(Se().mark((function e(){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.forEach((function(e){e.node.setSiblingIndex(0)})),e.next=3,Promise.all(t.map((function(e){return e.sync({duration:.6,easing:"smooth",delay:ie(0,.4),getTargetPosition:function(e){return rc(t,n.tileSize,e)}})})));case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return function(){var e=Ce(Se().mark((function e(){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i();case 2:return e.next=4,a();case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()}},{key:"consumeAnimationQueue",value:(t=Ce(Se().mark((function e(){var t;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.isConsumingAnimation){e.next=2;break}return e.abrupt("return");case 2:this.isConsumingAnimation=!0;case 3:if(!(this.animationQueue.length>0)){e.next=12;break}if(0!==this.getUncleared().length){e.next=7;break}return this.animationQueue=[],e.abrupt("break",12);case 7:return t=this.animationQueue.shift(),e.next=10,t();case 10:e.next=3;break;case 12:this.isConsumingAnimation=!1;case 13:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}],[{key:"generateFen",value:function(e){for(var t=e,n=[],i=0;i<t.colors;i++)n.push(i+1);var a=Date.now(),r=kc({levelData:t,seed:a,identities:n,createTile:function(e){var t=e,n=void 0,i=new Q(0,0);return{get id(){return t},get special(){return n},get coord(){return i},setIdentity:function(e){t=e},isHidden:function(){return!1},setSpecialType:function(e){n={type:e}},setCoord:function(e,t){return i.set(e,t)},getCoord:function(){return i},isSimilarTo:function(e){return e.id===t},inSamePositionAs:function(e){return e.getCoord().equals(i)}}}});return r.forEach((function(e,t,n){e.setCoord(t,n)})),Cc(r,a),wc(r,t,a),Nc(r)}}]),a}(f)).prototype,"tilePrefab",[Hc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Yc=Xe(Kc.prototype,"tilesHolder",[Vc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Xc=Xe(Kc.prototype,"tileTrim",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Q(.025,.1)}}),Wc=Kc))||Wc)||Wc);n._RF.pop(),n._RF.push({},"c92ec8pmUJGbrL9PLjum+i5","Line",void 0);var fh=(0,i.ccclass)("Line")(lh=function(e){Ie(n,e);var t=Fe(n);function n(){return Te(this,n),t.apply(this,arguments)}return xe(n,[{key:"onLoad",value:function(){this.uiTransform=this.getComponent(s)}},{key:"setPoints",value:function(e,t){this.node.setWorldPosition((e.x+t.x)/2,(e.y+t.y)/2,0),this.uiTransform.width=Q.distance(e,t)+10,this.uiTransform.width/=this.node.worldScale.x;var n=180*Math.atan2(t.y-e.y,t.x-e.x)/Math.PI;this.node.eulerAngles=new Y(0,0,n)}}]),n}(f))||lh;n._RF.pop(),n._RF.push({},"1e7cch8i/5DkYHOwJowrjeg","AFPool",void 0);var vh,yh,mh,gh,bh,wh,kh,Sh,Eh,Ch,Th,Ah=function(e){Ie(n,e);var t=Fe(n);function n(e,i,a,r,o){var s;return Te(this,n),(s=t.call(this,e,i,o)).ator=a,s.ftor=r,s}return xe(n,[{key:"alloc",value:function(){var e=Ge(Pe(n.prototype),"alloc",this).call(this);return this.ator&&this.ator(e),e}},{key:"free",value:function(e){this.ftor&&this.ftor(e),Ge(Pe(n.prototype),"free",this).call(this,e)}}]),n}(ae);n._RF.pop(),n._RF.push({},"6f7a1msxIxIbYLx5PpbL/BZ","PathDrawer",void 0);var xh,Rh,Ih,Ph,_h,Lh,Oh,Dh,Mh,Nh=i.ccclass,Fh=i.property,Bh=(vh=Nh("PathDrawer"),yh=Fh({group:"Line",displayName:"Prefab",type:I}),mh=Fh({group:"Line",displayName:"Holder",type:a,tooltip:"Line Prefab"}),gh=Fh({group:"Point",displayName:"Prefab",type:I}),bh=Fh({group:"Point",displayName:"Holder",type:a}),vh((Sh=Xe((kh=function(e){Ie(n,e);var t=Fe(n);function n(){var e;Te(this,n);for(var i=arguments.length,a=new Array(i),r=0;r<i;r++)a[r]=arguments[r];return Ye(e=t.call.apply(t,[this].concat(a)),"linePrefab",Sh,Me(e)),Ye(e,"lineHolder",Eh,Me(e)),e.lineNodes=[],Ye(e,"pointPrefab",Ch,Me(e)),Ye(e,"pointHolder",Th,Me(e)),e.pointNodes=[],e}return xe(n,[{key:"start",value:function(){var e=this;this.linePool=new Ah((function(){var t=l(e.linePrefab);return e.lineHolder.addChild(t),t.parent=e.lineHolder,t.active=!1,t}),0,(function(t){e.lineNodes.push(t),t.active=!0}),(function(e){e.active=!1}),(function(e){e.isValid&&e.destroy()})),this.pointPool=new Ah((function(){var t=l(e.pointPrefab);return e.pointHolder.addChild(t),t.active=!1,t}),0,(function(t){e.pointNodes.push(t),t.active=!0}),(function(e){e.active=!1}),(function(e){e.isValid&&e.destroy()}))}},{key:"drawPath",value:function(e){this.clearPath();var t,n=Ke(e);try{for(n.s();!(t=n.n()).done;){var i,a=t.value;null===(i=this.linePool.alloc().getComponent(fh))||void 0===i||i.setPoints(a.a,a.b)}}catch(e){n.e(e)}finally{n.f()}}},{key:"clearPath",value:function(){var e,t=Ke(this.lineNodes);try{for(t.s();!(e=t.n()).done;){var n=e.value;this.linePool.free(n)}}catch(e){t.e(e)}finally{t.f()}this.lineNodes=[];var i,a=Ke(this.pointNodes);try{for(a.s();!(i=a.n()).done;){var r=i.value;this.pointPool.free(r)}}catch(e){a.e(e)}finally{a.f()}this.pointNodes=[]}}]),n}(f)).prototype,"linePrefab",[yh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Eh=Xe(kh.prototype,"lineHolder",[mh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ch=Xe(kh.prototype,"pointPrefab",[gh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Th=Xe(kh.prototype,"pointHolder",[bh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wh=kh))||wh);n._RF.pop(),n._RF.push({},"5cc7bAmTI1JL7nwLzZcp45u","ErrorDrawer",void 0);var Gh,zh=i.ccclass,Uh=i.property,Hh=(xh=zh("ErrorDrawer"),Rh=Uh(O),Ih=Uh(O),Ph=Uh(O),xh((Oh=Xe((Lh=function(e){Ie(n,e);var t=Fe(n);function n(){var e;Te(this,n);for(var i=arguments.length,a=new Array(i),r=0;r<i;r++)a[r]=arguments[r];return Ye(e=t.call.apply(t,[this].concat(a)),"one",Oh,Me(e)),Ye(e,"two",Dh,Me(e)),Ye(e,"error",Mh,Me(e)),e}return xe(n,[{key:"start",value:function(){Ge(Pe(n.prototype),"start",this).call(this),this.pathAppearDuration=0}},{key:"drawPath",value:function(e){var t=this;if(this.clearPath(),e.forEach((function(n,i){var a;if(null===(a=t.linePool.alloc().getComponent(fh))||void 0===a||a.setPoints(n.a,n.b),0!==i){var r=t.pointPool.alloc();r.setWorldPosition(new Y(n.a.x,n.a.y,0));var o=r.getComponent(A);1===i&&e.length>3?o.spriteFrame=t.one:2===i&&e.length>3?o.spriteFrame=t.two:o.spriteFrame=t.error}})),1===e.length){var n=this.pointPool.alloc();n.setWorldPosition(new Y(e[0].a.x+e[0].b.x,e[0].a.y+e[0].b.y,0).multiplyScalar(.5)),n.getComponent(A).spriteFrame=this.error}this.pathAppearDuration=.8}},{key:"update",value:function(e){this.pathAppearDuration>0&&(this.pathAppearDuration-=e,this.pathAppearDuration<=0&&this.clearPath())}}]),n}(Bh)).prototype,"one",[Rh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Dh=Xe(Lh.prototype,"two",[Ih],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Mh=Xe(Lh.prototype,"error",[Ph],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_h=Lh))||_h);n._RF.pop(),n._RF.push({},"880e8aL9NFPj68zH2xVRIFR","HintDrawer",void 0);var Vh,qh=(0,i.ccclass)("HintDrawer")(Gh=function(e){Ie(n,e);var t=Fe(n);function n(){return Te(this,n),t.apply(this,arguments)}return xe(n,[{key:"drawPath",value:function(e){this.clearPath(),this.createPath(e),this.showPath()}},{key:"createPath",value:function(e){var t=this;e.forEach((function(e){var n;null===(n=t.linePool.alloc().getComponent(fh))||void 0===n||n.setPoints(e.a,e.b),t.pointPool.alloc().setWorldPosition(e.a.x,e.a.y,0)})),this.pointPool.alloc().setWorldPosition(e[e.length-1].b.x,e[e.length-1].b.y,0)}},{key:"showPath",value:function(){var e,t=Ke(this.lineNodes);try{for(t.s();!(e=t.n()).done;){var n=e.value.getComponent(N);n.opacity=0,S(n).to(.2,{opacity:255},{easing:"quadOut"}).start()}}catch(e){t.e(e)}finally{t.f()}var i,a=Ke(this.pointNodes);try{for(a.s();!(i=a.n()).done;){var r=i.value.getComponent(N);r.opacity=0,S(r).to(.2,{opacity:255},{easing:"quadOut"}).start()}}catch(e){a.e(e)}finally{a.f()}}},{key:"clearPath",value:function(){var e,t=this,n=Ke(this.lineNodes);try{var i=function(){var n=e.value,i=n.getComponent(N);S(i).to(.15,{opacity:0},{onComplete:function(){i.opacity=255,t.linePool.free(n)}}).start()};for(n.s();!(e=n.n()).done;)i()}catch(e){n.e(e)}finally{n.f()}var a,r=Ke(this.pointNodes);try{var o=function(){var e=a.value,n=e.getComponent(N);S(n).to(.15,{opacity:0},{onComplete:function(){n.opacity=255,t.pointPool.free(e)}}).start()};for(r.s();!(a=r.n()).done;)o()}catch(e){r.e(e)}finally{r.f()}this.lineNodes=[],this.pointNodes=[]}}]),n}(Bh))||Gh;n._RF.pop(),n._RF.push({},"25f67BW5/5Jzox4v+yBBbyS","MatchDrawer",void 0);var Wh,Kh,jh,Yh,Xh,$h,Qh,Jh,Zh,ep=(0,i.ccclass)("MatchDrawer")(Vh=function(e){Ie(a,e);var t,n,i=Fe(a);function a(){return Te(this,a),i.apply(this,arguments)}return xe(a,[{key:"drawPath",value:function(e){var t=this;e.forEach((function(e,n){var i,a=t.linePool.alloc();null===(i=a.getComponent(fh))||void 0===i||i.setPoints(e.a,e.b),t.animateLine(a);var r=t.pointPool.alloc();r.setWorldPosition(e.a.x,e.a.y,0),t.animatePoint(r,n)}));var n=this.pointPool.alloc();n.setWorldPosition(e[e.length-1].b.x,e[e.length-1].b.y,0),this.animatePoint(n,e.length)}},{key:"animateLine",value:(n=Ce(Se().mark((function e(t){var n,i;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(n=t.getComponent(N)).opacity=0,i=S(n).to(.25,{opacity:255},{easing:"quadOut"}).delay(.1).to(.2,{opacity:0}),e.next=5,vn.runTweenAsync(i);case 5:n.opacity=255,this.linePool.free(t);case 7:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"animatePoint",value:(t=Ce(Se().mark((function e(t,n){var i;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.scale=Y.ZERO,i=S(t).delay(.03*n).to(.2,{scale:Y.ONE},{easing:"quadOut"}).delay(.1).to(.2,{scale:Y.ZERO},{easing:"backIn"}),e.next=4,vn.runTweenAsync(i);case 4:this.pointPool.free(t);case 5:case"end":return e.stop()}}),e,this)}))),function(e,n){return t.apply(this,arguments)})},{key:"clearPath",value:function(){this.lineNodes=[],this.pointNodes=[]}}]),a}(Bh))||Vh;n._RF.pop(),n._RF.push({},"bfdf2THr9lPJ4TOVDN8VgE4","PathDraw",void 0);var tp,np=i.ccclass,ip=i.property,ap=(Wh=np("PathDraw"),Kh=ip({group:{name:"Path Drawer"},type:ep}),jh=ip({group:{name:"Path Drawer"},type:qh}),Yh=ip({group:{name:"Path Drawer"},type:Hh}),Wh((Qh=Xe(($h=function(e){Ie(n,e);var t=Fe(n);function n(){var e;Te(this,n);for(var i=arguments.length,a=new Array(i),r=0;r<i;r++)a[r]=arguments[r];return Ye(e=t.call.apply(t,[this].concat(a)),"matchPath",Qh,Me(e)),Ye(e,"hintPath",Jh,Me(e)),Ye(e,"errorPath",Zh,Me(e)),e.isDrawingHint=!1,e}return xe(n,[{key:"drawMatchPath",value:function(e,t){var n,i=Ke(e=e.map((function(e){return ke({},e)})));try{for(i.s();!(n=i.n()).done;){var a=n.value;a.a=t(a.a),a.b=t(a.b)}}catch(e){i.e(e)}finally{i.f()}this.matchPath.drawPath(e)}},{key:"clearMatchPath",value:function(){this.matchPath.clearPath()}},{key:"drawHintPath",value:function(e,t){if(!this.isDrawingHint){this.isDrawingHint=!0;var n,i=Ke(e=e.map((function(e){return ke({},e)})));try{for(i.s();!(n=i.n()).done;){var a=n.value;a.a=t(a.a),a.b=t(a.b)}}catch(e){i.e(e)}finally{i.f()}this.hintPath.drawPath(e)}}},{key:"clearHintPath",value:function(){this.isDrawingHint&&(this.isDrawingHint=!1,this.hintPath.clearPath())}},{key:"drawErrorPath",value:function(e,t){var n,i=Ke(e=e.map((function(e){return ke({},e)})));try{for(i.s();!(n=i.n()).done;){var a=n.value;a.a=t(a.a),a.b=t(a.b)}}catch(e){i.e(e)}finally{i.f()}this.errorPath.drawPath(e)}}]),n}(f)).prototype,"matchPath",[Kh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Jh=Xe($h.prototype,"hintPath",[jh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Zh=Xe($h.prototype,"errorPath",[Yh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Xh=$h))||Xh);n._RF.pop(),n._RF.push({},"3afb9sM0KZKyod8UtofqZYu","ComboManager",void 0);var rp,op,sp,lp,up,cp,hp,pp,dp,fp,vp,yp,mp,gp,bp,wp,kp,Sp=(0,i.ccclass)("ComboManager")(tp=function(e){Ie(n,e);var t=Fe(n);function n(){return Te(this,n),t.apply(this,arguments)}return xe(n,[{key:"init",value:function(){this.currentCombo=0,this.setEmitEvent(!0),this.node.scene.on(pr.COMBO_ENDED,this.resetCombo,this),this.node.scene.on(pr.GAME_FINISH,this.resetCombo,this),this.node.scene.on(pr.GAME_REPLAY,this.resetCombo,this),this.node.scene.on(pr.NEXT_LEVEL,this.resetCombo,this),this.node.scene.on(pr.ADD_COMBO,this.addCombo,this)}},{key:"addCombo",value:function(){this.setCombo(this.currentCombo+1)}},{key:"resetCombo",value:function(){this.setCombo(0)}},{key:"getCombo",value:function(){return this.currentCombo}},{key:"setCombo",value:function(e){if(this.currentCombo=e,e>0&&e<5){var t=[ui.COMBO_1,ui.COMBO_2,ui.COMBO_3,ui.COMBO_4,ui.COMBO_5];bi.playSound(t[e])}else e>=5&&bi.playSound(ui.COMBO_5);e>0&&this.vibrate(e),this.emitEvent&&this.node.scene.emit(pr.COMBO_UPDATED,e)}},{key:"vibrate",value:function(e){var t;null===(t=R("Vibrate"))||void 0===t||null===(t=t.getComponent(Os))||void 0===t||t.vibrate(Math.min(20+20*e,220))}},{key:"setEmitEvent",value:function(e){this.emitEvent=e}}]),n}(f))||tp;n._RF.pop(),n._RF.push({},"da8a1SD+ahMFpc6MIdiFP5H","ShiningStar",void 0);var Ep,Cp,Tp,Ap,xp,Rp=i.ccclass,Ip=i.property,Pp=i.disallowMultiple,_p=(rp=Rp("ShiningStar"),op=Ip(A),sp=Ip({serializable:!0,visible:!1}),lp=Ip({type:E,displayName:"Scale up duration",min:.001}),up=Ip({serializable:!0,visible:!1}),cp=Ip({type:E,displayName:"Bounce and Fall duration",min:.001}),hp=Ip({serializable:!0,visible:!1}),pp=Ip({type:E,displayName:"Start scale"}),dp=Ip({serializable:!0,visible:!1}),fp=Ip({type:E,displayName:"End scale"}),rp(vp=Pp((mp=Xe((yp=function(e){Ie(u,e);var t,n,i,a,r,o,s,l=Fe(u);function u(){var e;Te(this,u);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return Ye(e=l.call.apply(l,[this].concat(n)),"shine",mp,Me(e)),Ye(e,"twScaleUpDuration",gp,Me(e)),Ye(e,"twBounceAndFallDuration",bp,Me(e)),Ye(e,"twStartScale",wp,Me(e)),Ye(e,"twEndScale",kp,Me(e)),e.isBeingAnimated=!1,e}return xe(u,[{key:"scaleUpDuration",get:function(){return this.twScaleUpDuration},set:function(e){this.twScaleUpDuration=e}},{key:"bounceAndFallDuration",get:function(){return this.twBounceAndFallDuration},set:function(e){this.twBounceAndFallDuration=e}},{key:"startScale",get:function(){return this.twStartScale},set:function(e){this.twStartScale=e}},{key:"endScale",get:function(){return this.twEndScale},set:function(e){this.twEndScale=e}},{key:"isAvailable",get:function(){return!this.isBeingAnimated}},{key:"__preload",value:function(){this.shineOpacity=this.shine.node.getComponent(N),this.uiOpacity=this.node.getComponent(N),this.validateRequiredComponents()}},{key:"onLoad",value:function(){this.uiOpacity.opacity=0}},{key:"playAnimation",value:(s=Ce(Se().mark((function e(){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.isAvailable){e.next=2;break}throw new Error("ShiningStar: This star is being animated.");case 2:return this.isBeingAnimated=!0,e.next=5,this.animateAppear();case 5:return e.next=7,this.animateDisappear();case 7:this.isBeingAnimated=!1;case 8:case"end":return e.stop()}}),e,this)}))),function(){return s.apply(this,arguments)})},{key:"animateAppear",value:(o=Ce(Se().mark((function e(){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.shineOpacity.opacity=255,e.next=3,Promise.all([this.animateFadeIn(),this.animateScaleUp()]);case 3:case"end":return e.stop()}}),e,this)}))),function(){return o.apply(this,arguments)})},{key:"animateDisappear",value:(r=Ce(Se().mark((function e(){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all([this.animateBounceAndFall(),this.animateScaleDown()]);case 2:this.node.setScale(0,0),this.uiOpacity.opacity=0;case 4:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"animateBounceAndFall",value:(a=Ce(Se().mark((function e(){var t,n,i,a,r,o,s,l,u,c;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.node.position.x,n=this.node.position.y,i=[60,120],a=(Math.random()*(i[1]-i[0])+i[0])*(Math.PI/180),r=t+200*Math.cos(a),o=n+200*Math.sin(a),s=n-500,l=vn.runTweenAsync(S(this.node).to(.2*this.twBounceAndFallDuration,{position:new Y(r,o,this.node.position.z)},{easing:"sineOut"}).to(.4*this.twBounceAndFallDuration,{position:new Y(r,s,this.node.position.z)},{easing:"cubicIn"})),u=[0,360],c=vn.runTweenAsync(S(this.node).to(this.twBounceAndFallDuration,{eulerAngles:new Y(0,0,Math.random()*(u[1]-u[0])*(r>t?-1:1))},{easing:"sineOut"})),e.next=13,Promise.all([l,c]);case 13:this.node.eulerAngles=new Y(0,0,0);case 14:case"end":return e.stop()}}),e,this)}))),function(){return a.apply(this,arguments)})},{key:"animateFadeIn",value:(i=Ce(Se().mark((function e(){var t;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=Math.max(this.scaleUpDuration/4,.01),e.next=3,vn.runTweenAsync(S(this.uiOpacity).to(t,{opacity:255}));case 3:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"animateScaleUp",value:(n=Ce(Se().mark((function e(){var t;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.node.setScale(this.startScale,this.startScale),t=new Y(this.endScale,this.endScale,1),e.next=4,vn.runTweenAsync(S(this.node).to(this.scaleUpDuration,{scale:t},{easing:"cubicOut"}));case 4:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"animateScaleDown",value:(t=Ce(Se().mark((function e(){var t;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=new Y(0,0,1),e.next=3,vn.runTweenAsync(S(this.node).delay(.1*this.bounceAndFallDuration).to(.5*this.bounceAndFallDuration,{scale:t},{easing:"cubicIn"}));case 3:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"validateRequiredComponents",value:function(){kt.lazyValidateProperties(this)}}]),u}(f)).prototype,"shine",[op],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),gp=Xe(yp.prototype,"twScaleUpDuration",[sp],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.5}}),Xe(yp.prototype,"scaleUpDuration",[lp],Object.getOwnPropertyDescriptor(yp.prototype,"scaleUpDuration"),yp.prototype),bp=Xe(yp.prototype,"twBounceAndFallDuration",[up],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.5}}),Xe(yp.prototype,"bounceAndFallDuration",[cp],Object.getOwnPropertyDescriptor(yp.prototype,"bounceAndFallDuration"),yp.prototype),wp=Xe(yp.prototype,"twStartScale",[hp],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.5}}),Xe(yp.prototype,"startScale",[pp],Object.getOwnPropertyDescriptor(yp.prototype,"startScale"),yp.prototype),kp=Xe(yp.prototype,"twEndScale",[dp],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),Xe(yp.prototype,"endScale",[fp],Object.getOwnPropertyDescriptor(yp.prototype,"endScale"),yp.prototype),vp=yp))||vp)||vp);n._RF.pop(),n._RF.push({},"2e9aaj8L6lN1pTv2xGEj1sE","StarParticles",void 0);var Lp,Op,Dp,Mp,Np,Fp,Bp,Gp,zp,Up,Hp,Vp,qp,Wp,Kp,jp,Yp,Xp,$p,Qp,Jp,Zp=i.ccclass,ed=i.property,td=i.disallowMultiple,nd=(Ep=Zp("StarParticles"),Cp=ed({type:[_p],displayName:"Prebuilt Shining stars"}),Ep(Tp=td((xp=Xe((Ap=function(e){Ie(i,e);var t,n=Fe(i);function i(){var e;Te(this,i);for(var t=arguments.length,a=new Array(t),r=0;r<t;r++)a[r]=arguments[r];return Ye(e=n.call.apply(n,[this].concat(a)),"shiningStars",xp,Me(e)),e}return xe(i,[{key:"__preload",value:function(){this.validateRequiredComponents()}},{key:"fireShiningStarAt",value:(t=Ce(Se().mark((function e(t){var n,i,a,r,o;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==(n=this.getFirstAvailableShiningStar())){e.next=3;break}throw new Error("No available shining stars. Please add more prebuilt shining stars or calls this function later.");case 3:return i=He(t,2),a=i[0],r=i[1],o=new Y(a,r,this.node.worldPosition.z),n.node.worldPosition=o,e.next=8,n.playAnimation();case 8:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"getFirstAvailableShiningStar",value:function(){return this.shiningStars.find((function(e){return e.isAvailable}))}},{key:"validateRequiredComponents",value:function(){kt.lazyValidateProperties(this)}}]),i}(f)).prototype,"shiningStars",[Cp],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Tp=Ap))||Tp)||Tp);n._RF.pop(),n._RF.push({},"2913d3KShhIEaPfSLUhFqvA","EffectManager",void 0);var id=i.ccclass,ad=i.property,rd=(Lp=id("EffectManager"),Op=ad({group:"Thunder Effect",type:a}),Dp=ad({group:"Thunder Effect",type:a}),Mp=ad({group:"Mask Effect",type:da}),Np=ad({group:"Mask Effect",type:a}),Fp=ad({group:"Tornado Effect",type:a}),Bp=ad({group:"Clear Particle Effect",type:a,displayName:"Particle holder node"}),Gp=ad({group:"Clear Particle Effect",type:re,displayName:"Emitter 1"}),zp=ad({group:"Clear Particle Effect",type:re,displayName:"Emitter 2"}),Up=ad({group:"Star Particles Effect",type:nd}),Lp((qp=Xe((Vp=function(e){Ie(f,e);var t,n,i,a,r,o,l,u,c,h,p,d=Fe(f);function f(){var e;Te(this,f);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return Ye(e=d.call.apply(d,[this].concat(n)),"cloud",qp,Me(e)),Ye(e,"lightnings",Wp,Me(e)),Ye(e,"backgroundMask",Kp,Me(e)),Ye(e,"masks",jp,Me(e)),Ye(e,"tornado",Yp,Me(e)),e.bombExplosion=null,e.bombExplosionPool=null,e.defuseExplosion=null,e.defuseExplosionPool=null,Ye(e,"clearParticleHolder",Xp,Me(e)),Ye(e,"clearParticle1",$p,Me(e)),Ye(e,"clearParticle2",Qp,Me(e)),Ye(e,"starParticle",Jp,Me(e)),e.maskTargets=[],e}return xe(f,[{key:"__preload",value:function(){this.validateRequiredComponents()}},{key:"update",value:function(){var e=this;this.maskTargets.length>0&&this.maskTargets.forEach((function(t,n){t.isHidden()||(e.masks[n].worldPosition=t.node.worldPosition.clone())}))}},{key:"validateRequiredComponents",value:function(){kt.lazyValidateProperties(this)}},{key:"start",value:function(){this.node.scene.on(pr.GRID_RESIZE,this.handleBoardResize,this)}},{key:"playClearFXAt",value:function(e){this.clearParticle1.node.setWorldPosition(new Y(e[0].x,e[0].y,1)),this.clearParticle2.node.setWorldPosition(new Y(e[1].x,e[1].y,1)),this.clearParticle1.resetSystem(),this.clearParticle2.resetSystem()}},{key:"playStarFXAt",value:function(e){this.starParticle.fireShiningStarAt(e)}},{key:"playTornadoAnimation",value:(p=Ce(Se().mark((function e(){var t;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!==this.tornado.getChildByName("Sprite").getComponent(y).defaultClip){e.next=4;break}return console.warn("EffectManager: Tornado animation is not loaded when animation play request was made."),e.abrupt("return");case 4:return this.tornado.active=!0,(t=S(this.tornado)).set({scale:new Y(0,0,0)}),t.delay(.5),t.to(.5,{scale:new Y(1,1,1)},{easing:"quadOut"}),t.to(.5,{scale:new Y(0,0,0)},{easing:"quadIn"}),t.set({active:!1}),ai.setBlockInput(!0),e.next=14,vn.runTweenAsync(t);case 14:ai.setBlockInput(!1);case 15:case"end":return e.stop()}}),e,this)}))),function(){return p.apply(this,arguments)})},{key:"shakeGame",value:(h=Ce(Se().mark((function e(){var t,n;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.node.position.clone(),n=S(this.node).to(.05,{position:t.clone().add3f(ie(5,10),ie(5,10),0)}).to(.05,{position:t.clone().subtract3f(ie(5,10),ie(5,10),0)}).to(.05,{position:t}),e.next=4,vn.runTweenAsync(n);case 4:case"end":return e.stop()}}),e,this)}))),function(){return h.apply(this,arguments)})},{key:"handleBoardResize",value:function(e){this.clearParticleHolder.setScale(e,e)}},{key:"playThunderAnimation",value:(c=Ce(Se().mark((function e(t,n){var i,a,r,o,l,u,c,h,p,d,f,v,y;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.cloud.active=!0,r=R("Canvas").getComponent(s),o=r.width,l=r.height,u=Math.floor(4*Math.random()),c=0,h=0,e.t0=u,e.next=0===e.t0?9:1===e.t0?12:2===e.t0?15:3===e.t0?18:21;break;case 9:return c=Math.random()*o-o/2,h=l/2+300,e.abrupt("break",21);case 12:return c=Math.random()*o-o/2,h=-l/2-300,e.abrupt("break",21);case 15:return c=-o/2-300,h=Math.random()*l-l/2,e.abrupt("break",21);case 18:return c=o/2+300,h=Math.random()*l-l/2,e.abrupt("break",21);case 21:return this.cloud.position=new Y(c,h),this.resetMasks(),this.setMaskProperties(0,t[0][0].node.worldPosition,t[0][0].node.worldScale),this.setMaskProperties(1,t[0][1].node.worldPosition,t[0][1].node.worldScale),this.setMaskProperties(2,t[1][0].node.worldPosition,t[1][0].node.worldScale),this.setMaskProperties(3,t[1][1].node.worldPosition,t[1][1].node.worldScale),this.maskTargets=[t[0][0],t[0][1],t[1][0],t[1][1]],e.next=30,this.setBackgroundMaskActive(!0);case 30:return p=S(this.cloud).to(.8,{position:new Y(0,300)},{easing:"quadOut"}),e.next=33,vn.runTweenAsync(p);case 33:return d=t[0][0].node.worldPosition.clone(),f=t[0][1].node.worldPosition.clone(),this.shakeGame(),null===(i=R("Vibrate"))||void 0===i||null===(i=i.getComponent(Os))||void 0===i||i.vibrate(500),bi.playSound(ui.THUNDERBOLT),n.clear([t[0]],"break"),e.next=41,Promise.all([this.playLightningAnimation(d,0),this.playLightningAnimation(f,1)]);case 41:return this.node.scene.emit(pr.ADD_COMBO),this.node.scene.emit(pr.ADD_SCORE),v=t[1][1].node.worldPosition.clone(),y=t[1][0].node.worldPosition.clone(),this.shakeGame(),null===(a=R("Vibrate"))||void 0===a||null===(a=a.getComponent(Os))||void 0===a||a.vibrate(500),bi.playSound(ui.THUNDERBOLT),n.clear([t[1]],"break"),e.next=51,Promise.all([this.playLightningAnimation(y,0),this.playLightningAnimation(v,1)]);case 51:return this.node.scene.emit(pr.ADD_COMBO),this.node.scene.emit(pr.ADD_SCORE),this.cloud.active=!1,e.next=56,this.setBackgroundMaskActive(!1);case 56:this.maskTargets=[];case 57:case"end":return e.stop()}}),e,this)}))),function(e,t){return c.apply(this,arguments)})},{key:"playLightningAnimation",value:(u=Ce(Se().mark((function e(t,n){var i,a,r,o,l=this;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=this.lightnings[n],a=t.subtract(i.worldPosition),r=Math.atan2(a.y,a.x)*(180/Math.PI)+180,o=a.length(),i.getComponent(s).width=o,i.angle=r,e.abrupt("return",new Promise((function(e){i.active=!0,l.scheduleOnce((function(){i.active=!1,e()}),.2)})));case 7:case"end":return e.stop()}}),e,this)}))),function(e,t){return u.apply(this,arguments)})},{key:"setBackgroundMaskActive",value:(l=Ce(Se().mark((function e(t){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t&&(this.backgroundMask.node.active=!0),e.next=3,this.backgroundMask.changeStateFade(t,.25);case 3:t||(this.backgroundMask.node.active=!1);case 4:case"end":return e.stop()}}),e,this)}))),function(e){return l.apply(this,arguments)})},{key:"resetMasks",value:function(){this.masks.forEach((function(e){e.worldPosition=new Y(-9999,-9999,0)}))}},{key:"setMaskProperties",value:function(e,t,n){n&&(this.masks[e].worldScale=n),this.masks[e].worldPosition=t}},{key:"createDefuseExplosionAt",value:(o=Ce(Se().mark((function e(t){var n,i;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.loadDefuseExplosionPrefab();case 2:return this.defuseExplosionPool||(this.defuseExplosionPool=new Ah(this.createDefuseExplosion.bind(this),1,od.getBombDefuseExplosion,od.returnBombDefuseExplosion,od.destroyBombDefuseExplosion)),(n=this.defuseExplosionPool.alloc()).setWorldPosition(t),i=n.getComponent(y),e.next=8,vn.runAnimationAsync(i);case 8:if(this.defuseExplosionPool){e.next=10;break}throw new Error("EffectManager: defuseExplosionPool is null");case 10:this.defuseExplosionPool.free(n);case 11:case"end":return e.stop()}}),e,this)}))),function(e){return o.apply(this,arguments)})},{key:"createBombExplosionAt",value:(r=Ce(Se().mark((function e(t){var n,i;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.loadBombExplosionPrefab();case 2:return this.bombExplosionPool||(this.bombExplosionPool=new Ah(this.createBombExplosion.bind(this),1,sd.getBombExplosion,sd.returnBombExplosion,sd.destroyBombExplosion)),(n=this.bombExplosionPool.alloc()).setWorldPosition(t),i=n.getComponent(y),e.next=8,vn.runAnimationAsync(i);case 8:if(this.bombExplosionPool){e.next=10;break}throw new Error("EffectManager: bombExplosionPool is null");case 10:this.bombExplosionPool.free(n);case 11:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"createDefuseExplosion",value:function(){if(!this.defuseExplosion)throw new Error("EffectManager: defuseExplosion is not loaded!");return od.createDefuseExplosion(this.defuseExplosion,this.node)}},{key:"createBombExplosion",value:function(){if(!this.bombExplosion)throw new Error("EffectManager: bombExplosion is not loaded!");return sd.createBombExplosion(this.bombExplosion,this.node)}},{key:"loadBombExplosionPrefab",value:(a=Ce(Se().mark((function e(){var t;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.bombExplosion){e.next=2;break}return e.abrupt("return",Promise.resolve());case 2:return e.next=4,ai.loadPrefabAsync(Dn.BOMB_EXPLODE_PREFAB);case 4:return(t=e.sent)&&(this.bombExplosion=t),e.abrupt("return",Promise.resolve());case 7:case"end":return e.stop()}}),e,this)}))),function(){return a.apply(this,arguments)})},{key:"loadDefuseExplosionPrefab",value:(i=Ce(Se().mark((function e(){var t;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.defuseExplosion){e.next=2;break}return e.abrupt("return",Promise.resolve());case 2:return e.next=4,ai.loadPrefabAsync(Dn.BOMB_DEFUSE_PREFAB);case 4:return(t=e.sent)&&(this.defuseExplosion=t),e.abrupt("return",Promise.resolve());case 7:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"loadThunderAnimation",value:(n=Ce(Se().mark((function e(){var t,n;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null===(t=this.cloud.getChildByName("Top").getComponent(y)).defaultClip){e.next=3;break}return e.abrupt("return",Promise.resolve());case 3:return e.next=5,ai.loadAnimClipAsync(Dn.CLOUD_IDLE_ANIM);case 5:return(n=e.sent)&&(t.defaultClip=n),e.abrupt("return",Promise.resolve());case 8:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"loadTornadoAnimation",value:(t=Ce(Se().mark((function e(){var t,n;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null===(t=this.tornado.getChildByName("Sprite").getComponent(y)).defaultClip){e.next=3;break}return e.abrupt("return",Promise.resolve());case 3:return e.next=5,ai.loadAnimClipAsync(Dn.TORNADO_IDLE_ANIM);case 5:return(n=e.sent)&&(t.defaultClip=n),e.abrupt("return",Promise.resolve());case 8:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),f}(f)).prototype,"cloud",[Op],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Wp=Xe(Vp.prototype,"lightnings",[Dp],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Kp=Xe(Vp.prototype,"backgroundMask",[Mp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),jp=Xe(Vp.prototype,"masks",[Np],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Yp=Xe(Vp.prototype,"tornado",[Fp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Xp=Xe(Vp.prototype,"clearParticleHolder",[Bp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),$p=Xe(Vp.prototype,"clearParticle1",[Gp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Qp=Xe(Vp.prototype,"clearParticle2",[zp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Jp=Xe(Vp.prototype,"starParticle",[Up],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Hp=Vp))||Hp),od=function(){function e(){Te(this,e)}return xe(e,null,[{key:"createDefuseExplosion",value:function(e,t){var n=l(e);return t.addChild(n),n.active=!1,n}},{key:"destroyBombDefuseExplosion",value:function(e){e.destroy()}},{key:"getBombDefuseExplosion",value:function(e){e.active=!0}},{key:"returnBombDefuseExplosion",value:function(e){e.active=!1}}]),e}(),sd=function(){function e(){Te(this,e)}return xe(e,null,[{key:"createBombExplosion",value:function(e,t){var n=l(e);return t.addChild(n),n.active=!1,n}},{key:"destroyBombExplosion",value:function(e){e.destroy()}},{key:"getBombExplosion",value:function(e){e.active=!0}},{key:"returnBombExplosion",value:function(e){e.active=!1}}]),e}();n._RF.pop(),n._RF.push({},"062f3AVHntKsIyireZmXg9P","GuideKeys",void 0);var ld="newbie",ud="timer",cd="combo",hd="hint-item",pd="thunder-item",dd="storm-item",fd="pliers-item";n._RF.pop(),n._RF.push({},"6448denZfFEUru9tWmWGb7N","Guide01Newbie",void 0);var vd=.7261538461538461,yd=function(){function e(t){Te(this,e),this.manager=t,this.gameplay=t.gameplay}var t,n;return xe(e,[{key:"setup",value:function(){this.currentStep=0,this.manager.node.scene.on(pr.GRID_MATCH_SUCCESS,this.showNextStep,this),this.manager.node.scene.on(pr.GRID_MATCH_FAIL,this.showNextStep,this),W.on(va,this.handleViewResized,this),W.on(ma,this.handleViewResized,this),this.showStep(this.currentStep),this.manager.node.scene.emit(pr.HIDE_UI),this.manager.guideSkipButton.active=!0}},{key:"showNextStep",value:function(){this.currentStep+1<Tc.length?(this.currentStep+=1,this.showStep(this.currentStep)):this.close()}},{key:"showStep",value:(n=Ce(Se().mark((function e(t){var n,i,a,r,o,s,l,u,c,h,p,d;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=this.gameplay,i=n.board,a=n.effectManager,r=Tc[t].startTile,o=Tc[t].endTile,s=i.getTileAt(r.x,r.y),l=i.getTileAt(o.x,o.y),s&&l){e.next=7;break}return e.abrupt("return");case 7:return u=s.node.worldPosition,c=l.node.worldPosition,a.resetMasks(),a.setMaskProperties(0,u,s.node.worldScale),a.setMaskProperties(1,c,l.node.worldScale),a.setBackgroundMaskActive(!0),h=this.manager,p=h.guideHand,d=h.guideTextBox,p.node.active=!0,p.playHandAnimation(u,c),this.alignGuideTextBox(),this.alignSkipButton(),e.next=20,d.hide();case 20:return d.setText(Tc[t].description),e.next=23,d.show();case 23:i.setIgnoreInput(!0),s.setIgnoreInput(!1),l.setIgnoreInput(!1),this.gameplay.comboManager.setEmitEvent(!1);case 27:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"handleViewResized",value:function(){var e=this.gameplay,t=e.board,n=e.effectManager,i=Tc[this.currentStep].startTile,a=Tc[this.currentStep].endTile,r=t.getTileAt(i.x,i.y),o=t.getTileAt(a.x,a.y);if(r&&o){var s=r.node.worldPosition,l=o.node.worldPosition;n.setMaskProperties(0,s,r.node.worldScale),n.setMaskProperties(1,l,o.node.worldScale),this.alignGuideTextBox(),this.alignSkipButton()}}},{key:"alignGuideTextBox",value:function(){var e=this.gameplay.board,t=this.manager.guideTextBox,n=e.getTileAt(0,0);if(n){var i=n.node.worldPosition,a=e.tilesHolder.getWorldScale(),r=e.getTileSize()[1]*a.y,o=a.clone().multiplyScalar(vd);t.node.setWorldScale(o),t.node.setWorldPosition(new Y(t.node.worldPosition.x,(i.y-r/2)/2))}}},{key:"alignSkipButton",value:function(){var e=this.gameplay.board,t=this.manager.guideSkipButton;if(t){var n=e.getTileAt(0,e.getGridSize()[1]-1);if(n){var i=n.node.worldPosition,a=e.tilesHolder.getWorldScale(),r=e.getTileSize()[1]*a.y,o=a.clone().multiplyScalar(vd),l=t.getComponent(s).contentSize.height*o.y;t.setWorldScale(o),t.setWorldPosition(new Y(t.worldPosition.x,i.y+(r+l)/2+30))}}}},{key:"close",value:(t=Ce(Se().mark((function e(){var t,n,i;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.gameplay,n=t.board,i=t.effectManager,this.manager.node.scene.off(pr.GRID_MATCH_SUCCESS,this.showNextStep,this),this.manager.node.scene.off(pr.GRID_MATCH_FAIL,this.showNextStep,this),W.off(va,this.handleViewResized,this),W.off(ma,this.handleViewResized,this),n.setIgnoreInput(!1),e.t0=Promise,e.next=9,this.manager.guideTextBox.hide();case 9:return e.t1=e.sent,e.next=12,i.setBackgroundMaskActive(!1);case 12:return e.t2=e.sent,e.t3=[e.t1,e.t2],e.next=16,e.t0.all.call(e.t0,e.t3);case 16:this.manager.guideHand.node.active=!1,this.manager.completeGuide(ld);case 18:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),e}();n._RF.pop(),n._RF.push({},"a52daB3sGxP8JyGBZo5K1+X","Guide02Timer",void 0);var md=function(){function e(t){Te(this,e),this.manager=t,this.gameplay=t.gameplay}var t,n;return xe(e,[{key:"setup",value:(n=Ce(Se().mark((function e(){var t,n,i,a,r,o,l,u;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.manager,n=t.guideMasks,i=t.guideInfoText,a=this.gameplay.uiManager.clock,r=a.getComponent(s).contentSize,o=r.width,l=r.height,u=a.node.worldPosition,o*=1.5,l*=1.5,e.next=9,this.gameplay.handleShowUI();case 9:return n.node.active=!0,n.setOtherMaskTransform(u.x,u.y,o,l),i.node.active=!0,i.string="Remove all tiles before\nthe time end",i.node.setWorldPosition(u.x,u.y-l/2-50,0),i.horizontalAlign=oe.CENTER,i.getComponent(s).setAnchorPoint(.5,.5),e.next=18,n.show();case 18:this.manager.node.scene.once(pr.GUIDE_MASK_CLICKED,this.close,this),this.manager.node.scene.emit(pr.PAUSE_TIME),W.on(va,this.handleViewResized,this),W.on(ma,this.handleViewResized,this);case 22:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"handleViewResized",value:function(){var e=this.manager,t=e.guideMasks,n=e.guideInfoText,i=this.gameplay.uiManager.clock,a=i.getComponent(s).contentSize,r=a.width,o=a.height,l=i.node.worldPosition;r*=1.5,o*=1.5,t.setOtherMaskTransform(l.x,l.y,r,o),n.node.setWorldPosition(l.x,l.y-o/2-50,0)}},{key:"close",value:(t=Ce(Se().mark((function e(){var t,n,i;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.manager,n=t.guideInfoText,i=t.guideMasks,this.gameplay.comboManager.setEmitEvent(!0),this.gameplay.stateManager.isPlaying()&&this.manager.node.scene.emit(pr.RESUME_TIME),e.next=5,i.hide();case 5:n.node.active=!1,this.manager.completeGuide(ud),W.off(va,this.handleViewResized,this),W.off(ma,this.handleViewResized,this);case 9:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),e}();n._RF.pop(),n._RF.push({},"add56o6JFNHAZiCO6F+Z9jK","Guide03Combo",void 0);var gd=function(){function e(t){Te(this,e),this.manager=t,this.gameplay=t.gameplay}var t,n;return xe(e,[{key:"setup",value:(n=Ce(Se().mark((function e(){var t,n,i,a,r,o,l,u;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.manager,n=t.guideMasks,i=t.guideInfoText,a=this.gameplay.uiManager.comboContainer,r=a.getComponent(s).contentSize,o=r.width,l=r.height,u=a.worldPosition,o*=1.5,l*=1.5,n.node.active=!0,n.setOtherMaskTransform(u.x,u.y,o,l),i.node.active=!0,i.string="Remove tiles continuously\nto increase combo!",i.node.setWorldPosition(u.x-o/2-10,u.y,0),i.horizontalAlign=oe.RIGHT,i.getComponent(s).setAnchorPoint(1,.5),e.next=16,n.show();case 16:this.manager.node.scene.once(pr.GUIDE_MASK_CLICKED,this.close,this),this.manager.node.scene.emit(pr.PAUSE_TIME),W.on(va,this.handleViewResized,this),W.on(ma,this.handleViewResized,this);case 20:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"handleViewResized",value:function(){var e=this.manager,t=e.guideMasks,n=e.guideInfoText,i=this.gameplay.uiManager.comboContainer,a=i.getComponent(s).contentSize,r=a.width,o=a.height,l=i.worldPosition;r*=1.5,o*=1.5,t.setOtherMaskTransform(l.x,l.y,r,o),n.node.setWorldPosition(l.x-r/2-10,l.y,0)}},{key:"close",value:(t=Ce(Se().mark((function e(){var t,n,i;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.manager,n=t.guideInfoText,i=t.guideMasks,this.manager.node.scene.emit(pr.RESUME_TIME),i.node.off(a.EventType.TOUCH_START,this.close,this),e.next=5,i.hide();case 5:n.node.active=!1,this.manager.completeGuide(cd),W.off(va,this.handleViewResized,this),W.off(ma,this.handleViewResized,this);case 9:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),e}();n._RF.pop(),n._RF.push({},"fd93d+WLXVHk4yJGmVeSjmR","Guide04Hint",void 0);var bd=function(){function e(t){Te(this,e),this.manager=t,this.gameplay=t.gameplay}var t,n;return xe(e,[{key:"setup",value:(n=Ce(Se().mark((function e(){var t,n,i,a,r,o,l,u;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.manager,n=t.guideMasks,i=t.guideInfoText,a=this.gameplay.itemManager.items.find((function(e){return e.itemType===Ms.HINT}))){e.next=4;break}return e.abrupt("return");case 4:return r=a.node.worldPosition,o=a.getComponent(s).contentSize,l=o.width,u=o.height,l+=40,u+=40,n.node.active=!0,n.setItemMaskTransform(r.x,r.y,l,u),i.node.active=!0,i.string="Tap to reveal a connectable pair",i.node.setPosition(0,0),i.node.setWorldPosition(i.node.worldPosition.x,r.y+u/2+30,0),i.horizontalAlign=oe.CENTER,i.getComponent(s).setAnchorPoint(.5,.5),e.next=19,n.show();case 19:this.manager.node.scene.once(pr.GUIDE_MASK_CLICKED,this.close,this),this.manager.node.scene.emit(pr.PAUSE_TIME),W.on(va,this.handleViewResized,this),W.on(ma,this.handleViewResized,this);case 23:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"handleViewResized",value:function(){var e=this.manager,t=e.guideMasks,n=e.guideInfoText,i=this.gameplay.itemManager.items.find((function(e){return e.itemType===Ms.HINT}));if(i){var a=i.node.worldPosition,r=i.getComponent(s).contentSize,o=r.width,l=r.height;o+=40,l+=40,t.setItemMaskTransform(a.x,a.y,o,l),n.node.setWorldPosition(n.node.worldPosition.x,a.y+l/2+30,0)}}},{key:"close",value:(t=Ce(Se().mark((function e(){var t,n,i;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.manager,n=t.guideMasks,i=t.guideInfoText,this.manager.node.scene.emit(pr.RESUME_TIME),e.next=4,n.hide();case 4:i.node.active=!1,this.manager.completeGuide(hd),W.off(va,this.handleViewResized,this),W.off(ma,this.handleViewResized,this);case 8:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),e}();n._RF.pop(),n._RF.push({},"b08f4dC/r1EPbsfAe1wtcBg","Guide05Thunder",void 0);var wd=function(){function e(t){Te(this,e),this.manager=t,this.gameplay=t.gameplay}var t,n;return xe(e,[{key:"setup",value:(n=Ce(Se().mark((function e(){var t,n,i,a,r,o,l,u;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.manager,n=t.guideMasks,i=t.guideInfoText,a=this.gameplay.itemManager.items.find((function(e){return e.itemType===Ms.THUNDER}))){e.next=4;break}return e.abrupt("return");case 4:return r=a.node.worldPosition,o=a.getComponent(s).contentSize,l=o.width,u=o.height,l+=40,u+=40,n.node.active=!0,n.setItemMaskTransform(r.x,r.y,l,u),i.node.active=!0,i.string="Tap to remove 2 pairs",i.node.setPosition(0,0),i.node.setWorldPosition(i.node.worldPosition.x,r.y+u/2+30,0),i.horizontalAlign=oe.CENTER,i.getComponent(s).setAnchorPoint(.5,.5),e.next=19,n.show();case 19:this.manager.node.scene.once(pr.GUIDE_MASK_CLICKED,this.close,this),this.manager.node.scene.emit(pr.PAUSE_TIME),W.on(va,this.handleViewResized,this),W.on(ma,this.handleViewResized,this);case 23:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"handleViewResized",value:function(){var e=this.manager,t=e.guideMasks,n=e.guideInfoText,i=this.gameplay.itemManager.items.find((function(e){return e.itemType===Ms.THUNDER}));if(i){var a=i.node.worldPosition,r=i.getComponent(s).contentSize,o=r.width,l=r.height;o+=40,l+=40,t.setItemMaskTransform(a.x,a.y,o,l),n.node.setWorldPosition(n.node.worldPosition.x,a.y+l/2+30,0)}}},{key:"close",value:(t=Ce(Se().mark((function e(){var t,n,i;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.manager,n=t.guideMasks,i=t.guideInfoText,this.manager.node.scene.emit(pr.RESUME_TIME),e.next=4,n.hide();case 4:i.node.active=!1,this.manager.completeGuide(pd),W.off(va,this.handleViewResized,this),W.off(ma,this.handleViewResized,this);case 8:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),e}();n._RF.pop(),n._RF.push({},"f4ef8MBZxxKC4bfuDzsLQ5X","Guide06Storm",void 0);var kd=function(){function e(t){Te(this,e),this.manager=t,this.gameplay=t.gameplay}var t,n;return xe(e,[{key:"setup",value:(n=Ce(Se().mark((function e(){var t,n,i,a,r,o,l,u;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.manager,n=t.guideMasks,i=t.guideInfoText,a=this.gameplay.itemManager.items.find((function(e){return e.itemType===Ms.STORM}))){e.next=4;break}return e.abrupt("return");case 4:return r=a.node.worldPosition,o=a.getComponent(s).contentSize,l=o.width,u=o.height,l+=40,u+=40,n.node.active=!0,n.setItemMaskTransform(r.x,r.y,l,u),i.node.active=!0,i.string="Tap to rearrange the tiles",i.node.setPosition(0,0),i.node.setWorldPosition(i.node.worldPosition.x,r.y+u/2+30,0),i.horizontalAlign=oe.CENTER,i.getComponent(s).setAnchorPoint(.5,.5),e.next=19,n.show();case 19:this.manager.node.scene.once(pr.GUIDE_MASK_CLICKED,this.close,this),this.manager.node.scene.emit(pr.PAUSE_TIME),W.on(va,this.handleViewResized,this),W.on(ma,this.handleViewResized,this);case 23:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"handleViewResized",value:function(){var e=this.manager,t=e.guideMasks,n=e.guideInfoText,i=this.gameplay.itemManager.items.find((function(e){return e.itemType===Ms.STORM}));if(i){var a=i.node.worldPosition,r=i.getComponent(s).contentSize,o=r.width,l=r.height;o+=40,l+=40,t.setItemMaskTransform(a.x,a.y,o,l),n.node.setWorldPosition(n.node.worldPosition.x,a.y+l/2+30,0)}}},{key:"close",value:(t=Ce(Se().mark((function e(){var t,n,i;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.manager,n=t.guideMasks,i=t.guideInfoText,this.manager.node.scene.emit(pr.RESUME_TIME),e.next=4,n.hide();case 4:i.node.active=!1,this.manager.completeGuide(dd),W.off(va,this.handleViewResized,this),W.off(ma,this.handleViewResized,this);case 8:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),e}();n._RF.pop(),n._RF.push({},"9920dDqYP9ITJp0bSlZ+K9R","Guide07Pliers",void 0);var Sd,Ed,Cd,Td,Ad,xd,Rd,Id,Pd,_d=function(){function e(t){Te(this,e),this.manager=t,this.gameplay=t.gameplay}var t,n;return xe(e,[{key:"setup",value:(n=Ce(Se().mark((function e(){var t,n,i,a,r,o,l,u;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.manager,n=t.guideMasks,i=t.guideInfoText,a=this.gameplay.itemManager.items.find((function(e){return e.itemType===Ms.PLIERS}))){e.next=4;break}return e.abrupt("return");case 4:return r=a.node.worldPosition,o=a.getComponent(s).contentSize,l=o.width,u=o.height,l+=40,u+=40,n.node.active=!0,n.setItemMaskTransform(r.x,r.y,l,u),i.node.active=!0,i.string="Tap to remove bomb",i.node.setPosition(0,0),i.node.setWorldPosition(i.node.worldPosition.x,r.y+u/2+30,0),i.horizontalAlign=oe.CENTER,i.getComponent(s).setAnchorPoint(.5,.5),e.next=19,n.show();case 19:this.manager.node.scene.once(pr.GUIDE_MASK_CLICKED,this.close,this),this.manager.node.scene.emit(pr.PAUSE_TIME),W.on(va,this.handleViewResized,this),W.on(ma,this.handleViewResized,this);case 23:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"handleViewResized",value:function(){var e=this.manager,t=e.guideMasks,n=e.guideInfoText,i=this.gameplay.itemManager.items.find((function(e){return e.itemType===Ms.PLIERS}));if(i){var a=i.node.worldPosition,r=i.getComponent(s).contentSize,o=r.width,l=r.height;o+=40,l+=40,t.setItemMaskTransform(a.x,a.y,o,l),n.node.setWorldPosition(n.node.worldPosition.x,a.y+l/2+30,0)}}},{key:"close",value:(t=Ce(Se().mark((function e(){var t,n,i;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.manager,n=t.guideMasks,i=t.guideInfoText,this.manager.node.scene.emit(pr.RESUME_TIME),e.next=4,n.hide();case 4:i.node.active=!1,this.manager.completeGuide(fd),W.off(va,this.handleViewResized,this),W.off(ma,this.handleViewResized,this);case 8:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),e}();n._RF.pop(),n._RF.push({},"8ab11Ocp6VMg5ZkRHXv4Odu","GuideHand",void 0);var Ld,Od,Dd,Md,Nd,Fd,Bd,Gd=i.ccclass,zd=i.property,Ud=(Sd=Gd("GuideHand"),Ed=zd(a),Cd=zd(a),Td=zd(N),Sd((Rd=Xe((xd=function(e){Ie(n,e);var t=Fe(n);function n(){var e;Te(this,n);for(var i=arguments.length,a=new Array(i),r=0;r<i;r++)a[r]=arguments[r];return Ye(e=t.call.apply(t,[this].concat(a)),"hand",Rd,Me(e)),Ye(e,"circleHighlight",Id,Me(e)),Ye(e,"circleHighlightOpacity",Pd,Me(e)),e}return xe(n,[{key:"start",value:function(){this.circleHighlight.setScale(0,0),this.circleHighlightOpacity.opacity=255}},{key:"playHandAnimation",value:function(e,t){var n=this;this.handTween&&this.handTween.stop();var i=S(this.hand).to(.8,{worldPosition:t},{easing:"quartOut"}).to(.2,{scale:new Y(.9,.9,.9),angle:15}).call((function(){n.playHighlightAnimation()})).to(.2,{scale:Y.ONE,angle:0}).to(.8,{worldPosition:e},{easing:"quartOut"}).to(.2,{scale:new Y(.9,.9,.9),angle:15}).call((function(){n.playHighlightAnimation()})).to(.2,{scale:Y.ONE,angle:0});this.handTween=S(this.hand).repeatForever(i).start()}},{key:"playHighlightAnimation",value:function(){this.circleHighlight.setScale(0,0),this.circleHighlightOpacity.opacity=255,this.circleHighlight.position=this.hand.position.clone(),S(this.circleHighlight).to(.6,{scale:new Y(1.5,1.5)},{easing:"quadOut"}).start(),S(this.circleHighlightOpacity).to(.6,{opacity:0},{easing:"quadIn"}).start()}}]),n}(f)).prototype,"hand",[Ed],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Id=Xe(xd.prototype,"circleHighlight",[Cd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Pd=Xe(xd.prototype,"circleHighlightOpacity",[Td],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ad=xd))||Ad);n._RF.pop(),n._RF.push({},"b2213ccDllApaGIouur6a6b","GameMask",void 0);var Hd,Vd,qd,Wd,Kd,jd,Yd=i.ccclass,Xd=i.property,$d=(Ld=Yd("GameMask"),Od=Xd(s),Dd=Xd(A),Ld((Fd=Xe((Nd=function(e){Ie(n,e);var t=Fe(n);function n(){var e;Te(this,n);for(var i=arguments.length,a=new Array(i),r=0;r<i;r++)a[r]=arguments[r];return Ye(e=t.call.apply(t,[this].concat(a)),"uiTransform",Fd,Me(e)),Ye(e,"sprite",Bd,Me(e)),e}return xe(n,[{key:"texture",get:function(){return this.sprite.spriteFrame.texture}}]),n}(f)).prototype,"uiTransform",[Od],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Bd=Xe(Nd.prototype,"sprite",[Dd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Md=Nd))||Md);n._RF.pop(),n._RF.push({},"ad9c7KiarJHXpRRfn9GOaVx","AlphaMasks",void 0);var Qd,Jd,Zd,ef,tf,nf,af,rf=i.ccclass,of=i.property,sf=i.executeInEditMode,lf=(Hd=rf("AlphaMasks"),Vd=sf(!0),qd=of($d),Hd(Wd=Vd((jd=Xe((Kd=function(e){Ie(n,e);var t=Fe(n);function n(){var e;Te(this,n);for(var i=arguments.length,a=new Array(i),r=0;r<i;r++)a[r]=arguments[r];return Ye(e=t.call.apply(t,[this].concat(a)),"masks",jd,Me(e)),e}return xe(n,[{key:"onLoad",value:function(){this.UITransform=this.node.getComponent(s)}},{key:"start",value:function(){this.material=this.getComponent(A).getMaterialInstance(0)}},{key:"update",value:function(){var e=this,t=this.UITransform,n=t.width,i=t.height;this.masks.forEach((function(t,a){var r=t.uiTransform,o=r.width,s=r.height,l=r.anchorX,u=r.anchorY,c=o*t.node.scale.x,h=s*t.node.scale.y,p=new Q(c/n,h/i),d=new Q(.5+(.5-l)*p.x,.5-(.5-u)*p.y),f=new Q(d.x+(t.node.worldPosition.x-e.node.worldPosition.x)/n,d.y-(t.node.worldPosition.y-e.node.worldPosition.y)/i);e.material.setProperty(`mask${a}Texture`,t.texture),e.material.setProperty(`ratio${a}`,p),e.material.setProperty(`center${a}`,f)}))}},{key:"setMaskActive",value:function(e,t){e>=this.masks.length||this.material.setProperty(`useMask${e}`,t?1:0)}}]),n}(f)).prototype,"masks",[qd],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Wd=Kd))||Wd)||Wd);n._RF.pop(),n._RF.push({},"69569cXv55L852IkWTL0swz","GuideMasks",void 0);var uf,cf,hf,pf,df,ff=i.ccclass,vf=i.property,yf=(Qd=ff("GuideMasks"),Jd=vf(da),Zd=vf(lf),Qd((nf=Xe((tf=function(e){Ie(a,e);var t,n,i=Fe(a);function a(){var e;Te(this,a);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return Ye(e=i.call.apply(i,[this].concat(n)),"background",nf,Me(e)),Ye(e,"alphaMasks",af,Me(e)),e}return xe(a,[{key:"__preload",value:function(){this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){kt.lazyValidateProperties(this)}},{key:"show",value:(n=Ce(Se().mark((function e(){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.background.node.active=!0,e.next=3,this.background.changeStateFade(!0,.25);case 3:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"hide",value:(t=Ce(Se().mark((function e(){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.background.changeStateFade(!1,.25);case 2:this.background.node.active=!1;case 3:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"onClick",value:function(){this.node.scene.emit(pr.GUIDE_MASK_CLICKED)}},{key:"setOtherMaskTransform",value:function(e,t,n,i){this.alphaMasks.masks[1].node.worldPosition=new Y(-9999,-9999,0);var a=this.alphaMasks.masks[0];this.setMaskTransform(a,e,t,n,i)}},{key:"setItemMaskTransform",value:function(e,t,n,i){this.alphaMasks.masks[0].node.worldPosition=new Y(-9999,-9999,0);var a=this.alphaMasks.masks[1];this.setMaskTransform(a,e,t,n,i)}},{key:"setMaskTransform",value:function(e,t,n,i,a){e.uiTransform.setContentSize(i,a),e.node.setWorldPosition(t,n,0)}}]),a}(f)).prototype,"background",[Jd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),af=Xe(tf.prototype,"alphaMasks",[Zd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ef=tf))||ef);n._RF.pop(),n._RF.push({},"abfb9zudJhHdZfeUgbnBrs0","GuideTextBox",void 0);var mf,gf,bf,wf,kf,Sf,Ef,Cf,Tf,Af,xf,Rf,If,Pf=i.ccclass,_f=i.property,Lf=(uf=Pf("GuideTextBox"),cf=_f(u),uf((df=Xe((pf=function(e){Ie(a,e);var t,n,i=Fe(a);function a(){var e;Te(this,a);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return Ye(e=i.call.apply(i,[this].concat(n)),"guideText",df,Me(e)),e}return xe(a,[{key:"__preload",value:function(){this.opacityToggler=this.getComponent(da),kt.lazyValidateProperties(this)}},{key:"setText",value:function(e){this.guideText.string=e}},{key:"show",value:(n=Ce(Se().mark((function e(){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.opacityToggler.changeStateFade(!0);case 2:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"hide",value:(t=Ce(Se().mark((function e(){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.opacityToggler.changeStateFade(!1);case 2:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),a}(f)).prototype,"guideText",[cf],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),hf=pf))||hf);n._RF.pop(),n._RF.push({},"4d800jyvxFJIYnkeNGud6KJ","GuidelinesManager",void 0);var Of,Df,Mf,Nf,Ff,Bf,Gf,zf,Uf,Hf,Vf,qf,Wf,Kf,jf,Yf,Xf,$f,Qf,Jf=game,Zf=Jf.player,ev=Jf.analytics,tv=i.ccclass,nv=i.property,iv=GameCore.Plugins.Analytics.Events,av=new Q(0,10),rv=new Q(0,10),ov="READY",sv="RUNNING",lv=(mf=tv("GuidelinesManager"),gf=nv(Ud),bf=nv(Lf),wf=nv(u),kf=nv(yf),Sf=nv(a),mf((Tf=Xe((Cf=function(e){Ie(i,e);var t,n=Fe(i);function i(){var e;Te(this,i);for(var t=arguments.length,a=new Array(t),r=0;r<t;r++)a[r]=arguments[r];return Ye(e=n.call.apply(n,[this].concat(a)),"guideHand",Tf,Me(e)),Ye(e,"guideTextBox",Af,Me(e)),Ye(e,"guideInfoText",xf,Me(e)),Ye(e,"guideMasks",Rf,Me(e)),Ye(e,"guideSkipButton",If,Me(e)),e.guideHintDelay=null,e.guideStormDelay=null,e}return xe(i,[{key:"init",value:function(e){this.gameplay=e,this.status=ov,this.node.scene.on(pr.COMBO_UPDATED,this.startComboGuide,this),this.node.scene.on(pr.TILE_CLICK,this.startAutoGuides,this),this.node.scene.on(pr.USE_ITEM,this.handleUseItem,this),this.node.scene.on(pr.GAME_FINISH,this.stopAutoGuides,this),this.node.scene.on(pr.GAME_REPLAY,this.stopAutoGuides,this),this.node.scene.on(pr.GAME_PAUSE,this.stopAutoGuides,this)}},{key:"show",value:function(){this.isNewbieGuideLevel()?(this.hasGuideItemShowed(ld)&&this.resetGuideItemShowed(),this.startGuide(ld)):this.startGuide(ud)}},{key:"startGuide",value:function(e){if(this.status===sv)return!1;if(this.hasGuideItemShowed(e))return!1;switch(this.addGuideItemShowed(e),this.status=sv,e){case ld:ev.event(iv.TUTORIAL_BEGIN),this.guide1=new yd(this),this.guide1.setup();break;case ud:this.guide2=new md(this),this.guide2.setup();break;case cd:this.guide3=new gd(this),this.guide3.setup();break;case hd:this.guide4=new bd(this),this.guide4.setup();break;case pd:this.guide5=new wd(this),this.guide5.setup();break;case dd:this.guide6=new kd(this),this.guide6.setup();break;case fd:this.guide7=new _d(this),this.guide7.setup()}return!0}},{key:"completeGuide",value:function(e){ev.event(iv.TUTORIAL_STEP,{step:e}),this.status=ov,this.addGuideItemShowed(e),this.gameplay.stateManager.isPlaying()&&this.startAutoGuides()}},{key:"isHintGuideLevel",value:function(){return this.getCurrentLevel()>=av.x&&this.getCurrentLevel()<=av.y}},{key:"isShowErrorPathLevel",value:function(){return this.getCurrentLevel()>=rv.x&&this.getCurrentLevel()<=rv.y}},{key:"isNewbieGuideLevel",value:function(){return 0===this.getCurrentLevel()}},{key:"hasGuideItemShowed",value:function(e){return-1!==this.getGuideItemShowed().indexOf(e)}},{key:"addGuideItemShowed",value:function(e){if(!this.hasGuideItemShowed(e)){var t=this.getGuideItemShowed();t.push(e),Zf.setGameData({guideItemShowed:t})}}},{key:"resetGuideItemShowed",value:function(){Zf.setGameData({guideItemShowed:[]})}},{key:"getGuideItemShowed",value:function(){var e,t;return null!==(e=null===(t=Zf.getGameData())||void 0===t?void 0:t.guideItemShowed)&&void 0!==e?e:[]}},{key:"getCurrentLevel",value:function(){return this.gameplay.levelManager.getLevelData().level}},{key:"startComboGuide",value:function(e){this.isNewbieGuideLevel()||e<2||(this.startGuide(cd),this.node.scene.off(pr.COMBO_UPDATED,this.startComboGuide,this))}},{key:"startAutoGuides",value:function(){this.startHintGuide(),this.startStormGuide()}},{key:"stopAutoGuides",value:function(){null!==this.guideHintDelay&&this.guideHintDelay.stop(),null!==this.guideStormDelay&&this.guideStormDelay.stop()}},{key:"startHintGuide",value:function(){var e=this;this.isHintGuideLevel()&&(null===this.guideHintDelay&&(this.guideHintDelay=new se(this.node).delay(5).call((function(){e.isNewbieGuideLevel()||(e.hasGuideItemShowed(hd)&&e.status===ov?e.node.scene.emit(pr.SHOW_HINT):e.startGuide(hd),e.startHintGuide())}))),this.guideHintDelay.stop(),this.guideHintDelay.start())}},{key:"startStormGuide",value:function(){var e=this;null===this.guideStormDelay&&(this.guideStormDelay=new se(this.node).delay(10).call((function(){if(!e.isNewbieGuideLevel()&&!e.hasGuideItemShowed(dd)){var t=e.gameplay.itemManager.items.find((function(e){return e.itemType===Ms.STORM}));t&&t.canActivate()&&(e.startGuide(dd)||e.startStormGuide())}}))),this.guideStormDelay.stop(),this.guideStormDelay.start()}},{key:"startThunderGuide",value:function(){return!this.isNewbieGuideLevel()&&this.startGuide(pd)}},{key:"startPliersGuide",value:function(){return!this.isNewbieGuideLevel()&&this.startGuide(fd)}},{key:"handleUseItem",value:function(e){switch(this.startAutoGuides(),e){case Ms.HINT:this.addGuideItemShowed(hd);break;case Ms.THUNDER:this.addGuideItemShowed(pd);break;case Ms.STORM:this.addGuideItemShowed(dd);break;case Ms.PLIERS:this.addGuideItemShowed(fd)}}},{key:"skipNewbieGuide",value:(t=Ce(Se().mark((function e(){var t;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.guideSkipButton.active=!1,e.next=3,this.guide1.close();case 3:t=this.getCurrentLevel()+1,Zf.setGameData({level:t}),this.node.scene.emit(pr.NEXT_LEVEL);case 6:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),i}(f)).prototype,"guideHand",[gf],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Af=Xe(Cf.prototype,"guideTextBox",[bf],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),xf=Xe(Cf.prototype,"guideInfoText",[wf],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Rf=Xe(Cf.prototype,"guideMasks",[kf],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),If=Xe(Cf.prototype,"guideSkipButton",[Sf],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ef=Cf))||Ef);n._RF.pop(),n._RF.push({},"c3d9fl9+INO3ac7Q2zvmRKy","SpecialItem",void 0);var uv,cv=i.ccclass,hv=i.property,pv=(Of=cv("SpecialItem"),Df=hv({editorOnly:!0,tooltip:"A debug button has infinite quantity"}),Mf=hv({type:p,tooltip:"The button that activates the item"}),Nf=hv({type:g,group:"Quantity",tooltip:"The starting quantity of the item",displayName:"Quantity"}),Ff=hv({type:u,group:"Quantity",tooltip:"The label that shows the quantity",displayName:"Label"}),Bf=hv({type:a,group:"Quantity",tooltip:"The node that shows the quantity of the item",displayName:"Quantity node"}),Gf=hv({type:a,group:"Quantity",tooltip:"The node that shows the plus icon when there is no item",displayName:"Plus node"}),zf=hv({type:N,group:"Animation"}),Uf=hv({type:N,tooltip:"The opacity component of the button",displayName:"Button UI Opacity"}),Of((qf=Xe((Vf=function(e){Ie(r,e);var t,n,i,a=Fe(r);function r(){var e;Te(this,r);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return Ye(e=a.call.apply(a,[this].concat(n)),"isDevButton",qf,Me(e)),Ye(e,"button",Wf,Me(e)),Ye(e,"quantity",Kf,Me(e)),Ye(e,"quantityLabel",jf,Me(e)),Ye(e,"quantityNode",Yf,Me(e)),Ye(e,"plusNode",Xf,Me(e)),Ye(e,"glowUIOpacity",$f,Me(e)),Ye(e,"uiOpacity",Qf,Me(e)),e.requestItem=null,e.loadQuantity=null,e}return xe(r,[{key:"itemType",get:function(){}},{key:"onLoad",value:function(){this.validateRequiredComponents()}},{key:"init",value:function(e){var t=this;this.node.scene.on(pr.GRID_CREATE,this.applyActivationStatus,this),this.node.scene.on(pr.GRID_MATCH,this.applyActivationStatus,this),this.node.scene.on(pr.GRID_CLEAR,this.applyActivationStatus,this),this.node.scene.on(pr.IDLE_EXIT,(function(){t.button.interactable=!1,t.applyActivationStatus()})),this.node.scene.on(pr.IDLE_ENTER,(function(){t.button.interactable=!0,t.applyActivationStatus()}))}},{key:"start",value:function(){var e=this.loadQuantity();this.setQuantity(e)}},{key:"validateRequiredComponents",value:function(){kt.lazyValidateProperties(this)}},{key:"applyActivationStatus",value:(i=Ce(Se().mark((function e(){var t;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.canActivate(),this.button.interactable=t,e.next=4,vn.runTweenAsync(S(this.uiOpacity).to(.2,{opacity:t?255:128}));case 4:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"activate",value:(n=Ce(Se().mark((function e(){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(this.quantity<=0)){e.next=3;break}return this.requestItem(),e.abrupt("return");case 3:this.vibrate(),this.setQuantity(this.quantity-1);case 5:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"canActivate",value:function(){return!1}},{key:"setQuantity",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.isDevButton)return this.quantityLabel.string="i",this.quantityNode.active=!0,this.plusNode.active=!1,void this.applyActivationStatus();e<0&&(e=0),this.quantity=e,this.quantityLabel.string=`${this.quantity}`,e<=0?(this.quantityNode.active=!1,this.plusNode.active=!0):(this.quantityNode.active=!0,this.plusNode.active=!1),t&&this.animateAddItem(),this.applyActivationStatus(),this.saveQuantity()}},{key:"getQuantity",value:function(){return this.quantity}},{key:"saveQuantity",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.getQuantity(),t=arguments.length>1?arguments[1]:void 0;this.isDevButton||t&&this.setQuantity(e,t.animate)}},{key:"vibrate",value:function(){var e;null===(e=R("Vibrate"))||void 0===e||null===(e=e.getComponent(Os))||void 0===e||e.vibrate(50)}},{key:"animateAddItem",value:(t=Ce(Se().mark((function e(){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.glowUIOpacity.opacity=0,e.abrupt("return",Promise.all([vn.runTweenAsync(S(this.node).to(.1,{scale:new Y(1.15,1.15,1.15)},{easing:"cubicOut"}).delay(.2).to(.7,{scale:Y.ONE},{easing:"elasticOut"})),vn.runTweenAsync(S(this.glowUIOpacity).to(.1,{opacity:100}).delay(.2).to(.6,{opacity:0}))]));case 2:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),r}(f)).prototype,"isDevButton",[Df],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Wf=Xe(Vf.prototype,"button",[Mf],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Kf=Xe(Vf.prototype,"quantity",[Nf],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),jf=Xe(Vf.prototype,"quantityLabel",[Ff],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Yf=Xe(Vf.prototype,"quantityNode",[Bf],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Xf=Xe(Vf.prototype,"plusNode",[Gf],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),$f=Xe(Vf.prototype,"glowUIOpacity",[zf],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Qf=Xe(Vf.prototype,"uiOpacity",[Uf],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Hf=Vf))||Hf);n._RF.pop(),n._RF.push({},"e1fd9AcoshNdK0i6vow/F2P","ItemManager",void 0);var dv,fv=(0,i.ccclass)("ItemManager")(uv=function(e){Ie(n,e);var t=Fe(n);function n(){var e;Te(this,n);for(var i=arguments.length,a=new Array(i),r=0;r<i;r++)a[r]=arguments[r];return(e=t.call.apply(t,[this].concat(a))).sceneItems=new Set,e}return xe(n,[{key:"items",get:function(){return Ve(this.sceneItems)}},{key:"onLoad",value:function(){this.syncItems()}},{key:"syncItems",value:function(){var e=this,t=R("Canvas/UI");t&&t.getComponentsInChildren(pv).forEach((function(t){t.node.activeInHierarchy&&e.sceneItems.add(t)}))}}]),n}(f))||uv;n._RF.pop(),n._RF.push({},"bbe87JDGgVEkJdgCL2ydwxX","LevelManager",void 0);var vv,yv=i.ccclass,mv=GameCore.Utils,gv={level:1,mode:"normal",time:900,colors:12,specials:{bomb:0,rocket:0},rules:{maxSpaceOfPair:1,addRandomTilesPerMove:0},columns:5,rows:6,theme:["flower"]},bv=yv("LevelManager")(dv=function(e){Ie(a,e);var t,n,i=Fe(a);function a(){return Te(this,a),i.apply(this,arguments)}return xe(a,[{key:"loadLevel",value:(n=Ce(Se().mark((function e(){var t,n,i,a,r,o,s,l,u=arguments;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=u.length>0&&void 0!==u[0]?u[0]:1,n=u.length>1&&void 0!==u[1]?u[1]:gl,e.next=4,this.loadLevelData(t);case 4:return i=e.sent,this.levelData=i||this.levelData||gv,a=this.levelData,r=a.rows,o=a.columns,mv.Device.isMobile()&&o>=6&&r>=10&&(this.levelData.columns=5,this.levelData.rows=10),s=`${Dn.TILE_SKIN_FOLDER}/${n}`,e.next=11,ai.loadSpriteFramesDirAsync(s);case 11:return l=e.sent,e.abrupt("return",l);case 13:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"loadLevelData",value:(t=Ce(Se().mark((function e(){var t,n,i,a,r,o=arguments;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=o.length>0&&void 0!==o[0]?o[0]:1,n=10,i=this.paddingZero(`${Math.floor(t/n)+1}`,3),a=t%n,e.next=6,ai.loadJsonAsync(`${Dn.LEVEL_DATA_FOLDER}/${i}`);case 6:if(r=e.sent){e.next=9;break}return e.abrupt("return",null);case 9:return e.abrupt("return",r[a]);case 10:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"getLevelData",value:function(){return this.levelData}},{key:"paddingZero",value:function(e,t){return Array(t-e.length).fill("0").join("")+e}}]),a}(f))||dv;n._RF.pop(),n._RF.push({},"3f8fenpEyBKaaNxBYL5960v","ScoreManager",void 0);var wv=(0,i.ccclass)("ScoreManager")(vv=function(e){Ie(n,e);var t=Fe(n);function n(){var e;Te(this,n);for(var i=arguments.length,a=new Array(i),r=0;r<i;r++)a[r]=arguments[r];return(e=t.call.apply(t,[this].concat(a))).currentScore=0,e.tournamentStartScore=0,e}return xe(n,[{key:"addScore",value:function(e,t,n){var i=this.getLevelMultiplier(t),a=this.getComboMultiplier(n),r=Math.floor(this.currentScore+e*i*a),o=10*Math.ceil(r/10);this.setScore(o)}},{key:"init",value:function(){this.initCurrentScore(),this.updateScore()}},{key:"initCurrentScore",value:function(){var e=Bl.getMatchMode();this.currentScore=e===GameCore.Match.Modes.TOURNAMENT?this.tournamentStartScore:0}},{key:"setScore",value:function(e){this.currentScore=e,this.updateScore()}},{key:"updateTournamentStartScore",value:function(){this.tournamentStartScore=this.currentScore}},{key:"updateScore",value:function(){this.node.scene.emit(pr.SCORE_UPDATED,this.currentScore)}},{key:"getCurrentScore",value:function(){return this.currentScore}},{key:"getLevelMultiplier",value:function(e){return 1+.1*(e-1)}},{key:"getComboMultiplier",value:function(e){return 1+.1*(e-1)}}]),n}(f))||vv;n._RF.pop(),n._RF.push({},"4a4bfX6KIJCcIozlNHuAwoi","AdsUtils",void 0);var kv=GameCore,Sv=kv.Configs,Ev=kv.Plugins,Cv=globalThis.game.ads,Tv=function(){function e(){Te(this,e)}var t,n,i;return xe(e,[{key:"canbeShowInSDK",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=GameSDK.getSDKName();return(null==t||!t.length||-1===t.indexOf(n))&&(null==e||!e.length||-1!==e.indexOf(n))}}],[{key:"inst",get:function(){return this._instance||(this._instance=new e),this._instance}},{key:"preloadAds",value:(i=Ce(Se().mark((function e(){var t,n,i,a,r,o,s;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=Sv.Ads,n=t.Enabled,i=t.InterstitialAdOptions,a=t.RewardedVideoAdOptions,n){e.next=3;break}return e.abrupt("return");case 3:r=GameCore.Plugins.Ads.Types,o=r.INTERSTITIAL,s=r.REWARDED_VIDEO,i.forEach((function(e){var t=e.PlacementId;Cv.loadAdAsync(o,t).catch((function(){}))})),a.forEach((function(e){var t=e.PlacementId;Cv.loadAdAsync(s,t).catch((function(){}))}));case 6:case"end":return e.stop()}}),e)}))),function(){return i.apply(this,arguments)})},{key:"showBannerAds",value:function(){var e=Sv.Ads,t=e.Enabled,n=e.BannerDisplayAdOptions;if(t){var i=le.instance.getVisibleSize(),a=Zi.worldSizeToCssSize(i.height*Ds);n.forEach((function(e){var t=e.PlacementId,n=e.Position,i=e.BannerHeight;"bottom"===n&&i>a||Cv.showBannerAdAsync(t).catch((function(e){}))}))}}},{key:"hideBannerAds",value:function(){var e=Sv.Ads,t=e.Enabled,n=e.BannerDisplayAdOptions;t&&n.forEach((function(e){var t=e.PlacementId;Cv.hideBannerAdAsync(t).catch((function(e){}))}))}},{key:"showInterstitialAdAsync",value:(n=Ce(Se().mark((function e(t){var n,i,a,r,o,s,l,u,c;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.forLevel,i=void 0===n?1:n,a=t.includeSDK,r=t.excludeSDK,this.inst.canbeShowInSDK(a,r)){e.next=3;break}return e.abrupt("return",!1);case 3:if(!(Sv.Gameplay.StartAdAtLevel>=i)){e.next=5;break}return e.abrupt("return",!1);case 5:if(o=Ev.Ads,s=o.Types,l=o.Status,Cv.canbeShowInterstitialAd()){e.next=8;break}return e.abrupt("return",!1);case 8:if(u=Date.now(),e.prev=9,bi.muteAudio(!0),lu.showLoadingNotificationScreen(),Cv.getAdStatus(s.INTERSTITIAL)===l.FILLED){e.next=16;break}return e.next=16,Cv.loadAdAsync(s.INTERSTITIAL);case 16:return e.next=18,Cv.showAdAsync(s.INTERSTITIAL);case 18:return e.abrupt("return",!0);case 21:return e.prev=21,e.t0=e.catch(9),console.warn("showInterstitialAdAsync failed",e.t0),e.abrupt("return",!1);case 25:return e.prev=25,bi.muteAudio(!1),c=(Date.now()-u)/1e3,setTimeout((function(){lu.closeNotificationScreen()}),c>.5?0:.5),Cv.loadAdAsync(s.INTERSTITIAL).catch((function(){})),e.finish(25);case 31:case"end":return e.stop()}}),e,this,[[9,21,25,31]])}))),function(e){return n.apply(this,arguments)})},{key:"showRewardVideoAdAsync",value:(t=Ce(Se().mark((function e(t){var n,i,a,r,o;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.includeSDK,i=t.excludeSDK,this.inst.canbeShowInSDK(n,i)){e.next=3;break}return e.abrupt("return",!1);case 3:if(a=Ev.Ads,r=a.Types,o=a.Status,e.prev=4,bi.muteAudio(!0),lu.showLoadingNotificationScreen(),Cv.getAdStatus(r.REWARDED_VIDEO)===o.FILLED){e.next=11;break}return e.next=11,Cv.loadAdAsync(r.REWARDED_VIDEO);case 11:return e.next=13,Cv.showAdAsync(r.REWARDED_VIDEO);case 13:return lu.closeNotificationScreen(),e.abrupt("return",!0);case 17:return e.prev=17,e.t0=e.catch(4),console.warn("showRewardVideoAdAsync failed",e.t0),e.t0 instanceof Object&&"code"in e.t0&&"USER_INPUT"===e.t0.code?lu.showNotificationScreen("Sorry, no rewards!\n You have cancelled the ad.",2):lu.showNotificationScreen("No ads to display.",2),e.abrupt("return",!1);case 22:return e.prev=22,bi.muteAudio(!1),Cv.loadAdAsync(r.REWARDED_VIDEO).catch((function(){})),e.finish(22);case 26:case"end":return e.stop()}}),e,this,[[4,17,22,26]])}))),function(e){return t.apply(this,arguments)})}]),e}();try{new Tv}catch(e){console.error("AdsUtils",e)}n._RF.pop(),n._RF.push({},"e6116mseMNPD6VcLUtkvez6","BaseState",void 0);var Av=function(){function e(t){Te(this,e),this.game=null,this.data={},this.game=t.getGameplay(),this.manager=t,this.updateStateData(),this.logDebug()}return xe(e,[{key:"logDebug",value:function(){var e=this.constructor.name;console.info(`[STATE] ${e}`,this.data)}},{key:"updateStateData",value:function(){if(this.game){var e=this.game.getGameData();e&&(this.data=e)}}},{key:"updateGameData",value:function(e){var t;null===(t=this.game)||void 0===t||t.setGameData(e)}}]),e}();n._RF.pop(),n._RF.push({},"e4ee7Ho9zJPVKobpdsCwGlp","FailState",void 0);var xv=globalThis.game,Rv=xv.analytics,Iv=xv.monitorError,Pv=xv.match,_v=xv.player,Lv=xv.storage,Ov=GameCore.Match.Modes,Dv=function(e){Ie(s,e);var t,n,i,a,r,o=Fe(s);function s(e,t){var n;return Te(this,s),n=o.call(this,e),bi.stopAllSounds(),n.vibrateDevice(),n.pauseCountdown(),n.updateMatchCustomData(),n.handleGameOver(t),n.logLevelFailAnalytics(),n}return xe(s,[{key:"pauseCountdown",value:function(){var e;null===(e=this.game)||void 0===e||e.uiManager.pauseTime()}},{key:"vibrateDevice",value:function(){var e;null===(e=R("Vibrate"))||void 0===e||null===(e=e.getComponent(Os))||void 0===e||e.vibrate(500)}},{key:"handleGameOver",value:(r=Ce(Se().mark((function e(t){var n;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=Bl.getMatchMode(),ai.setBlockInput(!0),n!==Ov.SINGLE){e.next=9;break}return e.next=5,this.handleTournamentCreateFlow();case 5:return this.showFailScreen(t),e.abrupt("return");case 9:if(n!==Ov.TOURNAMENT){e.next=14;break}return e.next=12,this.handleTournamentGameOver();case 12:e.next=21;break;case 14:if(n!==Ov.CHALLENGE_FRIEND){e.next=19;break}return e.next=17,this.handleChallengeGameOver();case 17:e.next=21;break;case 19:return this.showFailScreen(t),e.abrupt("return");case 21:ai.setBlockInput(!1);case 22:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"handleTournamentCreateFlow",value:(a=Ce(Se().mark((function e(){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Bl.processCreateTournamentAsync();case 3:e.next=12;break;case 5:if(e.prev=5,e.t0=e.catch(0),!(e.t0 instanceof vl)){e.next=9;break}return e.abrupt("return");case 9:return e.t0 instanceof fl&&(null==Iv||Iv.sendException(e.t0)),console.error(e.t0),e.abrupt("return");case 12:case"end":return e.stop()}}),e,null,[[0,5]])}))),function(){return a.apply(this,arguments)})},{key:"handleTournamentGameOver",value:(i=Ce(Se().mark((function e(){var t,n,i,a,r,o,s,l,u,c=this;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=null===(t=Bl.getMatchCustomData())||void 0===t?void 0:t.tournamentId){e.next=3;break}return e.abrupt("return");case 3:if(!vu.validateTournamentExpired(i)){e.next=10;break}return Lv.setStorageData("tournament","animateTournamentLeader",!1),lu.showNotificationScreen("Tournament has ended",2),null===(a=this.game)||void 0===a||a.scheduleOnce((function(){var e;null===(e=c.game)||void 0===e||e.node.scene.emit(pr.GAME_EXIT)}),2),e.abrupt("return");case 10:return e.prev=10,e.next=13,Bl.finishMatchAsync();case 13:s=Pv.getMatchState(),l=s.profiles,u=null!==(r=Lv.getStorageData("tournament","previousScore"))&&void 0!==r?r:0,(null!==(o=l[_v.getPlayerId()].score)&&void 0!==o?o:0)>u&&Lv.setStorageData("tournament","animateTournamentLeader",!0),e.next=22;break;case 19:e.prev=19,e.t0=e.catch(10),console.warn(e.t0);case 22:null===(n=this.game)||void 0===n||n.node.scene.emit(pr.GAME_EXIT);case 23:case"end":return e.stop()}}),e,this,[[10,19]])}))),function(){return i.apply(this,arguments)})},{key:"handleChallengeGameOver",value:(n=Ce(Se().mark((function e(){var t,n,i,a;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t=Pv.getMatchState(),n=t.id,e.next=4,Pv.api.getMatchAPI().getMatchDetailByIdAsync(n);case 4:return i=e.sent,a=new GameCore.Dtos.Match.Data(i).toObject().extraData,e.next=8,Bl.finishMatchAsync({extraData:null!=a?a:void 0});case 8:e.next=13;break;case 10:e.prev=10,e.t0=e.catch(0),console.warn(e.t0);case 13:this.game.node.scene.emit(pr.SHOW_CHALLENGE_RESULTS);case 14:case"end":return e.stop()}}),e,this,[[0,10]])}))),function(){return n.apply(this,arguments)})},{key:"showFailScreen",value:(t=Ce(Se().mark((function e(t){var n;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=this.data.level,!this.game){e.next=4;break}return e.next=4,Tv.showInterstitialAdAsync({forLevel:n});case 4:bi.turnOffMusic(),t===mu&&bi.playSound(ui.LEVEL_FAIL_TIMEOUT),bi.playSound(ui.LEVEL_FAIL),lu.openScreen(di.RESCUES_SCREEN,{level:n,failKey:t});case 8:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"updateMatchCustomData",value:function(){var e,t,n=this.data.level,i=void 0===n?1:n,a=null!==(e=null===(t=this.game)||void 0===t?void 0:t.scoreManager.getCurrentScore())&&void 0!==e?e:0;Bl.updateMatchStateAfterLevelFinish(i,a)}},{key:"logLevelFailAnalytics",value:function(){if(this.game){var e=this.data.level,t=void 0===e?0:e,n=this.game.scoreManager.getCurrentScore();Rv.levelFail(t,n)}}},{key:"initialize",value:function(){var e=this.manager.createInitializeState(this.manager);this.manager.change(e)}},{key:"ready",value:function(){}},{key:"playing",value:function(){var e=this.manager.createPlayingState(this.manager);this.manager.change(e)}},{key:"fail",value:function(){}},{key:"finish",value:function(){var e=this.manager.createFinishState(this.manager);this.manager.change(e)}},{key:"update",value:function(){}}]),s}(Av);n._RF.pop(),n._RF.push({},"a9bc11SkV9L/5L+Y+fhswfJ","FinishState",void 0);var Mv=globalThis.game,Nv=Mv.analytics,Fv=Mv.player,Bv=Mv.leaderboard,Gv=Mv.match,zv=Mv.monitorError,Uv=GameCore.Match.Modes,Hv=function(e){Ie(s,e);var t,n,i,a,r,o=Fe(s);function s(e){var t;return Te(this,s),(t=o.call(this,e)).handleFinishStateFlow(),t}return xe(s,[{key:"handleFinishStateFlow",value:(r=Ce(Se().mark((function e(){var t,n;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.processCrazyGamesEvent(),this.attemptCallCreateShortcut(),bi.turnUpMusic(),null===(t=this.game)||void 0===t||t.uiManager.pauseTime(),(n=Bl.getMatchMode())!==Uv.CHALLENGE_FRIEND&&this.updatePlayerProgress(),this.updateMatchCustomData(),this.handlePostScoreToLeaderboard(),n!==Uv.CHALLENGE_FRIEND){e.next=12;break}this.handleChallengeOver(),e.next=15;break;case 12:return e.next=14,this.handleTournamentCreateFlow();case 14:this.showLevelCompleteScreen();case 15:this.logLevelCompleteAnalytics();case 16:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"handleChallengeOver",value:(a=Ce(Se().mark((function e(){var t,n,i;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t=Gv.getMatchState(),n=t.id,e.next=4,Bl.getMatchExtraDataAsync(n);case 4:return i=e.sent,e.next=7,Bl.finishMatchAsync({extraData:null!=i?i:void 0});case 7:e.next=14;break;case 9:return e.prev=9,e.t0=e.catch(0),console.warn(e.t0),e.next=14,Bl.finishMatchAsync();case 14:this.game.node.scene.emit(pr.SHOW_CHALLENGE_RESULTS);case 15:case"end":return e.stop()}}),e,this,[[0,9]])}))),function(){return a.apply(this,arguments)})},{key:"processCrazyGamesEvent",value:function(){"gameplayStop"in GameSDK.extra&&GameSDK.extra.gameplayStop()}},{key:"updateMatchCustomData",value:function(){var e,t,n=this.data.level,i=void 0===n?1:n,a=null!==(e=null===(t=this.game)||void 0===t?void 0:t.scoreManager.getCurrentScore())&&void 0!==e?e:0;Bl.updateMatchStateAfterLevelFinish(i,a)}},{key:"logLevelCompleteAnalytics",value:function(){if(this.game){var e=this.data.level,t=void 0===e?0:e,n=this.game.scoreManager.getCurrentScore();Nv.levelComplete(t,n)}}},{key:"showLevelCompleteScreen",value:(i=Ce(Se().mark((function e(){var t,n,i,a;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:i=this.data.level,bi.turnOffMusic(),bi.playSound(ui.LEVEL_COMPLETE),a=null!==(t=null===(n=Fv.getGameData())||void 0===n?void 0:n.coins)&&void 0!==t?t:0,lu.openScreen(di.LEVEL_COMPLETE_SCREEN,{level:i,currentCoin:a});case 5:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"updatePlayerProgress",value:function(){if(this.game){var e=this.data.level;if(e){var t=e+1,n=Fv.getGameData();if(n){var i=n.totalLevel,a=n.level,r=Math.max(a,t),o=ke({},n);r<i&&(o.level=r),Fv.setGameData(o)}}}}},{key:"attemptCallCreateShortcut",value:function(){var e=this.data.level;(void 0===e?0:e)<2||"checkAndCreateShortcutAsync"in GameSDK.extra&&GameSDK.extra.checkAndCreateShortcutAsync().catch((function(e){console.warn("createShortcutAsync",e)}))}},{key:"handleTournamentCreateFlow",value:(n=Ce(Se().mark((function e(){var t,n,i;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Bl.getMatchMode()===Uv.SINGLE){e.next=3;break}return e.abrupt("return");case 3:if(t=Fv.getGameData()){e.next=6;break}return e.abrupt("return");case 6:if(n=t.lastCreateTournamentShown,i=void 0===n?0:n,Date.now()-i>3e5){e.next=10;break}return e.abrupt("return");case 10:return e.prev=10,e.next=13,Bl.processCreateTournamentAsync();case 13:e.next=22;break;case 15:if(e.prev=15,e.t0=e.catch(10),!(e.t0 instanceof vl)){e.next=19;break}return e.abrupt("return");case 19:return e.t0 instanceof fl&&(null==zv||zv.sendException(e.t0)),console.error(e.t0),e.abrupt("return");case 22:case"end":return e.stop()}}),e,null,[[10,15]])}))),function(){return n.apply(this,arguments)})},{key:"handlePostScoreToLeaderboard",value:(t=Ce(Se().mark((function e(){var t,n,i,a,r;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Bl.getMatchMode()===Uv.TOURNAMENT){e.next=3;break}return e.abrupt("return");case 3:if(n=null===(t=this.game)||void 0===t?void 0:t.scoreManager.getCurrentScore()){e.next=6;break}return e.abrupt("return");case 6:return e.prev=6,e.next=9,GameSDK.tournament.postScoreAsync(n);case 9:e.next=14;break;case 11:e.prev=11,e.t0=e.catch(6),console.warn("GameSDK post score async",e.t0);case 14:if(i=Bl.getMatchCustomData()){e.next=17;break}return e.abrupt("return");case 17:if(a=i.leaderboardId,r=i.playerId,a&&r){e.next=20;break}return e.abrupt("return");case 20:return e.next=22,Bv.setLeaderboardScoreAsync(a,r,n);case 22:case"end":return e.stop()}}),e,this,[[6,11]])}))),function(){return t.apply(this,arguments)})},{key:"initialize",value:function(){var e=this.manager.createInitializeState(this.manager);this.manager.change(e)}},{key:"ready",value:function(){}},{key:"playing",value:function(){}},{key:"fail",value:function(){}},{key:"finish",value:function(){}},{key:"update",value:function(){}}]),s}(Av);n._RF.pop(),n._RF.push({},"37a5cRy3ANBGpVlH3wyS3Ra","InitializeState",void 0);var Vv=globalThis.game,qv=Vv.player,Wv=Vv.match,Kv=GameCore.Match.Modes,jv=function(e){Ie(a,e);var t,n,i=Fe(a);function a(e){var t;return Te(this,a),(t=i.call(this,e)).handleSingleGameStart=function(){var e=Ce(Se().mark((function e(n){var i,a,r,o;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.game.levelManager.getLevelData(),r=t.data.level,o=qv.getPlayerId(),e.next=5,Promise.all([Bl.setMatchCustomDataAsync({level:r,score:0}),Bl.setProfileMatchDataAsync({id:o,score:0})]);case 5:return t.game.board.create(n,a),t.game.board.setIgnoreInput(!0),e.next=9,t.game.board.animateTilesAppear();case 9:null!==(i=t.game.guidelinesManager)&&void 0!==i&&i.isNewbieGuideLevel()||t.game.board.setIgnoreInput(!1),t.ready();case 11:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),t.enableUI(),t.clearBoard(),t.loadLevel(),t.initCountdown(),t.initScore(),t}return xe(a,[{key:"enableUI",value:function(){var e;null===(e=this.game)||void 0===e||e.uiManager.enableHeader()}},{key:"clearBoard",value:function(){this.game&&(this.game.rescueTiles=[],this.game.board.destroyTiles(),this.game.pathDraw.clearMatchPath())}},{key:"loadLevel",value:(n=Ce(Se().mark((function e(){var t,n,i,a,r,o,s,l,u,c;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.game){e.next=2;break}return e.abrupt("return");case 2:if(t=Bl.getMatchMode(),e.prev=3,t!==Kv.CHALLENGE_FRIEND){e.next=20;break}return n=Wv.getMatchState(),i=n.id,e.next=8,Bl.getMatchExtraDataAsync(i);case 8:if(null!=(a=e.sent)){e.next=11;break}throw new Error(`Match mode ${Kv.CHALLENGE_FRIEND} but no extraData (for opponent initialization) was found in match data.`);case 11:return r=this.getLevelSkin(a.level),e.next=14,this.game.levelManager.loadLevel(a.level,r);case 14:o=e.sent,this.updateGameData({level:a.level,levelData:this.game.levelManager.getLevelData()}),bi.playSound(ui.LEVEL_START),this.handleChallengeFriendGameStart(o,a),e.next=27;break;case 20:return s=this.getLevelSkin(this.data.level),e.next=23,this.game.levelManager.loadLevel(this.data.level,s);case 23:l=e.sent,this.updateGameData({levelData:this.game.levelManager.getLevelData()}),bi.playSound(ui.LEVEL_START),this.handleSingleGameStart(l);case 27:e.next=39;break;case 29:return e.prev=29,e.t0=e.catch(3),console.error("Error loading level:",e.t0),u=this.getLevelSkin(this.data.level),e.next=35,this.game.levelManager.loadLevel(this.data.level,u);case 35:c=e.sent,this.updateGameData({levelData:this.game.levelManager.getLevelData()}),bi.playSound(ui.LEVEL_START),this.handleSingleGameStart(c);case 39:this.updateGameData({levelData:this.game.levelManager.getLevelData()});case 40:case"end":return e.stop()}}),e,this,[[3,29]])}))),function(){return n.apply(this,arguments)})},{key:"getLevelSkin",value:function(e){var t=xl.getLevelSkin(e),n=xl.getUnlockedSkins();if(n.length<=1)return t;if(G.random()<=.5)return t;var i=n.indexOf(t);return n.splice(i,1),n[G.randomRangeInt(0,n.length)]}},{key:"handleChallengeFriendGameStart",value:(t=Ce(Se().mark((function e(t,n){var i,a,r,o,s,l,u;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=this.game.levelManager.getLevelData(),a=n.level,r=n.fen,o=n.gravity,s=n.rules,l=n.time,u=qv.getPlayerId(),e.next=5,Promise.all([Bl.setMatchCustomDataAsync({level:a,score:0}),Bl.setProfileMatchDataAsync({id:u,score:0})]);case 5:return this.game.board.create(t,ke(ke({},i),{},{level:a,customFen:r,mode:o,rules:s,time:l})),this.game.board.setIgnoreInput(!0),e.next=9,this.game.board.animateTilesAppear();case 9:this.game.board.setIgnoreInput(!1),this.ready();case 11:case"end":return e.stop()}}),e,this)}))),function(e,n){return t.apply(this,arguments)})},{key:"initScore",value:function(){this.game&&this.game.scoreManager.initCurrentScore()}},{key:"initCountdown",value:function(){this.game&&this.game.uiManager.initCountdown()}},{key:"initialize",value:function(){}},{key:"ready",value:function(){var e=this.manager.createReadyState(this.manager);this.manager.change(e)}},{key:"pause",value:function(){}},{key:"playing",value:function(){}},{key:"fail",value:function(){}},{key:"finish",value:function(){}},{key:"update",value:function(){}}]),a}(Av);n._RF.pop(),n._RF.push({},"e3b372NaI5HvY5HnTleBQKd","PlayingState",void 0);var Yv=function(e){Ie(n,e);var t=Fe(n);function n(e){var i;return Te(this,n),(i=t.call(this,e)).startCountdown(),i}return xe(n,[{key:"startCountdown",value:function(){var e;null===(e=this.game)||void 0===e||e.uiManager.startCountdown()}},{key:"initialize",value:function(){var e=this.manager.createInitializeState(this.manager);this.manager.change(e)}},{key:"ready",value:function(){var e=this.manager.createReadyState(this.manager);this.manager.change(e)}},{key:"playing",value:function(){}},{key:"fail",value:function(e){var t=this.manager.createFailState(this.manager,e);this.manager.change(t)}},{key:"finish",value:function(){var e=this.manager.createFinishState(this.manager);this.manager.change(e)}},{key:"update",value:function(){this.updateStateData()}}]),n}(Av);n._RF.pop(),n._RF.push({},"5ef69tJ5eNNv7o22H/XfSD2","ReadyState",void 0);var Xv,$v=globalThis.game,Qv=$v.analytics,Jv=$v.match,Zv=function(e){Ie(n,e);var t=Fe(n);function n(e){var i;return Te(this,n),i=t.call(this,e),bi.stopAllSounds(),bi.turnDownMusic(),i.handleGuideFlow(),i.setLevelText(),i.setLevelTime(),i.setGridPlayable(),i.logLevelStartAnalytics(),i}return xe(n,[{key:"initialize",value:function(){var e=this.manager.createInitializeState(this.manager);this.manager.change(e)}},{key:"ready",value:function(){}},{key:"playing",value:function(){var e=this.manager.createPlayingState(this.manager);this.manager.change(e)}},{key:"fail",value:function(e){if(GameCore.Utils.Valid.isDebugger()){var t=this.manager.createFailState(this.manager);this.manager.change(t)}}},{key:"finish",value:function(){if(GameCore.Utils.Valid.isDebugger()){var e=this.manager.createFinishState(this.manager);this.manager.change(e)}}},{key:"update",value:function(){}},{key:"setGridPlayable",value:function(){var e;null!==(e=this.manager.getGameplay().guidelinesManager)&&void 0!==e&&e.isNewbieGuideLevel()||this.manager.getGameplay().board.setIgnoreInput(!1)}},{key:"handleGuideFlow",value:function(){var e,t;null!==(e=this.game.guidelinesManager)&&void 0!==e&&e.isNewbieGuideLevel()||this.game.handleShowUI(),null===(t=this.game.guidelinesManager)||void 0===t||t.show()}},{key:"setLevelTime",value:function(){if(this.game){var e=this.data.levelData;e&&this.game.uiManager.setCountdownTime(e.time)}}},{key:"setLevelText",value:function(){if(this.game){var e=this.data.level,t=void 0===e?0:e;this.game.uiManager.setLevelText(t)}}},{key:"logLevelStartAnalytics",value:function(){if(this.game){var e=this.data.level,t=void 0===e?0:e,n=Jv.getMatchState().customData.score,i=void 0===n?0:n;Qv.levelStart(t,i)}}}]),n}(Av);n._RF.pop(),n._RF.push({},"bb0e3beWSxOOLCv7gjyg2s0","StateManager",void 0);var ey,ty,ny,iy,ay,ry=(0,i.ccclass)("StateManager")(Xv=function(e){Ie(n,e);var t=Fe(n);function n(){return Te(this,n),t.apply(this,arguments)}return xe(n,[{key:"getGameplay",value:function(){return this.gameplay}},{key:"init",value:function(e){this.gameplay=e,this.state=new jv(this)}},{key:"change",value:function(e){this.state=e}},{key:"initialize",value:function(){this.state.initialize()}},{key:"isInitialize",value:function(){return this.state instanceof jv}},{key:"ready",value:function(){this.state.ready()}},{key:"isReady",value:function(){return this.state instanceof Zv}},{key:"playing",value:function(){this.state.playing()}},{key:"isPlaying",value:function(){return this.state instanceof Yv}},{key:"fail",value:function(e){this.state.fail(e)}},{key:"isFail",value:function(){return this.state instanceof Dv}},{key:"finish",value:function(){this.state.finish()}},{key:"isFinished",value:function(){return this.state instanceof Hv}},{key:"update",value:function(e){this.state&&this.state.update(e)}},{key:"createInitializeState",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return Oe(jv,t)}},{key:"createReadyState",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return Oe(Zv,t)}},{key:"createPlayingState",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return Oe(Yv,t)}},{key:"createFailState",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return Oe(Dv,t)}},{key:"createFinishState",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return Oe(Hv,t)}}]),n}(f))||Xv;n._RF.pop(),n._RF.push({},"659a5DHz/dCjaYaS9/4ZunE","Digit",void 0);var oy,sy,ly,uy,cy,hy,py,dy=i.ccclass,fy=i.property,vy=(ey=dy("Digit"),ty=fy(u),ey((ay=Xe((iy=function(e){Ie(n,e);var t=Fe(n);function n(){var e;Te(this,n);for(var i=arguments.length,a=new Array(i),r=0;r<i;r++)a[r]=arguments[r];return Ye(e=t.call.apply(t,[this].concat(a)),"numberLabels",ay,Me(e)),e.labelUITransforms=[],e.labelUIOpacitys=[],e.previousNumber=0,e}return xe(n,[{key:"onLoad",value:function(){this.uiTransform=this.getComponent(s),this.labelUITransforms=this.numberLabels.map((function(e){return e.getComponent(s)})),this.labelUIOpacitys=this.numberLabels.map((function(e){return e.getComponent(N)})),kt.lazyValidateProperties(this)}},{key:"setNumber",value:function(e){this.previousNumber!==e&&(this.labelUIOpacitys[this.previousNumber].opacity=0,this.numberLabels[e].node.active||(this.numberLabels[e].node.active=!0),this.labelUIOpacitys[e].opacity=255,this.uiTransform.setContentSize(this.labelUITransforms[e].contentSize),this.previousNumber=e)}}]),n}(f)).prototype,"numberLabels",[ty],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),ny=iy))||ny);n._RF.pop(),n._RF.push({},"9e40aEq56tMKLFoeACyl+eH","Clock",void 0);var yy,my=i.ccclass,gy=i.disallowMultiple,by=i.property,wy=(oy=my("Clock"),sy=by(a),ly=by(vy),oy(uy=gy((hy=Xe((cy=function(e){Ie(n,e);var t=Fe(n);function n(){var e;Te(this,n);for(var i=arguments.length,a=new Array(i),r=0;r<i;r++)a[r]=arguments[r];return Ye(e=t.call.apply(t,[this].concat(a)),"clockIcon",hy,Me(e)),Ye(e,"digits",py,Me(e)),e.time=0,e.remaining=0,e.running=!1,e.halfTime=!1,e.handleUpdateConfig=function(t){e.enabled&&console.log("Clock: handleUpdateConfig",t)},e.refillTime=function(){var t=Date.now(),n=S(e.node).to(.5,{scale:new Y(1.1,1.1,1)}),i=S(e.node).to(.5,{scale:new Y(1,1,1)}),a=S(e.clockIcon).to(.15,{angle:-15},{easing:"cubicOut"}).to(.15,{angle:0},{easing:"cubicIn"}).to(.15,{angle:15},{easing:"cubicOut"}).to(.15,{angle:0},{easing:"cubicIn"}),r=S(e.clockIcon).repeat(5,a),o=S(e.node).to(3,{position:new Y(0,0,0)},{onUpdate:function(){var n=Date.now(),i=(n-t)/3e3>1?1:(n-t)/3e3,a=G.lerp(0,120,i);e.setTime(a)}}).call((function(){e.setTime(120),i.start(),e.node.scene.emit(pr.RESCUE_FINISHED)}));S(e.node).parallel(n,o).start(),r.start()},e}return xe(n,[{key:"__preload",value:function(){this.listenEvents()}},{key:"start",value:function(){this.init()}},{key:"init",value:function(){this.running=!1,this.halfTime=!1}},{key:"listenEvents",value:function(){this.node.scene.on(ga,this.handleUpdateConfig),this.node.scene.on(pr.RESCUE_START,this.refillTime)}},{key:"setTime",value:function(e){this.time=e,this.updateTimeLabel(e),this.remaining=e}},{key:"startCountdown",value:function(){this.running=!0,this.remaining=this.time}},{key:"pause",value:function(){this.running=!1}},{key:"resume",value:function(){this.running=!0}},{key:"endCountDown",value:function(){this.running=!1,this.remaining=0,this.node.scene.emit(pr.TIME_OUT)}},{key:"update",value:function(e){this.running&&(this.remaining<=0?this.endCountDown():(this.remaining-=e,!this.halfTime&&this.remaining<=this.time/2&&(this.halfTime=!0,this.node.scene.emit(pr.HALF_TIME)),this.remaining>=0&&this.updateTimeLabel(this.remaining)))}},{key:"updateTimeLabel",value:function(e){for(var t=this.convertSecondsToMmSs(e),n=0;n<t.length;n++)this.digits[n].setNumber(parseInt(t[n]))}},{key:"convertSecondsToMmSs",value:function(e){var t=Math.floor(e/60),n=Math.floor(e%60);return`${this.padZero(t)}${this.padZero(n)}`}},{key:"padZero",value:function(e){return e<10?`0${e}`:`${e}`}}]),n}(f)).prototype,"clockIcon",[sy],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),py=Xe(cy.prototype,"digits",[ly],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),uy=cy))||uy)||uy);n._RF.pop(),n._RF.push({},"ed00dMDxYRJP4fZMawN9JnW","ComboProgressBar",void 0);var ky,Sy,Ey,Cy,Ty,Ay,xy,Ry,Iy,Py=i.ccclass,_y=Py("ComboProgressBar")(yy=function(e){Ie(n,e);var t=Fe(n);function n(){return Te(this,n),t.apply(this,arguments)}return xe(n,[{key:"start",value:function(){this.progressBar=this.getComponent(go),this.opacity=this.getComponent(N),this.comboTimer=0,this.isActive=!1,this.node.scene.on(pr.COMBO_UPDATED,this.handleComboUpdated,this)}},{key:"update",value:function(e){this.isActive&&(this.comboTimer>0?(this.comboTimer-=e,this.progressBar.progress=this.comboTimer/3):(this.isActive=!1,this.opacity.opacity=0,this.node.scene.emit(pr.COMBO_ENDED)))}},{key:"handleComboUpdated",value:function(e){0===e?this.opacity.opacity=0:e>0&&(this.isActive=!0,this.comboTimer=3),e>1&&(this.opacity.opacity=255)}},{key:"pause",value:function(){this.isActive=!1}},{key:"resume",value:function(){this.isActive=!0}}]),n}(f))||yy;n._RF.pop(),n._RF.push({},"46f05OkhTtGz6xBJuPMZGqH","ScoreBlock",void 0);var Ly,Oy,Dy,My,Ny,Fy,By,Gy,zy,Uy,Hy,Vy,qy,Wy,Ky,jy,Yy,Xy=i.ccclass,$y=i.property,Qy=(ky=Xy("ScoreBlock"),Sy=$y(A),Ey=$y(O),Cy=$y(u),ky((xy=Xe((Ay=function(e){Ie(a,e);var t,n,i=Fe(a);function a(){var e;Te(this,a);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return Ye(e=i.call.apply(i,[this].concat(n)),"avatar",xy,Me(e)),Ye(e,"defaultAvatar",Ry,Me(e)),Ye(e,"scoreText",Iy,Me(e)),e}return xe(a,[{key:"onLoad",value:function(){this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){kt.lazyValidateProperties(this)}},{key:"listenGameEvents",value:function(){this.node.scene.on(pr.SCORE_UPDATED,this.updateScore,this)}},{key:"unListenGameEvents",value:function(){this.node.scene.off(pr.SCORE_UPDATED,this.updateScore,this)}},{key:"updateInfo",value:(n=Ce(Se().mark((function e(t,n){var i,a;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n?(this.score=n,this.scoreText.string=n.toString()):(this.score=0,this.scoreText.string="0"),e.prev=1,e.next=4,GameCore.Utils.Image.loadImage(t);case 4:if(i=e.sent){e.next=7;break}return e.abrupt("return");case 7:(a=O.createWithImage(i)).packable=!0,this.avatar.spriteFrame=a,e.next=15;break;case 12:e.prev=12,e.t0=e.catch(1),this.avatar.spriteFrame=this.defaultAvatar;case 15:case"end":return e.stop()}}),e,this,[[1,12]])}))),function(e,t){return n.apply(this,arguments)})},{key:"updateScore",value:(t=Ce(Se().mark((function e(t){var n,i,a=this;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t-this.score,i=S(this.node).to(.1,{},{onUpdate:function(e,t){if(t){var i=Math.floor(n*t)+a.score;a.scoreText.string=i.toString()}}}),e.next=4,vn.runTweenAsync(i);case 4:this.scoreText.string=t.toString(),this.score=t;case 6:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})}]),a}(f)).prototype,"avatar",[Sy],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ry=Xe(Ay.prototype,"defaultAvatar",[Ey],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Iy=Xe(Ay.prototype,"scoreText",[Cy],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ty=Ay))||Ty);n._RF.pop(),n._RF.push({},"61791zAr2tJR4p22EZ5QRfk","Header",void 0);var Jy,Zy,em,tm,nm,im=i.ccclass,am=i.property,rm=globalThis.game.match,om=(Ly=im("Header"),Oy=am(u),Dy=am(a),My=am(a),Ny=am(a),Fy=am(a),By=am(Qy),Gy=am(Qy),Ly((Hy=Xe((Uy=function(e){Ie(n,e);var t=Fe(n);function n(){var e;Te(this,n);for(var i=arguments.length,a=new Array(i),r=0;r<i;r++)a[r]=arguments[r];return Ye(e=t.call.apply(t,[this].concat(a)),"levelText",Hy,Me(e)),Ye(e,"settingNode",Vy,Me(e)),Ye(e,"homeNode",qy,Me(e)),Ye(e,"leftNode",Wy,Me(e)),Ye(e,"coinNode",Ky,Me(e)),Ye(e,"playerScoreBlock",jy,Me(e)),Ye(e,"opponentScoreBlock",Yy,Me(e)),e}return xe(n,[{key:"onLoad",value:function(){this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){kt.lazyValidateProperties(this)}},{key:"handleClickedPauseGame",value:function(){this.showSettingScreen(),this.node.scene.emit(pr.GAME_PAUSE)}},{key:"handleReturnHome",value:function(){lu.openScreen(di.QUIT_LEVEL_SCREEN),this.node.scene.emit(pr.GAME_PAUSE)}},{key:"highlightCoinContainer",value:function(){var e=R("Canvas/Screens");if(e){var t=this.coinNode.worldPosition.clone();this.coinNode.parent=e,this.coinNode.worldPosition=t}}},{key:"removeCoinContainerHighlight",value:function(){var e=this.coinNode.worldPosition.clone();this.coinNode.parent=this.leftNode,this.coinNode.worldPosition=e}},{key:"showSettingScreen",value:function(){lu.openScreen(di.SETTINGS_SCREEN,{})}},{key:"setLevelText",value:function(e){this.levelText.string=`Level ${e}`}},{key:"setButtonsSelectable",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.enableBtnNode(this.settingNode,e,!0),this.enableBtnNode(this.homeNode,e,!0)}},{key:"showChallengeScoreBlock",value:function(){var e=rm.getMatchState(),t=e.id,n=e.customData,i=n.playerId,a=n.opponentId;if(t&&i&&a){this.playerScoreBlock.node.active=!0,this.opponentScoreBlock.node.active=!0,this.playerScoreBlock.listenGameEvents();var r=e.profiles[i],o=e.profiles[a];this.playerScoreBlock.updateInfo(r.photo,r.score),this.opponentScoreBlock.updateInfo(o.photo,o.score)}}},{key:"hideChallengeScoreBlock",value:function(){this.playerScoreBlock.node.active=!1,this.opponentScoreBlock.node.active=!1}},{key:"enableBtnNode",value:function(e,t,n){var i=e.getComponent(p);if(i&&(i.interactable=t),e.active=n,n)e.getComponent(da)}}]),n}(f)).prototype,"levelText",[Oy],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Vy=Xe(Uy.prototype,"settingNode",[Dy],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),qy=Xe(Uy.prototype,"homeNode",[My],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Wy=Xe(Uy.prototype,"leftNode",[Ny],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ky=Xe(Uy.prototype,"coinNode",[Fy],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),jy=Xe(Uy.prototype,"playerScoreBlock",[By],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Yy=Xe(Uy.prototype,"opponentScoreBlock",[Gy],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),zy=Uy))||zy);n._RF.pop(),n._RF.push({},"396015KIPBL3bHTUOHN7pCl","UIMasks",void 0);var sm=i.ccclass,lm=i.property,um=(Jy=sm("UIMasks"),Zy=lm(da),Jy((nm=Xe((tm=function(e){Ie(a,e);var t,n,i=Fe(a);function a(){var e;Te(this,a);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return Ye(e=i.call.apply(i,[this].concat(n)),"background",nm,Me(e)),e}return xe(a,[{key:"__preload",value:function(){this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){kt.lazyValidateProperties(this)}},{key:"show",value:(n=Ce(Se().mark((function e(){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.background.node.active=!0,e.next=3,this.background.changeStateFade(!0,.25);case 3:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"hide",value:(t=Ce(Se().mark((function e(){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.background.changeStateFade(!1,.25);case 2:this.background.node.active=!1;case 3:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),a}(f)).prototype,"background",[Zy],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),em=tm))||em);n._RF.pop(),n._RF.push({},"805dbJxaCpKBpzq9ejSgrc8","TileType",void 0);var cm,hm,pm,dm,fm,vm="bomb";n._RF.pop(),n._RF.push({},"151afQBVDpOYpTjtwP+wYH+","DevTools",void 0);var ym,mm,gm,bm,wm,km,Sm,Em,Cm,Tm,Am,xm,Rm,Im,Pm,_m,Lm,Om,Dm,Mm=GameCore.Dtos.Player,Nm=GameCore.Utils.Function,Fm=i.ccclass,Bm=i.property,Gm=globalThis.game.player,zm=(cm=Fm("DevToolsContainer"),hm=Bm(a),cm((fm=Xe((dm=function(e){Ie(r,e);var t,n,i,a=Fe(r);function r(){var e;Te(this,r);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return Ye(e=a.call.apply(a,[this].concat(n)),"devToolsToggle",fm,Me(e)),e.isActive=!0,e.game=null,e.debouncedStarsNotification=Nm.debounce((function(){var e=Gm.getGameData();e&&lu.showNotificationScreen(`Stars added. Current stars: ${e.stars}`)}),700),e}return xe(r,[{key:"injectGameplay",value:function(e){this.game=e}},{key:"hideAllButtons",value:function(){var e=this;this.getComponentsInChildren(p).forEach((function(t){var n=t.node.parent;n&&n.name!==e.devToolsToggle.name&&(n.active=!1)}))}},{key:"showAllButtons",value:function(){var e=this;this.getComponentsInChildren(p).forEach((function(t){var n=t.node.parent;n&&n.name!==e.devToolsToggle.name&&(n.active=!0)}))}},{key:"handleClickDevToolsButton",value:function(){this.isActive?(this.hideAllButtons(),this.isActive=!1):(this.showAllButtons(),this.isActive=!0)}},{key:"handleResetData",value:function(){Gm.setPlayerData(Mm.Data.getDefaultData()),lu.openScreen(di.NOTIFICATION_SCREEN,{duration:3,message:"Items and stars will only be reset if you refresh the game page now."}),this.node.scene.emit(pr.START_OVER)}},{key:"handleNextLevel",value:(i=Ce(Se().mark((function e(){var t,n,i,a;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=(null!==(t=null===(n=this.game)||void 0===n||null===(n=n.getGameData())||void 0===n?void 0:n.level)&&void 0!==t?t:1)+1,null===(i=this.game)||void 0===i||i.setGameData({level:a-1}),Gm.setGameData({level:a}),this.node.scene.emit(pr.NEXT_LEVEL);case 4:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"handlePrevLevel",value:(n=Ce(Se().mark((function e(){var t,n,i,a;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=Math.max((null!==(t=null===(n=this.game)||void 0===n||null===(n=n.getGameData())||void 0===n?void 0:n.level)&&void 0!==t?t:2)-1,1),null===(i=this.game)||void 0===i||i.setGameData({level:a-1}),Gm.setGameData({level:a}),this.node.scene.emit(pr.NEXT_LEVEL);case 4:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"handleEnterSelectLevel",value:(t=Ce(Se().mark((function e(t){var n,i;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:i=Number(t.string),null===(n=this.game)||void 0===n||n.setGameData({level:i-1}),Gm.setGameData({level:i}),this.node.scene.emit(pr.NEXT_LEVEL);case 4:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"handleClickBuildVersionButton",value:function(){var e=globalThis.game.getBuildVersion();lu.showNotificationScreen(`Build version: ${e}`)}},{key:"handleClickWinLevelButton",value:function(){this.node.scene.emit(pr.GAME_FINISH)}},{key:"handleClickTimeOutButton",value:function(){this.node.scene.emit(pr.TIME_OUT)}},{key:"handleClickExplodeButton",value:function(){var e,t,n=this.game;if(n){var i=null===(e=n.getGameData())||void 0===e||null===(e=e.levelData)||void 0===e?void 0:e.specials.bomb;if(i&&!(i<=0)){var a=n.board.getBombTiles();if(0!==a.length){var r=a[0];if((null===(t=r.special)||void 0===t?void 0:t.type)!==vm)throw new Error("Invalid bomb tile");r.special.detonateImmediately()}else console.info("No bomb tiles found")}}}},{key:"handleFillItem",value:function(){this.node.scene.emit(pr.ADD_ITEM,{animate:function(){return Promise.resolve()},item:Ms.HINT,quantity:2}),this.node.scene.emit(pr.ADD_ITEM,{animate:function(){return Promise.resolve()},item:Ms.STORM,quantity:2}),this.node.scene.emit(pr.ADD_ITEM,{animate:function(){return Promise.resolve()},item:Ms.THUNDER,quantity:2}),this.node.scene.emit(pr.ADD_ITEM,{animate:function(){return Promise.resolve()},item:Ms.PLIERS,quantity:2})}},{key:"handleAutoPlay",value:function(){this.node.scene.emit(pr.AUTO_PLAY)}},{key:"handleAddStars",value:function(){var e=Gm.getGameData();e&&(Gm.setGameData({stars:e.stars+10}),this.debouncedStarsNotification())}},{key:"handleSwitchBundle",value:function(){W.emit(Ea)}}]),r}(f)).prototype,"devToolsToggle",[hm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),pm=dm))||pm);n._RF.pop(),n._RF.push({},"a3b0f6zU+1D97PyszsgST1H","UIManager",void 0);var Um,Hm,Vm,qm,Wm,Km,jm,Ym,Xm,$m=i.ccclass,Qm=i.property,Jm=GameCore,Zm=Jm.Utils,eg=Jm.Match,tg=globalThis.game.match,ng=(ym=$m("UIManager"),mm=Qm(wy),gm=Qm(om),bm=Qm(zm),wm=Qm(_y),km=Qm(a),Sm=Qm(um),Em=Qm([a]),Cm=Qm([a]),ym((xm=Xe((Am=function(e){Ie(o,e);var t,n,i,a,r=Fe(o);function o(){var e;Te(this,o);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return Ye(e=r.call.apply(r,[this].concat(n)),"clock",xm,Me(e)),Ye(e,"header",Rm,Me(e)),Ye(e,"devTools",Im,Me(e)),Ye(e,"comboProgressBar",Pm,Me(e)),Ye(e,"comboContainer",_m,Me(e)),Ye(e,"uiMasks",Lm,Me(e)),Ye(e,"topAnimNodes",Om,Me(e)),e.originTopNodesPos=[],Ye(e,"botAnimNodes",Dm,Me(e)),e.originBotNodesPos=[],e.hideBotWorldY=-80,e.entranceSignal=new On,e.exitSignal=new On,e.showDevTools=function(){e.devTools&&(e.devTools.node.active=!0)},e}return xe(o,[{key:"onLoad",value:function(){var e=this;this.validateRequiredComponents(),this.listensDevToolsEvents(),this.listenRescueEvents(),d.once(J.EVENT_AFTER_UPDATE,(function(){e.saveOriginPos(),e.initUIPos()}))}},{key:"validateRequiredComponents",value:function(){kt.lazyValidateProperties(this)}},{key:"saveOriginPos",value:function(){var e=this;this.topAnimNodes.forEach((function(t){e.originTopNodesPos.push(t.position.clone())})),this.botAnimNodes.forEach((function(t){e.originBotNodesPos.push(t.position.clone())}))}},{key:"initUIPos",value:function(){var e=this;this.topAnimNodes.forEach((function(t,n){var i=e.originTopNodesPos[n].clone();i.y+=200,t.setPosition(i)}));var t=new Y(0,this.hideBotWorldY,0);this.botAnimNodes.forEach((function(n,i){var a,r,o=e.originBotNodesPos[i].clone();t.y=e.hideBotWorldY;var s=null!==(a=null===(r=n.parent)||void 0===r?void 0:r.inverseTransformPoint(t,t).y)&&void 0!==a?a:200;o.y=s,n.setPosition(o)}))}},{key:"listensDevToolsEvents",value:function(){this.node.scene.on(Ws.Events.UNLOCK_DEV_TOOLS,this.showDevTools)}},{key:"listenRescueEvents",value:function(){this.node.scene.on(pr.RESCUE_START,this.showRescueAnimation,this),this.node.scene.on(pr.RESCUE_FINISHED,this.hideRescueAnimation,this)}},{key:"initDevTools",value:function(e){var t=this;window.addEventListener("reset-game-data",(function(){var e;null===(e=t.devTools)||void 0===e||e.handleResetData()})),this.devTools&&(this.devTools.node.active=Zm.Valid.isDebugger(),this.devTools.injectGameplay(e))}},{key:"setLevelText",value:function(e){this.header.setLevelText(e)}},{key:"initCountdown",value:function(){this.clock.init()}},{key:"setCountdownTime",value:function(e){this.clock.setTime(e)}},{key:"startCountdown",value:function(){this.clock.startCountdown()}},{key:"pauseTime",value:function(){this.comboProgressBar.pause(),this.clock.pause()}},{key:"resumeTime",value:function(){this.comboProgressBar.resume(),this.clock.resume()}},{key:"setComboUI",value:function(e){this.comboContainer.getComponent(da).changeStateFade(e,.1)}},{key:"disableHeader",value:function(){this.header.setButtonsSelectable(!1)}},{key:"enableHeader",value:function(){this.header.setButtonsSelectable()}},{key:"updateStatus",value:function(){tg.getMatchState().mode===eg.Modes.CHALLENGE_FRIEND?this.header.showChallengeScoreBlock():this.header.hideChallengeScoreBlock()}},{key:"showRescueAnimation",value:(a=Ce(Se().mark((function e(){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.uiMasks.show();case 2:case"end":return e.stop()}}),e,this)}))),function(){return a.apply(this,arguments)})},{key:"hideRescueAnimation",value:(i=Ce(Se().mark((function e(){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.uiMasks.hide();case 2:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"playExitAnimUI",value:(n=Ce(Se().mark((function e(){var t,n,i=this;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.entranceSignal.abort(),this.exitSignal.abort(),this.exitSignal=new On,t=[],this.topAnimNodes.forEach((function(e,n){var a=new Y(e.position.x,i.originTopNodesPos[n].y+200,0),r=S(e);r.to(.17,{position:a},{easing:"backIn"}),t.push(vn.runTweenAsync(r,i.exitSignal))})),n=new Y(0,this.hideBotWorldY,0),this.botAnimNodes.forEach((function(e){var a,r;n.y=i.hideBotWorldY;var o=null!==(a=null===(r=e.parent)||void 0===r?void 0:r.inverseTransformPoint(n,n).y)&&void 0!==a?a:200,s=new Y(e.position.x,o,0),l=S(e);l.to(.17,{position:s},{easing:"backIn"}),t.push(vn.runTweenAsync(l,i.exitSignal))})),e.next=9,Promise.all(t);case 9:if(!this.exitSignal.aborted){e.next=11;break}return e.abrupt("return");case 11:this.header.node.active=!1;case 12:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"playEntranceAnimUI",value:(t=Ce(Se().mark((function e(){var t,n=this;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.exitSignal.abort(),this.entranceSignal.abort(),this.entranceSignal=new On,this.header.node.active=!0,t=[],this.topAnimNodes.forEach((function(e,i){var a=new Y(e.position.x,n.originTopNodesPos[i].y,0),r=S(e);r.to(.2,{position:a},{easing:"backOut"}),t.push(vn.runTweenAsync(r,n.entranceSignal))})),this.botAnimNodes.forEach((function(e,i){var a=new Y(e.position.x,n.originBotNodesPos[i].y,0),r=S(e);r.to(.2,{position:a},{easing:"backOut"}),t.push(vn.runTweenAsync(r,n.entranceSignal))})),e.next=9,Promise.all(t);case 9:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"highlightCoinContainer",value:function(){this.header.highlightCoinContainer()}},{key:"unHighlightCoinContainer",value:function(){this.header.removeCoinContainerHighlight()}},{key:"setInteractableItemButtons",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.botAnimNodes.forEach((function(t){var n=t.getComponent(pv);if(n){if(!e)return void(n.button.interactable=!1);n.canActivate()&&(n.button.interactable=!0)}}))}}]),o}(f)).prototype,"clock",[mm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Rm=Xe(Am.prototype,"header",[gm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Im=Xe(Am.prototype,"devTools",[bm],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Pm=Xe(Am.prototype,"comboProgressBar",[wm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_m=Xe(Am.prototype,"comboContainer",[km],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Lm=Xe(Am.prototype,"uiMasks",[Sm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Om=Xe(Am.prototype,"topAnimNodes",[Em],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Dm=Xe(Am.prototype,"botAnimNodes",[Cm],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Tm=Am))||Tm);n._RF.pop(),n._RF.push({},"157f203vjtMma2FDvAlyM6h","Gameplay",void 0);var ig=globalThis.game,ag=ig.player,rg=ig.ads,og=ig.event,sg=ig.match,lg=ig.storage,ug=ig.analytics,cg=ig.monitorError,hg=ig.frameCapture,pg=ig.leaderboard,dg=GameCore.Events,fg=GameCore.Match.Modes,vg=GameCore.Utils.Time,yg=GameCore.Configs.Gameplay,mg=i.ccclass,gg=i.property,bg=[];Um=mg("Gameplay"),Hm=gg(dh),Vm=gg(da),qm=gg(ap),Um((jm=Xe((Km=function(e){Ie(i,e);var t,n=Fe(i);function i(){var e;Te(this,i);for(var t=arguments.length,a=new Array(t),r=0;r<t;r++)a[r]=arguments[r];return Ye(e=n.call.apply(n,[this].concat(a)),"board",jm,Me(e)),Ye(e,"opacityToggler",Ym,Me(e)),Ye(e,"pathDraw",Xm,Me(e)),e.gameData=null,e.defaultData={level:1,isMatchStartFromLoader:!1},e.rescueTiles=[],e.isAutoPlayEnabled=!1,e.handleOpenScreen=function(t){t.screenName===fi[di.GET_ITEM_SCREEN]&&e.uiManager.highlightCoinContainer()},e.handleShowUI=Ce(Se().mark((function t(){return Se().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.uiManager.updateStatus(),e.uiManager.disableHeader(),e.uiManager.setInteractableItemButtons(!1),t.next=5,e.uiManager.playEntranceAnimUI();case 5:e.uiManager.enableHeader(),e.uiManager.setInteractableItemButtons(!0);case 7:case"end":return t.stop()}}),t)}))),e.handleHideUI=Ce(Se().mark((function t(){return Se().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.uiManager.disableHeader(),e.uiManager.setInteractableItemButtons(!1),t.next=4,e.uiManager.playExitAnimUI();case 4:case"end":return t.stop()}}),t)}))),e.handleCloseScreen=function(t){t.screenName===fi[di.GET_ITEM_SCREEN]&&e.uiManager.unHighlightCoinContainer()},e.handlePauseGame=function(){e.node.scene.emit(pr.PAUSE_TIME),e.node.pauseSystemEvents(!0),e.opacityToggler.changeStateFade(!1,.1),e.uiManager.setComboUI(!1),e.processCrazyGamesGameplayStop()},e.handleResumeGame=function(){var t;e.node.resumeSystemEvents(!0),e.stateManager.isPlaying()&&e.node.scene.emit(pr.RESUME_TIME),e.processCrazyGamesGameplayStart(),e.opacityToggler.changeStateFade(!0,.1),e.uiManager.setComboUI(!0),null===(t=e.guidelinesManager)||void 0===t||t.startAutoGuides()},e.handleReplayGame=function(){var t=Ce(Se().mark((function t(n){var i;return Se().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.handleHideHint(),i=ke(ke({},e.defaultData),n),t.prev=2,sg.getMatchState().mode!==fg.SINGLE){t.next=6;break}return t.next=6,Bl.finishMatchAsync();case 6:if(sg.getMatchState().mode===fg.CHALLENGE_FRIEND){t.next=9;break}return t.next=9,Bl.startMatchAsync();case 9:t.next=14;break;case 11:t.prev=11,t.t0=t.catch(2),console.warn("handleReplayGame",t.t0);case 14:e.setGameData(i),e.stateManager.initialize();case 16:case"end":return t.stop()}}),t,null,[[2,11]])})));return function(e){return t.apply(this,arguments)}}(),e.handleFinishGame=function(){var t;e.attemptCallCreateShortcut(),null!==(t=e.guidelinesManager)&&void 0!==t&&t.isNewbieGuideLevel()?(e.guidelinesManager.guideSkipButton.active=!1,e.handleNextLevel()):e.stateManager.finish()},e.handleNextLevel=Ce(Se().mark((function t(){var n,i,a;return Se().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.gameData){t.next=2;break}return t.abrupt("return");case 2:if(t.prev=2,sg.getMatchState().mode!==fg.SINGLE){t.next=6;break}return t.next=6,Bl.finishMatchAsync();case 6:return sg.getMatchState().mode===fg.TOURNAMENT&&e.scoreManager.updateTournamentStartScore(),t.next=9,Bl.startMatchAsync();case 9:t.next=14;break;case 11:t.prev=11,t.t0=t.catch(2),console.warn("handleReplayGame",t.t0);case 14:i=null!==(n=e.gameData.level)&&void 0!==n?n:1,a=i+1,e.setGameData({level:a}),e.stateManager.initialize(),console.log("Next level",e.gameData.level);case 19:case"end":return t.stop()}}),t,null,[[2,11]])}))),e.handleStartOver=Ce(Se().mark((function t(){var n;return Se().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:ag.setGameData({level:yg.Tutorial.Enabled?0:1}),e.gameData=ag.getGameData(),e.stateManager.initialize(),console.info("Start over",null===(n=e.gameData)||void 0===n?void 0:n.level);case 4:case"end":return t.stop()}}),t)}))),e.handleMaxLevel=function(){e.gameData&&(e.initData(),lu.openScreen(di.CONGRATULATION_SCREEN,{level:e.gameData.level}),console.info("Max level",e.gameData.level))},e.handleExitGame=Ce(Se().mark((function e(){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:try{lg.setStorageData("dashboard","animateToCurrentLevel",!0),lg.setStorageData("collection","animateMapPackUnlock",!0)}catch(e){console.warn("handleExitGame",e)}case 1:case"end":return e.stop()}}),e)}))),e.handleTileClick=function(t){e.stateManager.playing(),e.board.handleTileClick(t),e.handleHideHint()},e.handleGridMatchSuccess=function(t,n){e.pathDraw.drawMatchPath(t,(function(t){var n=t.x,i=t.y;return e.board.getAnyTileWorldPosition(n,i)})),e.comboManager.addCombo(),e.handleAddScore(),e.effectManager.playClearFXAt([n[0].node.worldPosition,n[1].node.worldPosition])},e.handleGridMatchFail=function(t){var n;null!==(n=e.guidelinesManager)&&void 0!==n&&n.isShowErrorPathLevel()&&e.pathDraw.drawErrorPath(t,(function(t){var n=t.x,i=t.y;return e.board.getAnyTileWorldPosition(n,i)}))},e.checkIfGameIsFinish=function(){0===e.board.getUncleared().length&&e.node.scene.emit(pr.GAME_FINISH)},e.handlePauseTime=function(){e.uiManager.pauseTime()},e.handleResumeTime=function(){e.uiManager.resumeTime()},e.handleClockTimeout=function(){e.stateManager.fail(mu)},e.handleHalfTime=function(){void 0!==e.guidelinesManager&&(e.board.getUncleared().length>=e.board.getCleared().length&&e.guidelinesManager.startThunderGuide()||e.board.getBombTiles().length>0&&e.guidelinesManager.startPliersGuide())},e.handleStartRescue=function(){var t,n;for(ai.setBlockInput(!0),e.board.setIgnoreInput(!0);e.rescueTiles.length>0;){var i=e.rescueTiles.pop();null==i||i.restore()}ug.levelRescue(null!==(t=null===(n=e.gameData)||void 0===n?void 0:n.level)&&void 0!==t?t:1)},e.handleFinishRescue=function(){ai.setBlockInput(!1),e.board.setIgnoreInput(!1)},e.handleBombExplode=function(){var t=Ce(Se().mark((function t(n){var i;return Se().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.rescueTiles.push(n),e.board.setIgnoreInput(!0),ai.getBlockInput()||(bi.playSound(ui.BOMB_EXPLODE_1),ai.setBlockInput(!0)),i=n.node.worldPosition,t.next=6,e.effectManager.createBombExplosionAt(new Y(i.x,i.y,0));case 6:if(ai.setBlockInput(!1),!e.stateManager.isFail()){t.next=9;break}return t.abrupt("return");case 9:e.stateManager.fail(gu);case 10:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),e.handleShowHint=function(){if(!e.pathDraw.isDrawingHint){var t=e.board.getHintPath();t&&(bi.playSound(ui.HINT_ITEM),e.pathDraw.drawHintPath(t,(function(t){return e.board.getAnyTileWorldPosition(t.x,t.y)})),e.board.showHint())}},e.handleHideHint=function(){e.pathDraw.isDrawingHint&&(e.pathDraw.clearHintPath(),e.board.hideHint())},e.handleAddScore=function(){var t=e.levelManager.getLevelData().level,n=e.comboManager.getCombo();e.scoreManager.addScore(10,t,n)},e.handleUseItem=function(t){e.stateManager.playing(),t!==Ms.HINT&&e.handleHideHint()},e.handleAutoPlay=function(){e.isAutoPlayEnabled?e.disableAutoPlay():e.enableAutoPlay()},e.enableAutoPlay=function(){e.isAutoPlayEnabled=!0;e.node.scene.once(pr.GAME_FINISH,(function(){e.disableAutoPlay()})),e.schedule(e.autoPlay,.5)},e.disableAutoPlay=function(){e.isAutoPlayEnabled=!1,e.unschedule(e.autoPlay)},e.autoPlay=function(){var t=e.board.getHintPath();if(!t)throw new Error("No path found");var n=t[0].a,i=t.slice(-1)[0].b,a=e.board.getTileAt(n.x,n.y),r=e.board.getTileAt(i.x,i.y);if(!a||!r)throw new Error("Tile is null");a.onClick(),r.onClick()},e.handleAddStars=function(t){var n=ag.getGameData();if(!n)return Promise.resolve([]);ag.setGameData({stars:n.stars+1});var i=t.startAnimationAt;i&&e.effectManager.playStarFXAt(i)},e.handleInviteFriends=Ce(Se().mark((function t(){var n,i,a,r,o,s,l,u,c,h,p,d,f,v;return Se().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,lu.showLoadingScreen(),r=e.board.generateFenFromCurrentLevel(),o=null!==(n=ag.getGameData())&&void 0!==n?n:{},s=o.level,l=void 0===s?1:s,l=Math.max(1,l),u=null!==(i=null===(a=e.gameData)||void 0===a?void 0:a.levelData)&&void 0!==i?i:{},c=u.mode,h=void 0===c?"":c,p=u.rules,d=void 0===p?{addRandomTilesPerMove:0,maxSpaceOfPair:0}:p,f=u.time,v=void 0===f?0:f,hg.addWideframeRender("renderResultChallenge",cl),t.next=9,sg.context.choose.processAsync({playerId:ag.getPlayerId(),fallbackSingleMode:!1,extraData:{level:l,fen:r,gravity:h,rules:d,time:v}});case 9:lu.closeLoadingScreen(),e.node.scene.emit(pr.GAME_RESUME),e.node.scene.emit(pr.GAME_REPLAY,{level:l}),t.next=24;break;case 14:if(t.prev=14,t.t0=t.catch(0),console.warn("Unable to invite friends",t.t0),lu.closeLoadingScreen(),lu.showNotificationScreen("Sorry, please try again later"),t.t0 instanceof Error){t.next=21;break}return t.abrupt("return");case 21:null==cg||cg.sendException(t.t0),e.node.scene.emit(pr.GAME_RESUME),e.node.scene.emit(pr.SHOW_UI);case 24:case"end":return t.stop()}}),t,null,[[0,14]])}))),e.handleReplayFriends=Ce(Se().mark((function t(){var n,i,a,r,o,s,l,u,c,h,p,d,f,v,y;return Se().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(i=null!==(n=ag.getGameData())&&void 0!==n?n:{},a=i.level,r=void 0===a?1:a,t.prev=1,l=sg.getMatchState().customData.opponentId){t.next=5;break}throw new Error("Opponent id is not found");case 5:return lu.showLoadingScreen(),u=e.board.generateFenFromCurrentLevel(),c=null!==(o=null===(s=e.gameData)||void 0===s?void 0:s.levelData)&&void 0!==o?o:{},h=c.mode,p=void 0===h?"":h,d=c.rules,f=void 0===d?{addRandomTilesPerMove:0,maxSpaceOfPair:0}:d,v=c.time,y=void 0===v?0:v,t.next=10,sg.challenge.friend.processAsync({playerId:ag.getPlayerId(),opponentId:l,extraData:{level:r,fen:u,gravity:p,rules:f,time:y}});case 10:lu.closeLoadingScreen(),e.node.scene.emit(pr.GAME_RESUME),e.node.scene.emit(pr.GAME_REPLAY,{level:r}),t.next=25;break;case 15:if(t.prev=15,t.t0=t.catch(1),console.warn("ReplayChallengeFriend",t.t0),lu.closeLoadingScreen(),lu.showNotificationScreen("Sorry, you cannot replay\nat this time.",3),t.t0 instanceof Error){t.next=22;break}return t.abrupt("return");case 22:null==cg||cg.sendException(t.t0),e.node.scene.emit(pr.GAME_RESUME),e.node.scene.emit(pr.GAME_REPLAY,{level:r});case 25:case"end":return t.stop()}}),t,null,[[1,15]])}))),e.handleAdShow=function(t){var n=t.placementId;n&&-1!==bg.indexOf(n)&&(bg.splice(bg.indexOf(n),1),rg.hideBannerAdAsync(n).catch((function(){})),0===bg.length&&og.off(GameCore.Events.AD_SHOWING,e.handleAdShow))},e.handleAddItem=function(){var t=Ce(Se().mark((function t(n){var i,a,r,o,s,l;return Se().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(i=n.animate,a=n.item,r=n.quantity,void 0!==(o=e.itemManager.items.find((function(e){return e.itemType===a})))){t.next=5;break}return console.warn(`Item ${a} not found`),t.abrupt("return");case 5:return s=o.getQuantity(),l=s+r,o.saveQuantity(l),e.uiManager.setInteractableItemButtons(!1),e.handlePauseGame(),t.next=12,i();case 12:o.setQuantity(l,!0),e.uiManager.setInteractableItemButtons(!0),e.handleResumeGame();case 15:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),e}return xe(i,[{key:"__preload",value:function(){this.initComponents(),this.validateRequiredComponents(),this.listenCoreEvents(),this.listenInputEvents(),this.listenFlowEvents()}},{key:"onLoad",value:function(){xl.init()}},{key:"initComponents",value:function(){this.initUIManager(),this.initLevelManager(),this.initStateManager(),this.initEffectManager(),this.initItemManager(),this.initComboManager(),this.initScoreManager(),this.initInputController(),this.initGuidelinesManager()}},{key:"initUIManager",value:function(){var e;this.uiManager=null===(e=this.node.parent)||void 0===e?void 0:e.getComponentInChildren(ng),this.uiManager.initDevTools(this)}},{key:"initLevelManager",value:function(){this.levelManager=this.getComponent(bv)}},{key:"initStateManager",value:function(){this.stateManager=this.getComponent(ry)}},{key:"initInputController",value:function(){this.inputController=this.getComponent(bu)}},{key:"initEffectManager",value:function(){this.effectManager=this.getComponent(rd)}},{key:"initItemManager",value:function(){var e=this;this.itemManager=this.getComponent(fv),this.itemManager.syncItems(),this.itemManager.items.forEach((function(t){t.init(e)}))}},{key:"initComboManager",value:function(){this.comboManager=this.getComponent(Sp),this.comboManager.init()}},{key:"initScoreManager",value:function(){this.scoreManager=this.getComponent(wv),this.scoreManager.init()}},{key:"initGuidelinesManager",value:function(){yg.Tutorial.Enabled&&(this.guidelinesManager=this.getComponent(lv),this.guidelinesManager.init(this))}},{key:"validateRequiredComponents",value:function(){kt.lazyValidateProperties(this)}},{key:"listenCoreEvents",value:function(){bg=[],og.off(GameCore.Events.AD_SHOWING,this.handleAdShow),og.clear(dg.OPENING_SCREEN),og.clear(dg.CLOSING_SCREEN),og.on(dg.OPENING_SCREEN,this.handleOpenScreen),og.on(dg.CLOSING_SCREEN,this.handleCloseScreen)}},{key:"listenInputEvents",value:function(){this.node.scene.on(pr.SHOW_UI,this.handleShowUI),this.node.scene.on(pr.HIDE_UI,this.handleHideUI),this.node.scene.on(pr.GAME_PAUSE,this.handlePauseGame),this.node.scene.on(pr.GAME_RESUME,this.handleResumeGame),this.node.scene.on(pr.GAME_REPLAY,this.handleReplayGame),this.node.scene.on(pr.GAME_FINISH,this.handleFinishGame),this.node.scene.on(pr.NEXT_LEVEL,this.handleNextLevel),this.node.scene.on(pr.START_OVER,this.handleStartOver),this.node.scene.on(pr.MAX_LEVEL,this.handleMaxLevel),this.node.scene.on(pr.GAME_EXIT,this.handleExitGame),this.node.scene.on(pr.TILE_CLICK,this.handleTileClick),this.node.scene.on(pr.GRID_MATCH_SUCCESS,this.handleGridMatchSuccess),this.node.scene.on(pr.GRID_MATCH_FAIL,this.handleGridMatchFail),this.node.scene.on(pr.PAUSE_TIME,this.handlePauseTime),this.node.scene.on(pr.RESUME_TIME,this.handleResumeTime),this.node.scene.on(pr.TIME_OUT,this.handleClockTimeout),this.node.scene.on(pr.HALF_TIME,this.handleHalfTime),this.node.scene.on(pr.RESCUE_START,this.handleStartRescue),this.node.scene.on(pr.RESCUE_FINISHED,this.handleFinishRescue),this.node.scene.on(pr.BOMB_EXPLODE,this.handleBombExplode),this.node.scene.on(pr.SHOW_HINT,this.handleShowHint),this.node.scene.on(pr.ADD_SCORE,this.handleAddScore),this.node.scene.on(pr.GRID_CLEAR,this.checkIfGameIsFinish),this.node.scene.on(pr.USE_ITEM,this.handleUseItem),this.node.scene.on(pr.ADD_ITEM,this.handleAddItem),this.node.scene.on(pr.AUTO_PLAY,this.handleAutoPlay),this.node.scene.on(pr.ADD_STARS,this.handleAddStars)}},{key:"listenFlowEvents",value:function(){this.node.scene.on(pr.INVITE_FRIENDS,this.handleInviteFriends),this.node.scene.on(pr.REPLAY_FRIENDS,this.handleReplayFriends)}},{key:"start",value:function(){this.initDataFirstTime(),this.initGame(),this.trySetTournamentStorage()}},{key:"initDataFirstTime",value:function(){var e=this.getSceneData(),t=(null!=e?e:{}).level;void 0===t&&(t=Bl.getMatchMode()===fg.TOURNAMENT?1:0),this.initData(),this.setGameData({level:t})}},{key:"initData",value:function(){var e,t=null!==(e=ag.getGameData())&&void 0!==e?e:{},n=t.level,i=void 0===n?1:n,a=t.items;a&&this.checkItemsRewardable()&&(a.hint<5&&(a.hint+=1),a.thunder<5&&(a.thunder+=1),a.storm<5&&(a.storm+=1),a.pliers<5&&(a.pliers+=1),ag.setGameData({items:a,lastRewardedItems:Date.now()})),this.setGameData(ke(ke({},this.defaultData),{},{level:i}))}},{key:"checkItemsRewardable",value:function(){var e,t=(null!==(e=ag.getGameData())&&void 0!==e?e:{}).lastRewardedItems,n=void 0===t?0:t;return!vg.isToday(n)}},{key:"initGame",value:function(){this.stateManager.init(this),this.stateManager.initialize()}},{key:"trySetTournamentStorage",value:(t=Ce(Se().mark((function e(){var t,n,i,a,r,o,s,l;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Bl.getMatchMode()===fg.TOURNAMENT){e.next=3;break}return e.abrupt("return");case 3:if(n=null!==(t=Bl.getMatchCustomData())&&void 0!==t?t:{},i=n.leaderboardId){e.next=6;break}return e.abrupt("return");case 6:return e.next=8,vu.requestTournamentDataAsync();case 8:if(a=pg.getLeaderboardName(i)){e.next=11;break}return e.abrupt("return");case 11:return e.next=13,pg.getLeadersByPlayerIdsAsync(a,[ag.getPlayerId()]);case 13:if(0!==(r=e.sent).length){e.next=16;break}return e.abrupt("return");case 16:o=r[0],s=o.score,l=o.rank,lg.setStorageData("tournament","previousScore",s),lg.setStorageData("tournament","previousRank",l);case 19:case"end":return e.stop()}}),e)}))),function(){return t.apply(this,arguments)})},{key:"setGameData",value:function(e){var t,n,i,a=null!==(t=null!==(n=e.level)&&void 0!==n?n:null===(i=this.gameData)||void 0===i?void 0:i.level)&&void 0!==t?t:1;this.gameData=ke(ke(ke({},this.gameData),e),{},{level:a})}},{key:"getGameData",value:function(){return this.gameData}},{key:"getSceneData",value:function(){return Yl.getSceneData(this.node.scene)}},{key:"attemptCallCreateShortcut",value:function(){var e,t=null!==(e=this.getGameData())&&void 0!==e?e:{},n=t.level,i=void 0===n?0:n,a=t.nextLevelCount;i<2||(void 0===a?0:a)<2||"checkAndCreateShortcutAsync"in GameSDK.extra&&GameSDK.extra.checkAndCreateShortcutAsync().catch((function(e){console.warn("checkAndCreateShortcutAsync",e)}))}},{key:"processCrazyGamesGameplayStart",value:function(){"gameplayStart"in GameSDK.extra&&GameSDK.extra.gameplayStart()}},{key:"processCrazyGamesGameplayStop",value:function(){"gameplayStop"in GameSDK.extra&&GameSDK.extra.gameplayStop()}},{key:"disableRewardAdsItemForCrazyGames",value:function(){GameSDK.getSDKName()}}]),i}(f)).prototype,"board",[Hm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ym=Xe(Km.prototype,"opacityToggler",[Vm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Xm=Xe(Km.prototype,"pathDraw",[qm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Wm=Km));n._RF.pop(),n._RF.push({},"c863f/bTTdAjqEM+Kj9OaKi","DashboardEventButtonTypes",void 0);var wg=function(e){return e[e.STAR_CHEST=0]="STAR_CHEST",e[e.BALLOON=1]="BALLOON",e}(wg||{});x(wg),n._RF.pop(),n._RF.push({},"17fa4eEXEhIfZh+ad9Oqcmw","Leaderboard",void 0);var kg,Sg=function(e){return e.WORLD_TAB_SELECTED="world-tab-selected",e.FRIENDS_TAB_SELECTED="friends-tab-selected",e}(Sg||{}),Eg="#AE4212",Cg="#3D5172",Tg="#92200C",Ag="#8F5542",xg="#8A4733",Rg="#3e7110",Ig="#3e7110";n._RF.pop(),n._RF.push({},"4cd93d4ECxKDYSG9apAx603","LevelMission",void 0),n._RF.pop(),n._RF.push({},"78297LLtrJKMpOIidCw/BA9","index",void 0),n._RF.pop(),n._RF.push({},"176c3V0yoFEhIdpVcCIhDz7","isEmptyBoard",void 0),n._RF.pop(),n._RF.push({},"5262atLmldNy7Q3MtHgiSRI","HintItem",void 0);var Pg,_g=i.ccclass,Lg=globalThis.game,Og=Lg.player,Dg=Lg.analytics;_g("HintItem")(kg=function(e){Ie(i,e);var t,n=Fe(i);function i(){var e;Te(this,i);for(var t=arguments.length,a=new Array(t),r=0;r<t;r++)a[r]=arguments[r];return(e=n.call.apply(n,[this].concat(a))).requestItem=function(){lu.openScreen(di.GET_ITEM_SCREEN,{item:Ms.HINT,message:"Shows a pair of tiles\nthat can be connected.",quantity:1})},e.loadQuantity=function(){var e=Og.getGameData();return null!=e&&e.items&&e?e.items[Ms.HINT]:0},e}return xe(i,[{key:"itemType",get:function(){return Ms.HINT}},{key:"init",value:function(e){this.boardInstance=e.board,this.pathDrawer=e.pathDraw,this.setQuantity(this.loadQuantity()),Ge(Pe(i.prototype),"init",this).call(this,e)}},{key:"onDestroy",value:function(){var e;if(this.boardInstance){this.node.scene.targetOff(this);var t,n=this.boardInstance.node;if(null!=n)this.boardInstance.node.targetOff(this),null===(e=Ge(Pe(i.prototype),"onDestroy",this))||void 0===e||e.call(this);else null===(t=Ge(Pe(i.prototype),"onDestroy",this))||void 0===t||t.call(this)}}},{key:"validateRequiredComponents",value:function(){Ge(Pe(i.prototype),"validateRequiredComponents",this).call(this),kt.lazyValidateProperties(this)}},{key:"canActivate",value:function(){try{return this.boardInstance.getUncleared().length>0}catch(e){return!1}}},{key:"activate",value:(t=Ce(Se().mark((function e(){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.pathDrawer.isDrawingHint){e.next=2;break}return e.abrupt("return");case 2:if(!(this.getQuantity()<=0)){e.next=6;break}return e.next=5,Ge(Pe(i.prototype),"activate",this).call(this);case 5:return e.abrupt("return");case 6:return e.next=8,Ge(Pe(i.prototype),"activate",this).call(this);case 8:Dg.event(GameCore.Plugins.Analytics.Events.USE_ITEM,{item_name:Ms.HINT}),this.node.scene.emit(pr.USE_ITEM,Ms.HINT),this.node.scene.emit(pr.SHOW_HINT);case 11:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"saveQuantity",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.getQuantity(),t=arguments.length>1?arguments[1]:void 0;Ge(Pe(i.prototype),"saveQuantity",this).call(this,e,t);var n=Og.getGameData();n&&Og.setGameData({items:ke(ke({},n.items),{},{[Ms.HINT]:e})})}}]),i}(pv));n._RF.pop(),n._RF.push({},"3f4c1AB+jdNFqylpogoaiDZ","PliersItem",void 0);var Mg,Ng=i.ccclass,Fg=globalThis.game,Bg=Fg.player,Gg=Fg.analytics;Ng("PliersItem")(Pg=function(e){Ie(i,e);var t,n=Fe(i);function i(){var e;Te(this,i);for(var t=arguments.length,a=new Array(t),r=0;r<t;r++)a[r]=arguments[r];return(e=n.call.apply(n,[this].concat(a))).requestItem=function(){lu.openScreen(di.GET_ITEM_SCREEN,{item:Ms.PLIERS,message:"Removes a random bomb\nfrom the game field.",quantity:1})},e.loadQuantity=function(){var e=Bg.getGameData();return null!=e&&e.items&&e?e.items[Ms.PLIERS]:0},e}return xe(i,[{key:"itemType",get:function(){return Ms.PLIERS}},{key:"init",value:function(e){this.boardInstance=e.board,this.effectManager=e.effectManager,Ge(Pe(i.prototype),"init",this).call(this,e)}},{key:"onDestroy",value:function(){var e;if(this.boardInstance){this.node.scene.targetOff(this);var t,n=this.boardInstance.node;if(null!=n)this.boardInstance.node.targetOff(this),null===(e=Ge(Pe(i.prototype),"onDestroy",this))||void 0===e||e.call(this);else null===(t=Ge(Pe(i.prototype),"onDestroy",this))||void 0===t||t.call(this)}}},{key:"validateRequiredComponents",value:function(){Ge(Pe(i.prototype),"validateRequiredComponents",this).call(this),kt.lazyValidateProperties(this)}},{key:"canActivate",value:function(){try{return this.boardInstance.getBombTiles().length>0}catch(e){return!1}}},{key:"activate",value:(t=Ce(Se().mark((function e(){var t,n;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(this.getQuantity()<=0)){e.next=4;break}return e.next=3,Ge(Pe(i.prototype),"activate",this).call(this);case 3:return e.abrupt("return");case 4:return e.next=6,Ge(Pe(i.prototype),"activate",this).call(this);case 6:Gg.event(GameCore.Plugins.Analytics.Events.USE_ITEM,{item_name:Ms.PLIERS}),this.node.scene.emit(pr.USE_ITEM,Ms.PLIERS),t=dc(this.boardInstance.getBombTiles()),n=t.node.worldPosition,this.effectManager.createDefuseExplosionAt(new Y(n.x,n.y,0)),bi.playSound(ui.BOMB_DEFUSE),t.special.switch(ec.none),this.applyActivationStatus();case 14:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"saveQuantity",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.getQuantity(),t=arguments.length>1?arguments[1]:void 0;Ge(Pe(i.prototype),"saveQuantity",this).call(this,e,t);var n=Bg.getGameData();n&&Bg.setGameData({items:ke(ke({},n.items),{},{[Ms.PLIERS]:e})})}}]),i}(pv));n._RF.pop(),n._RF.push({},"d6e51+oy6NCF7cKvf6KOWiu","StormItem",void 0);var zg,Ug=i.ccclass,Hg=globalThis.game,Vg=Hg.player,qg=Hg.analytics;Ug("StormItem")(Mg=function(e){Ie(i,e);var t,n=Fe(i);function i(){var e;Te(this,i);for(var t=arguments.length,a=new Array(t),r=0;r<t;r++)a[r]=arguments[r];return(e=n.call.apply(n,[this].concat(a))).requestItem=function(){lu.openScreen(di.GET_ITEM_SCREEN,{item:Ms.STORM,message:"Randomly rearranges the \ntiles on the game field.",quantity:1})},e.loadQuantity=function(){var e=Vg.getGameData();return null!=e&&e.items&&e?e.items[Ms.STORM]:0},e}return xe(i,[{key:"itemType",get:function(){return Ms.STORM}},{key:"init",value:function(e){this.boardInstance=e.board,this.effectManager=e.effectManager,Ge(Pe(i.prototype),"init",this).call(this,e)}},{key:"onDestroy",value:function(){var e;if(this.boardInstance){this.node.scene.targetOff(this);var t,n=this.boardInstance.node;if(null!=n)this.boardInstance.node.targetOff(this),null===(e=Ge(Pe(i.prototype),"onDestroy",this))||void 0===e||e.call(this);else null===(t=Ge(Pe(i.prototype),"onDestroy",this))||void 0===t||t.call(this)}}},{key:"validateRequiredComponents",value:function(){Ge(Pe(i.prototype),"validateRequiredComponents",this).call(this),kt.lazyValidateProperties(this)}},{key:"canActivate",value:function(){try{return this.boardInstance.getUncleared().length>2}catch(e){return!1}}},{key:"activate",value:(t=Ce(Se().mark((function e(){var t,n,a=this;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(this.getQuantity()<=0)){e.next=4;break}return e.next=3,Ge(Pe(i.prototype),"activate",this).call(this);case 3:return e.abrupt("return");case 4:return e.next=6,Ge(Pe(i.prototype),"activate",this).call(this);case 6:return qg.event(GameCore.Plugins.Analytics.Events.USE_ITEM,{item_name:Ms.STORM}),this.node.scene.emit(pr.USE_ITEM,Ms.STORM),this.node.scene.emit(pr.HIDE_UI),t=new Promise((function(e){return a.scheduleOnce(e,.5)})),e.next=12,Promise.race([this.effectManager.loadTornadoAnimation(),t]);case 12:n=function(){var e=Ce(Se().mark((function e(t,n){var i,r;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return bi.muteMusic(!0),bi.playSound(ui.SHUFFLE_ITEM),bi.playSound(ui.WIND),i=function(){return Promise.all(t.map((function(e,n,i){return e.sync({duration:.4,easing:"smooth",getTargetPosition:function(){return rc(t,a.boardInstance.getTileSize(),{x:n,y:i},10)}})})))},r=function(){var e=Ce(Se().mark((function e(){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n.forEach((function(e,t,i){e.node.setSiblingIndex(n.asArray().length-1-(t+i*n.width))})),e.next=3,Promise.all(n.map((function(e){return e.fly({getTilePosition:function(e){return rc(n,a.boardInstance.getTileSize(),e)}})})));case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),e.next=7,i();case 7:return a.effectManager.playTornadoAnimation(),e.next=10,r();case 10:a.node.scene.emit(pr.SHOW_UI),bi.muteMusic(!1);case 12:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),this.boardInstance.processShuffleRequest(n);case 14:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"saveQuantity",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.getQuantity(),t=arguments.length>1?arguments[1]:void 0;Ge(Pe(i.prototype),"saveQuantity",this).call(this,e,t);var n=Vg.getGameData();n&&Vg.setGameData({items:ke(ke({},n.items),{},{[Ms.STORM]:e})})}}]),i}(pv));n._RF.pop(),n._RF.push({},"b30ffJjU2lAH5yu2NkzVVnO","ThunderItem",void 0);var Wg,Kg=i.ccclass,jg=globalThis.game,Yg=jg.player,Xg=jg.analytics;Kg("ThunderItem")(zg=function(e){Ie(i,e);var t,n=Fe(i);function i(){var e;Te(this,i);for(var t=arguments.length,a=new Array(t),r=0;r<t;r++)a[r]=arguments[r];return(e=n.call.apply(n,[this].concat(a))).requestItem=function(){lu.openScreen(di.GET_ITEM_SCREEN,{item:Ms.THUNDER,message:"Remove 2 pair of tiles\non the game field.",quantity:1})},e.loadQuantity=function(){var e=Yg.getGameData();return null!=e&&e.items&&e?e.items[Ms.THUNDER]:0},e}return xe(i,[{key:"itemType",get:function(){return Ms.THUNDER}},{key:"init",value:function(e){this.boardInstance=e.board,this.effectManager=e.effectManager,Ge(Pe(i.prototype),"init",this).call(this,e)}},{key:"onDestroy",value:function(){var e;if(this.boardInstance){this.node.scene.targetOff(this);var t,n=this.boardInstance.node;if(null!=n)this.boardInstance.node.targetOff(this),null===(e=Ge(Pe(i.prototype),"onDestroy",this))||void 0===e||e.call(this);else null===(t=Ge(Pe(i.prototype),"onDestroy",this))||void 0===t||t.call(this)}}},{key:"validateRequiredComponents",value:function(){Ge(Pe(i.prototype),"validateRequiredComponents",this).call(this),kt.lazyValidateProperties(this)}},{key:"canActivate",value:function(){try{return this.boardInstance.getUncleared().length>=4}catch(e){return!1}}},{key:"activate",value:(t=Ce(Se().mark((function e(){var t,n;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(this.getQuantity()<=0)){e.next=4;break}return e.next=3,Ge(Pe(i.prototype),"activate",this).call(this);case 3:return e.abrupt("return");case 4:return e.next=6,Ge(Pe(i.prototype),"activate",this).call(this);case 6:return Xg.event(GameCore.Plugins.Analytics.Events.USE_ITEM,{item_name:Ms.THUNDER}),this.node.scene.emit(pr.USE_ITEM,Ms.THUNDER),this.node.scene.emit(pr.HIDE_UI),e.next=11,this.effectManager.loadThunderAnimation();case 11:if(bi.muteMusic(!0),!((t=this.boardInstance.getUncleared()).length<4)){e.next=15;break}throw new Error("Not enough uncleared tiles");case 15:return n=this.boardInstance.getPairs(2),ai.setBlockInput(!0),this.boardInstance.clearSelectedTile(),e.next=20,this.effectManager.playThunderAnimation(n,this.boardInstance);case 20:t.length>4&&this.node.scene.emit(pr.SHOW_UI),bi.muteMusic(!1),ai.setBlockInput(!1);case 23:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"saveQuantity",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.getQuantity(),t=arguments.length>1?arguments[1]:void 0;Ge(Pe(i.prototype),"saveQuantity",this).call(this,e,t);var n=Yg.getGameData();n&&Yg.setGameData({items:ke(ke({},n.items),{},{[Ms.THUNDER]:e})})}}]),i}(pv));n._RF.pop(),n._RF.push({},"0a97aK0agJOHb07cLs0JICj","PathHolder",void 0);var $g,Qg,Jg,Zg,eb,tb,nb,ib,ab,rb,ob,sb,lb,ub=i.ccclass,cb=i.requireComponent;ub("PathHolder")(Wg=cb(N)(Wg=function(e){Ie(n,e);var t=Fe(n);function n(){return Te(this,n),t.apply(this,arguments)}return xe(n,[{key:"onLoad",value:function(){var e=this;this.node.scene.on(pr.GRID_RESIZE,(function(t){e.node.setScale(t,t)}))}}]),n}(f))||Wg);n._RF.pop(),n._RF.push({},"944cbG3+yRMsJZimXjukGdn","Coin",void 0);var hb,pb,db,fb,vb,yb,mb,gb=i.ccclass,bb=i.property,wb=($g=gb("Coin"),Qg=bb(re),Jg=bb(re),Zg=bb(y),eb=bb(_),tb=bb(_),$g((ab=Xe((ib=function(e){Ie(n,e);var t=Fe(n);function n(){var e;Te(this,n);for(var i=arguments.length,a=new Array(i),r=0;r<i;r++)a[r]=arguments[r];return Ye(e=t.call.apply(t,[this].concat(a)),"explodeParticles",ab,Me(e)),Ye(e,"emittingParticles",rb,Me(e)),Ye(e,"animation",ob,Me(e)),Ye(e,"spin",sb,Me(e)),Ye(e,"rest",lb,Me(e)),e}return xe(n,[{key:"__preload",value:function(){kt.lazyValidateProperties(this)}},{key:"playAnimation",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1?arguments[1]:void 0;t>0&&this.scheduleOnce((function(){null!=n&&n.aborted||e.animation.play(e.spin.name)}),t),this.animation.play(this.spin.name)}},{key:"stopAnimation",value:function(){this.animation.play(this.rest.name)}}]),n}(f)).prototype,"explodeParticles",[Qg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),rb=Xe(ib.prototype,"emittingParticles",[Jg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ob=Xe(ib.prototype,"animation",[Zg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),sb=Xe(ib.prototype,"spin",[eb],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),lb=Xe(ib.prototype,"rest",[tb],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),nb=ib))||nb);n._RF.pop(),n._RF.push({},"0c6a8vx5IhFvKJ5IUimm0Je","CoinTextPopup",void 0);var kb,Sb,Eb,Cb,Tb,Ab,xb,Rb,Ib,Pb=i.ccclass,_b=i.property,Lb=Y.ZERO.clone().add3f(0,-100,0),Ob=Y.ZERO.clone().add3f(0,100,0),Db=(hb=Pb("CoinTextPopup"),pb=_b(u),db=_b(N),hb((yb=Xe((vb=function(e){Ie(i,e);var t,n=Fe(i);function i(){var e;Te(this,i);for(var t=arguments.length,a=new Array(t),r=0;r<t;r++)a[r]=arguments[r];return Ye(e=n.call.apply(n,[this].concat(a)),"label",yb,Me(e)),Ye(e,"uiOpacity",mb,Me(e)),e}return xe(i,[{key:"__preload",value:function(){kt.lazyValidateProperties(this),this.node.active=!1}},{key:"show",value:(t=Ce(Se().mark((function e(t,n){var i;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=GameCore.Utils.Number.getShortNumber(t,3),this.label.string=i,this.node.active=!0,this.uiOpacity.opacity=255,this.node.setScale(.5,.5,.5),this.node.setPosition(Lb),e.next=8,Promise.all([vn.runTweenAsync(S(this.node).to(1.5,{position:Ob},{easing:"sineOut"}),n),vn.runTweenAsync(S(this.node).to(.5,{scale:Y.ONE},{easing:"backOut"}),n)]);case 8:return this.node.setScale(Y.ONE),this.node.setPosition(Ob),
//! not subscribed to signal because in the case the user skipped the animation we'd still want them to see this node disappear
e.next=12,vn.runTweenAsync(S(this.uiOpacity).to(.5,{opacity:0}));case 12:this.node.active=!1;case 13:case"end":return e.stop()}}),e,this)}))),function(e,n){return t.apply(this,arguments)})}]),i}(f)).prototype,"label",[pb],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),mb=Xe(vb.prototype,"uiOpacity",[db],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),fb=vb))||fb);n._RF.pop(),n._RF.push({},"8a5c3m7o41LNqGBKPo0oqf1","CoinManager",void 0);var Mb=i.ccclass,Nb=i.disallowMultiple,Fb=i.property,Bb=globalThis.game,Gb=Bb.player,zb=Bb.monitorError,Ub=999999999,Hb=10,Vb=1,qb=1,Wb=(kb=Mb("CoinManager"),Sb=Fb(I),Eb=Fb(I),Cb=Fb(a),kb(Tb=Nb((xb=Xe((Ab=function(e){Ie(s,e);var t,n,i,a,r,o=Fe(s);function s(){var e;Te(this,s);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return(e=o.call.apply(o,[this].concat(n))).coins=0,Ye(e,"coinPrefab",xb,Me(e)),Ye(e,"coinTextPopup",Rb,Me(e)),Ye(e,"coinAnimContainer",Ib,Me(e)),e.collectionAnimSignal=null,e.coinObjects=[],e}return xe(s,[{key:"__preload",value:function(){this.lifeCycleSignal=new On,this.validateRequiredComponents(),this.getCoinsFromPlayerData()}},{key:"onLoad",value:function(){this.prepareCoinCollection(),this.prepareCoinTextPopup(),this.listenToCoinEvents()}},{key:"start",value:function(){this.emitCoinAmount()}},{key:"init",value:function(e){this.updateCoins({coins:this.coins,collectionAnimation:void 0}),this.animSkipOverlay=e}},{key:"listenToCoinEvents",value:function(){this.node.scene.on(pr.ADD_COINS,this.addCoins,this),this.node.scene.on(pr.REMOVE_COINS,this.removeCoins,this)}},{key:"validateRequiredComponents",value:function(){kt.lazyValidateProperties(this)}},{key:"prepareCoinCollection",value:function(){for(var e=0;e<Hb;e++){var t=l(this.coinPrefab);t.setParent(this.coinAnimContainer),t.setPosition(0,0),t.active=!1,this.coinObjects.push(t.getComponent(wb))}}},{key:"prepareCoinTextPopup",value:function(){var e=l(this.coinTextPopup);e.setParent(this.node),e.active=!1,this.coinTextPopupNode=e.getComponent(Db)}},{key:"handleCollectionAnim",value:(r=Ce(Se().mark((function e(t,n,i){var a,r,o,s,l,u=this;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.targetContainer){e.next=3;break}return console.warn("No target coin container assigned to CoinManager. No coin collection animation will be played"),e.abrupt("return");case 3:if(0!==(o=this.coinObjects.slice(0,this.getShortAmount(t))).length){e.next=8;break}return console.warn(`Requested coins amount is ${t}. Shortened to ${this.getShortAmount(t)}. No coin objects was found to animate collection.`),null==zb||zb.sendException(new Error(`Requested coins amount is ${t}. Shortened to ${this.getShortAmount(t)}. No coin objects was found to animate collection.`),{coins:t,animatedCoins:o.length,hasCoinTextPopup:!!this.coinTextPopupNode,hasTargetContainer:!!this.targetContainer,coinCollectionCount:this.coinObjects.length}),e.abrupt("return");case 8:return e.next=10,null===(a=this.animSkipOverlay)||void 0===a?void 0:a.open({onSkip:function(){return u.collectionAnimSignal.abort()},opacity:150});case 10:return bi.playSound(ui.COLLECT_STOCK_COINS),s=o.map(function(){var e=Ce(Se().mark((function e(t){var a,r,o,s;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.explodeParticles.stopSystem(),t.emittingParticles.stopSystem(),t.node.active=!0,a=[0,.5*Math.min(n,i)],r=ie.apply(void 0,a),o=n-r,s=i+r,e.next=9,u.animateCoinExplode(t.node,o);case 9:return t.playAnimation(2*r,u.collectionAnimSignal),t.emittingParticles.resetSystem(),e.next=13,u.animateCoinFlyBack(u.collectionAnimSignal,t,s);case 13:t.emittingParticles.stopSystem(),t.stopAnimation();case 15:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),l=function(){var e=Ce(Se().mark((function e(){var t;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all(s);case 2:return e.next=4,null===(t=u.targetContainer)||void 0===t?void 0:t.emitExplodeEffect(u.collectionAnimSignal);case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),e.next=15,Promise.all([l(),this.animateCoinTextPopup(t,this.collectionAnimSignal,n+i/2)]);case 15:return e.next=17,null===(r=this.animSkipOverlay)||void 0===r?void 0:r.close();case 17:this.collectionAnimSignal.abort();case 18:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return r.apply(this,arguments)})},{key:"animateCoinTextPopup",value:(a=Ce(Se().mark((function e(t,n,i){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,vn.waitTweenAsync(i,n);case 2:return e.next=4,this.coinTextPopupNode.show(t,n);case 4:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return a.apply(this,arguments)})},{key:"animateCoinFlyBack",value:(i=Ce(Se().mark((function e(t,n,i){var a,r,o,s=this;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=n.node.worldPosition.clone(),r=Y.ZERO.clone(),o=this.targetContainer.getCoinIconWorldScale(),e.next=5,vn.runTweenAsync(S(n.node).to(i,{scale:o},{onUpdate:function(e,t){if(void 0!==t){var i=M.cubicIn(t),o=s.targetContainer.getCoinIconWorldPosition();n.node.worldPosition=Y.lerp(r,a,o,i)}}}),t);case 5:n.node.scale=Y.ZERO,this.explodeParticlesAndDisableAfter(1,n);case 7:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return i.apply(this,arguments)})},{key:"explodeParticlesAndDisableAfter",value:(n=Ce(Se().mark((function e(t,n){var i;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(i=n.explodeParticles).resetSystem(),e.next=4,vn.waitTweenAsync(t/10,this.lifeCycleSignal);case 4:if(!On.hasBeenAborted(this.lifeCycleSignal)){e.next=6;break}return e.abrupt("return");case 6:return i.stopSystem(),e.next=9,vn.waitTweenAsync(t/10*9,this.lifeCycleSignal);case 9:if(!On.hasBeenAborted(this.lifeCycleSignal)){e.next=11;break}return e.abrupt("return");case 11:n.node.setPosition(0,0,n.node.position.z),n.node.active=!1;case 13:case"end":return e.stop()}}),e,this)}))),function(e,t){return n.apply(this,arguments)})},{key:"animateCoinExplode",value:(t=Ce(Se().mark((function e(t,n){var i,a,r,o,s;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=[-200,200],r=ie((i=[-200,200])[0],i[1]),o=ie(a[0],a[1]),t.setPosition(0,0,t.position.z),t.setScale(Y.ZERO),s=new Y(r,o,t.position.z),e.next=9,Promise.all([vn.runTweenAsync(S(t).delay(.1*n).to(.8*n,{scale:Y.ONE},{easing:"elasticOut"}),this.collectionAnimSignal),vn.runTweenAsync(S(t).to(n,{position:s},{easing:"circOut"}),this.collectionAnimSignal)]);case 9:case"end":return e.stop()}}),e,this)}))),function(e,n){return t.apply(this,arguments)})},{key:"getCoinsFromPlayerData",value:function(){var e=Gb.getGameData();this.coins=e?e.coins:0}},{key:"getCoins",value:function(){return this.coins}},{key:"updateCoins",value:function(e){var t,n;if(console.info("updateCoins",e.coins,null===(t=e.collectionAnimation)||void 0===t?void 0:t.animateTextOnly),this.coins>Ub&&(this.coins=Ub),e.coins!==this.coins){var i=Math.max(0,e.coins-this.coins);this.coins=e.coins,Gb.setGameData({coins:this.coins});var a=e.collectionAnimation;if(void 0===a||a.animateTextOnly)this.node.scene.emit(pr.COIN_CHANGED,ke(ke({},e),{},{collectionAnimation:{animateTextOnly:!0,signal:this.collectionAnimSignal}}));else{null===(n=this.collectionAnimSignal)||void 0===n||n.abort();var r=a.floatDuration,o=void 0===r?Vb:r,s=a.flyDuration,l=void 0===s?qb:s,u=a.signal,c=void 0===u?new On:u,h=a.target,p=void 0===h?this.targetContainer:h;this.collectionAnimSignal=c,this.targetContainer=p;var d=ke(ke({},e),{},{collectionAnimation:{floatDuration:o,flyDuration:l,animateTextOnly:!1,signal:c,target:p}});this.node.scene.emit(pr.COIN_CHANGED,d),this.handleCollectionAnim(i,o,l)}}}},{key:"addCoins",value:function(e){this.updateCoins(ke(ke({},e),{},{coins:this.coins+e.coins}))}},{key:"removeCoins",value:function(e){this.coins<e.coins?this.node.scene.emit(pr.REMOVE_COINS_FAILED):(this.updateCoins(ke(ke({},e),{},{coins:this.coins-e.coins})),this.node.scene.emit(pr.REMOVE_COINS_SUCCESS))}},{key:"emitCoinAmount",value:function(){this.node.scene.emit(pr.COIN_CHANGED,{coins:this.coins})}},{key:"getShortAmount",value:function(e){return Math.min(e,Hb)}},{key:"untilFinishesCollectAnim",value:function(){return null===this.collectionAnimSignal?Promise.resolve():this.collectionAnimSignal.untilAborted()}},{key:"setTargetContainer",value:function(e){this.targetContainer=e}},{key:"getTargetContainer",value:function(){return this.targetContainer}},{key:"onDestroy",value:function(){var e,t;null===(e=this.collectionAnimSignal)||void 0===e||e.abort(),null===(t=this.lifeCycleSignal)||void 0===t||t.abort()}}]),s}(f)).prototype,"coinPrefab",[Sb],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Rb=Xe(Ab.prototype,"coinTextPopup",[Eb],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ib=Xe(Ab.prototype,"coinAnimContainer",[Cb],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Tb=Ab))||Tb)||Tb);n._RF.pop(),n._RF.push({},"d2a57+mB4NG9rcdh+dy1VPe","traverse4",void 0),n._RF.pop(),n._RF.push({},"ca614iJ+X5LrL1rX/wDQDTD","shuffle",void 0),n._RF.pop(),n._RF.push({},"1cf4cygDSdP5JL+7w3wIJL7","traverseRandom",void 0),n._RF.pop(),n._RF.push({},"1faa9NgJrBE7p8Zs/HBWrZn","pad",void 0),n._RF.pop(),n._RF.push({},"f3b1eQ+t3FJYa35I0oznLiF","ParticleProperties",void 0);var Kb,jb,Yb,Xb,$b,Qb=xe((function e(){Te(this,e),this.lifeCurrent=0,this.life=0,this.velocityX=0,this.velocityY=0,this.alpha=255,this.totalRotation=0,this.lastChange=0,this.currentFrame=0}));n._RF.pop(),n._RF.push({},"32b8eGxcghFHZOi1WYXHCjF","BaseParticle",void 0);var Jb,Zb,ew,tw,nw,iw,aw,rw=i.ccclass,ow=i.property,sw=(Kb=rw("BaseParticle"),jb=ow(A),Kb(($b=Xe((Xb=function(e){Ie(n,e);var t=Fe(n);function n(){var e;Te(this,n);for(var i=arguments.length,a=new Array(i),r=0;r<i;r++)a[r]=arguments[r];return Ye(e=t.call.apply(t,[this].concat(a)),"sprite",$b,Me(e)),e.properties=new Qb,e}return xe(n,[{key:"__preload",value:function(){this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){if(!this.sprite)throw new Error("BaseParticle: Sprite not found")}},{key:"manualInit",value:function(e,t){this.manager=e;var n=t.tint,i=t.velocityX,a=t.velocityY,o=t.totalRotation,s=t.lifespan,l=t.startAngle,u=t.scale;this.properties.lastChange=0;var c=new r;r.fromHEX(c,n),this.sprite.color=c,this.properties.velocityX=i,this.properties.velocityY=a,this.properties.life=s,this.properties.lifeCurrent=s,this.properties.totalRotation=o,this.node.angle=l,this.node.setScale(u,u,1)}},{key:"manualUpdate",value:function(e){return this.computeVelocity(e),this.node.setPosition(this.node.position.x+this.properties.velocityX*e,this.node.position.y+this.properties.velocityY*e,0),this.node.angle+=this.properties.totalRotation*e/this.properties.life,this.properties.lifeCurrent-=e,this.properties.lifeCurrent<=0}},{key:"computeVelocity",value:function(e){var t=this.properties,n=t.velocityX,i=t.velocityY;i+=this.manager.getGravityY()*e,this.properties.velocityX=n,this.properties.velocityY=i}}]),n}(f)).prototype,"sprite",[jb],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Yb=Xb))||Yb);n._RF.pop(),n._RF.push({},"b6123+a2K1LoY60oZO9SYKX","StarConfetti",void 0);var lw=i.ccclass,uw=i.property,cw=(Jb=lw("StarConfetti"),Zb=uw([O]),ew=uw([O]),Jb((iw=Xe((nw=function(e){Ie(n,e);var t=Fe(n);function n(){var e;Te(this,n);for(var i=arguments.length,a=new Array(i),r=0;r<i;r++)a[r]=arguments[r];return Ye(e=t.call.apply(t,[this].concat(a)),"starXFrames",iw,Me(e)),Ye(e,"starYFrames",aw,Me(e)),e.msPerFrame=.15,e.isYoyo=!1,e.isGravityChanged=!1,e}return xe(n,[{key:"manualInit",value:function(e,t){Ge(Pe(n.prototype),"manualInit",this).call(this,e,t),this.msPerFrame=.15,this.isYoyo=!1,this.isGravityChanged=!1}},{key:"manualUpdate",value:function(e){var t=Ge(Pe(n.prototype),"manualUpdate",this).call(this,e);return this.updateGravity(),this.updateVelocity(),this.updateFrameRate(),this.updateFrames(e),t}},{key:"updateGravity",value:function(){if(!(this.properties.lifeCurrent>this.properties.life-2||this.isGravityChanged)){this.isGravityChanged=!0;this.properties.velocityX/=3,this.manager.setGravityY(-23745/667)}}},{key:"updateVelocity",value:function(){if(!(this.properties.lifeCurrent>this.properties.life-2)){this.properties.velocityX>0?this.properties.velocityX+=G.randomRangeInt(-12,6):this.properties.velocityX+=G.randomRangeInt(-6,12)}}},{key:"updateFrames",value:function(e){if(this.properties.lastChange+=e,this.properties.lastChange>=this.msPerFrame){this.isYoyo?this.properties.currentFrame--:this.properties.currentFrame++,this.properties.currentFrame<0&&(this.isYoyo=!1,this.properties.currentFrame=1),this.properties.currentFrame>=4&&(this.isYoyo=!0,this.properties.currentFrame-=1);var t=Math.random()>.5?this.starXFrames:this.starYFrames;this.sprite.spriteFrame=t[this.properties.currentFrame],this.properties.lastChange-=this.msPerFrame}}},{key:"updateFrameRate",value:function(){this.properties.lifeCurrent<this.properties.life-2?this.msPerFrame=.15:this.msPerFrame=G.randomRangeInt(300,600)/1e3}}]),n}(sw)).prototype,"starXFrames",[Zb],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),aw=Xe(nw.prototype,"starYFrames",[ew],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),tw=nw))||tw);n._RF.pop(),n._RF.push({},"9caadUsaKtPEoOe+T2+pqtd","Properties",void 0);var hw,pw=xe((function e(){Te(this,e),this.delay=200,this.timeScale=2,this.tints=["#F1D171","#97E1FD","#7765D1","#ED4440","#F9E02A"],this.speedX={min:1583/75,max:1583*.24},this.speedY={min:1139.76,max:1219.76},this.gravityY=-664.86,this.lifespan={min:5,max:8},this.rotate={totalRotation:1080,random:!0},this.scale={min:.6,max:1},this.originGravityY=-664.86}));n._RF.pop(),n._RF.push({},"d1648PsavVBn7B059PS5fj6","BaseEmitter",void 0);var dw,fw=(0,i.ccclass)("BaseEmitter")(hw=function(e){Ie(n,e);var t=Fe(n);function n(){var e;Te(this,n);for(var i=arguments.length,a=new Array(i),r=0;r<i;r++)a[r]=arguments[r];return(e=t.call.apply(t,[this].concat(a))).properties=new pw,e}return xe(n,[{key:"getGravityY",value:function(){return this.properties.gravityY}},{key:"setGravityY",value:function(e){this.properties.gravityY=e}}]),n}(f))||hw;n._RF.pop(),n._RF.push({},"654983p4rREVKci1CE8cSJ2","ConfettiEmitter",void 0);var vw,yw,mw,gw,bw,ww,kw,Sw,Ew,Cw,Tw,Aw=(0,i.ccclass)("ConfettiEmitter")(dw=function(e){Ie(a,e);var t,n,i=Fe(a);function a(){var e;Te(this,a);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return(e=i.call.apply(i,[this].concat(n))).activeStarConfetti=[],e}return xe(a,[{key:"__preload",value:function(){this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){kt.lazyValidateProperties(this)}},{key:"createConfettiPool",value:(n=Ce(Se().mark((function e(){var t=this;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,ai.loadPrefabAsync("particles/StarConfetti");case 2:this.starConfettiPrefab=e.sent,this.starConfettiPool=new Ah((function(){var e=l(t.starConfettiPrefab);return t.node.addChild(e),e.active=!1,e}),0,(function(e){var n=e.getComponent(cw);n?(t.activeStarConfetti.push(n),e.active=!0):console.error("StarConfetti not found")}),(function(e){e.getComponent(cw)?e.active=!1:console.error("StarConfetti not found")}),(function(e){e.isValid&&e.destroy()})),this.properties.timeScale=1.5,this.properties.gravityY=688.605,this.properties.lifespan.min=4,this.properties.lifespan.max=6,this.properties.rotate.totalRotation=1800;case 9:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"runEffect",value:(t=Ce(Se().mark((function e(t,n,i){var a,r,o,s,l,u,c,h,p,d,f,v;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.starConfettiPool){e.next=3;break}return e.next=3,this.createConfettiPool();case 3:this.properties.gravityY=this.properties.originGravityY,a=0;case 5:if(!(a<t)){e.next=31;break}if(r=this.starConfettiPool.alloc(),o=r.getComponent(cw)){e.next=11;break}return console.error("StarConfetti not found"),e.abrupt("return");case 11:if(r.setPosition(n.clone()),s=this.properties.tints[Math.floor(Math.random()*this.properties.tints.length)],l=Math.random()*(this.properties.speedX.max-this.properties.speedX.min),u=Math.random()*(this.properties.speedY.max-this.properties.speedY.min)+this.properties.speedY.min,c=Math.random()*(this.properties.lifespan.max-this.properties.lifespan.min)+this.properties.lifespan.min,h=this.properties.rotate.random?180*Math.random():0,p=Math.random()*(this.properties.scale.max-this.properties.scale.min)+this.properties.scale.min,d={tint:s,velocityX:l,velocityY:u,lifespan:c,totalRotation:this.properties.rotate.totalRotation,startAngle:h,scale:p},o.manualInit(this,d),f=this.starConfettiPool.alloc(),v=f.getComponent(cw)){e.next=25;break}return console.error("StarConfetti not found"),e.abrupt("return");case 25:f.setPosition(i.clone()),d.velocityX=-l,v.manualInit(this,d);case 28:a++,e.next=5;break;case 31:case"end":return e.stop()}}),e,this)}))),function(e,n,i){return t.apply(this,arguments)})},{key:"clearEffect",value:function(){var e,t=Ke(this.activeStarConfetti);try{for(t.s();!(e=t.n()).done;){var n=e.value;this.starConfettiPool.free(n.node)}}catch(e){t.e(e)}finally{t.f()}this.activeStarConfetti=[]}},{key:"update",value:function(e){var t=this,n=e*this.properties.timeScale,i=[];this.activeStarConfetti.forEach((function(e){e.manualUpdate(n)&&i.push(e)})),i.forEach((function(e){t.starConfettiPool.free(e.node),t.activeStarConfetti.splice(t.activeStarConfetti.indexOf(e),1)}))}}]),a}(fw))||dw;n._RF.pop(),n._RF.push({},"78c97IkjeJFQohPZudvcfeS","Ribbon",void 0);var xw,Rw,Iw,Pw,_w,Lw=i.ccclass,Ow=i.property,Dw=(vw=Lw("Ribbon"),yw=Ow([O]),mw=Ow([O]),gw=Ow([O]),bw=Ow([O]),vw((Sw=Xe((kw=function(e){Ie(n,e);var t=Fe(n);function n(){var e;Te(this,n);for(var i=arguments.length,a=new Array(i),r=0;r<i;r++)a[r]=arguments[r];return Ye(e=t.call.apply(t,[this].concat(a)),"ribbonA",Sw,Me(e)),Ye(e,"ribbonB",Ew,Me(e)),Ye(e,"ribbonC",Cw,Me(e)),Ye(e,"ribbonD",Tw,Me(e)),e.useFrames=[],e.msPerFrame=.15,e.isYoyo=!1,e.isGravityChanged=!1,e.points=[],e}return xe(n,[{key:"manualInit",value:function(e,t){Ge(Pe(n.prototype),"manualInit",this).call(this,e,t),this.msPerFrame=.15,this.isYoyo=!1,this.isGravityChanged=!1,this.points=new Array(10).fill(null).map((function(){return{x:0,y:0}}));var i=Math.random();this.useFrames=i<.25?this.ribbonA:i<.5?this.ribbonB:i<.75?this.ribbonC:this.ribbonD,this.sprite.enabled=!1}},{key:"manualUpdate",value:function(e){var t=Ge(Pe(n.prototype),"manualUpdate",this).call(this,e);return this.updateFrames(e),this.updatePoints(),this.updateGravity(),this.updateVelocity(),t}},{key:"updateFrames",value:function(e){this.properties.lastChange+=e,this.properties.lastChange>=this.msPerFrame&&(this.isYoyo?this.properties.currentFrame--:this.properties.currentFrame++,this.properties.currentFrame<0&&(this.isYoyo=!1,this.properties.currentFrame=1),this.properties.currentFrame>=this.useFrames.length&&(this.isYoyo=!0,this.properties.currentFrame-=1),this.sprite.spriteFrame=this.useFrames[this.properties.currentFrame],this.properties.lastChange-=this.msPerFrame)}},{key:"updatePoints",value:function(){if(!this.isGravityChanged){this.points.shift();var e=this.node.worldPosition,t=e.x,n=e.y;this.points.push({x:t,y:n})}}},{key:"updateGravity",value:function(){if(!(this.properties.lifeCurrent>this.properties.life-2||this.isGravityChanged)){this.isGravityChanged=!0,this.points=[],this.sprite.enabled=!0,this.properties.velocityX/=3;this.manager.setGravityY(-23745/667)}}},{key:"updateVelocity",value:function(){if(!this.isGravityChanged){this.properties.lifeCurrent>this.properties.life-1.8?this.properties.velocityX+=G.randomRangeInt(-24,24):this.properties.velocityX>0?this.properties.velocityX+=G.randomRangeInt(-20,12):this.properties.velocityX+=G.randomRangeInt(-12,20)}}},{key:"getGlobalPoints",value:function(){return this.points}},{key:"getColor",value:function(){return this.sprite.color}}]),n}(sw)).prototype,"ribbonA",[yw],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Ew=Xe(kw.prototype,"ribbonB",[mw],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Cw=Xe(kw.prototype,"ribbonC",[gw],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Tw=Xe(kw.prototype,"ribbonD",[bw],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),ww=kw))||ww);n._RF.pop(),n._RF.push({},"f2427J2HhBKdpkcqDn2Vv5H","RibbonEmitter",void 0);var Mw,Nw,Fw,Bw,Gw,zw,Uw,Hw=i.ccclass,Vw=i.property,qw=(xw=Hw("RibbonEmitter"),Rw=Vw(q),xw((_w=Xe((Pw=function(e){Ie(a,e);var t,n,i=Fe(a);function a(){var e;Te(this,a);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return Ye(e=i.call.apply(i,[this].concat(n)),"graphics",_w,Me(e)),e.activeRibbonConfetti=[],e}return xe(a,[{key:"__preload",value:function(){this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){kt.lazyValidateProperties(this)}},{key:"createConfettiPool",value:(n=Ce(Se().mark((function e(){var t=this;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,ai.loadPrefabAsync("particles/Ribbon");case 2:this.ribbonPrefab=e.sent,this.ribbonConfettiPool=new Ah((function(){var e=l(t.ribbonPrefab);return t.node.addChild(e),e.active=!1,e}),0,(function(e){var n=e.getComponent(Dw);n?(t.activeRibbonConfetti.push(n),e.active=!0):console.error("StarConfetti not found")}),(function(e){e.getComponent(Dw)?e.active=!1:console.error("StarConfetti not found")}),(function(e){e.destroy()}));case 4:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"runEffect",value:(t=Ce(Se().mark((function e(t,n,i){var a,r,o,s,l,u,c,h,p,d,f,v;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.ribbonConfettiPool){e.next=3;break}return e.next=3,this.createConfettiPool();case 3:this.properties.gravityY=this.properties.originGravityY,a=0;case 5:if(!(a<t)){e.next=31;break}if(r=this.ribbonConfettiPool.alloc(),o=r.getComponent(Dw)){e.next=11;break}return console.error("StarConfetti not found"),e.abrupt("return");case 11:if(r.setPosition(n.clone()),s=this.properties.tints[Math.floor(Math.random()*this.properties.tints.length)],l=Math.random()*(this.properties.speedX.max-this.properties.speedX.min),u=Math.random()*(this.properties.speedY.max-this.properties.speedY.min)+this.properties.speedY.min,c=Math.random()*(this.properties.lifespan.max-this.properties.lifespan.min)+this.properties.lifespan.min,h=this.properties.rotate.random?180*Math.random():0,p=Math.random()*(this.properties.scale.max-this.properties.scale.min)+this.properties.scale.min,d={tint:s,velocityX:l,velocityY:u,lifespan:c,totalRotation:this.properties.rotate.totalRotation,startAngle:h,scale:p},o.manualInit(this,d),f=this.ribbonConfettiPool.alloc(),v=f.getComponent(Dw)){e.next=25;break}return console.error("StarConfetti not found"),e.abrupt("return");case 25:f.setPosition(i.clone()),d.velocityX=-l,v.manualInit(this,d);case 28:a++,e.next=5;break;case 31:case"end":return e.stop()}}),e,this)}))),function(e,n,i){return t.apply(this,arguments)})},{key:"clearEffect",value:function(){var e,t=Ke(this.activeRibbonConfetti);try{for(t.s();!(e=t.n()).done;){var n=e.value;this.ribbonConfettiPool.free(n.node)}}catch(e){t.e(e)}finally{t.f()}this.activeRibbonConfetti=[]}},{key:"update",value:function(e){var t=this,n=e*this.properties.timeScale;this.graphics.clear();var i=[];this.activeRibbonConfetti.forEach((function(e){e.manualUpdate(n)&&i.push(e),t.drawGraphics(e.getGlobalPoints(),e.getColor())})),i.forEach((function(e){t.ribbonConfettiPool.free(e.node),t.activeRibbonConfetti.splice(t.activeRibbonConfetti.indexOf(e),1)}))}},{key:"drawGraphics",value:function(e,t){if(this.graphics.node.active){var n,i=Ke(e);try{for(i.s();!(n=i.n()).done;){if(0===n.value.y)return}}catch(e){i.e(e)}finally{i.f()}if(!(e.length<2)){this.graphics.strokeColor=t;var a=new Y(e[0].x,e[0].y,0);a=this.node.inverseTransformPoint(a,a),this.graphics.moveTo(a.x,a.y);for(var r=1;r<e.length;r++)a.x=e[r].x,a.y=e[r].y,a=this.node.inverseTransformPoint(a,a),this.graphics.lineTo(a.x,a.y);this.graphics.stroke()}}}}]),a}(fw)).prototype,"graphics",[Rw],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Iw=Pw))||Iw);n._RF.pop(),n._RF.push({},"f7cfcFAL8tBE70g2A0+qMTR","PaperConfetti",void 0);var Ww,Kw=i.ccclass,jw=i.property,Yw=(Mw=Kw("PaperConfetti"),Nw=jw(Aw),Fw=jw(qw),Mw((zw=Xe((Gw=function(e){Ie(n,e);var t=Fe(n);function n(){var e;Te(this,n);for(var i=arguments.length,a=new Array(i),r=0;r<i;r++)a[r]=arguments[r];return(e=t.call.apply(t,[this].concat(a))).spawnLeftPos=new Y(-375,-791.5,0),e.spawnRightPos=new Y(375,-791.5,0),Ye(e,"confettiEmitter",zw,Me(e)),Ye(e,"ribbonEmitter",Uw,Me(e)),e}return xe(n,[{key:"__preload",value:function(){this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){if(!this.confettiEmitter)throw new Error("PaperConfetti: ConfettiEmitter not found");if(!this.ribbonEmitter)throw new Error("PaperConfetti: RibbonEmitter not found")}},{key:"runEffect",value:function(){var e=this;this.scheduleOnce((function(){e.confettiEmitter.runEffect(25,e.spawnLeftPos,e.spawnRightPos)}),.2),this.ribbonEmitter.runEffect(20,this.spawnLeftPos,this.spawnRightPos)}},{key:"clearEffect",value:function(){this.unscheduleAllCallbacks(),this.confettiEmitter.clearEffect(),this.ribbonEmitter.clearEffect()}}]),n}(f)).prototype,"confettiEmitter",[Nw],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Uw=Xe(Gw.prototype,"ribbonEmitter",[Fw],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Bw=Gw))||Bw);n._RF.pop(),n._RF.push({},"4a9beTdMntC0q9yngb8a2go","BootScene",void 0);var Xw,$w,Qw,Jw,Zw,ek,tk,nk,ik,ak,rk,ok=i.ccclass,sk=i.disallowMultiple,lk=GameCore,uk=lk.Events,ck=lk.Configs,hk=lk.Utils,pk=hk.Time,dk=hk.Valid,fk=globalThis.game,vk=fk.ads,yk=fk.player,mk=fk.event;ok("BootScene")(Ww=sk(Ww=function(e){Ie(i,e);var t,n=Fe(i);function i(){var e;Te(this,i);for(var t=arguments.length,a=new Array(t),r=0;r<t;r++)a[r]=arguments[r];return(e=n.call.apply(n,[this].concat(a))).processWhenGameSdkStarted=function(){e.setupGameData()},e.processPreloadAssets=function(){e.loadCurrentPlayerTheme().catch((function(e){return console.error("loadCurrentPlayerTheme",e)}))},e.handleShowAdWhenLoadGame=Ce(Se().mark((function t(){var n,i,a,r,o,s,l;return Se().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=ck.Ads,i=n.Enabled,a=n.ShowAdOnLoad,i){t.next=3;break}return t.abrupt("return");case 3:if(r=a.Enabled,o=a.DelaySeconds,s=a.PlacementId,r){t.next=6;break}return t.abrupt("return");case 6:if(t.prev=6,!(o>0)){t.next=10;break}return t.next=10,pk.sleepAsync(1e3*o);case 10:if(l=vk.getAdByPlacementId(s)){t.next=13;break}return t.abrupt("return");case 13:return t.next=15,e.showAdWhenLoadGame(l);case 15:t.next=20;break;case 17:t.prev=17,t.t0=t.catch(6),console.warn("handleShowAdWhenLoadGame failed",t.t0);case 20:return t.prev=20,Tv.preloadAds(),t.finish(20);case 23:case"end":return t.stop()}}),t,null,[[6,17,20,23]])}))),e.handlePauseAudio=function(){mk.on(uk.VISIBILITY_HIDDEN,e.handleMuteAudio),mk.on(uk.VISIBILITY_VISIBLE,e.handleUnMuteAudio),mk.on(uk.VISIBILITY_VISIBLE,e.handleForceEngineRunning)},e.handleMuteAudio=function(){bi.muteAudio(!0)},e.handleUnMuteAudio=function(){vk.isAdFullSizeShowing()||bi.muteAudio(!1)},e.handleForceEngineRunning=function(){d.resume()},e}return xe(i,[{key:"__preload",value:function(){this.setupAndroidPlatformAds(),this.processCrazyGamesLoadingStart(),this.validateRequiredComponents(),this.listenEvents()}},{key:"validateRequiredComponents",value:function(){kt.lazyValidateProperties(this)}},{key:"onLoad",value:function(){this.handlePauseAudio(),this.processPreloadAssets(),ck.Core.StartSDKAfterLoadGame||lu.showLoadingFullScreen(Zs)}},{key:"start",value:function(){this.processCrazyGamesLoadingStop()}},{key:"listenEvents",value:function(){mk.once(uk.GAME_SDK_STARTED,this.processWhenGameSdkStarted),mk.once(uk.GAME_READY,this.handleShowAdWhenLoadGame)}},{key:"setupGameData",value:function(){var e=yk.getGameData();if(e){var t=e.totalLevel,n=ke(ke({},e),{},{totalLevel:0===t?80:t});yk.setGameData(n)}}},{key:"loadCurrentPlayerTheme",value:function(){var e=yl.mapOrder,t=e[0],n=yk.getGameData();console.log("loadCurrentPlayerTheme",n);var i=null==n?void 0:n.level;if(!dk.isNumber(i))return ai.loadThemeAsync(t.theme);var a,r=Ke(e);try{for(r.s();!(a=r.n()).done;){var o=a.value;if((i-=o.levelCount)<=0){t=o;break}}}catch(e){r.e(e)}finally{r.f()}return ai.loadThemeAsync(t.theme)}},{key:"showAdWhenLoadGame",value:(t=Ce(Se().mark((function e(t){var n,i;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n=t.type,i=t.placementId,e.next=4,vk.loadAdAsync(n,i);case 4:return bi.muteAudio(!0),e.next=7,vk.showAdAsync(n,i);case 7:e.next=12;break;case 9:e.prev=9,e.t0=e.catch(0),console.warn("showAdWhenLoadGame failed",e.t0);case 12:return e.prev=12,bi.muteAudio(!1),e.finish(12);case 15:case"end":return e.stop()}}),e,null,[[0,9,12,15]])}))),function(e){return t.apply(this,arguments)})},{key:"processCrazyGamesLoadingStart",value:function(){"gameLoadingStart"in GameSDK.extra&&GameSDK.extra.gameLoadingStart()}},{key:"processCrazyGamesLoadingStop",value:function(){"gameLoadingStop"in GameSDK.extra&&GameSDK.extra.gameLoadingStop()}},{key:"setupAndroidPlatformAds",value:function(){}}]),i}(f))||Ww);n._RF.pop(),n._RF.push({},"29f874DL75LO5NzzNYZvHDh","RigidBodyObject",void 0);var gk,bk,wk,kk,Sk,Ek,Ck,Tk,Ak,xk=i.ccclass,Rk=i.property,Ik=(Xw=xk("RigidBodyObject"),$w=Rk(E),Qw=Rk(Q),Jw=Rk(E),Zw=Rk(H),Xw((nk=Xe((tk=function(e){Ie(n,e);var t=Fe(n);function n(){var e;Te(this,n);for(var i=arguments.length,a=new Array(i),r=0;r<i;r++)a[r]=arguments[r];return Ye(e=t.call.apply(t,[this].concat(a)),"gravityScale",nk,Me(e)),Ye(e,"linearVelocity",ik,Me(e)),Ye(e,"bounce",ak,Me(e)),Ye(e,"simulate",rk,Me(e)),e}return xe(n,[{key:"onLoad",value:function(){this.canvas=this.node.scene.getComponentInChildren(o).getComponent(s),this.uiTransform=this.node.getComponent(s)}},{key:"update",value:function(e){if(this.simulate){this.applyGravity();var t=this.node.worldPosition.clone();t.add(new Y(this.linearVelocity.x*e,this.linearVelocity.y*e,0)),t=this.applyBounce(t),this.node.setWorldPosition(t)}}},{key:"applyForce",value:function(e){this.linearVelocity.add(e)}},{key:"applyGravity",value:function(){var e=new Q(0,-9.8*this.gravityScale);this.applyForce(e)}},{key:"applyBounce",value:function(e){var t=this.uiTransform.getBoundingBoxToWorld();t.yMin<0&&(e.y=t.height/2,this.linearVelocity.y*=-this.bounce),t.xMin<0&&(e.x=t.width/2,this.linearVelocity.x*=-1);var n=this.canvas.width;return t.xMax>n&&(e.x=n-t.width/2,this.linearVelocity.x*=-1),e}}]),n}(f)).prototype,"gravityScale",[$w],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),ik=Xe(tk.prototype,"linearVelocity",[Qw],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Q(0,0)}}),ak=Xe(tk.prototype,"bounce",[Jw],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),rk=Xe(tk.prototype,"simulate",[Zw],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ek=tk))||ek);n._RF.pop(),n._RF.push({},"93d88BQCU5B0L/TmaCaYNfm","AnimSkipOverlay",void 0);var Pk,_k,Lk,Ok,Dk,Mk,Nk,Fk,Bk,Gk=i.ccclass,zk=i.property,Uk=i.disallowMultiple,Hk=function(){},Vk=(gk=Gk("AnimSkipOverlay"),bk=zk(N),wk=zk(N),kk=zk(p),gk(Sk=Uk((Ck=Xe((Ek=function(e){Ie(a,e);var t,n,i=Fe(a);function a(){var e;Te(this,a);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return Ye(e=i.call.apply(i,[this].concat(n)),"containerUIOpacity",Ck,Me(e)),Ye(e,"maskUIOpacity",Tk,Me(e)),Ye(e,"skipButton",Ak,Me(e)),e.isOpened=!1,e.currentCallback=Hk,e}return xe(a,[{key:"__preload",value:function(){this.validateRequiredComponents(),this.containerUIOpacity.node.active=!1,this.skipButton.interactable=!1}},{key:"onSkipButtonPress",value:function(){this.currentCallback(),this.close()}},{key:"validateRequiredComponents",value:function(){kt.lazyValidateProperties(this)}},{key:"open",value:(n=Ce(Se().mark((function e(t){var n,i,a,r,o;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.containerUIOpacity.node.active=!0,n=t.onSkip,i=t.opacity,a=void 0===i?255:i,r=t.transitionDuration,o=void 0===r?.2:r,this.maskUIOpacity.opacity=a,e.next=5,this.animateUIOpacity(0,255,o);case 5:this.currentCallback=n,this.skipButton.interactable=!0,this.isOpened=!0,this.node.scene.emit(ba,t);case 9:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"close",value:(t=Ce(Se().mark((function e(){var t,n=arguments;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.length>0&&void 0!==n[0]?n[0]:.2,this.skipButton.interactable=!1,this.currentCallback=Hk,e.next=5,this.animateUIOpacity(255,0,t);case 5:this.maskUIOpacity.opacity=0,this.containerUIOpacity.node.active=!1,this.isOpened=!1,this.node.scene.emit(wa);case 9:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"animateUIOpacity",value:function(e,t,n){return this.containerUIOpacity.opacity=e,vn.runTweenAsync(S(this.containerUIOpacity).to(n,{opacity:t}))}},{key:"untilClosed",value:function(){var e=this;return!1===this.isOpened?Promise.resolve():new Promise((function(t){e.node.scene.once(wa,t)}))}}]),a}(f)).prototype,"containerUIOpacity",[bk],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Tk=Xe(Ek.prototype,"maskUIOpacity",[wk],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ak=Xe(Ek.prototype,"skipButton",[kk],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Sk=Ek))||Sk)||Sk);n._RF.pop(),n._RF.push({},"755d1r2cMRLvo4fObNWxss/","CoinContainer",void 0);var qk,Wk,Kk,jk,Yk,Xk,$k,Qk,Jk,Zk,eS,tS,nS,iS,aS,rS,oS,sS=i.ccclass,lS=i.property,uS=GameCore.Utils.Number.getShortNumber,cS=(Pk=sS("CoinContainer"),_k=lS(u),Lk=lS(A),Ok=lS(N),Pk((Nk=Xe((Mk=function(e){Ie(r,e);var t,n,i,a=Fe(r);function r(){var e;Te(this,r);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return Ye(e=a.call.apply(a,[this].concat(n)),"coinLabel",Nk,Me(e)),Ye(e,"coinIcon",Fk,Me(e)),Ye(e,"explosionCircle",Bk,Me(e)),e.currentCoin=0,e}return xe(r,[{key:"setCoinText",value:function(e){this.coinLabel.string=e}},{key:"handleAddCoinButton",value:function(){lu.openScreen(di.GET_COIN_SCREEN,{quantity:Us})}},{key:"onLoad",value:function(){this.validateRequiredComponents(),this.listenToEvents()}},{key:"validateRequiredComponents",value:function(){kt.lazyValidateProperties(this)}},{key:"listenToEvents",value:function(){this.node.scene.on(pr.COIN_CHANGED,this.updateCoins,this)}},{key:"updateCoins",value:(i=Ce(Se().mark((function e(t){var n,i,a,r,o,s,l;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=t.coins,void 0!==(a=t.collectionAnimation)&&!1!==this.node.activeInHierarchy){e.next=4;break}return this.setCoins(i),e.abrupt("return");case 4:if(r=a.signal,null===(n=this.animAbortSignal)||void 0===n||n.abort(),this.animAbortSignal=null!=r?r:new On,!a.animateTextOnly){e.next=12;break}return e.next=10,this.animateCoinText(i,0,r);case 10:return this.setCoins(i),e.abrupt("return");case 12:return o=a.flyDuration,s=a.floatDuration,l=s+o,e.next=17,this.animateCoinText(i,l,r);case 17:this.setCoins(i);case 18:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})},{key:"setCoins",value:function(e){this.setCoinText(uS(e,3)),this.currentCoin=e}},{key:"animateCoinText",value:(n=Ce(Se().mark((function e(t,n,i){var a,r=this;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=this.currentCoin,e.next=3,vn.waitTweenAsync(n,i);case 3:return bi.playSound(ui.COLLECT_COINS),e.next=6,vn.runTweenAsync(S({}).to(1,{},{easing:"quadOut",onUpdate:function(e,n){if(n){var i=Math.round(a+(t-a)*n);r.setCoinText(uS(i,3))}}}),i);case 6:case"end":return e.stop()}}),e,this)}))),function(e,t,i){return n.apply(this,arguments)})},{key:"emitExplodeEffect",value:(t=Ce(Se().mark((function e(t){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.explosionCircle.opacity=255,this.explosionCircle.node.setScale(0,0),e.next=4,Promise.all([vn.runTweenAsync(S(this.explosionCircle.node).to(.4,{scale:new Y(3,3,3)},{easing:"quadOut"}),t),vn.runTweenAsync(S(this.explosionCircle).delay(.2).to(.2,{opacity:0}),t)]);case 4:this.explosionCircle.node.setScale(0,0),this.explosionCircle.opacity=0;case 6:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"getCoinIconWorldPosition",value:function(){return this.coinIcon.node.worldPosition}},{key:"getCoinIconWorldScale",value:function(){return this.coinIcon.node.worldScale}},{key:"onDestroy",value:function(){var e;null===(e=this.animAbortSignal)||void 0===e||e.abort()}}]),r}(f)).prototype,"coinLabel",[_k],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Fk=Xe(Mk.prototype,"coinIcon",[Lk],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Bk=Xe(Mk.prototype,"explosionCircle",[Ok],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Dk=Mk))||Dk);n._RF.pop(),n._RF.push({},"a1833nGls5Ac4p0tpu/jEqi","ItemContainer",void 0);var hS,pS,dS,fS,vS,yS,mS,gS,bS,wS,kS,SS,ES,CS,TS,AS,xS,RS,IS,PS,_S,LS=i.ccclass,OS=i.property,DS=globalThis.game.player,MS=[1e3,1500];qk=LS("ItemContainer"),Wk=OS({type:a,group:"Hint"}),Kk=OS({type:u,group:"Hint"}),jk=OS({type:a,group:"Thunder"}),Yk=OS({type:u,group:"Thunder"}),Xk=OS({type:a,group:"Storm"}),$k=OS({type:u,group:"Storm"}),Qk=OS(I),qk((eS=Xe((Zk=function(e){Ie(u,e);var t,n,i,a,r,s=Fe(u);function u(){var e;Te(this,u);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return Ye(e=s.call.apply(s,[this].concat(n)),"hintNode",eS,Me(e)),Ye(e,"hintLabel",tS,Me(e)),e.hintCollection=[],Ye(e,"thunderNode",nS,Me(e)),Ye(e,"thunderLabel",iS,Me(e)),e.thunderCollection=[],Ye(e,"stormNode",aS,Me(e)),Ye(e,"stormLabel",rS,Me(e)),e.stormCollection=[],Ye(e,"itemPrefab",oS,Me(e)),e}return xe(u,[{key:"onLoad",value:function(){this.canvas=this.node.scene.getComponentInChildren(o).node,this.widget=this.getComponent(C),this.defaultRightWidget=this.widget.right,this.uiOpacity=this.getComponent(N),this.validateRequiredComponents(),this.listenToEvents()}},{key:"start",value:function(){this.prepareItemCollection()}},{key:"validateRequiredComponents",value:function(){kt.lazyValidateProperties(this)}},{key:"listenToEvents",value:function(){this.node.scene.on(pr.ADD_ITEMS,this.handleAddItems,this)}},{key:"prepareItemCollection",value:function(){for(var e=0;e<9;e++){var t=l(this.itemPrefab),n=l(this.itemPrefab),i=l(this.itemPrefab);t.parent=this.canvas,n.parent=this.canvas,i.parent=this.canvas,t.active=!1,n.active=!1,i.active=!1,this.hintCollection.push(t.getComponent(Ik)),this.thunderCollection.push(n.getComponent(Ik)),this.stormCollection.push(i.getComponent(Ik))}}},{key:"updateStatus",value:function(e){var t=e.items;this.hintLabel.string=`${t.hint}`,this.thunderLabel.string=`${t.thunder}`,this.stormLabel.string=`${t.storm}`}},{key:"show",value:(r=Ce(Se().mark((function e(){var t;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.uiOpacity.opacity=255,t=S(this.widget).to(1.5,{right:0},{easing:"quadOut"}),e.next=4,vn.runTweenAsync(t,this.animAbortSignal);case 4:this.widget.right=0;case 5:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"hide",value:(a=Ce(Se().mark((function e(){var t;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=S(this.widget).to(1,{right:this.defaultRightWidget},{easing:"quadIn"}),e.next=3,vn.runTweenAsync(t);case 3:this.uiOpacity.opacity=0;case 4:case"end":return e.stop()}}),e,this)}))),function(){return a.apply(this,arguments)})},{key:"handleAddItems",value:(i=Ce(Se().mark((function e(t){var n,i,a,r,o=this;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.animAbortSignal=null!==(n=t.signal)&&void 0!==n?n:new On,i=DS.getGameData()){e.next=4;break}return e.abrupt("return");case 4:return this.updateStatus(i),a=this.show(),r=t.items.map((function(e){return o.animateItemCollection(e.item,e.quantity,1.5)})),e.next=9,Promise.all([a].concat(Ve(r)));case 9:return i.items=ke(ke({},i.items),{},{hint:i.items.hint+t.items[0].quantity,thunder:i.items.thunder+t.items[1].quantity,storm:i.items.storm+t.items[2].quantity}),DS.setGameData(i),this.updateStatus(i),e.next=14,this.hide();case 14:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})},{key:"animateItemCollection",value:(n=Ce(Se().mark((function e(t,n,i){var a,r,o=this;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==(a=this.getItemCollection(t).slice(0,n)).length){e.next=3;break}return e.abrupt("return");case 3:return r=a.map((function(e,n){e.node.active=!0,e.node.position=new Y(0,0,e.node.position.z),e.linearVelocity=new Q(0,0),e.simulate=!0;var a=ie(Math.PI/3,2*Math.PI/3),r=ie(MS[0],MS[1])*Math.cos(a),s=ie(MS[0],MS[1])*Math.sin(a);e.applyForce(new Q(r,s));var l=o.getTargetNode(t);if(l)return e.getComponent(A).spriteFrame=l.getComponent(A).spriteFrame,o.getItemAnimation(e,l,i+.03*n)})),e.next=6,Promise.all(r);case 6:case"end":return e.stop()}}),e,this)}))),function(e,t,i){return n.apply(this,arguments)})},{key:"getItemCollection",value:function(e){switch(e){case"hint":return this.hintCollection;case"thunder":return this.thunderCollection;case"storm":return this.stormCollection;default:return[]}}},{key:"getTargetNode",value:function(e){switch(e){case"hint":return this.hintNode;case"thunder":return this.thunderNode;case"storm":return this.stormNode;default:return null}}},{key:"getItemAnimation",value:(t=Ce(Se().mark((function e(t,n){var i,a,r,o=arguments;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=o.length>2&&void 0!==o[2]?o[2]:0,t.node.scale=new Y(2,2,2),e.next=4,vn.waitTweenAsync(i,this.animAbortSignal);case 4:return a=t.node.worldPosition.clone(),r=S(t.node).to(1,{scale:n.scale},{onUpdate:function(e,i){if(e&&i){var r=M.cubicIn(i);n&&(t.node.worldPosition=a.lerp(n.worldPosition,r))}},onComplete:function(){t.node.setPosition(0,0),t.node.active=!1}}),e.next=8,vn.runTweenAsync(r,this.animAbortSignal);case 8:t.node.scale=n.scale.clone(),t.node.setPosition(0,0),t.node.active=!1;case 11:case"end":return e.stop()}}),e,this)}))),function(e,n){return t.apply(this,arguments)})},{key:"onDestroy",value:function(){var e;null===(e=this.animAbortSignal)||void 0===e||e.abort()}}]),u}(f)).prototype,"hintNode",[Wk],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),tS=Xe(Zk.prototype,"hintLabel",[Kk],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),nS=Xe(Zk.prototype,"thunderNode",[jk],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),iS=Xe(Zk.prototype,"thunderLabel",[Yk],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),aS=Xe(Zk.prototype,"stormNode",[Xk],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),rS=Xe(Zk.prototype,"stormLabel",[$k],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),oS=Xe(Zk.prototype,"itemPrefab",[Qk],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Jk=Zk));n._RF.pop(),n._RF.push({},"ba822axo49BibgkqkEhhqVp","DashboardPage",void 0);var NS,FS,BS,GS,zS,US,HS,VS,qS,WS,KS,jS=i.ccclass,YS=i.property,XS=i.disallowMultiple,$S=i.requireComponent,QS=(hS=jS("DashboardPage"),pS=$S(C),dS=$S(N),fS=YS({type:a,displayName:"Page's container"}),vS=YS({type:a,displayName:"Placeholder"}),yS=YS({displayName:"Don't load page",tooltip:"Tell the component to not preload the page even if it hasn't loaded yet"}),mS=YS({type:I,displayName:"Page prefab",visible:function(){return!this.hasLoaded}}),gS=YS({displayName:"Darken background"}),bS=YS({type:g,min:0,max:255,displayName:"Background opacity",visible:function(){return this.darkenBackground}}),wS=YS({displayName:"Use navbar shadow"}),kS=YS({type:g,min:0,max:255,displayName:"Navbar shadow opacity",visible:function(){return this.useNavbarShadow}}),hS(SS=XS(SS=pS(SS=dS((CS=Xe((ES=function(e){Ie(a,e);var t,n,i=Fe(a);function a(){var e;Te(this,a);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return Ye(e=i.call.apply(i,[this].concat(n)),"container",CS,Me(e)),Ye(e,"placeholder",TS,Me(e)),Ye(e,"hasLoaded",AS,Me(e)),Ye(e,"pagePrefab",xS,Me(e)),Ye(e,"darkenBackground",RS,Me(e)),Ye(e,"backgroundOpacity",IS,Me(e)),Ye(e,"useNavbarShadow",PS,Me(e)),Ye(e,"navbarShadowOpacity",_S,Me(e)),e}return xe(a,[{key:"onLoad",value:function(){this.containerUIOpacity=this.container.getComponent(N),this.placeholderUIOpacity=this.placeholder.getComponent(N),this.widgetComponent=this.node.getComponent(C),this.uiOpacity=this.node.getComponent(N),this.validateRequiredComponents();var e=this.container.getComponent(T);this.layoutComponents=e?[e]:[],this.widgetComponents=[this.widgetComponent].concat(Ve(this.container.getComponentsInChildren(C)))}},{key:"start",value:function(){this.container.active=!0,this.placeholder.active=!0}},{key:"getWidget",value:function(){return this.widgetComponent}},{key:"updateWidgets",value:function(){this.widgetComponents.forEach((function(e){e.updateAlignment()}))}},{key:"updateLayouts",value:function(){this.layoutComponents.forEach((function(e){e.updateLayout()}))}},{key:"show",value:function(){this.uiOpacity.opacity=255}},{key:"hide",value:function(){this.uiOpacity.opacity=0}},{key:"mount",value:(n=Ce(Se().mark((function e(){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.hasLoaded){e.next=3;break}return e.next=3,this.create();case 3:this.placeholderUIOpacity.opacity=0,this.containerUIOpacity.opacity=255,gi.trackCurrentPage(this.node.name,!0);case 6:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"unmount",value:function(){255===this.placeholderUIOpacity.opacity&&0===this.containerUIOpacity.opacity||(this.placeholderUIOpacity.opacity=255,this.containerUIOpacity.opacity=0)}},{key:"transitionIn",value:function(){return Promise.resolve()}},{key:"transitionOut",value:function(){return Promise.resolve()}},{key:"hasLoadedPage",value:function(){return this.hasLoaded}},{key:"getContainer",value:function(){return this.container}},{key:"getDarkenBackground",value:function(){return this.darkenBackground?this.backgroundOpacity:0}},{key:"getNavbarShadow",value:function(){return this.useNavbarShadow?this.navbarShadowOpacity:0}},{key:"create",value:(t=Ce(Se().mark((function e(){var t,n,i,a,r;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.pagePrefab){e.next=2;break}return e.abrupt("return");case 2:if(!this.hasLoaded){e.next=4;break}return e.abrupt("return");case 4:return i=l(this.pagePrefab),a=i.getComponentsInChildren(C),(t=this.widgetComponents).push.apply(t,Ve(a)),r=i.getComponentsInChildren(T),(n=this.layoutComponents).push.apply(n,Ve(r)),this.container.addChild(i),e.next=12,vn.waitTweenAsync(0);case 12:this.hasLoaded=!0;case 13:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"validateRequiredComponents",value:function(){kt.lazyValidateProperties(this)}}]),a}(f)).prototype,"container",[fS],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),TS=Xe(ES.prototype,"placeholder",[vS],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),AS=Xe(ES.prototype,"hasLoaded",[yS],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),xS=Xe(ES.prototype,"pagePrefab",[mS],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),RS=Xe(ES.prototype,"darkenBackground",[gS],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),IS=Xe(ES.prototype,"backgroundOpacity",[bS],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 150}}),PS=Xe(ES.prototype,"useNavbarShadow",[wS],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),_S=Xe(ES.prototype,"navbarShadowOpacity",[kS],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 150}}),SS=ES))||SS)||SS)||SS)||SS);n._RF.pop(),n._RF.push({},"18bbbp5z2VHVKp4jjjmsAhu","ThemeProgressBar",void 0);var JS,ZS,eE,tE,nE,iE,aE,rE,oE,sE,lE,uE,cE,hE,pE,dE=i.ccclass,fE=i.property,vE=(NS=dE("ThemeProgressBar"),FS=fE(a),BS=fE(a),GS=fE(a),zS=fE(a),NS((VS=Xe((HS=function(e){Ie(n,e);var t=Fe(n);function n(){var e;Te(this,n);for(var i=arguments.length,a=new Array(i),r=0;r<i;r++)a[r]=arguments[r];return Ye(e=t.call.apply(t,[this].concat(a)),"progressBar",VS,Me(e)),Ye(e,"progressText",qS,Me(e)),Ye(e,"leftCap",WS,Me(e)),Ye(e,"rightCap",KS,Me(e)),e}return xe(n,[{key:"onLoad",value:function(){this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){if(!this.progressBar)throw new Error("ThemeProgressBar: progressBar not found");if(!this.progressText)throw new Error("ThemeProgressBar: progressText not found");if(!this.leftCap)throw new Error("ThemeProgressBar: leftCap not found");if(!this.rightCap)throw new Error("ThemeProgressBar: rightCap not found")}},{key:"setProgress",value:function(e,t){e<=0?(this.leftCap.active=!1,this.rightCap.active=!1):(this.leftCap.active=!0,this.rightCap.active=!0);var n=this.progressBar.getComponent(X);if(!n)throw new Error("ThemeProgressBar: progressBarComponent not found");n.progress=e/t;var i=this.progressText.getComponent(u);if(!i)throw new Error("ThemeProgressBar: progressTextComponent not found");i.string=`${e}/${t}`}}]),n}(f)).prototype,"progressBar",[FS],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),qS=Xe(HS.prototype,"progressText",[BS],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),WS=Xe(HS.prototype,"leftCap",[GS],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),KS=Xe(HS.prototype,"rightCap",[zS],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),US=HS))||US);n._RF.pop(),n._RF.push({},"e62f9TdkTxOyJy6vcnplnCB","LockAnimator",void 0);var yE,mE,gE,bE,wE,kE,SE,EE,CE,TE,AE,xE,RE,IE,PE,_E,LE,OE,DE,ME,NE,FE,BE=i.ccclass,GE=i.disallowMultiple,zE=i.property,UE=[50,160],HE=(JS=BE("LockAnimator"),ZS=zE(re),eE=zE(y),tE=zE(_),nE=zE(_),iE=zE(ks),aE=zE({type:g,min:0}),JS(rE=GE((sE=Xe((oE=function(e){Ie(a,e);var t,n,i=Fe(a);function a(){var e;Te(this,a);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return Ye(e=i.call.apply(i,[this].concat(n)),"floatingParticles",sE,Me(e)),Ye(e,"iconAnimation",lE,Me(e)),Ye(e,"lockClip",uE,Me(e)),Ye(e,"unlockClip",cE,Me(e)),Ye(e,"trailTemplate",hE,Me(e)),Ye(e,"trailCount",pE,Me(e)),e.trails=[],e}return xe(a,[{key:"onLoad",value:function(){this.validateRequiredComponents(),this.prepareTrails(),this.floatingParticles.node.active=!1}},{key:"unlock",value:(n=Ce(Se().mark((function e(t){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.floatingParticles.node.active=!0,this.floatingParticles.resetSystem(),e.next=4,this.playAnimation(this.unlockClip.name,t);case 4:this.floatingParticles.stopSystem();case 5:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"fireExplosionParticles",value:function(){this.explodeTrails()}},{key:"lock",value:function(){this.playAnimation(this.lockClip.name),this.floatingParticles.node.active&&this.floatingParticles.stopSystem()}},{key:"explodeTrails",value:function(){var e=this;return Promise.all(this.trails.map((function(t){return vn.runTweenAsync(e.getExplodeTrail(t))})))}},{key:"getExplodeTrail",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=ie(0,2*Math.PI),i=ie(UE[0],UE[1])*Math.cos(n),a=ie(UE[0],UE[1])*Math.sin(n),r=new Y(i,a,e.node.position.z),o=e.node.scale.clone();return S(e.node).delay(t).call((function(){e.node.setPosition(0,0),e.reset(),e.node.active=!0})).to(.5,{position:r.clone()},{easing:"expoOut"}).to(.5,{scale:new Y(0,0,1)},{easing:"expoIn"}).call((function(){e.node.setPosition(0,0),e.node.scale=o,e.reset(),e.node.active=!1}))}},{key:"prepareTrails",value:function(){this.trailTemplate.node.active=!1;for(var e=0;e<this.trailCount;e++){var t=l(this.trailTemplate.node);t.setParent(this.node),t.active=!1,this.trails.push(t.getComponent(ks))}}},{key:"validateRequiredComponents",value:function(){kt.lazyValidateProperties(this)}},{key:"playAnimation",value:(t=Ce(Se().mark((function e(t,n){var i=this;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!n||null==n||!n.aborted){e.next=2;break}return e.abrupt("return",Promise.resolve());case 2:return e.abrupt("return",new Promise((function(e){i.iconAnimation.once(y.EventType.FINISHED,(function(){e()})),null==n||n.addAbortListener((function(){i.iconAnimation.off(y.EventType.FINISHED),i.iconAnimation.stop(),e()})),i.iconAnimation.play(t)})));case 3:case"end":return e.stop()}}),e)}))),function(e,n){return t.apply(this,arguments)})}]),a}(f)).prototype,"floatingParticles",[ZS],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),lE=Xe(oE.prototype,"iconAnimation",[eE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),uE=Xe(oE.prototype,"lockClip",[tE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),cE=Xe(oE.prototype,"unlockClip",[nE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),hE=Xe(oE.prototype,"trailTemplate",[iE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),pE=Xe(oE.prototype,"trailCount",[aE],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),rE=oE))||rE)||rE);n._RF.pop(),n._RF.push({},"aef0d6qo8hNUJ7qNl2wuT29","ThemeBlock",void 0);var VE,qE,WE,KE,jE,YE,XE,$E,QE,JE,ZE,eC=i.ccclass,tC=i.property,nC={progress:0,max:10,isLocked:!0,themeId:wl.SUMMER,skin:bl},iC=(yE=eC("ThemeBlock"),mE=tC(a),gE=tC(N),bE=tC(a),wE=tC(N),kE=tC(HE),SE=tC(a),EE=tC(A),CE=tC([A]),TE=tC(u),AE=tC(H),yE((IE=Xe((RE=function(e){Ie(o,e);var t,n,i,a,r=Fe(o);function o(){var e;Te(this,o);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return Ye(e=r.call.apply(r,[this].concat(n)),"mask",IE,Me(e)),Ye(e,"nodeUIOpacity",PE,Me(e)),Ye(e,"progressBar",_E,Me(e)),Ye(e,"backgroundUI",LE,Me(e)),Ye(e,"lockAnimator",OE,Me(e)),Ye(e,"themeLoadingRing",DE,Me(e)),Ye(e,"themeSprite",ME,Me(e)),Ye(e,"tileBlockIconSprite",NE,Me(e)),Ye(e,"titleLabel",FE,Me(e)),e.visibilityTween=null,e.isVisible=!1,e.payload=nC,e}return xe(o,[{key:"isLocked",get:function(){return this.payload.isLocked},set:function(e){this.payload.isLocked=e,this.updateThemeBlockDisplay()}},{key:"getSkinName",value:function(){return this.payload.skin}},{key:"__preload",value:function(){this.uiTransform=this.getComponent(s),this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){kt.lazyValidateProperties(this)}},{key:"updateThemeBlockDisplay",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:nC;this.payload=e;var t=e.progress,n=e.max,i=e.isLocked,a=e.themeId,r=e.skin;this.updateTitle(a),this.updateSkinAsync(r),this.updateThemeAsync(a);var o=this.progressBar.getComponent(vE);if(!o)throw new Error("ThemeBlock: progressBarComponent not found");this.mask.active=i,this.progressBar.active=!i,this.lockAnimator.node.active=i,i||o.setProgress(t,n)}},{key:"playUnlockAnim",value:(a=Ce(Se().mark((function e(t){var n,i,a,r,o=arguments;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=o.length>1&&void 0!==o[1]?o[1]:nC,this.payload=ke(ke({},n),{},{isLocked:!1}),i=n.progress,a=n.max,r=this.progressBar.getComponent(vE)){e.next=6;break}throw new Error("ThemeBlock: progressBarComponent not found");case 6:return this.mask.active=!0,this.progressBar.active=!1,this.lockAnimator.node.active=!0,r.setProgress(i,a),e.next=12,this.animateUnlockedState(t);case 12:case"end":return e.stop()}}),e,this)}))),function(e){return a.apply(this,arguments)})},{key:"updateTitle",value:function(e){switch(e){case wl.SUMMER:this.titleLabel.string="Summer";break;case wl.WINTER:this.titleLabel.string="Winter";break;case wl.AUTUMN:this.titleLabel.string="Autumn"}}},{key:"updateSkinAsync",value:(i=Ce(Se().mark((function e(t){var n,i=this;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,ai.loadSkinPreviewAsync(t);case 2:if(n=e.sent,this.tileBlockIconSprite){e.next=5;break}return e.abrupt("return");case 5:n.forEach((function(e,t){e&&(i.tileBlockIconSprite[t].spriteFrame=e)}));case 6:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})},{key:"updateThemeAsync",value:(n=Ce(Se().mark((function e(t){var n;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,ai.loadThemePreviewAsync(t);case 2:if(n=e.sent,this.themeSprite&&n){e.next=5;break}return e.abrupt("return");case 5:this.themeSprite.spriteFrame=n,this.themeLoadingRing&&(this.themeLoadingRing.active=!1);case 7:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"animateUnlockedState",value:(t=Ce(Se().mark((function e(t){var n,i,a;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=this.mask.getComponent(N),a=this.progressBar.getComponent(N),i){e.next=4;break}throw new Error("ThemeBlock: maskUIOpacity not found");case 4:if(a){e.next=6;break}throw new Error("ThemeBlock: progressBarUIOpacity not found");case 6:return this.mask.active=!0,i.opacity=null!==(n=i.opacity)&&void 0!==n?n:255,this.progressBar.active=!0,a.opacity=0,e.next=12,this.lockAnimator.unlock(t);case 12:return this.lockAnimator.node.active=!1,e.next=15,Promise.all([vn.runTweenAsync(S(i).to(.25,{opacity:0}),t),vn.runTweenAsync(S(a).to(.25,{opacity:255}),t)]);case 15:this.mask.active=!1,i.opacity=0,a.opacity=255;case 18:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"getUITransform",value:function(){return this.uiTransform}},{key:"setVisible",value:function(e){var t;this.isVisible!==e&&(this.isVisible=e,null===(t=this.visibilityTween)||void 0===t||t.stop(),this.visibilityTween=S(this.nodeUIOpacity).to(.05,{opacity:e?255:0}).start())}}]),o}(f)).prototype,"mask",[mE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),PE=Xe(RE.prototype,"nodeUIOpacity",[gE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_E=Xe(RE.prototype,"progressBar",[bE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),LE=Xe(RE.prototype,"backgroundUI",[wE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),OE=Xe(RE.prototype,"lockAnimator",[kE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),DE=Xe(RE.prototype,"themeLoadingRing",[SE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ME=Xe(RE.prototype,"themeSprite",[EE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),NE=Xe(RE.prototype,"tileBlockIconSprite",[CE],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),FE=Xe(RE.prototype,"titleLabel",[TE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Xe(RE.prototype,"isLocked",[AE],Object.getOwnPropertyDescriptor(RE.prototype,"isLocked"),RE.prototype),xE=RE))||xE);n._RF.pop(),n._RF.push({},"b3a4dy5XgpIT6stybzgYjnu","CollectionsContent",void 0);var aC,rC=i.ccclass,oC=i.property,sC=globalThis.game.storage,lC=(VE=rC("CollectionsContent"),qE=oC(Gr),WE=oC(ue),KE=oC(da),jE=oC({type:E,displayName:"Offset from top of scroll view",tooltip:"The offset between the first theme tab and the top of the scroll view"}),VE(($E=Xe((XE=function(e){Ie(r,e);var t,n,i,a=Fe(r);function r(){var e;Te(this,r);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return(e=a.call.apply(a,[this].concat(n))).animateThemeTabUnlock=null,Ye(e,"panelAnimator",$E,Me(e)),Ye(e,"themeScrollView",QE,Me(e)),Ye(e,"contentOpacity",JE,Me(e)),e.themeBlocks=[],e.preservedScrollPosition=new Q,Ye(e,"offsetFromTopOfScrollView",ZE,Me(e)),e.updateBlocksVisibility=function(){var t=e.uiTransform.getBoundingBoxToWorld(),n=t.yMax,i=t.yMin;e.themeBlocks.forEach((function(e){var t=e.getUITransform().getBoundingBoxToWorld(),a=t.yMax,r=t.yMin,o=a<i||r>n;e.setVisible(!o)}))},e.hideContent=function(){e.contentOpacity.changeStateFade(!1,.1)},e.showContent=function(){e.contentOpacity.changeStateFade(!0,.1)},e}return xe(r,[{key:"__preload",value:function(){var e,t;this.uiTransform=this.getComponent(s),this.themeBlocks=null!==(e=null===(t=this.themeScrollView.content)||void 0===t?void 0:t.getComponentsInChildren(iC))&&void 0!==e?e:[],this.validateRequiredComponents()}},{key:"listenEvents",value:function(){this.themeScrollView.node.on(ue.EventType.SCROLLING,this.updateBlocksVisibility),this.node.scene.on(pr.HIDE_UI,this.hideContent),this.node.scene.on(pr.SHOW_UI,this.showContent)}},{key:"unlistenEvents",value:function(){this.themeScrollView.node.off(ue.EventType.SCROLLING,this.updateBlocksVisibility),this.unlistenUIEvents()}},{key:"unlistenUIEvents",value:function(){this.node.scene.off(pr.HIDE_UI,this.hideContent),this.node.scene.off(pr.SHOW_UI,this.showContent)}},{key:"init",value:function(e){0!==e.length&&this.getThemeTabs().forEach((function(t,n){return t.updateThemeBlockDisplay(e[n])}))}},{key:"preserveScrollPosition",value:function(){this.themeScrollView.stopAutoScroll(),this.preservedScrollPosition.set(this.themeScrollView.getScrollOffset())}},{key:"restoreScrollPosition",value:function(){this.themeScrollView.scrollToOffset(this.preservedScrollPosition,0)}},{key:"updateUnlockedProgress",value:function(e){var t=this,n=sC.getStorageData("collection","animateMapPackUnlock"),i=sC.getStorageData("collection","lastMapPack");e.forEach((function(e,a){var r=e.skin,o=e.progress,s=e.max,l=e.isLocked;if(o<s&&!l&&n&&i!==a+1)return t.animateThemeTabUnlock=e,sC.setStorageData("collection","animateMapPackUnlock",!1),sC.setStorageData("collection","lastMapPack",a+1),void t.setProgressToThemeTab(r,ke(ke({},e),{},{isLocked:!0}));t.setProgressToThemeTab(r,e)}))}},{key:"shouldAnimateThemeTabUnlock",value:function(){return null!==this.animateThemeTabUnlock}},{key:"playThemeTabUnlockAnim",value:(i=Ce(Se().mark((function e(t){var n;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.animateThemeTabUnlock){e.next=2;break}return e.abrupt("return");case 2:if(void 0!==(n=this.findThemeTab(this.animateThemeTabUnlock.skin))){e.next=5;break}throw new Error("CollectionsContent: ThemeTab not found");case 5:return e.next=7,n.playUnlockAnim(t,ke(ke({},this.animateThemeTabUnlock),{},{isLocked:!0}));case 7:this.animateThemeTabUnlock=null;case 8:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})},{key:"scrollToCurrentUnlockingTheme",value:(n=Ce(Se().mark((function e(t,n){var i,a,r;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=this.findThemeTab(t)){e.next=3;break}return e.abrupt("return");case 3:return a=i.node.position.y,r=-a-this.offsetFromTopOfScrollView,e.next=7,this.scrollToOffset(new Q(0,r),2,n);case 7:case"end":return e.stop()}}),e,this)}))),function(e,t){return n.apply(this,arguments)})},{key:"scrollToOffset",value:(t=Ce(Se().mark((function e(t,n,i){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.themeScrollView.scrollToOffset(t,n),e.next=3,vn.waitTweenAsync(n,i);case 3:i.aborted&&(this.themeScrollView.stopAutoScroll(),this.themeScrollView.scrollToOffset(t,0));case 4:case"end":return e.stop()}}),e,this)}))),function(e,n,i){return t.apply(this,arguments)})},{key:"setProgressToThemeTab",value:function(e,t){var n=this.findThemeTab(e);if(void 0===n)throw new Error("CollectionsContent: ThemeTab not found");n.updateThemeBlockDisplay(t)}},{key:"findThemeTab",value:function(e){return this.getThemeTabs().find((function(t){return t.getSkinName()===e}))}},{key:"getThemeTabs",value:function(){return this.themeScrollView.content.getComponentsInChildren(iC)}},{key:"enableUIAnimator",value:function(){this.panelAnimator.enabled=!0}},{key:"disableUIAnimator",value:function(){this.panelAnimator.enabled=!1}},{key:"validateRequiredComponents",value:function(){kt.lazyValidateProperties(this)}}]),r}(f)).prototype,"panelAnimator",[qE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),QE=Xe(XE.prototype,"themeScrollView",[WE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),JE=Xe(XE.prototype,"contentOpacity",[KE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ZE=Xe(XE.prototype,"offsetFromTopOfScrollView",[jE],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 407.5}}),YE=XE))||YE);n._RF.pop(),n._RF.push({},"dab8cbliOBAeZ7iVs959mBm","CollectionsPage",void 0);var uC,cC,hC,pC,dC,fC,vC,yC,mC,gC,bC,wC,kC,SC,EC,CC,TC,AC,xC,RC,IC,PC,_C,LC,OC,DC,MC,NC=(0,i.ccclass)("CollectionsPage")(aC=function(e){Ie(r,e);var t,n,i,a=Fe(r);function r(){var e;Te(this,r);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return(e=a.call.apply(a,[this].concat(n))).payload=null,e}return xe(r,[{key:"setPayload",value:function(e){this.payload=e}},{key:"mount",value:(i=Ce(Se().mark((function e(){var t;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.pagePrefab){e.next=5;break}return e.next=3,ai.loadPrefabAsync(Dn.COLLECTIONS_PAGE);case 3:(t=e.sent)&&this.node&&(this.pagePrefab=t);case 5:return e.next=7,Ge(Pe(r.prototype),"mount",this).call(this);case 7:if(this.containerUIOpacity.opacity=0,this.themeContent){e.next=12;break}if(this.themeContent=this.container.getComponentInChildren(lC),this.themeContent){e.next=12;break}throw new Error("No theme content found");case 12:this.payload&&this.themeContent.init(this.payload);case 13:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"transitionIn",value:(n=Ce(Se().mark((function e(){var t,n,i=this;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Ge(Pe(r.prototype),"transitionIn",this).call(this);case 2:return this.themeContent.restoreScrollPosition(),this.themeContent.updateBlocksVisibility(),this.themeContent.enableUIAnimator(),this.themeContent.listenEvents(),t=vn.runTweenAsync(S(this.containerUIOpacity).to(.2,{opacity:255})),n=new Promise((function(e){i.node.scene.emit(pr.SHOW_UI,{onComplete:function(){e()}})})),e.next=10,Promise.all([t,n]);case 10:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"transitionOut",value:(t=Ce(Se().mark((function e(){var t=this;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Ge(Pe(r.prototype),"transitionOut",this).call(this);case 2:return this.themeContent.preserveScrollPosition(),this.themeContent.unlistenUIEvents(),e.next=6,new Promise((function(e){t.node.scene.emit(pr.HIDE_UI,{onComplete:function(){e()}})}));case 6:this.themeContent.disableUIAnimator(),this.themeContent.unlistenEvents();case 8:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),r}(QS))||aC;n._RF.pop(),n._RF.push({},"2381b1mKt1PUq5W+fsaaOYP","PageManager",void 0);var FC,BC,GC,zC,UC,HC,VC,qC,WC,KC,jC,YC,XC,$C=i.ccclass,QC=i.property,JC=i.disallowMultiple,ZC=i.requireComponent,eT=(uC=$C("PageManagerItem"),cC=QC(QS),hC=QC({type:D(Ln)}),uC((fC=Xe((dC=xe((function e(){Te(this,e),Ye(this,"page",fC,this),Ye(this,"pageType",vC,this)}))).prototype,"page",[cC],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),vC=Xe(dC.prototype,"pageType",[hC],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),pC=dC))||pC),tT=(yC=$C("PageManager"),mC=ZC(s),gC=QC({type:N,displayName:"Background Mask",group:"Background Mask"}),bC=QC({type:E,displayName:"Transition duration",group:"Background Mask"}),wC=QC({type:E,displayName:"Transition delay",group:"Background Mask"}),kC=QC({type:N,displayName:"Nav Bar Shadow",group:"Nav Bar Shadow"}),SC=QC({type:E,displayName:"Transition duration",group:"Nav Bar Shadow"}),EC=QC({type:E,displayName:"Transition delay",group:"Nav Bar Shadow"}),CC=QC({type:[eT]}),TC=QC({type:D(Ln)}),yC(AC=JC(AC=mC((RC=Xe((xC=function(e){Ie(o,e);var t,n,i,a,r=Fe(o);function o(){var e;Te(this,o);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return Ye(e=r.call.apply(r,[this].concat(n)),"backgroundMask",RC,Me(e)),Ye(e,"backgroundMaskTransitionDuration",IC,Me(e)),Ye(e,"backgroundMaskTransitionDelay",PC,Me(e)),Ye(e,"navBarShadow",_C,Me(e)),Ye(e,"navBarShadowTransitionDuration",LC,Me(e)),Ye(e,"navBarShadowTransitionDelay",OC,Me(e)),Ye(e,"pageItems",DC,Me(e)),Ye(e,"currentScreen",MC,Me(e)),e}return xe(o,[{key:"unmountAndHideAll",value:function(){var e=this;this.pageItems.forEach((function(t){var n=t.page;t.pageType!==e.currentScreen&&(n.unmount(),n.hide())}))}},{key:"onLoad",value:function(){this.uiTransform=this.getComponent(s),this.validateRequiredComponents()}},{key:"updateCollectionsContentPayload",value:function(e){var t=this.getPage(Ln.collections);t&&t instanceof NC&&t.setPayload(e)}},{key:"navigate",value:(a=Ce(Se().mark((function e(t,n,i){var a,r,o,s,l,u,c,h,p,d,f,v,y,m,g;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=t.from,r=t.to,null!==a){e.next=15;break}return(o=this.getPage(this.currentScreen)).show(),e.next=6,o.mount();case 6:return e.next=8,null==n?void 0:n(o);case 8:return this.node.scene.emit(Pn,{from:null,to:r}),e.next=11,o.transitionIn();case 11:return e.next=13,null==i?void 0:i(o);case 13:return this.currentScreen=r,e.abrupt("return");case 15:if(a===this.currentScreen){e.next=17;break}throw new Error("PageManager: Cannot navigate from a different screen. Perhaps you forgot to update the currentScreen property.");case 17:if(s=this.getPage(this.currentScreen),(l=this.getPage(r))&&s){e.next=21;break}throw new Error("PageManager: Cannot navigate to/from a null page. Perhaps you forgot to add the page to the pageItems array in the editor.");case 21:if(u=this.uiTransform.width,c=this.getPageIndex(a),h=this.getPageIndex(r),p=Math.min(c,h),d=Math.max(c,h),f=(d-p)*u,v=c<h?1:-1,(y=this.pageItems.slice(p,d+1)).forEach((function(e,t){var n=e.page;n.show(),n.getWidget().enabled=!1,n.node.position=new Y((t+p-c)*u,n.node.position.y,n.node.position.z)})),m=!1,l.hasLoadedPage()){e.next=36;break}return m=!0,lu.showLoadingScreen(),e.next=36,vn.waitTweenAsync(.5);case 36:return e.next=38,l.mount();case 38:return e.next=40,null==n?void 0:n(l);case 40:return this.node.scene.emit(Pn,{from:a,to:r}),e.next=43,Promise.all([s.transitionOut(),this.transition(f,v,y),this.handleBackgroundMask(this.backgroundMaskTransitionDuration,l.getDarkenBackground()),this.handleNavBarShadow(this.navBarShadowTransitionDuration,l.getNavbarShadow())]);case 43:return(g=l.getWidget()).enabled=!0,g.left=0,g.right=0,l.updateWidgets(),l.updateLayouts(),y.forEach((function(e){e.pageType!==r&&(e.page.unmount(),e.page.hide())})),this.currentScreen=r,e.next=53,l.transitionIn();case 53:return e.next=55,null==i?void 0:i(l);case 55:m&&lu.closeLoadingScreen();case 56:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return a.apply(this,arguments)})},{key:"getPage",value:function(e){var t=this.getPageIndex(e);return-1!==t?this.pageItems[t].page:null}},{key:"handleBackgroundMask",value:(i=Ce(Se().mark((function e(t,n){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,vn.runTweenAsync(S(this.backgroundMask).delay(this.backgroundMaskTransitionDelay).to(t,{opacity:n}).start());case 2:case"end":return e.stop()}}),e,this)}))),function(e,t){return i.apply(this,arguments)})},{key:"handleNavBarShadow",value:(n=Ce(Se().mark((function e(t,n){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,vn.runTweenAsync(S(this.navBarShadow).delay(this.navBarShadowTransitionDelay).to(t,{opacity:n}).start());case 2:case"end":return e.stop()}}),e,this)}))),function(e,t){return n.apply(this,arguments)})},{key:"getPageIndex",value:function(e){return this.pageItems.findIndex((function(t){return t.pageType===e}))}},{key:"transition",value:(t=Ce(Se().mark((function e(t,n,i){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all(i.map((function(e){var i=e.page;return vn.runTweenAsync(S(i.node).to(.5,{position:new Y(i.node.position.x-t*n,i.node.position.y,i.node.position.z)},{easing:M.quintInOut}))})));case 2:case"end":return e.stop()}}),e)}))),function(e,n,i){return t.apply(this,arguments)})},{key:"validateRequiredComponents",value:function(){if(!this.uiTransform)throw new Error("PageManager requires UITransform component");if(!this.backgroundMask)throw new Error("PageManager requires background mask")}}]),o}(f)).prototype,"backgroundMask",[gC],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),IC=Xe(xC.prototype,"backgroundMaskTransitionDuration",[bC],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.5}}),PC=Xe(xC.prototype,"backgroundMaskTransitionDelay",[wC],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.3}}),_C=Xe(xC.prototype,"navBarShadow",[kC],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),LC=Xe(xC.prototype,"navBarShadowTransitionDuration",[SC],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.5}}),OC=Xe(xC.prototype,"navBarShadowTransitionDelay",[EC],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.3}}),DC=Xe(xC.prototype,"pageItems",[CC],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),MC=Xe(xC.prototype,"currentScreen",[TC],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Ln.home}}),AC=xC))||AC)||AC)||AC);n._RF.pop(),n._RF.push({},"500274Qu9dAjJwYv27wMaMU","StarProgressBar",void 0);var nT,iT,aT,rT,oT,sT,lT=i.ccclass,uT=i.property,cT=(FC=lT("StarProgressBar"),BC=uT(go),GC=uT(u),zC=uT(g),UC=uT(g),HC=uT(m),FC((WC=Xe((qC=function(e){Ie(i,e);var t,n=Fe(i);function i(){var e;Te(this,i);for(var t=arguments.length,a=new Array(t),r=0;r<t;r++)a[r]=arguments[r];return Ye(e=n.call.apply(n,[this].concat(a)),"progressBar",WC,Me(e)),Ye(e,"progressLabel",KC,Me(e)),Ye(e,"current",jC,Me(e)),Ye(e,"total",YC,Me(e)),Ye(e,"separator",XC,Me(e)),e}return xe(i,[{key:"setRange",value:function(e,t){this.total=t,this.current=e,this.updateProgress()}},{key:"onLoad",value:function(){this.validateRequiredComponents()}},{key:"updateProgress",value:function(){this.progressBar.progress=Math.min(this.current,this.total)/this.total,this.updateProgressLabel()}},{key:"updateProgressLabel",value:function(){this.progressLabel.string=`${this.current}${this.separator}${this.total}`}},{key:"animateTo",value:(t=Ce(Se().mark((function e(t,n,i){var a,r,o,s,l=this;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=Math.min(t,this.total)/this.total,r=this.current,o=1,s=S(this.progressBar).to(3,{progress:a},{easing:"quadOut",onUpdate:function(e,n){n&&(l.current=r+Math.floor((t-r)*n),null==i||i(l.current),l.current===r-o&&(o++,S(l.progressLabel.node).to(.05,{scale:new Y(1.2,1.2,1.2)}).to(.05,{scale:Y.ONE}).start()),l.updateProgressLabel())}}),null==n||n.addAbortListener((function(){l.current=t,l.updateProgress()})),e.next=7,vn.runTweenAsync(s,n);case 7:case"end":return e.stop()}}),e,this)}))),function(e,n,i){return t.apply(this,arguments)})},{key:"validateRequiredComponents",value:function(){if(!this.progressBar)throw new Error("JourneyProgressBar: Missing required component TapperedProgressBar");if(!this.progressLabel)throw new Error("JourneyProgressBar: Missing required component Label")}}]),i}(f)).prototype,"progressBar",[BC],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),KC=Xe(qC.prototype,"progressLabel",[GC],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),jC=Xe(qC.prototype,"current",[zC],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),YC=Xe(qC.prototype,"total",[UC],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),XC=Xe(qC.prototype,"separator",[HC],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),VC=qC))||VC);n._RF.pop(),n._RF.push({},"83036ocqiZHXrI3Aq0dBJRD","EventButton",void 0);var hT,pT,dT,fT,vT,yT,mT,gT,bT,wT,kT,ST=i.ccclass,ET=i.property,CT=(nT=ST("EventButton"),iT=ET({type:D(wg)}),aT=ET(H),nT((sT=Xe((oT=function(e){Ie(n,e);var t=Fe(n);function n(){var e;Te(this,n);for(var i=arguments.length,a=new Array(i),r=0;r<i;r++)a[r]=arguments[r];return Ye(e=t.call.apply(t,[this].concat(a)),"eventType",sT,Me(e)),e._isAvailable=!1,e}return xe(n,[{key:"isAvailable",get:function(){return this._isAvailable},set:function(e){this._isAvailable=e,this.fakeClick()}},{key:"handleClick",value:function(){this.node.scene.emit(_n,{type:this.eventType})}},{key:"setAnimationState",value:function(e){this.animationController.setValue("RESET-SPECIAL",this._isAvailable),Ge(Pe(n.prototype),"setAnimationState",this).call(this,e)}}]),n}(ua)).prototype,"eventType",[iT],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return wg.STAR_CHEST}}),Xe(oT.prototype,"isAvailable",[aT],Object.getOwnPropertyDescriptor(oT.prototype,"isAvailable"),oT.prototype),rT=oT))||rT);n._RF.pop(),n._RF.push({},"87a11fQFYVFcphsqf5ivVof","DashboardHeader",void 0);var TT,AT,xT,RT,IT,PT,_T,LT,OT,DT,MT,NT,FT,BT,GT,zT,UT,HT,VT=i.ccclass,qT=i.property,WT=globalThis.game.player,KT=(hT=VT("DashboardHeader"),pT=qT({type:cT,displayName:"Progress bar",group:"Star Chest"}),dT=qT({type:CT,displayName:"Button Component",group:"Star Chest"}),fT=qT({type:_,displayName:"Default Rest animation",group:"Star Chest"}),vT=qT({type:_,displayName:"Special Rest animation",group:"Star Chest"}),hT((gT=Xe((mT=function(e){Ie(n,e);var t=Fe(n);function n(){var e;Te(this,n);for(var i=arguments.length,a=new Array(i),r=0;r<i;r++)a[r]=arguments[r];return Ye(e=t.call.apply(t,[this].concat(a)),"starProgressBar",gT,Me(e)),Ye(e,"chestButton",bT,Me(e)),Ye(e,"defaultRestAnimation",wT,Me(e)),Ye(e,"specialRestAnimation",kT,Me(e)),e.handleStarsUpdateEvent=function(t){var n,i;void 0!==(t=null!==(n=t)&&void 0!==n?n:null===(i=WT.getGameData())||void 0===i?void 0:i.stars)&&(e.starProgressBar.setRange(t,20),e.updateStarChestButtonAnimation(t))},e}return xe(n,[{key:"__preload",value:function(){this.validateRequiredComponents(),W.on(xn,this.handleStarsUpdateEvent)}},{key:"onDestroy",value:function(){W.off(xn,this.handleStarsUpdateEvent)}},{key:"updateStarProgress",value:function(e){this.handleStarsUpdateEvent(e)}},{key:"updateStarChestButtonAnimation",value:function(e){this.chestButton.isAvailable=e>=20}},{key:"validateRequiredComponents",value:function(){if(!this.starProgressBar)throw new Error("DashboardHeader: starProgressBar not found");if(!this.chestButton)throw new Error("DashboardHeader: chestButton not found");if(!this.defaultRestAnimation)throw new Error("DashboardHeader: defaultRestAnimation not found");if(!this.specialRestAnimation)throw new Error("DashboardHeader: specialRestAnimation not found")}}]),n}(f)).prototype,"starProgressBar",[pT],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),bT=Xe(mT.prototype,"chestButton",[dT],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wT=Xe(mT.prototype,"defaultRestAnimation",[fT],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),kT=Xe(mT.prototype,"specialRestAnimation",[vT],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),yT=mT))||yT);n._RF.pop(),n._RF.push({},"3b954Re2cRHvYJeBVAukYp9","JourneyLevelAvatar",void 0);var jT,YT,XT,$T,QT,JT,ZT,eA,tA,nA,iA,aA,rA=i.ccclass,oA=i.property,sA=i.executeInEditMode,lA=(TT=rA("JourneyLevelAvatar"),AT=oA({type:A,displayName:"Avatar node"}),xT=oA(a),RT=oA(y),IT=oA(N),PT=oA({type:_,group:"Animation"}),_T=oA({type:_,group:"Animation"}),LT=oA({type:_,group:"Animation"}),OT=oA({type:O,displayName:"Avatar sprite"}),TT(DT=sA((NT=Xe((MT=function(e){Ie(r,e);var t,n,i,a=Fe(r);function r(){var e;Te(this,r);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return Ye(e=a.call.apply(a,[this].concat(n)),"sprite",NT,Me(e)),Ye(e,"lockIcon",FT,Me(e)),Ye(e,"animation",BT,Me(e)),Ye(e,"opacity",GT,Me(e)),Ye(e,"flashAnimation",zT,Me(e)),Ye(e,"unlockAnimation",UT,Me(e)),Ye(e,"spawnAnimation",HT,Me(e)),e}return xe(r,[{key:"avatarSprite",get:function(){var e,t;return null!==(e=null===(t=this.sprite)||void 0===t?void 0:t.spriteFrame)&&void 0!==e?e:null},set:function(e){this.sprite&&(this.sprite.spriteFrame=e)}},{key:"playUnlockAnimation",value:(i=Ce(Se().mark((function e(){var t,n,i,a,r,o,s,l,u,c,h;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.playAnimation(this.unlockAnimation),n=this.lockIcon.position.x,i=this.lockIcon.position.y,a=[45,135],r=(Math.random()*(a[1]-a[0])+a[0])*(Math.PI/180),o=this.lockIcon.position.x+150*Math.cos(r),s=this.lockIcon.position.y+150*Math.sin(r),l=i-400,u=vn.runTweenAsync(S(this.lockIcon).delay(.3).to(.2,{position:new Y(o,s,this.lockIcon.position.z)},{easing:"sineOut"}).to(.4,{position:new Y(o,l,this.lockIcon.position.z)},{easing:"cubicIn"})),c=[0,360],h=vn.runTweenAsync(S(this.lockIcon).delay(.3).to(.6,{eulerAngles:new Y(0,0,Math.random()*(c[1]-c[0])*(o>n?-1:1))},{easing:"sineOut"})),e.next=14,Promise.all([t,u,h]);case 14:this.lockIcon.position=new Y(n,i,this.lockIcon.position.z),this.lockIcon.eulerAngles=new Y(0,0,0);case 16:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"playFlashAnimation",value:(n=Ce(Se().mark((function e(){var t,n,i;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.node.position.y,n=this.playAnimation(this.flashAnimation),i=vn.runTweenAsync(S(this.node).to(.1,{position:new Y(this.node.position.x,this.node.position.y+10,this.node.position.z)},{easing:"sineOut"}).to(.1,{position:new Y(this.node.position.x,t,this.node.position.z)},{easing:"sineIn"})),e.next=5,Promise.all([n,i]);case 5:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"playSpawnAnimation",value:function(){this.opacity.opacity=255,this.playAnimation(this.spawnAnimation)}},{key:"hideImmediately",value:function(){this.opacity.opacity=0,this.node.setScale(Y.ZERO)}},{key:"playAnimation",value:(t=Ce(Se().mark((function e(t){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,vn.runAnimationAsync(this.animation,t.name);case 2:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"onLoad",value:function(){this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){var e=this;if(!this.sprite)throw new Error("JourneyLevelAvatar: Avatar node is required");if(!this.lockIcon)throw new Error("JourneyLevelAvatar: Lock icon is required");if(!this.flashAnimation)throw new Error("JourneyLevelAvatar: Flash animation is required");if(!this.unlockAnimation)throw new Error("JourneyLevelAvatar: Unlock animation is required");if(!this.animation)throw new Error("JourneyLevelAvatar: Animation component is required");if(!this.animation.clips.some((function(t){return null!==t&&(t.name===e.flashAnimation.name||t.name===e.unlockAnimation.name||t.name===e.spawnAnimation.name)})))throw new Error("JourneyLevelAvatar: Animation component does not contain required animations")}}]),r}(f)).prototype,"sprite",[AT],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),FT=Xe(MT.prototype,"lockIcon",[xT],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),BT=Xe(MT.prototype,"animation",[RT],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),GT=Xe(MT.prototype,"opacity",[IT],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),zT=Xe(MT.prototype,"flashAnimation",[PT],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),UT=Xe(MT.prototype,"unlockAnimation",[_T],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),HT=Xe(MT.prototype,"spawnAnimation",[LT],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Xe(MT.prototype,"avatarSprite",[OT],Object.getOwnPropertyDescriptor(MT.prototype,"avatarSprite"),MT.prototype),DT=MT))||DT)||DT);n._RF.pop(),n._RF.push({},"a392bibG75JPKzG0y2ZS2YY","JourneyProgressBar",void 0);var uA,cA,hA,pA,dA,fA,vA,yA,mA,gA,bA,wA,kA,SA,EA,CA,TA,AA,xA,RA,IA,PA,_A=i.ccclass,LA=i.property,OA=i.executeInEditMode,DA=(jT=_A("JourneyProgressBar"),YT=LA(go),XT=LA(u),$T=LA(N),QT=LA(g),JT=LA(g),ZT=LA(m),jT(eA=OA((nA=Xe((tA=function(e){Ie(i,e);var t,n=Fe(i);function i(){var e;Te(this,i);for(var t=arguments.length,a=new Array(t),r=0;r<t;r++)a[r]=arguments[r];return Ye(e=n.call.apply(n,[this].concat(a)),"progressBar",nA,Me(e)),Ye(e,"progressLabel",iA,Me(e)),Ye(e,"labelUIOpacity",aA,Me(e)),e.currentProgress=10,e.totalProgress=10,e.labelSeparator="/",e}return xe(i,[{key:"total",get:function(){return this.totalProgress}},{key:"current",get:function(){return this.currentProgress}},{key:"separator",get:function(){return this.labelSeparator},set:function(e){this.labelSeparator=e,this.updateProgress()}},{key:"setRange",value:function(e,t){this.totalProgress=t,e>t&&(e=t),this.currentProgress=e,this.updateProgress()}},{key:"onLoad",value:function(){this.validateRequiredComponents()}},{key:"animateTo",value:(t=Ce(Se().mark((function e(t){var n,i,a,r,o,s,l,u,c,h,p,d,f,v=this;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.nextCurr,i=t.nextTotal,a=t.numberOfProgressBar,r=void 0===a?0:a,o=t.onProgressBarPassed,s=t.signal,l=n/i,u=S(this.labelUIOpacity).to(.2,{opacity:0}),c=S(this.labelUIOpacity).to(.2,{opacity:255}),h=r<1?1:Math.sqrt(r)+1,p=0===r?l:r+l,d=1,f=S({curr:this.progressBar.progress}).to(h,{curr:p},{easing:"sineInOut",onUpdate:function(e){if(void 0!==e){var t=e.curr;v.progressBar.progress=t%1,t>d&&(d=0===t?1:Math.ceil(t),null==o||o())}}}),e.next=10,Promise.all([vn.runTweenAsync(u,s),vn.runTweenAsync(f,s)]);case 10:return this.currentProgress=n,this.totalProgress=i,this.updateProgress(),e.next=15,vn.runTweenAsync(c,s);case 15:return this.labelUIOpacity.opacity=255,e.abrupt("return",l);case 17:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"updateProgress",value:function(){this.progressBar.progress=this.currentProgress/this.totalProgress,this.progressLabel.string=`${this.currentProgress}${this.separator}${this.totalProgress}`}},{key:"validateRequiredComponents",value:function(){if(!this.progressBar)throw new Error("JourneyProgressBar: Missing required component TapperedProgressBar");if(!this.progressLabel)throw new Error("JourneyProgressBar: Missing required component Label")}}]),i}(f)).prototype,"progressBar",[YT],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),iA=Xe(tA.prototype,"progressLabel",[XT],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),aA=Xe(tA.prototype,"labelUIOpacity",[$T],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Xe(tA.prototype,"total",[QT],Object.getOwnPropertyDescriptor(tA.prototype,"total"),tA.prototype),Xe(tA.prototype,"current",[JT],Object.getOwnPropertyDescriptor(tA.prototype,"current"),tA.prototype),Xe(tA.prototype,"separator",[ZT],Object.getOwnPropertyDescriptor(tA.prototype,"separator"),tA.prototype),eA=tA))||eA)||eA);n._RF.pop(),n._RF.push({},"8a41bfxLylDhLk57kewW14A","JourneyProgressAnimator",void 0);var MA,NA,FA,BA,GA,zA,UA,HA,VA,qA,WA,KA,jA,YA,XA,$A,QA,JA=i.ccclass,ZA=i.property,ex=(uA=JA("ProgressConfiguration"),cA=ZA(O),hA=ZA(m),uA((fA=Xe((dA=xe((function e(){Te(this,e),Ye(this,"avatar",fA,this),Ye(this,"themeId",vA,this)}))).prototype,"avatar",[cA],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),vA=Xe(dA.prototype,"themeId",[hA],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),pA=dA))||pA),tx=(yA=JA("JourneyProgressAnimator"),mA=ZA(DA),gA=ZA(a),bA=ZA(A),wA=ZA(lA),kA=ZA(ex),SA=ZA({type:E,displayName:"Next Level Y Offset on Animation",group:"Unlocked Animation"}),yA((TA=Xe((CA=function(e){Ie(o,e);var t,n,i,a,r=Fe(o);function o(){var e;Te(this,o);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return Ye(e=r.call.apply(r,[this].concat(n)),"progressBar",TA,Me(e)),Ye(e,"currentLevelAvatarNode",AA,Me(e)),Ye(e,"currentLevelAvatar",xA,Me(e)),Ye(e,"nextLevelAvatar",RA,Me(e)),Ye(e,"progressConfigs",IA,Me(e)),Ye(e,"nextLevelYOffset",PA,Me(e)),e.isAnimating=!1,e}return xe(o,[{key:"setRange",value:function(e,t){this.progressBar.setRange(e,t)}},{key:"animateTo",value:(a=Ce(Se().mark((function e(t,n){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.isAnimating){e.next=3;break}return console.warn("JourneyProgressAnimator: animation already in progress"),e.abrupt("return",Promise.resolve());case 3:if(this.isAnimating=!0,t===this.progressBar.current){e.next=7;break}return e.next=7,this.progressBar.animateTo({nextCurr:t,nextTotal:this.progressBar.total,signal:n});case 7:this.isAnimating=!1;case 8:case"end":return e.stop()}}),e,this)}))),function(e,t){return a.apply(this,arguments)})},{key:"animateToNextLevel",value:(i=Ce(Se().mark((function e(t){var n,i,a,r,o,s,l,u,c,h=this;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.nextCurr,i=t.nextTotal,a=t.mapsPassed,r=t.signal,!this.isAnimating){e.next=4;break}return console.warn("JourneyProgressAnimator: animation already in progress"),e.abrupt("return");case 4:if(this.isAnimating=!0,0!=(o=a.length-2)){e.next=11;break}return e.next=9,this.progressBar.animateTo({nextCurr:n,nextTotal:i,signal:r});case 9:return this.isAnimating=!1,e.abrupt("return");case 11:return e.next=13,this.animateTargetAvaToCenter(r);case 13:return s=function(){if(1===l)return h.nextLevelAvatar.playUnlockAnimation(),void(l+=1);if(l>=a.length)throw new Error("JourneyProgressAnimator: currThemeIndex out of bounds");h.nextLevelAvatar.playFlashAnimation(),h.setNextLevelAvatar(a[l].theme),l+=1},l=1,e.next=17,this.progressBar.animateTo({signal:r,nextCurr:n,nextTotal:i,numberOfProgressBar:o,onProgressBarPassed:s});case 17:return e.next=19,this.animateTargetAvaToPrev(r);case 19:u=a[a.length-1].theme,c=a[a.length-2].theme,this.setCurrentLevelAvatar(c),this.nextLevelAvatar.hideImmediately(),this.moveTargetAvaToOriginal(),this.nextLevelAvatar.avatarSprite=this.getSpriteFrameByThemeId(u),this.nextLevelAvatar.playSpawnAnimation(),this.isAnimating=!1;case 27:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})},{key:"animateTargetAvaToCenter",value:(n=Ce(Se().mark((function e(t){var n;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=new Y(0,this.nextLevelYOffset+this.nextLevelAvatar.node.position.y,this.nextLevelAvatar.node.position.z),e.next=3,vn.runTweenAsync(S(this.nextLevelAvatar.node).to(1,{position:n},{easing:"cubicInOut"}),t);case 3:this.nextLevelAvatar.node.position=n;case 4:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"moveTargetAvaToOriginal",value:function(){this.nextLevelAvatar.node.position=this.originalNextLevelAvatarPosition.clone()}},{key:"animateTargetAvaToPrev",value:(t=Ce(Se().mark((function e(t){var n;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.currentLevelAvatarNode.position.clone(),e.next=3,vn.runTweenAsync(S(this.nextLevelAvatar.node).to(1,{position:n},{easing:"cubicInOut"}),t);case 3:this.nextLevelAvatar.node.position=n;case 4:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"getSpriteFrameByThemeId",value:function(e){var t=this.progressConfigs.find((function(t){return t.themeId===e}));if(!t)throw new Error(`JourneyProgressController: config not found for themeId ${e}`);return t.avatar}},{key:"setAvatar",value:function(e,t){var n=this.getSpriteFrameByThemeId(e);t instanceof lA?t.avatarSprite=n:t.spriteFrame=n}},{key:"setCurrentLevelAvatar",value:function(e){this.setAvatar(e,this.currentLevelAvatar)}},{key:"setNextLevelAvatar",value:function(e){this.setAvatar(e,this.nextLevelAvatar)}},{key:"onLoad",value:function(){this.validateRequiredComponents(),this.originalNextLevelAvatarPosition=this.nextLevelAvatar.node.position.clone()}},{key:"validateRequiredComponents",value:function(){kt.lazyValidateProperties(this)}}]),o}(f)).prototype,"progressBar",[mA],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),AA=Xe(CA.prototype,"currentLevelAvatarNode",[gA],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),xA=Xe(CA.prototype,"currentLevelAvatar",[bA],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),RA=Xe(CA.prototype,"nextLevelAvatar",[wA],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),IA=Xe(CA.prototype,"progressConfigs",[kA],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),PA=Xe(CA.prototype,"nextLevelYOffset",[SA],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),EA=CA))||EA);n._RF.pop(),n._RF.push({},"c2ddaEnKBVFvrM5x5nbfT7h","HomeContent",void 0);var nx,ix,ax,rx,ox,sx,lx,ux,cx,hx,px,dx,fx,vx,yx,mx=i.ccclass,gx=i.property,bx=globalThis.game.storage,wx=(MA=mx("HomeContent"),NA=gx(u),FA=gx(p),BA=gx(tx),GA=gx(Gr),zA=gx(KT),UA=gx(N),HA=gx(cS),MA((WA=Xe((qA=function(e){Ie(a,e);var t,n,i=Fe(a);function a(){var e;Te(this,a);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return Ye(e=i.call.apply(i,[this].concat(n)),"playButtonLabel",WA,Me(e)),Ye(e,"playButton",KA,Me(e)),Ye(e,"journeyProgressAnimator",jA,Me(e)),Ye(e,"panelAnimator",YA,Me(e)),Ye(e,"dashboardHeader",XA,Me(e)),Ye(e,"overlayDuringAnim",$A,Me(e)),Ye(e,"coinContainer",QA,Me(e)),e}return xe(a,[{key:"__preload",value:function(){this.validateRequiredComponents()}},{key:"getCoinContainer",value:function(){return this.coinContainer}},{key:"handlePlayButtonPress",value:function(){this.playButton.interactable=!1,this.node.scene.emit(Rn)}},{key:"setPlayButtonLabel",value:function(e){this.playButtonLabel.string=e}},{key:"updateStarProgress",value:function(e){this.dashboardHeader.updateStarProgress(e)}},{key:"setUnlockProgress",value:function(e){this.setProgress(e),this.updateCurrentMapInStorage(e)}},{key:"prepareUnlockProgressAnimation",value:function(e,t,n,i){var a=this;if(e.id===t.id){this.setProgress(ke(ke({},t),{},{progress:e.progress})),this.updateCurrentMapInStorage(t);var r=t.progress;return Ce(Se().mark((function e(){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a.playButton.interactable=!1,e.next=3,a.showOwnOverlay(i);case 3:return e.next=5,a.journeyProgressAnimator.animateTo(r,i);case 5:return e.next=7,a.hideOwnOverlay(i);case 7:a.playButton.interactable=!0;case 8:case"end":return e.stop()}}),e)})))}return this.setProgress(e),this.updateCurrentMapInStorage(t),Ce(Se().mark((function e(){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a.playButton.interactable=!1,e.next=3,a.showOwnOverlay(i);case 3:return e.next=5,a.journeyProgressAnimator.animateToNextLevel({nextCurr:t.progress,nextTotal:t.max,mapsPassed:n,signal:i});case 5:return e.next=7,a.hideOwnOverlay(i);case 7:a.playButton.interactable=!0;case 8:case"end":return e.stop()}}),e)})))}},{key:"hideOwnOverlay",value:(n=Ce(Se().mark((function e(t){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,vn.runTweenAsync(S(this.overlayDuringAnim).to(.3,{opacity:0}),t);case 2:this.overlayDuringAnim.opacity=0;case 3:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"showOwnOverlay",value:(t=Ce(Se().mark((function e(t){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,vn.runTweenAsync(S(this.overlayDuringAnim).to(.3,{opacity:150}),t);case 2:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"setProgress",value:function(e){var t=e.currentTheme,n=e.nextTheme,i=e.progress,a=e.max;this.journeyProgressAnimator.setCurrentLevelAvatar(t),this.journeyProgressAnimator.setNextLevelAvatar(null!=n?n:t),this.journeyProgressAnimator.setRange(i,a)}},{key:"updateCurrentMapInStorage",value:function(e){bx.setStorageData("dashboard","animateToCurrentLevel",!1),bx.setStorageData("dashboard","lastMapPayload",e)}},{key:"enableUIAnimator",value:function(){this.panelAnimator.enabled=!0}},{key:"disableUIAnimator",value:function(){this.panelAnimator.enabled=!1}},{key:"validateRequiredComponents",value:function(){kt.lazyValidateProperties(this)}}]),a}(f)).prototype,"playButtonLabel",[NA],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),KA=Xe(qA.prototype,"playButton",[FA],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),jA=Xe(qA.prototype,"journeyProgressAnimator",[BA],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),YA=Xe(qA.prototype,"panelAnimator",[GA],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),XA=Xe(qA.prototype,"dashboardHeader",[zA],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),$A=Xe(qA.prototype,"overlayDuringAnim",[UA],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),QA=Xe(qA.prototype,"coinContainer",[HA],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),VA=qA))||VA);n._RF.pop(),n._RF.push({},"f555belwQ1NHJr4np65OtcU","NavManager",void 0);var kx,Sx,Ex,Cx,Tx,Ax,xx,Rx,Ix,Px,_x,Lx,Ox,Dx=i.ccclass,Mx=i.property,Nx=globalThis.game.ads,Fx=(nx=Dx("NavManager"),ix=Mx(a),ax=Mx(a),rx=Mx(Cn),ox=Mx(H),sx=Mx({type:C,visible:function(){return this.useOffsetWhenSAB}}),lx=Mx({type:E,visible:function(){return this.useOffsetWhenSAB}}),nx((hx=Xe((cx=function(e){Ie(s,e);var t,n,i,a,r,o=Fe(s);function s(){var e;Te(this,s);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return Ye(e=o.call.apply(o,[this].concat(n)),"selectorNode",hx,Me(e)),Ye(e,"selectedButtonNode",px,Me(e)),Ye(e,"autoLayout",dx,Me(e)),Ye(e,"useOffsetWhenSAB",fx,Me(e)),Ye(e,"offsetWidget",vx,Me(e)),Ye(e,"offsetWhenSAB",yx,Me(e)),e.navButtons=[],e.isNavigating=!1,e}return xe(s,[{key:"currentButton",get:function(){return this.selectedButton}},{key:"onLoad",value:function(){var e;this.navButtons=this.node.getComponentsInChildren("NavButton"),this.selectedButton=null===(e=this.selectedButtonNode)||void 0===e?void 0:e.getComponentInChildren("NavButton"),kt.lazyValidateProperties(this)}},{key:"start",value:function(){this.useOffsetWhenSAB&&(Nx.getSafeAreaBottom(Zi.cssSizeToWorldSize(1))>0&&(this.offsetWidget.bottom=this.offsetWhenSAB))}},{key:"select",value:(r=Ce(Se().mark((function e(t){var n=this;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.isNavigating){e.next=2;break}return e.abrupt("return");case 2:if(-1!==this.navButtons.indexOf(t)){e.next=4;break}throw new Error("NavManager: Button not found");case 4:if(t!==this.selectedButton){e.next=6;break}return e.abrupt("return");case 6:if(!t.isWIP){e.next=9;break}return this.handleWIPButton(),e.abrupt("return");case 9:return this.isNavigating=!0,this.node.scene.emit(In,{from:this.selectedButton.buttonType,to:t.buttonType}),e.abrupt("return",new Promise((function(e){n.node.scene.once(Pn,(function(){var i=n.selectedButton.deselect();n.autoLayout.selectedIndex=n.navButtons.indexOf(t),n.selectedButton=t;var a=n.autoLayout.getSelectedWorldX()-t.getSelectedWorldDistanceX(),r=n.playSelectorAnimation(a),o=t.select();Promise.all([i,o,r]).then((function(){n.isNavigating=!1,e()}))}))})));case 12:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"selectUsingSceneTransition",value:(a=Ce(Se().mark((function e(t){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.isNavigating){e.next=2;break}return e.abrupt("return");case 2:if(-1===[Ln.store].indexOf(t.buttonType)){e.next=5;break}return this.handleWIPButton(),e.abrupt("return");case 5:return e.next=7,this.select(t);case 7:case"end":return e.stop()}}),e,this)}))),function(e){return a.apply(this,arguments)})},{key:"selectByType",value:(i=Ce(Se().mark((function e(t){var n;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=this.navButtons.find((function(e){return e.buttonType===t}))){e.next=3;break}throw new Error("NavManager: Button not found");case 3:return e.next=5,this.selectUsingSceneTransition(n);case 5:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})},{key:"handleWIPButton",value:function(){lu.openScreen(di.STAR_CHEST_SCREEN)}},{key:"selectDefaultNavBtn",value:(n=Ce(Se().mark((function e(){var t,n=this;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.currentButton&&-1!==this.navButtons.indexOf(this.currentButton)){e.next=2;break}throw new Error("NavManager: Button not found");case 2:return t=this.currentButton.buttonType,this.node.scene.emit(In,{from:null,to:t}),e.abrupt("return",new Promise((function(e){n.node.scene.once(Pn,(function(){n.autoLayout.selectedIndex=n.navButtons.indexOf(n.currentButton);var t=n.navButtons.map((function(e){return e===n.currentButton?e.select(!1):e.deselect(!1,!0)})),i=n.autoLayout.getSelectedWorldX()-n.currentButton.getSelectedWorldDistanceX();n.selectorNode.worldPosition=new Y(i,n.selectorNode.worldPosition.y,0),Promise.all(t).then((function(){e()}))}))})));case 6:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"playSelectorAnimation",value:(t=Ce(Se().mark((function e(t){var n,i,a,r=this;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=new Y(1,1,1),i=this.selectorNode.worldPosition.clone(),a=new Y(1.2*n.x,.8*n.y,1),e.next=7,vn.runTweenAsync(S(this.selectorNode).to(.3,{worldPosition:new Y(t,i.y,0)},{easing:"quintInOut",onUpdate:function(e,t){if(void 0!==t){var i=r.calculateCurrentSquashScale(n,a,t);r.selectorNode.scale=i}}}));case 7:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"setIgnoreInput",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.navButtons.forEach((function(t){var n=t.getComponentInChildren(p);n&&(n.interactable=!e)}))}},{key:"calculateCurrentSquashScale",value:function(e,t,n){var i=this.splitIntoSquashRatio(n);return e.clone().lerp(t,i)}},{key:"splitIntoSquashRatio",value:function(e){return e<.5?2*e:1-2*(e-.5)}}]),s}(f)).prototype,"selectorNode",[ix],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),px=Xe(cx.prototype,"selectedButtonNode",[ax],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),dx=Xe(cx.prototype,"autoLayout",[rx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),fx=Xe(cx.prototype,"useOffsetWhenSAB",[ox],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),vx=Xe(cx.prototype,"offsetWidget",[sx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),yx=Xe(cx.prototype,"offsetWhenSAB",[lx],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),ux=cx))||ux);n._RF.pop(),n._RF.push({},"d48a1TnKg1F4YRzzKmQOD5k","DashboardScene",void 0);var Bx,Gx,zx,Ux,Hx,Vx=i.ccclass,qx=i.disallowMultiple,Wx=i.property,Kx=globalThis.game,jx=Kx.event,Yx=Kx.storage,Xx=Kx.player,$x=Kx.leaderboard,Qx=GameCore.Events,Jx=GameCore.Match.Modes,Zx=GameCore.Configs.DailyRewards,eR=GameCore.Utils,tR=eR.Time,nR=eR.Json;kx=Vx("DashboardScene"),Sx=Wx(Wb),Ex=Wx(Fx),Cx=Wx(li),Tx=Wx(tT),Ax=Wx(Vk),kx(xx=qx((Ix=Xe((Rx=function(e){Ie(l,e);var t,n,i,a,r,o,s=Fe(l);function l(){var e;Te(this,l);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return Ye(e=s.call.apply(s,[this].concat(n)),"coinManager",Ix,Me(e)),Ye(e,"navManager",Px,Me(e)),Ye(e,"bgComp",_x,Me(e)),Ye(e,"pageManager",Lx,Me(e)),Ye(e,"pageAnimSkipOverlay",Ox,Me(e)),e.firstNavigation=!0,e.isFirstNavToCollections=!0,e.playBgAnim=Ce(Se().mark((function t(){var n,i,a,r,o,s,l;return Se().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(null!=(i=Yx.getStorage("dashboard"))){t.next=3;break}throw new Error("DashboardScene: dashboardStorage not found");case 3:if(a=null!==(n=i.animateToCurrentLevel)&&void 0!==n&&n,r=ke({},i.lastMapPayload),o=xl.getCurrentMapProgress(),s=r.currentTheme===o.currentTheme&&r.nextTheme===o.nextTheme,l=o.currentTheme,a&&!s){t.next=10;break}return t.abrupt("return");case 10:return t.next=12,vn.waitTweenAsync(2);case 12:return t.prev=12,t.next=15,e.bgComp.animateToNextTheme(l);case 15:t.next=19;break;case 17:t.prev=17,t.t0=t.catch(12);case 19:case"end":return t.stop()}}),t,null,[[12,17]])}))),e.handlePlayButtonPress=Ce(Se().mark((function t(){var n,i,a,r,o,s,l;return Se().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,Bl.startMatchAsync(Jx.SINGLE);case 3:i=xl.getCurrentMapProgress(),a=null!==(n=Xx.getGameData())&&void 0!==n?n:{},r=a.level,o=void 0===r?1:r,e.updateCurrentMapInStorage(i),Yx.setStorageData("collection","lastMapPack",i.id),Yx.setStorageData("collection","animateMapPackUnlock",!1),s=Yx.getStorage("leaderboard_content"),l=s.lastTabOpened,e.getPlayerLeader(l).then((function(e){if(e){var t=e.score,n=e.rank;Yx.setStorageData("leaderboard_content","previousScore",t),Yx.setStorageData("leaderboard_content","previousRank",n)}})),Yl.switchScene(el,{level:o}),t.next=17;break;case 13:return t.prev=13,t.t0=t.catch(0),console.error(t.t0),t.abrupt("return");case 17:case"end":return t.stop()}}),t,null,[[0,13]])}))),e.onNavigate=function(){var t=Ce(Se().mark((function t(n){return Se().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e.firstNavigation&&(e.firstNavigation=!1,e.pageManager.unmountAndHideAll()),t.t0=n.to,t.next=t.t0===Ln.store?4:t.t0===Ln.collections?10:t.t0===Ln.tournaments?13:t.t0===Ln.leaderboard?16:t.t0===Ln.home?19:22;break;case 4:return e.navManager.setIgnoreInput(),t.next=7,e.pageManager.navigate(n);case 7:return e.handleNavigateToStore(),e.navManager.setIgnoreInput(!1),t.abrupt("break",23);case 10:return t.next=12,e.onNavigateToCollections(ke(ke({},n),{},{to:Ln.collections}));case 12:return t.abrupt("break",23);case 13:return t.next=15,e.onNavigateToTournaments(n);case 15:return t.abrupt("break",23);case 16:return t.next=18,e.onNavigateToLeaderboard(ke(ke({},n),{},{to:Ln.leaderboard}));case 18:return t.abrupt("break",23);case 19:return t.next=21,e.handleNavigateToHome(n);case 21:return t.abrupt("break",23);case 22:throw new Error("DashboardScene: Unhandled page name");case 23:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),e.handleEventButtonPress=function(e){switch(e.type){case wg.STAR_CHEST:lu.openScreen(di.STAR_CHEST_SCREEN);break;case wg.BALLOON:lu.showNotificationScreen("Coming soon!");break;default:throw new Error("DashboardScene: Unhandled event button type")}},e}return xe(l,[{key:"__preload",value:function(){this.panelAnimationController=this.getComponent(_r),this.validateRequiredComponents(),this.listenNavigationEvents(),this.listenDashboardEvents(),this.panelAnimationController.init()}},{key:"listenNavigationEvents",value:function(){this.node.scene.on(In,this.onNavigate)}},{key:"listenDashboardEvents",value:function(){this.node.scene.on(Rn,this.handlePlayButtonPress),this.node.scene.on(_n,this.handleEventButtonPress)}},{key:"onLoad",value:function(){this.coinManager.init(this.pageAnimSkipOverlay),xl.init(),this.setPlayerLevel(),this.initBgComp(),this.pageManager.updateCollectionsContentPayload(xl.getCollectionUnlockProgress())}},{key:"setPlayerLevel",value:function(){var e,t=(null!==(e=Xx.getGameData())&&void 0!==e?e:{}).level,n=void 0===t?1:t;n=0===n?1:n,Xx.setGameData({level:n})}},{key:"start",value:function(){Xx.getPlayerSetting("music")&&bi.playMusic(),this.playBgAnim(),this.navManager.selectDefaultNavBtn(),this.updateVolumeBackgroundMusic(),this.scheduleOnce(this.preloadScenes,2)}},{key:"preloadScenes",value:function(){Yl.preloadGameScene()}},{key:"initBgComp",value:function(){var e,t=Yx.getStorage("dashboard");if(null==t)throw new Error("DashboardScene: dashboardStorage not found");var n=null!==(e=t.animateToCurrentLevel)&&void 0!==e&&e,i=ke({},t.lastMapPayload),a=xl.getCurrentMapProgress(),r=i.currentTheme===a.currentTheme&&i.nextTheme===a.nextTheme,o=a.currentTheme;n&&!r?this.bgComp.setCurrentTheme(i.currentTheme):this.bgComp.setCurrentTheme(o)}},{key:"getPlayerLeader",value:(o=Ce(Se().mark((function e(t){var n,i,a;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n="global"==t?js:Ys){e.next=3;break}return e.abrupt("return",null);case 3:return i=Xx.getPlayerId(),e.next=6,$x.getLeadersByPlayerIdsAsync(n,[i]);case 6:if(0!==(a=e.sent).length){e.next=9;break}return e.abrupt("return",null);case 9:return e.abrupt("return",a[0]);case 10:case"end":return e.stop()}}),e)}))),function(e){return o.apply(this,arguments)})},{key:"updateCurrentMapInStorage",value:function(e){Yx.setStorageData("dashboard","animateToCurrentLevel",!1),Yx.setStorageData("dashboard","lastMapPayload",e)}},{key:"updateVolumeBackgroundMusic",value:function(){bi.turnUpMusic()}},{key:"checkDailyRewardsOpenable",value:function(){var e=Xx.getPlayerData().dailyRewarded,t=e.logDays,n=void 0===t?[]:t,i=e.lastRewarded,a=void 0===i?0:i;if(n.length>Zx.MaxDays)return!0;if(Zx.MockTime>0&&Date.now()-a>=1e3*Zx.MockTime)return!0;return!tR.isToday(a)}},{key:"validateRequiredComponents",value:function(){kt.lazyValidateProperties(this)}},{key:"handleNavigateToStore",value:function(){}},{key:"onNavigateToCollections",value:(r=Ce(Se().mark((function e(t){var n,i,a,r,o;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.navManager.setIgnoreInput(),n=xl.getCollectionUnlockProgress(),i=this.getCurrentUnlockingTheme(),e.next=5,this.pageManager.navigate(t,(function(e){return(a=e.getContainer().getComponentInChildren(lC)).updateUnlockedProgress(n),Promise.resolve()}));case 5:if(void 0!==a){e.next=7;break}throw new Error("CollectionsContent not found");case 7:if(r=new On,!(o=a.shouldAnimateThemeTabUnlock())){e.next=12;break}return e.next=12,this.pageAnimSkipOverlay.open({onSkip:function(){return r.abort()},opacity:200});case 12:if(!this.isFirstNavToCollections||null===i){e.next=16;break}return e.next=15,a.scrollToCurrentUnlockingTheme(i.skin,r);case 15:this.isFirstNavToCollections=!1;case 16:return e.next=18,a.playThemeTabUnlockAnim(r);case 18:if(!o){e.next=21;break}return e.next=21,this.pageAnimSkipOverlay.close();case 21:r.abort(),this.navManager.setIgnoreInput(!1);case 23:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"onNavigateToTournaments",value:(a=Ce(Se().mark((function e(t){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.navManager.setIgnoreInput(),e.next=3,this.pageManager.navigate(t);case 3:this.navManager.setIgnoreInput(!1);case 4:case"end":return e.stop()}}),e,this)}))),function(e){return a.apply(this,arguments)})},{key:"onNavigateToLeaderboard",value:(i=Ce(Se().mark((function e(t){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.navManager.setIgnoreInput(),e.next=3,this.pageManager.navigate(t);case 3:this.navManager.setIgnoreInput(!1);case 4:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})},{key:"setHomeDataAndGetNavAnim",value:function(){var e,t,n,i,a,r=this,o=this.pageManager.getPage(Ln.home).getContainer().getComponentInChildren(wx);this.coinManager.setTargetContainer(o.getCoinContainer());var s=`Level ${null!==(e=null===(t=Xx.getGameData())||void 0===t?void 0:t.level)&&void 0!==e?e:1}`;o.setPlayButtonLabel(s),this.coinManager.emitCoinAmount();var l=null!==(n=null===(i=Xx.getGameData())||void 0===i?void 0:i.stars)&&void 0!==n?n:0;o.updateStarProgress(l);var u=Yx.getStorage("dashboard");if(null==u)throw new Error("DashboardScene: dashboardStorage not found");var c=null!==(a=u.animateToCurrentLevel)&&void 0!==a&&a,h=ke({},u.lastMapPayload),p=ke({},xl.getCurrentMapProgress());if(Yx.getStorage("tournament").animateTournamentLeader)return o.setUnlockProgress(p),Ce(Se().mark((function e(){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.navManager.selectByType(Ln.tournaments);case 2:case"end":return e.stop()}}),e)})));if(nR.encode(h)===nR.encode(p))o.setUnlockProgress(p);else if(c){var d=yl.mapOrder.findIndex((function(e){return e.id===h.id})),f=yl.mapOrder.findIndex((function(e){return e.id===p.id})),v=d===f;if(-1===d||-1===f)throw new Error("DashboardScene: map not found");
//! safe guard against dev tools time travel
if(!(d>f)){var y=yl.mapOrder.slice(d,f+2),m=new On,g=o.prepareUnlockProgressAnimation(h,p,y,m);return Ce(Se().mark((function e(){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.pageAnimSkipOverlay.open({onSkip:function(){return m.abort()},opacity:150});case 2:return e.next=4,g();case 4:if(m.aborted||v){e.next=7;break}return e.next=7,r.navManager.selectByType(Ln.collections);case 7:return e.next=9,r.pageAnimSkipOverlay.close();case 9:case"end":return e.stop()}}),e)})))}o.setUnlockProgress(p)}else o.setUnlockProgress(p)}},{key:"handleNavigateToHome",value:(n=Ce(Se().mark((function e(t){var n,i,a=this;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.navManager.setIgnoreInput(),e.next=3,this.pageManager.navigate(t,Ce(Se().mark((function e(){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:i=a.setHomeDataAndGetNavAnim();case 1:case"end":return e.stop()}}),e)}))));case 3:return this.navManager.setIgnoreInput(!1),e.next=6,this.tryOpenDailyRewardsScreen();case 6:return e.next=8,this.coinManager.untilFinishesCollectAnim();case 8:return e.next=10,this.pageAnimSkipOverlay.untilClosed();case 10:return e.next=12,null===(n=i)||void 0===n?void 0:n();case 12:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"tryOpenDailyRewardsScreen",value:(t=Ce(Se().mark((function e(){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.checkDailyRewardsOpenable()){e.next=2;break}return e.abrupt("return");case 2:return lu.openScreen(di.DAILY_REWARDS_SCREEN),e.abrupt("return",new Promise((function(e){jx.on(Qx.CLOSED_SCREEN,(function t(n){n.screenName===fi[di.DAILY_REWARDS_SCREEN]&&(e(),jx.off(Qx.CLOSED_SCREEN,t))}))})));case 4:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"getCurrentUnlockingTheme",value:function(){var e=xl.getCollectionUnlockProgress();if(0===e.length)return null;var t,n=e[0],i=Ke(e);try{for(i.s();!(t=i.n()).done;){var a=t.value;a.isLocked||(n=a)}}catch(e){i.e(e)}finally{i.f()}return n}}]),l}(f)).prototype,"coinManager",[Sx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Px=Xe(Rx.prototype,"navManager",[Ex],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_x=Xe(Rx.prototype,"bgComp",[Cx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Lx=Xe(Rx.prototype,"pageManager",[Tx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ox=Xe(Rx.prototype,"pageAnimSkipOverlay",[Ax],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),xx=Rx))||xx);n._RF.pop(),n._RF.push({},"53f87ljsxFJUKsBbXk8WVkJ","HomePage",void 0);var iR,aR=i.ccclass,rR=i.property,oR=globalThis.game.player,sR=GameCore.Utils.Number.getShortNumber;Bx=aR("HomePage"),Gx=rR({type:u,group:"Placeholders"}),Bx((Hx=Xe((Ux=function(e){Ie(o,e);var t,n,i,a,r=Fe(o);function o(){var e;Te(this,o);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return Ye(e=r.call.apply(r,[this].concat(n)),"coinLabel",Hx,Me(e)),e}return xe(o,[{key:"__preload",value:function(){var e;null===(e=Ge(Pe(o.prototype),"__preload",this))||void 0===e||e.call(this),this.validateOwnRequiredComponents(),this.listenToCoinUpdateEvent()}},{key:"listenToCoinUpdateEvent",value:function(){this.node.scene.on(pr.COIN_CHANGED,this.updateplaceholderCoins,this)}},{key:"updateplaceholderCoins",value:(a=Ce(Se().mark((function e(t){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.coinLabel.string=sR(t.coins,3);case 1:case"end":return e.stop()}}),e,this)}))),function(e){return a.apply(this,arguments)})},{key:"mount",value:(i=Ce(Se().mark((function e(){var t,n,i;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Ge(Pe(o.prototype),"mount",this).call(this);case 2:if(this.homeContent){e.next=6;break}if(this.homeContent=this.container.getComponentInChildren(wx),this.homeContent){e.next=6;break}throw new Error("HomePage: homeContent not found");case 6:i=null!==(t=null===(n=oR.getGameData())||void 0===n?void 0:n.coins)&&void 0!==t?t:0,this.updateplaceholderCoins({coins:i});case 8:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"transitionIn",value:(n=Ce(Se().mark((function e(){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Ge(Pe(o.prototype),"transitionIn",this).call(this);case 2:this.homeContent.enableUIAnimator();case 3:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"transitionOut",value:(t=Ce(Se().mark((function e(){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.homeContent.disableUIAnimator(),e.next=3,Ge(Pe(o.prototype),"transitionOut",this).call(this);case 3:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"validateOwnRequiredComponents",value:function(){if(!this.coinLabel)throw new Error("HomePage: coinLabel not found")}}]),o}(QS)).prototype,"coinLabel",[Gx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),zx=Ux));n._RF.pop(),n._RF.push({},"332aaP3dkhKxZNHiMFB1bKn","LeaderboardIsEmpty",void 0);var lR,uR,cR,hR,pR,dR,fR,vR,yR,mR,gR,bR,wR,kR,SR,ER,CR,TR,AR,xR,RR=(0,i.ccclass)("LeaderboardIsEmpty")(iR=function(e){Ie(i,e);var t,n=Fe(i);function i(){return Te(this,i),n.apply(this,arguments)}return xe(i,[{key:"onLoad",value:function(){this.uiOpacity=this.getComponent(N),this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){kt.lazyValidateProperties(this)}},{key:"show",value:(t=Ce(Se().mark((function e(){var t,n,i;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.uiOpacity.opacity=255,t=this.node.position.clone(),(n=S(this.node)).to(.05,{position:t.clone().add3f(5,0,0)}),n.to(.05,{position:t.clone().add3f(-5,0,0)}),(i=S(this.node).repeat(2,n)).to(.05,{position:t}),e.next=9,vn.runTweenAsync(i);case 9:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"hide",value:function(){this.uiOpacity.opacity=0}}]),i}(f))||iR;n._RF.pop(),n._RF.push({},"aa4b0d0u0hLeqd3+/PQZ/QD","SwitchButton",void 0);var IR,PR,_R,LR,OR,DR,MR,NR=i.ccclass,FR=i.property,BR=i.requireComponent,GR=globalThis.game.analytics,zR=(lR=NR("SwitchButton"),uR=BR([p,y]),cR=FR(H),hR=FR(a),pR=FR(a),dR=FR(H),fR=FR({visible(){return this.useSound},type:hi}),vR=FR(H),yR=FR({visible(){return this.useDesktopHover},type:_}),mR=FR({visible(){return this.useDesktopHover},type:_}),lR(gR=uR((wR=Xe((bR=function(e){Ie(n,e);var t=Fe(n);function n(){var e;Te(this,n);for(var i=arguments.length,a=new Array(i),r=0;r<i;r++)a[r]=arguments[r];return Ye(e=t.call.apply(t,[this].concat(a)),"enable",wR,Me(e)),Ye(e,"nodeOn",kR,Me(e)),Ye(e,"nodeOff",SR,Me(e)),Ye(e,"useSound",ER,Me(e)),Ye(e,"soundKey",CR,Me(e)),Ye(e,"useDesktopHover",TR,Me(e)),Ye(e,"mouseEnterClip",AR,Me(e)),Ye(e,"mouseLeaveClip",xR,Me(e)),e.isMouseLeaved=!1,e.onMouseEnter=function(t){e.useDesktopHover&&e.buttonComponent.interactable&&(e.isMouseLeaved=!1,e.animationComponent.play(e.mouseEnterClip.name))},e.onMouseLeave=function(t){e.useDesktopHover&&e.buttonComponent.interactable&&(e.isMouseLeaved||(e.isMouseLeaved=!0,e.animationComponent.play(e.mouseLeaveClip.name)))},e}return xe(n,[{key:"__preload",value:function(){this.buttonComponent=this.getComponent(p),this.animationComponent=this.getComponent(y),this.validateRequiredComponents()}},{key:"onLoad",value:function(){var e=this.animationComponent.clips.map((function(e){return null==e?void 0:e.name})).filter((function(e){return null!=e&&"string"==typeof e}));this.useDesktopHover&&(-1===e.indexOf(this.mouseEnterClip.name)&&this.animationComponent.addClip(this.mouseEnterClip),-1===e.indexOf(this.mouseLeaveClip.name)&&this.animationComponent.addClip(this.mouseLeaveClip))}},{key:"validateRequiredComponents",value:function(){kt.lazyValidateProperties(this)}},{key:"onEnable",value:function(){this.node.on(a.EventType.MOUSE_ENTER,this.onMouseEnter),this.node.on(a.EventType.MOUSE_LEAVE,this.onMouseLeave)}},{key:"onDisable",value:function(){this.node.off(a.EventType.MOUSE_ENTER,this.onMouseEnter),this.node.off(a.EventType.MOUSE_LEAVE,this.onMouseLeave)}},{key:"switch",value:function(){return!!this.node.active&&(GR.event(GameCore.Plugins.Analytics.Events.BUTTON_CLICK,{button_name:this.node.name,enable:!this.enable}),this.useSound&&bi.playSound(pi[this.soundKey]),this.updateStatus(!this.enable))}},{key:"setEnabled",value:function(e){this.node.active&&this.updateStatus(e)}},{key:"updateStatus",value:function(e){return this.enable===e||(this.onMouseLeave(null),this.enable=e,this.nodeOn.active=e,this.nodeOff.active=!e),this.enable}}]),n}(f)).prototype,"enable",[cR],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),kR=Xe(bR.prototype,"nodeOn",[hR],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),SR=Xe(bR.prototype,"nodeOff",[pR],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ER=Xe(bR.prototype,"useSound",[dR],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),CR=Xe(bR.prototype,"soundKey",[fR],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return hi[ui.BUTTON_CLICK]}}),TR=Xe(bR.prototype,"useDesktopHover",[vR],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),AR=Xe(bR.prototype,"mouseEnterClip",[yR],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),xR=Xe(bR.prototype,"mouseLeaveClip",[mR],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),gR=bR))||gR)||gR);n._RF.pop(),n._RF.push({},"2871awUXL9J0I+rBEFNHN7o","Tabs",void 0);var UR,HR,VR,qR,WR,KR=i.ccclass,jR=i.property,YR=globalThis.game.analytics,XR=(IR=KR("Tabs"),PR=jR(zR),_R=jR(zR),IR((DR=Xe((OR=function(e){Ie(n,e);var t=Fe(n);function n(){var e;Te(this,n);for(var i=arguments.length,a=new Array(i),r=0;r<i;r++)a[r]=arguments[r];return Ye(e=t.call.apply(t,[this].concat(a)),"tabWorld",DR,Me(e)),Ye(e,"tabFriends",MR,Me(e)),e}return xe(n,[{key:"onLoad",value:function(){this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){if(!this.tabWorld)throw new Error("Tabs: tabWorld not found");if(!this.tabFriends)throw new Error("Tabs: tabFriends not found")}},{key:"setInteractableButtons",value:function(e){this.tabWorld.getComponent(p).interactable=e,this.tabFriends.getComponent(p).interactable=e}},{key:"updateStatus",value:function(e){this.tabWorld.setEnabled("global"===e),this.tabFriends.setEnabled("friends"===e)}},{key:"handleTabWorldSelect",value:function(){this.tabWorld.setEnabled(!0),this.tabFriends.setEnabled(!1),YR.event(GameCore.Plugins.Analytics.Events.BUTTON_CLICK,{button_name:this.node.name,screen_name:gi.getCurrentPage()}),this.node.scene.emit(Sg.WORLD_TAB_SELECTED)}},{key:"handleTabFriendsSelect",value:function(){this.tabWorld.setEnabled(!1),this.tabFriends.setEnabled(!0),YR.event(GameCore.Plugins.Analytics.Events.BUTTON_CLICK,{button_name:this.node.name,screen_name:gi.getCurrentPage()}),this.node.scene.emit(Sg.FRIENDS_TAB_SELECTED)}}]),n}(f)).prototype,"tabWorld",[PR],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),MR=Xe(OR.prototype,"tabFriends",[_R],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),LR=OR))||LR);n._RF.pop(),n._RF.push({},"69c90PvoTtGfZyDw8FbbOvV","LeaderSkeleton",void 0);var $R,QR,JR,ZR,eI,tI,nI,iI,aI,rI,oI,sI,lI,uI,cI,hI,pI,dI,fI,vI,yI,mI,gI,bI,wI,kI,SI,EI,CI,TI,AI,xI,RI,II,PI,_I,LI,OI,DI,MI,NI,FI=i.ccclass,BI=i.disallowMultiple,GI=i.property,zI=(UR=FI("LeaderSkeleton"),HR=GI(a),UR(VR=BI((WR=Xe((qR=function(e){Ie(a,e);var t,n,i=Fe(a);function a(){var e;Te(this,a);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return Ye(e=i.call.apply(i,[this].concat(n)),"container",WR,Me(e)),e}return xe(a,[{key:"__preload",value:function(){this.uiOpacity=this.getComponent(N),this.validateRequiredComponents()}},{key:"hide",value:(n=Ce(Se().mark((function e(t){var n=this;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,vn.runTweenAsync(S(this.uiOpacity).to(.2,{opacity:0}).call((function(){n.node.active=!1})),t);case 2:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"show",value:(t=Ce(Se().mark((function e(t,n){var i,a,r,o;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.node.active=!0,this.node.scale=new Y(.8,.8,.8),this.uiOpacity.opacity=0,i=this.container.position.clone(),this.container.position=new Y(i.x,i.y-100,i.z),(a=S(this.node).delay(t)).to(.2,{scale:Y.ONE},{easing:"cubicOut"}),(r=S(this.container).delay(t)).to(.2,{position:i},{easing:"cubicOut"}),(o=S(this.uiOpacity).delay(t)).to(.2,{opacity:255},{easing:"cubicOut"}),e.next=13,Promise.all([vn.runTweenAsync(a,n),vn.runTweenAsync(r,n),vn.runTweenAsync(o,n)]);case 13:case"end":return e.stop()}}),e,this)}))),function(e,n){return t.apply(this,arguments)})},{key:"validateRequiredComponents",value:function(){if(!this.uiOpacity)throw new Error("UIOpacity component is not attached to the same node");if(!this.container)throw new Error("Container is not attached to the same node")}}]),a}(f)).prototype,"container",[HR],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),VR=qR))||VR)||VR);n._RF.pop(),n._RF.push({},"53da1+ne4RJ4p0kTjp52K/1","Leader",void 0);var UI,HI,VI,qI,WI,KI,jI,YI,XI,$I,QI,JI,ZI,eP=i.ccclass,tP=i.property,nP=($R=eP("Leader"),QR=tP(u),JR=tP(N),ZR=tP({type:a,group:"Container"}),eI=tP({type:A,group:"Background"}),tI=tP({type:O,group:"Background"}),nI=tP({type:A,group:"Rank"}),iI=tP({type:u,group:"Rank"}),aI=tP({type:O,group:"Rank"}),rI=tP({type:O,group:"Rank"}),oI=tP({type:O,group:"Rank"}),sI=tP({type:O,group:"Rank"}),lI=tP({type:A,group:"Avatar"}),uI=tP({type:N,group:"Avatar"}),cI=tP({type:A,group:"Score"}),hI=tP({type:u,group:"Score"}),pI=tP({type:O,group:"Score"}),dI=tP({type:N,group:"Score"}),fI=tP({type:N}),vI=tP({type:s}),$R((gI=Xe((mI=function(e){Ie(l,e);var t,n,i,a,o,s=Fe(l);function l(){var e;Te(this,l);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return Ye(e=s.call.apply(s,[this].concat(n)),"nameLabel",gI,Me(e)),Ye(e,"nameOpacity",bI,Me(e)),Ye(e,"container",wI,Me(e)),Ye(e,"background",kI,Me(e)),Ye(e,"highlightBackground",SI,Me(e)),Ye(e,"rankSprite",EI,Me(e)),Ye(e,"rankLabel",CI,Me(e)),Ye(e,"goldRank",TI,Me(e)),Ye(e,"silverRank",AI,Me(e)),Ye(e,"bronzeRank",xI,Me(e)),Ye(e,"highlightRank",RI,Me(e)),Ye(e,"avatar",II,Me(e)),Ye(e,"avatarOpacity",PI,Me(e)),Ye(e,"scoreBackground",_I,Me(e)),Ye(e,"scoreLabel",LI,Me(e)),Ye(e,"highlightScoreBackground",OI,Me(e)),Ye(e,"scoreOpacity",DI,Me(e)),Ye(e,"uiOpacity",MI,Me(e)),Ye(e,"uiTransform",NI,Me(e)),e}return xe(l,[{key:"onLoad",value:function(){this.defaultBackground=this.background.spriteFrame,this.defaultRank=this.rankSprite.spriteFrame,this.defaultScoreBackground=this.scoreBackground.spriteFrame,this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){kt.lazyValidateProperties(this)}},{key:"updateInfo",value:function(e,t){this.updateBackground(e),this.updateRank(e,t),this.resetPhoto(),this.updateUsername(e),this.updateScore(e)}},{key:"updateBackground",value:function(e){this.background.spriteFrame=e.isHighlight?this.highlightBackground:this.defaultBackground}},{key:"updateRank",value:function(e,t){var n=e.rank;if(this.rankLabel.string!==n.toString()){this.rankLabel.string=t&&n>t?`${t}+`:n.toString(),this.rankSprite.spriteFrame=this.defaultRank;var i=new r(xg);switch(e.isHighlight&&(this.rankSprite.spriteFrame=this.highlightRank,i=new r(Ig)),n){case 1:this.rankSprite.spriteFrame=this.goldRank,i=new r(Eg);break;case 2:this.rankSprite.spriteFrame=this.silverRank,i=new r(Cg);break;case 3:this.rankSprite.spriteFrame=this.bronzeRank,i=new r(Tg)}this.rankLabel.shadowColor=i,this.rankLabel.outlineColor=i}}},{key:"setPhoto",value:function(e){e&&this.node.active&&(e.packable=!0,this.avatar.spriteFrame=e)}},{key:"resetPhoto",value:(o=Ce(Se().mark((function e(){var t;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.defaultAvatar){e.next=7;break}return e.next=3,ai.loadSpriteFrameAsync("images/avatar-bg/spriteFrame");case 3:if(t=e.sent){e.next=6;break}return e.abrupt("return");case 6:this.defaultAvatar=t;case 7:this.avatar.spriteFrame=this.defaultAvatar;case 8:case"end":return e.stop()}}),e,this)}))),function(){return o.apply(this,arguments)})},{key:"updateUsername",value:function(e){this.nameLabel.string=e.name,this.nameLabel.color=new r(e.isHighlight?Rg:Ag)}},{key:"updateScore",value:function(e){var t=Math.floor(e.score);this.scoreLabel.string=GameCore.Utils.Number.getShortNumber(t,7);var n=this.scoreLabel.getComponent(u);n.outlineColor=new r(e.isHighlight?Ig:xg),n.shadowColor=new r(e.isHighlight?Ig:xg),this.scoreBackground.spriteFrame=e.isHighlight?this.highlightScoreBackground:this.defaultScoreBackground}},{key:"runShowUpAnimation",value:(a=Ce(Se().mark((function e(t,n){var i,a,r,o,s,l=this,u=arguments;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=u.length>2&&void 0!==u[2]?u[2]:.3,this.node.scale=new Y(.8,.8,.8),this.setOpacity(0),a=this.container.position.clone(),this.container.position=new Y(a.x,a.y-100,a.z),(r=S(this.node).delay(n)).to(i,{scale:Y.ONE},{easing:"elasticOut"}),(o=S(this.container).delay(n)).to(i,{position:a},{easing:"backOut"}),(s=S(this.uiOpacity).delay(n)).to(i,{opacity:255},{easing:"cubicOut",onUpdate:function(){l.nameOpacity.opacity=l.uiOpacity.opacity,l.scoreOpacity.opacity=l.uiOpacity.opacity,l.avatarOpacity.opacity=l.uiOpacity.opacity}}),t.addAbortListener((function(){l.node.scale=Y.ONE,l.container.position=a,l.uiOpacity.opacity=255,l.avatar.node.active=!0})),e.next=14,Promise.all([vn.runTweenAsync(r,t),vn.runTweenAsync(o,t),vn.runTweenAsync(s,t)]);case 14:case"end":return e.stop()}}),e,this)}))),function(e,t){return a.apply(this,arguments)})},{key:"runWorldPositionAnimation",value:(i=Ce(Se().mark((function e(t,n){var i;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=S(this.node).to(n,{worldPosition:t},{easing:"quadOut"}),e.next=3,vn.runTweenAsync(i);case 3:case"end":return e.stop()}}),e,this)}))),function(e,t){return i.apply(this,arguments)})},{key:"runScaleAnimation",value:(n=Ce(Se().mark((function e(t,n,i){var a;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=S(this.node).to(i,{scale:new Y(n,n,n)},{easing:"backOut"}),e.next=3,vn.runTweenAsync(a,t);case 3:case"end":return e.stop()}}),e,this)}))),function(e,t,i){return n.apply(this,arguments)})},{key:"runUpdateDataAnimation",value:(t=Ce(Se().mark((function e(t,n,i,a,r){var o,s=this;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=S({}).to(r,{},{easing:"quartOut",onUpdate:function(e,r){if(r){var o=Math.floor(t+(n-t)*r),l=Math.floor(i+(a-i)*r);s.updateRank({rank:o,isHighlight:!0}),s.updateScore({score:l,isHighlight:!0})}}}),e.next=3,vn.runTweenAsync(o);case 3:case"end":return e.stop()}}),e)}))),function(e,n,i,a,r){return t.apply(this,arguments)})},{key:"setOpacity",value:function(e){this.uiOpacity.opacity=e,this.nameOpacity.opacity=e,this.scoreOpacity.opacity=e,this.avatarOpacity.opacity=e}}]),l}(f)).prototype,"nameLabel",[QR],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),bI=Xe(mI.prototype,"nameOpacity",[JR],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wI=Xe(mI.prototype,"container",[ZR],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),kI=Xe(mI.prototype,"background",[eI],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),SI=Xe(mI.prototype,"highlightBackground",[tI],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),EI=Xe(mI.prototype,"rankSprite",[nI],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),CI=Xe(mI.prototype,"rankLabel",[iI],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),TI=Xe(mI.prototype,"goldRank",[aI],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),AI=Xe(mI.prototype,"silverRank",[rI],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),xI=Xe(mI.prototype,"bronzeRank",[oI],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),RI=Xe(mI.prototype,"highlightRank",[sI],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),II=Xe(mI.prototype,"avatar",[lI],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),PI=Xe(mI.prototype,"avatarOpacity",[uI],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_I=Xe(mI.prototype,"scoreBackground",[cI],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),LI=Xe(mI.prototype,"scoreLabel",[hI],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),OI=Xe(mI.prototype,"highlightScoreBackground",[pI],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),DI=Xe(mI.prototype,"scoreOpacity",[dI],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),MI=Xe(mI.prototype,"uiOpacity",[fI],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),NI=Xe(mI.prototype,"uiTransform",[vI],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),yI=mI))||yI);n._RF.pop(),n._RF.push({},"173acdyc/VOnLkPsoSfdfnr","Leaders",void 0);var iP,aP,rP,oP,sP,lP,uP,cP,hP,pP,dP,fP,vP,yP,mP,gP,bP,wP=i.ccclass,kP=i.property,SP=globalThis.game,EP=SP.player,CP=SP.frameCapture,TP=(UI=wP("Leaders"),HI=kP(I),VI=kP(a),qI=kP(T),WI=kP(s),KI=kP(g),UI((XI=Xe((YI=function(e){Ie(u,e);var t,n,i,a,r,o=Fe(u);function u(){var e;Te(this,u);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return Ye(e=o.call.apply(o,[this].concat(n)),"leaderPrefab",XI,Me(e)),Ye(e,"inactiveNodeContainer",$I,Me(e)),Ye(e,"layout",QI,Me(e)),Ye(e,"viewport",JI,Me(e)),Ye(e,"maxLeader",ZI,Me(e)),e.cachedPhotos=new Map,e.leaderData=[],e.leaderPoolArray=[],e.playerLeader=null,e.isHidden=!0,e}return xe(u,[{key:"onLoad",value:function(){this.uiTransform=this.getComponent(s),this.batchNodes=this.getComponents(Is),this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){kt.lazyValidateProperties(this)}},{key:"__preload",value:function(){this.currentPlayerId=EP.getPlayerId();for(var e=0;e<this.maxLeader;e++){var t=this.createLeader();this.leaderPoolArray.push(t)}var n=this.leaderPoolArray[0].uiTransform.contentSize;this.leaderContentHeight=n.height+this.layout.spacingY}},{key:"createLeader",value:function(){var e=l(this.leaderPrefab);return this.addLeaderToInactiveNode(e),e.getComponent(nP)}},{key:"updateData",value:(r=Ce(Se().mark((function e(t){var n=this;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.playerLeader=null,this.isHidden=!1,this.leaderData=t,this.leaderData.sort((function(e,t){return t.score-e.score})),null!=EP){e.next=6;break}throw new Error("Player is not defined");case 6:return this.batchNodes.every((function(e){return e.enabled=!0})),e.next=9,Promise.all(this.leaderData.map((function(e,t){var i=e.playerId,a=e.photo,r=e.score,o=e.name,s=n.currentPlayerId===i;n.leaderData[t].rank=t+1;var l=n.maxLeader-1;if(!(t>=l)||s){var u=s&&t>l-1?n.leaderPoolArray[l]:n.leaderPoolArray[t];return n.layout.node.addChild(u.node),u.setOpacity(0),s&&(n.playerLeader=u),u.updateInfo({isHighlight:s,name:o,photo:a,rank:t+1,score:r},l),n.getAndSetLeaderPhoto({playerId:i,url:a,leader:u})}})));case 9:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"getAndSetLeaderPhoto",value:(a=Ce(Se().mark((function e(t){var n,i,a,r,o;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.playerId,i=t.url,a=t.leader,"default"!==i){e.next=3;break}return e.abrupt("return");case 3:if(!this.cachedPhotos.has(n)){e.next=6;break}return a.setPhoto(this.cachedPhotos.get(n)),e.abrupt("return");case 6:return e.prev=6,e.next=9,this.loadAvatarImage(i,85,85,n);case 9:if(r=e.sent){e.next=12;break}return e.abrupt("return");case 12:o=O.createWithImage(r),this.cachedPhotos.set(n,o),a.setPhoto(o),e.next=23;break;case 17:if(e.prev=17,e.t0=e.catch(6),!(e.t0 instanceof DOMException&&"AbortError"===e.t0.name)){e.next=22;break}return console.info("Leaders: getAndSetLeaderPhoto was aborted"),e.abrupt("return");case 22:throw e.t0;case 23:case"end":return e.stop()}}),e,this,[[6,17]])}))),function(e){return a.apply(this,arguments)})},{key:"removeLeaders",value:function(){var e=this;this.isHidden=!0,this.getActiveLeaders().forEach((function(t){t.resetPhoto(),e.addLeaderToInactiveNode(t.node)})),this.batchNodes.every((function(e){return e.enabled=!1}))}},{key:"getActiveLeaders",value:function(){var e=this;return this.leaderPoolArray.filter((function(t){return t.node.parent===e.layout.node}))}},{key:"getActiveLeaderChildren",value:function(){return this.layout.getComponentsInChildren(nP)}},{key:"showLeaders",value:(i=Ce(Se().mark((function e(t){var n,i,a,r=this;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.isHidden){e.next=2;break}return e.abrupt("return");case 2:if(!((n=this.getActiveLeaders()).length<1)){e.next=5;break}return e.abrupt("return");case 5:return i=Math.ceil(this.viewport.contentSize.height/this.leaderContentHeight),a=Math.min(n.length,i),e.next=10,Promise.all(n.map(function(){var e=Ce(Se().mark((function e(n,i){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!r.isHidden){e.next=2;break}return e.abrupt("return");case 2:if(!(i<a)){e.next=5;break}return e.next=5,n.runShowUpAnimation(t,.1*i,.3);case 5:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()));case 10:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})},{key:"runUpdateLeadersRankAnimation",value:(n=Ce(Se().mark((function e(t,n){var i,a,r,o,s,l,u;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(i=null!=t?t:0,a=null!=n?n:this.leaderData.length,a=Math.min(a,100),r=this.getActiveLeaderChildren(),o=this.leaderContentHeight,s=[],l=i;l<a;l++)r[l].updateRank({rank:l+1,isHighlight:!1}),u=r[l].node.worldPosition.clone(),s.push(r[l].runWorldPositionAnimation(u.add3f(0,-o,0),.25));return e.next=9,Promise.all(s);case 9:case"end":return e.stop()}}),e,this)}))),function(e,t){return n.apply(this,arguments)})},{key:"getLeaderData",value:function(){return this.leaderData}},{key:"getPlayerLeader",value:function(){return this.playerLeader}},{key:"getLeaderByRank",value:function(e){return this.getActiveLeaders()[e-1]||null}},{key:"getLeaderDataByRank",value:function(e){return this.leaderData[e-1]||null}},{key:"updateVisibility",value:function(){var e=this.viewport.getBoundingBoxToWorld(),t=e.yMax,n=e.yMin;this.getActiveLeaders().forEach((function(e){var i=e.uiTransform;if(void 0!==i){var a=i.getBoundingBoxToWorld(),r=a.yMax,o=a.yMin,s=r<n||o>t;e.setOpacity(s?0:255)}}))}},{key:"loadAvatarImage",value:(t=Ce(Se().mark((function e(t,n,i,a){var r;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,CP.captureAsync({width:n,height:i,name:"LeaderAvatar",renderOptions:{[a]:{name:a,type:"image",depth:0,position:[0,0],size:[n,i],image:t}}});case 3:if(r=e.sent){e.next=6;break}return e.abrupt("return",null);case 6:return e.next=8,GameCore.Utils.Image.loadImage(r);case 8:return e.abrupt("return",e.sent);case 11:return e.prev=11,e.t0=e.catch(0),e.abrupt("return",null);case 14:case"end":return e.stop()}}),e,null,[[0,11]])}))),function(e,n,i,a){return t.apply(this,arguments)})},{key:"addLeaderToInactiveNode",value:function(e){this.inactiveNodeContainer.addChild(e),e.getComponent(nP).setOpacity(0)}}]),u}(f)).prototype,"leaderPrefab",[HI],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),$I=Xe(YI.prototype,"inactiveNodeContainer",[VI],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),QI=Xe(YI.prototype,"layout",[qI],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),JI=Xe(YI.prototype,"viewport",[WI],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ZI=Xe(YI.prototype,"maxLeader",[KI],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),jI=YI))||jI);n._RF.pop(),n._RF.push({},"2aa67vEWR9HaJkCtpsuUyRX","LeaderboardContent",void 0);var AP,xP=i.ccclass,RP=i.property,IP=globalThis.game,PP=IP.storage,_P=IP.leaderboard,LP=IP.player,OP=(iP=xP("LeaderboardContent"),aP=RP(Gr),rP=RP(XR),oP=RP(TP),sP=RP(ue),lP=RP({type:[zI]}),uP=RP(RR),cP=RP(da),iP((dP=Xe((pP=function(e){Ie(c,e);var t,n,i,a,r,o,l,u=Fe(c);function c(){var e;Te(this,c);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return Ye(e=u.call.apply(u,[this].concat(n)),"panelAnimator",dP,Me(e)),Ye(e,"tabs",fP,Me(e)),Ye(e,"leaders",vP,Me(e)),Ye(e,"scrollview",yP,Me(e)),Ye(e,"leaderSkeletons",mP,Me(e)),Ye(e,"leaderboardIsEmpty",gP,Me(e)),Ye(e,"contentOpacity",bP,Me(e)),e.isHidden=!0,e.currentLb=null,e.animAbortSignal=null,e.fetchAbortController=null,e.handleUpdateVisibility=function(){e.leaders.updateVisibility()},e.handleFriendsTabSelected=Ce(Se().mark((function t(){return Se().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return PP.setStorageData("leaderboard_content","lastTabOpened","friends"),e.cleanupSideEffects(),t.next=4,e.updateStatus("friends");case 4:case"end":return t.stop()}}),t)}))),e.handleWorldTabSelected=Ce(Se().mark((function t(){return Se().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return PP.setStorageData("leaderboard_content","lastTabOpened","global"),e.cleanupSideEffects(),t.next=4,e.updateStatus("global");case 4:case"end":return t.stop()}}),t)}))),e.hideContent=function(){e.contentOpacity.changeStateFade(!1,.1)},e.showContent=function(){e.contentOpacity.changeStateFade(!0,.1)},e}return xe(c,[{key:"onLoad",value:function(){this.uiTransform=this.getComponent(s),this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){kt.lazyValidateProperties(this)}},{key:"enableUIAnimator",value:function(){this.panelAnimator.enabled=!0}},{key:"disableUIAnimator",value:function(){this.panelAnimator.enabled=!1}},{key:"listenEvents",value:function(){this.node.scene.on(Sg.FRIENDS_TAB_SELECTED,this.handleFriendsTabSelected),this.node.scene.on(Sg.WORLD_TAB_SELECTED,this.handleWorldTabSelected),this.node.scene.on(pr.HIDE_UI,this.hideContent),this.node.scene.on(pr.SHOW_UI,this.showContent),this.scrollview.node.on(ue.EventType.SCROLLING,this.handleUpdateVisibility)}},{key:"unlistenEvents",value:function(){this.node.scene.off(Sg.FRIENDS_TAB_SELECTED,this.handleFriendsTabSelected),this.node.scene.off(Sg.WORLD_TAB_SELECTED,this.handleWorldTabSelected),this.unlistenUIEvents(),this.scrollview.node.off(ue.EventType.SCROLLING,this.handleUpdateVisibility)}},{key:"unlistenUIEvents",value:function(){this.node.scene.off(pr.HIDE_UI,this.hideContent),this.node.scene.off(pr.SHOW_UI,this.showContent)}},{key:"loadLeaderboard",value:(l=Ce(Se().mark((function e(t,n){var i,a;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!n.aborted){e.next=2;break}return e.abrupt("return",null);case 2:if(i=this.getLeaderboardName(t)){e.next=5;break}return e.abrupt("return",null);case 5:return a=GameCore.Configs.Leaderboards.Limit,e.next=8,_P.requestLeaderboardAsync(i,a);case 8:if(!n.aborted){e.next=10;break}return e.abrupt("return",null);case 10:return e.abrupt("return",_P.getLeaderboard(i));case 11:case"end":return e.stop()}}),e,this)}))),function(e,t){return l.apply(this,arguments)})},{key:"getLeaderboardName",value:function(e){return"friends"===e?Ys:js}},{key:"loadMoreLeaderboard",value:(o=Ce(Se().mark((function e(t,n){var i;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!n.aborted){e.next=2;break}return e.abrupt("return",null);case 2:if(i=this.getLeaderboardName(t)){e.next=5;break}return e.abrupt("return",null);case 5:return e.next=7,_P.loadMoreLeaderboardAsync(i,1e3);case 7:if(!n.aborted){e.next=9;break}return e.abrupt("return",null);case 9:return e.abrupt("return",_P.getLeaderboard(i));case 10:case"end":return e.stop()}}),e,this)}))),function(e,t){return o.apply(this,arguments)})},{key:"showLoading",value:(r=Ce(Se().mark((function e(t){var n,i=arguments;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=i.length>1&&void 0!==i[1]?i[1]:0,this.scrollview.scrollToTop(0),this.scrollview.enabled=!1,e.next=5,Promise.all([this.leaderSkeletons.map((function(e,i){return e.show(i*n,t)}))]);case 5:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"hideLoading",value:(a=Ce(Se().mark((function e(t){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all(this.leaderSkeletons.map((function(e){return e.hide(t)})));case 2:case"end":return e.stop()}}),e,this)}))),function(e){return a.apply(this,arguments)})},{key:"enter",value:function(){this.listenEvents(),this.isHidden=!1;var e=PP.getStorageData("leaderboard_content","lastTabOpened");"friends"===e&&this.handleFriendsTabSelected(),"global"===e&&this.handleWorldTabSelected()}},{key:"hide",value:function(){this.isHidden=!0}},{key:"cleanup",value:function(){this.unlistenEvents(),this.cleanupSideEffects()}},{key:"cleanupSideEffects",value:function(){var e,t;null===(e=this.animAbortSignal)||void 0===e||e.abort(),this.animAbortSignal=null,null===(t=this.fetchAbortController)||void 0===t||t.abort(),this.fetchAbortController=null,this.leaders.removeLeaders(),this.leaderboardIsEmpty.hide()}},{key:"isAborted",value:function(){var e,t,n,i,a=null===(e=null===(t=this.animAbortSignal)||void 0===t?void 0:t.aborted)||void 0===e||e,r=null===(n=null===(i=this.fetchAbortController)||void 0===i?void 0:i.signal.aborted)||void 0===n||n;return a||r}},{key:"updateStatus",value:(i=Ce(Se().mark((function e(t){var n,i,a,r,o,s,l,u,c,h,p,d,f;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null===this.animAbortSignal&&null===this.fetchAbortController){e.next=2;break}throw new Error("LeaderboardContent: LeaderboardContent is already loading. Please handle cancelling gracefully.");case 2:if(!this.isHidden){e.next=4;break}return e.abrupt("return");case 4:return this.tabs.updateStatus(t),this.animAbortSignal=new On,this.fetchAbortController=new AbortController,e.next=9,this.showLoading(this.animAbortSignal);case 9:return e.next=11,this.loadLeaderboard(t,this.animAbortSignal);case 11:if(this.currentLb=e.sent,this.currentLb){e.next=14;break}return e.abrupt("return");case 14:if(0!==Object.values(this.currentLb.leaders).length){e.next=19;break}return this.leaderboardIsEmpty.show(),this.tabs.setInteractableButtons(!0),this.hideLoading(this.animAbortSignal),e.abrupt("return");case 19:if(i=LP.getPlayerId(),a=this.currentLb.leaders[i]){e.next=28;break}if(!(r=this.getLeaderboardName(t))){e.next=28;break}return e.next=26,_P.getLeadersByPlayerIdsAsync(r,[i]);case 26:(o=e.sent).length>0&&(a=o[0],this.currentLb.leaders[i]=a);case 28:return s=PP.getStorage("leaderboard_content"),l=s.previousScore,u=s.previousRank,c=null!==(n=a)&&void 0!==n?n:{},h=c.score,p=c.rank,l&&l<h&&u&&u!==p&&(this.currentLb.leaders[i].score=l),d=Object.values(this.currentLb.leaders),ai.setBlockInput(!0),this.tabs.setInteractableButtons(!1),e.next=36,this.hideLoading(this.animAbortSignal);case 36:if(!this.isAborted()){e.next=40;break}return ai.setBlockInput(!1),this.tabs.setInteractableButtons(!0),e.abrupt("return");case 40:return this.leaders.updateData(d),this.scrollview.enabled=!0,e.next=44,this.leaders.showLeaders(this.animAbortSignal);case 44:if(!this.isAborted()){e.next=48;break}return ai.setBlockInput(!1),this.tabs.setInteractableButtons(!0),e.abrupt("return");case 48:if(f=this.leaders.getPlayerLeader()){e.next=53;break}return ai.setBlockInput(!1),this.tabs.setInteractableButtons(!0),e.abrupt("return");case 53:return e.next=55,this.scrollToLeader(f,1);case 55:if(!this.isAborted()){e.next=59;break}return ai.setBlockInput(!1),this.tabs.setInteractableButtons(!0),e.abrupt("return");case 59:return e.next=61,this.runPlayerRankChangeAnimation(this.animAbortSignal,h);case 61:if(!this.isAborted()){e.next=65;break}return ai.setBlockInput(!1),this.tabs.setInteractableButtons(!0),e.abrupt("return");case 65:PP.setStorageData("leaderboard_content","previousScore",h),PP.setStorageData("leaderboard_content","previousRank",p),ai.setBlockInput(!1),this.tabs.setInteractableButtons(!0);case 69:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})},{key:"runPlayerRankChangeAnimation",value:(n=Ce(Se().mark((function e(t,n){var i,a,r,o,s,l,u,c,h,p,d,f,v,y,m;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=PP.getStorage("leaderboard_content"),(a=i.previousScore)&&!(a>=n)){e.next=3;break}return e.abrupt("return");case 3:if(r=this.leaders.getLeaderData(),-1!==(o=r.findIndex((function(e){return e.playerId===LP.getPlayerId()})))){e.next=7;break}return e.abrupt("return");case 7:if(s=r[o],l=s.score,u=s.rank,s.score=n,r.sort((function(e,t){return t.score-e.score})),r.forEach((function(e,t){e.rank=t+1})),c=this.leaders.getPlayerLeader()){e.next=15;break}return e.abrupt("return");case 15:if(u!==s.rank){e.next=18;break}return c.updateScore({score:s.score,isHighlight:!0}),e.abrupt("return");case 18:if(h=this.leaders.getLeaderByRank(s.rank)){e.next=21;break}return e.abrupt("return");case 21:return this.leaders.layout.enabled=!1,e.next=24,c.runScaleAnimation(t,1.1,.5);case 24:return p=Math.min(.5*(u-s.rank),2),d=[c.runUpdateDataAnimation(u,s.rank,l,s.score,p),this.scrollToLeader(h,p)],f=this.uiTransform.contentSize.height,v=this.scrollview.getMaxScrollOffset().y,y=-h.node.position.y-f/2,m=Y.ZERO,y<0?m=new Y(c.node.worldPosition.x,f+h.node.position.y,c.node.worldPosition.z):this.scrollview.getScrollOffset().y>=v-5&&(m=y<v?new Y(c.node.worldPosition.x,f/2,c.node.worldPosition.z):h.node.worldPosition),m.equals(Y.ZERO)||d.push(c.runWorldPositionAnimation(m,p)),e.next=34,Promise.all(d);case 34:return e.next=36,Promise.all([c.runScaleAnimation(t,1,.25),c.node.setSiblingIndex(s.rank-1),this.leaders.runUpdateLeadersRankAnimation(s.rank,u)]);case 36:this.leaders.layout.enabled=!0,this.leaders.layout.updateLayout();case 38:case"end":return e.stop()}}),e,this)}))),function(e,t){return n.apply(this,arguments)})},{key:"scrollToLeader",value:(t=Ce(Se().mark((function e(t,n){var i,a,r,o;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=this.uiTransform.contentSize,a=new Q(0,-t.node.position.y-i.height/2),r=this.scrollview.getScrollOffset().clone(),a.y=Math.max(a.y,0),r.y=Math.max(r.y,0),o=a.y-r.y,!(Math.abs(o)<5)){e.next=8;break}return e.abrupt("return");case 8:return this.scrollview.scrollToOffset(a,n),e.abrupt("return",vn.waitTweenAsync(n));case 10:case"end":return e.stop()}}),e,this)}))),function(e,n){return t.apply(this,arguments)})}]),c}(f)).prototype,"panelAnimator",[aP],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),fP=Xe(pP.prototype,"tabs",[rP],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),vP=Xe(pP.prototype,"leaders",[oP],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),yP=Xe(pP.prototype,"scrollview",[sP],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),mP=Xe(pP.prototype,"leaderSkeletons",[lP],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),gP=Xe(pP.prototype,"leaderboardIsEmpty",[uP],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),bP=Xe(pP.prototype,"contentOpacity",[cP],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),hP=pP))||hP);n._RF.pop(),n._RF.push({},"ae514KD4phHMYC0AD3CIw68","LeaderboardPage",void 0);var DP,MP,NP,FP,BP,GP,zP,UP,HP,VP,qP,WP,KP,jP,YP,XP,$P;(0,i.ccclass)("LeaderboardPage")(AP=function(e){Ie(r,e);var t,n,i,a=Fe(r);function r(){return Te(this,r),a.apply(this,arguments)}return xe(r,[{key:"mount",value:(i=Ce(Se().mark((function e(){var t;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.pagePrefab){e.next=5;break}return e.next=3,ai.loadPrefabAsync(Dn.LEADERBOARD_PAGE);case 3:(t=e.sent)&&this.node&&(this.pagePrefab=t);case 5:return e.next=7,Ge(Pe(r.prototype),"mount",this).call(this);case 7:if(this.containerUIOpacity.opacity=0,this.content=this.container.getComponentInChildren(OP),this.content){e.next=11;break}throw new Error("LeaderboardPage: Leaders not found");case 11:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"transitionIn",value:(n=Ce(Se().mark((function e(){var t,n,i=this;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Ge(Pe(r.prototype),"transitionIn",this).call(this);case 2:return this.content.enableUIAnimator(),t=vn.runTweenAsync(S(this.containerUIOpacity).to(.2,{opacity:255})),n=new Promise((function(e){i.node.scene.emit(pr.SHOW_UI,{onComplete:function(){e()}})})),e.next=7,Promise.all([t,n]);case 7:this.content.enter();case 8:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"transitionOut",value:(t=Ce(Se().mark((function e(){var t=this;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Ge(Pe(r.prototype),"transitionOut",this).call(this);case 2:return this.content.unlistenUIEvents(),e.next=5,new Promise((function(e){t.node.scene.emit(pr.HIDE_UI,{onComplete:function(){e()}})}));case 5:this.content.disableUIAnimator();case 6:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"unmount",value:function(){var e,t;null===(e=this.content)||void 0===e||e.hide(),null===(t=this.content)||void 0===t||t.cleanup(),Ge(Pe(r.prototype),"unmount",this).call(this)}}]),r}(QS));n._RF.pop(),n._RF.push({},"8cd04RxbahLDaxq9FJf6hBh","TournamentBlock",void 0);var QP,JP,ZP,e_,t_,n_=i.ccclass,i_=i.property,a_=globalThis.game,r_=a_.leaderboard,o_=a_.player,s_=(DP=n_("TournamentBlock"),MP=i_(a),NP=i_(u),FP=i_(u),BP=i_(u),GP=i_(u),zP=i_(s),UP=i_({type:[A]}),DP((qP=Xe((VP=function(e){Ie(r,e);var t,n,i,a=Fe(r);function r(){var e;Te(this,r);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return Ye(e=a.call.apply(a,[this].concat(n)),"container",qP,Me(e)),Ye(e,"titleLabel",WP,Me(e)),Ye(e,"timeLabel",KP,Me(e)),Ye(e,"playerCountLabel",jP,Me(e)),Ye(e,"playButtonLabel",YP,Me(e)),Ye(e,"uiTransform",XP,Me(e)),Ye(e,"banners",$P,Me(e)),e}return xe(r,[{key:"onLoad",value:function(){this.uiOpacity=this.node.getComponent(N),this.validateRequiredComponents()}},{key:"activateThemeBanner",value:function(e){var t=!1;this.banners.forEach((function(n){n.node.active=n.node.name.toLowerCase()===e,n.node.active&&(t=!0)})),t||this.banners.forEach((function(e){e.node.active=e.node.name.toLowerCase()===wl.SUMMER}))}},{key:"validateRequiredComponents",value:function(){kt.lazyValidateProperties(this)}},{key:"updateInfo",value:(i=Ce(Se().mark((function e(t){var n,i,a,r,o,s,l,u,c,h,p;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.payload=t,n=t.endTime,i=t.title,a=t.payload,r=a.leaderboardId,o=a.themeId,r){e.next=5;break}return e.abrupt("return");case 5:return this.setPlayerCountWaiting(),this.updateTitle(i),this.updateEndTime(n),this.updateTournamentBanner(o),s={leaders:[],isPlayerInTournament:!1},e.prev=10,e.next=13,this.getLeadersPayload(r);case 13:(l=e.sent)&&(s=l),e.next=20;break;case 17:e.prev=17,e.t0=e.catch(10),console.error(`Fetch lb for tournament ${i}`,e.t0);case 20:this.leadersPayload=s,u=this.leadersPayload,c=u.leaders,h=u.isPlayerInTournament,p=c.length,this.updatePlayerCount(p),this.updatePlayButtonLabel(h);case 25:case"end":return e.stop()}}),e,this,[[10,17]])}))),function(e){return i.apply(this,arguments)})},{key:"updateTitle",value:function(e){e&&(this.titleLabel.string=e)}},{key:"updateEndTime",value:function(e){var t=GameCore.Utils.Time.getRelativeTime(e);this.timeLabel.string=`Ends ${t}`}},{key:"updatePlayerCount",value:function(e){this.playerCountLabel.string=`${e} `+(e>1?"players":"player")}},{key:"setPlayerCountWaiting",value:function(){this.playerCountLabel.string="Loading..."}},{key:"updateTournamentBanner",value:function(e){e?this.activateThemeBanner(e):this.activateThemeBanner(wl.SUMMER)}},{key:"updatePlayButtonLabel",value:function(e){this.playButtonLabel.string=e?"Continue":"Join"}},{key:"getLeadersPayload",value:(n=Ce(Se().mark((function e(t){var n,i,a,r,o,s,l,u;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=r_.getLeaderboardName(t)){e.next=3;break}return e.abrupt("return",null);case 3:return e.next=5,r_.requestLeaderboardAsync(n,0);case 5:if(i=r_.getLeaderboard(n)){e.next=8;break}return e.abrupt("return",null);case 8:for(a=Object.values(i.leaders),r=o_.getPlayerId(),o={leaders:[],player:void 0,isPlayerInTournament:!1},s=0,l=a;s<l.length;s++)(u=l[s]).playerId===r?(o.player=u,o.isPlayerInTournament=!0,o.leaders.push(u)):o.leaders.push(u);return e.abrupt("return",o);case 13:case"end":return e.stop()}}),e)}))),function(e){return n.apply(this,arguments)})},{key:"runShowPopUpAnimation",value:(t=Ce(Se().mark((function e(t,n,i){var a,r,o,s,l=this;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.node.scale=new Y(.8,.8,.8),this.uiOpacity.opacity=0,a=this.container.position.clone(),this.container.position=new Y(a.x,a.y-100,a.z),(r=S(this.node).delay(t)).to(n,{scale:Y.ONE},{easing:"elasticOut"}),(o=S(this.container).delay(t)).to(n,{position:a},{easing:"backOut"}),(s=S(this.uiOpacity).delay(t)).to(n,{opacity:255},{easing:"cubicOut"}),i.addAbortListener((function(){l.node.scale=Y.ONE,l.container.position=a,l.uiOpacity.opacity=255})),e.next=13,Promise.all([vn.runTweenAsync(r,i),vn.runTweenAsync(o,i),vn.runTweenAsync(s,i)]);case 13:case"end":return e.stop()}}),e,this)}))),function(e,n,i){return t.apply(this,arguments)})},{key:"handleOnTournamentClicked",value:function(){var e=this.payload.id||"";if(vu.validateTournamentExpired(e))return this.node.scene.emit(il.RELOAD_TOURNAMENT),void lu.showNotificationScreen("Tournament has ended",2);try{var t=JSON.stringify(this.payload);lu.showTournamentDetailScreen(t,"tournament_start")}catch(e){console.warn("handleOnTournamentClicked",e)}}}]),r}(f)).prototype,"container",[MP],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),WP=Xe(VP.prototype,"titleLabel",[NP],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),KP=Xe(VP.prototype,"timeLabel",[FP],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),jP=Xe(VP.prototype,"playerCountLabel",[BP],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),YP=Xe(VP.prototype,"playButtonLabel",[GP],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),XP=Xe(VP.prototype,"uiTransform",[zP],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),$P=Xe(VP.prototype,"banners",[UP],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),HP=VP))||HP);n._RF.pop(),n._RF.push({},"a409buwLfZLQq7cmBGiqhF5","TournamentBlockSkeleton",void 0);var l_,u_,c_,h_,p_,d_,f_,v_,y_,m_,g_,b_=i.ccclass,w_=i.property,k_=(QP=b_("TournamentBlockSkeleton"),JP=w_(a),QP((t_=Xe((e_=function(e){Ie(a,e);var t,n,i=Fe(a);function a(){var e;Te(this,a);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return Ye(e=i.call.apply(i,[this].concat(n)),"container",t_,Me(e)),e}return xe(a,[{key:"__preload",value:function(){this.uiOpacity=this.getComponent(N),this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){kt.lazyValidateProperties(this)}},{key:"hide",value:(n=Ce(Se().mark((function e(t){var n=this;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,vn.runTweenAsync(S(this.uiOpacity).to(.2,{opacity:0}).call((function(){n.node.active=!1})),t);case 2:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"show",value:(t=Ce(Se().mark((function e(t,n){var i,a,r,o,s=this;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.node.active=!0,this.node.scale=new Y(.8,.8,.8),this.uiOpacity.opacity=0,i=this.container.position.clone(),this.container.position=new Y(i.x,i.y-100,i.z),(a=S(this.node).delay(t)).to(.2,{scale:Y.ONE},{easing:"elasticOut"}),(r=S(this.container).delay(t)).to(.2,{position:i},{easing:"backOut"}),(o=S(this.uiOpacity).delay(t)).to(.2,{opacity:255},{easing:"cubicOut"}),n.addAbortListener((function(){s.node.scale=Y.ONE,s.container.position=i,s.uiOpacity.opacity=255})),e.next=14,Promise.all([vn.runTweenAsync(a,n),vn.runTweenAsync(r,n),vn.runTweenAsync(o,n)]);case 14:case"end":return e.stop()}}),e,this)}))),function(e,n){return t.apply(this,arguments)})}]),a}(f)).prototype,"container",[JP],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ZP=e_))||ZP);n._RF.pop(),n._RF.push({},"5f82fye3oxHQrxKbP9TC2di","TournamentsBoard",void 0);var S_,E_,C_,T_,A_,x_=i.ccclass,R_=i.property,I_=globalThis.game.player,P_=(l_=x_("TournamentsBoard"),u_=R_(I),c_=R_(a),h_=R_(T),p_=R_(a),l_((v_=Xe((f_=function(e){Ie(i,e);var t,n=Fe(i);function i(){var e;Te(this,i);for(var t=arguments.length,a=new Array(t),r=0;r<t;r++)a[r]=arguments[r];return Ye(e=n.call.apply(n,[this].concat(a)),"tournamentBlockPrefab",v_,Me(e)),e.tournamentBlockArray=[],Ye(e,"inactiveNodeContainer",y_,Me(e)),Ye(e,"layout",m_,Me(e)),Ye(e,"createTournamentButton",g_,Me(e)),e}return xe(i,[{key:"onLoad",value:function(){this.uiTransform=this.getComponent(s),this.uiOpacity=this.getComponent(N),this.validateRequiredComponents()}},{key:"start",value:function(){for(var e=0;e<20;e++)this.addTournamentBlock();this.tournamentBlockContentHeight=this.tournamentBlockArray[0].uiTransform.contentSize.height+this.layout.spacingY}},{key:"validateRequiredComponents",value:function(){kt.lazyValidateProperties(this)}},{key:"updateData",value:function(e){var t=this,n=!1;e.forEach((function(e,i){var a=t.tournamentBlockArray[i];e.payload.playerId===I_.getPlayerId()&&(n=!0),a||(a=t.addTournamentBlock()),a.updateInfo(e),t.layout.node.addChild(a.node)})),n||this.setCreateTournamentButtonActive(!0)}},{key:"addTournamentBlock",value:function(){var e=l(this.tournamentBlockPrefab);this.inactiveNodeContainer.addChild(e);var t=e.getComponent(s_);return this.tournamentBlockArray.push(t),t}},{key:"removeTournamentBlocks",value:function(){var e=this;this.getActiveTournamentBlocks().forEach((function(t){e.inactiveNodeContainer.addChild(t.node)})),this.setCreateTournamentButtonActive(!1)}},{key:"getActiveTournamentBlocks",value:function(){var e=this;return this.tournamentBlockArray.filter((function(t){return t.node.parent===e.layout.node}))}},{key:"setCreateTournamentButtonActive",value:function(e){e?this.layout.node.addChild(this.createTournamentButton):this.layout.node.removeChild(this.createTournamentButton),this.createTournamentButton.active=e}},{key:"showTournamentBlocks",value:(t=Ce(Se().mark((function e(t,n){var i,a,r;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!((i=this.getActiveTournamentBlocks()).length<1)){e.next=3;break}return e.abrupt("return");case 3:return a=Math.ceil(t/this.tournamentBlockContentHeight),r=Math.min(i.length,a),e.next=8,Promise.all(i.map(function(){var e=Ce(Se().mark((function e(t,i){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(i>=r)){e.next=4;break}return e.next=3,t.runShowPopUpAnimation(.1*i,.3,n);case 3:return e.abrupt("return");case 4:t.uiOpacity.opacity=255;case 5:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()));case 8:case"end":return e.stop()}}),e,this)}))),function(e,n){return t.apply(this,arguments)})},{key:"updateVisibility",value:function(){var e=this.uiTransform.getBoundingBoxToWorld(),t=e.yMax,n=e.yMin;this.getActiveTournamentBlocks().forEach((function(e){var i=e.uiTransform;if(void 0!==i){var a=i.getBoundingBoxToWorld(),r=a.yMax,o=a.yMin,s=r<n||o>t;e.uiOpacity.opacity=s?0:255}}))}}]),i}(f)).prototype,"tournamentBlockPrefab",[u_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),y_=Xe(f_.prototype,"inactiveNodeContainer",[c_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),m_=Xe(f_.prototype,"layout",[h_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),g_=Xe(f_.prototype,"createTournamentButton",[p_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),d_=f_))||d_);n._RF.pop(),n._RF.push({},"f8a7b0St3FAkb1PvvvJTLCh","TournamentsNotAvailable",void 0);var __,L_,O_,D_,M_,N_,F_,B_,G_,z_,U_,H_,V_,q_,W_,K_=i.ccclass,j_=i.property,Y_=(S_=K_("TournamentsNotAvailable"),E_=j_(p),S_((A_=Xe((T_=function(e){Ie(i,e);var t,n=Fe(i);function i(){var e;Te(this,i);for(var t=arguments.length,a=new Array(t),r=0;r<t;r++)a[r]=arguments[r];return Ye(e=n.call.apply(n,[this].concat(a)),"createButton",A_,Me(e)),e}return xe(i,[{key:"onLoad",value:function(){this.uiOpacity=this.getComponent(N),this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){kt.lazyValidateProperties(this)}},{key:"show",value:(t=Ce(Se().mark((function e(){var t,n,i;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.createButton.interactable=!0,this.uiOpacity.opacity=255,t=this.node.position.clone(),(n=S(this.node)).to(.05,{position:t.clone().add3f(5,0,0)}),n.to(.05,{position:t.clone().add3f(-5,0,0)}),(i=S(this.node).repeat(2,n)).to(.05,{position:t}),e.next=10,vn.runTweenAsync(i);case 10:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"hide",value:function(){this.createButton.interactable=!1,this.uiOpacity.opacity=0}}]),i}(f)).prototype,"createButton",[E_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),C_=T_))||C_);n._RF.pop(),n._RF.push({},"199fcQ5IEZFbJCfSrGNrGDQ","TournamentContent",void 0);var X_,$_=i.ccclass,Q_=i.property,J_=globalThis.game,Z_=J_.storage,eL=J_.match,tL=GameCore.Utils.Object,nL=(__=$_("TournamentContent"),L_=Q_({type:Gr}),O_=Q_(P_),D_=Q_(Y_),M_=Q_(ue),N_=Q_({type:[k_]}),F_=Q_(da),__((z_=Xe((G_=function(e){Ie(o,e);var t,n,i,a,r=Fe(o);function o(){var e;Te(this,o);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return Ye(e=r.call.apply(r,[this].concat(n)),"panelAnimator",z_,Me(e)),Ye(e,"tournamentsBoard",U_,Me(e)),Ye(e,"tournamentsNotAvailable",H_,Me(e)),Ye(e,"scrollView",V_,Me(e)),Ye(e,"skeletons",q_,Me(e)),Ye(e,"contentOpacity",W_,Me(e)),e.animAbortSignal=null,e.softAbortSignal=null,e.hideContent=function(){e.contentOpacity.changeStateFade(!1,.1)},e.showContent=function(){e.contentOpacity.changeStateFade(!0,.1)},e}return xe(o,[{key:"onLoad",value:function(){this.uiTransform=this.node.getComponent(s),this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){kt.lazyValidateProperties(this)}},{key:"listenEvents",value:function(){this.scrollView.node.on(ue.EventType.SCROLLING,this.onScrolling,this),this.node.scene.on(il.RELOAD_TOURNAMENT,this.reload,this),this.node.scene.on(pr.HIDE_UI,this.hideContent),this.node.scene.on(pr.SHOW_UI,this.showContent)}},{key:"unlistenEvents",value:function(){this.scrollView.node.off(ue.EventType.SCROLLING,this.onScrolling,this),this.node.scene.off(il.RELOAD_TOURNAMENT,this.reload,this),this.unlistenUIEvents()}},{key:"unlistenUIEvents",value:function(){this.node.scene.off(pr.HIDE_UI,this.hideContent),this.node.scene.off(pr.SHOW_UI,this.showContent)}},{key:"onScrolling",value:function(){this.tournamentsBoard.updateVisibility()}},{key:"enableUIAnimator",value:function(){this.panelAnimator.enabled=!0}},{key:"disableUIAnimator",value:function(){this.panelAnimator.enabled=!1}},{key:"enter",value:(a=Ce(Se().mark((function e(){var t,n;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.listenEvents(),null===this.animAbortSignal&&null===this.softAbortSignal){e.next=3;break}throw new Error("TournamentContent: TournamentContent is already running");case 3:return this.animAbortSignal=new On,this.softAbortSignal=new On,e.next=7,this.showLoading(this.animAbortSignal);case 7:if(!this.isAborted()){e.next=9;break}return e.abrupt("return");case 9:return e.next=11,vu.requestTournamentDataAsync();case 11:if(n=e.sent,!this.isAborted()){e.next=14;break}return e.abrupt("return");case 14:return e.next=16,this.hideLoading(this.animAbortSignal);case 16:if(!this.isAborted()){e.next=18;break}return e.abrupt("return");case 18:if(0!==n.length||null!==(t=this.softAbortSignal)&&void 0!==t&&t.aborted){e.next=21;break}return this.tournamentsNotAvailable.show(),e.abrupt("return");case 21:return this.tryShowTournamentResult(),this.scrollView.enabled=!0,this.tournamentsBoard.updateData(n),e.next=26,this.tournamentsBoard.showTournamentBlocks(this.uiTransform.contentSize.height-this.tournamentsBoard.layout.paddingTop,this.animAbortSignal);case 26:case"end":return e.stop()}}),e,this)}))),function(){return a.apply(this,arguments)})},{key:"showLoading",value:(i=Ce(Se().mark((function e(t){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.scrollView.scrollToTop(0),this.scrollView.enabled=!1,e.next=4,Promise.all([this.skeletons.map((function(e){return e.show(0,t)}))]);case 4:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})},{key:"hideLoading",value:(n=Ce(Se().mark((function e(t){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all([this.skeletons.map((function(e){return e.hide(t)}))]);case 2:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"tryShowTournamentResult",value:function(){try{if(!Z_.getStorage("tournament").animateTournamentLeader)return;var e=vu.getAllTournamentData(),t=eL.getMatchState().customData.tournamentId;if(!t)throw new Error("Tournament ID not found");var n=e.find((function(e){return e.id===t}));if(!n)throw new Error("Tournament not found");var i=JSON.stringify(n);lu.showTournamentDetailScreen(i,"tournament_end")}catch(e){Z_.setStorageData("tournament","animateTournamentLeader",!1),console.warn("showTournamentResult",e)}}},{key:"processCreateTournament",value:(t=Ce(Se().mark((function e(){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Bl.processCreateTournamentAsync();case 3:e.next=13;break;case 5:if(e.prev=5,e.t0=e.catch(0),tL.hasOwn(e.t0,"code")){e.next=10;break}return lu.showNotificationScreen("Sorry. Unknown error. Failed to Create Tournament"),e.abrupt("return");case 10:if("USER_INPUT"!==e.t0.code){e.next=12;break}return e.abrupt("return");case 12:"INVALID_OPERATION"===e.t0.code?lu.showNotificationScreen(e.t0.message):lu.showNotificationScreen("Sorry. Unknown error. Failed to Create Tournament");case 13:this.reload();case 14:case"end":return e.stop()}}),e,this,[[0,5]])}))),function(){return t.apply(this,arguments)})},{key:"isAborted",value:function(){var e,t;return null===(e=null===(t=this.animAbortSignal)||void 0===t?void 0:t.aborted)||void 0===e||e}},{key:"cleanup",value:function(){var e;this.unlistenEvents(),null===(e=this.animAbortSignal)||void 0===e||e.abort(),this.animAbortSignal=null,this.tournamentsBoard.removeTournamentBlocks(),this.tournamentsNotAvailable.hide()}},{key:"softAbort",value:function(){var e;null===(e=this.softAbortSignal)||void 0===e||e.abort(),this.softAbortSignal=null}},{key:"reload",value:function(){this.softAbort(),this.cleanup(),this.enter()}}]),o}(f)).prototype,"panelAnimator",[L_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),U_=Xe(G_.prototype,"tournamentsBoard",[O_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),H_=Xe(G_.prototype,"tournamentsNotAvailable",[D_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),V_=Xe(G_.prototype,"scrollView",[M_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),q_=Xe(G_.prototype,"skeletons",[N_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),W_=Xe(G_.prototype,"contentOpacity",[F_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),B_=G_))||B_);n._RF.pop(),n._RF.push({},"bce5eh0LHVP2bCJ6u+kFjuA","TournamentPage",void 0);var iL,aL,rL,oL,sL,lL;(0,i.ccclass)("TournamentPage")(X_=function(e){Ie(r,e);var t,n,i,a=Fe(r);function r(){return Te(this,r),a.apply(this,arguments)}return xe(r,[{key:"mount",value:(i=Ce(Se().mark((function e(){var t;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.pagePrefab){e.next=5;break}return e.next=3,ai.loadPrefabAsync(Dn.TOURNAMENTS_PAGE);case 3:(t=e.sent)&&this.node&&(this.pagePrefab=t);case 5:return e.next=7,Ge(Pe(r.prototype),"mount",this).call(this);case 7:if(this.containerUIOpacity.opacity=0,this.content=this.container.getComponentInChildren(nL),this.content){e.next=11;break}throw new Error("LeaderboardPage: Leaders not found");case 11:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"transitionIn",value:(n=Ce(Se().mark((function e(){var t,n,i=this;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Ge(Pe(r.prototype),"transitionIn",this).call(this);case 2:return this.content.enableUIAnimator(),t=vn.runTweenAsync(S(this.containerUIOpacity).to(.2,{opacity:255})),n=new Promise((function(e){i.node.scene.emit(pr.SHOW_UI,{onComplete:function(){e()}})})),e.next=7,Promise.all([t,n]);case 7:this.content.enter();case 8:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"transitionOut",value:(t=Ce(Se().mark((function e(){var t,n=this;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return null===(t=this.content)||void 0===t||t.softAbort(),this.content.unlistenUIEvents(),e.next=4,Ge(Pe(r.prototype),"transitionOut",this).call(this);case 4:return e.next=6,new Promise((function(e){n.node.scene.emit(pr.HIDE_UI,{onComplete:function(){e()}})}));case 6:this.content.disableUIAnimator();case 7:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"unmount",value:function(){var e;null===(e=this.content)||void 0===e||e.cleanup(),Ge(Pe(r.prototype),"unmount",this).call(this)}}]),r}(QS));n._RF.pop(),n._RF.push({},"b8271vI+3pO9q8SKMYpqLKv","EventBadge",void 0);var uL,cL,hL,pL,dL,fL,vL,yL,mL,gL=i.ccclass,bL=i.property;iL=gL("EventBadge"),aL=bL(u),rL=bL(m),iL((lL=Xe((sL=function(e){Ie(n,e);var t=Fe(n);function n(){var e;Te(this,n);for(var i=arguments.length,a=new Array(i),r=0;r<i;r++)a[r]=arguments[r];return Ye(e=t.call.apply(t,[this].concat(a)),"label",lL,Me(e)),e}return xe(n,[{key:"text",get:function(){return this.label.string},set:function(e){this.label.string=e}},{key:"onLoad",value:function(){this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){if(!this.label)throw new Error("EventBadge: Missing required component Label")}}]),n}(f)).prototype,"label",[aL],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Xe(sL.prototype,"text",[rL],Object.getOwnPropertyDescriptor(sL.prototype,"text"),sL.prototype),oL=sL));n._RF.pop(),n._RF.push({},"7712cs4XLJAgpKqlO3gPqkF","EventProgressBar",void 0);var wL,kL,SL,EL,CL,TL,AL,xL,RL,IL,PL,_L,LL,OL,DL,ML,NL,FL,BL,GL,zL,UL,HL,VL,qL,WL,KL,jL,YL,XL,$L,QL,JL,ZL,eO,tO,nO,iO,aO,rO,oO,sO,lO,uO,cO,hO=i.ccclass,pO=i.property;uL=hO("EventProgressBar"),cL=pO(go),hL=pO(u),pL=pO(m),dL=pO({range:[0,1,.01],slide:!0,tooltip:"i18n:progress.progress"}),uL((yL=Xe((vL=function(e){Ie(n,e);var t=Fe(n);function n(){var e;Te(this,n);for(var i=arguments.length,a=new Array(i),r=0;r<i;r++)a[r]=arguments[r];return Ye(e=t.call.apply(t,[this].concat(a)),"progressBar",yL,Me(e)),Ye(e,"progressLabel",mL,Me(e)),e}return xe(n,[{key:"text",get:function(){return this.progressLabel.string},set:function(e){this.progressLabel.string=e}},{key:"progress",get:function(){return this.progressBar.progress},set:function(e){this.progressBar.progress=e}},{key:"__preload",value:function(){}},{key:"onLoad",value:function(){this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){if(!this.progressBar)throw new Error("EventProgressBar: Missing required component TapperedProgressBar");if(!this.progressLabel)throw new Error("EventProgressBar: Missing required component Label")}}]),n}(f)).prototype,"progressBar",[cL],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),mL=Xe(vL.prototype,"progressLabel",[hL],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Xe(vL.prototype,"text",[pL],Object.getOwnPropertyDescriptor(vL.prototype,"text"),vL.prototype),Xe(vL.prototype,"progress",[dL],Object.getOwnPropertyDescriptor(vL.prototype,"progress"),vL.prototype),fL=vL));n._RF.pop(),n._RF.push({},"7741dWPNcdHRqGVvif/L/MP","NavButton",void 0);var dO,fO,vO,yO,mO,gO,bO,wO=i.ccclass,kO=i.property,SO=i.executeInEditMode,EO=globalThis.game.analytics;wL=wO("NavButton"),kL=kO(H),SL=kO({group:{name:"Animation"},displayName:"Is Selected",tooltip:"This is for the editor only and will be ignored at runtime",editorOnly:!0}),EL=kO({type:E,group:{name:"Animation"}}),CL=kO({type:E,group:{name:"Animation"}}),TL=kO({type:E,group:{name:"Animation"}}),AL=kO({type:E,group:{name:"Animation"}}),xL=kO({type:E,group:{name:"Animation"}}),RL=kO({group:{name:"Animation"}}),IL=kO({type:E,group:{name:"Animation"}}),PL=kO({type:E,group:{name:"Animation"}}),_L=kO({group:{name:"Animation"}}),LL=kO({type:E,group:{name:"Animation"}}),OL=kO({type:E,group:{name:"Animation"}}),DL=kO({type:E,group:{name:"Animation"}}),ML=kO({type:E,group:{name:"Animation"}}),NL=kO({type:s}),FL=kO(a),BL=kO(N),GL=kO({type:s}),zL=kO({type:D(Ln)}),UL=kO(Fx),wL(HL=SO((qL=Xe((VL=function(e){Ie(r,e);var t,n,i=Fe(r);function r(){var e;Te(this,r);for(var t=arguments.length,n=new Array(t),a=0;a<t;a++)n[a]=arguments[a];return Ye(e=i.call.apply(i,[this].concat(n)),"wip",qL,Me(e)),Ye(e,"isSelectedInEditor",WL,Me(e)),Ye(e,"animationDuration",KL,Me(e)),Ye(e,"selectedSpacing",jL,Me(e)),Ye(e,"deselectedSpacing",YL,Me(e)),Ye(e,"selectedIconY",XL,Me(e)),Ye(e,"selectedIconX",$L,Me(e)),Ye(e,"selectedIconScale",QL,Me(e)),Ye(e,"deselectedIconY",JL,Me(e)),Ye(e,"deselectedIconX",ZL,Me(e)),Ye(e,"deselectedIconScale",eO,Me(e)),Ye(e,"selectedTextY",tO,Me(e)),Ye(e,"selectedTextX",nO,Me(e)),Ye(e,"deselectedTextY",iO,Me(e)),Ye(e,"deselectedTextX",aO,Me(e)),Ye(e,"spacer",rO,Me(e)),Ye(e,"icon",oO,Me(e)),Ye(e,"text",sO,Me(e)),Ye(e,"uiTransform",lO,Me(e)),Ye(e,"screenType",uO,Me(e)),Ye(e,"navManager",cO,Me(e)),e.isSelected=!1,e.onMouseEnter=function(t){e.isSelected||e.playHoverOnAnimation()},e.onMouseLeave=function(t){e.isSelected||e.playHoverOffAnimation()},e}return xe(r,[{key:"isWIP",get:function(){return this.wip}},{key:"buttonType",get:function(){return this.screenType}},{key:"update",value:function(){}},{key:"onEnable",value:function(){this.node.on(a.EventType.MOUSE_ENTER,this.onMouseEnter),this.node.on(a.EventType.MOUSE_LEAVE,this.onMouseLeave)}},{key:"onDisable",value:function(){this.node.off(a.EventType.MOUSE_ENTER,this.onMouseEnter),this.node.off(a.EventType.MOUSE_LEAVE,this.onMouseLeave)}},{key:"onEditorUpdate",value:function(){null!==this.icon&&void 0!==this.icon&&null!==this.text&&void 0!==this.icon&&null!==this.spacer&&void 0!==this.spacer&&(this.isSelectedInEditor?(this.icon.setScale(this.selectedIconScale),this.icon.setPosition(this.selectedIconX,this.selectedIconY,0),this.text.node.setPosition(this.selectedTextX,this.selectedTextY,0),this.spacer.width=this.selectedSpacing,this.text.opacity=255):(this.icon.setScale(this.deselectedIconScale),this.icon.setPosition(this.deselectedIconX,this.deselectedIconY,0),this.text.node.setPosition(this.deselectedTextX,this.deselectedTextY,0),this.spacer.width=this.deselectedSpacing,this.text.opacity=0))}},{key:"setSelected",value:function(){var e,t;this.isSelected||(bi.playSound(ui.PATCH_SHIFT),this.navManager.selectUsingSceneTransition(this),EO.event(GameCore.Plugins.Analytics.Events.BUTTON_CLICK,{button_name:null!==(e=null===(t=this.node.parent)||void 0===t?void 0:t.name)&&void 0!==e?e:this.node.name,screen_name:gi.getCurrentPage()}))}},{key:"select",value:(n=Ce(Se().mark((function e(){var t,n=arguments;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=!(n.length>0&&void 0!==n[0])||n[0],!this.isSelected){e.next=3;break}throw new Error("NavButton: Already selected");case 3:if(this.isSelected=!0,!t){e.next=9;break}return e.next=7,vn.runTweenAsync(this.playSelectAnimation());case 7:e.next=14;break;case 9:this.icon.setScale(this.selectedIconScale),this.icon.setPosition(this.selectedIconX,this.selectedIconY,0),this.text.node.setPosition(this.selectedTextX,this.selectedTextY,0),this.spacer.width=this.selectedSpacing,this.text.opacity=255;case 14:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"deselect",value:(t=Ce(Se().mark((function e(){var t,n,i=arguments;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=!(i.length>0&&void 0!==i[0])||i[0],n=i.length>1&&void 0!==i[1]&&i[1],this.isSelected||n){e.next=4;break}throw new Error("NavButton: Already deselected");case 4:if(this.isSelected=!1,!t){e.next=10;break}return e.next=8,vn.runTweenAsync(this.deselectAnimation());case 8:e.next=15;break;case 10:this.icon.setScale(this.deselectedIconScale),this.icon.setPosition(this.deselectedIconX,this.deselectedIconY,0),this.text.node.setPosition(this.deselectedTextX,this.deselectedTextY,0),this.spacer.width=this.deselectedSpacing,this.text.opacity=0;case 15:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"getSelectedWorldDistanceX",value:function(){var e=new Y(this.selectedIconX,this.selectedIconY,0),t=new Y(this.deselectedIconX,this.deselectedIconY,0),n=this.node.scale.clone();this.node.scale=this.selectedIconScale;var i=this.uiTransform.convertToWorldSpaceAR(e),a=this.uiTransform.convertToWorldSpaceAR(t);return this.node.scale=n,a.x-i.x}},{key:"playHoverOnAnimation",value:function(){var e=S(this.icon);return e.to(.1,{scale:this.deselectedIconScale.clone().add3f(.1,.1,0)},{easing:"cubicIn"}),vn.runTweenAsync(e)}},{key:"playHoverOffAnimation",value:function(){var e=S(this.icon);return e.to(.1,{scale:this.deselectedIconScale},{easing:"cubicOut"}),vn.runTweenAsync(e)}},{key:"playSelectAnimation",value:function(){var e=this;return S(this.spacer).to(this.animationDuration,{width:this.selectedSpacing},{easing:"linear",onUpdate:function(t,n){if(void 0!==n){var i=M.quintInOut(n),a=M.backOut(n),r=M.linear(n),o=n<.5?2*n:1,s=e.deselectedIconY+(e.selectedIconY-e.deselectedIconY)*a,l=e.deselectedIconX+(e.selectedIconX-e.deselectedIconX)*r;e.icon.setPosition(l,s,0);var u=e.deselectedIconScale.clone().lerp(e.selectedIconScale,i);e.icon.setScale(u.x,u.y,e.icon.scale.z);var c=255*o,h=e.deselectedTextY+(e.selectedTextY-e.deselectedTextY)*r,p=e.deselectedTextX+(e.selectedTextX-e.deselectedTextX)*r;e.text.opacity=c,e.text.node.setPosition(p,h,0)}}})}},{key:"deselectAnimation",value:function(){var e=this;return S(this.spacer).to(this.animationDuration,{width:this.deselectedSpacing},{easing:"linear",onUpdate:function(t,n){if(void 0!==n){var i=ce(e.selectedIconY,e.deselectedIconY,n),a=ce(e.selectedIconX,e.deselectedIconX,n);e.icon.setPosition(a,i,0);var r=ce(255,0,n<.5?2*n:1);e.text.opacity=r;var o=ce(e.selectedTextY,e.deselectedTextY,n),s=ce(e.selectedTextX,e.deselectedTextX,n);e.text.node.setPosition(s,o,0);var l=e.selectedIconScale.clone().lerp(e.deselectedIconScale,M.quintInOut(n));e.icon.setScale(l.x,l.y,e.icon.scale.z)}}})}},{key:"onLoad",value:function(){this.uiTransform=this.getComponent(s),this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){kt.lazyValidateProperties(this)}}]),r}(f)).prototype,"wip",[kL],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),WL=Xe(VL.prototype,"isSelectedInEditor",[SL],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),KL=Xe(VL.prototype,"animationDuration",[EL],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.3}}),jL=Xe(VL.prototype,"selectedSpacing",[CL],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 150}}),YL=Xe(VL.prototype,"deselectedSpacing",[TL],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 88}}),XL=Xe(VL.prototype,"selectedIconY",[AL],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 20}}),$L=Xe(VL.prototype,"selectedIconX",[xL],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),QL=Xe(VL.prototype,"selectedIconScale",[RL],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Y(1,1,1)}}),JL=Xe(VL.prototype,"deselectedIconY",[IL],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),ZL=Xe(VL.prototype,"deselectedIconX",[PL],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),eO=Xe(VL.prototype,"deselectedIconScale",[_L],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Y(.8,.8,1)}}),tO=Xe(VL.prototype,"selectedTextY",[LL],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return-10}}),nO=Xe(VL.prototype,"selectedTextX",[OL],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),iO=Xe(VL.prototype,"deselectedTextY",[DL],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),aO=Xe(VL.prototype,"deselectedTextX",[ML],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),rO=Xe(VL.prototype,"spacer",[NL],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),oO=Xe(VL.prototype,"icon",[FL],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),sO=Xe(VL.prototype,"text",[BL],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),lO=Xe(VL.prototype,"uiTransform",[GL],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),uO=Xe(VL.prototype,"screenType",[zL],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),cO=Xe(VL.prototype,"navManager",[UL],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),HL=VL))||HL);n._RF.pop(),n._RF.push({},"9b83boaSv9PE6mRFqy0MSI8","GameScene",void 0);var CO,TO,AO,xO,RO,IO,PO,_O,LO,OO,DO,MO,NO,FO,BO,GO=i.ccclass,zO=i.property,UO=i.disallowMultiple,HO=globalThis.game,VO=HO.audio,qO=HO.player,WO=Ra;dO=GO("GameScene"),fO=zO(Vk),vO=zO(Wb),dO(yO=UO((gO=Xe((mO=function(e){Ie(n,e);var t=Fe(n);function n(){var e;Te(this,n);for(var i=arguments.length,a=new Array(i),r=0;r<i;r++)a[r]=arguments[r];return Ye(e=t.call.apply(t,[this].concat(a)),"animSkipOverlay",gO,Me(e)),Ye(e,"coinManager",bO,Me(e)),e.handleGameExit=function(){Tv.hideBannerAds(),Yl.switchScene(tl)},e.handleShowResults=function(){Yl.switchScene(nl)},e.handleGameMaskWhenLayoutChanged=function(e){var t=R("Canvas/Game/GameObjects");if(t){var n=t.getComponent(he);n&&(n.enabled=e===WO.Landscape)}},e.attemptCallSubscribeBot=function(){"subscribeBotAsync"in GameSDK.extra&&GameSDK.extra.subscribeBotAsync().catch((function(e){console.warn("subscribeBotAsync",e)}))},e}return xe(n,[{key:"__preload",value:function(){this.validateRequiredComponents(),this.listenGameEvents(),Tv.showBannerAds()}},{key:"onLoad",value:function(){this.coinManager.init(this.animSkipOverlay)}},{key:"validateRequiredComponents",value:function(){kt.lazyValidateProperties(this)}},{key:"listenGameEvents",value:function(){W.on(ma,this.handleGameMaskWhenLayoutChanged),this.node.scene.on(pr.GAME_EXIT,this.handleGameExit),this.node.scene.on(pr.SHOW_CHALLENGE_RESULTS,this.handleShowResults)}},{key:"start",value:function(){this.scheduleOnce(this.attemptCallSubscribeBot,.5),qO.getPlayerSetting("music")&&bi.playMusic(),this.updateVolumeBackgroundMusic(),this.scheduleOnce(this.preloadScenes,2)}},{key:"preloadScenes",value:function(){Yl.preloadDashboardScene()}},{key:"updateVolumeBackgroundMusic",value:function(){VO.setVolume(1,"global_music")}}]),n}(f)).prototype,"animSkipOverlay",[fO],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),bO=Xe(mO.prototype,"coinManager",[vO],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),yO=mO))||yO);n._RF.pop(),n._RF.push({},"48081huyTZGu5rme4u8PrdR","Item",void 0);var KO,jO,YO,XO,$O,QO,JO,ZO=i.ccclass,eD=i.property;CO=ZO("ItemButton"),TO=eD(H),AO=eD(p),xO=eD({type:g}),RO=eD(u),IO=eD(a),PO=eD(a),CO((OO=Xe((LO=function(e){Ie(n,e);var t=Fe(n);function n(){var e;Te(this,n);for(var i=arguments.length,a=new Array(i),r=0;r<i;r++)a[r]=arguments[r];return Ye(e=t.call.apply(t,[this].concat(a)),"isDebug",OO,Me(e)),Ye(e,"button",DO,Me(e)),Ye(e,"quantity",MO,Me(e)),Ye(e,"quantityLabel",NO,Me(e)),Ye(e,"plusNode",FO,Me(e)),Ye(e,"quantityNode",BO,Me(e)),e}return xe(n,[{key:"__preload",value:function(){this.item=this.getComponent(pv),this.validateRequiredComponents()}},{key:"start",value:function(){this.quantity=this.item.loadQuantity(),this.quantityLabel.string=`${this.quantity}`,this.validateButton(),this.node.scene.on(pr.GRID_CREATE,this.validateButton,this),this.node.scene.on(pr.GRID_MATCH_SUCCESS,this.validateButton,this),this.node.scene.on(pr.GRID_CLEAR,this.validateButton,this)}},{key:"validateRequiredComponents",value:function(){if(!this.item)throw new Error("Item: BaseItem component not found");if(!this.button)throw new Error("Item: Button component not found");if(!this.quantityLabel)throw new Error("Item: Quantity label not found");if(!this.plusNode)throw new Error("Item: Plus node not found");if(!this.quantityNode)throw new Error("Item: Quantity node not found")}},{key:"validateButton",value:function(){var e=this;console.log("VALIDATE BUTTON"),this.canActivate().then((function(t){e.button.interactable=!0,e.plusNode.active=0==e.quantity,e.quantityNode.active=e.quantity>0}))}},{key:"activate",value:function(){var e=this;return new Promise((function(t){if(e.quantity<=0)return e.handleShowAddItemScreen(),void t();e.item.activate().then((function(){e.isDebug||(e.quantity--,e.quantityLabel.string=`${e.quantity}`,e.item.saveQuantity()),e.validateButton(),t()}))}))}},{key:"canActivate",value:function(){return Promise.resolve(!0)}},{key:"addQuantity",value:function(e){this.quantity+=e,this.quantityLabel.string=`${this.quantity}`,this.item.saveQuantity(),this.validateButton()}},{key:"clearQuantity",value:function(){this.quantity=0,this.quantityLabel.string=`${this.quantity}`,this.item.saveQuantity(),this.validateButton()}},{key:"handleShowAddItemScreen",value:function(){lu.openScreen(di.GET_ITEM_SCREEN,{item:Ms.HINT,quantity:1})}}]),n}(f)).prototype,"isDebug",[TO],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),DO=Xe(LO.prototype,"button",[AO],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),MO=Xe(LO.prototype,"quantity",[xO],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),NO=Xe(LO.prototype,"quantityLabel",[RO],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),FO=Xe(LO.prototype,"plusNode",[IO],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),BO=Xe(LO.prototype,"quantityNode",[PO],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_O=LO));n._RF.pop(),n._RF.push({},"0c0b4cnFOFJ6pJmGNHnMo7m","ComboEffect",void 0);var tD,nD,iD,aD,rD,oD,sD,lD=i.ccclass,uD=i.property;KO=lD("ComboEffect"),jO=uD(N),YO=uD(re),KO((QO=Xe(($O=function(e){Ie(n,e);var t=Fe(n);function n(){var e;Te(this,n);for(var i=arguments.length,a=new Array(i),r=0;r<i;r++)a[r]=arguments[r];return Ye(e=t.call.apply(t,[this].concat(a)),"circleOpacity",QO,Me(e)),Ye(e,"particle",JO,Me(e)),e}return xe(n,[{key:"onLoad",value:function(){this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){if(!this.circleOpacity)throw new Error("ComboEffect requires a circleOpacity component");if(!this.particle)throw new Error("ComboEffect requires a particle component")}},{key:"start",value:function(){this.node.scene.on(pr.COMBO_UPDATED,this.handleOnComboUpdated,this)}},{key:"handleOnComboUpdated",value:function(e){e>1&&(this.circleOpacity.node.scale=Y.ZERO,this.circleOpacity.opacity=127.5,this.particle.resetSystem(),S(this.circleOpacity.node).to(.2,{scale:new Y(1.3,1.3,1.3)},{easing:"quadOut"}).start(),S(this.circleOpacity).delay(.2).to(.2,{opacity:0},{easing:"expoIn"}).start())}}]),n}(f)).prototype,"circleOpacity",[jO],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),JO=Xe($O.prototype,"particle",[YO],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),XO=$O));n._RF.pop(),n._RF.push({},"0506aJZ1EdPqJejQ2PpB980","ComboLabel",void 0);var cD,hD,pD,dD,fD,vD,yD,mD,gD,bD=i.ccclass,wD=i.property;tD=bD("ComboLabel"),nD=wD(u),iD=wD(a),tD((oD=Xe((rD=function(e){Ie(n,e);var t=Fe(n);function n(){var e;Te(this,n);for(var i=arguments.length,a=new Array(i),r=0;r<i;r++)a[r]=arguments[r];return Ye(e=t.call.apply(t,[this].concat(a)),"comboNumber",oD,Me(e)),Ye(e,"comboContainer",sD,Me(e)),e}return xe(n,[{key:"onLoad",value:function(){this.opacity=this.getComponent(N),this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){kt.lazyValidateProperties(this)}},{key:"start",value:function(){this.node.scene.on(pr.COMBO_UPDATED,this.handleOnComboUpdated,this)}},{key:"handleOnComboUpdated",value:function(e){0===e?this.opacity.opacity=0:e>1?(this.opacity.opacity=255,this.comboNumber.string=`${e}`,S(this.comboContainer).to(.1,{scale:new Y(1.3,1.3,1.3)},{easing:"sineIn"}).to(.1,{scale:Y.ONE},{easing:"sineOut"}).start()):this.opacity.opacity=0}}]),n}(f)).prototype,"comboNumber",[nD],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),sD=Xe(rD.prototype,"comboContainer",[iD],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),aD=rD));n._RF.pop(),n._RF.push({},"51871oF8CFOkp81rgCf90UQ","ComboPopup",void 0);var kD,SD,ED,CD,TD,AD,xD,RD,ID,PD=i.ccclass,_D=i.property;cD=PD("ComboPopup"),hD=_D(A),pD=_D(O),dD=_D(y),cD((yD=Xe((vD=function(e){Ie(n,e);var t=Fe(n);function n(){var e;Te(this,n);for(var i=arguments.length,a=new Array(i),r=0;r<i;r++)a[r]=arguments[r];return Ye(e=t.call.apply(t,[this].concat(a)),"textSprite",yD,Me(e)),Ye(e,"comboSprites",mD,Me(e)),Ye(e,"animation",gD,Me(e)),e}return xe(n,[{key:"onLoad",value:function(){this.validateRequiredComponents()}},{key:"start",value:function(){this.node.scene.on(pr.COMBO_UPDATED,this.handleOnComboUpdated,this)}},{key:"validateRequiredComponents",value:function(){if(!this.textSprite)throw new Error("ComboPopup: textSprite not found");if(0===this.comboSprites.length)throw new Error("ComboPopup: comboSprites not found");if(!this.animation)throw new Error("ComboPopup: animation not found")}},{key:"handleOnComboUpdated",value:function(e){if(!(e<2))for(var t=this.comboSprites.length-1;t>=0;t--)if(e>=t+2){this.textSprite.spriteFrame=this.comboSprites[t],this.animation.play();break}}}]),n}(f)).prototype,"textSprite",[hD],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),mD=Xe(vD.prototype,"comboSprites",[pD],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),gD=Xe(vD.prototype,"animation",[dD],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),fD=vD));n._RF.pop(),n._RF.push({},"a0819yK3HpO2505QqLUOChz","PlayerScore",void 0);var LD,OD,DD,MD,ND,FD,BD,GD,zD,UD,HD,VD,qD,WD,KD,jD=i.ccclass,YD=i.property,XD=(kD=jD("PlayerScore"),SD=YD(a),ED=YD(u),CD=YD(A),kD((xD=Xe((AD=function(e){Ie(i,e);var t,n=Fe(i);function i(){var e;Te(this,i);for(var t=arguments.length,a=new Array(t),r=0;r<t;r++)a[r]=arguments[r];return Ye(e=n.call.apply(n,[this].concat(a)),"crown",xD,Me(e)),Ye(e,"playerScore",RD,Me(e)),Ye(e,"avatar",ID,Me(e)),e}return xe(i,[{key:"showCrown",value:function(e){this.crown.active=e}},{key:"setPlayerScore",value:function(e){this.playerScore.string=e.toString()}},{key:"playWaitingAnimation",value:function(){var e=this,t=0;this.playerScore.schedule((function(){t=(t+1)%4;var n=Array(t+1).join(".");e.playerScore.string="Waiting"+n}),.5);var n=this.playerScore.getComponent(N),i=S(n).to(1,{opacity:130},{easing:"sineInOut"}).to(1,{opacity:255},{easing:"sineInOut"}).delay(.25);this.waitingAnimation=S(n).repeatForever(i).start()}},{key:"stopWaitingAnimation",value:function(){this.playerScore.unscheduleAllCallbacks(),this.waitingAnimation&&this.waitingAnimation.stop(),this.playerScore.getComponent(N).opacity=255}},{key:"loadPhoto",value:(t=Ce(Se().mark((function e(t){var n,i;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,GameCore.Utils.Image.loadImage(t);case 3:if(n=e.sent){e.next=6;break}throw new Error("Failed to load image");case 6:if(i=O.createWithImage(n)){e.next=9;break}throw new Error("Failed to create sprite frame");case 9:i.packable=!0,this.avatar.spriteFrame=i,e.next=17;break;case 13:return e.prev=13,e.t0=e.catch(0),console.error(e.t0),e.abrupt("return");case 17:case"end":return e.stop()}}),e,this,[[0,13]])}))),function(e){return t.apply(this,arguments)})}]),i}(f)).prototype,"crown",[SD],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),RD=Xe(AD.prototype,"playerScore",[ED],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ID=Xe(AD.prototype,"avatar",[CD],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),TD=AD))||TD);n._RF.pop(),n._RF.push({},"4b062RYQK5PQbgs7yH66gDw","ChallengeResultScene",void 0);var $D,QD,JD,ZD,eM,tM,nM,iM,aM,rM=i.ccclass,oM=i.disallowMultiple,sM=i.property,lM=globalThis.game,uM=lM.match,cM=lM.player,hM=lM.monitorError,pM="Waiting";LD=rM("ChallengeResultScene"),OD=sM(g),DD=sM({type:XD,group:"Score"}),MD=sM({type:XD,group:"Score"}),ND=sM(Yw),FD=sM(u),BD=sM(bv),LD(GD=oM((UD=Xe((zD=function(e){Ie(i,e);var t,n=Fe(i);function i(){var e;Te(this,i);for(var t=arguments.length,a=new Array(t),r=0;r<t;r++)a[r]=arguments[r];return Ye(e=n.call.apply(n,[this].concat(a)),"pollingInterval",UD,Me(e)),Ye(e,"playerScore",HD,Me(e)),Ye(e,"opponentScore",VD,Me(e)),Ye(e,"paperConfetti",qD,Me(e)),Ye(e,"titleText",WD,Me(e)),Ye(e,"levelManager",KD,Me(e)),e.goToDashboardScene=function(){Tv.hideBannerAds(),Yl.switchScene(tl)},e.pollMatchState=Ce(Se().mark((function t(){var n,i,a,r,o,s,l,u,c,h,p,d,f,v,y,m,g,b;return Se().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,n=uM.getMatchState(),null!==(i=n.id)){t.next=4;break}throw new Error("Match id is not found");case 4:return a=cM.getPlayerId(),r=Date.now(),t.next=8,uM.api.getMatchAPI().getMatchDetailByIdAsync(i);case 8:if(o=t.sent,s=Date.now(),l=Math.max(0,s-r,e.pollingInterval),u=new GameCore.Dtos.Match.Data(o).toObject(),c=u.blackPlayerId,h=u.blackPlayerScore,p=u.whitePlayerScore,d=u.blackPlayerFinish,f=u.whitePlayerFinish,v=a===c?h:p,y=a===c?p:h,m=a===c?d:f,g=a===c?f:d,b=d&&f,e.playerScore.setPlayerScore(v),e.opponentScore.setPlayerScore(y),e.playerScore.showCrown(b&&v>y),e.opponentScore.showCrown(b&&y>v),e.stopWaitingAnimation(),e.playerScore.stopWaitingAnimation(),e.opponentScore.stopWaitingAnimation(),b){t.next=32;break}e.titleText.string=pM,e.playWaitingAnimation(),m||e.playerScore.playWaitingAnimation(),g||e.opponentScore.playWaitingAnimation(),t.next=45;break;case 32:if(v!==y){t.next=36;break}e.titleText.string="Draw",t.next=45;break;case 36:if(!(v>y)){t.next=40;break}e.titleText.string="You Win",t.next=45;break;case 40:if(!(v<y)){t.next=44;break}e.titleText.string="You Lose",t.next=45;break;case 44:return t.abrupt("return");case 45:e.scheduleOnce(e.pollMatchState,l),t.next=52;break;case 48:t.prev=48,t.t0=t.catch(0),console.warn("ResultScene: Error on pollMatchState",t.t0),e.scheduleOnce(e.pollMatchState,e.pollingInterval);case 52:case"end":return t.stop()}}),t,null,[[0,48]])}))),e}return xe(i,[{key:"__preload",value:function(){this.validateRequiredComponents(),this.listenEvents(),Tv.showBannerAds()}},{key:"validateRequiredComponents",value:function(){kt.lazyValidateProperties(this)}},{key:"onLoad",value:function(){try{var e=uM.getMatchState(),t=e.customData,n=t.playerId,i=t.opponentId;if(null===n||null===i)throw new Error(`ResultScene: playerId is ${n} and opponentId is ${i}. Expected to not be null.`);var a=cM.getPlayer().photo,r=e.profiles[n],o=r.score,s=void 0===o?0:o,l=r.finished,u=void 0!==l&&l,c=e.profiles[i],h=c.photo,p=c.score,d=void 0===p?0:p,f=c.finished,v=void 0!==f&&f,y=u&&v,m=y&&s>d,g=y&&d>s;this.playerScore.loadPhoto(a),this.opponentScore.loadPhoto(h),this.playerScore.setPlayerScore(s),this.opponentScore.setPlayerScore(d),this.playerScore.showCrown(m),this.opponentScore.showCrown(g),u&&v?s===d?this.titleText.string="Draw":m?this.titleText.string="You Win":g&&(this.titleText.string="You Lose"):(this.titleText.string=pM,this.playWaitingAnimation(),u||this.playerScore.playWaitingAnimation(),v||this.opponentScore.playWaitingAnimation())}catch(e){console.warn("ResultScene: Error on load",e),this.goToDashboardScene()}}},{key:"listenEvents",value:function(){this.node.scene.on(Sa,this.goToDashboardScene),this.node.scene.on(ka,this.onReplayButtonPressed,this)}},{key:"start",value:function(){var e=this;this.scheduleOnce(this.pollMatchState,this.pollingInterval),this.scheduleOnce((function(){e.paperConfetti.runEffect()}),.2)}},{key:"onDestroy",value:function(){this.unschedule(this.pollMatchState)}},{key:"onReplayButtonPressed",value:(t=Ce(Se().mark((function e(){var t,n,i,a,r,o,s,l,u,c,h,p,d,f;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=null!==(t=cM.getGameData())&&void 0!==t?t:{},i=n.level,a=void 0===i?1:i,a=Math.max(1,a),e.next=4,this.levelManager.loadLevelData(a);case 4:if(r=e.sent,e.prev=5,r){e.next=8;break}throw new Error("Level data is not found");case 8:if(o=uM.getMatchState().customData.opponentId){e.next=11;break}throw new Error("Opponent id is not found");case 11:return lu.showLoadingScreen(),s=dh.generateFen(r),l=r.mode,u=void 0===l?"":l,c=r.rules,h=void 0===c?{addRandomTilesPerMove:0,maxSpaceOfPair:0}:c,p=r.time,d=void 0===p?0:p,f=r.level,e.next=16,uM.challenge.friend.processAsync({playerId:cM.getPlayerId(),opponentId:o,extraData:{level:f,fen:s,gravity:u,rules:h,time:d}});case 16:lu.closeLoadingScreen(),this.goToGameScene(),e.next=28;break;case 20:e.prev=20,e.t0=e.catch(5),console.warn("ReplayChallengeFriend",e.t0),lu.closeLoadingScreen(),lu.showNotificationScreen("Sorry, you cannot replay\nat this time.",2),null==hM||hM.sendException(e.t0 instanceof Error?e.t0:new Error("ReplayChallengeFriend"+JSON.stringify(e.t0))),this.scheduleOnce(this.goToDashboardScene,2);case 28:case"end":return e.stop()}}),e,this,[[5,20]])}))),function(){return t.apply(this,arguments)})},{key:"onHomeButtonPressed",value:function(){this.goToDashboardScene()}},{key:"goToGameScene",value:function(){Yl.switchScene(el)}},{key:"playWaitingAnimation",value:function(){var e=this,t=0;this.titleText.schedule((function(){t=(t+1)%4;var n=Array(t+1).join(".");e.titleText.string=pM+n}),.5);var n=this.titleText.getComponent(N),i=S(n).to(1,{opacity:130},{easing:"sineInOut"}).to(1,{opacity:255},{easing:"sineInOut"}).delay(.25);this.waitingAnimation=S(n).repeatForever(i).start()}},{key:"stopWaitingAnimation",value:function(){this.titleText.unscheduleAllCallbacks(),this.waitingAnimation&&this.waitingAnimation.stop(),this.titleText.getComponent(N).opacity=255}}]),i}(f)).prototype,"pollingInterval",[OD],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 15}}),HD=Xe(zD.prototype,"playerScore",[DD],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),VD=Xe(zD.prototype,"opponentScore",[MD],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),qD=Xe(zD.prototype,"paperConfetti",[ND],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),WD=Xe(zD.prototype,"titleText",[FD],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),KD=Xe(zD.prototype,"levelManager",[BD],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),GD=zD))||GD);n._RF.pop(),n._RF.push({},"acb0egHPppFmYJalVNrDDv/","BaseScreen",void 0);var dM,fM=i.ccclass,vM=i.property,yM=i.disallowMultiple,mM=GameCore.Events,gM=globalThis.game.event,bM=($D=fM("BaseScreen"),QD=vM(a),JD=vM(a),ZD=vM(N),$D(eM=yM((nM=Xe((tM=function(e){Ie(n,e);var t=Fe(n);function n(){var e;Te(this,n);for(var i=arguments.length,a=new Array(i),r=0;r<i;r++)a[r]=arguments[r];return Ye(e=t.call.apply(t,[this].concat(a)),"container",nM,Me(e)),Ye(e,"backgroundMask",iM,Me(e)),Ye(e,"screenOpacity",aM,Me(e)),e.data={},e}return xe(n,[{key:"__preload",value:function(){this.animation=this.getComponent(y),this.validateRequiredComponents(),this.initializeNodes()}},{key:"initializeNodes",value:function(){var e=this.getMaskOpacity(),t=this.getContainerOpacity();e&&t&&(e.opacity=0,t.opacity=0)}},{key:"validateRequiredComponents",value:function(){kt.lazyValidateProperties(this)}},{key:"setScreenOpacity",value:function(e){this.screenOpacity.opacity=e}},{key:"open",value:function(e){e&&(this.data=e),this.show(),this.runAnimation("OpenScreen")}},{key:"close",value:function(){var e=this;this.node.active&&(this.animation.once(y.EventType.FINISHED,(function(){gM.emit(mM.CLOSED_SCREEN,{screenName:e.node.name}),e.hide()})),this.runAnimation("CloseScreen"))}},{key:"runAnimation",value:function(e){if(!this.isAnimationExist(e))throw new Error(`${this.node.name}: Animation component must have ${e} clip`);this.animation.play(e)}},{key:"isAnimationExist",value:function(e){return this.animation.clips.some((function(t){return!(!t||t.name!==e)}))}},{key:"getMaskOpacity",value:function(){var e=this.backgroundMask.getComponent(N);return e||(console.warn("BaseScreen: maskOpacity not found"),null)}},{key:"getContainerOpacity",value:function(){var e=this.container.getComponent(N);return e||(console.warn("BaseScreen: containerOpacity not found"),null)}},{key:"show",value:function(){this.setScreenOpacity(255);var e=this.node.getComponent(C);e&&(e.enabled=!0,e.updateAlignment(),this.node.getComponentsInChildren(C).forEach((function(e){e.updateAlignment()})))}},{key:"hide",value:function(){this.setScreenOpacity(0),this.node.setWorldPosition(new Y(-1e3,-1e3,0));var e=this.node.getComponent(C);e&&(e.enabled=!1)}}]),n}(f)).prototype,"container",[QD],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),iM=Xe(tM.prototype,"backgroundMask",[JD],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),aM=Xe(tM.prototype,"screenOpacity",[ZD],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),eM=tM))||eM)||eM);n._RF.pop(),n._RF.push({},"f3521L4Mn5I3bhxr0QZJ9y9","BackgroundMask",void 0);var wM,kM,SM,EM,CM,TM=i.ccclass,AM=i.requireComponent;TM("BackgroundMask")(dM=AM([N])(dM=function(e){Ie(n,e);var t=Fe(n);function n(){return Te(this,n),t.apply(this,arguments)}return xe(n,[{key:"onLoad",value:function(){var e=this.getComponent(N);e?(this.opacity=e,this.updateMaskAlpha()):console.warn("BackgroundMask: UIOpacity not found")}},{key:"updateMaskAlpha",value:function(){var e,t,n=this.opacity.opacity/255;e=n,(t=document.getElementById("app-mask"))&&(t.style.background=`rgb(0 0 0 / ${e})`)}}]),n}(f))||dM);n._RF.pop(),n._RF.push({},"d25c5ZVzYVC/YcfG5prmRdB","Screens",void 0);var xM,RM,IM,PM,_M,LM,OM,DM,MM,NM,FM,BM,GM,zM,UM=i.ccclass,HM=i.property,VM=(wM=UM("Screens"),kM=HM({type:D(di)}),wM((CM=Xe((EM=function(e){Ie(n,e);var t=Fe(n);function n(){var e;Te(this,n);for(var i=arguments.length,a=new Array(i),r=0;r<i;r++)a[r]=arguments[r];return Ye(e=t.call.apply(t,[this].concat(a)),"screenKeys",CM,Me(e)),e}return xe(n)}(f)).prototype,"screenKeys",[kM],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),SM=EM))||SM);n._RF.pop(),n._RF.push({},"cecf2nUBzhIWZw7uJgVliXz","CongratulationScreen",void 0);var qM,WM,KM,jM,YM,XM,$M,QM,JM,ZM,eN,tN,nN,iN,aN,rN,oN,sN,lN,uN,cN,hN=i.ccclass,pN=i.property,dN=i.disallowMultiple,fN=i.requireComponent,vN=GameCore.Events,yN=globalThis.game.event;xM=hN("CongratulationScreen"),RM=fN(bM),IM=pN(a),PM=pN(a),_M=pN(p),LM=pN(p),OM=pN(p),xM(DM=dN(DM=RM((NM=Xe((MM=function(e){Ie(n,e);var t=Fe(n);function n(){var e;Te(this,n);for(var i=arguments.length,a=new Array(i),r=0;r<i;r++)a[r]=arguments[r];return Ye(e=t.call.apply(t,[this].concat(a)),"congratulation",NM,Me(e)),Ye(e,"confirmation",FM,Me(e)),Ye(e,"closeButtonComponent",BM,Me(e)),Ye(e,"yesButtonComponent",GM,Me(e)),Ye(e,"noButtonComponent",zM,Me(e)),e.handleOpeningScreen=function(t){if(!e.screen)throw new Error("CongratulationScreen: screen not found");e.validateEventPayload(t)&&(e.closeButtonComponent.interactable=!0,e.yesButtonComponent.interactable=!0,e.noButtonComponent.interactable=!0)},e.handleOpenedScreen=function(t){e.validateEventPayload(t)&&e.open()},e}return xe(n,[{key:"__preload",value:function(){this.enabled=!1,this.screen=this.getComponent(bM),this.confirmationUIOpacity=this.confirmation.getComponent(N),this.validateRequiredComponents(),this.listenScreenEvents()}},{key:"onDestroy",value:function(){this.unListenScreenEvents()}},{key:"validateRequiredComponents",value:function(){kt.lazyValidateProperties(this)}},{key:"listenScreenEvents",value:function(){yN.on(vN.OPENING_SCREEN,this.handleOpeningScreen),yN.on(vN.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"unListenScreenEvents",value:function(){yN.off(vN.OPENING_SCREEN,this.handleOpeningScreen),yN.off(vN.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"validateEventPayload",value:function(e){return e.screenName===this.node.name}},{key:"open",value:function(){this.confirmation.active=!1,this.congratulation.active=!0}},{key:"close",value:function(){this.closeButtonComponent.interactable=!1,this.yesButtonComponent.interactable=!1,this.noButtonComponent.interactable=!1,lu.closeScreen(vi[this.node.name])}},{key:"handleStartOver",value:function(){this.confirmation.active=!0,this.congratulation.active=!1,S(this.confirmationUIOpacity).set({opacity:0}).to(.2,{opacity:255}).start(),S(this.confirmation).set({scale:new Y(.8,.8,.8)}).to(.2,{scale:new Y(1,1,1)},{easing:"backOut"}).start()}},{key:"handleYesStartOver",value:function(){this.close(),this.node.scene.emit(pr.START_OVER)}},{key:"handleNoStartOver",value:function(){this.requestGameReplay()}},{key:"handleClickedClose",value:function(){this.requestGameReplay()}},{key:"requestGameReplay",value:function(){this.close(),this.node.scene.emit(pr.GAME_REPLAY,{level:this.screen.data.level})}}]),n}(f)).prototype,"congratulation",[IM],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),FM=Xe(MM.prototype,"confirmation",[PM],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),BM=Xe(MM.prototype,"closeButtonComponent",[_M],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),GM=Xe(MM.prototype,"yesButtonComponent",[LM],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),zM=Xe(MM.prototype,"noButtonComponent",[OM],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),DM=MM))||DM)||DM);n._RF.pop(),n._RF.push({},"01c067hcjNDc7prJzSE6UEq","DayBlock",void 0);var mN,gN,bN,wN,kN,SN,EN=i.ccclass,CN=i.property,TN=(qM=EN("DayBlock"),WM=CN({type:A,group:"Background"}),KM=CN({type:A,group:"Background"}),jM=CN({type:O,group:"Background"}),YM=CN({type:O,group:"Background"}),XM=CN(u),$M=CN(u),QM=CN(a),JM=CN(a),ZM=CN(a),qM((nN=Xe((tN=function(e){Ie(n,e);var t=Fe(n);function n(){var e;Te(this,n);for(var i=arguments.length,a=new Array(i),r=0;r<i;r++)a[r]=arguments[r];return Ye(e=t.call.apply(t,[this].concat(a)),"background",nN,Me(e)),Ye(e,"topBackground",iN,Me(e)),Ye(e,"blueBackground",aN,Me(e)),Ye(e,"blueTopBackground",rN,Me(e)),Ye(e,"dayLabel",oN,Me(e)),Ye(e,"coinLabel",sN,Me(e)),Ye(e,"rewardItemsNode",lN,Me(e)),Ye(e,"checkNode",uN,Me(e)),Ye(e,"glowNodes",cN,Me(e)),e}return xe(n,[{key:"onLoad",value:function(){this.uiOpacity=this.getComponent(N),this.initDefaultProperties(),this.validateRequiredComponents()}},{key:"initDefaultProperties",value:function(){this.defaultBackground=this.background.spriteFrame,this.defaultTopBackground=this.topBackground.spriteFrame,this.defaultDayLabelOutlineColor=new r(this.dayLabel.outlineColor),this.blueDayLabelOutlineColor=new r("#3469bf")}},{key:"validateRequiredComponents",value:function(){kt.lazyValidateProperties(this)}},{key:"updateInfo",value:function(e){this.updateBackground(e),this.updateDayLabel(e),this.coinLabel.string=e.value.toString(),this.updateRewardItems(e)}},{key:"updateBackground",value:function(e){if(this.blueTopBackground&&this.blueBackground)switch(e.status){case"ready":this.background.spriteFrame=this.blueBackground,this.topBackground.spriteFrame=this.blueTopBackground;break;case"waiting":this.background.spriteFrame=this.defaultBackground,this.topBackground.spriteFrame=this.blueTopBackground;break;case"rewarded":this.background.spriteFrame=this.defaultBackground,this.topBackground.spriteFrame=this.defaultTopBackground}}},{key:"updateDayLabel",value:function(e){this.dayLabel.string=`Day ${e.day.toString()}`;var t=this.defaultDayLabelOutlineColor;"rewarded"!==e.status&&(t=this.blueDayLabelOutlineColor),this.dayLabel.outlineColor=t,this.dayLabel.shadowColor=t}},{key:"updateRewardItems",value:function(e){switch(e.status){case"ready":this.rewardItemsNode.active=!0,this.checkNode.active=!1,this.setGlowNodesActive(!0);break;case"waiting":this.rewardItemsNode.active=!0,this.checkNode.active=!1,this.setGlowNodesActive(!1);break;case"rewarded":this.rewardItemsNode.active=!1,this.checkNode.active=!0,this.setGlowNodesActive(!1)}}},{key:"setGlowNodesActive",value:function(e){this.glowNodes&&this.glowNodes.forEach((function(t){t.active=e}))}}]),n}(f)).prototype,"background",[WM],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),iN=Xe(tN.prototype,"topBackground",[KM],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),aN=Xe(tN.prototype,"blueBackground",[jM],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),rN=Xe(tN.prototype,"blueTopBackground",[YM],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),oN=Xe(tN.prototype,"dayLabel",[XM],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),sN=Xe(tN.prototype,"coinLabel",[$M],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),lN=Xe(tN.prototype,"rewardItemsNode",[QM],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),uN=Xe(tN.prototype,"checkNode",[JM],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),cN=Xe(tN.prototype,"glowNodes",[ZM],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),eN=tN))||eN);n._RF.pop(),n._RF.push({},"cc662r8eR5Al6FdOBdcAkHG","DailyRewardsScreen",void 0);var AN,xN=i.ccclass,RN=i.property,IN=i.requireComponent,PN=GameCore.Events,_N=globalThis.game,LN=_N.event,ON=_N.dailyRewards,DN=_N.player,MN=_N.monitorError;mN=xN("DailyRewardsScreen"),gN=IN(bM),bN=RN([TN]),mN(wN=gN((SN=Xe((kN=function(e){Ie(r,e);var t,n,i,a=Fe(r);function r(){var e;Te(this,r);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return(e=a.call.apply(a,[this].concat(n))).rewardsData=[],e.debugScreenOpened=!1,e.debugUpdatedRewardsData=!1,Ye(e,"dailyBlocks",SN,Me(e)),e.handleOpeningScreen=function(t){e.validateEventPayload(t)},e.handleOpenedScreen=function(t){e.validateEventPayload(t)&&e.open()},e}return xe(r,[{key:"__preload",value:function(){this.enabled=!1,this.screen=this.getComponent(bM),this.validateRequiredComponents(),this.listenScreenEvents()}},{key:"onDestroy",value:function(){this.unListenScreenEvents()}},{key:"validateRequiredComponents",value:function(){kt.lazyValidateProperties(this)}},{key:"listenScreenEvents",value:function(){LN.on(PN.OPENING_SCREEN,this.handleOpeningScreen),LN.on(PN.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"unListenScreenEvents",value:function(){LN.off(PN.OPENING_SCREEN,this.handleOpeningScreen),LN.off(PN.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"validateEventPayload",value:function(e){return(null!=e?e:{}).screenName===this.node.name}},{key:"open",value:(i=Ce(Se().mark((function e(){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:
//! DEBUG bug Cannot read properties of undefined (reading 'find')
return this.debugScreenOpened=!0,this.node.scene.emit(pr.HIDE_UI),this.resetState(),e.next=5,this.updateRewardsData();case 5:this.loginDailyRewards(),this.updateDayBlocks(),this.runPopUpAnimation();case 8:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"close",value:function(){LN.emit(PN.CLOSE_SCREEN,{screenName:this.node.name}),this.node.scene.emit(pr.SHOW_UI)}},{key:"resetState",value:function(){this.dailyBlocks.forEach((function(e){e.uiOpacity.opacity=0,e.node.scale=new Y(1.2,1.2,1.2)}))}},{key:"runPopUpAnimation",value:function(){var e=this;this.screen.container||console.warn("DailyRewardScreen: screen not found"),this.dailyBlocks.forEach((function(t,n){e.runAppearTween(t,.15*n)}))}},{key:"runAppearTween",value:function(e,t){S(e.uiOpacity).delay(t).to(.3,{opacity:255},{easing:"quadOut"}).start(),S(e.node).delay(t).to(.3,{scale:Y.ONE},{easing:"backOut"}).start()}},{key:"handleOnClaim",value:function(){var e=this.getCurrentRewardData();if(!e)
//! DEBUG bug Cannot read properties of undefined (reading 'find')
return null==MN||MN.sendException(new Error("DailyRewardsScreen: rewardData not found"),{nodeIsActive:this.node.activeInHierarchy,nodeHasParent:null!==this.node.parent&&void 0!==this.node.parent,hasLoadedRewardsData:this.debugUpdatedRewardsData,hasOpenedScreen:this.debugScreenOpened}),void lu.showNotificationScreen("Unable to validate rewards. Please try again later...",2);this.claimReward(e)}},{key:"handleOnClaimX2",value:(n=Ce(Se().mark((function e(){var t;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.getCurrentRewardData()){e.next=5;break}
//! DEBUG bug Cannot read properties of undefined (reading 'find')
return null==MN||MN.sendException(new Error("DailyRewardsScreen: rewardData not found"),{nodeIsActive:this.node.activeInHierarchy,nodeHasParent:null!==this.node.parent&&void 0!==this.node.parent,hasLoadedRewardsData:this.debugUpdatedRewardsData,hasOpenedScreen:this.debugScreenOpened}),lu.showNotificationScreen("Unable to validate rewards. Please try again later...",2),e.abrupt("return");case 5:return e.next=7,Tv.showRewardVideoAdAsync({});case 7:if(e.sent){e.next=10;break}return e.abrupt("return");case 10:this.claimReward(t,!0);case 12:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"getCurrentRewardData",value:function(){return this.rewardsData.find((function(e){return"ready"===e.status}))}},{key:"claimReward",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=e.value*(t?2:1),i=new On;if(this.node.scene.emit(pr.ADD_COINS,{coins:n,collectionAnimation:{animateTextOnly:!1,signal:i}}),e.items){var a=e.items.hint*(t?2:1),r=e.items.thunder*(t?2:1),o=e.items.storm*(t?2:1),s=DN.getGameData();s?(DN.setGameData({items:{hint:s.items.hint+a,thunder:s.items.thunder+r,storm:s.items.storm+o,pliers:s.items.pliers}}),this.close()):this.close()}else this.close()}},{key:"updateRewardsData",value:(t=Ce(Se().mark((function e(){var t,n;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,ON.requestDailyRewardsAsync();case 2:for(t=ke({},ON.getDailyRewards()),n=0;n<GameCore.Configs.DailyRewards.MaxDays;n++)t[n]=ke(ke({},t[n]),{},{value:Hs[n].value,items:Hs[n].items});if(t){e.next=6;break}return e.abrupt("return");case 6:this.rewardsData=Object.values(t),
//! DEBUG bug Cannot read properties of undefined (reading 'find')
this.debugUpdatedRewardsData=!0,console.log("DailyRewardsScreen: rewardsData",this.rewardsData);case 9:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"loginDailyRewards",value:function(){ON.logLoginReward()}},{key:"updateDayBlocks",value:function(){var e=this;
//! DEBUG bug Cannot read properties of undefined (reading 'find')
this.dailyBlocks.length>this.rewardsData.length&&(console.warn("DailyRewardsScreen: dailyBlocks not enough"),null==MN||MN.sendException(new Error("DailyRewardsScreen: dailyBlocks not enough"),{dailyBlocksCount:this.dailyBlocks.length,rewardsDataCount:this.rewardsData.length,nodeIsActive:this.node.activeInHierarchy,nodeHasParent:null!==this.node.parent&&void 0!==this.node.parent,hasLoadedRewardsData:this.debugUpdatedRewardsData,hasOpenedScreen:this.debugScreenOpened})),this.dailyBlocks.forEach((function(t,n){
//! DEBUG bug Cannot read properties of undefined (reading 'find')
if(!(n>=e.rewardsData.length)){var i=e.rewardsData[n],a=i.id,r=i.type,o=i.value,s=i.status;t.updateInfo({day:a,type:r,value:o,status:s})}}))}}]),r}(f)).prototype,"dailyBlocks",[bN],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),wN=kN))||wN);n._RF.pop(),n._RF.push({},"5a6aeaMAdtMGYA8B1wIuhDa","DayBlockRed",void 0);var NN,FN,BN,GN,zN,UN,HN,VN,qN,WN;(0,i.ccclass)("DayBlockRed")(AN=function(e){Ie(n,e);var t=Fe(n);function n(){return Te(this,n),t.apply(this,arguments)}return xe(n,[{key:"updateBackground",value:function(e){if(this.blueTopBackground&&this.blueBackground)switch(e.status){case"ready":this.background.spriteFrame=this.blueBackground,this.topBackground.spriteFrame=this.blueTopBackground;break;case"waiting":this.background.spriteFrame=this.defaultBackground,this.topBackground.spriteFrame=this.defaultTopBackground}}},{key:"updateDayLabel",value:function(e){this.dayLabel.string=`Day ${e.day.toString()}`;var t=this.defaultDayLabelOutlineColor;"ready"===e.status&&(t=this.blueDayLabelOutlineColor),this.dayLabel.shadowColor=t,this.dayLabel.outlineColor=t}}]),n}(TN));n._RF.pop(),n._RF.push({},"6fed95tFh5MRKzFqaFB2Ts8","GetCoinScreen",void 0);var KN,jN,YN,XN,$N,QN,JN,ZN,eF,tF=i.ccclass,nF=i.property,iF=i.requireComponent,aF=globalThis.game.event,rF=GameCore.Events;NN=tF("GetCoinScreen"),FN=iF(bM),BN=nF(u),GN=nF(p),zN=nF(p),NN(UN=FN((VN=Xe((HN=function(e){Ie(i,e);var t,n=Fe(i);function i(){var e;Te(this,i);for(var t=arguments.length,a=new Array(t),r=0;r<t;r++)a[r]=arguments[r];return Ye(e=n.call.apply(n,[this].concat(a)),"quantityLabel",VN,Me(e)),Ye(e,"closeButtonComponent",qN,Me(e)),Ye(e,"getNowButtonComponent",WN,Me(e)),e.handleOpeningScreen=function(t){console.log("GetCoinScreen.OPENING_SCREEN",t),e.validateEventPayload(t)&&(e.closeButtonComponent.interactable=!0,e.getNowButtonComponent.interactable=!0,e.updateStatus())},e.handleOpenedScreen=function(t){e.validateEventPayload(t)&&e.open()},e}return xe(i,[{key:"__preload",value:function(){this.enabled=!1,this.screen=this.getComponent(bM),this.validateRequiredComponents(),this.listenScreenEvents()}},{key:"onDestroy",value:function(){this.unListenScreenEvents()}},{key:"validateRequiredComponents",value:function(){kt.lazyValidateProperties(this)}},{key:"listenScreenEvents",value:function(){aF.on(rF.OPENING_SCREEN,this.handleOpeningScreen),aF.on(rF.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"unListenScreenEvents",value:function(){aF.off(rF.OPENING_SCREEN,this.handleOpeningScreen),aF.off(rF.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"validateEventPayload",value:function(e){return"screenName"in e&&(e.screenName===this.node.name&&(this.payload=e,!0))}},{key:"open",value:function(){this.updateStatus(),this.runPopUpAnimation(),this.node.scene.emit(pr.HIDE_UI)}},{key:"close",value:function(){this.closeButtonComponent.interactable=!1,this.getNowButtonComponent.interactable=!1,aF.emit(rF.CLOSE_SCREEN,{screenName:this.node.name}),this.node.scene.emit(pr.SHOW_UI)}},{key:"updateStatus",value:function(){this.updateCoinQuantity()}},{key:"runPopUpAnimation",value:function(){this.screen.container||console.warn("GetCoinScreen: screen not found")}},{key:"updateCoinQuantity",value:function(){var e=this.getQuantity();e&&this.updateQuantityLabel(e)}},{key:"updateQuantityLabel",value:function(e){this.quantityLabel.string=`x${e.toString()}`}},{key:"getQuantity",value:function(){if(!this.payload||!("screenData"in this.payload))return 0;var e=this.payload.screenData;return e&&"quantity"in e&&e.quantity&&"number"==typeof e.quantity?e.quantity:0}},{key:"handleAddCoin",value:function(){var e=this.getQuantity();this.node.scene.emit(pr.ADD_COINS,{coins:e,collectionAnimation:{animateTextOnly:!1}}),this.close()}},{key:"handleGetNowButtonClicked",value:(t=Ce(Se().mark((function e(){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return bi.stopAllSounds(),e.next=3,Tv.showRewardVideoAdAsync({});case 3:if(e.sent){e.next=6;break}return e.abrupt("return");case 6:this.handleAddCoin();case 7:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),i}(f)).prototype,"quantityLabel",[BN],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),qN=Xe(HN.prototype,"closeButtonComponent",[GN],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),WN=Xe(HN.prototype,"getNowButtonComponent",[zN],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),UN=HN))||UN);n._RF.pop(),n._RF.push({},"91e6dGDvN1FKLi7g/JQPwl8","ItemCollectionFX",void 0);var oF,sF,lF,uF,cF,hF,pF,dF,fF,vF,yF,mF,gF,bF,wF,kF,SF,EF,CF,TF,AF,xF,RF,IF,PF,_F=i.ccclass,LF=i.property,OF=(KN=_F("ItemCollectionFX"),jN=LF(A),YN=LF(N),XN=LF(re),KN((JN=Xe((QN=function(e){Ie(n,e);var t=Fe(n);function n(){var e;Te(this,n);for(var i=arguments.length,a=new Array(i),r=0;r<i;r++)a[r]=arguments[r];return Ye(e=t.call.apply(t,[this].concat(a)),"sprite",JN,Me(e)),Ye(e,"glowUIOpacity",ZN,Me(e)),Ye(e,"particles",eF,Me(e)),e}return xe(n,[{key:"__preload",value:function(){kt.lazyValidateProperties(this)}},{key:"playExplosionParticles",value:function(){this.particles.resetSystem()}}]),n}(f)).prototype,"sprite",[jN],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ZN=Xe(QN.prototype,"glowUIOpacity",[YN],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),eF=Xe(QN.prototype,"particles",[XN],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),$N=QN))||$N);n._RF.pop(),n._RF.push({},"f016fTAlsNKRYkdu72AyCLI","GetItemScreen",void 0);var DF,MF,NF,FF,BF,GF,zF,UF,HF,VF,qF,WF,KF,jF,YF,XF,$F,QF,JF,ZF,eB,tB,nB,iB,aB,rB,oB,sB,lB,uB,cB=i.ccclass,hB=i.property,pB=globalThis.game,dB=pB.event,fB=pB.player,vB=pB.analytics,yB=GameCore.Events;oF=cB("GetItemScreen"),sF=hB(I),lF=hB(A),uF=hB(A),cF=hB(A),hF=hB(A),pF=hB(u),dF=hB(u),fF=hB(u),vF=hB(p),yF=hB(p),mF=hB(p),oF((wF=Xe((bF=function(e){Ie(s,e);var t,n,i,a,r,o=Fe(s);function s(){var e;Te(this,s);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return Ye(e=o.call.apply(o,[this].concat(n)),"itemFxPrefab",wF,Me(e)),Ye(e,"hintSprite",kF,Me(e)),Ye(e,"stormSprite",SF,Me(e)),Ye(e,"pliersSprite",EF,Me(e)),Ye(e,"thunderSprite",CF,Me(e)),Ye(e,"titleLabel",TF,Me(e)),Ye(e,"descriptionLabel",AF,Me(e)),Ye(e,"coinLabel",xF,Me(e)),Ye(e,"closeButtonComponent",RF,Me(e)),Ye(e,"buyItemButtonComponent",IF,Me(e)),Ye(e,"getNowButtonComponent",PF,Me(e)),e.handleOpeningScreen=function(t){if(!e.screen)throw new Error("GetItemScreen: screen not found");if(e.validateEventPayload(t)){e.closeButtonComponent.interactable=!0,e.getNowButtonComponent.interactable=!0,e.buyItemButtonComponent.interactable=!0;var n=e.getItemType();n&&e.updateStatus(n)}},e.handleOpenedScreen=function(t){e.validateEventPayload(t)&&e.open()},e}return xe(s,[{key:"__preload",value:function(){this.enabled=!1,this.screen=this.getComponent(bM),this.validateRequiredComponents(),this.listenScreenEvents()}},{key:"onDestroy",value:function(){this.unListenScreenEvents()}},{key:"validateRequiredComponents",value:function(){kt.lazyValidateProperties(this)}},{key:"listenScreenEvents",value:function(){dB.on(yB.OPENING_SCREEN,this.handleOpeningScreen),dB.on(yB.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"unListenScreenEvents",value:function(){dB.off(yB.OPENING_SCREEN,this.handleOpeningScreen),dB.off(yB.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"validateEventPayload",value:function(e){return(null!=e?e:{}).screenName===this.node.name&&(this.payload=e,!0)}},{key:"open",value:function(){this.node.scene.emit(pr.GAME_PAUSE)}},{key:"close",value:function(){this.closeButtonComponent.interactable=!1,this.buyItemButtonComponent.interactable=!1,this.getNowButtonComponent.interactable=!1,dB.emit(yB.CLOSE_SCREEN,{screenName:this.node.name}),this.node.scene.emit(pr.GAME_RESUME)}},{key:"updateStatus",value:function(e){this.updateItemIcon(e),this.updateTitle(e),this.updateDescription(),this.updateButtons(e)}},{key:"updateItemIcon",value:function(e){switch([this.hintSprite,this.stormSprite,this.thunderSprite,this.pliersSprite].forEach((function(e){e.node.active=!1})),e){case Ms.HINT:this.activeIcon=this.hintSprite;break;case Ms.STORM:this.activeIcon=this.stormSprite;break;case Ms.THUNDER:this.activeIcon=this.thunderSprite;break;case Ms.PLIERS:this.activeIcon=this.pliersSprite}this.activeIcon.node.active=!0}},{key:"updateTitle",value:function(e){var t=e.charAt(0).toUpperCase()+e.slice(1);this.titleLabel.string=t}},{key:"updateDescription",value:function(){var e,t=null===(e=this.payload.screenData)||void 0===e?void 0:e.message;t&&(this.descriptionLabel.string=t)}},{key:"updateButtons",value:function(e){var t=this.canBuyItem(e);this.buyItemButtonComponent.node.active=t,this.getNowButtonComponent.node.active=!t,t&&(this.coinLabel.string=""+3*Gs[e])}},{key:"canBuyItem",value:function(e){var t=fB.getGameData();return!!t&&t.coins>=3*Gs[e]}},{key:"getItemType",value:function(){var e=this.payload.screenData;return e&&e.item&&-1!==Object.values(Ms).indexOf(e.item)?e.item:null}},{key:"handleAddItem",value:(r=Ce(Se().mark((function e(){var t,n=this;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.getItemType()){e.next=3;break}return e.abrupt("return");case 3:vB.event(GameCore.Plugins.Analytics.Events.EARN_ITEM,{item_name:t,value:3}),this.node.scene.emit(pr.ADD_ITEM,{animate:function(){return n.animateAddItem(t)},item:t,quantity:3});case 6:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"animateAddItem",value:(a=Ce(Se().mark((function e(t){var n,i,a,r,o,s,l;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.activeIcon.spriteFrame,i=this.createItemCollectionNode(n),a=He(i,2),r=a[0],o=a[1],s=this.getItemButtonWorldPosition(t),l=new Y(.5,.5,.5),o.glowUIOpacity.opacity=150,e.next=7,this.playScaleUpItemAnim(r,o);case 7:return e.next=9,vn.runTweenAsync(S(o.glowUIOpacity).to(.8,{opacity:0},{easing:"cubicIn"}));case 9:return e.next=11,this.playMoveCloseToItemButtonAnim(r,s,l);case 11:return e.next=13,this.playJumpAnim(r,l,s);case 13:bi.playSound("sounds/clicks"),r.destroy();case 15:case"end":return e.stop()}}),e,this)}))),function(e){return a.apply(this,arguments)})},{key:"playJumpAnim",value:(i=Ce(Se().mark((function e(t,n,i){var a,r;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=i.clone().add3f(0,70,0),r=n.clone().multiplyScalar(1.3),e.next=4,Promise.all([vn.runTweenAsync(S(t).to(.3,{worldPosition:a},{easing:"cubicOut"})),vn.runTweenAsync(S(t).to(.3,{scale:r},{easing:"cubicOut"}))]);case 4:return e.next=6,vn.runTweenAsync(S(t).to(.5,{worldPosition:i},{easing:"cubicIn"}));case 6:case"end":return e.stop()}}),e)}))),function(e,t,n){return i.apply(this,arguments)})},{key:"playMoveCloseToItemButtonAnim",value:function(e,t,n){var i=t.clone().add3f(0,30,0);return vn.runTweenAsync(S(e).to(1,{worldPosition:i,scale:n},{easing:"cubicInOut"}))}},{key:"createItemCollectionNode",value:function(e){var t=l(this.itemFxPrefab),n=t.getComponent(OF);return t.setParent(this.node.parent),n.sprite.spriteFrame=e,t.setWorldPosition(this.activeIcon.node.worldPosition.clone()),[t,n]}},{key:"playScaleUpItemAnim",value:function(e,t){return e.setScale(Y.ZERO),vn.runTweenAsync(S(e).delay(.2).call((function(){t.playExplosionParticles(),bi.playSound("sounds/item_reward")})).to(.1,{scale:new Y(.8,1.2,1)}).to(.1,{scale:new Y(1.2,.8,1)}).to(.1,{scale:new Y(1,1,1)}))}},{key:"getItemButtonWorldPosition",value:function(e){return this.getItemButton(e).worldPosition.clone()}},{key:"handleGetNowButtonClicked",value:(n=Ce(Se().mark((function e(){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.stopAllSounds(),e.next=3,Tv.showRewardVideoAdAsync({});case 3:if(e.sent){e.next=6;break}return e.abrupt("return");case 6:this.handleAddItem(),this.close();case 8:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"handleBuyItemButtonClicked",value:(t=Ce(Se().mark((function e(){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.node.scene.emit(pr.REMOVE_COINS,{coins:3*Gs[this.getItemType()],collectionAnimation:{animateTextOnly:!0}}),this.handleAddItem(),this.close();case 3:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"stopAllSounds",value:function(){var e;null===(e=R("Sound"))||void 0===e||null===(e=e.getComponent(jt))||void 0===e||e.stopAll()}},{key:"getItemButton",value:function(e){switch(e){case Ms.HINT:return R("Canvas/UI/Footer/HintItemButton");case Ms.STORM:return R("Canvas/UI/Footer/StormItemButton");case Ms.THUNDER:return R("Canvas/UI/Footer/ThunderItemButton");case Ms.PLIERS:return R("Canvas/UI/Footer/PliersItemButton")}}}]),s}(f)).prototype,"itemFxPrefab",[sF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),kF=Xe(bF.prototype,"hintSprite",[lF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),SF=Xe(bF.prototype,"stormSprite",[uF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),EF=Xe(bF.prototype,"pliersSprite",[cF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),CF=Xe(bF.prototype,"thunderSprite",[hF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),TF=Xe(bF.prototype,"titleLabel",[pF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),AF=Xe(bF.prototype,"descriptionLabel",[dF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),xF=Xe(bF.prototype,"coinLabel",[fF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),RF=Xe(bF.prototype,"closeButtonComponent",[vF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),IF=Xe(bF.prototype,"buyItemButtonComponent",[yF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),PF=Xe(bF.prototype,"getNowButtonComponent",[mF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),gF=bF));n._RF.pop(),n._RF.push({},"31829DUddVEq6NgIYHvnI68","LevelCompleteScreen",void 0);var mB,gB=i.ccclass,bB=i.property,wB=i.requireComponent,kB=GameCore,SB=kB.Events,EB=kB.Utils,CB=globalThis.game,TB=CB.event,AB=CB.player,xB="Coin Container";DF=gB("LevelCompleteScreen"),MF=wB(bM),NF=bB(cS),FF=bB(a),BF=bB(u),GF=bB(a),zF=bB(a),UF=bB(p),HF=bB(a),VF=bB(y),qF=bB(a),WF=bB({type:y,group:xB}),KF=bB({type:_,group:xB}),jF=bB({type:_,group:xB}),YF=bB(Yw),DF(XF=MF((QF=Xe(($F=function(e){Ie(o,e);var t,n,i,a,r=Fe(o);function o(){var e;Te(this,o);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return(e=r.call.apply(r,[this].concat(n))).levelId=1,e.coins=40,e.currentCoin=0,Ye(e,"coinContainer",QF,Me(e)),Ye(e,"playButton",JF,Me(e)),Ye(e,"coinText",ZF,Me(e)),Ye(e,"levelText",eB,Me(e)),Ye(e,"nextLevelText",tB,Me(e)),Ye(e,"playButtonComponent",nB,Me(e)),Ye(e,"wellDoneText",iB,Me(e)),Ye(e,"coinAnimation",aB,Me(e)),Ye(e,"playButtonContainer",rB,Me(e)),Ye(e,"coinContainerAnimation",oB,Me(e)),Ye(e,"coinContainerEnterClip",sB,Me(e)),Ye(e,"coinContainerExitClip",lB,Me(e)),Ye(e,"paperConfetti",uB,Me(e)),e.handleOpeningScreen=function(t){if(!e.screen)throw new Error("StarChestScreen: screen not found");e.validateEventPayload(t)&&(e.playButtonComponent.interactable=!0)},e.handleOpenedScreen=function(t){e.validateEventPayload(t)&&e.open()},e}return xe(o,[{key:"__preload",value:function(){this.enabled=!1,this.screen=this.getComponent(bM),this.validateRequiredComponents(),this.listenScreenEvents()}},{key:"onLoad",value:function(){var e=this,t=this.screen.open;this.screen.open=function(n){e.overrideOpenHandler(t,n)}}},{key:"onDestroy",value:function(){this.unListenScreenEvents()}},{key:"validateRequiredComponents",value:function(){kt.lazyValidateProperties(this)}},{key:"listenScreenEvents",value:function(){TB.on(SB.OPENING_SCREEN,this.handleOpeningScreen),TB.on(SB.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"unListenScreenEvents",value:function(){TB.off(SB.OPENING_SCREEN,this.handleOpeningScreen),TB.off(SB.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"validateEventPayload",value:function(e){var t=null!=e?e:{},n=t.screenName,i=t.screenData;return n===this.node.name&&(!!EB.Valid.isObject(i)&&(EB.Valid.isNumber(i.level)&&(this.levelId=i.level,this.coins=this.levelId<5?Ns:Fs),EB.Valid.isNumber(i.currentCoin)&&(this.currentCoin=i.currentCoin),!0))}},{key:"open",value:function(){this.updateComponents(),this.node.scene.emit(pr.HIDE_UI)}},{key:"close",value:(a=Ce(Se().mark((function e(){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,vn.runAnimationAsync(this.coinContainerAnimation,this.coinContainerExitClip.name);case 2:return TB.emit(SB.CLOSE_SCREEN,{screenName:this.node.name}),e.next=5,Tv.showInterstitialAdAsync({forLevel:this.screen.data.level});case 5:this.handleNextLevel();case 6:case"end":return e.stop()}}),e,this)}))),function(){return a.apply(this,arguments)})},{key:"overrideOpenHandler",value:(i=Ce(Se().mark((function e(t,n){var i,a=this;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.screen.setScreenOpacity(255),this.coinText.string="x0",this.playButtonComponent.interactable=!1,this.paperConfetti.runEffect(),e.next=6,this.animateWellDoneText();case 6:this.playButtonContainer.setScale(0,0,this.playButtonContainer.scale.z),t.call(this.screen,n),null===(i=this.screen.getComponent(y))||void 0===i||i.once(y.EventType.FINISHED,(function(){a.animateCoin()}));case 9:case"end":return e.stop()}}),e,this)}))),function(e,t){return i.apply(this,arguments)})},{key:"handleNextLevel",value:function(){var e=this.screen.data.level;if(e){var t=AB.getGameData();if(t)e>=t.totalLevel?this.node.scene.emit(pr.MAX_LEVEL):this.node.scene.emit(pr.NEXT_LEVEL);else console.warn("LevelCompleteScreen: gameData not found")}else console.warn("LevelCompleteScreen: level not found")}},{key:"updateComponents",value:function(){this.updateLevelText(),this.updateCoinContainer()}},{key:"updateCoinContainer",value:function(){this.coinContainer.updateCoins({coins:this.currentCoin})}},{key:"updateLevelText",value:function(){var e=AB.getGameData();if(e){this.levelText.getComponent(u).string=`Level ${this.levelId}`,console.log("LevelCompleteScreen: updateLevelText",this.levelId);var t=this.levelId+1>e.totalLevel?"Complete":`Level ${this.levelId+1}`;this.nextLevelText.getComponent(u).string=t}else console.warn("LevelCompleteScreen: gameData not found")}},{key:"updateCoinString",value:function(){this.coinText.string=`x${this.coins}`,console.log("LevelCompleteScreen: updateCoinString",this.coins)}},{key:"animateCoin",value:(n=Ce(Se().mark((function e(){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.screen.container){e.next=3;break}return console.warn("LevelCompleteScreen: screen not found"),e.abrupt("return");case 3:return this.coinAnimation.play(),e.next=6,this.animateCoinText({contentFn:function(e){return`x${e}`},currentQuantity:0,targetQuantity:this.coins});case 6:return e.next=8,this.animateCoinCollection();case 8:return e.next=10,vn.runTweenAsync(this.showPlayButton());case 10:this.updateCoinString();case 11:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"animateCoinCollection",value:(t=Ce(Se().mark((function e(){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,vn.runAnimationAsync(this.coinContainerAnimation,this.coinContainerEnterClip.name);case 2:this.node.scene.emit(pr.ADD_COINS,{coins:this.coins,collectionAnimation:{animateTextOnly:!1,target:this.coinContainer}});case 3:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"showPlayButton",value:function(){var e=this;return S(this.playButtonContainer).call((function(){e.playButtonContainer.setScale(0,0,e.playButtonContainer.scale.z)})).to(.5,{scale:new Y(1,1,1)},{easing:"backOut"}).call((function(){e.playButtonComponent.interactable=!0}))}},{key:"handleClickedPlay",value:function(){this.playButtonComponent.interactable=!1,this.close()}},{key:"animateWellDoneText",value:function(){var e=this,t=this.wellDoneText.position.clone(),n=S(this.wellDoneText).call((function(){e.wellDoneText.setPosition(0,0,e.wellDoneText.position.z),e.wellDoneText.setScale(0,0,e.wellDoneText.scale.z)})).to(.5,{scale:new Y(1.5,1.5,1)},{easing:"cubicOut"}).to(.5,{scale:new Y(1,1,1)},{easing:"backOut"}).to(.5,{position:t},{easing:"backOut"});return vn.runTweenAsync(n)}},{key:"animateCoinText",value:function(e){var t=this,n=e.contentFn,i=e.currentQuantity,a=e.targetQuantity,r=e.duration,o=void 0===r?.8:r,s=S({currentQuantity:i}).to(o,{currentQuantity:a},{easing:"linear",onUpdate:function(e){if(e){var i=e.currentQuantity,a=Math.floor(i);t.coinText.string=n(a)}}});return vn.runTweenAsync(s)}}]),o}(f)).prototype,"coinContainer",[NF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),JF=Xe($F.prototype,"playButton",[FF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ZF=Xe($F.prototype,"coinText",[BF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),eB=Xe($F.prototype,"levelText",[GF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),tB=Xe($F.prototype,"nextLevelText",[zF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),nB=Xe($F.prototype,"playButtonComponent",[UF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),iB=Xe($F.prototype,"wellDoneText",[HF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),aB=Xe($F.prototype,"coinAnimation",[VF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),rB=Xe($F.prototype,"playButtonContainer",[qF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),oB=Xe($F.prototype,"coinContainerAnimation",[WF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),sB=Xe($F.prototype,"coinContainerEnterClip",[KF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),lB=Xe($F.prototype,"coinContainerExitClip",[jF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),uB=Xe($F.prototype,"paperConfetti",[YF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),XF=$F))||XF);n._RF.pop(),n._RF.push({},"61985gSEDBMY6nVNc9Q1D6W","LoadingScreen",void 0);var RB,IB,PB,_B,LB,OB,DB,MB,NB=i.ccclass,FB=i.disallowMultiple,BB=i.requireComponent,GB=GameCore.Events,zB=globalThis.game.event;NB("LoadingScreen")(mB=FB(mB=BB(bM)(mB=function(e){Ie(n,e);var t=Fe(n);function n(){var e;Te(this,n);for(var i=arguments.length,a=new Array(i),r=0;r<i;r++)a[r]=arguments[r];return(e=t.call.apply(t,[this].concat(a))).handleOpeningScreen=function(t){e.validateEventPayload(t)&&(e.enabled=!0)},e.handleOpenedScreen=function(t){e.validateEventPayload(t)&&e.open()},e.handleClosingScreen=function(t){e.validateEventPayload(t)&&e.unscheduleAllCallbacks()},e.handleClosedScreen=function(t){e.validateEventPayload(t)&&(e.enabled=!1)},e.handleOnCloseScreen=function(){lu.closeScreen(vi[e.node.name])},e}return xe(n,[{key:"onLoad",value:function(){this.enabled=!1,this.screen=this.getComponent(bM),this.validateRequiredComponents(),this.listenScreenEvents()}},{key:"onDestroy",value:function(){this.unListenScreenEvents()}},{key:"validateRequiredComponents",value:function(){kt.lazyValidateProperties(this)}},{key:"listenScreenEvents",value:function(){zB.on(GB.OPENING_SCREEN,this.handleOpeningScreen),zB.on(GB.OPENED_SCREEN,this.handleOpenedScreen),zB.on(GB.CLOSING_SCREEN,this.handleClosingScreen),zB.on(GB.CLOSED_SCREEN,this.handleClosedScreen)}},{key:"unListenScreenEvents",value:function(){zB.off(GB.OPENING_SCREEN,this.handleOpeningScreen),zB.off(GB.OPENED_SCREEN,this.handleOpenedScreen),zB.off(GB.CLOSING_SCREEN,this.handleClosingScreen),zB.off(GB.CLOSED_SCREEN,this.handleClosedScreen)}},{key:"validateEventPayload",value:function(e){return e.screenName===this.node.name}},{key:"open",value:function(){if(this.enabled){var e=this.screen.data.duration;e&&e>0&&this.scheduleOnce(this.handleOnCloseScreen,e)}}}]),n}(f))||mB)||mB);n._RF.pop(),n._RF.push({},"6460akNFfhP9pDOT2Z0+s2R","NotificationScreen",void 0);var UB,HB,VB,qB,WB,KB,jB,YB,XB=i.ccclass,$B=i.disallowMultiple,QB=i.requireComponent,JB=i.property,ZB=GameCore,eG=ZB.Events,tG=ZB.Utils,nG=globalThis.game.event;RB=XB("NotificationScreen"),IB=QB(bM),PB=JB(u),_B=JB(p),RB(LB=$B(LB=IB((DB=Xe((OB=function(e){Ie(n,e);var t=Fe(n);function n(){var e;Te(this,n);for(var i=arguments.length,a=new Array(i),r=0;r<i;r++)a[r]=arguments[r];return Ye(e=t.call.apply(t,[this].concat(a)),"message",DB,Me(e)),Ye(e,"touchZone",MB,Me(e)),e.enableCloseOnTouch=!0,e.handleOpeningScreen=function(t){e.validateEventPayload(t)&&e.updateScreenData(t)},e.handleClosingScreen=function(t){e.validateEventPayload(t)&&e.unscheduleAllCallbacks()},e}return xe(n,[{key:"__preload",value:function(){this.listenScreenEvents()}},{key:"onDestroy",value:function(){this.unListenScreenEvents()}},{key:"onLoad",value:function(){this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){kt.lazyValidateProperties(this)}},{key:"listenScreenEvents",value:function(){nG.on(eG.OPENING_SCREEN,this.handleOpeningScreen),nG.on(eG.CLOSING_SCREEN,this.handleClosingScreen)}},{key:"unListenScreenEvents",value:function(){nG.off(eG.OPENING_SCREEN,this.handleOpeningScreen),nG.off(eG.CLOSING_SCREEN,this.handleClosingScreen)}},{key:"validateEventPayload",value:function(e){return e.screenName===this.node.name}},{key:"updateScreenData",value:function(e){var t=this,n=e.screenData;tG.Valid.isObject(n)?(n.message&&(this.message.string=n.message),n.duration&&n.duration>0&&this.scheduleOnce((function(){lu.closeScreen(vi[t.node.name])}),n.duration),!1===n.enableCloseOnTouch?this.enableCloseOnTouch=!1:this.enableCloseOnTouch=!0):console.warn("NotificationScreen: screenData not found")}},{key:"handleClickedClose",value:function(){this.unscheduleAllCallbacks(),lu.closeScreen(vi[this.node.name])}},{key:"closeOnTouch",value:function(){this.enableCloseOnTouch&&this.handleClickedClose()}}]),n}(f)).prototype,"message",[PB],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),MB=Xe(OB.prototype,"touchZone",[_B],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),LB=OB))||LB)||LB);n._RF.pop(),n._RF.push({},"7129ca71jRMGaTHxWhEL4F4","QuitLevelScreen",void 0);var iG,aG,rG,oG,sG,lG,uG,cG,hG,pG,dG,fG,vG,yG,mG,gG,bG,wG,kG,SG,EG,CG,TG=i.ccclass,AG=i.property,xG=i.requireComponent,RG=GameCore.Events,IG=globalThis.game.event;UB=TG("QuitLevelScreen"),HB=xG(bM),VB=AG(p),qB=AG(p),UB(WB=HB((jB=Xe((KB=function(e){Ie(n,e);var t=Fe(n);function n(){var e;Te(this,n);for(var i=arguments.length,a=new Array(i),r=0;r<i;r++)a[r]=arguments[r];return Ye(e=t.call.apply(t,[this].concat(a)),"noButton",jB,Me(e)),Ye(e,"yesButton",YB,Me(e)),e.handleOpeningScreen=function(t){e.validateEventPayload(t)&&(e.noButton.interactable=!0,e.yesButton.interactable=!0)},e.handleOpenedScreen=function(t){e.validateEventPayload(t)&&e.open()},e}return xe(n,[{key:"__preload",value:function(){this.enabled=!1,this.screen=this.getComponent(bM),this.validateRequiredComponents(),this.listenScreenEvents()}},{key:"onDestroy",value:function(){this.unListenScreenEvents()}},{key:"validateRequiredComponents",value:function(){kt.lazyValidateProperties(this)}},{key:"listenScreenEvents",value:function(){IG.on(RG.OPENING_SCREEN,this.handleOpeningScreen),IG.on(RG.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"unListenScreenEvents",value:function(){IG.off(RG.OPENING_SCREEN,this.handleOpeningScreen),IG.off(RG.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"validateEventPayload",value:function(e){return(null!=e?e:{}).screenName===this.node.name}},{key:"open",value:function(){this.runPopUpAnimation(),this.node.scene.emit(pr.HIDE_UI)}},{key:"close",value:function(){this.noButton.interactable=!1,this.yesButton.interactable=!1,lu.closeScreen(vi[this.node.name]),this.node.scene.emit(pr.SHOW_UI),this.node.scene.emit(pr.GAME_RESUME)}},{key:"runPopUpAnimation",value:function(){this.screen.container||console.warn("StartLevelScreen: screen not found")}},{key:"handleClickedNo",value:function(){this.close()}},{key:"handleClickedYes",value:function(){this.node.scene.emit(pr.GAME_EXIT)}}]),n}(f)).prototype,"noButton",[VB],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),YB=Xe(KB.prototype,"yesButton",[qB],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),WB=KB))||WB);n._RF.pop(),n._RF.push({},"85907Tnp/NBq7myeciP/4h3","RescuesScreen",void 0);var PG,_G,LG,OG,DG,MG,NG,FG,BG,GG,zG,UG,HG,VG,qG,WG,KG,jG,YG,XG,$G,QG,JG,ZG,ez,tz,nz=i.ccclass,iz=i.property,az=i.disallowMultiple,rz=i.requireComponent,oz=GameCore.Events,sz=globalThis.game,lz=sz.event,uz=sz.player;iG=nz("RescuesScreen"),aG=rz(bM),rG=iz(N),oG=iz([a]),sG=iz(u),lG=iz(u),uG=iz(a),cG=iz(a),hG=iz(y),pG=iz(a),dG=iz(a),iG(fG=az(fG=aG((yG=Xe((vG=function(e){Ie(s,e);var t,n,i,a,r,o=Fe(s);function s(){var e;Te(this,s);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return Ye(e=o.call.apply(o,[this].concat(n)),"adOpacity",yG,Me(e)),Ye(e,"animNodes",mG,Me(e)),Ye(e,"titleLabel",gG,Me(e)),Ye(e,"descriptionLabel",bG,Me(e)),Ye(e,"timer",wG,Me(e)),Ye(e,"bomb",kG,Me(e)),Ye(e,"bombAnim",SG,Me(e)),Ye(e,"replayButton",EG,Me(e)),Ye(e,"buyTimeButton",CG,Me(e)),e.handleOpeningScreen=function(t){if(!e.screen)throw new Error("RescuesScreen: screen not found");e.validateEventPayload(t)},e.handleOpenedScreen=function(t){e.validateEventPayload(t)&&e.open()},e}return xe(s,[{key:"__preload",value:function(){this.enabled=!1,this.screen=this.getComponent(bM),this.validateRequiredComponents(),this.listenScreenEvents()}},{key:"onDestroy",value:function(){this.unListenScreenEvents()}},{key:"validateRequiredComponents",value:function(){kt.lazyValidateProperties(this)}},{key:"listenScreenEvents",value:function(){lz.on(oz.OPENING_SCREEN,this.handleOpeningScreen),lz.on(oz.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"unListenScreenEvents",value:function(){lz.off(oz.OPENING_SCREEN,this.handleOpeningScreen),lz.off(oz.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"validateEventPayload",value:function(e){return e.screenName===this.node.name&&(this.payload=e,!0)}},{key:"open",value:(r=Ce(Se().mark((function e(){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.resetState();case 2:this.runOpenAnimation(),this.node.scene.emit(pr.HIDE_UI);case 4:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"close",value:function(){lz.emit(oz.CLOSE_SCREEN,{screenName:this.node.name})}},{key:"resetState",value:(a=Ce(Se().mark((function e(){var t,n,i,a;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=(null===(t=this.payload.screenData)||void 0===t?void 0:t.failKey)===gu,this.titleLabel.string=n?"Boom!":"Time's Up!",this.descriptionLabel.string=n?"The bomb exploded!":"Restart or add 2 minutes?",this.timer.active=!n,this.bomb.active=n,n&&this.bombAnim.play(),i=uz.getGameData()){e.next=9;break}return e.abrupt("return");case 9:a=i.coins>=zs,this.replayButton.active=!a,this.buyTimeButton.active=a,this.adOpacity.opacity=0;case 13:case"end":return e.stop()}}),e,this)}))),function(){return a.apply(this,arguments)})},{key:"runOpenAnimation",value:(i=Ce(Se().mark((function e(){var t=this;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.screen.container){e.next=3;break}return console.warn("TimeUpScreen: screen not found"),e.abrupt("return");case 3:return e.next=5,Promise.all(this.animNodes.map((function(e,n){t.runAppearTween(e,.1*n)})));case 5:return e.next=7,this.runShowAdContainer();case 7:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"runAppearTween",value:(n=Ce(Se().mark((function e(t,n){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,vn.runTweenAsync(S(t).set({scale:new Y(0,0,0)}).delay(n).to(1,{scale:new Y(1,1,1)},{progress:function(e,t,n,i){return e+(t-e)*vn.elasticOut(i,.1,.45)}}));case 2:case"end":return e.stop()}}),e)}))),function(e,t){return n.apply(this,arguments)})},{key:"runShowAdContainer",value:function(){var e=S(this.adOpacity);return e.delay(1),e.to(.5,{opacity:255}),vn.runTweenAsync(e)}},{key:"handleClickReplayButton",value:function(){this.close(),this.node.scene.emit(pr.GAME_REPLAY,{level:this.screen.data.level})}},{key:"handleClickBuyTimeButton",value:function(){this.node.scene.emit(pr.REMOVE_COINS,{coins:zs,collectionAnimation:{animateTextOnly:!0}}),this.startRescue()}},{key:"handleClickAdButton",value:(t=Ce(Se().mark((function e(){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Tv.showRewardVideoAdAsync({});case 2:if(e.sent){e.next=5;break}return e.abrupt("return");case 5:this.startRescue();case 6:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"startRescue",value:function(){this.node.scene.emit(pr.SHOW_UI),this.node.scene.emit(pr.RESCUE_START),this.close()}}]),s}(f)).prototype,"adOpacity",[rG],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),mG=Xe(vG.prototype,"animNodes",[oG],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),gG=Xe(vG.prototype,"titleLabel",[sG],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),bG=Xe(vG.prototype,"descriptionLabel",[lG],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wG=Xe(vG.prototype,"timer",[uG],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),kG=Xe(vG.prototype,"bomb",[cG],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),SG=Xe(vG.prototype,"bombAnim",[hG],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),EG=Xe(vG.prototype,"replayButton",[pG],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),CG=Xe(vG.prototype,"buyTimeButton",[dG],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),fG=vG))||fG)||fG);n._RF.pop(),n._RF.push({},"61932YLC/5CFrE0eD0ez8Zg","SettingsScreen",void 0);var cz,hz,pz,dz,fz,vz,yz,mz,gz,bz,wz,kz,Sz,Ez,Cz,Tz,Az,xz,Rz,Iz,Pz,_z,Lz,Oz=i.ccclass,Dz=i.property,Mz=i.requireComponent,Nz=GameCore,Fz=Nz.Events,Bz=Nz.Utils,Gz=globalThis.game,zz=Gz.player,Uz=Gz.event;PG=Oz("SettingsScreen"),_G=Mz(bM),LG=Dz(a),OG=Dz(a),DG=Dz(a),MG=Dz(zR),NG=Dz(zR),FG=Dz(zR),BG=Dz(p),GG=Dz(p),zG=Dz(p),UG=Dz(p),HG=Dz(a),PG(VG=_G((WG=Xe((qG=function(e){Ie(i,e);var t,n=Fe(i);function i(){var e;Te(this,i);for(var t=arguments.length,a=new Array(t),r=0;r<t;r++)a[r]=arguments[r];return Ye(e=n.call.apply(n,[this].concat(a)),"musicSetting",WG,Me(e)),Ye(e,"soundSetting",KG,Me(e)),Ye(e,"vibrateSetting",jG,Me(e)),Ye(e,"musicSwitch",YG,Me(e)),Ye(e,"soundSwitch",XG,Me(e)),Ye(e,"vibrateSwitch",$G,Me(e)),Ye(e,"closeButtonComponent",QG,Me(e)),Ye(e,"continueButtonComponent",JG,Me(e)),Ye(e,"restartButtonComponent",ZG,Me(e)),Ye(e,"inviteFriendsButtonComponent",ez,Me(e)),Ye(e,"animNodes",tz,Me(e)),e.triggerSequence="",e.handleOpeningScreen=function(t){e.validateSwitchScreenPayload(t)&&(e.closeButtonComponent.interactable=!0,e.continueButtonComponent.interactable=!0,e.restartButtonComponent.interactable=!0,e.inviteFriendsButtonComponent.interactable=!0,e.updateStatus())},e.handleOpenedScreen=function(t){e.validateSwitchScreenPayload(t)&&e.open()},e.handleResetSequence=function(){e.triggerSequence=""},e.handleTriggerUnlockKey=function(t){if("code"in t){var n=t.code,i=Ws.UNLOCK_SEQUENCE;"number"==typeof n&&-1!==i.indexOf(n.toString())&&(e.triggerSequence+=n.toString(),console.log("SettingsScreen: handleTriggerUnlockKey",n,e.triggerSequence,e.triggerSequence===i),e.triggerSequence===i&&(e.node.scene.emit(Ws.Events.UNLOCK_DEV_TOOLS),e.node.off(Ws.Events.TRIGGER_UNLOCK_KEY)))}},e.updateVibrateButton=function(){var t=e.vibrateSetting.getComponentInChildren(p),n=e.vibrateSetting.getComponentInChildren(zR),i=e.vibrateSetting.getComponentInChildren(da);if(t&&n&&i)if(Bz.Device.isMobile()){var a,r=null!==(a=zz.getPlayerSetting("vibrate"))&&void 0!==a&&a;n.setEnabled(r)}else t.interactable=!1,n.setEnabled(!1),i.changeState(!1);else console.warn("SettingsScreen: vibrate button missing components")},e}return xe(i,[{key:"onLoad",value:function(){this.enabled=!1,this.screen=this.getComponent(bM),this.validateRequiredComponents(),this.listenScreenEvents(),this.listenUnlockDevTools()}},{key:"onDestroy",value:function(){this.unListenScreenEvents(),this.unListenUnlockDevTools()}},{key:"validateRequiredComponents",value:function(){kt.lazyValidateProperties(this)}},{key:"listenScreenEvents",value:function(){Uz.on(Fz.OPENING_SCREEN,this.handleOpeningScreen),Uz.on(Fz.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"unListenScreenEvents",value:function(){Uz.off(Fz.OPENING_SCREEN,this.handleOpeningScreen),Uz.off(Fz.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"validateSwitchScreenPayload",value:function(e){return e.screenName===this.node.name}},{key:"listenUnlockDevTools",value:function(){this.node.off(Ws.Events.TRIGGER_UNLOCK_KEY),this.node.on(Ws.Events.TRIGGER_RESET_SEQUENCE,this.handleResetSequence),this.node.on(Ws.Events.TRIGGER_UNLOCK_KEY,this.handleTriggerUnlockKey)}},{key:"unListenUnlockDevTools",value:function(){this.node.off(Ws.Events.TRIGGER_RESET_SEQUENCE,this.handleResetSequence),this.node.off(Ws.Events.TRIGGER_UNLOCK_KEY,this.handleTriggerUnlockKey)}},{key:"open",value:function(){this.updateStatus(),this.runPopUpAnimation(),this.node.emit(Ws.Events.TRIGGER_RESET_SEQUENCE),this.node.scene.emit(pr.HIDE_UI)}},{key:"close",value:function(){this.closeButtonComponent.interactable=!1,this.continueButtonComponent.interactable=!1,this.restartButtonComponent.interactable=!1,this.inviteFriendsButtonComponent.interactable=!1,this.node.emit(Ws.Events.TRIGGER_RESET_SEQUENCE),lu.closeScreen(vi[this.node.name])}},{key:"updateStatus",value:function(){var e,t,n,i={music:null!==(e=zz.getPlayerSetting("music"))&&void 0!==e&&e,sound:null!==(t=zz.getPlayerSetting("sound"))&&void 0!==t&&t,vibrate:null!==(n=zz.getPlayerSetting("vibrate"))&&void 0!==n&&n};this.musicSwitch?this.soundSwitch?(this.musicSwitch.setEnabled(i.music),this.soundSwitch.setEnabled(i.sound),"GameDistributions"!==GameSDK.getSDKName()&&this.scheduleOnce(this.updateVibrateButton,.1)):console.warn("SettingsScreen: soundSwitch not found"):console.warn("SettingsScreen: musicSwitch not found")}},{key:"runPopUpAnimation",value:function(){var e=this;this.screen.container||console.warn("SettingsScreen: screen not found"),this.animNodes.forEach((function(t,n){e.runAppearTween(t,.1*n)}))}},{key:"runAppearTween",value:function(e,t){var n=S(e);n.set({scale:new Y(0,0,0)}),n.delay(t),n.to(1,{scale:new Y(1,1,1)},{progress:function(e,t,n,i){return e+(t-e)*vn.elasticOut(i,.1,.45)}}),n.start()}},{key:"switchMusicButton",value:function(){if(this.musicSwitch){var e=this.musicSwitch.switch();zz.setSetting("music",e),this.node.emit(Ws.Events.TRIGGER_UNLOCK_KEY,{code:e?1:0}),e?bi.playMusic():bi.pauseMusic()}else console.warn("SettingsScreen: musicSwitch not found")}},{key:"switchSoundButton",value:function(){if(this.soundSwitch){var e=this.soundSwitch.switch();zz.setSetting("sound",e),this.node.emit(Ws.Events.TRIGGER_UNLOCK_KEY,{code:e?3:2})}else console.warn("SettingsScreen: soundSwitch not found")}},{key:"switchVibrateButton",value:function(){if(this.vibrateSwitch){var e=this.vibrateSwitch.switch();zz.setSetting("vibrate",e)}else console.warn("SettingsScreen: vibrateSwitch not found")}},{key:"handleClickedResume",value:function(){this.resumeGame()}},{key:"handleClickedClose",value:function(){this.resumeGame()}},{key:"handleClickedReplayGame",value:function(){this.restartGame()}},{key:"handleClickedInviteFriends",value:(t=Ce(Se().mark((function e(){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.close(),this.node.scene.emit(pr.INVITE_FRIENDS);case 2:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"resumeGame",value:function(){this.close(),this.node.scene.emit(pr.GAME_RESUME),this.node.scene.emit(pr.SHOW_UI)}},{key:"restartGame",value:function(){var e;this.close(),this.node.scene.emit(pr.GAME_RESUME);var t=(null!==(e=zz.getGameData())&&void 0!==e?e:{}).level,n=void 0===t?1:t;this.node.scene.emit(pr.GAME_REPLAY,{level:n})}}]),i}(f)).prototype,"musicSetting",[LG],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),KG=Xe(qG.prototype,"soundSetting",[OG],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),jG=Xe(qG.prototype,"vibrateSetting",[DG],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),YG=Xe(qG.prototype,"musicSwitch",[MG],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),XG=Xe(qG.prototype,"soundSwitch",[NG],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),$G=Xe(qG.prototype,"vibrateSwitch",[FG],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),QG=Xe(qG.prototype,"closeButtonComponent",[BG],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),JG=Xe(qG.prototype,"continueButtonComponent",[GG],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ZG=Xe(qG.prototype,"restartButtonComponent",[zG],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ez=Xe(qG.prototype,"inviteFriendsButtonComponent",[UG],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),tz=Xe(qG.prototype,"animNodes",[HG],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),VG=qG))||VG);n._RF.pop(),n._RF.push({},"891d37NJ6lLdp3CNLPHxZ6d","StarChest",void 0);var Hz,Vz,qz,Wz,Kz,jz,Yz,Xz,$z,Qz,Jz,Zz,eU,tU,nU,iU,aU,rU,oU,sU,lU=i.ccclass,uU=i.property,cU=(cz=lU("StarChest"),hz=uU(A),pz=uU(N),dz=uU(re),fz=uU(N),vz=uU(N),yz=uU({type:E,readonly:!0,displayName:"Starting Offset X",group:"Reward Animations"}),mz=uU({type:E,readonly:!0,displayName:"Starting Offset Y",group:"Reward Animations"}),gz=uU({type:E,displayName:"Centered Offset X",group:"Reward Animations"}),bz=uU({type:E,displayName:"Centered Offset Y",group:"Reward Animations"}),wz=uU({type:E,min:0,displayName:"Starting Scale",group:"Reward Animations"}),kz=uU({type:E,min:0,displayName:"Ending Scale",group:"Reward Animations"}),cz((Cz=Xe((Ez=function(e){Ie(s,e);var t,n,i,a,r,o=Fe(s);function s(){var e;Te(this,s);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return Ye(e=o.call.apply(o,[this].concat(n)),"sprite",Cz,Me(e)),Ye(e,"glowOpacity",Tz,Me(e)),Ye(e,"explosionParticles",Az,Me(e)),Ye(e,"circle",xz,Me(e)),Ye(e,"uiOpacity",Rz,Me(e)),e.ogCenterX=0,e.ogCenterY=0,Ye(e,"endingOffsetX",Iz,Me(e)),Ye(e,"endingOffsetY",Pz,Me(e)),Ye(e,"startingScale",_z,Me(e)),Ye(e,"endingScale",Lz,Me(e)),e}return xe(s,[{key:"startingOffsetX",get:function(){return this.node.position.x}},{key:"startingOffsetY",get:function(){return this.node.position.y}},{key:"__preload",value:function(){this.validateRequiredComponents(),this.ogCenterX=this.startingOffsetX,this.ogCenterY=this.startingOffsetY}},{key:"validateRequiredComponents",value:function(){kt.lazyValidateProperties(this)}},{key:"moveToCenter",value:(r=Ce(Se().mark((function e(t){var n;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=new Y(this.endingOffsetX,this.endingOffsetY,this.node.position.z),e.next=3,vn.runTweenAsync(S(this.node).to(.7,{position:n},{easing:"quintInOut"}),t);case 3:this.node.position=n;case 4:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"respawnAtStartingState",value:function(){this.node.position=new Y(this.ogCenterX,this.ogCenterY,this.node.position.z),this.glowOpacity.opacity=0,this.sprite.node.setScale(this.startingScale,this.startingScale,this.startingScale),this.glowOpacity.node.setScale(this.startingScale,this.startingScale,this.startingScale),this.uiOpacity.opacity=255}},{key:"scale",value:(a=Ce(Se().mark((function e(t,n){var i,a;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=this.startingScale+(this.endingScale-this.startingScale)*t,a=new Y(i,i,i),e.next=4,Promise.all([vn.runTweenAsync(S(this.sprite.node).to(.2,{scale:a},{easing:"backOut"}),n),vn.runTweenAsync(S(this.glowOpacity.node).to(.2,{scale:a},{easing:"backOut"}),n)]);case 4:this.sprite.node.setScale(a),this.glowOpacity.node.setScale(a);case 6:case"end":return e.stop()}}),e,this)}))),function(e,t){return a.apply(this,arguments)})},{key:"startShaking",value:function(){var e=this,t=this.node.position.clone();this.shakingTween={ogPos:t,tw:S({}).to(.1,{},{onUpdate:function(n,i){if(i){var a=t.x+10*(i-.5);e.node.position=new Y(a,t.y,t.z)}}}).repeatForever().start()}}},{key:"stopShaking",value:function(){this.shakingTween&&(this.shakingTween.tw.stop(),this.node.position=this.shakingTween.ogPos,this.shakingTween=void 0)}},{key:"glow",value:(i=Ce(Se().mark((function e(t){var n;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.sprite.node.scale.clone().multiplyScalar(1.1),e.next=3,Promise.all([vn.runTweenAsync(S(this.sprite.node).to(.2,{scale:n},{easing:"cubicInOut"}),t),vn.runTweenAsync(S(this.glowOpacity.node).to(.2,{scale:n}),t),vn.runTweenAsync(S(this.glowOpacity).to(.5,{opacity:255}),t)]);case 3:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})},{key:"explode",value:(n=Ce(Se().mark((function e(t){var n,i,a,r=this;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=new Y(8,8,8),i=function(){var e=Ce(Se().mark((function e(){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r.circle.opacity=255,r.circle.node.setScale(Y.ZERO),e.next=4,Promise.all([vn.runTweenAsync(S(r.circle).to(.3,{opacity:0}),t),vn.runTweenAsync(S(r.circle.node).to(.3,{scale:n},{easing:"cubicOut"}),t)]);case 4:r.circle.opacity=0,r.circle.node.scale=n;case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),a=function(){var e=Ce(Se().mark((function e(){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all([vn.runTweenAsync(S(r.glowOpacity.node).to(.3,{scale:Y.ZERO},{easing:"cubicOut"}),t),vn.runTweenAsync(S(r.sprite.node).to(.3,{scale:Y.ZERO},{easing:"cubicOut"}),t)]);case 2:r.sprite.node.setScale(Y.ZERO),r.glowOpacity.node.setScale(Y.ZERO);case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),e.next=5,Promise.all([this.explodeParticles(t),i(),a()]);case 5:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"explodeParticles",value:(t=Ce(Se().mark((function e(t){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.aborted){e.next=2;break}return e.abrupt("return");case 2:return this.explosionParticles.node.active=!0,this.explosionParticles.resetSystem(),e.next=6,vn.waitTweenAsync(1);case 6:this.explosionParticles.node.active=!1;case 7:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})}]),s}(f)).prototype,"sprite",[hz],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Tz=Xe(Ez.prototype,"glowOpacity",[pz],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Az=Xe(Ez.prototype,"explosionParticles",[dz],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),xz=Xe(Ez.prototype,"circle",[fz],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Rz=Xe(Ez.prototype,"uiOpacity",[vz],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Xe(Ez.prototype,"startingOffsetX",[yz],Object.getOwnPropertyDescriptor(Ez.prototype,"startingOffsetX"),Ez.prototype),Xe(Ez.prototype,"startingOffsetY",[mz],Object.getOwnPropertyDescriptor(Ez.prototype,"startingOffsetY"),Ez.prototype),Iz=Xe(Ez.prototype,"endingOffsetX",[gz],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Pz=Xe(Ez.prototype,"endingOffsetY",[bz],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),_z=Xe(Ez.prototype,"startingScale",[wz],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.5}}),Lz=Xe(Ez.prototype,"endingScale",[kz],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),Sz=Ez))||Sz);n._RF.pop(),n._RF.push({},"e414bczbutHJKcOfhl1sc4p","StarChestScreen",void 0);var hU,pU,dU,fU,vU,yU,mU,gU,bU,wU,kU,SU,EU,CU,TU=i.ccclass,AU=i.property,xU=i.requireComponent,RU=GameCore.Events,IU=globalThis.game,PU=IU.event,_U=IU.player;Hz=TU("StarChestScreen"),Vz=xU(bM),qz=AU(cT),Wz=AU(u),Kz=AU(p),jz=AU(y),Yz=AU(cU),Xz=AU(N),$z=AU(Vk),Qz=AU(u),Hz(Jz=Vz((eU=Xe((Zz=function(e){Ie(o,e);var t,n,i,a,r=Fe(o);function o(){var e;Te(this,o);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return Ye(e=r.call.apply(r,[this].concat(n)),"starProgressBar",eU,Me(e)),Ye(e,"buttonLabel",tU,Me(e)),Ye(e,"button",nU,Me(e)),Ye(e,"chestAnimation",iU,Me(e)),Ye(e,"starChest",aU,Me(e)),Ye(e,"chestUnlockFXMask",rU,Me(e)),Ye(e,"skipOverlay",oU,Me(e)),Ye(e,"messageLabel",sU,Me(e)),e.handleOpeningScreen=function(t){if(!e.screen)throw new Error("StarChestScreen: screen not found");e.validateEventPayload(t)},e.handleOpenedScreen=function(t){e.validateEventPayload(t)&&e.open()},e}return xe(o,[{key:"__preload",value:function(){this.enabled=!1,this.screen=this.getComponent(bM),this.validateRequiredComponents(),this.listenScreenEvents()}},{key:"onDestroy",value:function(){this.unListenScreenEvents()}},{key:"validateRequiredComponents",value:function(){kt.lazyValidateProperties(this)}},{key:"listenScreenEvents",value:function(){PU.on(RU.OPENING_SCREEN,this.handleOpeningScreen),PU.on(RU.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"unListenScreenEvents",value:function(){PU.off(RU.OPENING_SCREEN,this.handleOpeningScreen),PU.off(RU.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"validateEventPayload",value:function(e){return(null!=e?e:{}).screenName===this.node.name}},{key:"open",value:function(){this.runPopUpAnimation(),this.node.scene.emit(pr.HIDE_UI);var e=_U.getGameData();if(e){var t=e.stars;this.numChestAvailable=Math.floor(t/20),this.starProgressBar.setRange(t,20),this.buttonLabel.string=this.numChestAvailable?"Open":"Continue",this.messageLabel.string=this.numChestAvailable?"Congrats, you have enough stars to open the chest!":"Win more stars to open!",this.button.interactable=!0,this.numChestAvailable?this.chestAnimation.play():this.chestAnimation.stop(),this.chestUnlockFXMask.node.active=!1,this.chestUnlockFXMask.opacity=0,this.starChest.respawnAtStartingState()}}},{key:"close",value:function(){PU.emit(RU.CLOSE_SCREEN,{screenName:this.node.name}),this.node.scene.emit(pr.SHOW_UI)}},{key:"runPopUpAnimation",value:function(){this.screen.container||console.warn("StarChestScreen: screen not found")}},{key:"handleClickButton",value:(a=Ce(Se().mark((function e(){var t,n,i;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==this.numChestAvailable){e.next=3;break}return this.close(),e.abrupt("return");case 3:if(bi.turnDownMusic(),t=_U.getGameData()){e.next=7;break}return e.abrupt("return");case 7:return this.button.interactable=!1,n=t.stars,_U.setGameData({stars:t.stars-20*this.numChestAvailable}),i=new On,e.next=13,this.skipOverlay.open({opacity:200,onSkip:function(){return i.abort()}});case 13:return e.next=15,this.handleUnlockAnimation(n,t.stars,i);case 15:return e.next=17,this.skipOverlay.close();case 17:bi.turnUpMusic(),W.emit(xn),this.close();case 20:case"end":return e.stop()}}),e,this)}))),function(){return a.apply(this,arguments)})},{key:"handleUnlockAnimation",value:(i=Ce(Se().mark((function e(t,n,i){var a,r,o,s,l,u=this;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all([this.starChest.moveToCenter(i),this.fadeInChestUnlockFX(i)]);case 2:return this.chestAnimation.stop(),this.starChest.startShaking(),bi.playSound(ui.STAR_CHEST_DRUM_ROLL,{loop:!0}),e.next=7,vn.waitTweenAsync(0);case 7:return a=t,r=this.numChestAvailable,o=function(e){return u.numChestAvailable>2?1-e/u.numChestAvailable:.35*(1-e/u.numChestAvailable)},s=function(e){a-e>=20&&(a=e,r--,u.starChest.scale(o(r),i),bi.playSound(ui.STAR_CHEST_OPEN))},e.next=13,Promise.all([this.starProgressBar.animateTo(n,i,s)]);case 13:return e.next=15,vn.waitTweenAsync(1,i);case 15:return this.starChest.stopShaking(),e.next=18,this.starChest.glow(i);case 18:return bi.stopSound(ui.STAR_CHEST_DRUM_ROLL),l=Bs*this.numChestAvailable,this.node.scene.emit(pr.ADD_COINS,{coins:l,collectionAnimation:{animateTextOnly:!1,floatDuration:3,signal:i}}),e.next=23,this.starChest.explode(i);case 23:return e.next=25,vn.waitTweenAsync(1,i);case 25:return e.next=27,Promise.all([this.fadeOutChestUnlockFX(i)]);case 27:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return i.apply(this,arguments)})},{key:"fadeInChestUnlockFX",value:(n=Ce(Se().mark((function e(t){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.chestUnlockFXMask.node.active=!0,e.next=3,vn.runTweenAsync(S(this.chestUnlockFXMask).to(.5,{opacity:150}),t);case 3:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"fadeOutChestUnlockFX",value:(t=Ce(Se().mark((function e(t){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,vn.runTweenAsync(S(this.chestUnlockFXMask).to(.3,{opacity:0}),t);case 2:this.chestUnlockFXMask.opacity=0,this.chestUnlockFXMask.node.active=!1;case 4:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})}]),o}(f)).prototype,"starProgressBar",[qz],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),tU=Xe(Zz.prototype,"buttonLabel",[Wz],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),nU=Xe(Zz.prototype,"button",[Kz],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),iU=Xe(Zz.prototype,"chestAnimation",[jz],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),aU=Xe(Zz.prototype,"starChest",[Yz],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),rU=Xe(Zz.prototype,"chestUnlockFXMask",[Xz],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),oU=Xe(Zz.prototype,"skipOverlay",[$z],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),sU=Xe(Zz.prototype,"messageLabel",[Qz],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Jz=Zz))||Jz);n._RF.pop(),n._RF.push({},"ecbb9MLxRlP2Kv7swFe9AXo","StartLevelScreen",void 0);var LU,OU,DU,MU,NU,FU=i.ccclass,BU=i.property,GU=i.requireComponent,zU=GameCore.Events,UU=globalThis.game.event;hU=FU("StartLevelScreen"),pU=GU(bM),dU=BU(a),fU=BU(a),vU=BU(a),yU=BU(a),mU=BU(p),hU(gU=pU((wU=Xe((bU=function(e){Ie(n,e);var t=Fe(n);function n(){var e;Te(this,n);for(var i=arguments.length,a=new Array(i),r=0;r<i;r++)a[r]=arguments[r];return Ye(e=t.call.apply(t,[this].concat(a)),"playButton",wU,Me(e)),Ye(e,"goalText",kU,Me(e)),Ye(e,"levelText",SU,Me(e)),Ye(e,"missionText",EU,Me(e)),Ye(e,"playButtonComponent",CU,Me(e)),e.handleOpeningScreen=function(t){if(!e.screen)throw new Error("StartLevelScreen: screen not found");e.validateEventPayload(t)&&(e.playButtonComponent.interactable=!0)},e.handleOpenedScreen=function(t){e.validateEventPayload(t)&&e.open()},e}return xe(n,[{key:"__preload",value:function(){this.enabled=!1,this.screen=this.getComponent(bM),this.validateRequiredComponents(),this.listenScreenEvents()}},{key:"onDestroy",value:function(){this.unListenScreenEvents()}},{key:"validateRequiredComponents",value:function(){kt.lazyValidateProperties(this)}},{key:"listenScreenEvents",value:function(){UU.on(zU.OPENING_SCREEN,this.handleOpeningScreen),UU.on(zU.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"unListenScreenEvents",value:function(){UU.off(zU.OPENING_SCREEN,this.handleOpeningScreen),UU.off(zU.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"validateEventPayload",value:function(e){var t=null!=e?e:{},n=t.screenName,i=t.screenData;return n===this.node.name&&(null!=i&&i.level&&(this.levelId=i.level),null!=i&&i.mission&&(this.mission=i.mission),!0)}},{key:"open",value:function(){this.updateComponents(),this.runPopUpAnimation(),this.node.scene.emit(pr.HIDE_UI)}},{key:"close",value:function(){this.playButtonComponent.interactable=!1,UU.emit(zU.CLOSE_SCREEN,{screenName:this.node.name}),this.node.scene.emit(pr.SHOW_UI)}},{key:"updateComponents",value:function(){this.updateGoalText(),this.updateLevelText(),this.updateDescriptionText()}},{key:"updateGoalText",value:function(){var e=this.mission.mission;this.goalText.getComponent(u).string=e>1?"Goals":"Goal"}},{key:"updateLevelText",value:function(){this.levelText.getComponent(u).string=`Level ${this.levelId}`}},{key:"updateDescriptionText",value:function(){this.missionText.getComponent(u).string=this.mission.description}},{key:"runPopUpAnimation",value:function(){this.screen.container||console.warn("StartLevelScreen: screen not found")}},{key:"handleClickedPlay",value:function(){this.node.scene.emit(pr.GAME_START),this.close()}}]),n}(f)).prototype,"playButton",[dU],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),kU=Xe(bU.prototype,"goalText",[fU],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),SU=Xe(bU.prototype,"levelText",[vU],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),EU=Xe(bU.prototype,"missionText",[yU],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),CU=Xe(bU.prototype,"playButtonComponent",[mU],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),gU=bU))||gU);n._RF.pop(),n._RF.push({},"fe274iMNmBCzZ13Ie1nGU1R","TournamentLeaderSkeleton",void 0);var HU,VU,qU,WU,KU,jU,YU,XU,$U,QU,JU,ZU,eH,tH,nH,iH,aH,rH,oH,sH,lH,uH,cH,hH,pH,dH,fH=i.ccclass,vH=i.property,yH=(LU=fH("TournamentLeaderSkeleton"),OU=vH(a),LU((NU=Xe((MU=function(e){Ie(a,e);var t,n,i=Fe(a);function a(){var e;Te(this,a);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return Ye(e=i.call.apply(i,[this].concat(n)),"container",NU,Me(e)),e}return xe(a,[{key:"__preload",value:function(){this.uiOpacity=this.getComponent(N),this.validateRequiredComponents()}},{key:"hide",value:(n=Ce(Se().mark((function e(t){var n=this;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,vn.runTweenAsync(S(this.uiOpacity).to(.2,{opacity:0}).call((function(){n.node.active=!1})),t);case 2:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"show",value:(t=Ce(Se().mark((function e(t,n){var i,a,r,o;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.node.active=!0,this.node.scale=new Y(.8,.8,.8),this.uiOpacity.opacity=0,i=this.container.position.clone(),this.container.position=new Y(i.x,i.y-100,i.z),(a=S(this.node).delay(t)).to(.2,{scale:Y.ONE},{easing:"elasticOut"}),(r=S(this.container).delay(t)).to(.2,{position:i},{easing:"backOut"}),(o=S(this.uiOpacity).delay(t)).to(.2,{opacity:255},{easing:"cubicOut"}),e.next=13,Promise.all([vn.runTweenAsync(a,n),vn.runTweenAsync(r,n),vn.runTweenAsync(o,n)]);case 13:case"end":return e.stop()}}),e,this)}))),function(e,n){return t.apply(this,arguments)})},{key:"validateRequiredComponents",value:function(){if(!this.uiOpacity)throw new Error("UIOpacity component is not attached to the same node");if(!this.container)throw new Error("Container is not attached to the same node")}}]),a}(f)).prototype,"container",[OU],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),DU=MU))||DU);n._RF.pop(),n._RF.push({},"cdaa9B4pK9PFrDmP6/GQcMn","TournamentDetailScreen",void 0);var mH,gH=i.ccclass,bH=i.property,wH=i.requireComponent,kH=GameCore.Events,SH=GameCore.Utils.Object,EH=globalThis.game,CH=EH.event,TH=EH.storage,AH=EH.player,xH=EH.leaderboard;HU=gH("TournamentDetailScreen"),VU=wH(bM),qU=bH(u),WU=bH(u),KU=bH(u),jU=bH(TP),YU=bH(s),XU=bH({type:a,group:"Buttons"}),$U=bH({type:a,group:"Buttons"}),QU=bH({type:a,group:"Buttons"}),JU=bH({type:[yH]}),ZU=bH({type:[A]}),eH=bH(Yw),HU(tH=VU((iH=Xe((nH=function(e){Ie(f,e);var t,n,i,a,r,o,s,l,u,c,h,p,d=Fe(f);function f(){var e;Te(this,f);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return Ye(e=d.call.apply(d,[this].concat(n)),"titleLabel",iH,Me(e)),Ye(e,"timeLabel",aH,Me(e)),Ye(e,"playerCountLabel",rH,Me(e)),Ye(e,"tournamentLeaders",oH,Me(e)),Ye(e,"viewport",sH,Me(e)),Ye(e,"playButton",lH,Me(e)),Ye(e,"continueButton",uH,Me(e)),Ye(e,"replayButton",cH,Me(e)),Ye(e,"leaderSkeletons",hH,Me(e)),Ye(e,"banners",pH,Me(e)),Ye(e,"paperConfetti",dH,Me(e)),e.animAbortSignal=null,e.fetchAbortController=null,e.leadersPayload=null,e.handleOpeningScreen=function(t){if(!e.screen)throw new Error("TournamentDetailScreen: screen not found");e.validateEventPayload(t)},e.handleOpenedScreen=function(t){e.validateEventPayload(t)&&e.open()},e}return xe(f,[{key:"__preload",value:function(){this.enabled=!1,this.screen=this.getComponent(bM),this.tournamentScrollView=this.tournamentLeaders.node.getComponent(ue),this.validateRequiredComponents(),this.listenScreenEvents()}},{key:"onDestroy",value:function(){this.unListenScreenEvents()}},{key:"validateRequiredComponents",value:function(){kt.lazyValidateProperties(this)}},{key:"listenScreenEvents",value:function(){CH.on(kH.OPENING_SCREEN,this.handleOpeningScreen),CH.on(kH.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"unListenScreenEvents",value:function(){CH.off(kH.OPENING_SCREEN,this.handleOpeningScreen),CH.off(kH.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"updateVisibility",value:function(){this.tournamentLeaders.updateVisibility()}},{key:"validateEventPayload",value:function(e){return(null!=e?e:{}).screenName===this.node.name&&(this.payload=e,!0)}},{key:"open",value:function(){if(this.updateButtonVisibility(),this.setPlayerCountWaiting(),this.runPopUpAnimation(),this.node.scene.emit(pr.HIDE_UI),this.tournamentScrollView.node.on(ue.EventType.SCROLLING,this.updateVisibility,this),null!==this.animAbortSignal)throw new Error("TournamentContent: TournamentContent is already loading. Please handle cancelling gracefully.");this.animAbortSignal=new On,this.updateInfo(this.animAbortSignal)}},{key:"close",value:function(){lu.closeTournamentDetailScreen(),this.node.scene.emit(pr.SHOW_UI),this.tournamentScrollView.node.off(ue.EventType.SCROLLING,this.updateVisibility,this),this.cleanup()}},{key:"cleanup",value:function(){var e,t;null===(e=this.fetchAbortController)||void 0===e||e.abort(),null===(t=this.animAbortSignal)||void 0===t||t.abort(),this.animAbortSignal=null,this.fetchAbortController=null,this.tournamentLeaders.removeLeaders()}},{key:"runPopUpAnimation",value:function(){this.screen.container||console.warn("StartLevelScreen: screen not found")}},{key:"updateInfo",value:(p=Ce(Se().mark((function e(t){var n,i,a,r,o,s,l,u,c,h,p,d,f,v,y,m,g,b,w,k,S;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=null===(n=this.payload)||void 0===n||null===(n=n.screenData)||void 0===n?void 0:n.tournament){e.next=3;break}return e.abrupt("return");case 3:return(o=JSON.parse(r)).id=o.id.toString(),this.tournamentPayload=o,s=this.tournamentPayload,l=s.endTime,u=s.payload,c=s.title,h=u.leaderboardId,p=void 0===h?"":h,d=u.themeId,this.updateTitle(c),this.updateEndTime(l),this.updateTournamentBanner(d),f=TH.getStorage("tournament"),v=f.previousScore,y=f.previousRank,m=f.animateTournamentLeader,this.updateButtonsVisibility(m),e.next=15,this.showLoading(t);case 15:return e.next=17,this.getLeadersPayload(p);case 17:if(this.leadersPayload=e.sent,this.leadersPayload){e.next=22;break}return this.updatePlayerCount(0),this.hideLoading(t),e.abrupt("return");case 22:return g=this.leadersPayload,b=g.player,w=g.leaders,this.updatePlayerCount(w.length),k=null!==(i=null==b?void 0:b.score)&&void 0!==i?i:0,S=null!==(a=null==b?void 0:b.rank)&&void 0!==a?a:0,b&&m&&v&&v<k&&y&&y!==S&&(w.find((function(e){return e.playerId===b.playerId})).score=v),e.next=29,this.hideLoading(t);case 29:return this.tournamentLeaders.updateData(w),e.next=32,this.runShowUpAnimation(t);case 32:if(m){e.next=34;break}return e.abrupt("return");case 34:return TH.setStorageData("tournament","animateTournamentLeader",!1),e.next=37,this.runPlayerRankChangeAnimation(t,k);case 37:case"end":return e.stop()}}),e,this)}))),function(e){return p.apply(this,arguments)})},{key:"updateTournamentBanner",value:function(e){e?this.activateThemeBanner(e):this.activateThemeBanner(wl.SUMMER)}},{key:"activateThemeBanner",value:function(e){var t=!1;this.banners.forEach((function(n){n.node.active=n.node.name.toLowerCase()===e,n.node.active&&(t=!0)})),t||this.banners.forEach((function(e){e.node.active=e.node.name.toLowerCase()===wl.SUMMER}))}},{key:"showLoading",value:(h=Ce(Se().mark((function e(t){var n,i=arguments;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=i.length>1&&void 0!==i[1]?i[1]:0,e.next=3,Promise.all([this.leaderSkeletons.map((function(e,i){return e.show(i*n,t)}))]);case 3:case"end":return e.stop()}}),e,this)}))),function(e){return h.apply(this,arguments)})},{key:"hideLoading",value:(c=Ce(Se().mark((function e(t){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all(this.leaderSkeletons.map((function(e){return e.hide(t)})));case 2:case"end":return e.stop()}}),e,this)}))),function(e){return c.apply(this,arguments)})},{key:"runShowUpAnimation",value:(u=Ce(Se().mark((function e(t){var n;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.tournamentLeaders.showLeaders(t);case 2:if(n=this.tournamentLeaders.getPlayerLeader()){e.next=5;break}return e.abrupt("return");case 5:return e.next=7,this.scrollToLeader(n,1);case 7:case"end":return e.stop()}}),e,this)}))),function(e){return u.apply(this,arguments)})},{key:"runPlayerRankChangeAnimation",value:(l=Ce(Se().mark((function e(t,n){var i,a,r,o,s,l,u,c,h,p,d,f,v;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=this.tournamentLeaders.getLeaderData(),a=i.find((function(e){return e.playerId===AH.getPlayerId()}))){e.next=4;break}return e.abrupt("return");case 4:if(r=a.score,o=a.rank,r!==n){e.next=7;break}return e.abrupt("return");case 7:if(a.score=n,i.sort((function(e,t){return t.score-e.score})),i.forEach((function(e,t){e.rank=t+1})),s=this.tournamentLeaders.getPlayerLeader()){e.next=13;break}return e.abrupt("return");case 13:if(l=this.tournamentLeaders.getLeaderByRank(a.rank)){e.next=16;break}return e.abrupt("return");case 16:return this.tournamentLeaders.layout.enabled=!1,s.node.setParent(this.node,!0),e.next=20,s.runScaleAnimation(t,1.1,.5);case 20:return a.rank<=10&&bi.playSound(ui.STAR_CHEST_DRUM_ROLL),u=Math.min(.5*(o-a.rank),2),c=[s.runUpdateDataAnimation(o,a.rank,r,a.score,u),this.scrollToLeader(l,u)],h=this.viewport.contentSize.height,p=this.viewport.getBoundingBoxToWorld(),d=this.tournamentScrollView.getMaxScrollOffset().y,f=-l.node.position.y-h/2,v=Y.ZERO,f<0?v=new Y(s.node.worldPosition.x,p.yMax+l.node.position.y,s.node.worldPosition.z):this.tournamentScrollView.getScrollOffset().y>=d-5&&(v=f<d?new Y(s.node.worldPosition.x,p.center.y,s.node.worldPosition.z):l.node.worldPosition),v.equals(Y.ZERO)||c.push(s.runWorldPositionAnimation(v,u)),e.next=32,Promise.all(c);case 32:return bi.stopSound(ui.STAR_CHEST_DRUM_ROLL),e.next=35,Promise.all([s.runScaleAnimation(t,1,.25),s.node.setParent(this.tournamentLeaders.layout.node,!0),s.node.setSiblingIndex(a.rank-1),this.tournamentLeaders.runUpdateLeadersRankAnimation(a.rank,o),this.runPaperConfettiEffect(a.rank)]);case 35:this.tournamentLeaders.layout.enabled=!0,this.tournamentLeaders.layout.updateLayout();case 37:case"end":return e.stop()}}),e,this)}))),function(e,t){return l.apply(this,arguments)})},{key:"runPaperConfettiEffect",value:function(e){e>10||(this.paperConfetti.runEffect(),bi.playSound(ui.LEADERBOARD_TRIUMPH))}},{key:"scrollToLeader",value:(s=Ce(Se().mark((function e(t,n){var i,a,r,o;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=this.tournamentLeaders.uiTransform.contentSize,a=new Q(0,-t.node.position.y-i.height/2),r=this.tournamentScrollView.getScrollOffset().clone(),a.y=Math.max(a.y,0),r.y=Math.max(r.y,0),o=a.y-r.y,!(Math.abs(o)<5)){e.next=8;break}return e.abrupt("return");case 8:return this.tournamentScrollView.scrollToOffset(a,n),e.abrupt("return",vn.waitTweenAsync(n));case 10:case"end":return e.stop()}}),e,this)}))),function(e,t){return s.apply(this,arguments)})},{key:"updateTitle",value:function(e){e&&(this.titleLabel.string=e)}},{key:"updateEndTime",value:function(e){var t=GameCore.Utils.Time.getRelativeTime(e);t=(t=t.replace("seconds","secs").replace("second","sec")).replace("minutes","mins").replace("minute","min"),this.timeLabel.string=`Ends ${t}`}},{key:"updatePlayerCount",value:function(e){var t=GameCore.Utils.Number.getShortNumber(e,3);this.playerCountLabel.string=`${t} `+(e>1?"players":"player")}},{key:"setPlayerCountWaiting",value:function(){this.playerCountLabel.string="Loading..."}},{key:"getLeadersPayload",value:(o=Ce(Se().mark((function e(t){var n,i,a,r,o,s,l,u;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=xH.getLeaderboardName(t)){e.next=3;break}return e.abrupt("return",null);case 3:return e.next=5,xH.requestLeaderboardAsync(n,0);case 5:if(i=xH.getLeaderboard(n)){e.next=8;break}return e.abrupt("return",null);case 8:for(a=Object.values(i.leaders),r=AH.getPlayerId(),o={leaders:[],player:void 0,isPlayerInTournament:!1},s=0,l=a;s<l.length;s++)(u=l[s]).playerId===r?(o.player=u,o.isPlayerInTournament=!0,o.leaders.push(u)):o.leaders.push(u);return e.abrupt("return",o);case 13:case"end":return e.stop()}}),e)}))),function(e){return o.apply(this,arguments)})},{key:"updateButtonsVisibility",value:function(e){this.playButton.active=!e,this.continueButton.active=e,this.replayButton.active=e}},{key:"handleOnPlay",value:(r=Ce(Se().mark((function e(){var t;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.tournamentPayload.id||"",!vu.validateTournamentExpired(t)){e.next=7;break}return this.close(),this.node.scene.emit(il.RELOAD_TOURNAMENT),lu.showNotificationScreen("Tournament has ended",2),e.abrupt("return");case 7:return e.prev=7,lu.showLoadingNotificationScreen(),e.next=11,this.processJoinTournament();case 11:e.next=30;break;case 13:if(e.prev=13,e.t0=e.catch(7),!SH.hasOwn(e.t0,"code")||"USER_INPUT"!==e.t0.code){e.next=18;break}return lu.closeNotificationScreen(),e.abrupt("return");case 18:return e.prev=18,e.next=21,this.processContinueTournament();case 21:e.next=30;break;case 23:if(e.prev=23,e.t1=e.catch(18),!SH.hasOwn(e.t1,"code")||"USER_INPUT"!==e.t1.code){e.next=28;break}return lu.closeNotificationScreen(),e.abrupt("return");case 28:console.error("processPlayButtonPressed",e.t1),lu.showNotificationScreen("Sorry, you cannot join\nat this time.",2);case 30:case"end":return e.stop()}}),e,this,[[7,13],[18,23]])}))),function(){return r.apply(this,arguments)})},{key:"processJoinTournament",value:(a=Ce(Se().mark((function e(){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.joinTournamentAsync();case 3:Yl.switchScene(el,{level:1}),e.next=10;break;case 6:throw e.prev=6,e.t0=e.catch(0),console.warn("processJoinTournament",e.t0),e.t0;case 10:case"end":return e.stop()}}),e,this,[[0,6]])}))),function(){return a.apply(this,arguments)})},{key:"processContinueTournament",value:(i=Ce(Se().mark((function e(){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.continueTournamentAsync();case 3:Yl.switchScene(el,{level:1}),e.next=10;break;case 6:throw e.prev=6,e.t0=e.catch(0),console.warn("processContinueTournament",e.t0),e.t0;case 10:case"end":return e.stop()}}),e,this,[[0,6]])}))),function(){return i.apply(this,arguments)})},{key:"joinTournamentAsync",value:(n=Ce(Se().mark((function e(){var t;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.tournamentPayload.id||"",e.next=3,Bl.joinTournamentAsync(t);case 3:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"continueTournamentAsync",value:(t=Ce(Se().mark((function e(){var t,n;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=null!==(t=GameSDK.context.getID())&&void 0!==t?t:"",e.next=3,Bl.continueTournamentAsync(n);case 3:case"end":return e.stop()}}),e)}))),function(){return t.apply(this,arguments)})},{key:"updateButtonVisibility",value:function(){var e,t,n=(null!==(e=null===(t=this.payload)||void 0===t?void 0:t.screenData)&&void 0!==e?e:{}).tournamentContextType;switch(void 0===n?"tournament_start":n){case"tournament_end":this.playButton.active=!1,this.continueButton.active=!0,this.replayButton.active=!0;break;case"tournament_start":this.playButton.active=!0,this.continueButton.active=!1,this.replayButton.active=!1}}}]),f}(f)).prototype,"titleLabel",[qU],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),aH=Xe(nH.prototype,"timeLabel",[WU],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),rH=Xe(nH.prototype,"playerCountLabel",[KU],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),oH=Xe(nH.prototype,"tournamentLeaders",[jU],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),sH=Xe(nH.prototype,"viewport",[YU],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),lH=Xe(nH.prototype,"playButton",[XU],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),uH=Xe(nH.prototype,"continueButton",[$U],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),cH=Xe(nH.prototype,"replayButton",[QU],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),hH=Xe(nH.prototype,"leaderSkeletons",[JU],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),pH=Xe(nH.prototype,"banners",[ZU],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),dH=Xe(nH.prototype,"paperConfetti",[eH],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),tH=nH))||tH);n._RF.pop(),n._RF.push({},"36d58kn8v5POaqgX4C8S3ct","TournamentLeader",void 0);(0,i.ccclass)("TournamentLeader")(mH=function(e){Ie(n,e);var t=Fe(n);function n(){return Te(this,n),t.apply(this,arguments)}return xe(n)}(nP));n._RF.pop(),n._RF.push({},"43001Am3F9GVZjL3Nj2K44h","CoreManager",void 0);var RH=GameCore.Events,IH=globalThis.game,PH=IH.event,_H=IH.monitorError,LH=function(){function e(){var t=this;Te(this,e),this.callbackCoreBooting=null,this.callbackCoreStarting=null,this.callbackCoreReady=null,this.handleWhenCoreBooting=function(){if(!t.callbackCoreBooting)return console.error("Core: Booting callback is not set"),void(null==_H||_H.sendException(new Error("Core: Booting callback is not set")));console.info(" Core: Boot"),t.callbackCoreBooting(),t.callbackCoreBooting=null},this.handleWhenCoreStarting=function(){if(!t.callbackCoreStarting)return console.error("Core: Starting callback is not set"),void(null==_H||_H.sendException(new Error("Core: Starting callback is not set")));console.info(" Core: Starting"),t.callbackCoreStarting(),t.callbackCoreStarting=null},this.handleWhenCoreReady=function(){if(!t.callbackCoreReady)return console.error("Core: Ready callback is not set"),void(null==_H||_H.sendException(new Error("Core: Ready callback is not set")));console.info(" Core: Ready"),t.callbackCoreReady(),t.callbackCoreReady=null}}return xe(e,[{key:"init",value:function(){this.listenEvents(),console.info("Core Manager: Initialized")}},{key:"listenEvents",value:function(){PH.once(RH.CORE_BOOTING,this.handleWhenCoreBooting),PH.once(RH.CORE_STARTING,this.handleWhenCoreStarting),PH.once(RH.CORE_READY,this.handleWhenCoreReady)}},{key:"requestStart",value:function(){PH.emit(RH.REQUEST_CORE_START)}},{key:"onCoreBoot",value:function(e){this.callbackCoreBooting=e,PH.getEventEmitCount(RH.CORE_BOOTING)>0&&(PH.off(RH.CORE_BOOTING,this.handleWhenCoreBooting),this.handleWhenCoreBooting())}},{key:"onCoreStart",value:function(e){this.callbackCoreStarting=e,PH.getEventEmitCount(RH.CORE_STARTING)>0&&(PH.off(RH.CORE_STARTING,this.handleWhenCoreStarting),this.handleWhenCoreStarting())}},{key:"onCoreReady",value:function(e){this.callbackCoreReady=e,PH.getEventEmitCount(RH.CORE_READY)>0&&(PH.off(RH.CORE_READY,this.handleWhenCoreReady),this.handleWhenCoreReady())}}]),e}();n._RF.pop(),n._RF.push({},"b4ad5mMokdAa6EVNGzNedpF","EngineManager",void 0);var OH=GameCore,DH=OH.Configs,MH=OH.Utils,NH=DH.GameEngine,FH=MH.Valid,BH=function(){function e(){var t=this;Te(this,e),this.overrideSettings=function(){ve.overrideSettings(ye.Category.ENGINE,"debug",FH.isDebugger())},this.handleResizeView=function(e){le.instance.resizeWithBrowserSize(!1);var n=e.width,i=e.height;t.resizeView(n,i)},this.handleViewResized=function(e){var t=e.width,n=e.height;le.instance.resizeWithBrowserSize(!0),console.info(" New View Size",{width:t,height:n})}}return xe(e,[{key:"init",value:function(){this.overrideSettings(),this.setupAutoAtlas(),this.setupBatcherLimit(),this.setupDynamicAtlas(),this.listenEvents(),console.info("Engine Manager: Initialized")}},{key:"listenEvents",value:function(){W.on(fa,this.handleResizeView),W.on(va,this.handleViewResized)}},{key:"setupAutoAtlas",value:function(){pe.instance.cacheAsset=!0}},{key:"setupDynamicAtlas",value:function(){switch(j.os){case j.OS.IOS:this.setupDynamicAtlasForIOS();break;case j.OS.ANDROID:this.setupDynamicAtlasForAndroid();break;default:this.setupDynamicAtlasForDesktop()}}},{key:"setDynamicAtlas",value:function(e){var t=e.Enabled,n=e.AutoAtlasSize,i=e.MaxAtlasCount,a=e.MaxAtlasSize,r=e.MaxFrameSize;if(de.instance.enabled=t,de.instance.textureSize=a,de.instance.maxFrameSize=r,de.instance.maxAtlasCount=i,de.instance.textureBleeding=!0,n){var o=this.getMaxTextureSize();if(!o)return;de.instance.maxAtlasCount=1,de.instance.textureSize=o}}},{key:"getMaxTextureSize",value:function(){if(!d.root)return-1;var e=d.root.device.capabilities.maxTextureSize;return e>8192?7168:e-1024}},{key:"setupDynamicAtlasForIOS",value:function(){var e=NH.DynamicAtlas.IOS;this.setDynamicAtlas(e)}},{key:"setupDynamicAtlasForAndroid",value:function(){var e=NH.DynamicAtlas.Android;this.setDynamicAtlas(e)}},{key:"setupDynamicAtlasForDesktop",value:function(){var e=NH.DynamicAtlas.Desktop;this.setDynamicAtlas(e)}},{key:"setupBatcherLimit",value:function(){fe.BATCHER2D_MEM_INCREMENT=288,fe.MAX_LABEL_CANVAS_POOL_SIZE=125}},{key:"resizeView",value:function(e,t){var n,i=window.devicePixelRatio,a=i>=2?2/i:1,r=e*i*a,o=t*i*a;null===(n=d.root)||void 0===n||n.resize(r,o),B.windowSize=new G.Size(r,o),d.once(J.EVENT_AFTER_UPDATE,(function(){W.emit(va,{width:r,height:o})}))}}]),e}();n._RF.pop();var GH,zH=new(function(){function e(){Te(this,e),this._registry={},this._moduleCache={}}return xe(e,[{key:"define",value:function(e,t,n){this._registry[e]={factory:t,resolveMap:n}}},{key:"require",value:function(e){return this._require(e)}},{key:"throwInvalidWrapper",value:function(e,t){throw new Error(`Module '${e}' imported from '${t}' is expected be an ESM-wrapped CommonJS module but it doesn't.`)}},{key:"_require",value:function(e,t){var n=this._moduleCache[e];if(n)return n.exports;var i={id:e,exports:{}};return this._moduleCache[e]=i,this._tryModuleLoad(i,e),i.exports}},{key:"_resolve",value:function(e,t){return this._resolveFromInfos(e,t)||this._throwUnresolved(e,t)}},{key:"_resolveFromInfos",value:function(e,t){var n,i;return e in cjsInfos?e:t&&null!==(n=null===(i=cjsInfos[t])||void 0===i?void 0:i.resolveCache[e])&&void 0!==n?n:void 0}},{key:"_tryModuleLoad",value:function(e,t){var n=!0;try{this._load(e,t),n=!1}finally{n&&delete this._moduleCache[t]}}},{key:"_load",value:function(e,t){var n=this._loadWrapper(t),i=n.factory,a=n.resolveMap,r=this._createRequire(e),o=a?this._createRequireWithResolveMap("function"==typeof a?a():a,r):r;i(e.exports,o,e)}},{key:"_loadWrapper",value:function(e){return e in this._registry?this._registry[e]:this._loadHostProvidedModules(e)}},{key:"_loadHostProvidedModules",value:function(e){return{factory:function(t,n,i){if("undefined"==typeof require)throw new Error(`Current environment does not provide a require() for requiring '${e}'.`);try{i.exports=require(e)}catch(t){throw new Error(`Exception thrown when calling host defined require('${e}').`,{cause:t})}}}}},{key:"_createRequire",value:function(e){var t=this;return function(n){return t._require(n,e)}}},{key:"_createRequireWithResolveMap",value:function(e,t){return function(n){var i=e[n];if(i)return t(i);throw new Error("Unresolved specifier "+n)}}},{key:"_throwUnresolved",value:function(e,t){throw new Error(`Unable to resolve ${e} from ${parent}.`)}}]),e}()),UH="file:///D:/VSCode%20Project/tile-connect-remaster-game/node_modules/resize-observer-polyfill/dist/ResizeObserver.js";zH.define(UH,(function(e,t,n,i,a){!function(t,i){"object"==typeof e&&void 0!==n?n.exports=i():"function"==typeof define&&define.amd?define(i):t.ResizeObserver=i()}(this,(function(){var e=function(){if("undefined"!=typeof Map)return Map;function e(e,t){var n=-1;return e.some((function(e,i){return e[0]===t&&(n=i,!0)})),n}return function(){function t(){this.__entries__=[]}return Object.defineProperty(t.prototype,"size",{get:function(){return this.__entries__.length},enumerable:!0,configurable:!0}),t.prototype.get=function(t){var n=e(this.__entries__,t),i=this.__entries__[n];return i&&i[1]},t.prototype.set=function(t,n){var i=e(this.__entries__,t);~i?this.__entries__[i][1]=n:this.__entries__.push([t,n])},t.prototype.delete=function(t){var n=this.__entries__,i=e(n,t);~i&&n.splice(i,1)},t.prototype.has=function(t){return!!~e(this.__entries__,t)},t.prototype.clear=function(){this.__entries__.splice(0)},t.prototype.forEach=function(e,t){void 0===t&&(t=null);for(var n=0,i=this.__entries__;n<i.length;n++){var a=i[n];e.call(t,a[1],a[0])}},t}()}(),t="undefined"!=typeof window&&"undefined"!=typeof document&&window.document===document,n="undefined"!=typeof global&&global.Math===Math?global:"undefined"!=typeof self&&self.Math===Math?self:"undefined"!=typeof window&&window.Math===Math?window:Function("return this")(),i="function"==typeof requestAnimationFrame?requestAnimationFrame.bind(n):function(e){return setTimeout((function(){return e(Date.now())}),1e3/60)};var a=["top","right","bottom","left","width","height","size","weight"],r="undefined"!=typeof MutationObserver,o=function(){function e(){this.connected_=!1,this.mutationEventsAdded_=!1,this.mutationsObserver_=null,this.observers_=[],this.onTransitionEnd_=this.onTransitionEnd_.bind(this),this.refresh=function(e,t){var n=!1,a=!1,r=0;function o(){n&&(n=!1,e()),a&&l()}function s(){i(o)}function l(){var e=Date.now();if(n){if(e-r<2)return;a=!0}else n=!0,a=!1,setTimeout(s,t);r=e}return l}(this.refresh.bind(this),20)}return e.prototype.addObserver=function(e){~this.observers_.indexOf(e)||this.observers_.push(e),this.connected_||this.connect_()},e.prototype.removeObserver=function(e){var t=this.observers_,n=t.indexOf(e);~n&&t.splice(n,1),!t.length&&this.connected_&&this.disconnect_()},e.prototype.refresh=function(){this.updateObservers_()&&this.refresh()},e.prototype.updateObservers_=function(){var e=this.observers_.filter((function(e){return e.gatherActive(),e.hasActive()}));return e.forEach((function(e){return e.broadcastActive()})),e.length>0},e.prototype.connect_=function(){t&&!this.connected_&&(document.addEventListener("transitionend",this.onTransitionEnd_),window.addEventListener("resize",this.refresh),r?(this.mutationsObserver_=new MutationObserver(this.refresh),this.mutationsObserver_.observe(document,{attributes:!0,childList:!0,characterData:!0,subtree:!0})):(document.addEventListener("DOMSubtreeModified",this.refresh),this.mutationEventsAdded_=!0),this.connected_=!0)},e.prototype.disconnect_=function(){t&&this.connected_&&(document.removeEventListener("transitionend",this.onTransitionEnd_),window.removeEventListener("resize",this.refresh),this.mutationsObserver_&&this.mutationsObserver_.disconnect(),this.mutationEventsAdded_&&document.removeEventListener("DOMSubtreeModified",this.refresh),this.mutationsObserver_=null,this.mutationEventsAdded_=!1,this.connected_=!1)},e.prototype.onTransitionEnd_=function(e){var t=e.propertyName,n=void 0===t?"":t;a.some((function(e){return!!~n.indexOf(e)}))&&this.refresh()},e.getInstance=function(){return this.instance_||(this.instance_=new e),this.instance_},e.instance_=null,e}(),s=function(e,t){for(var n=0,i=Object.keys(t);n<i.length;n++){var a=i[n];Object.defineProperty(e,a,{value:t[a],enumerable:!1,writable:!1,configurable:!0})}return e},l=function(e){return e&&e.ownerDocument&&e.ownerDocument.defaultView||n},u=v(0,0,0,0);function c(e){return parseFloat(e)||0}function h(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];return t.reduce((function(t,n){return t+c(e["border-"+n+"-width"])}),0)}function p(e){var t=e.clientWidth,n=e.clientHeight;if(!t&&!n)return u;var i=l(e).getComputedStyle(e),a=function(e){for(var t={},n=0,i=["top","right","bottom","left"];n<i.length;n++){var a=i[n],r=e["padding-"+a];t[a]=c(r)}return t}(i),r=a.left+a.right,o=a.top+a.bottom,s=c(i.width),p=c(i.height);if("border-box"===i.boxSizing&&(Math.round(s+r)!==t&&(s-=h(i,"left","right")+r),Math.round(p+o)!==n&&(p-=h(i,"top","bottom")+o)),!function(e){return e===l(e).document.documentElement}(e)){var d=Math.round(s+r)-t,f=Math.round(p+o)-n;1!==Math.abs(d)&&(s-=d),1!==Math.abs(f)&&(p-=f)}return v(a.left,a.top,s,p)}var d="undefined"!=typeof SVGGraphicsElement?function(e){return e instanceof l(e).SVGGraphicsElement}:function(e){return e instanceof l(e).SVGElement&&"function"==typeof e.getBBox};function f(e){return t?d(e)?function(e){var t=e.getBBox();return v(0,0,t.width,t.height)}(e):p(e):u}function v(e,t,n,i){return{x:e,y:t,width:n,height:i}}var y=function(){function e(e){this.broadcastWidth=0,this.broadcastHeight=0,this.contentRect_=v(0,0,0,0),this.target=e}return e.prototype.isActive=function(){var e=f(this.target);return this.contentRect_=e,e.width!==this.broadcastWidth||e.height!==this.broadcastHeight},e.prototype.broadcastRect=function(){var e=this.contentRect_;return this.broadcastWidth=e.width,this.broadcastHeight=e.height,e},e}(),m=function(e,t){var n,i,a,r,o,l,u,c=(i=(n=t).x,a=n.y,r=n.width,o=n.height,l="undefined"!=typeof DOMRectReadOnly?DOMRectReadOnly:Object,u=Object.create(l.prototype),s(u,{x:i,y:a,width:r,height:o,top:a,right:i+r,bottom:o+a,left:i}),u);s(this,{target:e,contentRect:c})},g=function(){function t(t,n,i){if(this.activeObservations_=[],this.observations_=new e,"function"!=typeof t)throw new TypeError("The callback provided as parameter 1 is not a function.");this.callback_=t,this.controller_=n,this.callbackCtx_=i}return t.prototype.observe=function(e){if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");if("undefined"!=typeof Element&&Element instanceof Object){if(!(e instanceof l(e).Element))throw new TypeError('parameter 1 is not of type "Element".');var t=this.observations_;t.has(e)||(t.set(e,new y(e)),this.controller_.addObserver(this),this.controller_.refresh())}},t.prototype.unobserve=function(e){if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");if("undefined"!=typeof Element&&Element instanceof Object){if(!(e instanceof l(e).Element))throw new TypeError('parameter 1 is not of type "Element".');var t=this.observations_;t.has(e)&&(t.delete(e),t.size||this.controller_.removeObserver(this))}},t.prototype.disconnect=function(){this.clearActive(),this.observations_.clear(),this.controller_.removeObserver(this)},t.prototype.gatherActive=function(){var e=this;this.clearActive(),this.observations_.forEach((function(t){t.isActive()&&e.activeObservations_.push(t)}))},t.prototype.broadcastActive=function(){if(this.hasActive()){var e=this.callbackCtx_,t=this.activeObservations_.map((function(e){return new m(e.target,e.broadcastRect())}));this.callback_.call(e,t,e),this.clearActive()}},t.prototype.clearActive=function(){this.activeObservations_.splice(0)},t.prototype.hasActive=function(){return this.activeObservations_.length>0},t}(),b="undefined"!=typeof WeakMap?new WeakMap:new e,w=function e(t){if(!(this instanceof e))throw new TypeError("Cannot call a class as a function.");if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");var n=o.getInstance(),i=new g(t,n,this);b.set(this,i)};return["observe","unobserve","disconnect"].forEach((function(e){w.prototype[e]=function(){var t;return(t=b.get(this))[e].apply(t,arguments)}})),void 0!==n.ResizeObserver?n.ResizeObserver:w})),GH=n.exports}),{}),zH.require(UH),n._RF.push({},"9f0a0l1uXlNwqKEKardFRyv","LayoutManager",void 0);var HH=Ra,VH=Ia,qH=VH.Portrait,WH=VH.Landscape,KH=GameCore.Utils.Function,jH=function(){function e(){var t=this;Te(this,e),this.currentLayout="",this.handleViewResizeBySystem=function(e){console.info(" View resize by system"),window.devicePixelRatio=e||window.devicePixelRatio,t.setupOrientationByScreenSize(),t.resizeGameView()},this.handleViewResize=KH.debounce((function(){console.info(" View resize by window"),t.setupOrientationByScreenSize(),t.resizeGameView()}),200),this.handleBodyResize=KH.debounce((function(){t.resizeGameDiv()&&(console.info(" View resize by body"),t.setupOrientationByScreenSize(),t.resizeGameView())}),200)}return xe(e,[{key:"init",value:function(){this.listenResizeEvent(),this.listenObserverEvent(),this.setupResolutionPolicy(),W.emit(ya),console.info("Layout Manager: Initialized")}},{key:"listenResizeEvent",value:function(){j.isBrowser?(B.on("window-resize",this.handleViewResize,this),B.on("orientation-change",this.handleViewResize,this)):j.isMobile?window.addEventListener("resize",this.handleViewResize,{capture:!1,passive:!0}):console.warn("LayoutManager: Not support this platform"),W.on(ya,this.handleViewResizeBySystem)}},{key:"listenObserverEvent",value:function(){new GH(this.handleBodyResize).observe(document.body)}},{key:"setupResolutionPolicy",value:function(){le.instance.resizeWithBrowserSize(!0),le.instance.setOrientation(fe.ORIENTATION_AUTO),le.instance.setResolutionPolicy(me.ContentStrategy.FIXED_WIDTH),le.instance.setResolutionPolicy(me.ContainerStrategy.EQUAL_TO_FRAME),this.resolutionPolicy=le.instance.getResolutionPolicy()}},{key:"setupOrientationByScreenSize",value:function(){var e=this.getScreenRatio();this.resolutionPolicy.setContentStrategy(me.ContentStrategy.FIXED_WIDTH),e<1?this.setPortraitView():this.setLandscapeView()}},{key:"resizeGameDiv",value:function(){var e=document.getElementById("GameDiv");if(!e)return!1;var t=Zi.getScreenWidthCss(),n=Zi.getScreenHeightCss(),i=e.getBoundingClientRect(),a=i.width,r=i.height;return(t!==a||n!==r)&&(e.style.width=`${t}px`,e.style.height=`${n}px`,!0)}},{key:"resizeGameView",value:function(){var e=Zi.getScreenWidthCss(),t=Zi.getScreenHeightCss();W.emit(fa,{width:e,height:t})}},{key:"setPortraitView",value:function(){var e=qH.WIDTH,t=qH.HEIGHT;this.currentLayout=HH.Portrait,this.changeDesignResolutionSize(e,t)}},{key:"setLandscapeView",value:function(){var e=WH.WIDTH,t=WH.HEIGHT;this.currentLayout=HH.Landscape,this.changeDesignResolutionSize(e,t)}},{key:"changeDesignResolutionSize",value:function(e,t){le.instance.setDesignResolutionSize(e,t,this.resolutionPolicy),W.emit(ma,this.currentLayout),console.info(" Change layout to",this.currentLayout)}},{key:"getScreenRatio",value:function(){return Zi.getScreenWidthCss()/Zi.getScreenHeightCss()}}]),e}();n._RF.pop(),n._RF.push({},"535cbXcmXdEzLn3H3LOIS27","MatchManager",void 0);var YH=GameCore,XH=YH.Utils,$H=YH.Dtos,QH=XH.Valid,JH=["code","cols","encoding","idSize","rows"],ZH=["addRandomTilesPerMove","maxSpaceOfPair"],eV=function(){function e(){Te(this,e)}return xe(e,[{key:"init",value:function(){console.info("Match Manager: Initialized")}},{key:"setupDefaultMatchData",value:function(){this.setupMatchData(),this.setupMatchCustomData()}},{key:"setupMatchCustomData",value:function(){var e=$H.Match;e.CustomData.addDefaultData(Qs),e.CustomData.addValidateFunction("score",(function(e){if(!QH.isNumber(e)||e<0)throw new Error(`score ${e} is invalid`)}))}},{key:"setupMatchData",value:function(){var e=this,t=$H.Match;t.Data.addDefaultData(Vs),t.Data.addValidateFunction("extraData",(function(t){if(null!=t){if(!QH.isObject(t))throw new Error(`extraData ${t} must be a record of string keys`);var n=t,i=Object.keys(n);if(-1===i.indexOf("level"))throw new Error("extraData.level is missing");if(!QH.isNumber(n.level))throw new Error(`extraData.level ${n.level} must be a number`);if(-1===i.indexOf("fen"))throw new Error("extraData.fen is missing");if(e.validateFen(n.fen),-1===i.indexOf("gravity"))throw new Error("extraData.gravity is missing");if(!QH.isString(n.gravity))throw new Error(`extraData.gravity ${n.gravity} must be a string`);if(-1===i.indexOf("rules"))throw new Error("extraData.rules is missing");if(e.validateLevelRules(n.rules),-1===i.indexOf("time"))throw new Error("extraData.time is missing");if(!QH.isNumber(n.time))throw new Error(`extraData.time ${n.time} must be a number`)}}))}},{key:"validateFen",value:function(e){if(!QH.isObject(e))throw new Error(`extraData.fen ${e} must be a record of string keys`);var t=this.validateKeys(e,JH);if(!QH.isNumber(t.idSize))throw new Error("fen.idSize must be a number");if(!QH.isString(t.code))throw new Error("fen.code must be a string");if(!QH.isNumber(t.rows))throw new Error("fen.rows must be a number");if(!QH.isNumber(t.cols))throw new Error("fen.cols must be a number");if(!QH.isObject(t.encoding))throw new Error("fen.encoding must be a record of string keys");var n=this.validateKeys(t.encoding,Object.values(ec));Object.entries(n).forEach((function(e){var t=He(e,2),n=t[0],i=t[1];if(!QH.isString(i))throw new Error(`fen.encoding.${n} ${i} must be a string`)}))}},{key:"validateLevelRules",value:function(e){if(!QH.isObject(e))throw new Error(`extraData.rules ${e} must be a record of string keys`);var t=this.validateKeys(e,ZH);if(!QH.isNumber(t.addRandomTilesPerMove))throw new Error("rules.addRandomTilesPerMove must be a number");if(!QH.isNumber(t.maxSpaceOfPair))throw new Error("rules.maxSpaceOfPair must be a number")}},{key:"validateKeys",value:function(e,t){return Object.keys(e).forEach((function(e){if(!t.indexOf(e))throw new Error(`Key ${e} is missing`)})),e}}]),e}();n._RF.pop(),n._RF.push({},"d675ctpYslBHp4qqiYEki+q","PlayerManager",void 0);var tV=GameCore,nV=tV.Utils,iV=tV.Dtos,aV=nV.Valid,rV=globalThis.game.player,oV=function(){function e(){Te(this,e)}return xe(e,[{key:"init",value:function(){console.info("Player Manager: Initialized")}},{key:"setupDefaultGameData",value:function(){var e=iV.Player;e.Data.addDefaultData(Js),e.GameData.addDefaultData(Ks),e.GameData.addValidateFunction("stars",(function(e){if(!aV.isNumber(e)||e<0)throw new Error(`stars ${e} is invalid`)})),e.GameData.addValidateFunction("totalLevel",(function(e){if(!aV.isNumber(e)||e<1)throw new Error(`totalLevel ${e} is invalid`)})),e.GameData.addValidateFunction("levelVersion",(function(e){if(!aV.isNumber(e)||e<0)throw new Error(`levelVersion ${e} is invalid`)})),e.GameData.addValidateFunction("lastRewardedItems",(function(e){if(!aV.isNumber(e)||e<0)throw new Error(`lastRewardedItems ${e} is invalid`)})),e.GameData.addValidateFunction("lastCreateTournamentShown",(function(e){if(!aV.isNumber(e)||e<0)throw new Error(`lastCreateTournamentShown ${e} is invalid`)})),e.GameData.addValidateFunction("guideItemShowed",(function(e){if(!Array.isArray(e))throw new Error(`guideItemShowed ${e} is invalid`)})),e.GameData.addValidateFunction("items",(function(e){if(!aV.isObject(e))throw new Error(`items ${e} is invalid`);var t=Object.keys(e),n=Object.values(e);if(-1===t.indexOf(Ms.HINT))throw new Error(`item ${Ms.HINT} not found`);if(-1===t.indexOf(Ms.THUNDER))throw new Error(`item ${Ms.THUNDER} not found`);if(-1===t.indexOf(Ms.STORM))throw new Error(`item ${Ms.STORM} not found`);if(-1===t.indexOf(Ms.PLIERS))throw new Error(`item ${Ms.PLIERS} not found`);n.forEach((function(e){if(!aV.isNumber(e)||e<0)throw new Error(`item ${e} is invalid`)}))})),e.GameData.addValidateFunction("skins",(function(e){if(!aV.isObject(e))throw new Error(`skins ${e} is invalid`)}))}},{key:"requestConnectedPlayers",value:function(){rV.requestConnectedPlayers().catch((function(e){console.warn("player.requestConnectedPlayers",e)}))}}]),e}();n._RF.pop(),n._RF.push({},"51079bCfn9MZK6cuxbahS7M","AdaptivePerformance",void 0);var sV=GameCore,lV=sV.Events,uV=sV.Utils.Valid,cV=globalThis.game,hV=cV.event,pV=cV.adaptivePerformance,dV=function(){function e(){var t=this;Te(this,e),this.handleBeginFrame=function(){d.on(J.EVENT_AFTER_UPDATE,t.lateUpdate),d.on(J.EVENT_BEFORE_UPDATE,t.updateActualFPS)},this.handleAfterSceneLaunch=function(e){pV&&pV.trackingScene(e.name)},this.handleRequestResizeGame=function(e){var t=e.forcePixelRatio;uV.isNumber(t)&&W.emit(ya,t)},this.lateUpdate=function(){var e=1e3*W.deltaTime;null==pV||pV.updatePostStepDeltaTime(e)},this.updateActualFPS=function(){var e,t=null===(e=d.root)||void 0===e?void 0:e.fps;uV.isNumber(t)&&(null==pV||pV.updateActualFPS(t))}}return xe(e,[{key:"init",value:function(){pV&&this.listenEvents()}},{key:"listenEvents",value:function(){hV.on(lV.REQUEST_RESIZE_GAME,this.handleRequestResizeGame),d.once(J.EVENT_BEGIN_FRAME,this.handleBeginFrame),d.on(J.EVENT_AFTER_SCENE_LAUNCH,this.handleAfterSceneLaunch)}}]),e}();n._RF.pop(),n._RF.push({},"0bbd4wf2fRDcKljBcls6K8a","CanvasRecorder",void 0);var fV=globalThis.game.canvasRecorder,vV=function(){function e(){Te(this,e)}return xe(e,[{key:"init",value:function(){if(W.canvas&&fV){fV.setCanvas(W.canvas);var e=fV.getOptions(),t=fV.waitNextFrame;fV.waitNextFrame=Ce(Se().mark((function n(){return Se().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(!e.syncFps){n.next=4;break}return n.abrupt("return",new Promise((function(e){d.once(J.EVENT_AFTER_RENDER,e),W.pause(),W.step()})));case 4:return W.resume(),n.next=7,t.call(fV);case 7:return n.abrupt("return",Promise.resolve());case 8:case"end":return n.stop()}}),n)})))}}}]),e}();n._RF.pop(),n._RF.push({},"4a29byVcRpBGogGcAwYASiP","CocosStats",void 0);var yV=function(){function e(){var t=this;Te(this,e),this.hideCocosStats=function(){clearInterval(t.waiter),t.waiter=setInterval(t.checkProfilerReady,100)},this.checkProfilerReady=function(){if(K){K._showFPS=!1;var e=K._rootNode;e&&(e.active=!1,e.isValid&&(e.destroyAllChildren(),e.removeAllChildren(),e.destroy(),clearInterval(t.waiter)))}}}return xe(e,[{key:"init",value:function(){K&&d.on(J.EVENT_BEFORE_SCENE_LAUNCH,this.hideCocosStats)}}]),e}();n._RF.pop(),n._RF.push({},"49a72YoKFFCKbOm5Xgp9R+k","DynamicAssets",void 0);var mV=GameCore,gV=mV.Configs,bV=mV.Events,wV=gV.GameEngine,kV=globalThis.game.event,SV=[".png",".jpg",".jpeg",".webp"],EV=function(){function e(){var t=this;Te(this,e),this.useHighQuality=!1,this.upgradableAssets=new Map,this.requestUpdateDynamicAssets=function(){W.emit(Ca)},this.collectUpgradableAssets=function(e){var n,i=Ke(e.output=e.input);try{for(i.s();!(n=i.n()).done;){var a=n.value;if(-1!==SV.indexOf(a.ext)&&!t.upgradableAssets.has(a.uuid)){t.useHighQuality&&(a.url=t.replaceAssetUrl(a.url),a.requestUpgrade=!0);var r={uuid:a.uuid,url:a.url,options:a.options,upgraded:a.upgraded,requestUpgrade:a.requestUpgrade,ext:a.ext};t.upgradableAssets.set(a.uuid,r)}}}catch(e){i.e(e)}finally{i.f()}},this.replaceAssetUrl=function(e){return t.useHighQuality?e.replace("native/","native32/"):e},this.handleUpgradeQuality=function(){t.useHighQuality=!0;var e=0,n=0,i=pe.instance,a=i.assets,r=i.loadAny,o=0;t.upgradableAssets.forEach((function(i){if(i.upgraded||i.requestUpgrade)e++;else{n++;var s=a.get(i.uuid);s instanceof L?(i.url=t.replaceAssetUrl(i.url),console.info("DynamicAssets: Process upgrade quality",i.uuid,i,s),r(i,i.options,(function(e,a){o++,e?console.warn("DynamicAssets: Upgrade error",e):(s.reset(a),i.upgraded=!0,t.upgradableAssets.set(i.uuid,i),console.info("DynamicAssets: Upgrade done",i.uuid,a,s),o>=n&&t.requestUpdateDynamicAssets())}))):console.warn("DynamicAssets: Asset not found",i.uuid)}})),console.warn("DynamicAssets: Upgradable Assets Info",{needUpgrade:n,upgraded:e,total:t.upgradableAssets.size})}}return xe(e,[{key:"init",value:function(){var e=wV.DynamicAssets.Enabled;console.info("DynamicAssets: init",{EDITOR:false,Enabled:e}),e&&(pe.instance.transformPipeline.insert(this.collectUpgradableAssets,3),this.listenEvents())}},{key:"listenEvents",value:function(){var e=this;W.on(Ea,this.handleUpgradeQuality),kV.on(bV.SCENE_LAUNCHED,(function(t){var n=t.sceneName;-1===[Zs].indexOf(n)&&e.handleUpgradeQuality()}))}}]),e}();n._RF.pop(),n._RF.push({},"15ecbqnx5lFtYRSJp2lOLCm","DynamicAtlas",void 0);var CV=GameCore,TV=CV.Configs,AV=CV.Events,xV=TV.GameEngine,RV=globalThis.game.event,IV=function(){function e(){var t=this;Te(this,e),this.result=[],this.requestUpdateDynamicAtlas=function(){requestAnimationFrame(t.updateDynamicAtlas)},this.createAtlas=function(){return de.instance.newAtlas()},this.updateDynamicAtlas=function(){var e=d.getScene();if(e){var n=e.getComponentsInChildren(ge),i=[];if(n.forEach((function(e){if(e.enabled&&e.node.activeInHierarchy)if("spriteFrame"in e){if(e.spriteFrame instanceof O){var t=e.spriteFrame,n=t.uuid,a=t.packable,r=t.texture,o=t.original;if(a)if(r instanceof be){var s=r.getId(),l=r.width,u=r.height,c=(null==o?void 0:o._texture)||{width:0,height:0},h=c.width,p=c.height;if(o){var d=o._texture.getId();if(s===d)return void console.warn("DynamicAtlas: Skip original texture",e.name,{ori:o._texture,tex:r});s=d}var f=(o?h:l)+2,v=(o?p:u)+2;i.push({id:s,name:n,w:f,h:v,x:-1,y:-1,comp:e})}else console.warn("DynamicAtlas: Skip non-texture2d texture",e.name);else console.warn("DynamicAtlas: Skip non-packable texture",e.name)}}else console.warn("DynamicAtlas: Skip non-sprite component",e.name,e)})),0!==i.length){console.info("DynamicAtlas: collect info",i);var a=[];i.forEach((function(e){a.find((function(t){return t.id===e.id}))||a.push(e)})),0!==a.length&&(t.result=[],t.resetDynamicAtlas(),t.fillTextures(a),t.refreshComponents(n))}}},this.calculateOptimizedAtlas=function(e,n){var i=Ve(e),a=function(e){var t,n=0,i=0,a=Ke(e);try{for(a.s();!(t=a.n()).done;){var r=t.value;n+=r.w*r.h,i=Math.max(i,r.w)}}catch(e){a.e(e)}finally{a.f()}e.sort((function(e,t){return t.h-e.h}));var o,s=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(n/.95)),i),h:1/0}],l=0,u=0,c=Ke(e);try{for(c.s();!(o=c.n()).done;)for(var h=o.value,p=s.length-1;p>=0;p--){var d=s[p];if(!(h.w>d.w||h.h>d.h)){if(h.x=d.x,h.y=d.y,u=Math.max(u,h.y+h.h),l=Math.max(l,h.x+h.w),h.w===d.w&&h.h===d.h){var f=s.pop();p<s.length&&(s[p]=f)}else h.h===d.h?(d.x+=h.w,d.w-=h.w):h.w===d.w?(d.y+=h.h,d.h-=h.h):(s.push({x:d.x+h.w,y:d.y,w:d.w-h.w,h:h.h}),d.y+=h.h,d.h-=h.h);break}}}catch(e){c.e(e)}finally{c.f()}return{w:l,h:u,fill:n/(l*u)||0}}(i=e.reduce((function(e,t){return e.some((function(e){return e.id===t.id}))||e.push(t),e}),[])),r=a.w,o=a.h,s=a.fill;if(r>n||o>n){var l=i.slice(0,i.length-1);return t.calculateOptimizedAtlas(l,n)}return console.info("DynamicAtlas: packed map info",r,o,s,i),i},this.fillTextures=function(e){if(0!==e.length){var n=de.instance.textureSize;t.result=t.calculateOptimizedAtlas(e,n)}},this.drawTexture=function(e,n,i){var a=n.texture,r=a.getId(),o=t.result.find((function(e){return e.id===r}))||{x:-1,y:-1},s=o.x,l=o.y;if(s<0||l<0)return e.originalInsertSpriteFrame(n);var u=e._innerTextureInfos[r];u||(i&&(e._texture.drawTextureAt(a.image,s-1,l),e._texture.drawTextureAt(a.image,s+1,l),e._texture.drawTextureAt(a.image,s,l-1),e._texture.drawTextureAt(a.image,s,l+1)),e._texture.drawTextureAt(a.image,s,l),e._count++,e._innerTextureInfos[r]={texture:a,x:s,y:l});var c=n.rect,h=c.x,p=c.y;h+=(null==u?void 0:u.x)||s,p+=(null==u?void 0:u.y)||l;var d={texture:e._texture,x:h,y:p};return e._innerSpriteFrames.push(n),d},this.refreshComponents=function(e){e.forEach((function(e){e.node.active&&(e.node.active=!1,e.node.active=!0)}))}}return xe(e,[{key:"init",value:function(){var e=xV.DynamicAtlas.TextureAtlasOptimize;e&&(console.info("DynamicAtlas: init",{TextureAtlasOptimize:e}),this.listenEvents(),this.overrideDynamicAtlas())}},{key:"listenEvents",value:function(){W.on(Ca,this.requestUpdateDynamicAtlas),RV.on(AV.SCENE_LAUNCHED,this.requestUpdateDynamicAtlas)}},{key:"overrideDynamicAtlas",value:function(){var e=this,t=de.instance;de.instance.insertSpriteFrame=function(n){if(t._atlasIndex>=t._maxAtlasCount)return null;if(!n||n.original)return null;if(!n.packable)return null;var i=e.getAtlas(),a=i?i.insertSpriteFrame(n):null;return!a&&t._atlasIndex<t._maxAtlasCount?(i=e.getAtlas())?i.insertSpriteFrame(n):null:a}}},{key:"resetDynamicAtlas",value:function(){de.instance.reset()}},{key:"getAtlas",value:function(){var e=this,t=de.instance,n=t._atlases,i=void 0===n?[]:n,a=t._atlasIndex,r=t.textureBleeding,o=i[a];return o||(o=this.createAtlas()),o.originalInsertSpriteFrame||(o.originalInsertSpriteFrame=o.insertSpriteFrame,o.insertSpriteFrame=function(t){return e.drawTexture(o,t,r)}),o}}]),e}();n._RF.pop();var PV={text:{level:"Level",settings:"SETTINGS",music:"Music",sound:"Sound",vibrate:"Vibrate",resume:"CONTINUE",on:"ON",off:"OFF",notification:"Notification",adsNotComplete:"Sorry, No Rewards!\nYou have cancelled the ad!",loadingAds:"Loading ads...",loading:"Loading...",load:"Loading",rewardNotReady:"No ads to display!",next:"NEXT",completed:"COMPLETED",tryAgain:"TRY AGAIN",retry:"RETRY",congratulation:"CONGRATULATION",you_have_pass_all_levels:"You have passed all levels.",please_come_back_later:"Please come back later,\nwe will update soon!",start_over:"START OVER",confirmation:"CONFIRMATION",are_you_sure_to_start_over:"ARE YOU SURE TO START OVER?",you_will_play_the_game_again:"You will play the game again\nfrom the beginning, at level 1.",no:"NO",yes:"YES"},texture:{image:"image"}};n._RF.push({},"14b76Yew19JgY7K+L9F5mmu","Languages",void 0);var _V=GameCore.Events,LV=globalThis.game,OV=LV.event,DV=LV.language,MV=function(){function e(){var t=this;Te(this,e),this.handleLanguageChanged=function(){var e=Ce(Se().mark((function e(n){var i;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:i=n.locale,W.emit("update-language",i),t.updateComponentInEditor();case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}var n,i,a;return xe(e,[{key:"init",value:function(){var e=this;this.addLanguage("en").then((function(){e.setLanguage("en"),e.listenEvent()}))}},{key:"listenEvent",value:function(){OV.on(_V.LANGUAGE_CHANGED,this.handleLanguageChanged)}},{key:"addLanguage",value:(a=Ce(Se().mark((function e(t){var n;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getLangData(t);case 2:n=e.sent,DV.add(t,n);case 4:case"end":return e.stop()}}),e,this)}))),function(e){return a.apply(this,arguments)})},{key:"setLanguage",value:function(e){DV.choose(e)}},{key:"getLangData",value:(i=Ce(Se().mark((function e(t){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=t,e.next="en"===e.t0?3:"ru"===e.t0?4:5;break;case 3:return e.abrupt("return",PV);case 4:return e.abrupt("return",this.loadLanguageAsync(t));case 5:throw new Error(`Language ${t} not supported`);case 6:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})},{key:"loadLanguageAsync",value:(n=Ce(Se().mark((function e(n){var i;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.import(`db://assets/resources/locales/${n}.json`);case 2:i=e.sent.default,DV.add(n,i);case 4:case"end":return e.stop()}}),e)}))),function(e){return n.apply(this,arguments)})},{key:"updateComponentInEditor",value:function(){}}]),e}();n._RF.pop(),n._RF.push({},"fb33bK/6Y5FAas5AwmmBM/X","Leaderboards",void 0);var NV=GameCore,FV=NV.Configs,BV=NV.Utils,GV=FV.Mockup,zV=BV.Number,UV=globalThis.game.leaderboard,HV=function(){function e(){var t=this;Te(this,e),this.handleWhenGameSDKStarted=function(){FV.Mockup.Leaderboards.Enabled?t.setupLeaderboardsMockup():t.setupLeaderboards()}}var t,n,i,a,r;return xe(e,[{key:"init",value:function(){this.handleWhenGameSDKStarted()}},{key:"setupLeaderboards",value:(r=Ce(Se().mark((function e(){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.setupLeaderboardByConfigs();case 1:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"setupLeaderboardByConfigs",value:function(){var e=FV.Leaderboards.LeaderboardId;e?(UV.addLeaderboard({name:js,type:"global",autoSortRank:!0,leaderboardId:e}),UV.addLeaderboard({name:Ys,type:"friends",autoSortRank:!0,leaderboardId:e})):console.warn("LeaderboardId in Configs is not set")}},{key:"setupLeaderboardsMockup",value:(a=Ce(Se().mark((function e(){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.setupMockGlobalLeaderboard(),this.setupMockFriendsLeaderboard(),this.setupMockGlobalTournamentLeaderboard();case 3:case"end":return e.stop()}}),e,this)}))),function(){return a.apply(this,arguments)})},{key:"setupMockGlobalLeaderboard",value:(i=Ce(Se().mark((function e(){var t,n,i,a;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=js,n=Xs,e.next=4,UV.createLeaderboardAsync({_id:n,name:t,numberOfLeaders:100});case 4:return i=e.sent,UV.addLeaderboard({name:t,type:"global",autoSortRank:!0,leaderboardId:i}),e.next=8,UV.requestLeaderboardAsync(t,10);case 8:a=UV.getLeaderboard(t),console.info("setupGlobalLeaderboard fetch new",a,a&&Object.keys(a.leaders).length),a=UV.getLeaderboard(t),console.info("setupGlobalLeaderboard load more",a,a&&Object.keys(a.leaders).length);case 12:case"end":return e.stop()}}),e)}))),function(){return i.apply(this,arguments)})},{key:"setupMockFriendsLeaderboard",value:(n=Ce(Se().mark((function e(){var t,n,i,a,r,o;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=Ys,n=$s,i=0,(a=GV.GameSDK.Player.ConnectedPlayers).Enabled&&(i=zV.random(a.NumOfPlayers)),e.next=7,UV.createLeaderboardAsync({_id:n,name:t,numberOfLeaders:i});case 7:return r=e.sent,UV.addLeaderboard({name:t,type:"friends",autoSortRank:!0,leaderboardId:r}),e.next=11,UV.requestLeaderboardAsync(t,10);case 11:o=UV.getLeaderboard(t),console.info("setupFriendsLeaderboard done",o);case 13:case"end":return e.stop()}}),e)}))),function(){return n.apply(this,arguments)})},{key:"setupMockGlobalTournamentLeaderboard",value:(t=Ce(Se().mark((function e(){var t;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,vu.requestTournamentDataAsync();case 2:(t=e.sent).forEach((function(e){var t=e.payload.leaderboardId;t&&(UV.isExistLeaderboardId(t)||UV.addLeaderboard({type:"tournament",name:t,autoSortRank:!0,leaderboardId:t}))})),console.info("setupGlobalTournamentLeaderboard done",t);case 5:case"end":return e.stop()}}),e)}))),function(){return t.apply(this,arguments)})}]),e}();n._RF.pop(),n._RF.push({},"e7bf73g4jJGuI9FqvW5YBsS","PerformanceMonitor",void 0);var VV=GameCore,qV=VV.Configs,WV=VV.Utils,KV=VV.Events,jV=qV.PerformanceMonitor,YV=globalThis.game.event,XV=function(){function e(){var t=this;Te(this,e),this.markName="FPS Tracking",this.handleStartTraceFps=function(){t.startTraceFps()},this.handleLateUpdate=function(){if(t.mark){if(t.fpsTraceDuration-=W.deltaTime,t.fpsTraceDuration<=0&&!t.traceStopped)return t.traceStopped=!0,t.unListenEvents(),t.updateFPS(),void t.mark.stop(t.markName);t.fpsTraceIntervalTimer-=W.deltaTime,t.fpsTraceIntervalTimer>0||(t.fpsTraceIntervalTimer=t.fpsTraceInterval,t.updateFPS(),t.mark.stop(t.markName),t.startTraceFps())}}}return xe(e,[{key:"mark",get:function(){return jV.FpsTracking?WV.Mark:null}},{key:"init",value:function(){var e=jV.FpsTracking,t=e.TrackingDuration,n=e.TrackingInterval;this.fpsTraceDuration=null!=t?t:60,this.fpsTraceInterval=null!=n?n:10,this.fpsTraceIntervalTimer=this.fpsTraceInterval,this.traceStopped=!1,this.listenEvents()}},{key:"listenEvents",value:function(){YV.once(KV.GAME_READY,this.handleStartTraceFps),d.on(J.EVENT_AFTER_UPDATE,this.handleLateUpdate)}},{key:"unListenEvents",value:function(){d.off(J.EVENT_AFTER_UPDATE,this.handleLateUpdate)}},{key:"startTraceFps",value:function(){this.mark&&(this.mark.measure(this.markName),this.mark.start(this.markName))}},{key:"updateFPS",value:function(){var e,t;if(this.mark){var n=this.getFPS(),i=this.getDrawCalls(),a=this.getDeviceRender(),r=this.getTextureMemory();this.minFps=Math.min(null!==(e=this.minFps)&&void 0!==e?e:n,n),this.maxFps=Math.max(null!==(t=this.maxFps)&&void 0!==t?t:0,n),this.mark.putMetric(this.markName,"FPS Metric",n),this.mark.putAttr(this.markName,"Page Title",document.title),this.mark.putAttr(this.markName,"Device Render",a),this.mark.putAttr(this.markName,"Draw Calls",i.toString()),this.mark.putAttr(this.markName,"Texture Memory",r.toFixed(2)),this.mark.putAttr(this.markName,"Min FPS",this.minFps.toString()),this.mark.putAttr(this.markName,"Max FPS",this.maxFps.toString()),console.info(`FPS: ${n} Min: ${this.minFps} Max: ${this.maxFps}, draw calls: ${i}, texture memory: ${r.toFixed(2)}MB`)}}},{key:"getFPS",value:function(){if(!d.root)return 0;var e=d.root.fps;return Math.floor(e)||0}},{key:"getDrawCalls",value:function(){return d.root&&d.root.device.numDrawCalls||0}},{key:"getDeviceRender",value:function(){return d.root&&d.root.device.renderer||"Unknown"}},{key:"getTextureMemory",value:function(){return d.root&&d.root.device.memoryStatus.textureSize/1048576||0}}]),e}();n._RF.pop(),n._RF.push({},"58248LBip1DBrMjK0UWw2rM","RemoteConfig",void 0);var $V=GameCore.Events,QV=globalThis.game.event,JV=function(){function e(){Te(this,e),this.handleHotReload=function(){W.restart()},this.handleUpdateConfig=function(e){if("Gameplay"===e.type){W.emit(ga,e.config);var t=e.id,n=e.type;QV.emit($V.REMOTE_CONFIG_UPDATED,{id:t,type:n})}}}return xe(e,[{key:"init",value:function(){this.listenEvents()}},{key:"listenEvents",value:function(){QV.on($V.REQUEST_HOT_RELOAD,this.handleHotReload),QV.on($V.REQUEST_UPDATE_CONFIG,this.handleUpdateConfig)}}]),e}();n._RF.pop(),n._RF.push({},"c34a93D1BREiKms1T21AkQS","PluginsManager",void 0);var ZV=function(){function e(){Te(this,e)}return xe(e,[{key:"init",value:function(){console.info("Plugins Manager: Initialized"),this.initCocosStats(),this.initDynamicAtlas()}},{key:"initLanguages",value:function(){(new MV).init()}},{key:"initCocosStats",value:function(){(new yV).init()}},{key:"initLeaderboards",value:function(){(new HV).init()}},{key:"initRemoteConfig",value:function(){(new JV).init()}},{key:"initDynamicAtlas",value:function(){(new IV).init()}},{key:"initDynamicAssets",value:function(){(new EV).init()}},{key:"initCanvasRecorder",value:function(){(new vV).init()}},{key:"initPerformanceMonitor",value:function(){(new XV).init()}},{key:"initAdaptivePerformance",value:function(){(new dV).init()}}]),e}();n._RF.pop(),n._RF.push({},"ac8b03T+rFB061sXoEEsCUH","SceneManager",void 0);var eq=globalThis.game,tq=eq.event,nq=eq.monitorError,iq=GameCore,aq=iq.Events,rq=iq.Configs,oq=iq.Utils,sq=function(){function e(){var t=this;Te(this,e),this.markName="Load Scene",this.queueLoadScene={},this.callbackSwitchScene=null,this.switchScene=function(){var e=Ce(Se().mark((function e(n){var i,a,r;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=n.sceneName,a=n.sceneData,r=t.correctSceneName(i),console.info("Switching",r,null!=a?a:{}),r){e.next=5;break}return e.abrupt("return");case 5:lu.showLoadingFullScreen(r),t.startScene({sceneName:r,sceneData:a});case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.preloadScene=function(e,n){var i=e.sceneName;t.startMeasure(i),d.preloadScene(i,t.onSceneProgress,t.onScenePreloaded(i,n))},this.startMeasure=function(e){t.mark&&(t.queueLoadScene[e]&&(t.mark.putAttr(t.markName,"Canceled","true"),t.stopMeasure(e)),console.groupCollapsed(" Load scene progress"),t.mark.measure(t.markName),t.mark.putAttr(t.markName,"Cancel","false"),t.mark.putAttr(t.markName,"Success","false"),t.mark.putMetric(t.markName,e),t.mark.start(t.markName),t.queueLoadScene[e]=!0)},this.stopMeasure=function(e){t.mark&&t.queueLoadScene[e]&&(t.mark.rmAttr(t.markName,"File"),t.mark.putAttr(t.markName,"Success","true"),t.mark.stop(t.markName),t.queueLoadScene[e]=!1,console.groupEnd())},this.onSceneProgress=function(e,n,i){var a=e/n;t.mark&&t.mark.putAttr(t.markName,"Last File",`${i.id} (${i.ext})`);var r=Math.floor(70*a+30);GameSDK.setLoadingProgress(r)},this.onScenePreloaded=function(e,t){return function(n){n?console.warn("SceneManager.onScenePreloaded",{sceneName:e,error:n}):(t&&t(e,n),tq.emit(aq.SCENE_LOADED,{sceneName:e,isPreload:!0}))}},this.onDirectorLoadScene=function(e){return function(n,i){if(n)console.warn("SceneManager.onSceneLoaded",n);else if(null!=i&&i.scene){var a=i.name;t.handleBeforeSceneLaunch(i,e)(),d.once(J.EVENT_AFTER_SCENE_LAUNCH,t.handleSceneLaunched(a,e))}else console.warn("SceneManager.onSceneLoaded","Scene not found")}},this.handleBeforeSceneLaunch=function(e,n){return function(){t.setSceneData(e,null!=n?n:{}),W.emit(ya),tq.emit(aq.SCENE_LOADED,{sceneName:e.name})}},this.handleSceneLaunched=function(e,n){return function(){var i;lu.hideLoadingFullScreen(e),gi.switchSceneTracking(),null==nq||nq.addMetadata({currentScene:e}),null===(i=t.callbackSwitchScene)||void 0===i||i.call(t,{sceneName:e,sceneData:n}),tq.emit(aq.SCENE_LAUNCHED,{sceneName:e})}},this.handleSceneLoaded=function(e){var n=e.sceneName;t.stopMeasure(n)}}return xe(e,[{key:"init",value:function(){this.listenEvents(),console.info("Scene Manager: Initialized")}},{key:"listenEvents",value:function(){tq.on(aq.SWITCH_SCENE,this.switchScene),tq.on(aq.PRELOAD_SCENE,this.preloadScene),tq.on(aq.SCENE_LOADED,this.handleSceneLoaded)}},{key:"correctSceneName",value:function(e){var t=this.getCurrentScene();return t&&e===t.name?null:e}},{key:"startScene",value:function(e){var t=this,n=e.sceneName,i=e.sceneData;this.preloadScene({sceneName:n},(function(e,a){e===n&&(a?console.warn("SceneManager.startScene",{sceneName:n,error:a}):d.loadScene(n,t.onDirectorLoadScene(i)))}))}},{key:"mark",get:function(){return rq.PerformanceMonitor.LoadResources?oq.Mark:null}},{key:"getCurrentScene",value:function(){return d.getScene()}},{key:"getLoadedScenes",value:function(){var e=this,t=[];return Object.keys(this.queueLoadScene).map((function(n){e.queueLoadScene[n]||t.push(n)})),t}},{key:"onSwitchScene",value:function(e){this.callbackSwitchScene=e}},{key:"setSceneData",value:function(e,t){if(t&&("data"in e||e.scene.attr({data:{}}),"data"in e)){var n=e.data||{};e.scene.attr({data:ke(ke({},n),t)}),console.info("SceneManager.setSceneData",{sceneName:e.name,sceneData:t,currentData:n})}}}]),e}();n._RF.pop(),n._RF.push({},"617b2SRAL5CyL75C998xBnx","ScreenManager",void 0);var lq=globalThis.game,uq=lq.event,cq=lq.monitorError,hq=GameCore.Events,pq=function(){function e(){var t=this;Te(this,e),this.screens={},this.handleOpenScreen=function(e){var n=e.screenName,i=e.screenData;t.openScreen(n,i)},this.handleCloseScreen=function(e){var n=e.screenName;t.closeScreen(n)}}var t,n,i,a;return xe(e,[{key:"init",value:function(){this.listenEvents(),console.info("Screen Manager: Initialized")}},{key:"listenEvents",value:function(){uq.on(hq.OPEN_SCREEN,this.handleOpenScreen),uq.on(hq.CLOSE_SCREEN,this.handleCloseScreen)}},{key:"reorderScreens",value:function(){var e=Object.values(this.screens).filter((function(e){return"ready"===e.state}));e.sort((function(e,t){return e.order-t.order}));for(var t=0;t<e.length;t++){var n=e[t];n.order=t,n.comp.node.setSiblingIndex(n.order)}}},{key:"addScreenKeys",value:function(e,t){var n=this;e.forEach((function(e,i){n.screens[fi[e]]&&(n.screens[fi[e]].order=i),n.screens[fi[e]]={state:"key",parent:t,key:e,order:i}}))}},{key:"addScreens",value:function(e){var t=this;e.forEach((function(e,n){t.screens[e.node.name]={state:"ready",comp:e,order:n}}))}},{key:"preloadScreens",value:(a=Ce(Se().mark((function e(){var t,n;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=Object.values(this.screens),n=t.reduce((function(e,t){if("key"===t.state){var n=ai.loadPrefabAsync(`screens/${fi[t.key]}`);e.push(n)}return e}),[]),e.next=4,Promise.all(n);case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}}),e,this)}))),function(){return a.apply(this,arguments)})},{key:"getScreen",value:(i=Ce(Se().mark((function e(t){var n,i,a,r,o,s,u;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=(n=this.screens[t])){e.next=4;break}return null==cq||cq.sendException(new Error(`ScreenManager.openScreen Screen ${t} not found`),{screenName:t,screens:this.getScreensAsMetadata()}),e.abrupt("return",null);case 4:if("ready"!==n.state){e.next=6;break}return e.abrupt("return",n.comp);case 6:return console.info("ScreenManager.getScreen",`Screen ${t} not found in cache, instantiating it...`),i=n.parent,a=n.key,r=n.order,e.next=10,ai.loadPrefabAsync(`screens/${fi[a]}`);case 10:if(o=e.sent){e.next=14;break}return null==cq||cq.sendException(new Error(`ScreenManager.getScreen: Failed to load Screen ${t} prefab...`),{screenName:t,screens:this.getScreensAsMetadata()}),e.abrupt("return",null);case 14:if((s=l(o)).name=t,i.addChild(s),s.active=!1,u=s.getComponent(bM)){e.next=22;break}return null==cq||cq.sendException(new Error(`ScreenManager.getScreen: Screen ${t} prefab doesn't have BaseScreen component...`),{screenName:t,screens:this.getScreensAsMetadata()}),e.abrupt("return",null);case 22:return this.screens[t]={state:"ready",comp:u,order:r},this.reorderScreens(),e.abrupt("return",u);case 25:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})},{key:"getScreensAsMetadata",value:function(){var e=this;return Object.keys(this.screens).map((function(t){var n=e.screens[t];return"ready"===n.state?`${n.comp.node.name}(loaded)`:`${fi[n.key]}(notloaded)`})).join(", ")}},{key:"clearScreens",value:function(){this.screens={}}},{key:"openScreen",value:(n=Ce(Se().mark((function e(t,n){var i,a;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,ai.setBlockInput(!0),e.next=4,this.getScreen(t);case 4:if(i=e.sent,ai.setBlockInput(!1),null!=i&&i.node){e.next=9;break}return console.warn("ScreenManager.openScreen",`Screen ${t} not found`),e.abrupt("return");case 9:return i.node.active=!0,i.node.setPosition(new Y(0,0,0)),a={screenName:t,screenData:n},uq.emit(hq.OPENING_SCREEN,a),gi.trackCurrentPage(t,!0),null==cq||cq.addMetadata({currentScreen:t}),e.next=17,vn.waitTweenAsync(0);case 17:i.open(n),uq.emit(hq.OPENED_SCREEN,a),e.next=24;break;case 21:e.prev=21,e.t0=e.catch(0),console.error("ScreenManager.openScreen",e.t0);case 24:case"end":return e.stop()}}),e,this,[[0,21]])}))),function(e,t){return n.apply(this,arguments)})},{key:"closeScreen",value:(t=Ce(Se().mark((function e(t){var n,i,a;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.getScreen(t);case 3:if(i=e.sent){e.next=7;break}return console.warn("ScreenManager.closeScreen",`Screen ${t} not found`),e.abrupt("return");case 7:if(null!==(n=i.node)&&void 0!==n&&n.active){e.next=9;break}return e.abrupt("return");case 9:a={screenName:t},uq.emit(hq.CLOSING_SCREEN,a),i.close(),gi.trackCurrentPage(t,!1),null==cq||cq.removeMetadata("currentScreen"),e.next=19;break;case 16:e.prev=16,e.t0=e.catch(0),console.error("ScreenManager.closeScreen",e.t0);case 19:case"end":return e.stop()}}),e,this,[[0,16]])}))),function(e){return t.apply(this,arguments)})},{key:"closeAllScreens",value:function(){var e=this;Object.keys(this.screens).forEach((function(t){"ready"===e.screens[t].state&&e.closeScreen(t)}))}}]),e}();n._RF.pop(),n._RF.push({},"a851bnZR1RCUILrjMPf7nMm","CorecosSystem",void 0);var dq=GameCore,fq=dq.Configs,vq=dq.Events,yq=dq.Plugins,mq=globalThis.game,gq=mq.context,bq=mq.storage,wq=mq.event,kq=mq.analytics,Sq=mq.monitorError;new(function(){function e(){var t=this;Te(this,e),this.coreManager=new LH,this.matchManager=new eV,this.sceneManager=new sq,this.screenManager=new pq,this.engineManager=new BH,this.layoutManager=new jH,this.playerManager=new oV,this.pluginsManager=new ZV,this.handleWhenCoreBoot=function(){W.inited?t.handleCocosInit():W.once(we.EVENT_POST_PROJECT_INIT,t.handleCocosInit)},this.handleCocosInit=function(){t.coreManager.requestStart()},this.handleWhenCoreStart=function(){t.playerManager.setupDefaultGameData(),t.matchManager.setupDefaultMatchData(),console.groupEnd()},this.handleWhenCoreReady=function(){t.initPlugins(),console.groupEnd(),fq.Core.StartSDKAfterLoadGame?wq.once(vq.SCENE_LOADED,t.handleStartGameWhenMainSceneReady):t.processStartGame(),t.preloadScenes()},this.handleStartGameWhenMainSceneReady=function(){t.processStartGame()},this.handleSwitchScene=function(e){var n=e.sceneName,i=t.sceneManager.getCurrentScene();if((null==i?void 0:i.name)===n){t.screenManager.closeAllScreens(),t.screenManager.clearScreens();var a=null==i?void 0:i.getComponentsInChildren(bM);if(a.length>0){var r=a.map((function(e){return e.node.name})).join(", ");console.info(` Loaded Screens in ${n}: ${r}`),t.screenManager.addScreens(a)}var o=null==i?void 0:i.getComponentInChildren(VM);if(o){var s=o.screenKeys.filter((function(e){return!a.some((function(t){return t.node.name===fi[e]}))}));if(0!==s.length){var l=s.map((function(e){return fi[e]})).join(", ");console.info(` Lazy-loading Screens in ${n}: ${l}`),t.screenManager.addScreenKeys(s,o.node),t.screenManager.preloadScreens()}}}},console.groupCollapsed(" Corecos System"),console.info("Corecos Initializing..."),this.listenEvents(),this.initManagers(),console.groupEnd()}var t,n;return xe(e,[{key:"initManagers",value:function(){this.coreManager.init(),this.engineManager.init(),this.layoutManager.init(),this.sceneManager.init(),this.screenManager.init(),this.playerManager.init(),this.matchManager.init(),this.pluginsManager.init()}},{key:"listenEvents",value:function(){this.coreManager.onCoreBoot(this.handleWhenCoreBoot),this.coreManager.onCoreStart(this.handleWhenCoreStart),this.coreManager.onCoreReady(this.handleWhenCoreReady),this.sceneManager.onSwitchScene(this.handleSwitchScene)}},{key:"preloadScenes",value:function(){"solo"===bq.getStorageData("context","sessionContextType")?Yl.preloadDashboardScene():Yl.preloadGameScene()}},{key:"processStartGame",value:(n=Ce(Se().mark((function e(){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.groupEnd(),kq.event(yq.Analytics.Events.LOAD_COMPLETE),e.next=4,this.startGameAsync();case 4:this.startProcessContextData(),this.playerManager.requestConnectedPlayers(),kq.event(yq.Analytics.Events.APP_READY,{success:!0}),wq.emit(vq.GAME_READY);case 8:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"startGameAsync",value:(t=Ce(Se().mark((function e(){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,GameSDK.startGameAsync();case 3:kq.event(yq.Analytics.Events.GAME_SDK_READY,{success:!0}),e.next=11;break;case 6:e.prev=6,e.t0=e.catch(0),console.warn("GameSDK.startGameAsync",e.t0),kq.event(yq.Analytics.Events.GAME_SDK_READY,{success:!1}),e.t0 instanceof Error&&(null==Sq||Sq.sendException(e.t0));case 11:case"end":return e.stop()}}),e,null,[[0,6]])}))),function(){return t.apply(this,arguments)})},{key:"startProcessContextData",value:function(){wq.getEventEmitCount(vq.PLAYER_INFO_LOADED)?gq.processContextData().catch((function(e){console.error("startProcessContextData",e)})):wq.once(vq.PLAYER_INFO_LOADED,this.startProcessContextData)}},{key:"initPlugins",value:function(){this.pluginsManager.initLeaderboards(),this.pluginsManager.initDynamicAssets(),this.pluginsManager.initCanvasRecorder(),this.pluginsManager.initPerformanceMonitor(),this.pluginsManager.initAdaptivePerformance()}}]),e}()),n._RF.pop()}}}));

(function(r) {
  r('virtual:///prerequisite-imports/start-scene', 'chunks:///start-scene.js'); 
})(function(mid, cid) {
    System.register(mid, [cid], function (_export, _context) {
    return {
        setters: [function(_m) {
            var _exportObj = {};

            for (var _key in _m) {
              if (_key !== "default" && _key !== "__esModule") _exportObj[_key] = _m[_key];
            }
      
            _export(_exportObj);
        }],
        execute: function () { }
    };
    });
});