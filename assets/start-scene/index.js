function _instanceof(p,v){if(null!=v&&"undefined"!=typeof Symbol&&v[Symbol.hasInstance])return!!v[Symbol.hasInstance](p);return p instanceof v}function _type_of(p){return p&&"undefined"!=typeof Symbol&&p.constructor===Symbol?"symbol":typeof p}function _ts_generator(p,v){var g,E,k,C,_={label:0,sent:function(){if(1&k[0])throw k[1];return k[1]},trys:[],ops:[]};return C={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(C[Symbol.iterator]=function(){return this}),C;function verb(p){return function(v){return step([p,v])}}function step(C){if(g)throw new TypeError("Generator is already executing.");while(_)try{if(g=1,E&&(k=2&C[0]?E.return:C[0]?E.throw||((k=E.return)&&k.call(E),0):E.next)&&!(k=k.call(E,C[1])).done)return k;if(E=0,k)C=[2&C[0],k.value];switch(C[0]){case 0:case 1:k=C;break;case 4:_.label++;return{value:C[1],done:false};case 5:_.label++;E=C[1];C=[0];continue;case 7:C=_.ops.pop();_.trys.pop();continue;default:if(k=_.trys,!(k=k.length>0&&k[k.length-1])&&(6===C[0]||2===C[0])){_=0;continue}if(3===C[0]&&(!k||C[1]>k[0]&&C[1]<k[3])){_.label=C[1];break}if(6===C[0]&&_.label<k[1]){_.label=k[1];k=C;break}if(k&&_.label<k[2]){_.label=k[2];_.ops.push(C);break}if(k[2])_.ops.pop();_.trys.pop();continue}C=v.call(p,_)}catch(p){C=[6,p];E=0}finally{g=k=0}if(5&C[0])throw C[1];return{value:C[0]?C[1]:void 0,done:true}}}System.register("chunks:///start-scene.js",["cc"],function(p,v){var g,E,k,C,_,A,T,I,R,P,N,D,L,O,M,x,F,B,U,z,G,Y,j,H,V,q,W,K,X,J,Q,Z,$,ee,et,en,ei,ea,er,eo,es,el,eu,ec,ed,ep,ef,ey,ev,eg,em,eb,ew,eS,eE,ek,eC,e_,eA,eT,eI,eR,eP,eN,eD,eL,eO,eM,ex,eF,eB,eU,ez;return{setters:[function(p){g=p.cclegacy,E=p._decorator,k=p.Node,C=p.Color,_=p.Canvas,A=p.UITransform,T=p.instantiate,I=p.Label,R=p.RichText,P=p.Toggle,N=p.Button,D=p.director,L=p.Component,O=p.isCCObject,M=p.Animation,x=p.CCString,F=p.CCInteger,B=p.AudioSource,U=p.resources,z=p.AudioClip,G=p.tween,Y=p.CCFloat,j=p.Widget,H=p.Layout,V=p.Sprite,q=p.ccenum,W=p.find,K=p.Prefab,X=p.JsonAsset,J=p.AnimationClip,Q=p.ImageAsset,Z=p.SpriteFrame,$=p.Enum,ee=p.easing,et=p.UIOpacity,en=p.view,ei=p.screen,ea=p.math,er=p.EventHandler,eo=p.animation,es=p.CCBoolean,el=p.Input,eu=p.Graphics,ec=p.game,ed=p.profiler,ep=p.sys,ef=p.Vec3,ey=p.ProgressBar,ev=p.Font,eg=p.Vec2,em=p.Director,eb=p.Layers,ew=p.randomRangeInt,eS=p.pseudoRandomRangeInt,eE=p.pseudoRandom,ek=p.randomRange,eC=p.Pool,e_=p.ParticleSystem2D,eA=p.HorizontalTextAlignment,eT=p.Tween,eI=p.View,eR=p.ScrollView,eP=p.lerp,eN=p.Mask,eD=p.AssetManager,eL=p.DynamicAtlasManager,eO=p.macro,eM=p.settings,ex=p.Settings,eF=p.ResolutionPolicy,eB=p.UIRenderer,eU=p.Texture2D,ez=p.Game}],execute:function(){function e(p,v){var g=Object.keys(p);if(Object.getOwnPropertySymbols){var E=Object.getOwnPropertySymbols(p);v&&(E=E.filter(function(v){return Object.getOwnPropertyDescriptor(p,v).enumerable})),g.push.apply(g,E)}return g}function we(p){for(var v=1;v<arguments.length;v++){var g=null!=arguments[v]?arguments[v]:{};v%2?e(Object(g),!0).forEach(function(v){Re(p,v,g[v])}):Object.getOwnPropertyDescriptors?Object.defineProperties(p,Object.getOwnPropertyDescriptors(g)):e(Object(g)).forEach(function(v){Object.defineProperty(p,v,Object.getOwnPropertyDescriptor(g,v))})}return p}function ke(p,v,g,E,k,C,_){try{var A=p[C](_),T=A.value}catch(p){return void g(p)}A.done?v(T):Promise.resolve(T).then(E,k)}function Ee(p){return function(){var v=this,g=arguments;return new Promise(function(E,k){var C=p.apply(v,g);function r(p){ke(C,E,k,r,s,"next",p)}function s(p){ke(C,E,k,r,s,"throw",p)}r(void 0)})}}function Ce(p,v){if(!_instanceof(p,v))throw new TypeError("Cannot call a class as a function")}function Te(p,v){for(var g=0;g<v.length;g++){var E=v[g];E.enumerable=E.enumerable||!1,E.configurable=!0,"value"in E&&(E.writable=!0),Object.defineProperty(p,Ke(E.key),E)}}function Ae(p,v,g){return v&&Te(p.prototype,v),g&&Te(p,g),Object.defineProperty(p,"prototype",{writable:!1}),p}function Re(p,v,g){return(v=Ke(v))in p?Object.defineProperty(p,v,{value:g,enumerable:!0,configurable:!0,writable:!0}):p[v]=g,p}function Ie(p,v){if("function"!=typeof v&&null!==v)throw new TypeError("Super expression must either be null or a function");p.prototype=Object.create(v&&v.prototype,{constructor:{value:p,writable:!0,configurable:!0}}),Object.defineProperty(p,"prototype",{writable:!1}),v&&_e(p,v)}function Pe(p){return(Pe=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(p){return p.__proto__||Object.getPrototypeOf(p)})(p)}function _e(p,v){return(_e=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(p,v){return p.__proto__=v,p})(p,v)}function Le(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(p){return!1}}function Oe(){return(Oe=Le()?Reflect.construct.bind():function(p,v,g){var E=[null];E.push.apply(E,v);var k=new(Function.bind.apply(p,E));return g&&_e(k,g.prototype),k}).apply(null,arguments)}function De(p){var v="function"==typeof Map?new Map:void 0;return(De=function(p){if(null===p||(g=p,-1===Function.toString.call(g).indexOf("[native code]")))return p;var g;if("function"!=typeof p)throw new TypeError("Super expression must either be null or a function");if(void 0!==v){if(v.has(p))return v.get(p);v.set(p,i)}function i(){return Oe(p,arguments,Pe(this).constructor)}return i.prototype=Object.create(p.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),_e(i,p)})(p)}function Ne(p){if(void 0===p)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return p}function Me(p,v){if(v&&("object"==(void 0===v?"undefined":_type_of(v))||"function"==typeof v))return v;if(void 0!==v)throw new TypeError("Derived constructors may only return object or undefined");return Ne(p)}function xe(p){var v=Le();return function(){var g,E=Pe(p);if(v){var k=Pe(this).constructor;g=Reflect.construct(E,arguments,k)}else g=E.apply(this,arguments);return Me(this,g)}}function Be(p,v){for(;!Object.prototype.hasOwnProperty.call(p,v)&&null!==(p=Pe(p)););return p}function Fe(){return(Fe="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(p,v,g){var E=Be(p,v);if(E){var k=Object.getOwnPropertyDescriptor(E,v);return k.get?k.get.call(arguments.length<3?p:g):k.value}}).apply(this,arguments)}function ze(p,v,g,E){return(ze="undefined"!=typeof Reflect&&Reflect.set?Reflect.set:function(p,v,g,E){var k,C=Be(p,v);if(C){if((k=Object.getOwnPropertyDescriptor(C,v)).set)return k.set.call(E,g),!0;if(!k.writable)return!1}if(k=Object.getOwnPropertyDescriptor(E,v)){if(!k.writable)return!1;k.value=g,Object.defineProperty(E,v,k)}else Re(E,v,g);return!0})(p,v,g,E)}function Ge(p,v,g,E,k){if(!ze(p,v,g,E||p)&&k)throw new TypeError("failed to set property");return g}function Ue(p,v){return function(p){if(Array.isArray(p))return p}(p)||function(p,v){var g=null==p?null:"undefined"!=typeof Symbol&&p[Symbol.iterator]||p["@@iterator"];if(null!=g){var E,k,C,_,A=[],T=!0,I=!1;try{if(C=(g=g.call(p)).next,0===v){if(Object(g)!==g)return;T=!1}else for(;!(T=(E=C.call(g)).done)&&(A.push(E.value),A.length!==v);T=!0);}catch(p){I=!0,k=p}finally{try{if(!T&&null!=g.return&&(_=g.return(),Object(_)!==_))return}finally{if(I)throw k}}return A}}(p,v)||Ve(p,v)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function He(p){return function(p){if(Array.isArray(p))return qe(p)}(p)||function(p){if("undefined"!=typeof Symbol&&null!=p[Symbol.iterator]||null!=p["@@iterator"])return Array.from(p)}(p)||Ve(p)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Ve(p,v){if(p){if("string"==typeof p)return qe(p,v);var g=Object.prototype.toString.call(p).slice(8,-1);return"Object"===g&&p.constructor&&(g=p.constructor.name),"Map"===g||"Set"===g?Array.from(p):"Arguments"===g||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(g)?qe(p,v):void 0}}function qe(p,v){(null==v||v>p.length)&&(v=p.length);for(var g=0,E=new Array(v);g<v;g++)E[g]=p[g];return E}function We(p,v){var g="undefined"!=typeof Symbol&&p[Symbol.iterator]||p["@@iterator"];if(!g){if(Array.isArray(p)||(g=Ve(p))||v&&p&&"number"==typeof p.length){g&&(p=g);var E=0,a=function(){};return{s:a,n:function(){return E>=p.length?{done:!0}:{done:!1,value:p[E++]}},e:function(p){throw p},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var k,C=!0,_=!1;return{s:function(){g=g.call(p)},n:function(){var p=g.next();return C=p.done,p},e:function(p){_=!0,k=p},f:function(){try{C||null==g.return||g.return()}finally{if(_)throw k}}}}function Ke(p){var v=function(p,v){if("object"!=(void 0===p?"undefined":_type_of(p))||null===p)return p;var g=p[Symbol.toPrimitive];if(void 0!==g){var E=g.call(p,v||"default");if("object"!=(void 0===E?"undefined":_type_of(E)))return E;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===v?String:Number)(p)}(p,"string");return"symbol"==(void 0===v?"undefined":_type_of(v))?v:String(v)}function je(p,v,g,E){g&&Object.defineProperty(p,v,{enumerable:g.enumerable,configurable:g.configurable,writable:g.writable,value:g.initializer?g.initializer.call(E):void 0})}function Ye(p,v,g,E,k){var C={};return Object.keys(E).forEach(function(p){C[p]=E[p]}),C.enumerable=!!C.enumerable,C.configurable=!!C.configurable,("value"in C||C.initializer)&&(C.writable=!0),C=g.slice().reverse().reduce(function(g,E){return E(p,v,g)||g},C),k&&void 0!==C.initializer&&(C.value=C.initializer?C.initializer.call(k):void 0,C.initializer=void 0),void 0===C.initializer&&(Object.defineProperty(p,v,C),C=null),C}var p,eG,eY,ej,eH,eV,eq,eW;g._RF.push({},"b2bd1+njXxJxaFY3ymm06WU","debug-view-runtime-control",void 0);var eK=E.ccclass,eX=E.property;p=eK("internal.DebugViewRuntimeControl"),eG=eX(k),eY=eX(k),ej=eX(k),p((eV=Ye((eH=function(p){Ie(n,p);var v=xe(n);function n(){var p;Ce(this,n);for(var g=arguments.length,E=new Array(g),k=0;k<g;k++)E[k]=arguments[k];return je(p=v.call.apply(v,[this].concat(E)),"compositeModeToggle",eV,Ne(p)),je(p,"singleModeToggle",eq,Ne(p)),je(p,"EnableAllCompositeModeButton",eW,Ne(p)),p._single=0,p.strSingle=["No Single Debug","Vertex Color","Vertex Normal","Vertex Tangent","World Position","Vertex Mirror","Face Side","UV0","UV1","UV Lightmap","Project Depth","Linear Depth","Fragment Normal","Fragment Tangent","Fragment Binormal","Base Color","Diffuse Color","Specular Color","Transparency","Metallic","Roughness","Specular Intensity","IOR","Direct Diffuse","Direct Specular","Direct All","Env Diffuse","Env Specular","Env All","Emissive","Light Map","Shadow","AO","Fresnel","Direct Transmit Diffuse","Direct Transmit Specular","Env Transmit Diffuse","Env Transmit Specular","Transmit All","Direct Internal Specular","Env Internal Specular","Internal All","Fog"],p.strComposite=["Direct Diffuse","Direct Specular","Env Diffuse","Env Specular","Emissive","Light Map","Shadow","AO","Normal Map","Fog","Tone Mapping","Gamma Correction","Fresnel","Transmit Diffuse","Transmit Specular","Internal Specular","TT"],p.strMisc=["CSM Layer Coloration","Lighting With Albedo"],p.compositeModeToggleList=[],p.singleModeToggleList=[],p.miscModeToggleList=[],p.textComponentList=[],p.labelComponentList=[],p.textContentList=[],p._currentColorIndex=0,p.strColor=["<color=#ffffff>","<color=#000000>","<color=#ff0000>","<color=#00ff00>","<color=#0000ff>"],p.color=[C.WHITE,C.BLACK,C.RED,C.GREEN,C.BLUE],p}return Ae(n,[{key:"start",value:function(){if(this.node.parent.getComponent(_)){var p=this.node.parent.getComponent(A),v=.5*p.width,g=.5*p.height,E=.1*v-v,k=g-.1*g,D=this.node.getChildByName("MiscMode"),L=T(D);L.parent=this.node,L.name="Buttons";var O=T(D);O.parent=this.node,O.name="Titles";for(var M=0;M<2;M++){var x=T(this.EnableAllCompositeModeButton.getChildByName("Label"));x.setPosition(E+(M>0?450:150),k,0),x.setScale(.75,.75,.75),x.parent=O;var F=x.getComponent(I);F.string=M?"----------Composite Mode----------":"----------Single Mode----------",F.color=C.WHITE,F.overflow=0,this.labelComponentList[this.labelComponentList.length]=F}k-=20;for(var B=0,U=0;U<this.strSingle.length;U++,B++){U===this.strSingle.length>>1&&(E+=200,B=0);var z=U?T(this.singleModeToggle):this.singleModeToggle;z.setPosition(E,k-20*B,0),z.setScale(.5,.5,.5),z.parent=this.singleModeToggle.parent;var G=z.getComponentInChildren(R);G.string=this.strSingle[U],this.textComponentList[this.textComponentList.length]=G,this.textContentList[this.textContentList.length]=G.string,z.on(P.EventType.TOGGLE,this.toggleSingleMode,this),this.singleModeToggleList[U]=z}E+=200,this.EnableAllCompositeModeButton.setPosition(E+15,k,0),this.EnableAllCompositeModeButton.setScale(.5,.5,.5),this.EnableAllCompositeModeButton.on(N.EventType.CLICK,this.enableAllCompositeMode,this),this.EnableAllCompositeModeButton.parent=L;var Y=this.EnableAllCompositeModeButton.getComponentInChildren(I);this.labelComponentList[this.labelComponentList.length]=Y;var j=T(this.EnableAllCompositeModeButton);j.setPosition(E+90,k,0),j.setScale(.5,.5,.5),j.on(N.EventType.CLICK,this.changeTextColor,this),j.parent=L,(Y=j.getComponentInChildren(I)).string="TextColor",this.labelComponentList[this.labelComponentList.length]=Y;var H=T(this.EnableAllCompositeModeButton);H.setPosition(E+200,k,0),H.setScale(.5,.5,.5),H.on(N.EventType.CLICK,this.hideUI,this),H.parent=this.node.parent,(Y=H.getComponentInChildren(I)).string="Hide UI",this.labelComponentList[this.labelComponentList.length]=Y,this.hideButtonLabel=Y,k-=40;for(var V=0;V<this.strMisc.length;V++){var q=T(this.compositeModeToggle);q.setPosition(E,k-20*V,0),q.setScale(.5,.5,.5),q.parent=D;var W=q.getComponentInChildren(R);W.string=this.strMisc[V],this.textComponentList[this.textComponentList.length]=W,this.textContentList[this.textContentList.length]=W.string,q.getComponent(P).isChecked=!!V,q.on(P.EventType.TOGGLE,V?this.toggleLightingWithAlbedo:this.toggleCSMColoration,this),this.miscModeToggleList[V]=q}k-=150;for(var K=0;K<this.strComposite.length;K++){var X=K?T(this.compositeModeToggle):this.compositeModeToggle;X.setPosition(E,k-20*K,0),X.setScale(.5,.5,.5),X.parent=this.compositeModeToggle.parent;var J=X.getComponentInChildren(R);J.string=this.strComposite[K],this.textComponentList[this.textComponentList.length]=J,this.textContentList[this.textContentList.length]=J.string,X.on(P.EventType.TOGGLE,this.toggleCompositeMode,this),this.compositeModeToggleList[K]=X}}else console.error("debug-view-runtime-control should be child of Canvas")}},{key:"isTextMatched",value:function(p,v){var g=new String(p),E=g.search(">");return -1===E?p===v:(g=(g=g.substr(E+1)).substr(0,g.search("<")))===v}},{key:"toggleSingleMode",value:function(p){for(var v=D.root.debugView,g=p.getComponentInChildren(R),E=0;E<this.strSingle.length;E++)this.isTextMatched(g.string,this.strSingle[E])&&(v.singleMode=E)}},{key:"toggleCompositeMode",value:function(p){for(var v=D.root.debugView,g=p.getComponentInChildren(R),E=0;E<this.strComposite.length;E++)this.isTextMatched(g.string,this.strComposite[E])&&v.enableCompositeMode(E,p.isChecked)}},{key:"toggleLightingWithAlbedo",value:function(p){D.root.debugView.lightingWithAlbedo=p.isChecked}},{key:"toggleCSMColoration",value:function(p){D.root.debugView.csmLayerColoration=p.isChecked}},{key:"enableAllCompositeMode",value:function(p){var v=D.root.debugView;v.enableAllCompositeMode(!0);for(var g=0;g<this.compositeModeToggleList.length;g++)this.compositeModeToggleList[g].getComponent(P).isChecked=!0;var E=this.miscModeToggleList[0].getComponent(P);E.isChecked=!1,v.csmLayerColoration=!1,(E=this.miscModeToggleList[1].getComponent(P)).isChecked=!0,v.lightingWithAlbedo=!0}},{key:"hideUI",value:function(p){var v=this.node.getChildByName("Titles"),g=!v.active;this.singleModeToggleList[0].parent.active=g,this.miscModeToggleList[0].parent.active=g,this.compositeModeToggleList[0].parent.active=g,this.EnableAllCompositeModeButton.parent.active=g,v.active=g,this.hideButtonLabel.string=g?"Hide UI":"Show UI"}},{key:"changeTextColor",value:function(p){this._currentColorIndex++,this._currentColorIndex>=this.strColor.length&&(this._currentColorIndex=0);for(var v=0;v<this.textComponentList.length;v++)this.textComponentList[v].string=this.strColor[this._currentColorIndex]+this.textContentList[v]+"</color>";for(var g=0;g<this.labelComponentList.length;g++)this.labelComponentList[g].color=this.color[this._currentColorIndex]}},{key:"onLoad",value:function(){}},{key:"update",value:function(p){}}]),n}(L)).prototype,"compositeModeToggle",[eG],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),eq=Ye(eH.prototype,"singleModeToggle",[eY],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),eW=Ye(eH.prototype,"EnableAllCompositeModeButton",[ej],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),eH));g._RF.pop(),g._RF.push({},"95972yG/ulEg4gycbc+QB5Y","ComponentUtils",void 0);var eJ,eQ,eZ,e$,e0,e1,e2,e4,e3=GameCore.Utils,e5=e3.Array,e6=e3.Object,e9=e3.Valid,e8=["cc.Mask","cc.Label","cc.Canvas","cc.Camera","cc.Layout","cc.Button","cc.Sprite","cc.Widget","cc.Renderer","cc.Animation","cc.UIOpacity"],e7=function(){function e(){Ce(this,e),this.validComponentCalled={}}return Ae(e,[{key:"validateRequiredComponents",value:function(p){var v,g=p.name,E=p.constructor,k=We(this.getRequiredComponentNames(E));try{for(k.s();!(v=k.n()).done;){var C=v.value;if(!p.getComponent(C))throw new Error("".concat(g,": Missing required ").concat(C," component"))}}catch(p){k.e(p)}finally{k.f()}}},{key:"validateRequiredProperties",value:function(p){var v,g=p.name,E=p.constructor,k=We(this.getRequiredPropNames(E));try{for(k.s();!(v=k.n()).done;){var C=v.value;if(!e6.hasOwn(p,C))throw new Error("".concat(g,": Missing required ").concat(C," property"));var _=this.getProperty(C,p);if(!O(_))throw new Error("".concat(g,": ").concat(C," property is not a cc object"))}}catch(p){k.e(p)}finally{k.f()}}},{key:"validateCustomProperties",value:function(p){var v,g=p.name,E=We(this.getCustomPropNames(p));try{for(E.s();!(v=E.n()).done;){var k=v.value;if(!e6.hasOwn(p,k))throw new Error("".concat(g,": Missing required ").concat(k," property"));var C=this.getProperty(k,p);if(!O(C))throw new Error("".concat(g,": ").concat(k," property is not a cc object"))}}catch(p){E.e(p)}finally{E.f()}}},{key:"getProperty",value:function(p,v){var g;if(e6.hasOwn(v,p))return(null!==(g=Object.getOwnPropertyDescriptor(v,p))&&void 0!==g?g:{}).value}},{key:"getProps",value:function(p){if(!e6.hasOwn(p,"__props__"))return[];var v=p.__props__;return Array.isArray(v)?v:[]}},{key:"getRequiredPropNames",value:function(p){return this.getProps(p).filter(function(v){return"node"!==v&&!!e6.hasOwn(p,v)&&!!O(p[v])&&v.indexOf("_")<0})}},{key:"getBaseComponentName",value:function(p){for(var v=0,g=e8;v<g.length;v++){var E=g[v];if(E.indexOf(p)>=0)return E}return p}},{key:"getRequiredComponentNames",value:function(p){var v=this;if(!e6.hasOwn(p,"_requireComponent"))return[];var g=p._requireComponent;return Array.isArray(g)?g.map(function(p){return v.getBaseComponentName(p)}):[]}},{key:"getCustomPropNames",value:function(p){var v=this,g=Object.keys(p),E=this.getProps(p.constructor);return e5.difference(g,E).filter(function(p){return p.indexOf("_")<0}).filter(function(g){if(!e6.hasOwn(p,g))return!1;var E=v.getProperty(g,p);return!(!e9.isObject(E)||!O(E))})}}],[{key:"inst",get:function(){return this._instance||(this._instance=new e),this._instance}},{key:"lazyValidateProperties",value:function(p,v){var g=!(arguments.length>1&&void 0!==v)||v;if(g){var E=p.constructor,k=E.name;if(!this.inst.validComponentCalled[k])try{this.inst.validateRequiredComponents(p),this.inst.validateRequiredProperties(p),this.inst.validateCustomProperties(p)}catch(v){p.enabled=!1,console.error(v)}finally{this.inst.validComponentCalled[k]=!0}}}}]),e}();try{new e7}catch(p){console.error("ComponentUtils",p)}g._RF.pop(),g._RF.push({},"60ac3vor0dMT5bXi8D3VSJN","BubbleAnimation",void 0);var te=E.ccclass,tt=E.property,tn=GameCore.Utils.Array;eJ=te("BubbleAnimation"),eQ=tt(M),eZ=tt(x),e$=tt(F),eJ((e1=Ye((e0=function(p){Ie(n,p);var v=xe(n);function n(){var p;Ce(this,n);for(var g=arguments.length,E=new Array(g),k=0;k<g;k++)E[k]=arguments[k];return je(p=v.call.apply(v,[this].concat(E)),"animation",e1,Ne(p)),je(p,"clipName",e2,Ne(p)),je(p,"repeat",e4,Ne(p)),p.currentRepeat=-1,p}return Ae(n,[{key:"__preload",value:function(){this.animation=this.getComponent(M),this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){e7.lazyValidateProperties(this)}},{key:"play",value:function(){var p=this;this.animation&&(tn.search(this.animation.clips,function(v){return(null==v?void 0:v.name)===p.clipName})?(this.currentRepeat=-1,this.animation.play(this.clipName)):console.warn("BubbleAnimation: Animation component must have ".concat(this.clipName," clip")))}},{key:"onBubbleAnimationLoop",value:function(){this.animation&&-1!==this.repeat&&(this.currentRepeat++,this.currentRepeat>this.repeat&&this.animation.stop())}}]),n}(L)).prototype,"animation",[eQ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),e2=Ye(e0.prototype,"clipName",[eZ],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"Bubble"}}),e4=Ye(e0.prototype,"repeat",[e$],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return -1}}),e0));g._RF.pop(),g._RF.push({},"cc0a5OvhdRCMZRZuRscaz+7","AudioPlayer",void 0);var ti=function(p){Ie(n,p);var v=xe(n);function n(p,g){var E;return Ce(this,n),(E=v.call(this,p)).audioSource=g,E}return Ae(n,[{key:"play",value:function(p){if(p){var v=p.volume,g=void 0===v?1:v,E=p.loop,k=void 0!==E&&E;this.audioSource.volume=g,this.audioSource.loop=k}this.audioSource.play()}},{key:"pause",value:function(){this.audioSource.pause()}},{key:"resume",value:function(){this.audioSource.state===B.AudioState.PAUSED&&this.audioSource.play()}},{key:"stop",value:function(){this.audioSource.stop()}},{key:"setVolume",value:function(p){this.audioSource.volume=p}},{key:"getAudioSource",value:function(){return this.audioSource}}]),n}(GameCore.Plugins.Audio.BaseAudioPlayer);g._RF.pop(),g._RF.push({},"8b5ecHv/+BJiorK1kiVbTcf","AudioChannel",void 0);var ta=GameCore,tr=ta.Plugins.Audio.BaseChannelManager,to=ta.Utils.Array,ts=function(p){Ie(i,p);var v,g=xe(i);function i(p,v){var E;return Ce(this,i),(E=g.call(this,v)).allowMultipleTracking={},E.handleLoadedAudio=function(p,v){var g=E.node.addComponent(B);return g.clip=v,g.playOnAwake=!1,new ti(p,g)},E.node=p,E}return Ae(i,[{key:"playing",value:function(p){var v,g=null===(v=this.getAudioClip(p))||void 0===v?void 0:v.audioPlayer;return!!g&&g.getAudioSource().state===B.AudioState.PLAYING}},{key:"onLoadAudio",value:(v=Ee(function(p,v){var g;return _ts_generator(this,function(v){g=this;return[2,new Promise(function(v,E){U.load(p,z,function(k,C){try{if(k)throw new Error(k.message);if(!g.node.isValid)return;var _=g.handleLoadedAudio(p,C);v(_)}catch(p){_instanceof(p,Error)?E(p):E(new Error("Audio load: Unknown error"))}})})]})}),function(p,g){return v.apply(this,arguments)})},{key:"playWithRealConfig",value:function(p,v){if(this.isCanPlay(v)){if(v){var g=v.volume,E=void 0===g?1:g,k=v.allowMultiple,C=void 0!==k&&k;if(v.volume=this.getVolume()*E,C)return void this.requestDuplicateAudioPlayer(p.getKey(),p.getAudioSource().clip,v).play(v)}p.play(v)}}},{key:"isCanPlay",value:function(p){var v=this;if(p){var g=p.checkList;if((void 0===g?[]:g).some(function(p){var g=v.getAudioClip(p);return!!g&&g.audioPlayer.getAudioSource().state===B.AudioState.PLAYING}))return!1}return!0}},{key:"requestDuplicateAudioPlayer",value:function(p,v,g){var E=this.getDuplicateAudioFromPool(p);if(E){if(g){var k=E.key,C=g.volume,_=void 0===C?1:C;this.setAudioClip(k,{volume:_})}return E.audioPlayer}var A="".concat(p,"_").concat(this.allowMultipleTracking[p].currentPostFix),T=this.handleLoadedAudio(A,v);return this.allowMultipleTracking[p].list.push({audioPlayer:T,key:A}),this.allowMultipleTracking[p].currentPostFix+=1,this.setAudioClip(A,{audioPlayer:T,volume:1}),T}},{key:"getDuplicateAudioFromPool",value:function(p){if(this.allowMultipleTracking[p]){var v=this.allowMultipleTracking[p].list,g=to.search(v,function(p){return p.audioPlayer.getAudioSource().state!==B.AudioState.PLAYING});if(g)return g}else this.allowMultipleTracking[p]={currentPostFix:1,list:[]};return null}}]),i}(tr);g._RF.pop();var tl,tu,tc,th,td;g._RF.push({},"1a025mmN7BL7r5cF6gWR4b/","Music",void 0);var tp,tf,ty,tv,tg,tm=E.ccclass,tb=E.property,tw=globalThis.game,tS=tw.audio,tE=tw.player,tk=(tl=tm("Music"),tu=tb(x),tl((td=Ye((th=function(p){Ie(n,p);var v=xe(n);function n(){var p;Ce(this,n);for(var g=arguments.length,E=new Array(g),k=0;k<g;k++)E[k]=arguments[k];return je(p=v.call.apply(v,[this].concat(E)),"channelId",td,Ne(p)),p.channel=null,p}return Ae(n,[{key:"__preload",value:function(){this.makePersistent(),this.channel=new ts(this.node,this.channelId),tS.addChannel(this.channel)}},{key:"makePersistent",value:function(){D.addPersistRootNode(this.node)}},{key:"playing",value:function(p){var v,g;return null!==(v=null===(g=this.channel)||void 0===g?void 0:g.playing(p))&&void 0!==v&&v}},{key:"play",value:function(p,v){var g;this.isMusicEnable()&&(null!==(g=v)&&void 0!==g&&g.loop||(v=we(we({},v),{},{loop:!0})),tS.play(p,v,this.channelId))}},{key:"isMusicEnable",value:function(){return!!tE.getPlayerSetting("music")}},{key:"setVolume",value:function(p){tS.setVolume(p,this.channelId)}},{key:"pause",value:function(p){tS.pause(p,this.channelId)}},{key:"resume",value:function(p){this.isMusicEnable()&&tS.resume(p,this.channelId)}},{key:"stop",value:function(p){tS.stop(p,this.channelId)}},{key:"mute",value:function(p){p?tS.mute(this.channelId):tS.unmute(this.channelId)}}]),n}(L)).prototype,"channelId",[tu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"global_music"}}),tc=th))||tc);g._RF.pop(),g._RF.push({},"1299a7X1XNNEKxSKMV6E5jQ","Sound",void 0);var tC=E.ccclass,t_=E.property,tA=globalThis.game,tT=tA.audio,tI=tA.player,tR=(tp=tC("Sound"),tf=t_(x),tp((tg=Ye((tv=function(p){Ie(n,p);var v=xe(n);function n(){var p;Ce(this,n);for(var g=arguments.length,E=new Array(g),k=0;k<g;k++)E[k]=arguments[k];return je(p=v.call.apply(v,[this].concat(E)),"channelId",tg,Ne(p)),p.channel=null,p}return Ae(n,[{key:"__preload",value:function(){this.channel=new ts(this.node,this.channelId),tT.addChannel(this.channel)}},{key:"onLoad",value:function(){""===this.channelId&&(this.channelId=this.node.uuid)}},{key:"makePersistent",value:function(){D.addPersistRootNode(this.node)}},{key:"removePersistent",value:function(){D.removePersistRootNode(this.node)}},{key:"play",value:function(p,v){this.isSoundEnable()&&tT.play(p,v,this.channelId)}},{key:"isSoundEnable",value:function(){return!!tI.getPlayerSetting("sound")}},{key:"setVolume",value:function(p){tT.setVolume(p,this.channelId)}},{key:"pause",value:function(p){tT.pause(p,this.channelId)}},{key:"resume",value:function(p){this.isSoundEnable()&&tT.resume(p,this.channelId)}},{key:"stop",value:function(p){tT.stop(p,this.channelId)}},{key:"stopAll",value:function(){tT.stopAll(this.channelId)}},{key:"mute",value:function(p){p?tT.mute(this.channelId):tT.unmute(this.channelId)}}]),n}(L)).prototype,"channelId",[tf],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),ty=tv))||ty);g._RF.pop(),g._RF.push({},"99b8eEF6WlE8pzPfD+whiJu","AnimUtils",void 0);var tP,tN,tD,tL,tO,tM,tx,tF,tB,tU,tz,tG,tY,tj,tH,tV,tq,tW,tK,tX,tJ=function(){function e(){Ce(this,e)}return Ae(e,null,[{key:"inst",get:function(){return this._instance||(this._instance=new e),this._instance}},{key:"elasticOut",value:function(p,v,g){if(void 0===v&&(v=.1),void 0===g&&(g=.1),0===p)return 0;if(1===p)return 1;var E=g/4;return v<1?v=1:E=g*Math.asin(1/v)/(2*Math.PI),v*Math.pow(2,-10*p)*Math.sin(2*Math.PI*(p-E)/g)+1}},{key:"easeOutExpo",value:function(p){return 1===p?1:1-Math.pow(2,-10*p)}},{key:"easeInExpo",value:function(p){return 0===p?0:Math.pow(2,10*p-10)}},{key:"runTweenAsync",value:function(p,v){return new Promise(function(g){var E=p.call(function(){g({tween:p})}).start();v&&(v.aborted?(E.stop(),g({tween:p})):v.addAbortListener(function(){E.stop(),g({tween:p})}))})}},{key:"runOnUpdateAsync",value:function(p,v,g,E){return new Promise(function(k,C){var _=G(p).to(v,{},{onUpdate:function(p,v){if(void 0!==v)try{g(v)}catch(p){C(_instanceof(p,Error)?p:new Error(JSON.stringify(p)))}}}).call(function(){k({tween:_})}).start();E&&(E.aborted?(_.stop(),k({tween:_})):E.addAbortListener(function(){_.stop(),k({tween:_})}))})}},{key:"waitTweenAsync",value:function(p,v){return new Promise(function(g){var E=G({});E.delay(p),E.call(function(){g()}),E.start(),v&&(v.aborted?(E.stop(),g()):v.addAbortListener(function(){E.stop(),g()}))})}},{key:"runAnimationAsync",value:function(p,v){return new Promise(function(g){p.play(v),p.once(M.EventType.FINISHED,function(){g()})})}}]),e}();try{new tJ}catch(p){console.error("AnimUtils",p)}g._RF.pop(),g._RF.push({},"84a2dB5IaRJ8JB+n9yXfBc7","AutoLayout",void 0);var tQ,tZ,t$,t0,t1=E.ccclass,t2=E.property,t4=(tP=t1("AutoLayoutWrappee"),tN=t2({type:A}),tD=t2({type:A}),tP((tM=Ye((tO=Ae(function e(){Ce(this,e),je(this,"wrapeeContainer",tM,this),je(this,"wrapee",tx,this)})).prototype,"wrapeeContainer",[tN],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),tx=Ye(tO.prototype,"wrapee",[tD],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),tL=tO))||tL),t3=(tF=t1("AutoLayout"),tB=t2({displayName:"Use Auto Layout"}),tU=t2({type:[t4],displayName:"Children",visible:function(){return this.useAutoLayout}}),tz=t2({visible:!1,serializable:!0}),tG=t2({type:F,displayName:"Selected Index",visible:function(){return this.useAutoLayout}}),tY=t2({type:Y,displayName:"Deselected Icon Width",group:"Edge Icons",visible:function(){return this.useAutoLayout}}),tj=t2({visible:!1,serializable:!0}),tF((tq=Ye((tV=function(p){Ie(i,p);var v,g=xe(i);function i(){var p;Ce(this,i);for(var v=arguments.length,E=new Array(v),k=0;k<v;k++)E[k]=arguments[k];return je(p=g.call.apply(g,[this].concat(E)),"useAutoLayout",tq,Ne(p)),je(p,"children",tW,Ne(p)),p.mappedChildren=[],je(p,"selected",tK,Ne(p)),je(p,"deselectedIconW",tX,Ne(p)),p.tweens=[],p}return Ae(i,[{key:"selectedIndex",get:function(){return this.selected},set:function(p){this.selected=p,this.updateLayout(!0)}},{key:"deselectedIconWidth",get:function(){return this.deselectedIconW},set:function(p){this.deselectedIconW=p,this.updateLayout(!0)}},{key:"__preload",value:function(){this.mappedChildren=this.children.map(function(p){var v=p.wrapeeContainer.getComponent(j);if(!v)throw new Error("AutoLayout: Widget component not found");return we(we({},p),{},{wrapeeContainerWidget:v})})}},{key:"updateLayout",value:function(p){var v=arguments.length>0&&void 0!==p&&p;(this._layoutDirty||v)&&(this.updateChildrenAnchors(),this.mappedChildren.forEach(function(p){return p.wrapeeContainerWidget.updateAlignment()})),Fe(Pe(i.prototype),"updateLayout",this).call(this,v)}},{key:"getSelectedWorldX",value:function(){var p=this.mappedChildren[this.selectedIndex].wrapeeContainer;return 0===this.selectedIndex||this.selectedIndex===this.children.length-1?p.getBoundingBoxToWorld().xMin+this.getAnchorX(this.selectedIndex)*p.width:p.getBoundingBoxToWorld().center.x}},{key:"getAnchorX",value:function(p){if(p<this.selectedIndex)return 0;if(p>this.selectedIndex)return 1;if(0===p){var v=this.mappedChildren[p].wrapeeContainer.width,g=this.deselectedIconWidth/2,E=this.paddingLeft;return((E+v+(v-g+this.spacingX))/2-E)/v}if(p===this.children.length-1){var k=this.mappedChildren[p].wrapeeContainer.width,C=k-this.deselectedIconWidth/2+this.spacingX;return((C+k+this.paddingRight)/2-C)/k}return .5}},{key:"updateChildrenAnchors",value:(v=Ee(function(){var p;return _ts_generator(this,function(v){switch(v.label){case 0:p=this;this.tweens.forEach(function(p){return p.stop()}),this.tweens=[];return[4,Promise.all([this.children.flatMap(function(v,g){return p.getChildrenAnchorsTweens(v,p.getAnchorX(g))}).map(function(p){return tJ.runTweenAsync(p)})])];case 1:v.sent();return[2]}})}),function(){return v.apply(this,arguments)})},{key:"updateChildrenAnchorsEditor",value:function(){var p=this;this.children.forEach(function(v,g){var E=p.getAnchorX(g);v.wrapee.setAnchorPoint(E,v.wrapee.anchorY),v.wrapeeContainer.setAnchorPoint(E,v.wrapeeContainer.anchorY)})}},{key:"getChildrenAnchorsTweens",value:function(p,v){return[G(p.wrapee).to(.3,{anchorX:v},{easing:"sineInOut"}).call(function(){p.wrapee.setAnchorPoint(v,p.wrapee.anchorY)}),G(p.wrapeeContainer).to(.3,{anchorX:v},{easing:"sineInOut"}).call(function(){p.wrapeeContainer.setAnchorPoint(v,p.wrapeeContainer.anchorY)})]}}]),i}(H)).prototype,"useAutoLayout",[tB],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),tW=Ye(tV.prototype,"children",[tU],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),tK=Ye(tV.prototype,"selected",[tz],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Ye(tV.prototype,"selectedIndex",[tG],Object.getOwnPropertyDescriptor(tV.prototype,"selectedIndex"),tV.prototype),Ye(tV.prototype,"deselectedIconWidth",[tY],Object.getOwnPropertyDescriptor(tV.prototype,"deselectedIconWidth"),tV.prototype),tX=Ye(tV.prototype,"deselectedIconW",[tj],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),tH=tV))||tH);g._RF.pop(),g._RF.push({},"ca427NpeqpC3bUoGTd9I/BM","Background",void 0);var t5=E.ccclass,t6=E.property;tQ=t5("Background"),tZ=t6({type:V}),tQ((t0=Ye((t$=function(p){Ie(n,p);var v=xe(n);function n(){var p;Ce(this,n);for(var g=arguments.length,E=new Array(g),k=0;k<g;k++)E[k]=arguments[k];return je(p=v.call.apply(v,[this].concat(E)),"sprite",t0,Ne(p)),p}return Ae(n,[{key:"__preload",value:function(){this.validateRequiredComponents(),this.listenGameEvents()}},{key:"validateRequiredComponents",value:function(){e7.lazyValidateProperties(this)}},{key:"listenGameEvents",value:function(){}}]),n}(L)).prototype,"sprite",[tZ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),t$));g._RF.pop(),g._RF.push({},"bf320amyc1I86bS3oK0M9NR","DashboardEvents",void 0);var t9="STARS_UPDATED",t8="PLAY_BUTTON_PRESS",t7="REQUEST_NAVIGATION",ne="REQUEST_NAVIGATION_ANIMATION",nt="DASHBOARD_EVENTS_BUTTON_PRESS";g._RF.pop(),g._RF.push({},"68b8bf0Va5JT7NVPECDNC5l","DashboardScreens",void 0);var nn=function(p){return p[p.store=0]="store",p[p.collections=1]="collections",p[p.home=2]="home",p[p.leaderboard=3]="leaderboard",p[p.tournaments=4]="tournaments",p}(nn||{});q(nn),g._RF.pop(),g._RF.push({},"a0756pde9lOeoJ4TckTOcMV","AnimAbortSignal",void 0);var ni=GameCore.Utils.Array,na=function(){function e(){Ce(this,e),this.callbacks=[],this.isAborted=!1,this.abortReason="",this.callbacks=[]}var p;return Ae(e,[{key:"aborted",get:function(){return this.isAborted}},{key:"reason",get:function(){return this.abortReason}},{key:"addAbortListener",value:function(p){this.callbacks.push(p)}},{key:"removeAbortListener",value:function(p){var v=ni.searchIndex(this.callbacks,function(v){return v===p});-1!==v?this.callbacks.splice(v,1):console.warn("Abort listener not found")}},{key:"abort",value:function(p){this.isAborted||(this.isAborted=!0,this.abortReason=p,this.callbacks.forEach(function(p){return p()}),this.callbacks=[])}},{key:"untilAborted",value:(p=Ee(function(){var p;return _ts_generator(this,function(v){p=this;if(!this.isAborted)return[2,new Promise(function(v){p.addAbortListener(function(){return v()})})];return[2]})}),function(){return p.apply(this,arguments)})}],[{key:"hasBeenAborted",value:function(p){return null==p||p.aborted}}]),e}();g._RF.pop(),g._RF.push({},"a6e4bjV/RVH17qBEx1mZaFg","ResourcePaths",void 0);var nr=function(p){return p.BOMB_RESCUE_PREFAB="game-objects/bomb/BombRescue",p.BOMB_EXPLODE_PREFAB="game-objects/bomb/BombExplode",p.BOMB_DEFUSE_PREFAB="game-objects/bomb/DefuseExplode",p.COLLECTIONS_CONTENT_PREFAB="game-objects/dashboard-scene/CollectionsContent",p.CLOUD_IDLE_ANIM="animations/CloudIdle",p.TORNADO_IDLE_ANIM="animations/TornadoIdle",p.TILE_BREAK_ANIM="animations/TileBreak",p.TILE_CLEAR_ANIM="animations/TileClear",p.TILE_SHAKE_ANIM="animations/TileShake",p.TILE_SKIN_FOLDER="loadable/tiles",p.TILE_SKIN_PREVIEW_FOLDER="loadable/tiles-preview",p.ITEM_POPUP_FOLDER="loadable/item-popup",p.SUMMER_BG="images/bg/summer",p.AUTUMN_BG="images/bg/autumn",p.WINTER_BG="images/bg/winter",p.SUMMER_BG_PREVIEW="images/preview/summer",p.AUTUMN_BG_PREVIEW="images/preview/autumn",p.WINTER_BG_PREVIEW="images/preview/winter",p.COLLECTIONS_PAGE="pages/CollectionsContent",p.LEADERBOARD_PAGE="pages/LeaderboardContent",p.TOURNAMENTS_PAGE="pages/TournamentsContent",p.LEVEL_DATA_FOLDER="levels-json",p}(nr||{});g._RF.pop(),g._RF.push({},"2a657+TsltMe4rrDmyWGrLy","ThemeResourcesPath",void 0);var no={summer:nr.SUMMER_BG,autumn:nr.AUTUMN_BG,winter:nr.WINTER_BG},ns={summer:nr.SUMMER_BG_PREVIEW,autumn:nr.AUTUMN_BG_PREVIEW,winter:nr.WINTER_BG_PREVIEW};g._RF.pop(),g._RF.push({},"669a1OtNF9EDrMRLWTjxk4B","GeneralUtils",void 0);var nl,nu,nc,nd,np,nf,ny,nv,ng,nm,nb,nw,nS,nE,nk,nC,n_,nA,nT,nI,nR,nP=function(){function e(){Ce(this,e)}var p,v,g,E,k,C,_,A,T,I;return Ae(e,null,[{key:"inst",get:function(){return this._instance||(this._instance=new e),this._instance}},{key:"setBlockInput",value:function(p){var v=W("Canvas/InputBlocker");v?v.active=p:console.warn("InputBlocker not found")}},{key:"getBlockInput",value:function(){var p=W("Canvas/InputBlocker");return p?p.active:(console.warn("InputBlocker not found"),!1)}},{key:"loadPrefabAsync",value:function(p){var v=U.getInfoWithPath(p,K);if(v&&null!==U.get(v.path,K)){var g=U.get(v.path,K);if(null!==g)return Promise.resolve(g)}return new Promise(function(v){U.load(p,K,function(p,g){v(p?null:g)})})}},{key:"loadJsonAsync",value:(I=Ee(function(p){return _ts_generator(this,function(v){return[2,new Promise(function(v){var g=U.getInfoWithPath(p,X);if(g&&null!==U.get(g.path,X)){var E=U.get(g.path,X);if(null!==E)return void v(E.json)}U.load(p,X,function(p,g){p?v(null):g&&g.json?v(g.json):v(null)})})]})}),function(p){return I.apply(this,arguments)})},{key:"loadAnimClipAsync",value:(T=Ee(function(p){var v,g;return _ts_generator(this,function(E){v=U.getInfoWithPath(p,J);if(v&&null!==U.get(v.path,J)){g=U.get(v.path,J);if(null!==g)return[2,Promise.resolve(g)]}return[2,new Promise(function(v){U.load(p,J,function(p,g){v(p?null:g)})})]})}),function(p){return T.apply(this,arguments)})},{key:"loadImageSpriteFrameAsync",value:(A=Ee(function(p){var v,g;return _ts_generator(this,function(E){v=U.getInfoWithPath(p,Q);if(v&&null!==U.get(v.path,Q)){g=U.get(v.path,Q);if(null!==g)return[2,Promise.resolve(Z.createWithImage(g))]}return[2,new Promise(function(v){U.load(p,Q,function(p,g){v(p?null:Z.createWithImage(g))})})]})}),function(p){return A.apply(this,arguments)})},{key:"loadSpriteFrameAsync",value:(_=Ee(function(p){var v,g,E;var k=arguments;return _ts_generator(this,function(C){v=!(k.length>1&&void 0!==k[1])||k[1],g=U.getInfoWithPath(p,Z);if(g&&null!==U.get(g.path,Z)){E=U.get(g.path,Z);if(null!==E)return[2,(E.packable=v,Promise.resolve(E))]}return[2,new Promise(function(g){U.load(p,Z,function(p,E){!p&&E?(E.packable=v,g(E)):g(null)})})]})}),function(p){return _.apply(this,arguments)})},{key:"loadSpriteFramesDirAsync",value:(C=Ee(function(p){var v,g,E,k,C,_;return _ts_generator(this,function(A){v=U.getDirWithPath(p,Z);if(v.length>0){E=[],k=We(v);try{for(k.s();!(g=k.n()).done;){C=g.value,_=U.get(C.path,Z);if(!_)return[2,this.loadSpriteFramesFromDirAsync(p)];E.push(_)}}catch(p){k.e(p)}finally{k.f()}return[2,E]}return[2,this.loadSpriteFramesFromDirAsync(p)]})}),function(p){return C.apply(this,arguments)})},{key:"loadSpriteFramesFromDirAsync",value:(k=Ee(function(p){return _ts_generator(this,function(v){return[2,new Promise(function(v){U.loadDir(p,Z,function(p,g){v(p?[]:g)})})]})}),function(p){return k.apply(this,arguments)})},{key:"lazyLoadDashboardSceneResourcesAsync",value:(E=Ee(function(){return _ts_generator(this,function(p){return[2,e.loadPrefabAsync(nr.COLLECTIONS_CONTENT_PREFAB)]})}),function(){return E.apply(this,arguments)})},{key:"loadThemeAsync",value:(g=Ee(function(p){return _ts_generator(this,function(v){return[2,this.loadSpriteFrameAsync("".concat(no[p],"/spriteFrame"))]})}),function(p){return g.apply(this,arguments)})},{key:"loadThemePreviewAsync",value:(v=Ee(function(p){return _ts_generator(this,function(v){return[2,this.loadSpriteFrameAsync("".concat(ns[p],"/spriteFrame"))]})}),function(p){return v.apply(this,arguments)})},{key:"loadSkinPreviewAsync",value:(p=Ee(function(p){var v,g,E;return _ts_generator(this,function(k){for(v=[],g=1;g<=4;g++){E="".concat(nr.TILE_SKIN_PREVIEW_FOLDER,"/").concat(p.replace(/-/g,"_"),"_").concat(g,"/spriteFrame");v.push(this.loadSpriteFrameAsync(E))}return[2,Promise.all(v)]})}),function(v){return p.apply(this,arguments)})}]),e}();try{new nP}catch(p){console.error("GeneralUtils",p)}g._RF.pop(),g._RF.push({},"ab9cd/wERRKYqhDoYtJ1L3w","MultiBackground",void 0);var nN=E.ccclass,nD=E.property,nL=globalThis.game.monitorError,nO=GameCore.Utils.Number,nM=(nl=nN("MultiBackground"),nu=nD({type:V}),nc=nD({type:V}),nd=nD({type:A}),np=nD({type:A}),nf=nD({type:A}),ny=nD(F),nv=nD(j),ng=nD({type:$(nn)}),nm=nD({type:$(nn)}),nl((nS=Ye((nw=function(p){Ie(a,p);var v,g,E=xe(a);function a(){var p;Ce(this,a);for(var v=arguments.length,g=new Array(v),k=0;k<v;k++)g[k]=arguments[k];return je(p=E.call.apply(E,[this].concat(g)),"background1",nS,Ne(p)),je(p,"background2",nE,Ne(p)),je(p,"screenUiTransform",nk,Ne(p)),je(p,"background1Uitransform",nC,Ne(p)),je(p,"background2UiTransform",n_,Ne(p)),je(p,"backgroundNudgeAmount",nA,Ne(p)),je(p,"nudgeableWidget",nT,Ne(p)),je(p,"pageOrder",nI,Ne(p)),je(p,"homePage",nR,Ne(p)),p.currentThemeId="",p.tryNudgeBackground=function(v){var g=v.to,E=p.getDirection(p.homePage,g),k=nO.sign(E),C=Math.abs(E),_=p.backgroundNudgeAmount*C,A=Math.min(p.background1Uitransform.width,p.background2UiTransform.width),T=Math.max(0,(A-p.screenUiTransform.width)/2),I=Math.min(T,_)*k;G(p.nudgeableWidget).to(.5,{horizontalCenter:I},{easing:ee.cubicInOut}).start()},p}return Ae(a,[{key:"onLoad",value:function(){this.currentBackground=this.background1,this.nextBackground=this.background2,e7.lazyValidateProperties(this),this.listenToNavigationEvents()}},{key:"onDestroy",value:function(){var p;null===(p=this.tweenSignal)||void 0===p||p.abort(),this.unlistenToNavigationEvents()}},{key:"start",value:function(){var p=this.getComponent(j),v=this.getComponentsInChildren(j);(p?[p].concat(He(v)):v).forEach(function(p){p.updateAlignment()})}},{key:"listenToNavigationEvents",value:function(){this.node.scene.on(ne,this.tryNudgeBackground)}},{key:"unlistenToNavigationEvents",value:function(){this.node.scene.off(ne,this.tryNudgeBackground)}},{key:"getDirection",value:function(p,v){var g=this.pageOrder.indexOf(p),E=this.pageOrder.indexOf(v);return -1===g||-1===E?(null==nL||nL.sendException(new Error("MultiBackground.getDirection: fromIndex or toIndex is -1")),0):g-E}},{key:"setCurrentTheme",value:(g=Ee(function(p){var v;return _ts_generator(this,function(g){switch(g.label){case 0:return[4,nP.loadThemeAsync(p)];case 1:v=g.sent();v?(v.packable=!1,this.background1.spriteFrame=v,this.background2.spriteFrame=v,this.currentThemeId=p):null==nL||nL.sendException(new Error("MultiBackground.setCurrentTheme: Failed to load theme ".concat(p,"'s sprite.")));return[2]}})}),function(p){return g.apply(this,arguments)})},{key:"animateToNextTheme",value:(v=Ee(function(p){var v,g,E,k;return _ts_generator(this,function(C){switch(C.label){case 0:if(this.currentThemeId===p)return[2,Promise.resolve()];return[4,nP.loadThemeAsync(p)];case 1:g=C.sent();if(!g)return[3,3];g.packable=!1,this.currentThemeId=p,this.nextBackground.node.active=!0,this.nextBackground.spriteFrame=g,this.nextBackground.node.setSiblingIndex(1);E=this.nextBackground.getComponent(et);if(!E)throw new Error("".concat(this.nextBackground.node.name," UIOpacity is required"));E.opacity=0,null===(v=this.tweenSignal)||void 0===v||v.abort(),this.tweenSignal=new na;return[4,tJ.runTweenAsync(G(E).to(1,{opacity:255}),this.tweenSignal)];case 2:if(C.sent(),!this.tweenSignal.aborted){this.currentBackground.node.active=!1;k=this.currentBackground;this.currentBackground=this.nextBackground,this.nextBackground=k}return[3,4];case 3:null==nL||nL.sendException(new Error("MultiBackground.animateToNextTheme: Failed to load theme ".concat(p,"'s sprite.")));C.label=4;case 4:return[2]}})}),function(p){return v.apply(this,arguments)})}]),a}(L)).prototype,"background1",[nu],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),nE=Ye(nw.prototype,"background2",[nc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),nk=Ye(nw.prototype,"screenUiTransform",[nd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),nC=Ye(nw.prototype,"background1Uitransform",[np],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),n_=Ye(nw.prototype,"background2UiTransform",[nf],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),nA=Ye(nw.prototype,"backgroundNudgeAmount",[ny],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 50}}),nT=Ye(nw.prototype,"nudgeableWidget",[nv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),nI=Ye(nw.prototype,"pageOrder",[ng],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),nR=Ye(nw.prototype,"homePage",[nm],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return nn.home}}),nb=nw))||nb);g._RF.pop(),g._RF.push({},"d159egaUVVLHKLg1UL865ub","SoundKeys",void 0);var nx="sounds/",nF=GameCore.Utils.Object,nB={BUTTON_CLICK:"".concat(nx,"use_item_click"),BOMB_DEFUSE:"".concat(nx,"bomb_defuse"),BOMB_EXPLODE_1:"".concat(nx,"bomb_explode_1"),BOMB_EXPLODE_2:"".concat(nx,"bomb_explode_2"),CLICKS:"".concat(nx,"clicks"),CLOSE_POPUP_CLICK:"".concat(nx,"close_popup_click"),COLLECT_STARS:"".concat(nx,"collect_stars"),COMBO_1:"".concat(nx,"combo_1"),COMBO_2:"".concat(nx,"combo_2"),COMBO_3:"".concat(nx,"combo_3"),COMBO_4:"".concat(nx,"combo_4"),COMBO_5:"".concat(nx,"combo_5"),DAILY_REWARD:"".concat(nx,"daily_reward"),EXTRA_TIME_SPAWN:"".concat(nx,"extra_time_spawn"),GIFT_CHARGE:"".concat(nx,"gift_charge"),GIFT_EXPLODE:"".concat(nx,"gift_explode"),GIFT_REVEAL:"".concat(nx,"gift_reveal"),HINT_ITEM:"".concat(nx,"hint_item"),INVALID_MATCH:"".concat(nx,"invalid_match"),LEVEL_COMPLETE:"".concat(nx,"level_complete"),LEVEL_FAIL:"".concat(nx,"level_fail"),LEVEL_START:"".concat(nx,"level_start"),PROGRESS_STAR:"".concat(nx,"progress_star"),RESCUE_TIMER:"".concat(nx,"rescue_timer"),ROCKET_FLY:"".concat(nx,"rocket_fly"),SHUFFLE_ITEM:"".concat(nx,"shuffle_item"),THREE_STARS:"".concat(nx,"three_stars"),TICKING_BOMB_BEFORE_EXPLODE:"".concat(nx,"ticking_bomb_before_explode"),TILE_SELECT:"".concat(nx,"tile_select"),USE_ITEM_CLICK:"".concat(nx,"use_item_click"),BG_MUSIC:"".concat("musics/","bg_music"),PATCH_SHIFT:"".concat(nx,"patch_shift"),THUNDERBOLT:"".concat(nx,"thunderbolt"),WIND:"".concat(nx,"wind"),COLLECT_COINS:"".concat(nx,"collect_coins"),COLLECT_STOCK_COINS:"".concat(nx,"collect_stock_coins"),LEVEL_FAIL_TIMEOUT:"".concat(nx,"level_fail_timeout"),STAR_CHEST_DRUM_ROLL:"".concat(nx,"star_chest_drum_roll"),STAR_CHEST_OPEN:"".concat(nx,"star_chest_open"),LEADERBOARD_TRIUMPH:"".concat(nx,"leaderboard_triumph"),ITEM_REWARD:"".concat(nx,"item_reward")},nU=nF.vals(nB),nz=nU.reduce(function(p,v,g){return we(we({},p),{},Re({},v,g))},{});q(nz);var nG,nY,nj=nU;g._RF.pop(),g._RF.push({},"0eeb868JeVE67iFwhbkRCmE","ScreenKeys",void 0);var nH=function(p){return p[p.RESCUES_SCREEN=0]="RESCUES_SCREEN",p[p.LOADING_SCREEN=1]="LOADING_SCREEN",p[p.GET_ITEM_SCREEN=2]="GET_ITEM_SCREEN",p[p.GET_COIN_SCREEN=3]="GET_COIN_SCREEN",p[p.SETTINGS_SCREEN=4]="SETTINGS_SCREEN",p[p.START_LEVEL_SCREEN=5]="START_LEVEL_SCREEN",p[p.NOTIFICATION_SCREEN=6]="NOTIFICATION_SCREEN",p[p.LEVEL_COMPLETE_SCREEN=7]="LEVEL_COMPLETE_SCREEN",p[p.CONGRATULATION_SCREEN=8]="CONGRATULATION_SCREEN",p[p.QUIT_LEVEL_SCREEN=9]="QUIT_LEVEL_SCREEN",p[p.TOURNAMENT_DETAIL_SCREEN=10]="TOURNAMENT_DETAIL_SCREEN",p[p.DAILY_REWARDS_SCREEN=11]="DAILY_REWARDS_SCREEN",p[p.STAR_CHEST_SCREEN=12]="STAR_CHEST_SCREEN",p}(nH||{}),nV=(Re(nG={},nH.RESCUES_SCREEN,"RescuesScreen"),Re(nG,nH.LOADING_SCREEN,"LoadingScreen"),Re(nG,nH.GET_ITEM_SCREEN,"GetItemScreen"),Re(nG,nH.GET_COIN_SCREEN,"GetCoinScreen"),Re(nG,nH.SETTINGS_SCREEN,"SettingsScreen"),Re(nG,nH.START_LEVEL_SCREEN,"StartLevelScreen"),Re(nG,nH.NOTIFICATION_SCREEN,"NotificationScreen"),Re(nG,nH.LEVEL_COMPLETE_SCREEN,"LevelCompleteScreen"),Re(nG,nH.CONGRATULATION_SCREEN,"CongratulationScreen"),Re(nG,nH.QUIT_LEVEL_SCREEN,"QuitLevelScreen"),Re(nG,nH.TOURNAMENT_DETAIL_SCREEN,"TournamentDetailScreen"),Re(nG,nH.DAILY_REWARDS_SCREEN,"DailyRewardsScreen"),Re(nG,nH.STAR_CHEST_SCREEN,"StarChestScreen"),nG),nq=(Re(nY={},nV[nH.RESCUES_SCREEN],nH.RESCUES_SCREEN),Re(nY,nV[nH.LOADING_SCREEN],nH.LOADING_SCREEN),Re(nY,nV[nH.GET_ITEM_SCREEN],nH.GET_ITEM_SCREEN),Re(nY,nV[nH.GET_COIN_SCREEN],nH.GET_COIN_SCREEN),Re(nY,nV[nH.SETTINGS_SCREEN],nH.SETTINGS_SCREEN),Re(nY,nV[nH.START_LEVEL_SCREEN],nH.START_LEVEL_SCREEN),Re(nY,nV[nH.NOTIFICATION_SCREEN],nH.NOTIFICATION_SCREEN),Re(nY,nV[nH.LEVEL_COMPLETE_SCREEN],nH.LEVEL_COMPLETE_SCREEN),Re(nY,nV[nH.CONGRATULATION_SCREEN],nH.CONGRATULATION_SCREEN),Re(nY,nV[nH.QUIT_LEVEL_SCREEN],nH.QUIT_LEVEL_SCREEN),Re(nY,nV[nH.TOURNAMENT_DETAIL_SCREEN],nH.TOURNAMENT_DETAIL_SCREEN),Re(nY,nV[nH.DAILY_REWARDS_SCREEN],nH.DAILY_REWARDS_SCREEN),Re(nY,nV[nH.STAR_CHEST_SCREEN],nH.STAR_CHEST_SCREEN),nY),nW=[nH[nH.NOTIFICATION_SCREEN],nH[nH.LOADING_SCREEN]];g._RF.pop(),g._RF.push({},"09bc071ZcpI978b1NdKUaqD","AnalyticsUtils",void 0);var nK=globalThis.game.analytics,nX=GameCore.Utils.Array,nJ=function(){function e(){Ce(this,e)}return Ae(e,null,[{key:"inst",get:function(){return this._instance||(this._instance=new e),this._instance}},{key:"trackCurrentPage",value:function(p,v){if(!nX.has(nW,p)&&(v||nX.has(this.trackingPages,p))){this.trackingPages=this.trackingPages.filter(function(v){return v!==p}),v&&this.trackingPages.push(p);var g=this.getCurrentPage();nK.pageview(g)}}},{key:"switchSceneTracking",value:function(){this.trackingPages=[];var p=this.getCurrentPage();nK.pageview(p)}},{key:"getCurrentPage",value:function(){var p,v;return this.trackingPages.length>0?this.trackingPages[this.trackingPages.length-1]:null!==(p=null===(v=D.getScene())||void 0===v?void 0:v.name)&&void 0!==p?p:"Unknown Scene"}}]),e}();nJ.trackingPages=[];try{new nJ}catch(p){console.error("AnalyticsUtils",p)}g._RF.pop(),g._RF.push({},"31871PLRYRJu7yCCX5F6lWK","AudioUtils",void 0);var nQ=function(){function e(){Ce(this,e)}return Ae(e,[{key:"sound",get:function(){var p,v;return null!==(p=null===(v=W("Sound"))||void 0===v?void 0:v.getComponent(tR))&&void 0!==p?p:null}},{key:"music",get:function(){var p,v;return null!==(p=null===(v=W("Music"))||void 0===v?void 0:v.getComponent(tk))&&void 0!==p?p:null}}],[{key:"inst",get:function(){return this._instance||(this._instance=new e),this._instance}},{key:"muteAudio",value:function(p){this.muteMusic(p),this.muteSound(p)}},{key:"playSound",value:function(p,v){var g;null===(g=this.inst.sound)||void 0===g||g.play(p,v)}},{key:"pauseSound",value:function(p){var v;null===(v=this.inst.sound)||void 0===v||v.pause(p)}},{key:"resumeSound",value:function(p){var v;null===(v=this.inst.sound)||void 0===v||v.resume(p)}},{key:"stopSound",value:function(p){var v;null===(v=this.inst.sound)||void 0===v||v.stop(p)}},{key:"stopAllSounds",value:function(){var p;null===(p=this.inst.sound)||void 0===p||p.stopAll()}},{key:"muteSound",value:function(p){var v;null===(v=this.inst.sound)||void 0===v||v.mute(p)}},{key:"playMusic",value:function(p){var v,g,E=arguments.length>0&&void 0!==p&&p;!E&&null!==(v=this.inst.music)&&void 0!==v&&v.playing(nB.BG_MUSIC)||null===(g=this.inst.music)||void 0===g||g.play(nB.BG_MUSIC)}},{key:"pauseMusic",value:function(){var p;null===(p=this.inst.music)||void 0===p||p.pause(nB.BG_MUSIC)}},{key:"muteMusic",value:function(p){var v;null===(v=this.inst.music)||void 0===v||v.mute(p)}},{key:"turnUpMusic",value:function(){var p;null===(p=this.inst.music)||void 0===p||p.setVolume(.8)}},{key:"turnDownMusic",value:function(){var p;null===(p=this.inst.music)||void 0===p||p.setVolume(.4)}},{key:"turnOffMusic",value:function(){var p;null===(p=this.inst.music)||void 0===p||p.setVolume(0)}}]),e}();try{new nQ}catch(p){console.error("AudioUtils",p)}g._RF.pop(),g._RF.push({},"05faedSJ2NHFqLe9b3g4RIl","CocosUtils",void 0);var nZ,n$,n0,n1,n2,n4,n3,n5,n6,n9,n8,n7,ie,it,ii,ia,ir,io,is,il,iu,id,ip,iy,iv,ig,im,ib,iw,iS,iE,ik,iC,i_=function(){function e(){Ce(this,e)}return Ae(e,[{key:"getWindowSizeVsWorldGameRatio",value:function(){var p=en.getVisibleSize();return ei.windowSize.width/window.devicePixelRatio/p.width}},{key:"getBoundingBoxTo",value:function(p,v){var g=ea.mat4();ea.Mat4.fromSRT(g,v.getRotation(),v.getPosition(),v.getScale());var E=v.getComponent(A);if(!E)throw new Error("Node must have UITransform component");var k=E.anchorPoint,C=E.contentSize,_=C.width,T=C.height,I=new ea.Rect(-k.x*_,-k.y*T,_,T),R=ea.mat4();if(ea.Mat4.multiply(R,p,g),I.transformMat4(R),!v.children||0===v.children.length)return I;var P,N=v.children,D=v.getWorldMatrix(),L=We(N);try{for(L.s();!(P=L.n()).done;){var O=P.value;if(null!=O&&O.active){if(O.getComponent(A)){var M=this.getBoundingBoxTo(D,O);M&&ea.Rect.union(I,I,M)}}}}catch(p){L.e(p)}finally{L.f()}return I}}],[{key:"inst",get:function(){return this._instance||(this._instance=new e),this._instance}},{key:"getBoundingBoxToWorld",value:function(p){if(p.parent){var v=p.parent.getWorldMatrix();return this.inst.getBoundingBoxTo(v,p)}var g=p.getComponent(A);if(!g)throw new Error("Node must have UITransform component");return g.getBoundingBox()}},{key:"worldSizeToCssSize",value:function(p){return p*this.inst.getWindowSizeVsWorldGameRatio()}},{key:"cssSizeToWorldSize",value:function(p){return p/this.inst.getWindowSizeVsWorldGameRatio()}},{key:"getScreenWidthCss",value:function(){var p=document,v=p.body,g=p.documentElement,E=v.clientWidth,k=g.clientWidth;return Math.max(k,E)||0}},{key:"getScreenHeightCss",value:function(){var p=document,v=p.body,g=p.documentElement,E=v.clientHeight,k=g.clientHeight;return Math.max(k,E)||0}}]),e}();try{new i_}catch(p){console.error("CocosUtils",p)}g._RF.pop(),g._RF.push({},"ef63ctZn6BPAout9ufUgFVq","ExtendedButton",void 0);var iA,iT,iI,iR,iP=E.ccclass,iN=E.property,iD=E.disallowMultiple,iL=E.executionOrder,iO=globalThis.game.analytics,iM=GameCore.Plugins.Analytics.Events,ix=(nZ=iP("ExtendedButton"),n$=iL(111),n0=iN(er),n1=iN(er),n2=iN(eo.AnimationController),n4=iN({override:!0,visible:!1}),n3=iN({override:!0,visible:!1}),n5=iN({override:!0,visible:!1}),n6=iN({override:!0,visible:!1}),n9=iN({override:!0,visible:!1}),n8=iN({override:!0,visible:!1}),n7=iN({override:!0,visible:!1}),ie=iN({override:!0,visible:!1}),it=iN({override:!0,visible:!1}),ii=iN({override:!0,visible:!1}),ia=iN({override:!0,visible:!1}),ir=iN(es),io=iN(es),is=iN(es),il=iN({visible:function(){return this.makeSound},type:nz}),iu=iN({tooltip:"Add a delay after click to prevent spamming (not apply for cancel click)"}),id=iN({visible:function(){return this.disableSpamClick},tooltip:"Delay time in seconds"}),nZ(ip=iD(ip=n$((iv=Ye((iy=function(p){Ie(n,p);var v=xe(n);function n(){var p;Ce(this,n);for(var g=arguments.length,E=new Array(g),k=0;k<g;k++)E[k]=arguments[k];return je(p=v.call.apply(v,[this].concat(E)),"clickStartEvents",iv,Ne(p)),je(p,"clickEndEvents",ig,Ne(p)),je(p,"animationController",im,Ne(p)),je(p,"useDesktopHover",ib,Ne(p)),je(p,"emitAnalyticsEvents",iw,Ne(p)),je(p,"makeSound",iS,Ne(p)),je(p,"soundKey",iE,Ne(p)),je(p,"disableSpamClick",ik,Ne(p)),je(p,"disableSpamDelay",iC,Ne(p)),p.currentClickBoundingBox=null,p.hasDown=!1,p.hasUp=!1,p.hasFinishClickCycle=!1,p.onTouchStart=function(v){p.interactable&&(p.hasDown||(p.currentClickBoundingBox=i_.getBoundingBoxToWorld(p.node),p.handleDown(v)))},p.onTouchEnd=function(v){p.interactable&&p.hasDown&&(p.hasUp||p.handleUp(v))},p.onTouchCancel=function(v){var g,E;if(p.interactable&&p.hasDown&&!p.hasUp){var k=v.getUILocation();null!==(g=null===(E=p.currentClickBoundingBox)||void 0===E?void 0:E.contains(k))&&void 0!==g&&g?p.handleUp(v):(p.hasUp=!0,p.hasFinishClickCycle=!0,p.handleResetButtonState(),p.emitClickEndEvents(v))}},p.onMouseEnter=function(v){p.useDesktopHover&&p.interactable&&(p.hasDown||(p.hasFinishClickCycle=!1,p.setAnimationState("HOVER")))},p.onMouseLeave=function(v){p.useDesktopHover&&p.interactable&&(p.hasDown||p.hasUp||p.hasFinishClickCycle||p.handleResetButtonState())},p.handleResetButtonState=function(){p.hasDown=!1,p.hasUp=!1,p.setAnimationState("RESET")},p}return Ae(n,[{key:"transition",get:function(){return N.Transition.NONE},set:function(p){Ge(Pe(n.prototype),"transition",N.Transition.NONE,this,!0)}},{key:"normalColor",get:function(){return Fe(Pe(n.prototype),"normalColor",this)},set:function(p){Ge(Pe(n.prototype),"normalColor",p,this,!0)}},{key:"pressedColor",get:function(){return Fe(Pe(n.prototype),"pressedColor",this)},set:function(p){Ge(Pe(n.prototype),"pressedColor",p,this,!0)}},{key:"hoverColor",get:function(){return Fe(Pe(n.prototype),"hoverColor",this)},set:function(p){Ge(Pe(n.prototype),"hoverColor",p,this,!0)}},{key:"disabledColor",get:function(){return Fe(Pe(n.prototype),"disabledColor",this)},set:function(p){Ge(Pe(n.prototype),"disabledColor",p,this,!0)}},{key:"normalSprite",get:function(){return Fe(Pe(n.prototype),"normalSprite",this)},set:function(p){Ge(Pe(n.prototype),"normalSprite",p,this,!0)}},{key:"pressedSprite",get:function(){return Fe(Pe(n.prototype),"pressedSprite",this)},set:function(p){Ge(Pe(n.prototype),"pressedSprite",p,this,!0)}},{key:"hoverSprite",get:function(){return Fe(Pe(n.prototype),"hoverSprite",this)},set:function(p){Ge(Pe(n.prototype),"hoverSprite",p,this,!0)}},{key:"disabledSprite",get:function(){return Fe(Pe(n.prototype),"disabledSprite",this)},set:function(p){Ge(Pe(n.prototype),"disabledSprite",p,this,!0)}},{key:"duration",get:function(){return Fe(Pe(n.prototype),"duration",this)},set:function(p){Ge(Pe(n.prototype),"duration",p,this,!0)}},{key:"zoomScale",get:function(){return Fe(Pe(n.prototype),"zoomScale",this)},set:function(p){Ge(Pe(n.prototype),"zoomScale",p,this,!0)}},{key:"__preload",value:function(){Fe(Pe(n.prototype),"__preload",this).call(this),e7.lazyValidateProperties(this)}},{key:"onDestroy",value:function(){var p;null===(p=Fe(Pe(n.prototype),"onDestroy",this))||void 0===p||p.call(this)}},{key:"onEnable",value:function(){var p;null===(p=Fe(Pe(n.prototype),"onEnable",this))||void 0===p||p.call(this),this.node.off(el.EventType.TOUCH_END,this._onTouchEnded,this),this.node.on(k.EventType.TOUCH_START,this.onTouchStart),this.node.on(k.EventType.TOUCH_END,this.onTouchEnd),this.node.on(k.EventType.TOUCH_CANCEL,this.onTouchCancel),this.node.on(k.EventType.MOUSE_ENTER,this.onMouseEnter),this.node.on(k.EventType.MOUSE_LEAVE,this.onMouseLeave)}},{key:"onDisable",value:function(){var p;null===(p=Fe(Pe(n.prototype),"onDisable",this))||void 0===p||p.call(this),this.node.off(k.EventType.TOUCH_START,this.onTouchStart),this.node.off(k.EventType.TOUCH_END,this.onTouchEnd),this.node.off(k.EventType.TOUCH_CANCEL,this.onTouchCancel),this.node.off(k.EventType.MOUSE_ENTER,this.onMouseEnter),this.node.off(k.EventType.MOUSE_LEAVE,this.onMouseLeave),this.unschedule(this.handleResetButtonState),this.handleResetButtonState()}},{key:"handleDown",value:function(p){this.hasDown=!0,this.setAnimationState("DOWN"),this.makeSound&&nQ.playSound(nj[this.soundKey]),this.emitClickStartEvents(p)}},{key:"emitClickStartEvents",value:function(p){this.clickStartEvents.forEach(function(v){v.emit([p,v.customEventData])})}},{key:"emitClickEndEvents",value:function(p){this.clickEndEvents.forEach(function(v){v.emit([p,v.customEventData])})}},{key:"handleUp",value:function(p){this.hasUp=!0,this.hasFinishClickCycle=!0,this.setAnimationState("RESET"),this.disableSpamClick?this.scheduleOnce(this.handleResetButtonState,this.disableSpamDelay):this.handleResetButtonState(),this.emitButtonEvents(p),this.emitClickEndEvents(p)}},{key:"emitButtonEvents",value:function(p){this.interactable&&(this.emitAnalyticsEvents&&iO.event(iM.BUTTON_CLICK,{button_name:this.node.name,screen_name:nJ.getCurrentPage()}),this.clickEvents.forEach(function(v){v.emit([p,v.customEventData])}))}},{key:"setAnimationState",value:function(p){this.animationController.setValue("DOWN","DOWN"===p),this.animationController.setValue("HOVER","HOVER"===p),this.animationController.setValue("RESET","RESET"===p)}},{key:"fakeClick",value:function(){var p=this;this.setAnimationState("DOWN"),this.scheduleOnce(function(){p.setAnimationState("RESET")},0)}},{key:"resetButtonState",value:function(){this.handleResetButtonState()}}]),n}(N)).prototype,"clickStartEvents",[n0],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),ig=Ye(iy.prototype,"clickEndEvents",[n1],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),im=Ye(iy.prototype,"animationController",[n2],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ye(iy.prototype,"transition",[n4],Object.getOwnPropertyDescriptor(iy.prototype,"transition"),iy.prototype),Ye(iy.prototype,"normalColor",[n3],Object.getOwnPropertyDescriptor(iy.prototype,"normalColor"),iy.prototype),Ye(iy.prototype,"pressedColor",[n5],Object.getOwnPropertyDescriptor(iy.prototype,"pressedColor"),iy.prototype),Ye(iy.prototype,"hoverColor",[n6],Object.getOwnPropertyDescriptor(iy.prototype,"hoverColor"),iy.prototype),Ye(iy.prototype,"disabledColor",[n9],Object.getOwnPropertyDescriptor(iy.prototype,"disabledColor"),iy.prototype),Ye(iy.prototype,"normalSprite",[n8],Object.getOwnPropertyDescriptor(iy.prototype,"normalSprite"),iy.prototype),Ye(iy.prototype,"pressedSprite",[n7],Object.getOwnPropertyDescriptor(iy.prototype,"pressedSprite"),iy.prototype),Ye(iy.prototype,"hoverSprite",[ie],Object.getOwnPropertyDescriptor(iy.prototype,"hoverSprite"),iy.prototype),Ye(iy.prototype,"disabledSprite",[it],Object.getOwnPropertyDescriptor(iy.prototype,"disabledSprite"),iy.prototype),Ye(iy.prototype,"duration",[ii],Object.getOwnPropertyDescriptor(iy.prototype,"duration"),iy.prototype),Ye(iy.prototype,"zoomScale",[ia],Object.getOwnPropertyDescriptor(iy.prototype,"zoomScale"),iy.prototype),ib=Ye(iy.prototype,"useDesktopHover",[ir],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),iw=Ye(iy.prototype,"emitAnalyticsEvents",[io],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),iS=Ye(iy.prototype,"makeSound",[is],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),iE=Ye(iy.prototype,"soundKey",[il],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return nz[nB.BUTTON_CLICK]}}),ik=Ye(iy.prototype,"disableSpamClick",[iu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),iC=Ye(iy.prototype,"disableSpamDelay",[id],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return .5}}),ip=iy))||ip)||ip)||ip);g._RF.pop(),g._RF.push({},"0e570DdAIZPKY6DNtNerFmX","OpacityToggler",void 0);var iF=E.ccclass,iB=E.requireComponent,iU=E.property,iz=iF("OpacityToggler")(iA=iB([et])((iI=Ye((iT=function(p){Ie(i,p);var v,g=xe(i);function i(){var p;Ce(this,i);for(var v=arguments.length,E=new Array(v),k=0;k<v;k++)E[k]=arguments[k];return je(p=g.call.apply(g,[this].concat(E)),"activeValue",iI,Ne(p)),je(p,"inActiveValue",iR,Ne(p)),p.signal=new na,p}return Ae(i,[{key:"__preload",value:function(){this.opacityComponent=this.getComponent(et),this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){e7.lazyValidateProperties(this)}},{key:"changeState",value:function(p){var v=arguments.length>0&&void 0!==p&&p;this.signal.abort(),this.opacityComponent.opacity=v?this.activeValue:this.inActiveValue}},{key:"changeStateFade",value:(v=Ee(function(){var p,v,g;var E=arguments;return _ts_generator(this,function(k){switch(k.label){case 0:p=E.length>0&&void 0!==E[0]&&E[0],v=E.length>1&&void 0!==E[1]?E[1]:.2;this.signal.abort(),this.signal=new na;g=p?this.activeValue:this.inActiveValue;return[4,tJ.runTweenAsync(G(this.opacityComponent).to(v,{opacity:g}),this.signal)];case 1:k.sent();return[2]}})}),function(){return v.apply(this,arguments)})}]),i}(L)).prototype,"activeValue",[iU],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 255}}),iR=Ye(iT.prototype,"inActiveValue",[iU],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 128}}),iA=iT))||iA)||iA;g._RF.pop(),g._RF.push({},"244e9OHsmpDnpHQKeLzgiiX","GameEvents",void 0);var iG="view-resize",iY="view-resized",ij="request-view-resize",iH="layout-changed",iV="gameplay-update-config",iq="opened-skip-overlay",iW="closed-skip-overlay",iK="result-scene-replay",iX="result-scene-home",iJ="upgrade-quality",iQ="upgrade-dynamic-atlas";g._RF.pop(),g._RF.push({},"5c76fxO2ppOqYp4WNO+Kavm","GameWorld",void 0);var iZ,i$,i0,i1={Portrait:"portrait",Landscape:"landscape"},i2={Portrait:{WIDTH:750,HEIGHT:1583},Landscape:{WIDTH:1920,HEIGHT:1583}};g._RF.pop(),g._RF.push({},"7ef37Q3PZpKYaeik5JzGwNy","DebugResolution",void 0);var i4,i3,i5,i6,i9,i8,i7,ae,at,an,ai,aa,ar,ao,as,al,au,ac,ah,ad,ap=E.ccclass,af=E.property,ay=E.requireComponent,av=E.disallowMultiple,ag=E.executeInEditMode,am=i2,ab=am.Portrait,aw=am.Landscape;ap("DebugResolution")(iZ=av(iZ=ay([eu])(iZ=ag(!0)(((i0=function(p){Ie(n,p);var v=xe(n);function n(){var p;Ce(this,n);for(var g=arguments.length,E=new Array(g),k=0;k<g;k++)E[k]=arguments[k];return(p=v.call.apply(v,[this].concat(E))).handleLayoutChange=function(){var v;null===(v=p.graphics)||void 0===v||v.clear(),p.start()},p}return Ae(n,[{key:"drawPortrait",get:function(){return n._drawPortrait},set:function(p){p!==n._drawPortrait&&(p?this.drawPortraitResolution():this.graphics.clear(),n._drawPortrait=p,n._drawLandscape&&this.drawLandscapeResolution())}},{key:"drawLandscape",get:function(){return n._drawLandscape},set:function(p){p!==n._drawLandscape&&(p?this.drawLandscapeResolution():this.graphics.clear(),n._drawLandscape=p,n._drawPortrait&&this.drawPortraitResolution())}},{key:"__preload",value:function(){this.graphics=this.getComponent(eu),this.validateRequiredComponents(),this.listenGameEvents()}},{key:"validateRequiredComponents",value:function(){e7.lazyValidateProperties(this)}},{key:"listenGameEvents",value:function(){ec.on(iH,this.handleLayoutChange)}},{key:"start",value:function(){this.drawPortrait&&this.drawPortraitResolution(),this.drawLandscape&&this.drawLandscapeResolution()}},{key:"drawPortraitResolution",value:function(){var p=this.graphics,v=ab.WIDTH,g=ab.HEIGHT,E=-v/2,k=-g/2;p.strokeColor=C.GREEN,p.rect(E,k,v,g),p.stroke()}},{key:"drawLandscapeResolution",value:function(){var p=this.graphics,v=aw.WIDTH,g=aw.HEIGHT,E=-v/2,k=-g/2;p.strokeColor=C.CYAN,p.rect(E,k,v,g),p.stroke()}}]),n}(L))._drawPortrait=!0,i0._drawLandscape=!0,Ye((i$=i0).prototype,"drawPortrait",[af],Object.getOwnPropertyDescriptor(i$.prototype,"drawPortrait"),i$.prototype),Ye(i$.prototype,"drawLandscape",[af],Object.getOwnPropertyDescriptor(i$.prototype,"drawLandscape"),i$.prototype),iZ=i$))||iZ)||iZ)||iZ);g._RF.pop(),g._RF.push({},"0e2d6yn/BVObK1kyTJ5a09a","GameStats",void 0);var aS=E.ccclass,aE=E.executionOrder,ak=E.property,aC=GameCore.Utils.Valid,a_=C.RED,aA=C.BLACK,aT=C.MAGENTA;i4=aS("GameStats"),i3=aE(-1e3),i5=ak(I),i6=ak(I),i9=ak(I),i8=ak(I),i7=ak(I),ae=ak(I),at=ak(I),an=ak(I),i4(ai=i3((ar=Ye((aa=function(p){Ie(n,p);var v=xe(n);function n(){var p;Ce(this,n);for(var g=arguments.length,E=new Array(g),k=0;k<g;k++)E[k]=arguments[k];return je(p=v.call.apply(v,[this].concat(E)),"fpsLabel",ar,Ne(p)),je(p,"drawCountLabel",ao,Ne(p)),je(p,"logicTimeLabel",as,Ne(p)),je(p,"physicTimeLabel",al,Ne(p)),je(p,"renderTimeLabel",au,Ne(p)),je(p,"objectMemoryUsageLabel",ac,Ne(p)),je(p,"textureMemoryUsageLabel",ah,Ne(p)),je(p,"devicePixelRatioLabel",ad,Ne(p)),p.refreshInterval=.5,p.handleMouseDown=function(){p.bg.enabled=!p.bg.enabled},p.waitForStats=function(){ed.stats&&(p.unschedule(p.waitForStats),p.node.active=!0,p.stats=ed.stats,p.startUpdateStats())},p.updateStats=function(){p.updateFps(),p.updateDrawCalls(),p.updateLogicTime(),p.updatePhysicTime(),p.updateRenderTime(),p.updateObjectMemoryUsage(),p.updateTextureMemoryUsage(),p.updateDevicePixelRatio()},p}return Ae(n,[{key:"__preload",value:function(){this.bg=this.getComponent(V),this.validateRequiredComponents(),this.listenInputEvents()}},{key:"validateRequiredComponents",value:function(){e7.lazyValidateProperties(this)}},{key:"listenInputEvents",value:function(){this.node.on(el.EventType.TOUCH_START,this.handleMouseDown)}},{key:"start",value:function(){this.bg.enabled=!1,this.node.active=!1,ed&&aC.isDebugger()&&(ed.showStats(),this.schedule(this.waitForStats,.5,20))}},{key:"startUpdateStats",value:function(){this.schedule(this.updateStats,this.refreshInterval)}},{key:"updateFps",value:function(){var p=this.getFps();this.updateFpsColor(p),this.fpsLabel.string="FPS: ".concat(p)}},{key:"updateFpsColor",value:function(p){this.fpsLabel.color=p<30?a_:p<48?aT:aA}},{key:"updateDrawCalls",value:function(){var p=this.getDrawCalls();this.updateDrawCallsColor(p),this.drawCountLabel.string="Draw Calls: ".concat(p)}},{key:"updateDrawCallsColor",value:function(p){var v=ep.os===ep.OS.IOS,g=v?80:25,E=v?60:15;this.drawCountLabel.color=p>g?a_:p>E?aT:aA}},{key:"updateLogicTime",value:function(){var p=this.getLogicTime();this.updateLogicTimeColor(p),this.logicTimeLabel.string="Logic Time: ".concat(p.toFixed(2),"ms")}},{key:"updateLogicTimeColor",value:function(p){this.logicTimeLabel.color=p>10?a_:p>5?aT:aA}},{key:"updatePhysicTime",value:function(){var p=this.getPhysicTime();this.updatePhysicTimeColor(p),this.physicTimeLabel.string="Physic Time: ".concat(p.toFixed(2),"ms")}},{key:"updatePhysicTimeColor",value:function(p){this.physicTimeLabel.color=p>10?a_:p>5?aT:aA}},{key:"updateRenderTime",value:function(){var p=this.getRenderTime();this.updateRenderTimeColor(p),this.renderTimeLabel.string="Render Time: ".concat(p.toFixed(2),"ms")}},{key:"updateRenderTimeColor",value:function(p){this.renderTimeLabel.color=p>10?a_:p>5?aT:aA}},{key:"updateObjectMemoryUsage",value:function(){var p=this.getObjectMemoryUsage();this.updateObjectMemoryUsageColor(p),this.objectMemoryUsageLabel.string="Object Mem: ".concat(p.toFixed(2),"MB")}},{key:"updateObjectMemoryUsageColor",value:function(p){this.objectMemoryUsageLabel.color=p>40?a_:p>25?aT:aA}},{key:"updateTextureMemoryUsage",value:function(){var p=this.getTextureMemoryUsage();this.updateTextureMemoryUsageColor(p),this.textureMemoryUsageLabel.string="Texture Mem: ".concat(p.toFixed(2),"MB")}},{key:"updateTextureMemoryUsageColor",value:function(p){this.textureMemoryUsageLabel.color=p>50?a_:p>35?aT:aA}},{key:"updateDevicePixelRatio",value:function(){var p=this.getDevicePixelRatio();this.updateDevicePixelRatioColor(p),this.devicePixelRatioLabel.string="Device Pixel Ratio: ".concat(p)}},{key:"updateDevicePixelRatioColor",value:function(p){this.devicePixelRatioLabel.color=p>2?a_:p<=1?aT:aA}},{key:"getFps",value:function(){var p=this.stats.fps.counter;return Math.floor(p.value)||0}},{key:"getDrawCalls",value:function(){return this.stats.draws.counter.value||0}},{key:"getLogicTime",value:function(){var p=this.stats.logic.counter;return Math.floor(1e3*p.value)/1e3||0}},{key:"getPhysicTime",value:function(){var p=this.stats.physics.counter;return Math.floor(1e3*p.value)/1e3||0}},{key:"getRenderTime",value:function(){var p=this.stats.render.counter;return Math.floor(1e3*p.value)/1e3||0}},{key:"getObjectMemoryUsage",value:function(){var p=this.stats.bufferMemory.counter;return Math.floor(1e3*p.value)/1e3||0}},{key:"getTextureMemoryUsage",value:function(){var p=this.stats.textureMemory.counter;return Math.floor(1e3*p.value)/1e3||0}},{key:"getDevicePixelRatio",value:function(){return window.devicePixelRatio||0}}]),n}(L)).prototype,"fpsLabel",[i5],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ao=Ye(aa.prototype,"drawCountLabel",[i6],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),as=Ye(aa.prototype,"logicTimeLabel",[i9],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),al=Ye(aa.prototype,"physicTimeLabel",[i8],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),au=Ye(aa.prototype,"renderTimeLabel",[i7],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ac=Ye(aa.prototype,"objectMemoryUsageLabel",[ae],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ah=Ye(aa.prototype,"textureMemoryUsageLabel",[at],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ad=Ye(aa.prototype,"devicePixelRatioLabel",[an],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ai=aa))||ai);g._RF.pop(),g._RF.push({},"ca922n1V0RLioEyUJg8hQXH","GameEvents",void 0);var aI,aR=function(p){return p.INVITE_FRIENDS="invite-friends",p.REPLAY_FRIENDS="replay-friends",p.SHOW_CHALLENGE_RESULTS="show-challenge-results",p.NEXT_LEVEL="next-level",p.MAX_LEVEL="max-level",p.START_OVER="start-over",p.SELECT_LEVEL="select-level",p.GAME_START="game-start",p.GAME_PAUSE="game-pause",p.GAME_RESUME="game-resume",p.GAME_REPLAY="game-replay",p.GAME_FINISH="game-finish",p.GAME_EXIT="game-exit",p.USE_ITEM="use-item",p.SKIP_LEVEL="skip-level",p.ADD_ITEM="add-item",p.ADD_ITEMS="add-items",p.ADD_COINS="add-coins",p.REMOVE_COINS="remove-coins",p.REMOVE_COINS_SUCCESS="remove-coins-success",p.REMOVE_COINS_FAILED="remove-coins-failed",p.COIN_CHANGED="coin-changed",p.ADD_STARS="add-stars",p.PAUSE_TIME="pause-time",p.RESUME_TIME="resume-time",p.TIME_OUT="time-out",p.HALF_TIME="half-time",p.RESCUE_START="rescue-time",p.RESCUE_FINISHED="clock-animation-finished",p.APPLY_GRAVITY="apply-gravity",p.IDLE_ENTER="idle-enter",p.IDLE_EXIT="idle-exit",p.GRID_MATCH="grid-match",p.GRID_MATCH_SUCCESS="grid-match-success",p.GRID_MATCH_FAIL="grid-match-fail",p.GRID_CLEAR="grid-clear",p.GRID_CREATE="grid-create",p.GRID_RESIZE="grid-resize",p.TILE_CLICK="tile-click",p.BOMB_EXPLODE="bomb-explode",p.SHOW_HINT="show-hint",p.ADD_COMBO="add-combo",p.COMBO_UPDATED="combo-updated",p.COMBO_ENDED="combo-ended",p.ADD_SCORE="add-score",p.SCORE_UPDATED="score-updated",p.REGISTER_ANIMATOR="register-animator",p.UNREGISTER_ANIMATOR="unregister-animator",p.SHOW_UI="show-ui",p.HIDE_UI="hide-ui",p.AUTO_PLAY="auto-play",p.GUIDE_MASK_CLICKED="guide-mask-clicked",p}(aR||{});g._RF.pop(),g._RF.push({},"8249dDH5xBEc4nnCGRgSjaW","PanelAnimationController",void 0);var aP,aN,aD,aL,aO,aM,ax,aF,aB,aU,az,aG,aY,aj,aH,aV,aq,aW,aK=(0,E.ccclass)("PanelAnimationController")(aI=function(p){Ie(n,p);var v=xe(n);function n(){var p;Ce(this,n);for(var g=arguments.length,E=new Array(g),k=0;k<g;k++)E[k]=arguments[k];return(p=v.call.apply(v,[this].concat(E))).animators=new Set,p.handleRegistration=function(v){if(!v)throw new Error("Invalid event payload.");p.animators.has(v)&&console.warn("Animator already registered."),p.animators.add(v)},p.handleUnregistration=function(v){if(!v)throw new Error("Invalid event payload.");p.animators.has(v)||console.warn("Animator not registered."),p.animators.delete(v)},p.handleShowUIs=function(v){var g=!1,E=[];p.animators.forEach(function(p){E.push(p)});for(var k=[],C=0,_=E;C<_.length;C++){var A,T=_[C];if(!T.isReadyForAnimation()&&!g)g=!0,null==v||null===(A=v.fallback)||void 0===A||A.call(v);k.push(T.handleShowUI())}void 0!==(null==v?void 0:v.onComplete)&&k.length>0&&Promise.all(k).then(v.onComplete)},p.handleHideUIs=function(v){var g=!1,E=[];p.animators.forEach(function(p){E.push(p)});for(var k=[],C=0,_=E;C<_.length;C++){var A,T=_[C];if(!T.isReadyForAnimation()&&!g)g=!0,null==v||null===(A=v.fallback)||void 0===A||A.call(v);k.push(T.handleHideUI())}void 0!==(null==v?void 0:v.onComplete)&&k.length>0&&Promise.all(k).then(v.onComplete)},p}return Ae(n,[{key:"init",value:function(){this.node.scene.off(aR.REGISTER_ANIMATOR),this.node.scene.off(aR.UNREGISTER_ANIMATOR),this.node.scene.off(aR.SHOW_UI),this.node.scene.off(aR.HIDE_UI),this.node.scene.on(aR.REGISTER_ANIMATOR,this.handleRegistration),this.node.scene.on(aR.UNREGISTER_ANIMATOR,this.handleUnregistration),this.node.scene.on(aR.SHOW_UI,this.handleShowUIs),this.node.scene.on(aR.HIDE_UI,this.handleHideUIs)}}]),n}(L))||aI;g._RF.pop(),g._RF.push({},"f190aWZvVlGiplYX4XrZG3a","PanelAnimator",void 0);var aX,aJ,aQ,aZ,a$=E.ccclass,a0=E.property,a1=GameCore.Utils.Object,a2=(aP=a$("AnimationConfig"),aN=a0({type:[j]}),aP((aO=Ye((aL=function(){function e(){Ce(this,e),je(this,"startHidden",aO,this),je(this,"nodes",aM,this),je(this,"posOffset",ax,this),je(this,"showEase",aF,this),je(this,"hideEase",aB,this),je(this,"showDuration",aU,this),je(this,"hideDuration",az,this)}return Ae(e,[{key:"setConfig",value:function(p){p&&a1.assign(this,p)}}]),e}()).prototype,"startHidden",[a0],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),aM=Ye(aL.prototype,"nodes",[aN],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),ax=Ye(aL.prototype,"posOffset",[a0],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),aF=Ye(aL.prototype,"showEase",[a0],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"backOut"}}),aB=Ye(aL.prototype,"hideEase",[a0],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"backIn"}}),aU=Ye(aL.prototype,"showDuration",[a0],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),az=Ye(aL.prototype,"hideDuration",[a0],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),aD=aL))||aD),a4=(aG=a$("PanelAnimator"),aY=a0({type:a2,displayName:"Top animation nodes"}),aj=a0({type:a2,displayName:"Bottom animation nodes"}),aG((aq=Ye((aV=function(p){Ie(a,p);var v,g,E=xe(a);function a(){var p;Ce(this,a);for(var v=arguments.length,g=new Array(v),k=0;k<v;k++)g[k]=arguments[k];return je(p=E.call.apply(E,[this].concat(g)),"topConfig",aq,Ne(p)),je(p,"botConfig",aW,Ne(p)),p.isReady=!1,p}return Ae(a,[{key:"onEnable",value:function(){this.node.scene.emit(aR.REGISTER_ANIMATOR,this)}},{key:"onDisable",value:function(){this.node.scene.emit(aR.UNREGISTER_ANIMATOR,this)}},{key:"onLoad",value:function(){this.topAnimator=this.createAnimator(this.topConfig,"top"),this.botAnimator=this.createAnimator(this.botConfig,"bottom"),this.initUIPos(),this.isReady=!0}},{key:"initUIPos",value:function(){this.topAnimator.switchState(this.topConfig.startHidden?"hidden":"shown",!0),this.botAnimator.switchState(this.botConfig.startHidden?"hidden":"shown",!0)}},{key:"isReadyForAnimation",value:function(){return this.isReady}},{key:"handleShowUI",value:(g=Ee(function(){return _ts_generator(this,function(p){if(this.isReady)return[2,Promise.all([this.topAnimator.switchState("shown"),this.botAnimator.switchState("shown")])];console.warn("".concat(this.node.name,"'s ").concat(this.name,": not ready"));return[2]})}),function(){return g.apply(this,arguments)})},{key:"handleHideUI",value:(v=Ee(function(){return _ts_generator(this,function(p){if(this.isReady)return[2,Promise.all([this.topAnimator.switchState("hidden"),this.botAnimator.switchState("hidden")])];console.warn("".concat(this.node.name,"'s ").concat(this.name,": not ready"));return[2]})}),function(){return v.apply(this,arguments)})},{key:"createAnimator",value:function(p,v){var g=p.nodes,E=p.posOffset,k=p.showEase,C=p.hideEase,_=p.showDuration,A=p.hideDuration,T=g.map(function(p){return"top"===v&&p.isAlignTop?{mode:"top",value:p.top}:"bottom"===v&&p.isAlignBottom?{mode:"bottom",value:p.bottom}:{mode:"position",value:p.node.position.y}}),I=g.map(function(p){return"top"===v&&p.isAlignTop?{mode:"top",value:p.top+E}:"bottom"===v&&p.isAlignBottom?{mode:"bottom",value:p.bottom-E}:{mode:"position",value:p.node.position.y+E}}),R="shown";return{switchState:function(p,v){var E=arguments.length>1&&void 0!==v&&v;if(R===p)return Promise.resolve(null);R=p;var P="hidden"===p?T:I,N="hidden"===p?I:T,D="hidden"===p?A:_,L="hidden"===p?C:k;return E?(g.forEach(function(p,v){var g=P[v],E=N[v].value;"top"===g.mode&&(p.top=E),"bottom"===g.mode&&(p.bottom=E),"position"===g.mode&&(p.node.position=new ef(p.node.position.x,E,p.node.position.z))}),Promise.resolve(null)):Promise.all(g.map(function(p,v){var g=P[v],E=N[v].value;return tJ.runTweenAsync(a.getTween({widget:p,config:g,target:E,easing:L,duration:D}))}))}}}},{key:"setAnimator",value:function(p){var v=p.topConfig,g=p.botConfig,E=new a2,k=new a2;E.setConfig(v),k.setConfig(g),this.topConfig=E,this.botConfig=k,this.topAnimator=this.createAnimator(this.topConfig,"top"),this.botAnimator=this.createAnimator(this.botConfig,"bottom"),this.initUIPos()}}],[{key:"getTween",value:function(p){var v=p.widget,g=p.config,E=p.target,k=p.easing,C=p.duration;return"top"===g.mode?G(v).call(function(){v.top=g.value}).to(C,{top:E},{easing:k}):"bottom"===g.mode?G(v).call(function(){v.bottom=g.value}).to(C,{bottom:E},{easing:k}):G(v.node.position).call(function(){v.node.position=new ef(v.node.position.x,g.value,v.node.position.z)}).to(C,{y:E},{easing:k})}}]),a}(L)).prototype,"topConfig",[aY],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new a2}}),aW=Ye(aV.prototype,"botConfig",[aj],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new a2}}),aH=aV))||aH);g._RF.pop(),g._RF.push({},"6ea01hdw/9MHb28SCDAiRss","ResizeWithBannerAd",void 0);var a3,a5,a6,a9,a8,a7,re,rt,rn,ri,ra,rr=E.ccclass,ro=E.requireComponent,rs=E.property,rl=globalThis.game,ru=rl.ads,rc=rl.event,rh=GameCore,rd=rh.Events,rp=rh.Configs.Ads,rf=rh.Plugins.Ads,ry=rf.Types,rv=rf.Status;rr("ResizeWithBannerAd")(aX=ro(j)((aQ=Ye((aJ=function(p){Ie(n,p);var v=xe(n);function n(){var p;Ce(this,n);for(var g=arguments.length,E=new Array(g),k=0;k<g;k++)E[k]=arguments[k];return je(p=v.call.apply(v,[this].concat(E)),"willShowBanner",aQ,Ne(p)),je(p,"includeSAB",aZ,Ne(p)),p.handleAdShow=function(v){var g,E=v.placementId;null!==E&&(null===(g=ru.getAdByPlacementId(E))||void 0===g?void 0:g.type)===ry.BANNER&&p.resizeToFitBannerAd()},p.handleAdClose=function(v){var g,E=v.placementId;null!==E&&(null===(g=ru.getAdByPlacementId(E))||void 0===g?void 0:g.type)===ry.BANNER&&p.updateWidgets(ru.getSafeAreaBottom(i_.cssSizeToWorldSize(1)))},p}return Ae(n,[{key:"__preload",value:function(){this.widget=this.getComponent(j),e7.lazyValidateProperties(this),rc.on(rd.AD_SHOWING,this.handleAdShow),rc.on(rd.AD_CLOSED,this.handleAdClose)}},{key:"onDestroy",value:function(){rc.off(rd.AD_SHOWING,this.handleAdShow),rc.off(rd.AD_CLOSED,this.handleAdClose)}},{key:"start",value:function(){var p=ru.getSafeAreaBottom(i_.cssSizeToWorldSize(1));this.willShowBanner||n.isBannerAdShowing()?this.resizeToFitBannerAd():p>0&&this.includeSAB&&this.updateWidgets(p)}},{key:"resizeToFitBannerAd",value:function(){var p=this,v=rp.Enabled,g=rp.BannerDisplayAdOptions;if(v){if(this.widget.isAlignBottom){var E=null,k=null,C=null,_=null,A=i_.cssSizeToWorldSize(1);g.forEach(function(v){var g=v.PlacementId,T=v.Position,I=v.BannerWidth;if(ru.canbeShowBannerAd(g))switch(T){case"top":E=ru.getBannerHeight(g,A);break;case"bottom":k=ru.getBannerHeight(g,A,p.includeSAB);break;case"left":if(void 0===I)break;var R=I;"getBannerOffset"in GameSDK.extra&&(R+=GameSDK.extra.getBannerOffset()),C=R*A;break;case"right":if(void 0===I)break;var P=I;"getBannerOffset"in GameSDK.extra&&(P+=GameSDK.extra.getBannerOffset()),_=P*A}}),this.updateWidgets(E,k,C,_)}else console.warn("Widget does not align to bottom, ResizeWithBannerAds will have no effect!")}}},{key:"updateWidgets",value:function(p,v,g,E){var k=arguments.length>0&&void 0!==p?p:null,C=arguments.length>1&&void 0!==v?v:null,_=arguments.length>2&&void 0!==g?g:null,A=arguments.length>3&&void 0!==E?E:null;this.widget.top=null!=k?k:this.widget.top,this.widget.bottom=null!=C?C:this.widget.bottom,this.widget.left=null!=_?_:this.widget.left,this.widget.right=null!=A?A:this.widget.right,this.widget.updateAlignment();var T=this.getComponentsInChildren(j);T.forEach(function(p){p.updateAlignment()})}}],[{key:"isBannerAdShowing",value:function(){return ru.enabled&&ru.getAdStatus(ry.BANNER)===rv.SHOWING}}]),n}(L)).prototype,"willShowBanner",[rs],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),aZ=Ye(aJ.prototype,"includeSAB",[rs],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),aX=aJ))||aX);g._RF.pop(),g._RF.push({},"3d28fQaHU5Lm4/Zyq/Jd2b6","TapperedProgressBar",void 0);var rg,rm,rb,rw,rS,rE,rk,rC,r_,rA,rT=E.ccclass,rI=E.property,rR=E.executeInEditMode,rP=E.requireComponent,rN=(a3=rT("TapperedProgressBar"),a5=rP(et),a6=rI({type:et,displayName:"Fill opacity"}),a9=rI({type:V,displayName:"Left Cap",tooltip:"If assigned, will be displayed when progress is larger than 0%"}),a8=rI({type:V,displayName:"Right Cap",tooltip:"If assigned, will be displayed when progress is at 100%"}),a7=rI({range:[0,1,.01],slide:!0,tooltip:"i18n:progress.progress",override:!0}),a3(re=rR(re=a5((rn=Ye((rt=function(p){Ie(n,p);var v=xe(n);function n(){var p;Ce(this,n);for(var g=arguments.length,E=new Array(g),k=0;k<g;k++)E[k]=arguments[k];return je(p=v.call.apply(v,[this].concat(E)),"uiOpacity",rn,Ne(p)),je(p,"leftCap",ri,Ne(p)),je(p,"rightCap",ra,Ne(p)),p}return Ae(n,[{key:"progress",get:function(){return Fe(Pe(n.prototype),"progress",this)},set:function(p){Ge(Pe(n.prototype),"progress",p,this,!0),this.updateAppearance()}},{key:"updateAppearance",value:function(){if(null!==this.uiOpacity){if(this.progress<=0)this.uiOpacity.opacity=0;else if(this.progress>.1)this.uiOpacity.opacity=255;else{var p=Math.floor(this.progress/.05*255);this.uiOpacity.opacity=p}}}},{key:"start",value:function(){this.updateAppearance()}}]),n}(ey)).prototype,"uiOpacity",[a6],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ri=Ye(rt.prototype,"leftCap",[a9],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ra=Ye(rt.prototype,"rightCap",[a8],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Ye(rt.prototype,"progress",[a7],Object.getOwnPropertyDescriptor(rt.prototype,"progress"),rt.prototype),re=rt))||re)||re)||re);g._RF.pop(),g._RF.push({},"bce15LcVrxOfYMa9rbXN/qi","Localize",void 0);var rD,rL,rO,rM,rx,rF,rB,rU,rz,rG=E.ccclass,rY=E.property,rj=E.requireComponent,rH=E.executeInEditMode,rV=E.disallowMultiple,rq=globalThis.game.language;rg=rG("Localize"),rm=rj(I),rb=rH(!0),rw=rY({visible:!0}),rS=rY({group:{name:"Fonts",id:"fonts",displayOrder:1},type:ev}),rE=rY({group:{name:"Fonts",id:"fonts",displayOrder:2},type:ev}),rg(rk=rV(rk=rm(rk=rb((Ye((rC=function(p){Ie(n,p);var v=xe(n);function n(){var p;Ce(this,n);for(var g=arguments.length,E=new Array(g),k=0;k<g;k++)E[k]=arguments[k];return je(p=v.call.apply(v,[this].concat(E)),"enFont",r_,Ne(p)),je(p,"ruFont",rA,Ne(p)),p.handleLanguageChanged=function(){p.updateTransToNode()},p}return Ae(n,[{key:"key",get:function(){return this._key},set:function(p){p&&(this._key=p,this.updateTransToNode())}},{key:"__preload",value:function(){this.label=this.getComponent(I),this.validateRequiredComponents(),this.updateTransToNode()}},{key:"validateRequiredComponents",value:function(){e7.lazyValidateProperties(this)}},{key:"start",value:function(){this.listenEvent()}},{key:"listenEvent",value:function(){ec.on("update-language",this.handleLanguageChanged)}},{key:"updateTransToNode",value:function(){if(this.node.active&&this._key)try{var p=rq.getText(this._key),v=this.getFontByLang();this.label.font=v,this.label.string=p,this.node.emit("update-trans",p)}catch(p){console.warn(p)}}},{key:"getFontByLang",value:function(){if(!this.enFont||!this.ruFont)throw new Error("Font is not found");switch(rq.getCurrentLocale()){case"en":return this.enFont;case"ru":return this.ruFont;default:return this.enFont}}}]),n}(L)).prototype,"key",[rw],Object.getOwnPropertyDescriptor(rC.prototype,"key"),rC.prototype),r_=Ye(rC.prototype,"enFont",[rS],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),rA=Ye(rC.prototype,"ruFont",[rE],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),rk=rC))||rk)||rk)||rk);g._RF.pop(),g._RF.push({},"aef305TaZhKVo1f4/qH1kf+","SecondOrderDynamics",void 0);var rW,rK,rX,rJ,rQ,rZ,r$,r0,r1,r2=E.ccclass,r4=E.property,r3=function(){function e(p,v){var g;Ce(this,e),v=null!==(g=v)&&void 0!==g?g:{response:1,dampen:1,eager:1},this.k1=e.calcK1(v),this.k2=e.calcK2(v),this.k3=e.calcK3(v),this.xp=p.clone(),this.y=p.clone(),this.yd=new eg(0,0)}return Ae(e,[{key:"update",value:function(p,v,g){var E=arguments.length>2&&void 0!==g?g:null;null===E&&(E=new eg((v.x-this.xp.x)/p,(v.y-this.xp.y)/p),this.xp.x=v.x,this.xp.y=v.y);var k=Math.max(this.k2,p*p/2+p*this.k1/2,p*this.k1);return this.y.x=this.y.x+p*this.yd.x,this.y.y=this.y.y+p*this.yd.y,this.yd.x=this.yd.x+p*(v.x+this.k3*E.x-this.y.x-this.k1*this.yd.x)/k,this.yd.y=this.yd.y+p*(v.y+this.k3*E.y-this.y.y-this.k1*this.yd.y)/k,this.y}},{key:"setDynamics",value:function(p){this.k1=e.calcK1(p),this.k2=e.calcK2(p),this.k3=e.calcK3(p)}},{key:"reset",value:function(p){this.xp.set(p.x,p.y),this.y.set(p.x,p.y),this.yd.set(0,0)}},{key:"currentState",get:function(){return this.y}}],[{key:"calcK1",value:function(p){return p.dampen/(Math.PI*p.response)}},{key:"calcK2",value:function(p){return 1/(2*Math.PI*p.response*(2*Math.PI*p.response))}},{key:"calcK3",value:function(p){return p.eager*p.dampen/(2*Math.PI*p.response)}}]),e}(),r5=(rD=r2("SODConfig"),rL=r4({type:Y,displayName:"Responsiveness",tooltip:"Higher values will result shorter response times."}),rO=r4({type:Y,displayName:"Dampening",tooltip:"Higher values will result in less overshoot and oscillation."}),rM=r4({type:Y,displayName:"Eagerness",tooltip:"Higher values will result in more overshoot and oscillation, negative values will result in anticipation."}),rD((rB=Ye((rF=Ae(function e(){Ce(this,e),je(this,"response",rB,this),je(this,"dampen",rU,this),je(this,"eager",rz,this)})).prototype,"response",[rL],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 200}}),rU=Ye(rF.prototype,"dampen",[rO],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 20}}),rz=Ye(rF.prototype,"eager",[rM],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),rx=rF))||rx);g._RF.pop(),g._RF.push({},"e9e74FEHyRLvar32WZD/F11","Trail",void 0);var r6,r9,r8,r7,oe,ot,on,oi,oa,or,oo,os,ol,ou,oc,od,op,of,oy,ov,og,om,ob,ow,oS,oE,ok=E.ccclass,oC=E.property,o_=(rW=ok("Trail"),rK=oC({type:k,displayName:"Target"}),rX=oC({type:eu,displayName:"Graphics"}),rJ=oC({type:[r5],displayName:"Trail Nodes"}),rW((r$=Ye((rZ=function(p){Ie(n,p);var v=xe(n);function n(){var p;Ce(this,n);for(var g=arguments.length,E=new Array(g),k=0;k<g;k++)E[k]=arguments[k];return je(p=v.call.apply(v,[this].concat(E)),"target",r$,Ne(p)),je(p,"graphics",r0,Ne(p)),je(p,"trailNodes",r1,Ne(p)),p.trailNodeInstances=[],p}return Ae(n,[{key:"reset",value:function(){var p,v=We(this.trailNodeInstances);try{for(v.s();!(p=v.n()).done;)p.value.reset(new eg(this.node.worldPosition.x,this.node.worldPosition.y))}catch(p){v.e(p)}finally{v.f()}this.graphics.clear()}},{key:"onLoad",value:function(){this.validateRequiredComponents(),this.spawnTrailNodes()}},{key:"update",value:function(p){this.graphics.clear();var v=this.trailNodeInstances[0];this.drawTrail(p,v,this.target.worldPosition.x,this.target.worldPosition.y);for(var g=1;g<this.trailNodeInstances.length;g++){var E=this.trailNodeInstances[g-1],k=this.trailNodeInstances[g];this.drawTrail(p,k,E.currentState.x,E.currentState.y)}}},{key:"drawTrail",value:function(p,v,g,E){var k=this.graphics,C=new eg(g,E),_=v.update(p,C),A=new ef(C.x,C.y,0),T=new ef(_.x,_.y,0);k.node.inverseTransformPoint(A,A),k.node.inverseTransformPoint(T,T),k.moveTo(A.x,A.y),k.lineTo(T.x,T.y),k.stroke()}},{key:"spawnTrailNodes",value:function(){var p,v=We(this.trailNodes);try{for(v.s();!(p=v.n()).done;){var g=p.value,E=new eg(this.node.worldPosition.x,this.node.worldPosition.y),k=new r3(E,g);this.trailNodeInstances.push(k)}}catch(p){v.e(p)}finally{v.f()}}},{key:"validateRequiredComponents",value:function(){if(!this.target)throw new Error("Target is not set");if(!this.graphics)throw new Error("Graphics is not set");0===this.trailNodes.length&&console.warn("No trail nodes are set")}}]),n}(L)).prototype,"target",[rK],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),r0=Ye(rZ.prototype,"graphics",[rX],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),r1=Ye(rZ.prototype,"trailNodes",[rJ],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),rQ=rZ))||rQ);g._RF.pop(),g._RF.push({},"a2260jBMJFPCrn/Q4Vo4iB1","BatchNodes",void 0);var oA,oT=E.ccclass,oI=E.executionOrder,oR=E.property,oP=GameCore.Utils.Array,oN="Batch By Name",oD="Batch Label",oL="Batch Sprite",oO=(r6=oT("BatchNodes"),r9=oI(99999),r8=oR({group:{name:oN}}),r7=oR({type:[F],group:{name:oN}}),oe=oR({type:[x],group:{name:oN}}),ot=oR({group:{name:oD}}),on=oR({group:{name:oD}}),oi=oR({group:{name:oD}}),oa=oR({group:{name:oL}}),or=oR({group:{name:oL}}),oo=oR({readonly:!0}),os=oR({readonly:!0}),ol=oR({readonly:!0}),r6(ou=r9((od=Ye((oc=function(p){Ie(n,p);var v=xe(n);function n(){var p;Ce(this,n);for(var g=arguments.length,E=new Array(g),k=0;k<g;k++)E[k]=arguments[k];return je(p=v.call.apply(v,[this].concat(E)),"batchByName",od,Ne(p)),je(p,"depthNames",op,Ne(p)),je(p,"listName",of,Ne(p)),je(p,"batchLabel",oy,Ne(p)),je(p,"depthLabel",ov,Ne(p)),je(p,"typeLabel",og,Ne(p)),je(p,"batchSprite",om,Ne(p)),je(p,"depthSprite",ob,Ne(p)),je(p,"batchAllNodes",ow,Ne(p)),je(p,"batchDepth",oS,Ne(p)),je(p,"checkOverlap",oE,Ne(p)),p.batchNode={},p.labelChildren=[],p.spriteChildren=[],p.allChildren=[],p.nameChildren=[],p.originalParents={},p.isInited=!1,p.onAfterUpdate=function(){p.isInited&&p.hierarchyChildren()},p.onAfterRender=function(){p.isInited&&p.restoreOriginalChildren()},p}return Ae(n,[{key:"__preload",value:function(){this.enabled&&(D.on(em.EVENT_AFTER_UPDATE,this.onAfterUpdate),D.on(em.EVENT_AFTER_RENDER,this.onAfterRender))}},{key:"onDestroy",value:function(){D.off(em.EVENT_AFTER_UPDATE,this.onAfterUpdate),D.off(em.EVENT_AFTER_RENDER,this.onAfterRender)}},{key:"onLoad",value:function(){this.enabled&&(this.setupBatchNodes(this.node),this.isInited=!0)}},{key:"onEnable",value:function(){D.on(em.EVENT_AFTER_UPDATE,this.onAfterUpdate),D.on(em.EVENT_AFTER_RENDER,this.onAfterRender),this.setupBatchNodes(this.node),this.isInited=!0}},{key:"onDisable",value:function(){this.restoreOriginalChildren(),D.off(em.EVENT_AFTER_UPDATE,this.onAfterUpdate),D.off(em.EVENT_AFTER_RENDER,this.onAfterRender),this.isInited=!1}},{key:"setupBatchNodes",value:function(p){this.allChildren=[],this.nameChildren=[],this.labelChildren=[],this.spriteChildren=[],this.saveOriginalChildren(p),this.createGlobalNodes(p),this.createGlobalNameNodes(p),this.createGlobalLabelNode(p),this.createGlobalSpriteNode(p),this.sortGlobalNodes()}},{key:"sortGlobalNodes",value:function(){var p,v,g,E=this;null===(p=this.batchNode.node)||void 0===p||p.setSiblingIndex(0),null===(v=this.batchNode.label)||void 0===v||v.setSiblingIndex(this.depthLabel),null===(g=this.batchNode.sprite)||void 0===g||g.setSiblingIndex(this.depthSprite),this.listName.forEach(function(p,v){var g;null===(g=E.batchNode[p])||void 0===g||g.setSiblingIndex(E.depthNames[v])})}},{key:"createGlobalNodes",value:function(p){if(this.batchAllNodes){var v=new k("GlobalBatchNode");v.active=!0,this.batchNode.node=v,p.addChild(v)}}},{key:"createGlobalNameNodes",value:function(p){var v=this;this.batchByName&&this.listName.forEach(function(g){if(!v.batchNode[g]){var E=new k(g);E.active=!0,v.batchNode[g]=E,p.addChild(E)}})}},{key:"createGlobalLabelNode",value:function(p){if(this.batchLabel){var v=new k("GlobalLabelNode");v.active=!0,this.batchNode.label=v,p.addChild(v)}}},{key:"createGlobalSpriteNode",value:function(p){if(this.batchSprite){var v=new k("GlobalSpriteNode");v.active=!0,this.batchNode.sprite=v,p.addChild(v)}}},{key:"saveOriginalParents",value:function(){var p=this;[].concat(He(this.labelChildren),He(this.spriteChildren)).forEach(function(v){v.node.parent&&(p.originalParents[v.uuid]=v.node.parent)}),this.nameChildren.forEach(function(v){v.parent&&(p.originalParents[v.uuid]=v.parent)})}},{key:"saveOriginalChildren",value:function(p){var v=this;p.children.forEach(function(p){v.saveLabelChildren(p),v.saveSpriteChildren(p),v.saveNodeChildrenByName(p),v.saveNodeChildrenByType(p)}),this.saveOriginalParents()}},{key:"saveLabelChildren",value:function(p){var v;if(this.batchLabel){var g=p.getComponentsInChildren(I);"char"===this.typeLabel&&g.filter(function(p){return p.cacheMode===I.CacheMode.CHAR}),0!==g.length&&(v=this.labelChildren).push.apply(v,He(g))}}},{key:"saveSpriteChildren",value:function(p){var v;if(this.batchSprite){var g=p.getComponentsInChildren(V);0!==g.length&&(v=this.spriteChildren).push.apply(v,He(g))}}},{key:"saveNodeChildrenByName",value:function(p){var v=this;this.batchByName&&p.children.forEach(function(p){oP.has(v.listName,p.name)?v.nameChildren.push(p):v.saveNodeChildrenByName(p)})}},{key:"saveNodeChildrenByType",value:function(p,v){var g,E=this,k=arguments.length>1&&void 0!==v?v:0;if(this.batchAllNodes){var C=p.getComponentsInChildren(L);(g=this.allChildren).push.apply(g,He(C)),this.batchDepth>0&&k<this.batchDepth&&this.allChildren.forEach(function(p){E.saveNodeChildrenByType(p.node,E.batchDepth)})}}},{key:"hierarchyChildren",value:function(){var p,v=this;this.labelChildren.forEach(function(g){g.node.isValid&&g.node.activeInHierarchy&&(p=v.batchNode.label,g.node.isChildOf(p)||(g.node.setParent(p,!0),g.node.layer=eb.Enum.UI_2D))}),this.spriteChildren.forEach(function(g){g.node.isValid&&g.node.activeInHierarchy&&(p=v.batchNode.sprite,g.node.isChildOf(p)||(g.node.setParent(p,!0),g.node.layer=eb.Enum.UI_2D))}),this.allChildren.forEach(function(g){g.node.isValid&&g.node.activeInHierarchy&&(p=v.batchNode.node,g.node.isChildOf(p)||(g.node.setParent(p,!0),g.node.layer=eb.Enum.UI_2D))}),this.allChildren.sort(function(p,v){var g=p.constructor.name,E=v.constructor.name;return g<E?-1:g>E?1:0}),this.nameChildren.forEach(function(g){if(g.isValid&&g.activeInHierarchy&&g.isTransformDirty()){var E=g.getComponent(et);E&&E.opacity<1||(p=v.batchNode[g.name],g.isChildOf(p)||(g.setParent(p,!0),g.layer=eb.Enum.UI_2D))}})}},{key:"restoreOriginalChildren",value:function(){var p=this,v=[].concat(He(this.labelChildren),He(this.spriteChildren));v.length>0&&v.forEach(function(v){var g=p.originalParents[v.uuid];g&&(v.node.isChildOf(g)||v.node.setParent(g,!0))}),this.nameChildren.forEach(function(v){var g=p.originalParents[v.uuid];g&&(v.isChildOf(g)||v.setParent(g,!0))})}}]),n}(L)).prototype,"batchByName",[r8],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),op=Ye(oc.prototype,"depthNames",[r7],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),of=Ye(oc.prototype,"listName",[oe],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),oy=Ye(oc.prototype,"batchLabel",[ot],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),ov=Ye(oc.prototype,"depthLabel",[on],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),og=Ye(oc.prototype,"typeLabel",[oi],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"char"}}),om=Ye(oc.prototype,"batchSprite",[oa],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),ob=Ye(oc.prototype,"depthSprite",[or],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),ow=Ye(oc.prototype,"batchAllNodes",[oo],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),oS=Ye(oc.prototype,"batchDepth",[os],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),oE=Ye(oc.prototype,"checkOverlap",[ol],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),ou=oc))||ou)||ou);g._RF.pop(),g._RF.push({},"9b958Lf6PFClb/JuJfTLzxG","Vibrate",void 0);var oM=E.ccclass,ox=GameCore.Utils.Browser,oF=globalThis.game.player,oB=oM("Vibrate")(oA=function(p){Ie(n,p);var v=xe(n);function n(){return Ce(this,n),v.apply(this,arguments)}return Ae(n,[{key:"vibrate",value:function(p){if(this.isVibrateEnable()&&!ox.vibrate(p)){if("performHapticFeedbackAsync"in GameSDK.extra)return void GameSDK.extra.performHapticFeedbackAsync();console.warn("Vibrate failed")}}},{key:"isVibrateEnable",value:function(){return!!oF.getPlayerSetting("vibrate")}}]),n}(L))||oA;g._RF.pop(),g._RF.push({},"358fdIqjFdNzZGa95REWt2F","Ads",void 0);var oU=1/6;g._RF.pop(),g._RF.push({},"542caJcCPRMI5EaOkgOzhek","ItemKeys",void 0);var oz,oG={HINT:"hint",THUNDER:"thunder",STORM:"storm",PLIERS:"pliers"};g._RF.pop(),g._RF.push({},"62927KYr+tCcIzOaPtVc/q8","CoinData",void 0);var oY=10,oj=50,oH=100,oV=(Re(oz={},oG.HINT,80),Re(oz,oG.THUNDER,200),Re(oz,oG.STORM,150),Re(oz,oG.PLIERS,150),oz),oq=200,oW=40;g._RF.pop(),g._RF.push({},"8328a20Ku5GF4anma0sBaxm","DailyRewardsData",void 0);var oK={0:{id:1,type:"coin",value:20},1:{id:2,type:"coin",value:30},2:{id:3,type:"coin",value:50},3:{id:4,type:"coin",value:100},4:{id:5,type:"coin",value:150},5:{id:6,type:"coin",value:200},6:{id:7,type:"coin",value:250,items:{hint:3,thunder:3,storm:3,pliers:0}}};g._RF.pop(),g._RF.push({},"8875b8IrVpJWJr/45aS1gql","DefaultRespMatchData",void 0);var oX=we(we({},GameCore.Dtos.Match.Data.getDefaultData()),{},{extraData:null});g._RF.pop(),g._RF.push({},"ad867amogBFGJo9jp78EnQP","DevTools",void 0);var oJ=function(p){return p.UNLOCK_DEV_TOOLS="unlock-dev-tools",p.TRIGGER_UNLOCK_KEY="trigger-unlock-key",p.TRIGGER_RESET_SEQUENCE="trigger-reset-sequence",p}(oJ||{}),oQ={Events:oJ,UNLOCK_SEQUENCE:"101013012031"};g._RF.pop(),g._RF.push({},"7decaASyaFOAp2izq8DsREg","TotalLevel",void 0);var oZ;g._RF.pop(),g._RF.push({},"f8533KH/fxOfYqya9sgLrSj","GameData",void 0);var o$={level:0,coins:0,stars:0,totalLevel:80,levelVersion:0,lastRewardedItems:0,lastCreateTournamentShown:0,guideItemShowed:[],items:(oZ={},Re(oZ,oG.HINT,0),Re(oZ,oG.THUNDER,0),Re(oZ,oG.STORM,0),Re(oZ,oG.PLIERS,0),oZ),skins:{}};g._RF.pop(),g._RF.push({},"52b52FNwvhBKY/becAy420o","Leaderboard",void 0);var o0="global-leaderboard-key",o1="friends-leaderboard-key",o2="global-leaderboard-id",o4="friends-leaderboard-id";g._RF.pop(),g._RF.push({},"3b9bcPJBxpNOqG2I6exTOVn","MatchCustomData",void 0);var o3=we(we({},GameCore.Dtos.Match.CustomData.getDefaultData()),{},{score:0});g._RF.pop(),g._RF.push({},"074c4KXFZ1Pq6d+66PrLd2+","PlayerData",void 0);var o5={score:0,endlessScore:0,settings:{sound:!0,music:!0,vibrate:!0,language:"en"},gameData:o$,isFirstLogin:!0,dailyRewarded:{logDays:[],lastRewarded:0}};g._RF.pop(),g._RF.push({},"32598ObpVZK/pecmWIdcs+7","SceneKeys",void 0);var o6="BootScene",o9="GameScene",o8="DashboardScene",o7="ChallengeResultScene";g._RF.pop(),g._RF.push({},"f16ffbXQPtDK58g6BNFwzJv","Tournament",void 0);var se=function(p){return p.RELOAD_TOURNAMENT="reload-tournament",p}(se||{});g._RF.pop(),g._RF.push({},"598f2UgQ+NGBYLWv34s6Vev","renderCustomResultChallenge",void 0);var st=GameCore,sn=st.Configs.FrameCapture,si=sn.Enabled,sa=sn.WideframeConfigs,sr=st.Utils.Object,so=function(){var p=Ee(function(p){var v,g,E,k,C;return _ts_generator(this,function(_){if(!si)return[2,(console.warn("FrameCapture is not enabled"),null)];v=Ol(p);if(!v)return[2,null];Ll(v,sa.CustomResultChallenge);g=window.game.frameCapture,E=sa.CustomResultChallenge,k=E.Width,C=E.Height;return[2,g.captureAsync({name:"CustomResultChallenge",width:k,height:C,renderOptions:v})]})});return function(v){return p.apply(this,arguments)}}(),Ll=function(p,v){var g=v.Width,E=v.Height,k=v.Wideframe;p.wideframe={name:"custom-result-challenge",type:"image",depth:0,image:k,size:[g,E],position:[0,0]}},Ol=function(p){try{var v=p.playerId,g=void 0===v?"10":v,E=p.playerPhoto,k=void 0===E?"":E,C=p.playerScore,_=void 0===C?0:C,A=p.opponentId,T=void 0===A?"20":A,I=p.opponentPhoto,R=void 0===I?"":I,P=p.opponentScore,N=void 0===P?0:P,D=p.isPlayerFinished,L=p.isOpponentFinished,O=sa.CustomResultChallenge.RenderOptions,M=sr.camelCaseKeys(sr.clone(O)),x=M.playerPhoto,F=M.opponentPhoto,B=_===N,U=_>N,z=null!=D?D:L,G=D&&L;return"image"===x.type&&(x.name="".concat(g),x.image=k),"image"===F.type&&(F.name="".concat(T),F.image=R),z&&Dl(M,{playerScore:_,opponentScore:N,isPlayerFinished:D,isOpponentFinished:L}),!G||B?(delete M.leftCrown,delete M.rightCrown,M):(U?delete M.rightCrown:delete M.leftCrown,M)}catch(p){return console.warn("getRenderOptionsShareScore",p),null}},Dl=function(p,v){var g=p.leftScore,E=p.rightScore,k=v.playerScore,C=void 0===k?0:k,_=v.opponentScore,A=void 0===_?0:_,T=v.isPlayerFinished,I=v.isOpponentFinished;"text"===g.type&&(g.text=T?"".concat(C):"???"),"text"===E.type&&(E.text=I?"".concat(A):"???")};g._RF.pop(),g._RF.push({},"ad7acMQ2iJNKKA2RkT+nGNI","CommonError",void 0);var ss=function(p){Ie(n,p);var v=xe(n);function n(p,g){var E;return Ce(this,n),(E=v.call(this,g)).code=p,E}return Ae(n)}(De(Error));g._RF.pop(),g._RF.push({},"5ff78u05/tPepABfMzNaOjM","PlayerHasTournamentError",void 0);var sl=function(p){Ie(n,p);var v=xe(n);function n(p,g){var E;return Ce(this,n),(E=v.call(this,"PLAYER_HAS_TOURNAMENT","Player has a tournament")).playerId=p,E.tournamentId=g,E}return Ae(n)}(ss);g._RF.pop(),g._RF.push({},"e14dbcdc89LQJIggfi5qO6U","MapData",void 0);var su={themeNames:["summer","autumn","winter"],skinNames:["cakes","car","cosmetics","flower","fruit","ice-cream","sport","tool"],mapOrder:[{id:1,theme:"summer",skin:"fruit",levelCount:10},{id:2,theme:"autumn",skin:"flower",levelCount:10},{id:3,theme:"winter",skin:"tool",levelCount:10},{id:4,theme:"summer",skin:"sport",levelCount:10},{id:5,theme:"autumn",skin:"cosmetics",levelCount:10},{id:6,theme:"winter",skin:"ice-cream",levelCount:10},{id:7,theme:"summer",skin:"cakes",levelCount:10},{id:8,theme:"autumn",skin:"car",levelCount:10}]};g._RF.pop(),g._RF.push({},"c0656MbbYRE+KSk63rv74ZI","SkinKeys",void 0);var sc="cakes",sh="flower",sd="fruit";g._RF.pop(),g._RF.push({},"3f1dbbPrPVBy5lNYySV74Qq","ThemeKeys",void 0);var sp={SUMMER:"summer",AUTUMN:"autumn",WINTER:"winter"};q(sp),g._RF.pop(),g._RF.push({},"6093adbLQZKpqgUpTV/sHj1","ThemeUtils",void 0);var sf=globalThis.game,sy=sf.player,sv=sf.storage,sg=GameCore.Utils.Array,sm={currentProgress:0,maxProgress:10,isLocked:!0,themeId:"summer"},sb={id:0,currentSkin:sc,currentTheme:sp.SUMMER,nextSkin:null,nextTheme:null,progress:0,max:10},sw={skin:"cakes",themeId:"summer",progress:0,max:10,isLocked:!0},sS=function(){function e(){Ce(this,e),this.mapData=su,this.playerSkinProgress=null}return Ae(e,[{key:"initDashboardSceneStorage",value:function(){var p=sv.getStorage("dashboard");if(null==p){var v=this.getCurrentMapProgressInstance();sv.addStorage("dashboard",{lastMapPayload:v,numOfMapsPassed:0,animateToCurrentLevel:!1});var g=sv.getStorage("collection");if(null==g){sv.addStorage("collection",{lastMapPack:v.id,animateMapPackUnlock:!1});var E=sv.getStorage("leaderboard_content");if(null==E){sv.addStorage("leaderboard_content",{lastTabOpened:"global"});var k=sv.getStorage("tournament");null==k&&sv.addStorage("tournament",{animateTournamentLeader:!1})}}}}},{key:"getCurrentMapProgressInstance",value:function(){if(null===this.playerSkinProgress)return console.warn("getCurrentMapProgress: playerSkinProgress not found. Have you called init()?"),sb;for(var p=this.mapData.mapOrder,v=void 0,g=void 0,E=void 0,k=void 0,C=0,_=0,A=0,T=0;T<p.length;T++){var I=this.playerSkinProgress[p[T].skin];if(I.currentProgress<I.maxProgress){var R,P,N,D;A=p[T].id,v=p[T].skin,g=p[T].theme,E=null!==(R=null===(P=p[T+1])||void 0===P?void 0:P.skin)&&void 0!==R?R:v,k=null!==(N=null===(D=p[T+1])||void 0===D?void 0:D.theme)&&void 0!==N?N:g,C=I.currentProgress,_=I.maxProgress;break}}if(void 0===v||void 0===E||void 0===g||void 0===k){var L=p[p.length-1];return A=L.id,v=L.skin,g=L.theme,E=L.skin,k=L.theme,C=L.levelCount,_=L.levelCount,console.log("getMapCurrentProgress: all skin completed"),{id:A,currentSkin:v,currentTheme:g,nextSkin:E,nextTheme:k,progress:C,max:_}}return console.log("getMapCurrentProgress",v,E,C,_),{id:A,currentSkin:v,currentTheme:g,nextSkin:E,nextTheme:k,progress:C,max:_}}},{key:"getUnlockedSkinsInstance",value:function(){if(null===this.playerSkinProgress||void 0===this.playerSkinProgress)return console.warn("getUnlockedSkins: playerSkinProgress not found. Have you called init()?"),["cakes"];for(var p=[],v=0,g=Object.keys(this.playerSkinProgress);v<g.length;v++){var E=g[v];this.playerSkinProgress[E].isLocked||p.push(E)}return console.log("getUnlockedSkins",p),p}},{key:"getLevelSkinInstance",value:function(p){var v,g=null!=p?p:1,E=this.mapData.mapOrder,k=0,C=We(E);try{for(C.s();!(v=C.n()).done;){var _=v.value;if(k+_.levelCount>=g)return console.log("getMapSkin",_.skin),_.skin;k+=_.levelCount}}catch(p){C.e(p)}finally{C.f()}var A=E[E.length-1];return console.log("getMapSkin",A.skin),A.skin}},{key:"getLevelThemeInstance",value:function(p){var v,g=null!=p?p:1,E=this.mapData.mapOrder,k=0,C=We(E);try{for(C.s();!(v=C.n()).done;){var _=v.value;if(k+_.levelCount>=g)return console.log("getMapTheme",_.theme),_.theme;k+=_.levelCount}}catch(p){C.e(p)}finally{C.f()}var A=E[E.length-1];return console.log("getMapTheme",A.theme),A.theme}},{key:"getCollectionUnlockProgressInstance",value:function(){if(null===this.playerSkinProgress)return console.warn("getCollectionUnlockProgress: playerSkinProgress not found. Have you called init()?"),[sw];for(var p=[],v=0,g=Object.entries(this.playerSkinProgress);v<g.length;v++){var E=g[v],k=E[1],C=k.currentProgress,_=k.maxProgress,A=k.isLocked,T=k.themeId;p.push({progress:C,max:_,isLocked:A,skin:E[0],themeId:T})}return p}},{key:"updatePlayerSkinProgress",value:function(){var p=sy.getGameData();if(null!=p&&p.skins&&Object.keys(p.skins).length>0){this.playerSkinProgress={};for(var v=0,g=Object.keys(p.skins);v<g.length;v++){var E=g[v];this.playerSkinProgress[E]=we(we({},sm),p.skins[E])}}else{console.log("getPlayerSkinProgress: playerData not found, use data from level");var k=this.mapData.mapOrder;this.playerSkinProgress={};var C,_=We(k);try{for(_.s();!(C=_.n()).done;){var A=C.value;this.playerSkinProgress[A.skin]={themeId:A.theme,currentProgress:0,maxProgress:A.levelCount,isLocked:!0}}}catch(p){_.e(p)}finally{_.f()}this.updatePlayerSkinProgressByLevel(),console.log(this.playerSkinProgress)}}},{key:"updatePlayerSkinProgressByLevel",value:function(){var p,v=sy.getGameData(),g=(null!==(p=null==v?void 0:v.level)&&void 0!==p?p:1)-1,E=this.mapData.mapOrder;this.playerSkinProgress[E[0].skin].isLocked=!1;var k,C=We(E);try{for(C.s();!(k=C.n()).done;){var _=k.value,A=_.levelCount,T=_.skin;if(!(g<=0)){var I=g-A>=0?A:g;g-=I,console.log("getPlayerSkinProgressByLevel",T,I),this.increaseProgressInstance(T,I,!1)}}}catch(p){C.e(p)}finally{C.f()}}},{key:"increaseProgressInstance",value:function(p,v,g){if(null!==this.playerSkinProgress){if(this.playerSkinProgress[p]){var E=this.playerSkinProgress[p],k=E.currentProgress,C=E.maxProgress,_=k+v>C?C:k+v;if(_>0&&(this.playerSkinProgress[p].isLocked=!1),_===C){var A,T=this.mapData.mapOrder,I=null===(A=T[sg.searchIndex(T,function(v){return v.skin===p})+1])||void 0===A?void 0:A.skin;I&&this.unlockSkinInstance(I,!1)}this.playerSkinProgress[p].currentProgress=_,this.playerSkinProgress[p].maxProgress=C,g&&this.syncPlayerSkinProgress()}else console.warn("increaseProgress: skin not found",p)}else console.warn("increaseProgress: playerSkinProgress not found. Have you called init()?")}},{key:"unlockSkinInstance",value:function(p,v){null!==this.playerSkinProgress?this.playerSkinProgress[p]?(this.playerSkinProgress[p].isLocked=!1,v&&this.syncPlayerSkinProgress()):console.warn("unlockSkin: skin not found",p):console.warn("unlockSkin: playerSkinProgress not found. Have you called init()?")}},{key:"syncPlayerSkinProgress",value:function(){sy.setGameData({skins:this.playerSkinProgress})}}],[{key:"getInstance",value:function(){return this._instance||(this._instance=new e),this._instance}},{key:"init",value:function(){var p=this.getInstance();p.updatePlayerSkinProgress(),p.initDashboardSceneStorage()}},{key:"getCurrentMapProgress",value:function(){return this.getInstance().getCurrentMapProgressInstance()}},{key:"getUnlockedSkins",value:function(){return this.getInstance().getUnlockedSkinsInstance()}},{key:"getLevelSkin",value:function(p){return this.getInstance().getLevelSkinInstance(p)}},{key:"getLevelTheme",value:function(p){return this.getInstance().getLevelThemeInstance(p)}},{key:"getCollectionUnlockProgress",value:function(){return this.getInstance().getCollectionUnlockProgressInstance()}},{key:"increaseProgress",value:function(p,v,g){this.getInstance().increaseProgressInstance(p,v,g)}},{key:"unlockSkin",value:function(p,v){this.getInstance().unlockSkinInstance(p,v)}}]),e}();g._RF.pop(),g._RF.push({},"0397cr2IpZEwbRzwQhlVHMO","MatchUtils",void 0);var sE=globalThis.game,sk=sE.match,sC=sE.player,s_=sE.leaderboard,sA=sE.frameCapture,sT=GameCore,sI=sT.Utils,sR=sI.Object,sP=sI.Valid,sN=sI.String,sD=sI.Array,sL=sT.Match.Modes,sO=sT.Dtos.Match.Data,sM=["Champion","Ultimate","Grand","Elite","Master's","Premier","Epic","Pro's","Supreme","Legendary","Victory","Prime","Titan's","Hero's","Star's"],sx=function(){function e(){Ce(this,e)}var p,v,g,E,k,C,_,A,T,I,R,P,N,D,L,O,M,x,F;return Ae(e,[{key:"processStartSingleModeAsync",value:(F=Ee(function(){var p;return _ts_generator(this,function(v){switch(v.label){case 0:p=sC.getPlayerId();return[4,sk.single.start.processAsync({playerId:p})];case 1:v.sent();return[2]}})}),function(){return F.apply(this,arguments)})},{key:"processFinishSingleModeAsync",value:(x=Ee(function(){return _ts_generator(this,function(p){switch(p.label){case 0:return[4,sk.single.finish.processAsync()];case 1:p.sent();return[2]}})}),function(){return x.apply(this,arguments)})},{key:"processStartTournamentModeAsync",value:(M=Ee(function(){var p,v;return _ts_generator(this,function(g){switch(g.label){case 0:p=sC.getPlayerId(),v=GameSDK.context.getID();return[4,sk.tournament.continue.processAsync({playerId:p,contextId:v})];case 1:g.sent();return[2]}})}),function(){return M.apply(this,arguments)})},{key:"processFinishTournamentModeAsync",value:(O=Ee(function(){var p,v;return _ts_generator(this,function(g){switch(g.label){case 0:p=sC.getPlayerId(),v=sC.getBestScore();return[4,sk.tournament.finish.processAsync({playerId:p,bestScore:v})];case 1:g.sent();return[2]}})}),function(){return O.apply(this,arguments)})},{key:"processStartChallengeModeAsync",value:(L=Ee(function(){var p,v,g;return _ts_generator(this,function(E){switch(E.label){case 0:E.trys.push([0,2,,7]);return[4,this.processContinueChallengeAsync()];case 1:E.sent();return[3,7];case 2:p=E.sent();if(!sR.hasOwn(p,"name")||sP.isString(p.name))throw p;v="PlayerHasFinishedMatch"===p.name;if(!v)return[3,4];return[4,this.processChallengeNewOpponentAsync()];case 3:v=E.sent();E.label=4;case 4:g="PlayerNotJoinInMatch"===p.name;if(!g)return[3,6];return[4,this.processJoinChallengeAsync()];case 5:g=E.sent();E.label=6;case 6:return[3,7];case 7:return[2]}})}),function(){return L.apply(this,arguments)})},{key:"processFinishChallengeModeAsync",value:(D=Ee(function(p){return _ts_generator(this,function(v){switch(v.label){case 0:sA.addWideframeRender("renderResultChallenge",sA.wideframe.renderResultChallenge);return[4,sk.challenge.finish.processAsync(p)];case 1:v.sent();return[2]}})}),function(p){return D.apply(this,arguments)})},{key:"processContinueChallengeAsync",value:(N=Ee(function(){var p,v,g,E,k,C;return _ts_generator(this,function(_){switch(_.label){case 0:p=this.getMatchState(),v=p.id,g=p.customData,E=g.playerId,k=g.opponentId;if(!sP.isString(v))throw new Error("Invalid match id");if(!sP.isString(E))throw new Error("Invalid player id");if(!sP.isString(k))throw new Error("Invalid opponent id");C=GameSDK.context.getID();if(!C)throw new Error("Cannot get contextId");return[4,sk.challenge.continue.processAsync({matchId:v,contextId:C,playerId:E,opponentId:k})];case 1:_.sent();return[2]}})}),function(){return N.apply(this,arguments)})},{key:"processChallengeNewOpponentAsync",value:(P=Ee(function(){var p,v,g,E;return _ts_generator(this,function(k){switch(k.label){case 0:p=sC.getConnectedPlayerIds(100,0),v=Math.floor(Math.random()*p.length),g=sC.getPlayerId(),E=p[v];return[4,sk.challenge.friend.processAsync({playerId:g,opponentId:E})];case 1:k.sent();return[2]}})}),function(){return P.apply(this,arguments)})},{key:"processJoinChallengeAsync",value:(R=Ee(function(){var p,v,g,E,k;return _ts_generator(this,function(C){switch(C.label){case 0:p=this.getMatchState(),v=p.id,g=p.customData,E=g.playerId,k=g.opponentId;if(!sP.isString(v))throw new Error("Invalid match id");if(!sP.isString(E))throw new Error("Invalid player id");if(!sP.isString(k))throw new Error("Invalid opponent id");return[4,sk.challenge.join.processAsync({matchId:v,playerId:E,opponentId:k})];case 1:C.sent();return[2]}})}),function(){return R.apply(this,arguments)})},{key:"getMatchState",value:function(){var p=sk.getMatchState();if(!p)throw new Error("Match state not found");return p}}],[{key:"inst",get:function(){return this._instance||(this._instance=new e),this._instance}},{key:"startMatchAsync",value:(I=Ee(function(p){var v,g;return _ts_generator(this,function(E){switch(E.label){case 0:E.trys.push([0,10,,11]);v=null!=p?p:this.getMatchMode();switch(v){case sL.SINGLE:return[3,1];case sL.TOURNAMENT:return[3,3];case sL.CHALLENGE_FRIEND:return[3,5]}return[3,7];case 1:return[4,this.inst.processStartSingleModeAsync()];case 2:E.sent();return[3,9];case 3:return[4,this.inst.processStartTournamentModeAsync()];case 4:E.sent();return[3,9];case 5:return[4,this.inst.processStartChallengeModeAsync()];case 6:E.sent();return[3,9];case 7:return[4,this.inst.processStartSingleModeAsync()];case 8:E.sent();E.label=9;case 9:return[3,11];case 10:g=E.sent();console.warn("startMatchAsync",g);return[3,11];case 11:return[2]}})}),function(p){return I.apply(this,arguments)})},{key:"setProfileMatchDataAsync",value:(T=Ee(function(p){var v;return _ts_generator(this,function(g){switch(g.label){case 0:g.trys.push([0,2,,3]);return[4,sk.handler.setProfileData(p)];case 1:g.sent();return[3,3];case 2:v=g.sent();console.warn("setProfileMatchDataAsync",v);return[3,3];case 3:return[2]}})}),function(p){return T.apply(this,arguments)})},{key:"setMatchCustomDataAsync",value:(A=Ee(function(p){var v;return _ts_generator(this,function(g){switch(g.label){case 0:g.trys.push([0,2,,3]);return[4,sk.handler.setMatchCustomData(p)];case 1:g.sent();return[3,3];case 2:v=g.sent();console.warn("setMatchCustomDataAsync",v);return[3,3];case 3:return[2]}})}),function(p){return A.apply(this,arguments)})},{key:"setLeaderboardScoreAsync",value:(_=Ee(function(p){var v;return _ts_generator(this,function(g){switch(g.label){case 0:g.trys.push([0,2,,3]);return[4,sk.handler.setLeaderboardScore(p)];case 1:g.sent();return[3,3];case 2:v=g.sent();console.warn("setLeaderboardScoreAsync",v);return[3,3];case 3:return[2]}})}),function(p){return _.apply(this,arguments)})},{key:"finishMatchAsync",value:(C=Ee(function(p){var v,g;return _ts_generator(this,function(E){switch(E.label){case 0:E.trys.push([0,10,,11]);v=this.getMatchMode();switch(v){case sL.SINGLE:return[3,1];case sL.TOURNAMENT:return[3,3];case sL.CHALLENGE_FRIEND:return[3,5]}return[3,7];case 1:return[4,this.inst.processFinishSingleModeAsync()];case 2:E.sent();return[3,9];case 3:return[4,this.inst.processFinishTournamentModeAsync()];case 4:E.sent();return[3,9];case 5:return[4,this.inst.processFinishChallengeModeAsync(p)];case 6:E.sent();return[3,9];case 7:return[4,this.inst.processFinishSingleModeAsync()];case 8:E.sent();E.label=9;case 9:return[3,11];case 10:g=E.sent();console.warn("finishMatchAsync",g);return[3,11];case 11:return[2]}})}),function(p){return C.apply(this,arguments)})},{key:"joinTournamentAsync",value:(k=Ee(function(p){var v;return _ts_generator(this,function(g){switch(g.label){case 0:v=sC.getPlayerId();return[4,sk.tournament.join.processAsync({tournamentId:p,playerId:v})];case 1:g.sent();return[2]}})}),function(p){return k.apply(this,arguments)})},{key:"continueTournamentAsync",value:(E=Ee(function(p){var v;return _ts_generator(this,function(g){switch(g.label){case 0:v=sC.getPlayerId();return[4,sk.tournament.continue.processAsync({playerId:v,contextId:p})];case 1:g.sent();return[2]}})}),function(p){return E.apply(this,arguments)})},{key:"createTournamentName",value:function(){var p=sM[ea.randomRangeInt(0,sM.length-1)],v="".concat(p," Tournament"),g=sN.removeDiacritics(v);return"".concat(g)}},{key:"getShortName",value:function(p,v){var g,E=arguments.length>1&&void 0!==v?v:50,k=p.split(" "),C=0,_="",A=We(k);try{for(A.s();!(g=A.n()).done;){var T=g.value;if(C+T.length+1>E)break;_+="".concat(T," "),C+=T.length+1}}catch(p){A.e(p)}finally{A.f()}return _.slice(0,-1)}},{key:"createTournamentPayload",value:function(){var p,v,g,E=sN.generateObjectId(),k=sC.getPlayerId(),C=sC.getPlayer().name,_=sC.getGameData(),A=null!==(p=null==_?void 0:_.level)&&void 0!==p?p:1,T=sS.getLevelTheme(A),I=this.inst.getMatchState().profiles;return{score:null!==(v=null===(g=(void 0===I?{}:I)[k])||void 0===g?void 0:g.score)&&void 0!==v?v:0,playerId:k,mode:sL.TOURNAMENT,name:this.createTournamentName(),leaderboardId:E,payload:{playerId:k,playerName:C,leaderboardId:E,themeId:T}}}},{key:"getTournamentsAsync",value:(g=Ee(function(){var p;return _ts_generator(this,function(v){switch(v.label){case 0:v.trys.push([0,2,,3]);return[4,GameSDK.tournament.getTournamentsAsync()];case 1:return[2,v.sent()];case 2:p=v.sent();return[2,(console.error(p),[])];case 3:return[2]}})}),function(){return g.apply(this,arguments)})},{key:"processCreateTournamentAsync",value:(v=Ee(function(){var p,v,g,E;return _ts_generator(this,function(k){switch(k.label){case 0:return[4,this.getTournamentsAsync()];case 1:p=k.sent(),v=sD.search(p,function(p){var v,g=JSON.parse(null!==(v=p.getPayload())&&void 0!==v?v:"{}");return"DEFAULT"===p.getTournamentType()&&g.playerId===sC.getPlayerId()});if(v)throw new sl(sC.getPlayerId(),v.getID());g=this.createTournamentPayload();sC.setGameData({lastCreateTournamentShown:Date.now()});return[4,sk.tournament.create.processAsync(g)];case 2:k.sent();E=g.leaderboardId;s_.addLeaderboard({name:E,type:"tournament",autoSortRank:!0,leaderboardId:E});return[2]}})}),function(){return v.apply(this,arguments)})},{key:"getMatchMode",value:function(){var p=this.inst.getMatchState();return sP.isString(p.mode)?p.mode:null}},{key:"getMatchCustomData",value:function(){var p=this.inst.getMatchState();return sP.isObject(p.customData)?p.customData:null}},{key:"getMatchExtraDataAsync",value:(p=Ee(function(p){var v;return _ts_generator(this,function(g){switch(g.label){case 0:return[4,sk.api.getMatchAPI().getMatchDetailByIdAsync(p)];case 1:v=g.sent();return[2,new sO(v).toObject().extraData]}})}),function(v){return p.apply(this,arguments)})},{key:"updateMatchStateAfterLevelFinish",value:function(p,v){this.setMatchCustomDataAsync({level:p,score:v});var g=sC.getPlayerId();this.setProfileMatchDataAsync({id:g,score:v})}}]),e}();try{new sx}catch(p){console.error("MatchUtils",p)}g._RF.pop(),g._RF.push({},"97ca9J9nzNCeIjC1l+ZT/Hm","SceneUtils",void 0);var sF,sB,sU,sz,sG,sY,sj,sH=globalThis.game.event,sV=GameCore.Events,sq=function(){function e(){Ce(this,e)}return Ae(e,null,[{key:"inst",get:function(){return this._instance||(this._instance=new e),this._instance}},{key:"switchScene",value:function(p,v){sH.emit(sV.SWITCH_SCENE,{sceneName:p,sceneData:v})}},{key:"preloadScene",value:function(p){sH.emit(sV.PRELOAD_SCENE,{sceneName:p})}},{key:"preloadDashboardScene",value:function(){this.preloadScene(o8)}},{key:"switchToDashboardScene",value:function(p){this.switchScene(o8,p)}},{key:"preloadGameScene",value:function(){this.preloadScene(o9)}},{key:"switchToGameScene",value:function(p){this.switchScene(o9,p)}},{key:"getSceneData",value:function(p){return"data"in p.scene&&p.scene.data||{}}}]),e}();try{new sq}catch(p){console.error("SceneUtils",p)}g._RF.pop(),g._RF.push({},"46b8aK6CThLtpMhZPEfDrNs","LoadingFullScreen",void 0);var sW,sK,sX,sJ,sQ,sZ=E.ccclass,s$=E.property,s0=(sF=sZ("LoadingFullScreen"),sB=s$(ey),sU=s$(I),sF((sY=Ye((sG=function(p){Ie(a,p);var v,g,E=xe(a);function a(){var p;Ce(this,a);for(var v=arguments.length,g=new Array(v),k=0;k<v;k++)g[k]=arguments[k];return je(p=E.call.apply(E,[this].concat(g)),"progressBar",sY,Ne(p)),je(p,"loadingText",sj,Ne(p)),p}return Ae(a,[{key:"__preload",value:function(){this.uiOpacity=this.getComponent(et),this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){e7.lazyValidateProperties(this)}},{key:"runLoadingTextAnimation",value:function(){var p=this,v=0;this.schedule(function(){v=v>2?0:v+1,p.loadingText.string="Loading";for(var g=0;g<v;g++)p.loadingText.string+="."},.5)}},{key:"stopLoadingTextAnimation",value:function(){this.unscheduleAllCallbacks()}},{key:"show",value:(g=Ee(function(){var p,v;return _ts_generator(this,function(g){switch(g.label){case 0:this.uiOpacity.opacity=0,this.progressBar.progress=0;p=G(this.uiOpacity).to(.2,{opacity:255},{easing:"cubicOut"}),v=G(this.progressBar).to(8,{progress:.9},{easing:"cubicOut"});this.runLoadingTextAnimation(),tJ.runTweenAsync(p);return[4,tJ.runTweenAsync(v)];case 1:g.sent();return[2]}})}),function(){return g.apply(this,arguments)})},{key:"hide",value:(v=Ee(function(){var p,v;return _ts_generator(this,function(g){switch(g.label){case 0:if(!(this.uiOpacity&&this.progressBar))return[3,3];this.uiOpacity.opacity=255,this.progressBar.progress=.9;p=G(this.uiOpacity).to(.15,{opacity:0},{easing:"cubicIn"}),v=G(this.progressBar).to(.2,{progress:1},{easing:"cubicIn"});this.runLoadingTextAnimation();return[4,tJ.runTweenAsync(v)];case 1:g.sent(),this.stopLoadingTextAnimation();return[4,tJ.runTweenAsync(p)];case 2:g.sent(),this.node.active=!1;g.label=3;case 3:return[2]}})}),function(){return v.apply(this,arguments)})}]),a}(L)).prototype,"progressBar",[sB],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),sj=Ye(sG.prototype,"loadingText",[sU],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),sz=sG))||sz);g._RF.pop(),g._RF.push({},"74caciRBKZLu7ymXYJK2GYy","Loading",void 0);var s1=E.ccclass,s2=E.property,s4=(sW=s1("Loading"),sK=s2(K),sW((sQ=Ye((sJ=function(p){Ie(a,p);var v,g,E=xe(a);function a(){var p;Ce(this,a);for(var v=arguments.length,g=new Array(v),k=0;k<v;k++)g[k]=arguments[k];return je(p=E.call.apply(E,[this].concat(g)),"loadingPrefab",sQ,Ne(p)),p.loadingNode=null,p}return Ae(a,[{key:"__preload",value:function(){this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){e7.lazyValidateProperties(this)}},{key:"onLoad",value:function(){this.makePersistent()}},{key:"makePersistent",value:function(){D.addPersistRootNode(this.node)}},{key:"createLoadingFullScreen",value:function(){var p,v=W("Canvas");if(v&&!v.getChildByName("Loading")){this.loadingNode||(this.loadingNode=T(this.loadingPrefab));var g=T._clone(this.loadingNode);this.loadingFullScreen=g.getComponent(s0),this.node.active=!1,null===(p=W("Canvas"))||void 0===p||p.addChild(g)}}},{key:"show",value:(g=Ee(function(){var p;return _ts_generator(this,function(v){switch(v.label){case 0:this.createLoadingFullScreen();p=this.node.active;if(p)return[3,2];this.node.active=!0;return[4,this.loadingFullScreen.show()];case 1:p=v.sent();v.label=2;case 2:return[2]}})}),function(){return g.apply(this,arguments)})},{key:"hide",value:(v=Ee(function(){var p,v;return _ts_generator(this,function(g){switch(g.label){case 0:v=null!==(p=this.node)&&void 0!==p&&p.active&&this.loadingFullScreen;if(!v)return[3,2];return[4,this.loadingFullScreen.hide()];case 1:v=(g.sent(),this.node.active=!1);g.label=2;case 2:return[2]}})}),function(){return v.apply(this,arguments)})}]),a}(L)).prototype,"loadingPrefab",[sK],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),sX=sJ))||sX);g._RF.pop(),g._RF.push({},"a0dcdDZxhZImZ8Cfg4Dc7SJ","ScreenUtils",void 0);var s3=globalThis.game.event,s5=GameCore,s6=s5.Events,s9=s5.Utils.Array,s8=function(){function e(){Ce(this,e),this.showedScreens=[]}var p,v;return Ae(e,null,[{key:"inst",get:function(){return this._instance||(this._instance=new e),this._instance}},{key:"openScreen",value:function(p,v){var g=nV[p];s3.emit(s6.OPEN_SCREEN,{screenName:g,screenData:v})}},{key:"closeScreen",value:function(p){var v=nV[p];s3.emit(s6.CLOSE_SCREEN,{screenName:v})}},{key:"showLoadingScreen",value:function(p){this.openScreen(nH.LOADING_SCREEN,{duration:p})}},{key:"closeLoadingScreen",value:function(){this.closeScreen(nH.LOADING_SCREEN)}},{key:"showNotificationScreen",value:function(p,v){this.openScreen(nH.NOTIFICATION_SCREEN,{message:p,duration:v})}},{key:"closeNotificationScreen",value:function(){this.closeScreen(nH.NOTIFICATION_SCREEN)}},{key:"addShowedScene",value:function(p){s9.has(this.inst.showedScreens,p)||this.inst.showedScreens.push(p)}},{key:"showLoadingFullScreen",value:(v=Ee(function(p){var v,g;return _ts_generator(this,function(E){switch(E.label){case 0:if(!!s9.has(this.inst.showedScreens,p))return[3,3];this.addShowedScene(p);v=W("Loading");g=v;if(!g)return[3,2];v.active=!0;return[4,v.getComponent(s4).show()];case 1:g=E.sent();E.label=2;case 2:E.label=3;case 3:return[2]}})}),function(p){return v.apply(this,arguments)})},{key:"hideLoadingFullScreen",value:(p=Ee(function(p){var v,g;return _ts_generator(this,function(E){switch(E.label){case 0:g=s9.has(this.inst.showedScreens,p);if(g)return[3,2];return[4,null===(v=W("Loading"))||void 0===v?void 0:v.getComponent(s4).hide()];case 1:g=E.sent();E.label=2;case 2:return[2]}})}),function(v){return p.apply(this,arguments)})},{key:"showLoadingNotificationScreen",value:function(){this.openScreen(nH.NOTIFICATION_SCREEN,{message:"Loading",enableCloseOnTouch:!1})}},{key:"showTournamentDetailScreen",value:function(p,v){this.openScreen(nH.TOURNAMENT_DETAIL_SCREEN,{tournament:p,tournamentContextType:v})}},{key:"closeTournamentDetailScreen",value:function(){this.closeScreen(nH.TOURNAMENT_DETAIL_SCREEN)}}]),e}();try{new s8}catch(p){console.error("ScreenUtils",p)}g._RF.pop(),g._RF.push({},"d6fb7/+FFxLs7k5w6K38JYb","TournamentUtils",void 0);var s7=GameCore,le=s7.Utils,lt=le.String,ln=le.Valid,li=le.Array,la=s7.Configs.Mockup.Leaderboards,lr=globalThis.game,lo=lr.leaderboard,ls=lr.player,ll=function(){function e(){var p=this;Ce(this,e),this.globalTournamentLBData=[],this.playerTournaments=[],this.tournamentData=[],this.maxTimeRefetch=5e3,this.lastFetchTournamentsData=0,this.lastFetchGlobalTournament=0,this.fetchGlobalTournamentLeaderboardAsync=Ee(function(){var v,g;return _ts_generator(this,function(E){switch(E.label){case 0:E.trys.push([0,3,,4]);v=Date.now()-p.lastFetchGlobalTournament>p.maxTimeRefetch;if(!v)return[3,2];return[4,lo.requestLeaderboardsAsync({limit:100,type:"world_tournament_leaderboard"})];case 1:v=(p.globalTournamentLBData=E.sent(),p.globalTournamentLBData.sort(function(p,v){return p.expireTime-v.expireTime}));E.label=2;case 2:return[3,4];case 3:g=E.sent();console.warn("fetchGlobalTournamentLeaderboardAsync",g);return[3,4];case 4:return[2,p.globalTournamentLBData]}})}),this.fetchTournamentsAsync=Ee(function(){var v,g;return _ts_generator(this,function(E){switch(E.label){case 0:E.trys.push([0,3,,4]);v=Date.now()-p.lastFetchTournamentsData>p.maxTimeRefetch;if(!v)return[3,2];return[4,GameSDK.tournament.getTournamentsAsync()];case 1:v=(p.playerTournaments=E.sent(),p.playerTournaments.sort(function(p,v){return p.getEndTime()-v.getEndTime()}));E.label=2;case 2:return[3,4];case 3:g=E.sent();console.warn("fetchTournamentsAsync",g);return[3,4];case 4:return[2,p.playerTournaments]}})})}var p;return Ae(e,[{key:"processPlayerTournamentData",value:function(){var p,v=[],g=We(this.playerTournaments);try{for(g.s();!(p=g.n()).done;){var E,k,C=p.value,_="".concat(C.getID()),A=C.getContextID(),T=C.getEndTime(),I=this.parseTournamentPayload(C.getPayload());if(this.validateGameSDKTournamentPayload(I)){if(!(T<Date.now()/1e3)&&"PAGE_HOSTED"!==C.getTournamentType()){var R=null!==(E=I.playerName)&&void 0!==E?E:"Player",P={id:_,title:null!==(k=C.getTitle())&&void 0!==k?k:this.createDefaultTournamentName(R),endTime:T,contextId:A,payload:I};v.push(P)}}}}catch(p){g.e(p)}finally{g.f()}return v}},{key:"processGlobalTournamentLeaderboardData",value:function(){var p=[];if(la.Enabled){for(var v=0;v<this.playerTournaments.length;v++){var g,E=this.playerTournaments[v],k=E.getTournamentType();if("PAGE_HOSTED"===k){var C="".concat(E.getID()),_=E.getContextID(),A=E.getEndTime(),T=this.parseTournamentPayload(E.getPayload()),I={id:C,title:null!==(g=E.getTitle())&&void 0!==g?g:"Global Tournament",endTime:A,contextId:_,payload:T,tournamentType:k};p.push(I)}}return p}for(var R=0;R<this.globalTournamentLBData.length;R++){var P,N={tournamentId:"",contextId:""},D=this.globalTournamentLBData[R];try{N=JSON.parse(D.description)}catch(p){continue}if(this.validateExpireTime(D)&&this.validateGlobalTournamentPayload(N)){var L={id:N.tournamentId,title:D.name,endTime:this.getTournamentEndTime(D),contextId:N.contextId,payload:{playerId:"global",playerName:"global",leaderboardId:D._id,themeId:null!==(P=N.themeId)&&void 0!==P?P:sp.SUMMER}};p.push(L)}}return p}},{key:"validateGlobalTournamentPayload",value:function(p){var v=p.tournamentId,g=p.contextId;return!(!ln.isString(v)||""===v)&&!(!ln.isString(g)||""===g)}},{key:"getTournamentEndTime",value:function(p){var v=new Date(p.createdAt).getTime();return Math.round((1e3*p.expireTime+v)/1e3)}},{key:"validateExpireTime",value:function(p){return 1e3*this.getTournamentEndTime(p)-Date.now()>0}},{key:"validateGameSDKTournamentPayload",value:function(p){return!(!ln.isString(p.playerId)||""===p.playerId)&&!(!ln.isString(p.playerName)||""===p.playerName)&&!(!ln.isString(p.leaderboardId)||""===p.leaderboardId)}},{key:"createDefaultTournamentName",value:function(p){var v=p.substring(0,7),g="".concat(v.split(" ")[0]||v,"'s Tournament"),E=lt.removeDiacritics(g);return"".concat(E)}},{key:"parseTournamentPayload",value:function(p){if("string"!=typeof p)return{};try{return JSON.parse(p)}catch(p){return{}}}}],[{key:"getInstance",value:function(){return this._instance||(this._instance=new e),this._instance}},{key:"requestTournamentDataAsync",value:(p=Ee(function(){var p,v,g;return _ts_generator(this,function(E){switch(E.label){case 0:p=this.getInstance();return[4,Promise.all([p.fetchTournamentsAsync(),p.fetchGlobalTournamentLeaderboardAsync()])];case 1:E.sent();v=p.processPlayerTournamentData(),g=p.processGlobalTournamentLeaderboardData();return[2,(p.tournamentData=[].concat(He(v),He(g)),p.tournamentData.sort(function(p,v){return p.endTime-v.endTime}),p.tournamentData.forEach(function(p){var v=p.payload.leaderboardId;v&&(lo.isExistLeaderboardId(v)||lo.addLeaderboard({type:"tournament",name:v,autoSortRank:!0,leaderboardId:v}))}),p.tournamentData)]}})}),function(){return p.apply(this,arguments)})},{key:"getAllTournamentData",value:function(){return this.getInstance().tournamentData}},{key:"getTournamentDataById",value:function(p){var v=this.getInstance();return li.search(v.tournamentData,function(v){return v.id===p})}},{key:"getPlayerTournamentData",value:function(){var p=this.getInstance(),v=ls.getPlayerId();return p.tournamentData.filter(function(p){return p.payload.playerId===v})}},{key:"getFriendsTournamentData",value:function(){var p=this.getInstance(),v=ls.getPlayerId();return p.tournamentData.filter(function(p){var g=p.payload;return g.playerId!==v&&"global"!==g.playerId})}},{key:"getGlobalTournamentData",value:function(){return this.getInstance().tournamentData.filter(function(p){return"global"===p.payload.playerId})}},{key:"validateTournamentExpired",value:function(p){var v=this.getTournamentDataById(p);return!!v&&v.endTime<Date.now()/1e3}}]),e}();g._RF.pop(),g._RF.push({},"d90c4WisP9LybAFqNuS6imZ","FailKeys",void 0);var lu,lc="time",ld="bomb";g._RF.pop(),g._RF.push({},"44b50YkamZDD5fO9vdZKeG7","InputController",void 0);var lp=(0,E.ccclass)("InputController")(lu=function(p){Ie(n,p);var v=xe(n);function n(){var p;Ce(this,n);for(var g=arguments.length,E=new Array(g),k=0;k<g;k++)E[k]=arguments[k];return(p=v.call.apply(v,[this].concat(E))).handleElementPointerDown=function(){},p.handleElementPointerUp=function(p){},p}return Ae(n,[{key:"onLoad",value:function(){this.listenInputEvents()}},{key:"listenInputEvents",value:function(){ep.os!==ep.OS.WINDOWS&&ep.os!==ep.OS.OSX||(document.addEventListener("pointerup",this.handleElementPointerUp),document.addEventListener("pointerdown",this.handleElementPointerDown))}},{key:"onDestroy",value:function(){ep.os!==ep.OS.WINDOWS&&ep.os!==ep.OS.OSX||(document.removeEventListener("pointerup",this.handleElementPointerUp),document.removeEventListener("pointerdown",this.handleElementPointerDown))}}]),n}(L))||lu;g._RF.pop(),g._RF.push({},"7f144HjLfBLWbFvbRFCCt8e","Directions",void 0);var lf={Up:{x:0,y:1},Down:{x:0,y:-1},Left:{x:-1,y:0},Right:{x:1,y:0}};g._RF.pop(),g._RF.push({},"361eckT3VBO5ZFyetePNmNY","LevelGravity",void 0);var ly="fall-down",lv="fly-up",lg="push-left",lm="push-right",lb="put-column-middle",lw="put-row-middle";function ic(p){for(var v=p.array,g=p.isLighter,E=p.out,k=void 0===E?new Set:E,C=0;C<v.length;C++)if(g(v.get(C))){for(var _=C+1;_<v.length;_++)if(!g(v.get(_))){v.swap(C,_),k.add(v.get(C));break}}return k}g._RF.pop(),g._RF.push({},"cf506DevntPeIl9QrpMEBY0","Grid",void 0);var lS=function(){function e(p){var v;Ce(this,e),this.array=[];var g=null!=p?p:{},E=g.width,k=void 0===E?1:E,C=g.height,_=void 0===C?1:C,A=_instanceof(p,e)?p.array:null!==(v=null==p?void 0:p.content)&&void 0!==v?v:[];if(A.length!==k*_)throw new Error("Invalid content length");this.width=k,this.height=_,this.array=He(A)}return Ae(e,[{key:"asArray",value:function(){return this.array}},{key:"get",value:function(p,v){return this.array[v*this.width+p]}},{key:"set",value:function(p,v,g){this.array[v*this.width+p]=g}},{key:"isInBounds",value:function(p,v){return p>=0&&p<this.width&&v>=0&&v<this.height}},{key:"forEach",value:function(p){for(var v=0;v<this.height;v++)for(var g=0;g<this.width;g++)p(this.get(g,v),g,v)}},{key:"map",value:function(p){for(var v=[],g=0;g<this.height;g++)for(var E=0;E<this.width;E++)v.push(p(this.get(E,g),E,g));return v}},{key:"reduce",value:function(p,v){for(var g=v,E=0;E<this.height;E++)for(var k=0;k<this.width;k++)g=p(g,this.get(k,E),k,E);return g}},{key:"swap",value:function(p,v){var g=Ue(p,2),E=g[0],k=g[1],C=Ue(v,2),_=C[0],A=C[1],T=this.get(E,k);this.set(E,k,this.get(_,A)),this.set(_,A,T)}},{key:"shuffle",value:function(p){for(var v,g=He(p=null!==(v=p)&&void 0!==v?v:this.map(function(p,v,g){return[v,g]})),E=new Set,k=g.length-1;k>0;k--){var C=ew(0,k+1),_=[g[C],g[k]];g[k]=_[0],g[C]=_[1],E.add(this.get(g[k][0],g[k][1])),E.add(this.get(g[C][0],g[C][1]))}for(var A=0;A<g.length;A++){var T=Ue(p[A],2),I=T[0],R=T[1],P=Ue(g[A],2),N=P[0],D=P[1];this.swap([I,R],[N,D])}return E}},{key:"toShuffled",value:function(p){var v=new e({width:this.width,height:this.height,content:this.array}),g=v.shuffle(p);return[v,g]}},{key:"gravitate",value:function(p){var v=this,g=Ue(p.rowRange,2),E=g[0],k=g[1],C=Ue(p.colRange,2),_=C[0],A=C[1],T=p.direction,I=p.isLighter,R=p.onSwap,P=p.out,N=void 0===P?new Set:P,D=A-_+1,L=k-E+1;switch(T){case lf.Up:for(var f=function(p){ic({array:{length:L,get:function(g){return v.get(p,k-g)},swap:function(g,E){var C=v.get(p,k-g),_=v.get(p,k-E);v.swap([p,k-g],[p,k-E]),null==R||R(C,_)}},isLighter:I,out:N})},O=_;O<=A;O++)f(O);return N;case lf.Down:for(var m=function(p){ic({array:{length:L,get:function(g){return v.get(p,E+g)},swap:function(g,k){var C=v.get(p,E+g),_=v.get(p,E+k);v.swap([p,E+g],[p,E+k]),null==R||R(C,_)}},isLighter:I,out:N})},M=_;M<=A;M++)m(M);return N;case lf.Left:for(var b=function(p){ic({array:{length:D,get:function(g){return v.get(_+g,p)},swap:function(g,E){var k=v.get(_+g,p),C=v.get(_+E,p);v.swap([_+g,p],[_+E,p]),null==R||R(k,C)}},isLighter:I,out:N})},x=E;x<=k;x++)b(x);return N;case lf.Right:for(var w=function(p){ic({array:{length:D,get:function(g){return v.get(A-g,p)},swap:function(g,E){var k=v.get(A-g,p),C=v.get(A-E,p);v.swap([A-g,p],[A-E,p]),null==R||R(k,C)}},isLighter:I,out:N})},F=E;F<=k;F++)w(F);return N;default:throw new Error("Invalid direction")}}},{key:"toGravitated",value:function(){var p=new e({width:this.width,height:this.height,content:this.array}),v=p.gravitate.apply(p,arguments);return[p,v]}},{key:"toRotated",value:function(){for(var p=new e({width:this.height,height:this.width,content:new Array(this.width*this.height)}),v=0;v<this.height;v++)for(var g=0;g<this.width;g++)p.set(this.height-1-v,g,this.get(g,v));return p}}]),e}();g._RF.pop(),g._RF.push({},"4046cPYak1BDIVFKksVPsnk","index",void 0),g._RF.pop(),g._RF.push({},"c517dy1TKlPd7mHxulLPv1G","TileSpecialTypes",void 0);var lE,lk,lC,l_,lA,lT,lI,lR,lP,lN,lD,lL,lO,lM,lx,lF,lB,lU,lz,lG,lY,lj,lH,lV,lq,lW={bomb:"bomb",star:"star",none:"none"};g._RF.pop(),g._RF.push({},"ea140gA27tJa4LD9MT3t93/","Tile",void 0);var lK=E.ccclass,lX=E.property,lJ=E.requireComponent,lQ=(lE=lK("Tile"),lk=lJ([A]),lC=lJ([et]),l_=lX(V),lA=lX(V),lT=lX(V),lI=lX(k),lR=lX({type:A,displayName:"Background's UI Transform"}),lP=lX({type:et,displayName:"This UI Opacity"}),lN=lX(et),lD=lX(et),lL=lX(ix),lO=lX(M),lE(lM=lk(lM=lC((lF=Ye((lx=function(p){Ie(h,p);var v,g,E,k,C,_,A,T,I,R=xe(h);function h(){var p;Ce(this,h);for(var v=arguments.length,g=new Array(v),E=0;E<v;E++)g[E]=arguments[E];return je(p=R.call.apply(R,[this].concat(g)),"icon",lF,Ne(p)),je(p,"bombComponent",lB,Ne(p)),je(p,"starComponent",lU,Ne(p)),je(p,"background",lz,Ne(p)),je(p,"bgUITransform",lG,Ne(p)),je(p,"uiOpacity",lY,Ne(p)),je(p,"shineOpacity",lj,Ne(p)),je(p,"glowOpacity",lH,Ne(p)),je(p,"button",lV,Ne(p)),je(p,"animationComponent",lq,Ne(p)),p.id=null,p.isEmpty=!1,p.coord=new eg,p.restoreSignal=new na,p}return Ae(h,[{key:"onLoad",value:function(){e7.lazyValidateProperties(this),this.special=this.createSpecialHandler(lW.none)}},{key:"update",value:function(p){var v;(null===(v=this.special)||void 0===v?void 0:v.type)===lW.bomb&&this.special.update(p)}},{key:"onDestroy",value:function(){var p,v;(null===(p=this.special)||void 0===p?void 0:p.type)===lW.bomb&&(null===(v=this.special)||void 0===v||v.onDestroy())}},{key:"setIgnoreInput",value:function(p){var v=!(arguments.length>0&&void 0!==p)||p;this.button.interactable=!v}},{key:"getCoord",value:function(){return this.coord}},{key:"setCoord",value:function(p,v){this.coord.set(p,v)}},{key:"isSimilarTo",value:function(p){return this.id===p.id}},{key:"inSamePositionAs",value:function(p,v){return _instanceof(p,h)?this.coord.equals(p.getCoord()):this.coord.x===p&&this.coord.y===v}},{key:"isHidden",value:function(){return this.isEmpty}},{key:"getSize",value:function(){return[this.bgUITransform.width,this.bgUITransform.height]}},{key:"onClick",value:function(){this.isHidden()||this.node.scene.emit(aR.TILE_CLICK,this)}},{key:"setIdentity",value:function(p){this.id=p,this.icon.spriteFrame=p;var v=Ue(this.getSize(),2),g=v[0],E=v[1],k=p.originalSize,C=k.width,_=k.height,A=Math.max(C/(.7*g),_/(.7*E));A>1&&this.icon.node.setScale(new ef(1/A,1/A,1))}},{key:"setSpecialType",value:function(p,v){var g,E=arguments.length>0&&void 0!==p?p:lW.none,k=arguments.length>1?v:void 0;null===(g=this.special)||void 0===g||g.switch(E,k)}},{key:"setFocused",value:(I=Ee(function(p){var v,g,E;return _ts_generator(this,function(k){switch(k.label){case 0:v=G(this.shineOpacity).to(.2,{opacity:p?255:0},{easing:"quadIn"});this.shineOpacity.node.scale=p?ef.ZERO:ef.ONE;g=G(this.shineOpacity.node).to(.2,{scale:p?ef.ONE:ef.ZERO},{easing:"quadOut"});if(p){E=G(this.glowOpacity).to(2,{opacity:150});E.to(2,{opacity:20}),this.glowOpacityTween=G(this.glowOpacity).repeatForever(E).start()}else this.glowOpacityTween&&this.glowOpacityTween.stop(),this.glowOpacity.opacity=0;return[4,Promise.all([tJ.runTweenAsync(v),tJ.runTweenAsync(g)])];case 1:k.sent();return[2]}})}),function(p){return I.apply(this,arguments)})},{key:"setEmpty",value:function(p){var v,g,E=arguments.length>0&&void 0!==p&&p;if(!this.isEmpty){var k;if(this.restoreSignal.abort(),this.isEmpty=!0,this.setIgnoreInput(!0),this.button.resetButtonState(),E)return this.uiOpacity.opacity=0,void(null===(k=this.special)||void 0===k||k.switch(lW.none));(null===(v=this.special)||void 0===v?void 0:v.type)===lW.star&&this.special.clear(),null===(g=this.special)||void 0===g||g.switch(lW.none),this.uiOpacity.opacity=0}}},{key:"setHint",value:(T=Ee(function(p){var v;return _ts_generator(this,function(g){switch(g.label){case 0:if(!p)return[3,2];return[4,this.loadShakeClip()];case 1:g.sent(),this.shakeClip&&this.runAnimation(this.shakeClip.name);return[3,4];case 2:this.animationComponent.stop();v=G(this.background).to(.1,{scale:ef.ONE,eulerAngles:ef.ZERO});return[4,tJ.runTweenAsync(v)];case 3:g.sent();g.label=4;case 4:return[2]}})}),function(p){return T.apply(this,arguments)})},{key:"playClearFX",value:(A=Ee(function(p){var v,g;return _ts_generator(this,function(E){switch(E.label){case 0:v=null;if("clear"!==p)return[3,2];return[4,this.loadClearClip()];case 1:E.sent(),v=this.clearClip;return[3,4];case 2:return[4,this.loadBreakClip()];case 3:E.sent(),v=this.breakClip;E.label=4;case 4:g=null!==v;if(!g)return[3,6];return[4,this.runAnimation(v.name)];case 5:g=E.sent();E.label=6;case 6:return[2]}})}),function(p){return A.apply(this,arguments)})},{key:"restore",value:(_=Ee(function(p){return _ts_generator(this,function(v){switch(v.label){case 0:this.restoreSignal.abort(),this.restoreSignal=new na,this.isEmpty=!1,this.setIgnoreInput(!0),p&&this.setIdentity(p),this.uiOpacity.opacity=255,this.node.setScale(ef.ZERO),this.button.fakeClick();return[4,tJ.runTweenAsync(G(this.node).to(.3,{scale:ef.ONE},{easing:"backOut"}),this.restoreSignal)];case 1:v.sent(),this.node.setScale(ef.ONE),this.setIgnoreInput(!1);return[2]}})}),function(p){return _.apply(this,arguments)})},{key:"sync",value:(C=Ee(function(p){var v,g,E,k,C,_,A,T;return _ts_generator(this,function(I){switch(I.label){case 0:v=p.duration,g=void 0===v?.3:v,E=p.delay,k=void 0===E?0:E,C=p.easing,_=void 0===C?"cubicOut":C,A=(0,p.getTargetPosition)(this.coord),T=new ef(A.x,A.y,this.node.position.z);return[4,tJ.runTweenAsync(G(this.node).delay(k).to(g,{position:T},{easing:_}))];case 1:I.sent();return[2]}})}),function(p){return C.apply(this,arguments)})},{key:"fly",value:(k=Ee(function(p){var v,g,E,k,C,_,A,T,I,R,P,N,D,L,O,M,x,F;return _ts_generator(this,function(B){v=this,g=300,E=Math.sqrt(Math.pow(this.node.position.x,2)+Math.pow(this.node.position.y,2)),k=Math.max(g-.7*E,0),C=E/1e3,_=this.node.position.clone(),A=p.getTilePosition(this.coord),T=new ef(A.x,A.y,this.node.position.z),I=this.background,R=2,P=1,N=360,D=.0025*k,L=0,O=new ef(0,0,0),M=.75-D,x={value:0,prevElapsed:0},F=G(x);return[2,(F.delay(C),F.to(.5,{value:0},{progress:function(p,g,E,k){var C=(R*=-1)*k,A=_.clone();return A.x+=C,v.node.setPosition(A),E}}),F.to(D,{value:1},{progress:function(p,E,C,_){var A=tJ.easeOutExpo(_),T=D*_-x.prevElapsed,R=D*_,L=k*A;v.setHeight(L,g);var O=v.node.position.clone();P+=.1,ef.rotateZ(O,O,new ef(0,0,0),P*Math.PI*T),v.node.setPosition(new ef(O.x,O.y,O.z));var M=(N+=10)*T;return I.angle+=M,x.prevElapsed=R,C}}),F.call(function(){O.set((v.node.position.x+T.x)/2,(v.node.position.y+T.y)/2,0),x.prevElapsed=0,I.angle%=360,I.angle-=360,L=I.angle}),F.to(M,{value:0},{progress:function(p,E,C,_){var A=M*_-x.prevElapsed,T=M*_,R=k*(1-_);v.setHeight(R,g);var P=v.node.position.clone();return ef.rotateZ(P,P,O,Math.PI/M*A),v.node.setPosition(new ef(P.x,P.y,P.z)),I.angle+=-L/M*A,x.prevElapsed=T,C}}),F.call(function(){v.node.setPosition(T),v.setHeight(0,g),I.angle=0}),tJ.runTweenAsync(F))]})}),function(p){return k.apply(this,arguments)})},{key:"loadBreakClip",value:(E=Ee(function(){var p;return _ts_generator(this,function(v){switch(v.label){case 0:if(this.breakClip)return[2,Promise.resolve()];return[4,nP.loadAnimClipAsync(nr.TILE_BREAK_ANIM)];case 1:p=v.sent();if(!p)return[2,Promise.resolve()];this.breakClip=p,this.animationComponent.addClip(this.breakClip);return[2]}})}),function(){return E.apply(this,arguments)})},{key:"loadClearClip",value:(g=Ee(function(){var p;return _ts_generator(this,function(v){switch(v.label){case 0:if(this.clearClip)return[2,Promise.resolve()];return[4,nP.loadAnimClipAsync(nr.TILE_CLEAR_ANIM)];case 1:p=v.sent();if(!p)return[2,Promise.resolve()];this.clearClip=p,this.animationComponent.addClip(this.clearClip);return[2]}})}),function(){return g.apply(this,arguments)})},{key:"loadShakeClip",value:(v=Ee(function(){var p;return _ts_generator(this,function(v){switch(v.label){case 0:if(this.shakeClip)return[2,Promise.resolve()];return[4,nP.loadAnimClipAsync(nr.TILE_SHAKE_ANIM)];case 1:p=v.sent();if(!p)return[2,Promise.resolve()];this.shakeClip=p,this.animationComponent.addClip(this.shakeClip);return[2]}})}),function(){return v.apply(this,arguments)})},{key:"runAnimation",value:function(p){var v=this;return this.animationComponent.play(p),new Promise(function(p){v.animationComponent.once(M.EventType.FINISHED,function(){p()})})}},{key:"setHeight",value:function(p,v){var g=this.background;g.setPosition(new ef(g.position.x,p,0)),g.setScale(new ef(1+p/v*.3,1+p/v*.3,1))}},{key:"createSpecialHandler",value:function(p,v){var g=this;switch(p){case lW.bomb:return this.createBombHandler(null!=v?v:90);case lW.star:return this.createStarHandler();default:return{type:lW.none,switch:function(p,v){g.special=g.createSpecialHandler(p,v)}}}}},{key:"createBombHandler",value:function(p){var v=this,g=!1,E=p,a=function(){g=!0},o=function(){g=!1};this.node.scene.on(aR.TILE_CLICK,a),this.node.scene.on(aR.USE_ITEM,a),this.node.scene.on(aR.RESUME_TIME,a),this.node.scene.on(aR.PAUSE_TIME,o),this.node.scene.on(aR.TIME_OUT,o),this.bombComponent.node.active=!0;var r=function(){g=!1,v.bombComponent.node.active=!1,E=p,v.node.scene.off(aR.TILE_CLICK,a),v.node.scene.off(aR.USE_ITEM,a),v.node.scene.off(aR.GAME_RESUME,a),v.node.scene.off(aR.GAME_PAUSE,o),v.node.scene.off(aR.TIME_OUT,o)};return{type:lW.bomb,update:function(k){g&&(E-=k,v.bombComponent.fillRange=-E/p,E<=0&&(g=!1,v.bombComponent.node.active=!1,v.node.scene.emit(aR.BOMB_EXPLODE,v),v.setEmpty()))},cleanup:r,onDestroy:function(){v.node.scene.off(aR.TILE_CLICK,a),v.node.scene.off(aR.USE_ITEM,a),v.node.scene.off(aR.GAME_RESUME,a),v.node.scene.off(aR.GAME_PAUSE,o),v.node.scene.off(aR.TIME_OUT,o)},switch:function(p,g){r(),v.special=v.createSpecialHandler(p,g)},detonateImmediately:function(){E=0}}}},{key:"createStarHandler",value:function(){var p=this;this.starComponent.node.active=!0;var t=function(){p.starComponent.node.active=!1};return{type:lW.star,clear:function(){p.starComponent.node.active=!1;var v=p.node.worldPosition,g=v.x,E=v.y;p.node.scene.emit(aR.ADD_STARS,{startAnimationAt:[g,E]})},cleanup:t,switch:function(v){t(),p.special=p.createSpecialHandler(v)}}}}]),h}(L)).prototype,"icon",[l_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),lB=Ye(lx.prototype,"bombComponent",[lA],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),lU=Ye(lx.prototype,"starComponent",[lT],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),lz=Ye(lx.prototype,"background",[lI],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),lG=Ye(lx.prototype,"bgUITransform",[lR],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),lY=Ye(lx.prototype,"uiOpacity",[lP],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),lj=Ye(lx.prototype,"shineOpacity",[lN],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),lH=Ye(lx.prototype,"glowOpacity",[lD],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),lV=Ye(lx.prototype,"button",[lL],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),lq=Ye(lx.prototype,"animationComponent",[lO],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),lM=lx))||lM)||lM)||lM);function Mc(p,v,g,E){var k=arguments.length>3&&void 0!==E?E:0,C=g.x,_=g.y,A=Ue(v,2),T=A[0],I=A[1],R=T*(C-(p.width-1)/2)+k*(C-p.width/2),P=I*(_-(p.height-1)/2)+k*(_-p.height/2);return -1===C&&(R+=v[0]/4),C===p.width&&(R-=v[0]/4),-1===_&&(P+=v[1]/4),_===p.height&&(P-=v[1]/4),{x:R,y:P}}function xc(p,v){var g=arguments.length>1&&void 0!==v?v:[0,0],E=Ue(p,2),k=E[0],C=E[1],_=Ue(g,2),A=_[0],T=_[1],I=1-A,R=1-T,P=k*I,N=C*R;return[P,N]}function Bc(p,v){for(var g=arguments.length>1&&void 0!==v&&v,E=p.split("-"),k=[],C=0;C<E.length;){var _=null,A=E[C];switch(A){case"normal":C+=1;break;case"fall":_=ly,C+=2;break;case"fly":_=lv,C+=2;break;case"push":"left"===E[C+1]?(_=lg,C+=2):(_=lm,C+=2);break;case"put":"columns"===E[C+1]?(_=lb,C+=3):(_=lw,C+=3)}_&&(g&&(_=Fc(_)),k.push(_))}return k}function Fc(p){switch(p){case ly:return lm;case lv:return lg;case lg:return ly;case lm:return lv;case lb:return lw;case lw:return lb}}function zc(p){return(_instanceof(p,lS)?p.asArray():p).filter(function(p){return!p.isHidden()})}function Gc(p){return(_instanceof(p,lS)?p.asArray():p).filter(function(p){return p.isHidden()})}g._RF.pop(),g._RF.push({},"d6995j9hvVJYKs6vvV+rs1I","index",void 0),g._RF.pop(),g._RF.push({},"cb8ddC2w59DpqVoQENbYYcU","calcBoardScale",void 0),g._RF.pop(),g._RF.push({},"305c7LJx+ROLI4g8tTiAFyb","calcTilePosition",void 0),g._RF.pop(),g._RF.push({},"c522ca1UPhDYaToWf66t1X2","calcTileSize",void 0),g._RF.pop(),g._RF.push({},"37667B66RZBc5chlMqN6mH8","parseLevelGravity",void 0),g._RF.pop(),g._RF.push({},"f0f0bXgdxJHIJWOmA6n0Ood","getUncleared",void 0),g._RF.pop(),g._RF.push({},"a90bcq22hlMzbYdivjPpm0h","getBombTiles",void 0),g._RF.pop(),g._RF.push({},"92e23drVfRIgbDVZLTSdEkI","getCleared",void 0),g._RF.pop(),g._RF.push({},"7105bfR+Y5F1a0SDiMXZ9mV","getNearbyTiles",void 0);var lZ=GameCore.Utils.Object;function Hc(p,v){var g=v.getCoord(),E=g.x,k=g.y;return lZ.vals(lf).reduce(function(v,g){var C=g.x,_=g.y,A=E+C,T=k+_;return p.isInBounds(A,T)&&v.push(p.get(A,T)),v},[])}function Vc(p){return Array.isArray(p)}function qc(p,v){var g=arguments.length>1&&void 0!==v?v:Date.now(),E=Vc(p)?p:p.asArray();return E[eS(g,0,E.length)]}g._RF.pop(),g._RF.push({},"d1b9bBg+dBA+7n/Sz+RCIAX","getRandomTile",void 0),g._RF.pop(),g._RF.push({},"c4bf3uyS1pEdrTrwDEXeuZP","getRandomPair",void 0);var l$=GameCore.Utils.Array;function Kc(p,v){var g=arguments.length>1&&void 0!==v?v:Date.now(),E=_instanceof(p,lS)?p.asArray():p,k=qc(E,g),C=l$.search(E,function(p){return p.isSimilarTo(k)&&!p.inSamePositionAs(k)});if(void 0===C)throw new Error("Could not find a matching tile");return[k,C]}g._RF.pop(),g._RF.push({},"cf8d6gfx2ZIsqm978cNLWaV","pseudoRandomIterable",void 0);var jc=function(p){return p};function Yc(p,v,g){var E=arguments.length>2&&void 0!==g?g:jc;return function(){var g,k;return _ts_generator(this,function(C){switch(C.label){case 0:g=v;p<=0&&(p=1/0);k=0;C.label=1;case 1:if(!(k<p))return[3,4];return[4,E(g)];case 2:C.sent(),g=1e9*eE(g);C.label=3;case 3:k++;return[3,1];case 4:return[2]}})}()}function Xc(p){return Array.isArray(p)}function Jc(p,v,g){var E=arguments.length>2&&void 0!==g?g:Date.now(),k=Xc(p)?p:p.asArray();if(k.length<v)return new Set(k);for(var C=new Set,_=Yc(-1,E),A=_.next();C.size<v;){if(A.done)throw new Error("RNG exhausted");C.add(qc(k,A.value)),A=_.next()}return C}g._RF.pop(),g._RF.push({},"718b6Wu0pdGVK5KYSUDctVX","getRandomTiles",void 0),g._RF.pop(),g._RF.push({},"17ccarKybRNwYcZnBQhCUYy","index",void 0),g._RF.pop(),g._RF.push({},"bab6dqrPz9AaaBN5cy+QzPj","assignSpecialTiles",void 0);var l0=[1,4];function Zc(p,v,g){var E=arguments.length>2&&void 0!==g?g:Date.now(),k=v.specials,C=k.bomb,_=eS.apply(void 0,[E].concat(l0)),A=Jc(p,C,E),T=p.asArray().filter(function(p){return!A.has(p)}),I=Jc(T,_,E);A.forEach(function(p){var g=2*v.time/3;p.setSpecialType(lW.bomb,g)}),I.forEach(function(p){return p.setSpecialType(lW.star)})}g._RF.pop(),g._RF.push({},"228efPdzUNCMp4yYcBs9r+3","index",void 0),g._RF.pop(),g._RF.push({},"09be7lmGLNMvIObiqskePhz","createGrid",void 0);var l1=GameCore.Utils.Array;function eh(p){var v=p.levelData,g=v.columns,E=v.rows,k=p.identities,C=p.createTile,_=p.seed,A=(function(p,v,g){var E,k=[],C=We(Yc(v/2,p,function(p){return eS(p,0,g.length)}));try{for(C.s();!(E=C.n()).done;){var _=E.value;k.push(g[_]),k.push(g[_])}}catch(p){C.e(p)}finally{C.f()}return l1.shuffle(k),k})(void 0===_?Date.now():_,g*E,k).map(function(p){var v=C(p);return v.setIdentity(p),v});return new lS({width:g,height:E,content:A})}g._RF.pop(),g._RF.push({},"5d998xlab9FLIpvw+sXMIYw","createGridFromFen",void 0);var l2=GameCore.Utils.Array;function nh(p){var v=p.customFen,g=p.identities,E=p.createTile,k=v.idSize,C=v.cols,_=v.rows,A=v.code;if(g.length<v.idSize)throw new Error("Invalid grid code. There are not enough identities/frames ".concat(g.length," to fill it according to fen code ").concat(k));var T=A.split(":");if(T.length!==_)throw new Error("Invalid grid code");var I=/[a-zA-Z]+\d+|./g,R=/[a-zA-Z]+/,P=/\d+/,N=T.reduceRight(function(p,k){var C,_=[],A=We(k.matchAll(I));try{for(A.s();!(C=A.n()).done;){var T,N,D=C.value[0],L=null===(T=P.exec(D))||void 0===T?void 0:T[0],O=void 0!==L?parseInt(L,10):void 0,M=void 0!==O&&!isNaN(O)&&O<g.length?g[O]:void 0,x=E(void 0!==M?M:g[0]),F=null===(N=R.exec(D))||void 0===N?void 0:N[0],B=void 0!==F?ih(F,v.encoding):void 0;B&&M?x.setSpecialType(B):x.setEmpty(),_.push(x)}}catch(p){A.e(p)}finally{A.f()}return p.concat(_)},[]);return new lS({width:C,height:_,content:N})}function ih(p,v){var g=l2.search(Object.entries(v),function(v){var g=Ue(v,2);g[0];return g[1]===p});if(void 0===g)throw new Error("Invalid special type ".concat(p));return g[0]}g._RF.pop(),g._RF.push({},"30de5d+cW5OjKyEubKVREbU","createRotatedGrid",void 0),g._RF.pop(),g._RF.push({},"9ceb6vNbn9PKozkdGjjZD67","ensureOneMatch",void 0);var l4=GameCore.Utils.Array;function oh(p,v){var g=arguments.length>1&&void 0!==v?v:Date.now(),E=p.asArray(),k=qc(p,g),C=Hc(p,k);if(!C.some(function(p){return p.isSimilarTo(k)})){var _=qc(C,g),A=l4.search(E,function(p){return!p.inSamePositionAs(k)&&!p.inSamePositionAs(_)&&p.isSimilarTo(_)});A.setIdentity(k.id),_.setIdentity(k.id)}}g._RF.pop(),g._RF.push({},"89318H0TDxMlJsVFwuKgrh3","index",void 0),g._RF.pop(),g._RF.push({},"fb4a9VOCxBBvpXFCcSt4P3J","NewbieSteps",void 0);var l3=[{startTile:{x:0,y:1},endTile:{x:3,y:1},description:"Tap to connect"},{startTile:{x:2,y:2},endTile:{x:3,y:0},description:"Connect similar tiles with less than 2 turns"},{startTile:{x:0,y:0},endTile:{x:3,y:3},description:"Connect similar tiles with less than 2 turns"},{startTile:{x:0,y:4},endTile:{x:2,y:3},description:"More than 2 turns are NOT allowed"},{startTile:{x:1,y:4},endTile:{x:1,y:2},description:"There's obstacle between the tiles"}];g._RF.pop(),g._RF.push({},"627d5N3oStP8q9+ABNqnHBq","getBestPath",void 0);var l5=GameCore.Utils.Array;function lh(p,v){return p[0]===v[0]&&p[1]===v[1]}function uh(p){return new eg(p[0],p[1])}function ch(p,v){return p.x>=-1&&p.x<v.width+1&&p.y>=-1&&p.y<v.height+1}function hh(p,v){var g=arguments.length>1&&void 0!==v?v:l9;return g.map(function(v){return[p.tile[0]+v.x,p.tile[1]+v.y]})}var l6,l9=[lf.Up,lf.Down,lf.Left,lf.Right],l8=function(){function e(p,v){var g;if(Ce(this,e),this.f=0,this.g=0,this.h=0,v&&lh(p,v.tile))throw new Error("Tile cannot be its own parent");this.tile=p,this.parent=v;var E=e.calcDirection(this),k=v&&E&&v.cache.direction&&!E.equals(v.cache.direction)?1:0;this.cache={direction:E,turns:k+(null!==(g=null==v?void 0:v.cache.turns)&&void 0!==g?g:0)}}return Ae(e,[{key:"getKey",value:function(){var p;return"x:".concat(this.tile[0],",y:").concat(this.tile[1],",d:").concat(null===(p=this.cache.direction)||void 0===p?void 0:p.toString())}},{key:"equals",value:function(p){return this.getKey()===p.getKey()}}],[{key:"calcDirection",value:function(p){if(p.parent){var v=p.parent.tile,g=p.tile;return new eg(g[0]-v[0],g[1]-v[1])}return null}}]),e}();function fh(p,v){var g=p.tile,E=v.tile;return Math.abs(g[0]-E[0])+Math.abs(g[1]-E[1])}function vh(p,v,g){var E,k=arguments.length>2&&void 0!==g?g:[],C=[],_=We(l9);try{var r=function(){var g=E.value,_={x:v[0]+g.x,y:v[1]+g.y};if(p.isInBounds(_.x,_.y))return(p.get(_.x,_.y).isHidden()||l5.search(k,function(p){return lh(p,[_.x,_.y])}))&&C.push(g),1;ch(_,p)&&C.push(g)};for(_.s();!(E=_.n()).done;)r()}catch(p){_.e(p)}finally{_.f()}return C}function mh(p,v,g,E){if(E){var k=l3[4].startTile,C=l3[4].endTile;if(v[0]===k.x&&v[1]===k.y&&g[0]===C.x&&g[1]===C.y)return[{a:k,b:C}];if(v[0]===C.x&&v[1]===C.y&&g[0]===k.x&&g[1]===k.y)return[{a:k,b:C}]}return function(p,v,g){var E=[],k=[],C=new l8(v,null),_=new l8(g,null),A=[_.tile];for(E.push(C);E.length>0;){var T=E.shift();if(k.push(T),lh(T.tile,_.tile)){for(var I=[],R=T,P=T,N=T.parent;N;)N.cache.turns!==P.cache.turns&&(I.unshift({a:uh(N.tile),b:uh(R.tile)}),R=N),P=N,N=N.parent;return I.unshift({a:uh(P.tile),b:uh(R.tile)}),I}var D,L=We(hh(T,vh(p,T.tile,A)));try{var f=function(){var p=D.value,v=new l8(p,T);if(v.cache.turns>8)return 0;var g=lh(v.tile,_.tile),C=k.some(function(p){return p.equals(v)});if(E.some(function(p){return p.equals(v)})||C&&!g)return 0;v.g=T.g+1+v.cache.turns,v.h=fh(v,_),v.f=v.g+v.h,E.push(v)};for(L.s();!(D=L.n()).done;)f()}catch(p){L.e(p)}finally{L.f()}E.sort(function(p,v){return p.f-v.f})}var O=C.tile,M=_.tile;return O[0]===M[0]||O[1]===M[1]?[{a:uh(O),b:uh(M)}]:[{a:uh(O),b:{x:O[0],y:M[1]}},{a:{x:O[0],y:M[1]},b:uh(M)}]}(p,v,g)}g._RF.pop(),g._RF.push({},"b622ea7Aw5LT5yfRAx8qSap","getErrorPath",void 0),g._RF.pop(),g._RF.push({},"716f6/ILpZCPp1nebbdk8Oj","getGridFen",void 0);var l7=(Re(l6={},lW.bomb,"b"),Re(l6,lW.star,"s"),Re(l6,lW.none,"t"),l6);function bh(p,v){for(var g=arguments.length>1&&void 0!==v?v:l7,E=p.width,k=p.height,C=[],_=new Map,A=k-1;A>=0;A--){for(var T=[],I=0;I<E;I++){var R,P,N=p.get(I,A),D=N.isHidden()?null:N.id;if(null!==D){var L=null!==(R=null===(P=N.special)||void 0===P?void 0:P.type)&&void 0!==R?R:lW.none,O=g[L];if(!_.has(D)){var M=_.size.toString();_.set(D,M)}var x="".concat(O).concat(_.get(D));T.push(x)}else T.push(".")}C.push(T.join(""))}return{code:C.join(":"),idSize:_.size,encoding:g,rows:k,cols:E}}function Sh(p){return p.reduce(function(p,v,g,E){return v.inSamePositionAs(g,E)||p.push([v,[g,E]]),p},[])}function wh(p,v){var g,E,k,C,_,A,T,I;return _ts_generator(this,function(R){switch(R.label){case 0:g=0,E=p-1,k=0,C=v-1;R.label=1;case 1:if(!(g<=E&&k<=C))return[3,19];_=g;R.label=2;case 2:if(!(_<=E))return[3,5];return[4,{x:_,y:k}];case 3:R.sent();R.label=4;case 4:_++;return[3,2];case 5:A=++k;R.label=6;case 6:if(!(A<=C))return[3,9];return[4,{x:E,y:A}];case 7:R.sent();R.label=8;case 8:A++;return[3,6];case 9:T=--E;R.label=10;case 10:if(!(T>=g))return[3,13];return[4,{x:T,y:C}];case 11:R.sent();R.label=12;case 12:T--;return[3,10];case 13:I=--C;R.label=14;case 14:if(!(I>=k))return[3,17];return[4,{x:g,y:I}];case 15:R.sent();R.label=16;case 16:I--;return[3,14];case 17:g++;R.label=18;case 18:return[3,1];case 19:return[2]}})}g._RF.pop(),g._RF.push({},"badfeEqwgFEorJVHO9tJSXZ","getOutOfSync",void 0),g._RF.pop(),g._RF.push({},"cd0d548/WxD7KCyW2hwySVO","traverseSpiralIn",void 0),g._RF.pop(),g._RF.push({},"373ceVkYCtMTrQObvzJgg7s","getValidPath",void 0);var ue,ut,un,ui,ua,ur,uo,us,ul,uu,uc=GameCore.Utils.Array,ud=function(){function e(p,v){Ce(this,e),this.coord=new eg(p,v)}return Ae(e,[{key:"isHidden",value:function(){return!0}},{key:"isSimilarTo",value:function(){return!1}}]),e}();function Nh(p){return new eg(p[0],p[1])}function Mh(p,v,g){if(void 0===v||void 0===g)return function(p,v){var g,E=arguments.length>1&&void 0!==v?v:wh,k=[],C=We(E(p.width,p.height));try{for(C.s();!(g=C.n()).done;){var _=g.value,A=p.get(_.x,_.y);A.isHidden()||k.push([A,[_.x,_.y]])}}catch(p){C.e(p)}finally{C.f()}var T,I=[],u=function(){var v=Ue(k.shift(),2),g=v[0],E=v[1];if(uc.search(I,function(p){return Fh(p,E)}))return 0;I.push(E);for(var C,r=function(){var v=Ue(A[_],2),k=v[0],C=v[1];if(!k.isSimilarTo(g)||uc.search(I,function(p){return Fh(p,C)}))return 0;var T=Mh(p,E,C);return null!==T?{v:{v:T}}:void 0},_=0,A=k;_<A.length;_++)if(0!==(C=r())&&C)return C.v};for(;k.length>0;)if(0!==(T=u())&&T)return T.v;return null}(p);var E,k=[v[0]+1,v[1]+1],C=[g[0]+1,g[1]+1],_=function(p){var v=uc.fillWith(p.width+2,function(p){return new ud(p-1,-1)}),g=uc.fillWith(p.width+2,function(v){return new ud(v-1,p.height)}),E=uc.fillWith(p.height,function(p){return new ud(-1,p)}),k=uc.fillWith(p.height,function(v){return new ud(p.width,v)}),o=function(C,_){var A=C-1,T=_-1;return -1===A?E[T]:A===p.width?k[T]:-1===T?v[A]:T===p.height?g[A]:p.get(A,T)};return{get:function(p,v){return o(p,v)},width:p.width+2,height:p.height+2}}(p),A=[k,C];if(k[0]===C[0]&&Gh(_,A,k[1],C[1],k[0])||k[1]===C[1]&&Uh(_,A,k[0],C[0],k[1]))return qh([{a:Nh(k),b:Nh(C)}],{x:-1,y:-1});var T=k[1]<=C[1]?k:C,I=k[1]<=C[1]?C:k,R=k[0]<=C[0]?k:C,P=k[0]<=C[0]?C:k,N=[],D=[];return -1===(E=Hh(_,A,1,Nh(T),Nh(I)))&&-1===(E=Hh(_,A,-1,Nh(T),Nh(I)))||(N=[{a:Nh(k),b:{x:k[0],y:E}},{a:{x:k[0],y:E},b:{x:C[0],y:E}},{a:{x:C[0],y:E},b:Nh(C)}]),-1===(E=Vh(_,A,1,Nh(R),Nh(P)))&&-1===(E=Vh(_,A,-1,Nh(R),Nh(P)))||(N=[{a:Nh(k),b:{x:E,y:k[1]}},{a:{x:E,y:k[1]},b:{x:E,y:C[1]}},{a:{x:E,y:C[1]},b:Nh(C)}]),-1!==(E=function(p,v,g,E){for(var k=g.y+1;k<E.y;k++)if(Gh(p,v,g.y,k,g.x)&&Uh(p,v,g.x,E.x,k)&&Gh(p,v,k,E.y,E.x))return k;return -1}(_,A,Nh(T),Nh(I)))?D=[{a:Nh(k),b:{x:k[0],y:E}},{a:{x:k[0],y:E},b:{x:C[0],y:E}},{a:{x:C[0],y:E},b:Nh(C)}]:-1!==(E=function(p,v,g,E){for(var k=g.x+1;k<E.x;k++)if(Uh(p,v,g.x,k,g.y)&&Gh(p,v,g.y,E.y,k)&&Uh(p,v,k,E.x,E.y))return k;return -1}(_,A,Nh(R),Nh(P)))&&(D=[{a:Nh(k),b:{x:E,y:k[1]}},{a:{x:E,y:k[1]},b:{x:E,y:C[1]}},{a:{x:E,y:C[1]},b:Nh(C)}]),N.length>0&&D.length>0?qh(xh(N)<=xh(D)?N:D,{x:-1,y:-1}):N.length>0?qh(N,{x:-1,y:-1}):D.length>0?qh(D,{x:-1,y:-1}):null}function xh(p){var v,g=0,E=We(p);try{for(E.s();!(v=E.n()).done;)g+=Bh(v.value)}catch(p){E.e(p)}finally{E.f()}return g}function Bh(p){return p.a.x===p.b.x?Math.abs(p.a.y-p.b.y):p.a.y===p.b.y?Math.abs(p.a.x-p.b.x):0}function Fh(p,v){return p[0]===v[0]&&p[1]===v[1]}function zh(p,v,g){var E=arguments.length>2&&void 0!==g?g:[],k=p.get.apply(p,He(v));return k.isHidden()||E.some(function(p){return Fh(p,v)})}function Gh(p,v,g,E,k){for(var C=Math.min(g,E),_=Math.max(g,E),A=C;A<=_;A++)if(!zh(p,[k,A],v))return!1;return!0}function Uh(p,v,g,E,k){for(var C=Math.min(g,E),_=Math.max(g,E),A=C;A<=_;A++)if(!zh(p,[A,k],v))return!1;return!0}function Hh(p,v,g,E,k){var C=1===g?k.y:E.y,_=1===g?E.x:k.x;if(Gh(p,v,E.y,k.y,_))for(;C>=0&&C<p.height&&zh(p,[E.x,C],v)&&zh(p,[k.x,C],v);){if(Uh(p,v,E.x,k.x,C))return C;C+=g}return -1}function Vh(p,v,g,E,k){var C=1===g?k.x:E.x,_=1===g?E.y:k.y;if(Uh(p,v,E.x,k.x,_))for(;C>=0&&C<p.width&&zh(p,[C,E.y],v)&&zh(p,[C,k.y],v);){if(Gh(p,v,E.y,k.y,C))return C;C+=g}return -1}function qh(p,v){return p.map(function(p){return{a:{x:p.a.x+v.x,y:p.a.y+v.y},b:{x:p.b.x+v.x,y:p.b.y+v.y}}})}g._RF.pop(),g._RF.push({},"0cceagmIDZNoZTxP8hBPplh","Board",void 0);var up,uf=E.ccclass,uy=E.property,uv=E.requireComponent,ug=globalThis.game.monitorError,um=GameCore.Utils.Array,ub=(ue=uf("Board"),ut=uv(A),un=uy(lQ),ui=uy(k),ua=uy({displayName:"Tile Spacing",group:"Create config"}),ue(ur=ut((us=Ye((uo=function(p){Ie(a,p);var v,g,E=xe(a);function a(){var p;Ce(this,a);for(var v=arguments.length,g=new Array(v),k=0;k<v;k++)g[k]=arguments[k];return je(p=E.call.apply(E,[this].concat(g)),"tilePrefab",us,Ne(p)),je(p,"tilesHolder",ul,Ne(p)),je(p,"tileTrim",uu,Ne(p)),p.tileSize=[0,0],p.selectedTile=null,p.layoutType="portrait",p.parsedGravityRules=[],p.normalMatches=0,p.normalMatchesSinceLastSpawn=0,p.spawnAttempts=0,p.hintPath=null,p.hintTiles=null,p.animationQueue=[],p.isConsumingAnimation=!1,p.handleViewResized=function(){p.updateTilesHolderScale()},p.onLayoutChanged=function(v){p.layoutType=v},p}return Ae(a,[{key:"onLoad",value:function(){this.uiTransform=this.getComponent(A),e7.lazyValidateProperties(this),this.tilePrefab.node.active=!1,this.listenLayoutevents()}},{key:"onDestroy",value:function(){this.unlistenLayoutevents()}},{key:"create",value:function(p,v,g){var E=this,k=arguments.length>2&&void 0!==g?g:Date.now(),C=He(p);um.shuffle(C),p=C.slice(0,v.colors),this.levelData=v,this.parsedGravityRules=Bc(v.mode,this.layoutType===i1.Landscape);var o=function(p){var v=T(E.tilePrefab.node),g=v.getComponent(lQ);return g.setIdentity(p),E.tilesHolder.addChild(v),v.active=!0,g},_=!1;if(void 0!==v.customFen)try{_=!0,this.grid=nh({customFen:v.customFen,identities:p,createTile:o}),this.grid.forEach(function(p,v,g){p.setCoord(v,g),p.setIgnoreInput(!1),p.node.setSiblingIndex(0)})}catch(p){console.error("Error creating grid from custom fen",p,"falling back to random grid"),_=!1}_||(this.grid=eh({levelData:v,seed:k,identities:p,createTile:o}),this.grid.forEach(function(p,v,g){p.setCoord(v,g),p.setIgnoreInput(!1),p.node.setSiblingIndex(0)}),oh(this.grid,k),Zc(this.grid,v,k)),this.handleBoardLayout();var A=[this.tileTrim.x,this.tileTrim.y];this.tileSize=xc(this.tilePrefab.getSize(),A),this.updateTilesHolderScale(),this.node.scene.emit(aR.GRID_CREATE,this),this.selectedTile=null,this.animationQueue=[],this.normalMatches=0,this.normalMatchesSinceLastSpawn=0,this.spawnAttempts=0,this.hintPath=null,this.processGameplayCycle()}},{key:"updateTilesHolderScale",value:function(){if(this.grid){var p=[this.grid.width,this.grid.height],v=[this.uiTransform.width,this.uiTransform.height],g=function(p,v,g){var E=Ue(p,2),k=E[0],C=E[1],_=Ue(v,2),A=_[0],T=_[1],I=Ue(g,2),R=I[0]/(k*A),P=I[1]/(C*T);return Math.min(R,P)}(p,this.tilePrefab.getSize(),v);this.tilesHolder.setScale(g,g),this.node.scene.emit(aR.GRID_RESIZE,g)}}},{key:"handleBoardLayout",value:function(){var p,v;this.layoutType===i1.Landscape&&0!==this.levelData.level&&(this.grid=(p=this.grid,(v=p.toRotated()).forEach(function(p,v,g){p.setCoord(v,g)}),v))}},{key:"destroyTiles",value:function(){var p;null===(p=this.grid)||void 0===p||p.forEach(function(p){return p.node.destroy()})}},{key:"animateTilesAppear",value:function(){var p=this;return new Promise(function(v){var g=function(){var g=Ee(function(){return _ts_generator(this,function(g){switch(g.label){case 0:return[4,Promise.all(p.grid.map(function(v,g,E){var k=ek(0,.5),C=v.node.scale.clone(),_=function(v,g){var E=eg.ZERO.clone();return p.parsedGravityRules.forEach(function(k){var C=p.getPrimitiveDirection(v,g,k);E.subtract2f(C.x,C.y)}),E.normalize()}(g,E),A=Mc(p.grid,p.tileSize,{x:g,y:E}),T=_.multiplyScalar(100).add2f(A.x,A.y);return v.node.setPosition(T.x,T.y),v.node.setScale(0,0),Promise.all([tJ.runTweenAsync(G(v.node).delay(k).to(.5,{scale:C},{easing:"elasticOut"})),v.sync({getTargetPosition:function(v){return Mc(p.grid,p.tileSize,v)},easing:"backOut",duration:.5,delay:k})])}))];case 1:g.sent(),v();return[2]}})});return function(){return g.apply(this,arguments)}}();p.animationQueue.push(g),p.consumeAnimationQueue()})}},{key:"handleTileClick",value:function(p){if(!p.isHidden()){if(this.selectedTile===p)return this.selectedTile=null,void p.setFocused(!1);if(!this.selectedTile)return this.selectedTile=p,void p.setFocused(!0);if(!this.selectedTile.isSimilarTo(p))return this.selectedTile.setFocused(!1),this.selectedTile=p,void p.setFocused(!0);this.selectedTile.setFocused(!1),this.match(this.selectedTile,p),this.selectedTile=null}}},{key:"clearSelectedTile",value:function(){this.selectedTile&&(this.selectedTile.setFocused(!1),this.selectedTile=null)}},{key:"match",value:function(p,v){var g=[p.getCoord().x,p.getCoord().y],E=[v.getCoord().x,v.getCoord().y],k=Mh(this.grid,g,E);if(null===k){nQ.playSound(nB.INVALID_MATCH),this.shakeGrid();var C=0===this.levelData.level,_=mh(this.grid,g,E,C);return this.node.scene.emit(aR.GRID_MATCH,[p,v]),void this.node.scene.emit(aR.GRID_MATCH_FAIL,_)}this.node.scene.emit(aR.GRID_MATCH,[p,v]),this.node.scene.emit(aR.GRID_MATCH_SUCCESS,k,[p,v]),this.clear([[p,v]],"clear")}},{key:"clear",value:function(p,v){var g=this,E=arguments.length>1&&void 0!==v?v:"clear";this.normalMatches+=p.length,p.forEach(function(p){var v=Ue(p,2),k=v[0],C=v[1];k.setEmpty(),C.setEmpty(),k.playClearFX(E),C.playClearFX(E),g.node.scene.emit(aR.GRID_CLEAR,[k,C])}),this.processGameplayCycle()}},{key:"showHint",value:function(){if(this.hintPath){var p=this.hintPath[0].a,v=this.hintPath[this.hintPath.length-1].b,g=this.getTileAt(p.x,p.y),E=this.getTileAt(v.x,v.y);g.setHint(!0),E.setHint(!0),this.hintTiles=[g,E]}}},{key:"hideHint",value:function(){if(this.hintTiles){var p=Ue(this.hintTiles,2),v=p[0],g=p[1];v.setHint(!1),g.setHint(!1),this.hintTiles=null}}},{key:"getHintPath",value:function(){return this.hintPath}},{key:"getTileAt",value:function(p,v){return this.grid.isInBounds(p,v)?this.grid.get(p,v):null}},{key:"getAnyTileWorldPosition",value:function(p,v){var g=Mc(this.grid,this.tileSize,{x:p,y:v});this.tilePrefab.node.setPosition(g.x,g.y);var E=this.tilePrefab.node.getWorldPosition();return{x:E.x,y:E.y}}},{key:"getTileSize",value:function(){return this.tileSize}},{key:"getGridSize",value:function(){return[this.grid.width,this.grid.height]}},{key:"getUncleared",value:function(){return zc(this.grid)}},{key:"getCleared",value:function(){return Gc(this.grid)}},{key:"getBombTiles",value:function(){var p;return zc(_instanceof(p=this.grid,lS)?p.asArray():p).filter(function(p){var v;return(null===(v=p.special)||void 0===v?void 0:v.type)===lW.bomb})}},{key:"getPairs",value:function(p,v){for(var g=arguments.length>0&&void 0!==p?p:1,E=!(arguments.length>1&&void 0!==v)||v,k=[],C=E?zc(this.grid):Gc(this.grid),_$a=function(){var p=Ue(Kc(C),2),v=p[0],g=p[1];k.push([v,g]),C=C.filter(function(p){return p!==v&&p!==g})};k.length<g;)_$a();return k}},{key:"setIgnoreInput",value:function(p){var v=!(arguments.length>0&&void 0!==p)||p;this.grid.forEach(function(p){return p.setIgnoreInput(v)})}},{key:"processShuffleRequest",value:function(p){var v=this.processShuffleStep(this.grid,!0,p);this.grid=v[0],this.hintPath=v[1],this.consumeAnimationQueue()}},{key:"getCurrentFen",value:function(){return bh(this.grid)}},{key:"generateFenFromCurrentLevel",value:function(p){return a.generateFen(null!=p?p:this.levelData)}},{key:"listenLayoutevents",value:function(){ec.on(iY,this.handleViewResized),ec.on(iH,this.onLayoutChanged)}},{key:"unlistenLayoutevents",value:function(){ec.off(iY,this.handleViewResized),ec.off(iH,this.onLayoutChanged)}},{key:"shakeGrid",value:(g=Ee(function(){var p,v,g;return _ts_generator(this,function(E){switch(E.label){case 0:p=this.tilesHolder.position.clone(),v=G(this.tilesHolder).to(.05,{position:p.clone().add3f(ek(5,10),ek(5,10),0)}).to(.05,{position:p.clone().subtract3f(ek(5,10),ek(5,10),0)}),g=G(this.tilesHolder).repeat(2,v).to(.05,{position:p});return[4,tJ.runTweenAsync(g)];case 1:E.sent();return[2]}})}),function(){return g.apply(this,arguments)})},{key:"processGameplayCycle",value:function(){var p=zc(this.grid);if(0!==p.length){var v=this.grid,g=p.length>=2&&this.spawnAttempts<this.levelData.rules.addRandomTilesPerMove&&this.normalMatches>=5,E=this.normalMatchesSinceLastSpawn>=2;g&&(E?(this.spawnAttempts++,this.normalMatchesSinceLastSpawn=0,this.processSpawnStep()):this.normalMatchesSinceLastSpawn++),p.length>14&&(v=this.processGravitationStep(v));var k=this.processShuffleStep(v);this.consumeAnimationQueue(),this.grid=k[0],this.hintPath=k[1]}}},{key:"processSpawnStep",value:function(){var p=Ue(Jc(Gc(this.grid),2),2),v=p[0],g=p[1];v.restore(),g.restore(v.id)}},{key:"processGravitationStep",value:function(p){var v,g=this,E=p,k=[],C=We(this.parsedGravityRules);try{var r=function(){var p=v.value,C=Sh(E=g.toGravitated(E,p));if(0===C.length)return 1;C.forEach(function(p){var v=Ue(p,2),g=v[0],E=v[1],k=E[0],C=E[1];g.setCoord(k,C)}),E.forEach(function(p){p.node.setSiblingIndex(0)});var _=function(){var p=Ee(function(){return _ts_generator(this,function(p){switch(p.label){case 0:return[4,Promise.all(C.map(function(p){var v=Ue(p,2),k=v[0],C=Ue(v[1],2),_=C[0],A=C[1];return k.sync({delay:.25,duration:.25,getTargetPosition:function(){return Mc(E,g.tileSize,{x:_,y:A})}})}))];case 1:p.sent();return[2]}})});return function(){return p.apply(this,arguments)}}();k.push(_)};for(C.s();!(v=C.n()).done;)r()}catch(p){C.e(p)}finally{C.f()}var _=function(){var p=Ee(function(){var p,v,g;return _ts_generator(this,function(E){switch(E.label){case 0:p=0,v=k;E.label=1;case 1:if(!(p<v.length))return[3,4];g=v[p];return[4,g()];case 2:E.sent();E.label=3;case 3:p++;return[3,1];case 4:return[2]}})});return function(){return p.apply(this,arguments)}}();return this.animationQueue.push(_),E}},{key:"toGravitated",value:function(p,v){var g=new lS(p),E=p.height-1,k=p.width-1,C=[0,E],_=[0,k],A=Math.floor(p.height/2),T=Math.floor(p.width/2),u=function(p){return p.isHidden()};switch(v){case ly:g.gravitate({rowRange:C,colRange:_,direction:lf.Down,isLighter:u});break;case lv:g.gravitate({rowRange:C,colRange:_,direction:lf.Up,isLighter:u});break;case lg:g.gravitate({rowRange:C,colRange:_,direction:lf.Left,isLighter:u});break;case lm:g.gravitate({rowRange:C,colRange:_,direction:lf.Right,isLighter:u});break;case lb:g.gravitate({rowRange:C,colRange:[T,k],direction:lf.Left,isLighter:u,out:g.gravitate({rowRange:C,colRange:[0,T-1],direction:lf.Right,isLighter:u})});break;case lw:g.gravitate({rowRange:[A,E],colRange:_,direction:lf.Down,isLighter:u,out:g.gravitate({rowRange:[0,A-1],colRange:_,direction:lf.Up,isLighter:u})})}return g}},{key:"getPrimitiveDirection",value:function(p,v,g){var E=Math.floor(this.grid.height/2),k=Math.floor(this.grid.width/2);switch(g){case ly:return lf.Down;case lv:return lf.Up;case lg:return lf.Left;case lm:return lf.Right;case lb:return p>=k?lf.Left:lf.Right;case lw:return v>=E?lf.Down:lf.Up}}},{key:"processShuffleStep",value:function(p,v,g){var E,k=arguments.length>1&&void 0!==v&&v,C=arguments.length>2?g:void 0,_=Mh(p),A=zc(p).map(function(p){var v=p.getCoord();return[v.x,v.y]});if(null!==_&&!k)return[p,_];var T=100;do{var I=p.toShuffled(A),R=Ue(I,1);_=Mh(E=R[0]),T--}while(null===_&&T>0);if(T<=0)return null==ug||ug.sendException(new Error("No paths found after 100 shuffle attempts"),{message:"No paths found after 100 shuffle attempts",levelData:this.levelData,gridAsArray:E.asArray()}),this.node.scene.emit(aR.GAME_EXIT),[p,_];var P=Sh(E);if(0===P.length)return[E,_];P.forEach(function(p){var v=Ue(p,2),g=v[0],E=Ue(v[1],2),k=E[0],C=E[1];g.setCoord(k,C)});var N=void 0!==C?function(){return C(p,E)}:this.createShuffleAnimationHandler(p,E);return this.animationQueue.push(N),[E,_]}},{key:"createShuffleAnimationHandler",value:function(p,v){var g=this,E=function(){var E=Ee(function(){return _ts_generator(this,function(E){switch(E.label){case 0:return[4,Promise.all(p.map(function(p,E,k){return p.sync({duration:.4,easing:"smooth",getTargetPosition:function(){return Mc(v,g.tileSize,{x:E,y:k},10)}})}))];case 1:E.sent();return[2]}})});return function(){return E.apply(this,arguments)}}(),k=function(){var p=Ee(function(){return _ts_generator(this,function(p){switch(p.label){case 0:v.forEach(function(p){p.node.setSiblingIndex(0)});return[4,Promise.all(v.map(function(p){return p.sync({duration:.6,easing:"smooth",delay:ek(0,.4),getTargetPosition:function(p){return Mc(v,g.tileSize,p)}})}))];case 1:p.sent();return[2]}})});return function(){return p.apply(this,arguments)}}();return function(){var p=Ee(function(){return _ts_generator(this,function(p){switch(p.label){case 0:return[4,E()];case 1:p.sent();return[4,k()];case 2:p.sent();return[2]}})});return function(){return p.apply(this,arguments)}}()}},{key:"consumeAnimationQueue",value:(v=Ee(function(){var p;return _ts_generator(this,function(v){switch(v.label){case 0:if(!!this.isConsumingAnimation)return[3,5];this.isConsumingAnimation=!0;v.label=1;case 1:if(!(this.animationQueue.length>0))return[3,4];if(0===this.getUncleared().length){this.animationQueue=[];return[3,4]}p=this.animationQueue.shift();return[4,p()];case 2:v.sent();v.label=3;case 3:return[3,1];case 4:this.isConsumingAnimation=!1;v.label=5;case 5:return[2]}})}),function(){return v.apply(this,arguments)})}],[{key:"generateFen",value:function(p){for(var v=p,g=[],E=0;E<v.colors;E++)g.push(E+1);var k=Date.now(),C=eh({levelData:v,seed:k,identities:g,createTile:function(p){var v=p,g=void 0,E=new eg(0,0);return{get id(){return v},get special(){return g},get coord(){return E},setIdentity:function(p){v=p},isHidden:function(){return!1},setSpecialType:function(p){g={type:p}},setCoord:function(p,v){return E.set(p,v)},getCoord:function(){return E},isSimilarTo:function(p){return p.id===v},inSamePositionAs:function(p){return p.getCoord().equals(E)}}}});return C.forEach(function(p,v,g){p.setCoord(v,g)}),oh(C,k),Zc(C,v,k),bh(C)}}]),a}(L)).prototype,"tilePrefab",[un],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ul=Ye(uo.prototype,"tilesHolder",[ui],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),uu=Ye(uo.prototype,"tileTrim",[ua],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new eg(.025,.1)}}),ur=uo))||ur)||ur);g._RF.pop(),g._RF.push({},"c92ec8pmUJGbrL9PLjum+i5","Line",void 0);var uw=(0,E.ccclass)("Line")(up=function(p){Ie(n,p);var v=xe(n);function n(){return Ce(this,n),v.apply(this,arguments)}return Ae(n,[{key:"onLoad",value:function(){this.uiTransform=this.getComponent(A)}},{key:"setPoints",value:function(p,v){this.node.setWorldPosition((p.x+v.x)/2,(p.y+v.y)/2,0),this.uiTransform.width=eg.distance(p,v)+10,this.uiTransform.width/=this.node.worldScale.x;var g=180*Math.atan2(v.y-p.y,v.x-p.x)/Math.PI;this.node.eulerAngles=new ef(0,0,g)}}]),n}(L))||up;g._RF.pop(),g._RF.push({},"1e7cch8i/5DkYHOwJowrjeg","AFPool",void 0);var uS,uE,uk,uC,u_,uA,uT,uI,uR,uP,uN,uD=function(p){Ie(n,p);var v=xe(n);function n(p,g,E,k,C){var _;return Ce(this,n),(_=v.call(this,p,g,C)).ator=E,_.ftor=k,_}return Ae(n,[{key:"alloc",value:function(){var p=Fe(Pe(n.prototype),"alloc",this).call(this);return this.ator&&this.ator(p),p}},{key:"free",value:function(p){this.ftor&&this.ftor(p),Fe(Pe(n.prototype),"free",this).call(this,p)}}]),n}(eC);g._RF.pop(),g._RF.push({},"6f7a1msxIxIbYLx5PpbL/BZ","PathDrawer",void 0);var uL,uO,uM,ux,uF,uB,uU,uz,uG,uY=E.ccclass,uj=E.property,uH=(uS=uY("PathDrawer"),uE=uj({group:"Line",displayName:"Prefab",type:K}),uk=uj({group:"Line",displayName:"Holder",type:k,tooltip:"Line Prefab"}),uC=uj({group:"Point",displayName:"Prefab",type:K}),u_=uj({group:"Point",displayName:"Holder",type:k}),uS((uI=Ye((uT=function(p){Ie(n,p);var v=xe(n);function n(){var p;Ce(this,n);for(var g=arguments.length,E=new Array(g),k=0;k<g;k++)E[k]=arguments[k];return je(p=v.call.apply(v,[this].concat(E)),"linePrefab",uI,Ne(p)),je(p,"lineHolder",uR,Ne(p)),p.lineNodes=[],je(p,"pointPrefab",uP,Ne(p)),je(p,"pointHolder",uN,Ne(p)),p.pointNodes=[],p}return Ae(n,[{key:"start",value:function(){var p=this;this.linePool=new uD(function(){var v=T(p.linePrefab);return p.lineHolder.addChild(v),v.parent=p.lineHolder,v.active=!1,v},0,function(v){p.lineNodes.push(v),v.active=!0},function(p){p.active=!1},function(p){p.isValid&&p.destroy()}),this.pointPool=new uD(function(){var v=T(p.pointPrefab);return p.pointHolder.addChild(v),v.active=!1,v},0,function(v){p.pointNodes.push(v),v.active=!0},function(p){p.active=!1},function(p){p.isValid&&p.destroy()})}},{key:"drawPath",value:function(p){this.clearPath();var v,g=We(p);try{for(g.s();!(v=g.n()).done;){var E,k=v.value;null===(E=this.linePool.alloc().getComponent(uw))||void 0===E||E.setPoints(k.a,k.b)}}catch(p){g.e(p)}finally{g.f()}}},{key:"clearPath",value:function(){var p,v=We(this.lineNodes);try{for(v.s();!(p=v.n()).done;){var g=p.value;this.linePool.free(g)}}catch(p){v.e(p)}finally{v.f()}this.lineNodes=[];var E,k=We(this.pointNodes);try{for(k.s();!(E=k.n()).done;){var C=E.value;this.pointPool.free(C)}}catch(p){k.e(p)}finally{k.f()}this.pointNodes=[]}}]),n}(L)).prototype,"linePrefab",[uE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),uR=Ye(uT.prototype,"lineHolder",[uk],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),uP=Ye(uT.prototype,"pointPrefab",[uC],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),uN=Ye(uT.prototype,"pointHolder",[u_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),uA=uT))||uA);g._RF.pop(),g._RF.push({},"5cc7bAmTI1JL7nwLzZcp45u","ErrorDrawer",void 0);var uV,uq=E.ccclass,uW=E.property,uK=(uL=uq("ErrorDrawer"),uO=uW(Z),uM=uW(Z),ux=uW(Z),uL((uU=Ye((uB=function(p){Ie(n,p);var v=xe(n);function n(){var p;Ce(this,n);for(var g=arguments.length,E=new Array(g),k=0;k<g;k++)E[k]=arguments[k];return je(p=v.call.apply(v,[this].concat(E)),"one",uU,Ne(p)),je(p,"two",uz,Ne(p)),je(p,"error",uG,Ne(p)),p}return Ae(n,[{key:"start",value:function(){Fe(Pe(n.prototype),"start",this).call(this),this.pathAppearDuration=0}},{key:"drawPath",value:function(p){var v=this;if(this.clearPath(),p.forEach(function(g,E){var k;if(null===(k=v.linePool.alloc().getComponent(uw))||void 0===k||k.setPoints(g.a,g.b),0!==E){var C=v.pointPool.alloc();C.setWorldPosition(new ef(g.a.x,g.a.y,0));var _=C.getComponent(V);1===E&&p.length>3?_.spriteFrame=v.one:2===E&&p.length>3?_.spriteFrame=v.two:_.spriteFrame=v.error}}),1===p.length){var g=this.pointPool.alloc();g.setWorldPosition(new ef(p[0].a.x+p[0].b.x,p[0].a.y+p[0].b.y,0).multiplyScalar(.5)),g.getComponent(V).spriteFrame=this.error}this.pathAppearDuration=.8}},{key:"update",value:function(p){this.pathAppearDuration>0&&(this.pathAppearDuration-=p,this.pathAppearDuration<=0&&this.clearPath())}}]),n}(uH)).prototype,"one",[uO],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),uz=Ye(uB.prototype,"two",[uM],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),uG=Ye(uB.prototype,"error",[ux],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),uF=uB))||uF);g._RF.pop(),g._RF.push({},"880e8aL9NFPj68zH2xVRIFR","HintDrawer",void 0);var uX,uJ=(0,E.ccclass)("HintDrawer")(uV=function(p){Ie(n,p);var v=xe(n);function n(){return Ce(this,n),v.apply(this,arguments)}return Ae(n,[{key:"drawPath",value:function(p){this.clearPath(),this.createPath(p),this.showPath()}},{key:"createPath",value:function(p){var v=this;p.forEach(function(p){var g;null===(g=v.linePool.alloc().getComponent(uw))||void 0===g||g.setPoints(p.a,p.b),v.pointPool.alloc().setWorldPosition(p.a.x,p.a.y,0)}),this.pointPool.alloc().setWorldPosition(p[p.length-1].b.x,p[p.length-1].b.y,0)}},{key:"showPath",value:function(){var p,v=We(this.lineNodes);try{for(v.s();!(p=v.n()).done;){var g=p.value.getComponent(et);g.opacity=0,G(g).to(.2,{opacity:255},{easing:"quadOut"}).start()}}catch(p){v.e(p)}finally{v.f()}var E,k=We(this.pointNodes);try{for(k.s();!(E=k.n()).done;){var C=E.value.getComponent(et);C.opacity=0,G(C).to(.2,{opacity:255},{easing:"quadOut"}).start()}}catch(p){k.e(p)}finally{k.f()}}},{key:"clearPath",value:function(){var p,v=this,g=We(this.lineNodes);try{var i=function(){var g=p.value,E=g.getComponent(et);G(E).to(.15,{opacity:0},{onComplete:function(){E.opacity=255,v.linePool.free(g)}}).start()};for(g.s();!(p=g.n()).done;)i()}catch(p){g.e(p)}finally{g.f()}var E,k=We(this.pointNodes);try{var r=function(){var p=E.value,g=p.getComponent(et);G(g).to(.15,{opacity:0},{onComplete:function(){g.opacity=255,v.pointPool.free(p)}}).start()};for(k.s();!(E=k.n()).done;)r()}catch(p){k.e(p)}finally{k.f()}this.lineNodes=[],this.pointNodes=[]}}]),n}(uH))||uV;g._RF.pop(),g._RF.push({},"25f67BW5/5Jzox4v+yBBbyS","MatchDrawer",void 0);var uQ,uZ,u$,u0,u1,u2,u4,u3,u5,u6=(0,E.ccclass)("MatchDrawer")(uX=function(p){Ie(a,p);var v,g,E=xe(a);function a(){return Ce(this,a),E.apply(this,arguments)}return Ae(a,[{key:"drawPath",value:function(p){var v=this;p.forEach(function(p,g){var E,k=v.linePool.alloc();null===(E=k.getComponent(uw))||void 0===E||E.setPoints(p.a,p.b),v.animateLine(k);var C=v.pointPool.alloc();C.setWorldPosition(p.a.x,p.a.y,0),v.animatePoint(C,g)});var g=this.pointPool.alloc();g.setWorldPosition(p[p.length-1].b.x,p[p.length-1].b.y,0),this.animatePoint(g,p.length)}},{key:"animateLine",value:(g=Ee(function(p){var v,g;return _ts_generator(this,function(E){switch(E.label){case 0:v=p.getComponent(et);v.opacity=0;g=G(v).to(.25,{opacity:255},{easing:"quadOut"}).delay(.1).to(.2,{opacity:0});return[4,tJ.runTweenAsync(g)];case 1:E.sent(),v.opacity=255,this.linePool.free(p);return[2]}})}),function(p){return g.apply(this,arguments)})},{key:"animatePoint",value:(v=Ee(function(p,v){var g;return _ts_generator(this,function(E){switch(E.label){case 0:p.scale=ef.ZERO;g=G(p).delay(.03*v).to(.2,{scale:ef.ONE},{easing:"quadOut"}).delay(.1).to(.2,{scale:ef.ZERO},{easing:"backIn"});return[4,tJ.runTweenAsync(g)];case 1:E.sent(),this.pointPool.free(p);return[2]}})}),function(p,g){return v.apply(this,arguments)})},{key:"clearPath",value:function(){this.lineNodes=[],this.pointNodes=[]}}]),a}(uH))||uX;g._RF.pop(),g._RF.push({},"bfdf2THr9lPJ4TOVDN8VgE4","PathDraw",void 0);var u9,u8=E.ccclass,u7=E.property,ce=(uQ=u8("PathDraw"),uZ=u7({group:{name:"Path Drawer"},type:u6}),u$=u7({group:{name:"Path Drawer"},type:uJ}),u0=u7({group:{name:"Path Drawer"},type:uK}),uQ((u4=Ye((u2=function(p){Ie(n,p);var v=xe(n);function n(){var p;Ce(this,n);for(var g=arguments.length,E=new Array(g),k=0;k<g;k++)E[k]=arguments[k];return je(p=v.call.apply(v,[this].concat(E)),"matchPath",u4,Ne(p)),je(p,"hintPath",u3,Ne(p)),je(p,"errorPath",u5,Ne(p)),p.isDrawingHint=!1,p}return Ae(n,[{key:"drawMatchPath",value:function(p,v){var g,E=We(p=p.map(function(p){return we({},p)}));try{for(E.s();!(g=E.n()).done;){var k=g.value;k.a=v(k.a),k.b=v(k.b)}}catch(p){E.e(p)}finally{E.f()}this.matchPath.drawPath(p)}},{key:"clearMatchPath",value:function(){this.matchPath.clearPath()}},{key:"drawHintPath",value:function(p,v){if(!this.isDrawingHint){this.isDrawingHint=!0;var g,E=We(p=p.map(function(p){return we({},p)}));try{for(E.s();!(g=E.n()).done;){var k=g.value;k.a=v(k.a),k.b=v(k.b)}}catch(p){E.e(p)}finally{E.f()}this.hintPath.drawPath(p)}}},{key:"clearHintPath",value:function(){this.isDrawingHint&&(this.isDrawingHint=!1,this.hintPath.clearPath())}},{key:"drawErrorPath",value:function(p,v){var g,E=We(p=p.map(function(p){return we({},p)}));try{for(E.s();!(g=E.n()).done;){var k=g.value;k.a=v(k.a),k.b=v(k.b)}}catch(p){E.e(p)}finally{E.f()}this.errorPath.drawPath(p)}}]),n}(L)).prototype,"matchPath",[uZ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),u3=Ye(u2.prototype,"hintPath",[u$],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),u5=Ye(u2.prototype,"errorPath",[u0],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),u1=u2))||u1);g._RF.pop(),g._RF.push({},"3afb9sM0KZKyod8UtofqZYu","ComboManager",void 0);var ct,cn,ci,ca,cr,co,cs,cl,cu,cc,cd,cp,cf,cy,cv,cg,cm,cb=(0,E.ccclass)("ComboManager")(u9=function(p){Ie(n,p);var v=xe(n);function n(){return Ce(this,n),v.apply(this,arguments)}return Ae(n,[{key:"init",value:function(){this.currentCombo=0,this.setEmitEvent(!0),this.node.scene.on(aR.COMBO_ENDED,this.resetCombo,this),this.node.scene.on(aR.GAME_FINISH,this.resetCombo,this),this.node.scene.on(aR.GAME_REPLAY,this.resetCombo,this),this.node.scene.on(aR.NEXT_LEVEL,this.resetCombo,this),this.node.scene.on(aR.ADD_COMBO,this.addCombo,this)}},{key:"addCombo",value:function(){this.setCombo(this.currentCombo+1)}},{key:"resetCombo",value:function(){this.setCombo(0)}},{key:"getCombo",value:function(){return this.currentCombo}},{key:"setCombo",value:function(p){if(this.currentCombo=p,p>0&&p<5){var v=[nB.COMBO_1,nB.COMBO_2,nB.COMBO_3,nB.COMBO_4,nB.COMBO_5];nQ.playSound(v[p])}else p>=5&&nQ.playSound(nB.COMBO_5);p>0&&this.vibrate(p),this.emitEvent&&this.node.scene.emit(aR.COMBO_UPDATED,p)}},{key:"vibrate",value:function(p){var v;null===(v=W("Vibrate"))||void 0===v||null===(v=v.getComponent(oB))||void 0===v||v.vibrate(Math.min(20+20*p,220))}},{key:"setEmitEvent",value:function(p){this.emitEvent=p}}]),n}(L))||u9;g._RF.pop(),g._RF.push({},"da8a1SD+ahMFpc6MIdiFP5H","ShiningStar",void 0);var cw,cS,cE,ck,cC,c_=E.ccclass,cA=E.property,cT=E.disallowMultiple,cI=(ct=c_("ShiningStar"),cn=cA(V),ci=cA({serializable:!0,visible:!1}),ca=cA({type:Y,displayName:"Scale up duration",min:.001}),cr=cA({serializable:!0,visible:!1}),co=cA({type:Y,displayName:"Bounce and Fall duration",min:.001}),cs=cA({serializable:!0,visible:!1}),cl=cA({type:Y,displayName:"Start scale"}),cu=cA({serializable:!0,visible:!1}),cc=cA({type:Y,displayName:"End scale"}),ct(cd=cT((cf=Ye((cp=function(p){Ie(u,p);var v,g,E,k,C,_,A,T=xe(u);function u(){var p;Ce(this,u);for(var v=arguments.length,g=new Array(v),E=0;E<v;E++)g[E]=arguments[E];return je(p=T.call.apply(T,[this].concat(g)),"shine",cf,Ne(p)),je(p,"twScaleUpDuration",cy,Ne(p)),je(p,"twBounceAndFallDuration",cv,Ne(p)),je(p,"twStartScale",cg,Ne(p)),je(p,"twEndScale",cm,Ne(p)),p.isBeingAnimated=!1,p}return Ae(u,[{key:"scaleUpDuration",get:function(){return this.twScaleUpDuration},set:function(p){this.twScaleUpDuration=p}},{key:"bounceAndFallDuration",get:function(){return this.twBounceAndFallDuration},set:function(p){this.twBounceAndFallDuration=p}},{key:"startScale",get:function(){return this.twStartScale},set:function(p){this.twStartScale=p}},{key:"endScale",get:function(){return this.twEndScale},set:function(p){this.twEndScale=p}},{key:"isAvailable",get:function(){return!this.isBeingAnimated}},{key:"__preload",value:function(){this.shineOpacity=this.shine.node.getComponent(et),this.uiOpacity=this.node.getComponent(et),this.validateRequiredComponents()}},{key:"onLoad",value:function(){this.uiOpacity.opacity=0}},{key:"playAnimation",value:(A=Ee(function(){return _ts_generator(this,function(p){switch(p.label){case 0:if(!this.isAvailable)throw new Error("ShiningStar: This star is being animated.");this.isBeingAnimated=!0;return[4,this.animateAppear()];case 1:p.sent();return[4,this.animateDisappear()];case 2:p.sent(),this.isBeingAnimated=!1;return[2]}})}),function(){return A.apply(this,arguments)})},{key:"animateAppear",value:(_=Ee(function(){return _ts_generator(this,function(p){switch(p.label){case 0:this.shineOpacity.opacity=255;return[4,Promise.all([this.animateFadeIn(),this.animateScaleUp()])];case 1:p.sent();return[2]}})}),function(){return _.apply(this,arguments)})},{key:"animateDisappear",value:(C=Ee(function(){return _ts_generator(this,function(p){switch(p.label){case 0:return[4,Promise.all([this.animateBounceAndFall(),this.animateScaleDown()])];case 1:p.sent(),this.node.setScale(0,0),this.uiOpacity.opacity=0;return[2]}})}),function(){return C.apply(this,arguments)})},{key:"animateBounceAndFall",value:(k=Ee(function(){var p,v,g,E,k,C,_,A,T,I;return _ts_generator(this,function(R){switch(R.label){case 0:p=this.node.position.x,v=this.node.position.y,g=[60,120],E=(Math.random()*(g[1]-g[0])+g[0])*(Math.PI/180),k=p+200*Math.cos(E),C=v+200*Math.sin(E),_=v-500,A=tJ.runTweenAsync(G(this.node).to(.2*this.twBounceAndFallDuration,{position:new ef(k,C,this.node.position.z)},{easing:"sineOut"}).to(.4*this.twBounceAndFallDuration,{position:new ef(k,_,this.node.position.z)},{easing:"cubicIn"})),T=[0,360],I=tJ.runTweenAsync(G(this.node).to(this.twBounceAndFallDuration,{eulerAngles:new ef(0,0,Math.random()*(T[1]-T[0])*(k>p?-1:1))},{easing:"sineOut"}));return[4,Promise.all([A,I])];case 1:R.sent(),this.node.eulerAngles=new ef(0,0,0);return[2]}})}),function(){return k.apply(this,arguments)})},{key:"animateFadeIn",value:(E=Ee(function(){var p;return _ts_generator(this,function(v){switch(v.label){case 0:p=Math.max(this.scaleUpDuration/4,.01);return[4,tJ.runTweenAsync(G(this.uiOpacity).to(p,{opacity:255}))];case 1:v.sent();return[2]}})}),function(){return E.apply(this,arguments)})},{key:"animateScaleUp",value:(g=Ee(function(){var p;return _ts_generator(this,function(v){switch(v.label){case 0:this.node.setScale(this.startScale,this.startScale);p=new ef(this.endScale,this.endScale,1);return[4,tJ.runTweenAsync(G(this.node).to(this.scaleUpDuration,{scale:p},{easing:"cubicOut"}))];case 1:v.sent();return[2]}})}),function(){return g.apply(this,arguments)})},{key:"animateScaleDown",value:(v=Ee(function(){var p;return _ts_generator(this,function(v){switch(v.label){case 0:p=new ef(0,0,1);return[4,tJ.runTweenAsync(G(this.node).delay(.1*this.bounceAndFallDuration).to(.5*this.bounceAndFallDuration,{scale:p},{easing:"cubicIn"}))];case 1:v.sent();return[2]}})}),function(){return v.apply(this,arguments)})},{key:"validateRequiredComponents",value:function(){e7.lazyValidateProperties(this)}}]),u}(L)).prototype,"shine",[cn],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),cy=Ye(cp.prototype,"twScaleUpDuration",[ci],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return .5}}),Ye(cp.prototype,"scaleUpDuration",[ca],Object.getOwnPropertyDescriptor(cp.prototype,"scaleUpDuration"),cp.prototype),cv=Ye(cp.prototype,"twBounceAndFallDuration",[cr],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return .5}}),Ye(cp.prototype,"bounceAndFallDuration",[co],Object.getOwnPropertyDescriptor(cp.prototype,"bounceAndFallDuration"),cp.prototype),cg=Ye(cp.prototype,"twStartScale",[cs],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return .5}}),Ye(cp.prototype,"startScale",[cl],Object.getOwnPropertyDescriptor(cp.prototype,"startScale"),cp.prototype),cm=Ye(cp.prototype,"twEndScale",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),Ye(cp.prototype,"endScale",[cc],Object.getOwnPropertyDescriptor(cp.prototype,"endScale"),cp.prototype),cd=cp))||cd)||cd);g._RF.pop(),g._RF.push({},"2e9aaj8L6lN1pTv2xGEj1sE","StarParticles",void 0);var cR,cP,cN,cD,cL,cO,cM,cx,cF,cB,cU,cz,cG,cY,cj,cH,cV,cq,cW,cK,cX,cJ=E.ccclass,cQ=E.property,cZ=E.disallowMultiple,c$=GameCore.Utils.Array,c0=(cw=cJ("StarParticles"),cS=cQ({type:[cI],displayName:"Prebuilt Shining stars"}),cw(cE=cZ((cC=Ye((ck=function(p){Ie(i,p);var v,g=xe(i);function i(){var p;Ce(this,i);for(var v=arguments.length,E=new Array(v),k=0;k<v;k++)E[k]=arguments[k];return je(p=g.call.apply(g,[this].concat(E)),"shiningStars",cC,Ne(p)),p}return Ae(i,[{key:"__preload",value:function(){this.validateRequiredComponents()}},{key:"fireShiningStarAt",value:(v=Ee(function(p){var v,g,E,k,C;return _ts_generator(this,function(_){switch(_.label){case 0:v=this.getFirstAvailableShiningStar();if(void 0===v)throw new Error("No available shining stars. Please add more prebuilt shining stars or calls this function later.");g=Ue(p,2),E=g[0],k=g[1],C=new ef(E,k,this.node.worldPosition.z);v.node.worldPosition=C;return[4,v.playAnimation()];case 1:_.sent();return[2]}})}),function(p){return v.apply(this,arguments)})},{key:"getFirstAvailableShiningStar",value:function(){return c$.search(this.shiningStars,function(p){return p.isAvailable})}},{key:"validateRequiredComponents",value:function(){e7.lazyValidateProperties(this)}}]),i}(L)).prototype,"shiningStars",[cS],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),cE=ck))||cE)||cE);g._RF.pop(),g._RF.push({},"2913d3KShhIEaPfSLUhFqvA","EffectManager",void 0);var c1=E.ccclass,c2=E.property,c4=(cR=c1("EffectManager"),cP=c2({group:"Thunder Effect",type:k}),cN=c2({group:"Thunder Effect",type:k}),cD=c2({group:"Mask Effect",type:iz}),cL=c2({group:"Mask Effect",type:k}),cO=c2({group:"Tornado Effect",type:k}),cM=c2({group:"Clear Particle Effect",type:k,displayName:"Particle holder node"}),cx=c2({group:"Clear Particle Effect",type:e_,displayName:"Emitter 1"}),cF=c2({group:"Clear Particle Effect",type:e_,displayName:"Emitter 2"}),cB=c2({group:"Star Particles Effect",type:c0}),cR((cG=Ye((cz=function(p){Ie(y,p);var v,g,E,k,C,_,T,I,R,P,N,D=xe(y);function y(){var p;Ce(this,y);for(var v=arguments.length,g=new Array(v),E=0;E<v;E++)g[E]=arguments[E];return je(p=D.call.apply(D,[this].concat(g)),"cloud",cG,Ne(p)),je(p,"lightnings",cY,Ne(p)),je(p,"backgroundMask",cj,Ne(p)),je(p,"masks",cH,Ne(p)),je(p,"tornado",cV,Ne(p)),p.bombExplosion=null,p.bombExplosionPool=null,p.defuseExplosion=null,p.defuseExplosionPool=null,je(p,"clearParticleHolder",cq,Ne(p)),je(p,"clearParticle1",cW,Ne(p)),je(p,"clearParticle2",cK,Ne(p)),je(p,"starParticle",cX,Ne(p)),p.maskTargets=[],p}return Ae(y,[{key:"__preload",value:function(){this.validateRequiredComponents()}},{key:"update",value:function(){var p=this;this.maskTargets.length>0&&this.maskTargets.forEach(function(v,g){v.isHidden()||(p.masks[g].worldPosition=v.node.worldPosition.clone())})}},{key:"validateRequiredComponents",value:function(){e7.lazyValidateProperties(this)}},{key:"start",value:function(){this.node.scene.on(aR.GRID_RESIZE,this.handleBoardResize,this)}},{key:"playClearFXAt",value:function(p){this.clearParticle1.node.setWorldPosition(new ef(p[0].x,p[0].y,1)),this.clearParticle2.node.setWorldPosition(new ef(p[1].x,p[1].y,1)),this.clearParticle1.resetSystem(),this.clearParticle2.resetSystem()}},{key:"playStarFXAt",value:function(p){this.starParticle.fireShiningStarAt(p)}},{key:"playTornadoAnimation",value:(N=Ee(function(){var p;return _ts_generator(this,function(v){switch(v.label){case 0:if(!(null!==this.tornado.getChildByName("Sprite").getComponent(M).defaultClip))return[3,2];this.tornado.active=!0;p=G(this.tornado);p.set({scale:new ef(0,0,0)}),p.delay(.5),p.to(.5,{scale:new ef(1,1,1)},{easing:"quadOut"}),p.to(.5,{scale:new ef(0,0,0)},{easing:"quadIn"}),p.set({active:!1}),nP.setBlockInput(!0);return[4,tJ.runTweenAsync(p)];case 1:v.sent(),nP.setBlockInput(!1);return[3,3];case 2:console.warn("EffectManager: Tornado animation is not loaded when animation play request was made.");v.label=3;case 3:return[2]}})}),function(){return N.apply(this,arguments)})},{key:"shakeGame",value:(P=Ee(function(){var p,v;return _ts_generator(this,function(g){switch(g.label){case 0:p=this.node.position.clone(),v=G(this.node).to(.05,{position:p.clone().add3f(ek(5,10),ek(5,10),0)}).to(.05,{position:p.clone().subtract3f(ek(5,10),ek(5,10),0)}).to(.05,{position:p});return[4,tJ.runTweenAsync(v)];case 1:g.sent();return[2]}})}),function(){return P.apply(this,arguments)})},{key:"handleBoardResize",value:function(p){this.clearParticleHolder.setScale(p,p)}},{key:"playThunderAnimation",value:(R=Ee(function(p,v){var g,E,k,C,_,T,I,R,P,N,D,L;return _ts_generator(this,function(O){switch(O.label){case 0:this.cloud.active=!0;k=W("Canvas").getComponent(A),C=k.width,_=k.height,T=0,I=0;switch(Math.floor(4*Math.random())){case 0:T=Math.random()*C-C/2,I=_/2+300;break;case 1:T=Math.random()*C-C/2,I=-_/2-300;break;case 2:T=-C/2-300,I=Math.random()*_-_/2;break;case 3:T=C/2+300,I=Math.random()*_-_/2}this.cloud.position=new ef(T,I),this.resetMasks(),this.setMaskProperties(0,p[0][0].node.worldPosition,p[0][0].node.worldScale),this.setMaskProperties(1,p[0][1].node.worldPosition,p[0][1].node.worldScale),this.setMaskProperties(2,p[1][0].node.worldPosition,p[1][0].node.worldScale),this.setMaskProperties(3,p[1][1].node.worldPosition,p[1][1].node.worldScale),this.maskTargets=[p[0][0],p[0][1],p[1][0],p[1][1]];return[4,this.setBackgroundMaskActive(!0)];case 1:O.sent();R=G(this.cloud).to(.8,{position:new ef(0,300)},{easing:"quadOut"});return[4,tJ.runTweenAsync(R)];case 2:O.sent();P=p[0][0].node.worldPosition.clone(),N=p[0][1].node.worldPosition.clone();this.shakeGame(),null===(g=W("Vibrate"))||void 0===g||null===(g=g.getComponent(oB))||void 0===g||g.vibrate(500),nQ.playSound(nB.THUNDERBOLT),v.clear([p[0]],"break");return[4,Promise.all([this.playLightningAnimation(P,0),this.playLightningAnimation(N,1)])];case 3:O.sent(),this.node.scene.emit(aR.ADD_COMBO),this.node.scene.emit(aR.ADD_SCORE);D=p[1][1].node.worldPosition.clone(),L=p[1][0].node.worldPosition.clone();this.shakeGame(),null===(E=W("Vibrate"))||void 0===E||null===(E=E.getComponent(oB))||void 0===E||E.vibrate(500),nQ.playSound(nB.THUNDERBOLT),v.clear([p[1]],"break");return[4,Promise.all([this.playLightningAnimation(L,0),this.playLightningAnimation(D,1)])];case 4:O.sent(),this.node.scene.emit(aR.ADD_COMBO),this.node.scene.emit(aR.ADD_SCORE),this.cloud.active=!1;return[4,this.setBackgroundMaskActive(!1)];case 5:O.sent(),this.maskTargets=[];return[2]}})}),function(p,v){return R.apply(this,arguments)})},{key:"playLightningAnimation",value:(I=Ee(function(p,v){var g,E,k,C,_;return _ts_generator(this,function(T){g=this,E=this.lightnings[v],k=p.subtract(E.worldPosition),C=Math.atan2(k.y,k.x)*(180/Math.PI)+180,_=k.length();return[2,(E.getComponent(A).width=_,E.angle=C,new Promise(function(p){E.active=!0,g.scheduleOnce(function(){E.active=!1,p()},.2)}))]})}),function(p,v){return I.apply(this,arguments)})},{key:"setBackgroundMaskActive",value:(T=Ee(function(p){return _ts_generator(this,function(v){switch(v.label){case 0:p&&(this.backgroundMask.node.active=!0);return[4,this.backgroundMask.changeStateFade(p,.25)];case 1:v.sent(),p||(this.backgroundMask.node.active=!1);return[2]}})}),function(p){return T.apply(this,arguments)})},{key:"resetMasks",value:function(){this.masks.forEach(function(p){p.worldPosition=new ef(-9999,-9999,0)})}},{key:"setMaskProperties",value:function(p,v,g){g&&(this.masks[p].worldScale=g),this.masks[p].worldPosition=v}},{key:"createDefuseExplosionAt",value:(_=Ee(function(p){var v,g;return _ts_generator(this,function(E){switch(E.label){case 0:return[4,this.loadDefuseExplosionPrefab()];case 1:E.sent(),this.defuseExplosionPool||(this.defuseExplosionPool=new uD(this.createDefuseExplosion.bind(this),1,c3.getBombDefuseExplosion,c3.returnBombDefuseExplosion,c3.destroyBombDefuseExplosion));v=this.defuseExplosionPool.alloc();v.setWorldPosition(p);g=v.getComponent(M);return[4,tJ.runAnimationAsync(g)];case 2:if(E.sent(),!this.defuseExplosionPool)throw new Error("EffectManager: defuseExplosionPool is null");this.defuseExplosionPool.free(v);return[2]}})}),function(p){return _.apply(this,arguments)})},{key:"createBombExplosionAt",value:(C=Ee(function(p){var v,g;return _ts_generator(this,function(E){switch(E.label){case 0:return[4,this.loadBombExplosionPrefab()];case 1:E.sent(),this.bombExplosionPool||(this.bombExplosionPool=new uD(this.createBombExplosion.bind(this),1,c5.getBombExplosion,c5.returnBombExplosion,c5.destroyBombExplosion));v=this.bombExplosionPool.alloc();v.setWorldPosition(p);g=v.getComponent(M);return[4,tJ.runAnimationAsync(g)];case 2:if(E.sent(),!this.bombExplosionPool)throw new Error("EffectManager: bombExplosionPool is null");this.bombExplosionPool.free(v);return[2]}})}),function(p){return C.apply(this,arguments)})},{key:"createDefuseExplosion",value:function(){if(!this.defuseExplosion)throw new Error("EffectManager: defuseExplosion is not loaded!");return c3.createDefuseExplosion(this.defuseExplosion,this.node)}},{key:"createBombExplosion",value:function(){if(!this.bombExplosion)throw new Error("EffectManager: bombExplosion is not loaded!");return c5.createBombExplosion(this.bombExplosion,this.node)}},{key:"loadBombExplosionPrefab",value:(k=Ee(function(){var p;return _ts_generator(this,function(v){switch(v.label){case 0:if(this.bombExplosion)return[2,Promise.resolve()];return[4,nP.loadPrefabAsync(nr.BOMB_EXPLODE_PREFAB)];case 1:p=v.sent();return[2,(p&&(this.bombExplosion=p),Promise.resolve())]}})}),function(){return k.apply(this,arguments)})},{key:"loadDefuseExplosionPrefab",value:(E=Ee(function(){var p;return _ts_generator(this,function(v){switch(v.label){case 0:if(this.defuseExplosion)return[2,Promise.resolve()];return[4,nP.loadPrefabAsync(nr.BOMB_DEFUSE_PREFAB)];case 1:p=v.sent();return[2,(p&&(this.defuseExplosion=p),Promise.resolve())]}})}),function(){return E.apply(this,arguments)})},{key:"loadThunderAnimation",value:(g=Ee(function(){var p,v;return _ts_generator(this,function(g){switch(g.label){case 0:p=this.cloud.getChildByName("Top").getComponent(M);if(null!==p.defaultClip)return[2,Promise.resolve()];return[4,nP.loadAnimClipAsync(nr.CLOUD_IDLE_ANIM)];case 1:v=g.sent();return[2,(v&&(p.defaultClip=v),Promise.resolve())]}})}),function(){return g.apply(this,arguments)})},{key:"loadTornadoAnimation",value:(v=Ee(function(){var p,v;return _ts_generator(this,function(g){switch(g.label){case 0:p=this.tornado.getChildByName("Sprite").getComponent(M);if(null!==p.defaultClip)return[2,Promise.resolve()];return[4,nP.loadAnimClipAsync(nr.TORNADO_IDLE_ANIM)];case 1:v=g.sent();return[2,(v&&(p.defaultClip=v),Promise.resolve())]}})}),function(){return v.apply(this,arguments)})}]),y}(L)).prototype,"cloud",[cP],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),cY=Ye(cz.prototype,"lightnings",[cN],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),cj=Ye(cz.prototype,"backgroundMask",[cD],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),cH=Ye(cz.prototype,"masks",[cL],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),cV=Ye(cz.prototype,"tornado",[cO],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),cq=Ye(cz.prototype,"clearParticleHolder",[cM],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),cW=Ye(cz.prototype,"clearParticle1",[cx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),cK=Ye(cz.prototype,"clearParticle2",[cF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),cX=Ye(cz.prototype,"starParticle",[cB],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),cU=cz))||cU),c3=function(){function e(){Ce(this,e)}return Ae(e,null,[{key:"createDefuseExplosion",value:function(p,v){var g=T(p);return v.addChild(g),g.active=!1,g}},{key:"destroyBombDefuseExplosion",value:function(p){p.destroy()}},{key:"getBombDefuseExplosion",value:function(p){p.active=!0}},{key:"returnBombDefuseExplosion",value:function(p){p.active=!1}}]),e}(),c5=function(){function e(){Ce(this,e)}return Ae(e,null,[{key:"createBombExplosion",value:function(p,v){var g=T(p);return v.addChild(g),g.active=!1,g}},{key:"destroyBombExplosion",value:function(p){p.destroy()}},{key:"getBombExplosion",value:function(p){p.active=!0}},{key:"returnBombExplosion",value:function(p){p.active=!1}}]),e}();g._RF.pop(),g._RF.push({},"062f3AVHntKsIyireZmXg9P","GuideKeys",void 0);var c6="newbie",c9="timer",c8="combo",c7="hint-item",he="thunder-item",ht="storm-item",hn="pliers-item";g._RF.pop(),g._RF.push({},"6448denZfFEUru9tWmWGb7N","Guide01Newbie",void 0);var hi=.7261538461538461,ha=function(){function e(p){Ce(this,e),this.manager=p,this.gameplay=p.gameplay}var p,v;return Ae(e,[{key:"setup",value:function(){this.currentStep=0,this.manager.node.scene.on(aR.GRID_MATCH_SUCCESS,this.showNextStep,this),this.manager.node.scene.on(aR.GRID_MATCH_FAIL,this.showNextStep,this),ec.on(iY,this.handleViewResized,this),ec.on(iH,this.handleViewResized,this),this.showStep(this.currentStep),this.manager.node.scene.emit(aR.HIDE_UI),this.manager.guideSkipButton.active=!0}},{key:"showNextStep",value:function(){this.currentStep+1<l3.length?(this.currentStep+=1,this.showStep(this.currentStep)):this.close()}},{key:"showStep",value:(v=Ee(function(p){var v,g,E,k,C,_,A,T,I,R,P,N;return _ts_generator(this,function(D){switch(D.label){case 0:v=this.gameplay,g=v.board,E=v.effectManager,k=l3[p].startTile,C=l3[p].endTile,_=g.getTileAt(k.x,k.y),A=g.getTileAt(C.x,C.y);if(!(_&&A))return[3,3];T=_.node.worldPosition,I=A.node.worldPosition;E.resetMasks(),E.setMaskProperties(0,T,_.node.worldScale),E.setMaskProperties(1,I,A.node.worldScale),E.setBackgroundMaskActive(!0);R=this.manager,P=R.guideHand,N=R.guideTextBox;P.node.active=!0,P.playHandAnimation(T,I),this.alignGuideTextBox(),this.alignSkipButton();return[4,N.hide()];case 1:D.sent(),N.setText(l3[p].description);return[4,N.show()];case 2:D.sent(),g.setIgnoreInput(!0),_.setIgnoreInput(!1),A.setIgnoreInput(!1),this.gameplay.comboManager.setEmitEvent(!1);D.label=3;case 3:return[2]}})}),function(p){return v.apply(this,arguments)})},{key:"handleViewResized",value:function(){var p=this.gameplay,v=p.board,g=p.effectManager,E=l3[this.currentStep].startTile,k=l3[this.currentStep].endTile,C=v.getTileAt(E.x,E.y),_=v.getTileAt(k.x,k.y);if(C&&_){var A=C.node.worldPosition,T=_.node.worldPosition;g.setMaskProperties(0,A,C.node.worldScale),g.setMaskProperties(1,T,_.node.worldScale),this.alignGuideTextBox(),this.alignSkipButton()}}},{key:"alignGuideTextBox",value:function(){var p=this.gameplay.board,v=this.manager.guideTextBox,g=p.getTileAt(0,0);if(g){var E=g.node.worldPosition,k=p.tilesHolder.getWorldScale(),C=p.getTileSize()[1]*k.y,_=k.clone().multiplyScalar(hi);v.node.setWorldScale(_),v.node.setWorldPosition(new ef(v.node.worldPosition.x,(E.y-C/2)/2))}}},{key:"alignSkipButton",value:function(){var p=this.gameplay.board,v=this.manager.guideSkipButton;if(v){var g=p.getTileAt(0,p.getGridSize()[1]-1);if(g){var E=g.node.worldPosition,k=p.tilesHolder.getWorldScale(),C=p.getTileSize()[1]*k.y,_=k.clone().multiplyScalar(hi),T=v.getComponent(A).contentSize.height*_.y;v.setWorldScale(_),v.setWorldPosition(new ef(v.worldPosition.x,E.y+(C+T)/2+30))}}}},{key:"close",value:(p=Ee(function(){var p,v,g,E,k;return _ts_generator(this,function(C){switch(C.label){case 0:p=this.gameplay,v=p.board,g=p.effectManager;this.manager.node.scene.off(aR.GRID_MATCH_SUCCESS,this.showNextStep,this),this.manager.node.scene.off(aR.GRID_MATCH_FAIL,this.showNextStep,this),ec.off(iY,this.handleViewResized,this),ec.off(iH,this.handleViewResized,this),v.setIgnoreInput(!1);E=Promise.all;return[4,this.manager.guideTextBox.hide()];case 1:k=[C.sent()];return[4,g.setBackgroundMaskActive(!1)];case 2:return[4,E.apply(Promise,[k.concat([C.sent()])])];case 3:C.sent(),this.manager.guideHand.node.active=!1,this.manager.completeGuide(c6);return[2]}})}),function(){return p.apply(this,arguments)})}]),e}();g._RF.pop(),g._RF.push({},"a52daB3sGxP8JyGBZo5K1+X","Guide02Timer",void 0);var hr=function(){function e(p){Ce(this,e),this.manager=p,this.gameplay=p.gameplay}var p,v;return Ae(e,[{key:"setup",value:(v=Ee(function(){var p,v,g,E,k,C,_,T;return _ts_generator(this,function(I){switch(I.label){case 0:p=this.manager,v=p.guideMasks,g=p.guideInfoText,E=this.gameplay.uiManager.clock,k=E.getComponent(A).contentSize,C=k.width,_=k.height,T=E.node.worldPosition;C*=1.5,_*=1.5;return[4,this.gameplay.handleShowUI()];case 1:I.sent(),v.node.active=!0,v.setOtherMaskTransform(T.x,T.y,C,_),g.node.active=!0,g.string="Remove all tiles before\nthe time end",g.node.setWorldPosition(T.x,T.y-_/2-50,0),g.horizontalAlign=eA.CENTER,g.getComponent(A).setAnchorPoint(.5,.5);return[4,v.show()];case 2:I.sent(),this.manager.node.scene.once(aR.GUIDE_MASK_CLICKED,this.close,this),this.manager.node.scene.emit(aR.PAUSE_TIME),ec.on(iY,this.handleViewResized,this),ec.on(iH,this.handleViewResized,this);return[2]}})}),function(){return v.apply(this,arguments)})},{key:"handleViewResized",value:function(){var p=this.manager,v=p.guideMasks,g=p.guideInfoText,E=this.gameplay.uiManager.clock,k=E.getComponent(A).contentSize,C=k.width,_=k.height,T=E.node.worldPosition;C*=1.5,_*=1.5,v.setOtherMaskTransform(T.x,T.y,C,_),g.node.setWorldPosition(T.x,T.y-_/2-50,0)}},{key:"close",value:(p=Ee(function(){var p,v,g;return _ts_generator(this,function(E){switch(E.label){case 0:p=this.manager,v=p.guideInfoText,g=p.guideMasks;this.gameplay.comboManager.setEmitEvent(!0),this.gameplay.stateManager.isPlaying()&&this.manager.node.scene.emit(aR.RESUME_TIME);return[4,g.hide()];case 1:E.sent(),v.node.active=!1,this.manager.completeGuide(c9),ec.off(iY,this.handleViewResized,this),ec.off(iH,this.handleViewResized,this);return[2]}})}),function(){return p.apply(this,arguments)})}]),e}();g._RF.pop(),g._RF.push({},"add56o6JFNHAZiCO6F+Z9jK","Guide03Combo",void 0);var ho=function(){function e(p){Ce(this,e),this.manager=p,this.gameplay=p.gameplay}var p,v;return Ae(e,[{key:"setup",value:(v=Ee(function(){var p,v,g,E,k,C,_,T;return _ts_generator(this,function(I){switch(I.label){case 0:p=this.manager,v=p.guideMasks,g=p.guideInfoText,E=this.gameplay.uiManager.comboContainer,k=E.getComponent(A).contentSize,C=k.width,_=k.height,T=E.worldPosition;C*=1.5,_*=1.5,v.node.active=!0,v.setOtherMaskTransform(T.x,T.y,C,_),g.node.active=!0,g.string="Remove tiles continuously\nto increase combo!",g.node.setWorldPosition(T.x-C/2-10,T.y,0),g.horizontalAlign=eA.RIGHT,g.getComponent(A).setAnchorPoint(1,.5);return[4,v.show()];case 1:I.sent(),this.manager.node.scene.once(aR.GUIDE_MASK_CLICKED,this.close,this),this.manager.node.scene.emit(aR.PAUSE_TIME),ec.on(iY,this.handleViewResized,this),ec.on(iH,this.handleViewResized,this);return[2]}})}),function(){return v.apply(this,arguments)})},{key:"handleViewResized",value:function(){var p=this.manager,v=p.guideMasks,g=p.guideInfoText,E=this.gameplay.uiManager.comboContainer,k=E.getComponent(A).contentSize,C=k.width,_=k.height,T=E.worldPosition;C*=1.5,_*=1.5,v.setOtherMaskTransform(T.x,T.y,C,_),g.node.setWorldPosition(T.x-C/2-10,T.y,0)}},{key:"close",value:(p=Ee(function(){var p,v,g;return _ts_generator(this,function(E){switch(E.label){case 0:p=this.manager,v=p.guideInfoText,g=p.guideMasks;this.manager.node.scene.emit(aR.RESUME_TIME),g.node.off(k.EventType.TOUCH_START,this.close,this);return[4,g.hide()];case 1:E.sent(),v.node.active=!1,this.manager.completeGuide(c8),ec.off(iY,this.handleViewResized,this),ec.off(iH,this.handleViewResized,this);return[2]}})}),function(){return p.apply(this,arguments)})}]),e}();g._RF.pop(),g._RF.push({},"fd93d+WLXVHk4yJGmVeSjmR","Guide04Hint",void 0);var hs=GameCore.Utils.Array,hl=function(){function e(p){Ce(this,e),this.manager=p,this.gameplay=p.gameplay}var p,v;return Ae(e,[{key:"setup",value:(v=Ee(function(){var p,v,g,E,k,C,_,T;return _ts_generator(this,function(I){switch(I.label){case 0:p=this.manager,v=p.guideMasks,g=p.guideInfoText,E=hs.search(this.gameplay.itemManager.items,function(p){return p.itemType===oG.HINT});if(!E)return[3,2];k=E.node.worldPosition,C=E.getComponent(A).contentSize,_=C.width,T=C.height;_+=40,T+=40,v.node.active=!0,v.setItemMaskTransform(k.x,k.y,_,T),g.node.active=!0,g.string="Tap to reveal a connectable pair",g.node.setPosition(0,0),g.node.setWorldPosition(g.node.worldPosition.x,k.y+T/2+30,0),g.horizontalAlign=eA.CENTER,g.getComponent(A).setAnchorPoint(.5,.5);return[4,v.show()];case 1:I.sent(),this.manager.node.scene.once(aR.GUIDE_MASK_CLICKED,this.close,this),this.manager.node.scene.emit(aR.PAUSE_TIME),ec.on(iY,this.handleViewResized,this),ec.on(iH,this.handleViewResized,this);I.label=2;case 2:return[2]}})}),function(){return v.apply(this,arguments)})},{key:"handleViewResized",value:function(){var p=this.manager,v=p.guideMasks,g=p.guideInfoText,E=hs.search(this.gameplay.itemManager.items,function(p){return p.itemType===oG.HINT});if(E){var k=E.node.worldPosition,C=E.getComponent(A).contentSize,_=C.width,T=C.height;_+=40,T+=40,v.setItemMaskTransform(k.x,k.y,_,T),g.node.setWorldPosition(g.node.worldPosition.x,k.y+T/2+30,0)}}},{key:"close",value:(p=Ee(function(){var p,v,g;return _ts_generator(this,function(E){switch(E.label){case 0:p=this.manager,v=p.guideMasks,g=p.guideInfoText;this.manager.node.scene.emit(aR.RESUME_TIME);return[4,v.hide()];case 1:E.sent(),g.node.active=!1,this.manager.completeGuide(c7),ec.off(iY,this.handleViewResized,this),ec.off(iH,this.handleViewResized,this);return[2]}})}),function(){return p.apply(this,arguments)})}]),e}();g._RF.pop(),g._RF.push({},"b08f4dC/r1EPbsfAe1wtcBg","Guide05Thunder",void 0);var hu=GameCore.Utils.Array,hc=function(){function e(p){Ce(this,e),this.manager=p,this.gameplay=p.gameplay}var p,v;return Ae(e,[{key:"setup",value:(v=Ee(function(){var p,v,g,E,k,C,_,T;return _ts_generator(this,function(I){switch(I.label){case 0:p=this.manager,v=p.guideMasks,g=p.guideInfoText,E=hu.search(this.gameplay.itemManager.items,function(p){return p.itemType===oG.THUNDER});if(!E)return[3,2];k=E.node.worldPosition,C=E.getComponent(A).contentSize,_=C.width,T=C.height;_+=40,T+=40,v.node.active=!0,v.setItemMaskTransform(k.x,k.y,_,T),g.node.active=!0,g.string="Tap to remove 2 pairs",g.node.setPosition(0,0),g.node.setWorldPosition(g.node.worldPosition.x,k.y+T/2+30,0),g.horizontalAlign=eA.CENTER,g.getComponent(A).setAnchorPoint(.5,.5);return[4,v.show()];case 1:I.sent(),this.manager.node.scene.once(aR.GUIDE_MASK_CLICKED,this.close,this),this.manager.node.scene.emit(aR.PAUSE_TIME),ec.on(iY,this.handleViewResized,this),ec.on(iH,this.handleViewResized,this);I.label=2;case 2:return[2]}})}),function(){return v.apply(this,arguments)})},{key:"handleViewResized",value:function(){var p=this.manager,v=p.guideMasks,g=p.guideInfoText,E=hu.search(this.gameplay.itemManager.items,function(p){return p.itemType===oG.THUNDER});if(E){var k=E.node.worldPosition,C=E.getComponent(A).contentSize,_=C.width,T=C.height;_+=40,T+=40,v.setItemMaskTransform(k.x,k.y,_,T),g.node.setWorldPosition(g.node.worldPosition.x,k.y+T/2+30,0)}}},{key:"close",value:(p=Ee(function(){var p,v,g;return _ts_generator(this,function(E){switch(E.label){case 0:p=this.manager,v=p.guideMasks,g=p.guideInfoText;this.manager.node.scene.emit(aR.RESUME_TIME);return[4,v.hide()];case 1:E.sent(),g.node.active=!1,this.manager.completeGuide(he),ec.off(iY,this.handleViewResized,this),ec.off(iH,this.handleViewResized,this);return[2]}})}),function(){return p.apply(this,arguments)})}]),e}();g._RF.pop(),g._RF.push({},"f4ef8MBZxxKC4bfuDzsLQ5X","Guide06Storm",void 0);var hd=GameCore.Utils.Array,hp=function(){function e(p){Ce(this,e),this.manager=p,this.gameplay=p.gameplay}var p,v;return Ae(e,[{key:"setup",value:(v=Ee(function(){var p,v,g,E,k,C,_,T;return _ts_generator(this,function(I){switch(I.label){case 0:p=this.manager,v=p.guideMasks,g=p.guideInfoText,E=hd.search(this.gameplay.itemManager.items,function(p){return p.itemType===oG.STORM});if(!E)return[3,2];k=E.node.worldPosition,C=E.getComponent(A).contentSize,_=C.width,T=C.height;_+=40,T+=40,v.node.active=!0,v.setItemMaskTransform(k.x,k.y,_,T),g.node.active=!0,g.string="Tap to rearrange the tiles",g.node.setPosition(0,0),g.node.setWorldPosition(g.node.worldPosition.x,k.y+T/2+30,0),g.horizontalAlign=eA.CENTER,g.getComponent(A).setAnchorPoint(.5,.5);return[4,v.show()];case 1:I.sent(),this.manager.node.scene.once(aR.GUIDE_MASK_CLICKED,this.close,this),this.manager.node.scene.emit(aR.PAUSE_TIME),ec.on(iY,this.handleViewResized,this),ec.on(iH,this.handleViewResized,this);I.label=2;case 2:return[2]}})}),function(){return v.apply(this,arguments)})},{key:"handleViewResized",value:function(){var p=this.manager,v=p.guideMasks,g=p.guideInfoText,E=hd.search(this.gameplay.itemManager.items,function(p){return p.itemType===oG.STORM});if(E){var k=E.node.worldPosition,C=E.getComponent(A).contentSize,_=C.width,T=C.height;_+=40,T+=40,v.setItemMaskTransform(k.x,k.y,_,T),g.node.setWorldPosition(g.node.worldPosition.x,k.y+T/2+30,0)}}},{key:"close",value:(p=Ee(function(){var p,v,g;return _ts_generator(this,function(E){switch(E.label){case 0:p=this.manager,v=p.guideMasks,g=p.guideInfoText;this.manager.node.scene.emit(aR.RESUME_TIME);return[4,v.hide()];case 1:E.sent(),g.node.active=!1,this.manager.completeGuide(ht),ec.off(iY,this.handleViewResized,this),ec.off(iH,this.handleViewResized,this);return[2]}})}),function(){return p.apply(this,arguments)})}]),e}();g._RF.pop(),g._RF.push({},"9920dDqYP9ITJp0bSlZ+K9R","Guide07Pliers",void 0);var hf,hy,hv,hg,hm,hb,hw,hS,hE,hk=GameCore.Utils.Array,hC=function(){function e(p){Ce(this,e),this.manager=p,this.gameplay=p.gameplay}var p,v;return Ae(e,[{key:"setup",value:(v=Ee(function(){var p,v,g,E,k,C,_,T;return _ts_generator(this,function(I){switch(I.label){case 0:p=this.manager,v=p.guideMasks,g=p.guideInfoText,E=hk.search(this.gameplay.itemManager.items,function(p){return p.itemType===oG.PLIERS});if(!E)return[3,2];k=E.node.worldPosition,C=E.getComponent(A).contentSize,_=C.width,T=C.height;_+=40,T+=40,v.node.active=!0,v.setItemMaskTransform(k.x,k.y,_,T),g.node.active=!0,g.string="Tap to remove bomb",g.node.setPosition(0,0),g.node.setWorldPosition(g.node.worldPosition.x,k.y+T/2+30,0),g.horizontalAlign=eA.CENTER,g.getComponent(A).setAnchorPoint(.5,.5);return[4,v.show()];case 1:I.sent(),this.manager.node.scene.once(aR.GUIDE_MASK_CLICKED,this.close,this),this.manager.node.scene.emit(aR.PAUSE_TIME),ec.on(iY,this.handleViewResized,this),ec.on(iH,this.handleViewResized,this);I.label=2;case 2:return[2]}})}),function(){return v.apply(this,arguments)})},{key:"handleViewResized",value:function(){var p=this.manager,v=p.guideMasks,g=p.guideInfoText,E=hk.search(this.gameplay.itemManager.items,function(p){return p.itemType===oG.PLIERS});if(E){var k=E.node.worldPosition,C=E.getComponent(A).contentSize,_=C.width,T=C.height;_+=40,T+=40,v.setItemMaskTransform(k.x,k.y,_,T),g.node.setWorldPosition(g.node.worldPosition.x,k.y+T/2+30,0)}}},{key:"close",value:(p=Ee(function(){var p,v,g;return _ts_generator(this,function(E){switch(E.label){case 0:p=this.manager,v=p.guideMasks,g=p.guideInfoText;this.manager.node.scene.emit(aR.RESUME_TIME);return[4,v.hide()];case 1:E.sent(),g.node.active=!1,this.manager.completeGuide(hn),ec.off(iY,this.handleViewResized,this),ec.off(iH,this.handleViewResized,this);return[2]}})}),function(){return p.apply(this,arguments)})}]),e}();g._RF.pop(),g._RF.push({},"8ab11Ocp6VMg5ZkRHXv4Odu","GuideHand",void 0);var h_,hA,hT,hI,hR,hP,hN,hD=E.ccclass,hL=E.property,hO=(hf=hD("GuideHand"),hy=hL(k),hv=hL(k),hg=hL(et),hf((hw=Ye((hb=function(p){Ie(n,p);var v=xe(n);function n(){var p;Ce(this,n);for(var g=arguments.length,E=new Array(g),k=0;k<g;k++)E[k]=arguments[k];return je(p=v.call.apply(v,[this].concat(E)),"hand",hw,Ne(p)),je(p,"circleHighlight",hS,Ne(p)),je(p,"circleHighlightOpacity",hE,Ne(p)),p}return Ae(n,[{key:"start",value:function(){this.circleHighlight.setScale(0,0),this.circleHighlightOpacity.opacity=255}},{key:"playHandAnimation",value:function(p,v){var g=this;this.handTween&&this.handTween.stop();var E=G(this.hand).to(.8,{worldPosition:v},{easing:"quartOut"}).to(.2,{scale:new ef(.9,.9,.9),angle:15}).call(function(){g.playHighlightAnimation()}).to(.2,{scale:ef.ONE,angle:0}).to(.8,{worldPosition:p},{easing:"quartOut"}).to(.2,{scale:new ef(.9,.9,.9),angle:15}).call(function(){g.playHighlightAnimation()}).to(.2,{scale:ef.ONE,angle:0});this.handTween=G(this.hand).repeatForever(E).start()}},{key:"playHighlightAnimation",value:function(){this.circleHighlight.setScale(0,0),this.circleHighlightOpacity.opacity=255,this.circleHighlight.position=this.hand.position.clone(),G(this.circleHighlight).to(.6,{scale:new ef(1.5,1.5)},{easing:"quadOut"}).start(),G(this.circleHighlightOpacity).to(.6,{opacity:0},{easing:"quadIn"}).start()}}]),n}(L)).prototype,"hand",[hy],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),hS=Ye(hb.prototype,"circleHighlight",[hv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),hE=Ye(hb.prototype,"circleHighlightOpacity",[hg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),hm=hb))||hm);g._RF.pop(),g._RF.push({},"b2213ccDllApaGIouur6a6b","GameMask",void 0);var hM,hx,hF,hB,hU,hz,hG=E.ccclass,hY=E.property,hj=(h_=hG("GameMask"),hA=hY(A),hT=hY(V),h_((hP=Ye((hR=function(p){Ie(n,p);var v=xe(n);function n(){var p;Ce(this,n);for(var g=arguments.length,E=new Array(g),k=0;k<g;k++)E[k]=arguments[k];return je(p=v.call.apply(v,[this].concat(E)),"uiTransform",hP,Ne(p)),je(p,"sprite",hN,Ne(p)),p}return Ae(n,[{key:"texture",get:function(){return this.sprite.spriteFrame.texture}}]),n}(L)).prototype,"uiTransform",[hA],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),hN=Ye(hR.prototype,"sprite",[hT],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),hI=hR))||hI);g._RF.pop(),g._RF.push({},"ad9c7KiarJHXpRRfn9GOaVx","AlphaMasks",void 0);var hH,hV,hq,hW,hK,hX,hJ,hQ=E.ccclass,hZ=E.property,h$=E.executeInEditMode,h0=(hM=hQ("AlphaMasks"),hx=h$(!0),hF=hZ(hj),hM(hB=hx((hz=Ye((hU=function(p){Ie(n,p);var v=xe(n);function n(){var p;Ce(this,n);for(var g=arguments.length,E=new Array(g),k=0;k<g;k++)E[k]=arguments[k];return je(p=v.call.apply(v,[this].concat(E)),"masks",hz,Ne(p)),p}return Ae(n,[{key:"onLoad",value:function(){this.UITransform=this.node.getComponent(A)}},{key:"start",value:function(){this.material=this.getComponent(V).getMaterialInstance(0)}},{key:"update",value:function(){var p=this,v=this.UITransform,g=v.width,E=v.height;this.masks.forEach(function(v,k){var C=v.uiTransform,_=C.width,A=C.height,T=C.anchorX,I=C.anchorY,R=_*v.node.scale.x,P=A*v.node.scale.y,N=new eg(R/g,P/E),D=new eg(.5+(.5-T)*N.x,.5-(.5-I)*N.y),L=new eg(D.x+(v.node.worldPosition.x-p.node.worldPosition.x)/g,D.y-(v.node.worldPosition.y-p.node.worldPosition.y)/E);p.material.setProperty("mask".concat(k,"Texture"),v.texture),p.material.setProperty("ratio".concat(k),N),p.material.setProperty("center".concat(k),L)})}},{key:"setMaskActive",value:function(p,v){p>=this.masks.length||this.material.setProperty("useMask".concat(p),v?1:0)}}]),n}(L)).prototype,"masks",[hF],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),hB=hU))||hB)||hB);g._RF.pop(),g._RF.push({},"69569cXv55L852IkWTL0swz","GuideMasks",void 0);var h1,h2,h4,h3,h5,h6=E.ccclass,h9=E.property,h8=(hH=h6("GuideMasks"),hV=h9(iz),hq=h9(h0),hH((hX=Ye((hK=function(p){Ie(a,p);var v,g,E=xe(a);function a(){var p;Ce(this,a);for(var v=arguments.length,g=new Array(v),k=0;k<v;k++)g[k]=arguments[k];return je(p=E.call.apply(E,[this].concat(g)),"background",hX,Ne(p)),je(p,"alphaMasks",hJ,Ne(p)),p}return Ae(a,[{key:"__preload",value:function(){this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){e7.lazyValidateProperties(this)}},{key:"show",value:(g=Ee(function(){return _ts_generator(this,function(p){switch(p.label){case 0:this.background.node.active=!0;return[4,this.background.changeStateFade(!0,.25)];case 1:p.sent();return[2]}})}),function(){return g.apply(this,arguments)})},{key:"hide",value:(v=Ee(function(){return _ts_generator(this,function(p){switch(p.label){case 0:return[4,this.background.changeStateFade(!1,.25)];case 1:p.sent(),this.background.node.active=!1;return[2]}})}),function(){return v.apply(this,arguments)})},{key:"onClick",value:function(){this.node.scene.emit(aR.GUIDE_MASK_CLICKED)}},{key:"setOtherMaskTransform",value:function(p,v,g,E){this.alphaMasks.masks[1].node.worldPosition=new ef(-9999,-9999,0);var k=this.alphaMasks.masks[0];this.setMaskTransform(k,p,v,g,E)}},{key:"setItemMaskTransform",value:function(p,v,g,E){this.alphaMasks.masks[0].node.worldPosition=new ef(-9999,-9999,0);var k=this.alphaMasks.masks[1];this.setMaskTransform(k,p,v,g,E)}},{key:"setMaskTransform",value:function(p,v,g,E,k){p.uiTransform.setContentSize(E,k),p.node.setWorldPosition(v,g,0)}}]),a}(L)).prototype,"background",[hV],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),hJ=Ye(hK.prototype,"alphaMasks",[hq],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),hW=hK))||hW);g._RF.pop(),g._RF.push({},"abfb9zudJhHdZfeUgbnBrs0","GuideTextBox",void 0);var h7,de,dt,dn,di,da,dr,ds,dl,du,dc,dh,dd,dp=E.ccclass,df=E.property,dy=(h1=dp("GuideTextBox"),h2=df(I),h1((h5=Ye((h3=function(p){Ie(a,p);var v,g,E=xe(a);function a(){var p;Ce(this,a);for(var v=arguments.length,g=new Array(v),k=0;k<v;k++)g[k]=arguments[k];return je(p=E.call.apply(E,[this].concat(g)),"guideText",h5,Ne(p)),p}return Ae(a,[{key:"__preload",value:function(){this.opacityToggler=this.getComponent(iz),e7.lazyValidateProperties(this)}},{key:"setText",value:function(p){this.guideText.string=p}},{key:"show",value:(g=Ee(function(){return _ts_generator(this,function(p){switch(p.label){case 0:return[4,this.opacityToggler.changeStateFade(!0)];case 1:p.sent();return[2]}})}),function(){return g.apply(this,arguments)})},{key:"hide",value:(v=Ee(function(){return _ts_generator(this,function(p){switch(p.label){case 0:return[4,this.opacityToggler.changeStateFade(!1)];case 1:p.sent();return[2]}})}),function(){return v.apply(this,arguments)})}]),a}(L)).prototype,"guideText",[h2],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),h4=h3))||h4);g._RF.pop(),g._RF.push({},"4d800jyvxFJIYnkeNGud6KJ","GuidelinesManager",void 0);var dv,dg,dm,db,dw,dS,dE,dk,dC,d_,dA,dT,dI,dR,dP,dN,dD,dL,dO,dM=game,dx=dM.player,dF=dM.analytics,dB=E.ccclass,dU=E.property,dz=GameCore,dG=dz.Plugins.Analytics.Events,dY=dz.Utils.Array,dj=new eg(0,10),dH=new eg(0,10),dV="READY",dq="RUNNING",dW=(h7=dB("GuidelinesManager"),de=dU(hO),dt=dU(dy),dn=dU(I),di=dU(h8),da=dU(k),h7((dl=Ye((ds=function(p){Ie(i,p);var v,g=xe(i);function i(){var p;Ce(this,i);for(var v=arguments.length,E=new Array(v),k=0;k<v;k++)E[k]=arguments[k];return je(p=g.call.apply(g,[this].concat(E)),"guideHand",dl,Ne(p)),je(p,"guideTextBox",du,Ne(p)),je(p,"guideInfoText",dc,Ne(p)),je(p,"guideMasks",dh,Ne(p)),je(p,"guideSkipButton",dd,Ne(p)),p.guideHintDelay=null,p.guideStormDelay=null,p}return Ae(i,[{key:"init",value:function(p){this.gameplay=p,this.status=dV,this.node.scene.on(aR.COMBO_UPDATED,this.startComboGuide,this),this.node.scene.on(aR.TILE_CLICK,this.startAutoGuides,this),this.node.scene.on(aR.USE_ITEM,this.handleUseItem,this),this.node.scene.on(aR.GAME_FINISH,this.stopAutoGuides,this),this.node.scene.on(aR.GAME_REPLAY,this.stopAutoGuides,this),this.node.scene.on(aR.GAME_PAUSE,this.stopAutoGuides,this)}},{key:"show",value:function(){this.isNewbieGuideLevel()?(this.hasGuideItemShowed(c6)&&this.resetGuideItemShowed(),this.startGuide(c6)):this.startGuide(c9)}},{key:"startGuide",value:function(p){if(this.status===dq)return!1;if(this.hasGuideItemShowed(p))return!1;switch(this.addGuideItemShowed(p),this.status=dq,p){case c6:dF.event(dG.TUTORIAL_BEGIN),this.guide1=new ha(this),this.guide1.setup();break;case c9:this.guide2=new hr(this),this.guide2.setup();break;case c8:this.guide3=new ho(this),this.guide3.setup();break;case c7:this.guide4=new hl(this),this.guide4.setup();break;case he:this.guide5=new hc(this),this.guide5.setup();break;case ht:this.guide6=new hp(this),this.guide6.setup();break;case hn:this.guide7=new hC(this),this.guide7.setup()}return!0}},{key:"completeGuide",value:function(p){dF.event(dG.TUTORIAL_STEP,{step:p}),this.status=dV,this.addGuideItemShowed(p),this.gameplay.stateManager.isPlaying()&&this.startAutoGuides()}},{key:"isHintGuideLevel",value:function(){return this.getCurrentLevel()>=dj.x&&this.getCurrentLevel()<=dj.y}},{key:"isShowErrorPathLevel",value:function(){return this.getCurrentLevel()>=dH.x&&this.getCurrentLevel()<=dH.y}},{key:"isNewbieGuideLevel",value:function(){return 0===this.getCurrentLevel()}},{key:"hasGuideItemShowed",value:function(p){return dY.has(this.getGuideItemShowed(),p)}},{key:"addGuideItemShowed",value:function(p){if(!this.hasGuideItemShowed(p)){var v=this.getGuideItemShowed();v.push(p),dx.setGameData({guideItemShowed:v})}}},{key:"resetGuideItemShowed",value:function(){dx.setGameData({guideItemShowed:[]})}},{key:"getGuideItemShowed",value:function(){var p,v;return null!==(p=null===(v=dx.getGameData())||void 0===v?void 0:v.guideItemShowed)&&void 0!==p?p:[]}},{key:"getCurrentLevel",value:function(){return this.gameplay.levelManager.getLevelData().level}},{key:"startComboGuide",value:function(p){this.isNewbieGuideLevel()||p<2||(this.startGuide(c8),this.node.scene.off(aR.COMBO_UPDATED,this.startComboGuide,this))}},{key:"startAutoGuides",value:function(){this.startHintGuide(),this.startStormGuide()}},{key:"stopAutoGuides",value:function(){null!==this.guideHintDelay&&this.guideHintDelay.stop(),null!==this.guideStormDelay&&this.guideStormDelay.stop()}},{key:"startHintGuide",value:function(){var p=this;this.isHintGuideLevel()&&(null===this.guideHintDelay&&(this.guideHintDelay=new eT(this.node).delay(5).call(function(){p.isNewbieGuideLevel()||(p.hasGuideItemShowed(c7)&&p.status===dV?p.node.scene.emit(aR.SHOW_HINT):p.startGuide(c7),p.startHintGuide())})),this.guideHintDelay.stop(),this.guideHintDelay.start())}},{key:"startStormGuide",value:function(){var p=this;null===this.guideStormDelay&&(this.guideStormDelay=new eT(this.node).delay(10).call(function(){if(!p.isNewbieGuideLevel()&&!p.hasGuideItemShowed(ht)){var v=dY.search(p.gameplay.itemManager.items,function(p){return p.itemType===oG.STORM});v&&v.canActivate()&&(p.startGuide(ht)||p.startStormGuide())}})),this.guideStormDelay.stop(),this.guideStormDelay.start()}},{key:"startThunderGuide",value:function(){return!this.isNewbieGuideLevel()&&this.startGuide(he)}},{key:"startPliersGuide",value:function(){return!this.isNewbieGuideLevel()&&this.startGuide(hn)}},{key:"handleUseItem",value:function(p){switch(this.startAutoGuides(),p){case oG.HINT:this.addGuideItemShowed(c7);break;case oG.THUNDER:this.addGuideItemShowed(he);break;case oG.STORM:this.addGuideItemShowed(ht);break;case oG.PLIERS:this.addGuideItemShowed(hn)}}},{key:"skipNewbieGuide",value:(v=Ee(function(){var p;return _ts_generator(this,function(v){switch(v.label){case 0:this.guideSkipButton.active=!1;return[4,this.guide1.close()];case 1:v.sent();p=this.getCurrentLevel()+1;dx.setGameData({level:p}),this.node.scene.emit(aR.NEXT_LEVEL);return[2]}})}),function(){return v.apply(this,arguments)})}]),i}(L)).prototype,"guideHand",[de],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),du=Ye(ds.prototype,"guideTextBox",[dt],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),dc=Ye(ds.prototype,"guideInfoText",[dn],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),dh=Ye(ds.prototype,"guideMasks",[di],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),dd=Ye(ds.prototype,"guideSkipButton",[da],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),dr=ds))||dr);g._RF.pop(),g._RF.push({},"c3d9fl9+INO3ac7Q2zvmRKy","SpecialItem",void 0);var dK,dX=E.ccclass,dJ=E.property,dQ=(dv=dX("SpecialItem"),dg=dJ({editorOnly:!0,tooltip:"A debug button has infinite quantity"}),dm=dJ({type:N,tooltip:"The button that activates the item"}),db=dJ({type:F,group:"Quantity",tooltip:"The starting quantity of the item",displayName:"Quantity"}),dw=dJ({type:I,group:"Quantity",tooltip:"The label that shows the quantity",displayName:"Label"}),dS=dJ({type:k,group:"Quantity",tooltip:"The node that shows the quantity of the item",displayName:"Quantity node"}),dE=dJ({type:k,group:"Quantity",tooltip:"The node that shows the plus icon when there is no item",displayName:"Plus node"}),dk=dJ({type:et,group:"Animation"}),dC=dJ({type:et,tooltip:"The opacity component of the button",displayName:"Button UI Opacity"}),dv((dT=Ye((dA=function(p){Ie(o,p);var v,g,E,k=xe(o);function o(){var p;Ce(this,o);for(var v=arguments.length,g=new Array(v),E=0;E<v;E++)g[E]=arguments[E];return je(p=k.call.apply(k,[this].concat(g)),"isDevButton",dT,Ne(p)),je(p,"button",dI,Ne(p)),je(p,"quantity",dR,Ne(p)),je(p,"quantityLabel",dP,Ne(p)),je(p,"quantityNode",dN,Ne(p)),je(p,"plusNode",dD,Ne(p)),je(p,"glowUIOpacity",dL,Ne(p)),je(p,"uiOpacity",dO,Ne(p)),p.requestItem=null,p.loadQuantity=null,p}return Ae(o,[{key:"itemType",get:function(){}},{key:"onLoad",value:function(){this.validateRequiredComponents()}},{key:"init",value:function(p){var v=this;this.node.scene.on(aR.GRID_CREATE,this.applyActivationStatus,this),this.node.scene.on(aR.GRID_MATCH,this.applyActivationStatus,this),this.node.scene.on(aR.GRID_CLEAR,this.applyActivationStatus,this),this.node.scene.on(aR.IDLE_EXIT,function(){v.button.interactable=!1,v.applyActivationStatus()}),this.node.scene.on(aR.IDLE_ENTER,function(){v.button.interactable=!0,v.applyActivationStatus()})}},{key:"start",value:function(){var p=this.loadQuantity();this.setQuantity(p)}},{key:"validateRequiredComponents",value:function(){e7.lazyValidateProperties(this)}},{key:"applyActivationStatus",value:(E=Ee(function(){var p;return _ts_generator(this,function(v){switch(v.label){case 0:p=this.canActivate();this.button.interactable=p;return[4,tJ.runTweenAsync(G(this.uiOpacity).to(.2,{opacity:p?255:128}))];case 1:v.sent();return[2]}})}),function(){return E.apply(this,arguments)})},{key:"activate",value:(g=Ee(function(){return _ts_generator(this,function(p){this.quantity<=0?this.requestItem():(this.vibrate(),this.setQuantity(this.quantity-1));return[2]})}),function(){return g.apply(this,arguments)})},{key:"canActivate",value:function(){return!1}},{key:"setQuantity",value:function(p,v){var g=arguments.length>1&&void 0!==v&&v;if(this.isDevButton)return this.quantityLabel.string="i",this.quantityNode.active=!0,this.plusNode.active=!1,void this.applyActivationStatus();p<0&&(p=0),this.quantity=p,this.quantityLabel.string="".concat(this.quantity),p<=0?(this.quantityNode.active=!1,this.plusNode.active=!0):(this.quantityNode.active=!0,this.plusNode.active=!1),g&&this.animateAddItem(),this.applyActivationStatus(),this.saveQuantity()}},{key:"getQuantity",value:function(){return this.quantity}},{key:"saveQuantity",value:function(p,v){var g=arguments.length>0&&void 0!==p?p:this.getQuantity(),E=arguments.length>1?v:void 0;this.isDevButton||E&&this.setQuantity(g,E.animate)}},{key:"vibrate",value:function(){var p;null===(p=W("Vibrate"))||void 0===p||null===(p=p.getComponent(oB))||void 0===p||p.vibrate(50)}},{key:"animateAddItem",value:(v=Ee(function(){return _ts_generator(this,function(p){return[2,(this.glowUIOpacity.opacity=0,Promise.all([tJ.runTweenAsync(G(this.node).to(.1,{scale:new ef(1.15,1.15,1.15)},{easing:"cubicOut"}).delay(.2).to(.7,{scale:ef.ONE},{easing:"elasticOut"})),tJ.runTweenAsync(G(this.glowUIOpacity).to(.1,{opacity:100}).delay(.2).to(.6,{opacity:0}))]))]})}),function(){return v.apply(this,arguments)})}]),o}(L)).prototype,"isDevButton",[dg],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),dI=Ye(dA.prototype,"button",[dm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),dR=Ye(dA.prototype,"quantity",[db],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),dP=Ye(dA.prototype,"quantityLabel",[dw],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),dN=Ye(dA.prototype,"quantityNode",[dS],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),dD=Ye(dA.prototype,"plusNode",[dE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),dL=Ye(dA.prototype,"glowUIOpacity",[dk],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),dO=Ye(dA.prototype,"uiOpacity",[dC],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),d_=dA))||d_);g._RF.pop(),g._RF.push({},"e1fd9AcoshNdK0i6vow/F2P","ItemManager",void 0);var dZ,d$=(0,E.ccclass)("ItemManager")(dK=function(p){Ie(n,p);var v=xe(n);function n(){var p;Ce(this,n);for(var g=arguments.length,E=new Array(g),k=0;k<g;k++)E[k]=arguments[k];return(p=v.call.apply(v,[this].concat(E))).sceneItems=new Set,p}return Ae(n,[{key:"items",get:function(){return He(this.sceneItems)}},{key:"onLoad",value:function(){this.syncItems()}},{key:"syncItems",value:function(){var p=this,v=W("Canvas/UI");v&&v.getComponentsInChildren(dQ).forEach(function(v){v.node.activeInHierarchy&&p.sceneItems.add(v)})}}]),n}(L))||dK;g._RF.pop(),g._RF.push({},"bbe87JDGgVEkJdgCL2ydwxX","LevelManager",void 0);var d0,d1=E.ccclass,d2=GameCore.Utils,d4=d2.Device,d3=(d2.String,{level:1,mode:"normal",time:900,colors:12,specials:{bomb:0,rocket:0},rules:{maxSpaceOfPair:1,addRandomTilesPerMove:0},columns:5,rows:6,theme:["flower"]}),d5=d1("LevelManager")(dZ=function(p){Ie(a,p);var v,g,E=xe(a);function a(){return Ce(this,a),E.apply(this,arguments)}return Ae(a,[{key:"loadLevel",value:(g=Ee(function(){var p,v,g,E,k,C,_,A;var T=arguments;return _ts_generator(this,function(I){switch(I.label){case 0:p=T.length>0&&void 0!==T[0]?T[0]:1,v=T.length>1&&void 0!==T[1]?T[1]:sh;return[4,this.loadLevelData(p)];case 1:g=I.sent();this.levelData=g||this.levelData||d3;E=this.levelData,k=E.rows,C=E.columns;d4.isMobile()&&C>=6&&k>=10&&(this.levelData.columns=5,this.levelData.rows=10);_="".concat(nr.TILE_SKIN_FOLDER,"/").concat(v);return[4,nP.loadSpriteFramesDirAsync(_)];case 2:A=I.sent();return[2,A]}})}),function(){return g.apply(this,arguments)})},{key:"loadLevelData",value:(v=Ee(function(){var p,v,g,E,k;var C=arguments;return _ts_generator(this,function(_){switch(_.label){case 0:p=C.length>0&&void 0!==C[0]?C[0]:1,v=10,g=this.paddingZero("".concat(Math.floor(p/v)+1),3),E=p%v;return[4,nP.loadJsonAsync("".concat(nr.LEVEL_DATA_FOLDER,"/").concat(g))];case 1:k=_.sent();return[2,k?k[E]:null]}})}),function(){return v.apply(this,arguments)})},{key:"getLevelData",value:function(){return this.levelData}},{key:"paddingZero",value:function(p,v){for(var g="",E=0;E<v-p.length;E++)g+="0";return g+p}}]),a}(L))||dZ;g._RF.pop(),g._RF.push({},"3f8fenpEyBKaaNxBYL5960v","ScoreManager",void 0);var d6=E.ccclass,d9=GameCore.Match.Modes,d8=d6("ScoreManager")(d0=function(p){Ie(i,p);var v,g=xe(i);function i(){var p;Ce(this,i);for(var v=arguments.length,E=new Array(v),k=0;k<v;k++)E[k]=arguments[k];return(p=g.call.apply(g,[this].concat(E))).currentScore=0,p.tournamentStartScore=0,p}return Ae(i,[{key:"addScore",value:function(p,v,g){var E=this.getLevelMultiplier(v),k=this.getComboMultiplier(g),C=Math.floor(this.currentScore+p*E*k),_=10*Math.ceil(C/10);this.setScore(_)}},{key:"init",value:function(){this.initCurrentScore(),this.updateScore()}},{key:"initCurrentScore",value:function(){var p=sx.getMatchMode();this.currentScore=p===d9.TOURNAMENT?this.tournamentStartScore:0}},{key:"setScore",value:function(p){this.currentScore=p,this.updateScore()}},{key:"updateTournamentStartScore",value:function(){this.tournamentStartScore=this.currentScore}},{key:"updateScore",value:(v=Ee(function(){return _ts_generator(this,function(p){this.node.scene.emit(aR.SCORE_UPDATED,this.currentScore);return[2]})}),function(){return v.apply(this,arguments)})},{key:"getCurrentScore",value:function(){return this.currentScore}},{key:"getLevelMultiplier",value:function(p){return 1+.1*(p-1)}},{key:"getComboMultiplier",value:function(p){return 1+.1*(p-1)}}]),i}(L))||d0;g._RF.pop(),g._RF.push({},"4a4bfX6KIJCcIozlNHuAwoi","AdsUtils",void 0);var d7=GameCore,pe=d7.Configs,pt=d7.Plugins.Ads,pn=pt.Types,pi=pt.Status,pa=d7.Utils.Array,pr=globalThis.game.ads,po=function(){function e(){Ce(this,e)}var p,v,g;return Ae(e,[{key:"canbeShowInSDK",value:function(p,v){var g=arguments.length>0&&void 0!==p?p:[],E=arguments.length>1&&void 0!==v?v:[],k=GameSDK.getSDKName();return(null==E||!E.length||!pa.has(E,k))&&!(null!=g&&g.length&&!pa.has(g,k))}}],[{key:"inst",get:function(){return this._instance||(this._instance=new e),this._instance}},{key:"preloadAds",value:(g=Ee(function(){var p,v,g,E,k,C;return _ts_generator(this,function(_){p=pe.Ads,v=p.Enabled,g=p.InterstitialAdOptions,E=p.RewardedVideoAdOptions;if(v){k=pn.INTERSTITIAL,C=pn.REWARDED_VIDEO;g.forEach(function(p){var v=p.PlacementId;pr.loadAdAsync(k,v).catch(function(){})}),E.forEach(function(p){var v=p.PlacementId;pr.loadAdAsync(C,v).catch(function(){})})}return[2]})}),function(){return g.apply(this,arguments)})},{key:"showBannerAds",value:function(){var p=pe.Ads,v=p.Enabled,g=p.BannerDisplayAdOptions;if(v){var E=eI.instance.getVisibleSize(),k=i_.worldSizeToCssSize(E.height*oU);g.forEach(function(p){var v=p.PlacementId,g=p.Position,E=p.BannerHeight;"bottom"===g&&E>k||pr.showBannerAdAsync(v).catch(function(p){})})}}},{key:"hideBannerAds",value:function(){var p=pe.Ads,v=p.Enabled,g=p.BannerDisplayAdOptions;v&&g.forEach(function(p){var v=p.PlacementId;pr.hideBannerAdAsync(v).catch(function(p){})})}},{key:"showInterstitialAdAsync",value:(v=Ee(function(p){var v,g,E,k,C,_,A,T;return _ts_generator(this,function(I){switch(I.label){case 0:v=p.forLevel,g=void 0===v?1:v,E=p.includeSDK,k=p.excludeSDK;if(!this.inst.canbeShowInSDK(E,k))return[2,!1];if(pe.Gameplay.StartAdAtLevel>=g)return[2,!1];if(!pr.canbeShowInterstitialAd())return[2,!1];C=Date.now();I.label=1;case 1:I.trys.push([1,5,6,7]);nQ.muteAudio(!0),s8.showLoadingNotificationScreen();_=pr.getAdStatus(pn.INTERSTITIAL)!==pi.FILLED;if(!_)return[3,3];return[4,pr.loadAdAsync(pn.INTERSTITIAL)];case 2:_=I.sent();I.label=3;case 3:return[4,pr.showAdAsync(pn.INTERSTITIAL)];case 4:return[2,(I.sent(),!0)];case 5:A=I.sent();return[2,(console.warn("showInterstitialAdAsync failed",A),!1)];case 6:nQ.muteAudio(!1);T=(Date.now()-C)/1e3;setTimeout(function(){s8.closeNotificationScreen()},T>.5?0:.5),pr.loadAdAsync(pn.INTERSTITIAL).catch(function(){});return[7];case 7:return[2]}})}),function(p){return v.apply(this,arguments)})},{key:"showRewardVideoAdAsync",value:(p=Ee(function(p){var v,g,E,k;return _ts_generator(this,function(C){switch(C.label){case 0:v=p.includeSDK,g=p.excludeSDK;if(!this.inst.canbeShowInSDK(v,g))return[2,!1];C.label=1;case 1:C.trys.push([1,5,6,7]);nQ.muteAudio(!0),s8.showLoadingNotificationScreen();E=pr.getAdStatus(pn.REWARDED_VIDEO)!==pi.FILLED;if(!E)return[3,3];return[4,pr.loadAdAsync(pn.REWARDED_VIDEO)];case 2:E=C.sent();C.label=3;case 3:return[4,pr.showAdAsync(pn.REWARDED_VIDEO)];case 4:return[2,(C.sent(),s8.closeNotificationScreen(),!0)];case 5:k=C.sent();return[2,(console.warn("showRewardVideoAdAsync failed",k),_instanceof(k,Object)&&"code"in k&&"USER_INPUT"===k.code?s8.showNotificationScreen("Sorry, no rewards!\n You have cancelled the ad.",2):s8.showNotificationScreen("No ads to display.",2),!1)];case 6:nQ.muteAudio(!1),pr.loadAdAsync(pn.REWARDED_VIDEO).catch(function(){});return[7];case 7:return[2]}})}),function(v){return p.apply(this,arguments)})}]),e}();try{new po}catch(p){console.error("AdsUtils",p)}g._RF.pop(),g._RF.push({},"e6116mseMNPD6VcLUtkvez6","BaseState",void 0);var ps=function(){function e(p){Ce(this,e),this.game=null,this.data={},this.game=p.getGameplay(),this.manager=p,this.updateStateData(),this.logDebug()}return Ae(e,[{key:"logDebug",value:function(){var p=this.constructor.name;console.info("[STATE] ".concat(p),this.data)}},{key:"updateStateData",value:function(){if(this.game){var p=this.game.getGameData();p&&(this.data=p)}}},{key:"updateGameData",value:function(p){var v;null===(v=this.game)||void 0===v||v.setGameData(p)}}]),e}();g._RF.pop(),g._RF.push({},"e4ee7Ho9zJPVKobpdsCwGlp","FailState",void 0);var pl=globalThis.game,pu=pl.analytics,pc=pl.monitorError,ph=pl.match,pd=pl.player,pp=pl.storage,pf=GameCore,py=pf.Match.Modes,pv=pf.Dtos.Match.Data,pg=function(p){Ie(s,p);var v,g,E,k,C,_=xe(s);function s(p,v){var g;return Ce(this,s),g=_.call(this,p),nQ.stopAllSounds(),g.vibrateDevice(),g.pauseCountdown(),g.updateMatchCustomData(),g.handleGameOver(v),g.logLevelFailAnalytics(),g}return Ae(s,[{key:"pauseCountdown",value:function(){var p;null===(p=this.game)||void 0===p||p.uiManager.pauseTime()}},{key:"vibrateDevice",value:function(){var p;null===(p=W("Vibrate"))||void 0===p||null===(p=p.getComponent(oB))||void 0===p||p.vibrate(500)}},{key:"handleGameOver",value:(C=Ee(function(p){var v;return _ts_generator(this,function(g){switch(g.label){case 0:v=sx.getMatchMode();if(nP.setBlockInput(!0),v!==py.SINGLE)return[3,2];return[4,this.handleTournamentCreateFlow()];case 1:return[2,(g.sent(),void this.showFailScreen(p))];case 2:if(v!==py.TOURNAMENT)return[3,4];return[4,this.handleTournamentGameOver()];case 3:g.sent();return[3,6];case 4:if(v!==py.CHALLENGE_FRIEND)return[2,void this.showFailScreen(p)];return[4,this.handleChallengeGameOver()];case 5:g.sent();g.label=6;case 6:nP.setBlockInput(!1);return[2]}})}),function(p){return C.apply(this,arguments)})},{key:"handleTournamentCreateFlow",value:(k=Ee(function(){var p;return _ts_generator(this,function(v){switch(v.label){case 0:v.trys.push([0,2,,3]);return[4,sx.processCreateTournamentAsync()];case 1:v.sent();return[3,3];case 2:p=v.sent();if(_instanceof(p,sl))return[2];return[2,(_instanceof(p,ss)&&(null==pc||pc.sendException(p)),void console.error(p))];case 3:return[2]}})}),function(){return k.apply(this,arguments)})},{key:"handleTournamentGameOver",value:(E=Ee(function(){var p,v,g,E,k,C,_,A,T,I;return _ts_generator(this,function(R){switch(R.label){case 0:g=this,E=null===(p=sx.getMatchCustomData())||void 0===p?void 0:p.tournamentId;if(!E)return[3,5];if(ll.validateTournamentExpired(E))return[2,(pp.setStorageData("tournament","animateTournamentLeader",!1),s8.showNotificationScreen("Tournament has ended",2),void(null===(k=this.game)||void 0===k||k.scheduleOnce(function(){var p;null===(p=g.game)||void 0===p||p.node.scene.emit(aR.GAME_EXIT)},2)))];R.label=1;case 1:R.trys.push([1,3,,4]);return[4,sx.finishMatchAsync()];case 2:R.sent();A=ph.getMatchState().profiles,T=null!==(C=pp.getStorageData("tournament","previousScore"))&&void 0!==C?C:0;(null!==(_=A[pd.getPlayerId()].score)&&void 0!==_?_:0)>T&&pp.setStorageData("tournament","animateTournamentLeader",!0);return[3,4];case 3:I=R.sent();console.warn(I);return[3,4];case 4:null===(v=this.game)||void 0===v||v.node.scene.emit(aR.GAME_EXIT);R.label=5;case 5:return[2]}})}),function(){return E.apply(this,arguments)})},{key:"handleChallengeGameOver",value:(g=Ee(function(){var p,v,g,E;return _ts_generator(this,function(k){switch(k.label){case 0:k.trys.push([0,3,,4]);p=ph.getMatchState().id;return[4,ph.api.getMatchAPI().getMatchDetailByIdAsync(p)];case 1:v=k.sent(),g=new pv(v).toObject().extraData;return[4,sx.finishMatchAsync({extraData:null!=g?g:void 0})];case 2:k.sent();return[3,4];case 3:E=k.sent();console.warn(E);return[3,4];case 4:this.game.node.scene.emit(aR.SHOW_CHALLENGE_RESULTS);return[2]}})}),function(){return g.apply(this,arguments)})},{key:"showFailScreen",value:(v=Ee(function(p){var v,g;return _ts_generator(this,function(E){switch(E.label){case 0:v=this.data.level;g=this.game;if(!g)return[3,2];return[4,po.showInterstitialAdAsync({forLevel:v})];case 1:g=E.sent();E.label=2;case 2:nQ.turnOffMusic(),p===lc&&nQ.playSound(nB.LEVEL_FAIL_TIMEOUT),nQ.playSound(nB.LEVEL_FAIL),s8.openScreen(nH.RESCUES_SCREEN,{level:v,failKey:p});return[2]}})}),function(p){return v.apply(this,arguments)})},{key:"updateMatchCustomData",value:function(){var p,v,g=this.data.level,E=void 0===g?1:g,k=null!==(p=null===(v=this.game)||void 0===v?void 0:v.scoreManager.getCurrentScore())&&void 0!==p?p:0;sx.updateMatchStateAfterLevelFinish(E,k)}},{key:"logLevelFailAnalytics",value:function(){if(this.game){var p=this.data.level,v=void 0===p?0:p,g=this.game.scoreManager.getCurrentScore();pu.levelFail(v,g)}}},{key:"initialize",value:function(){var p=this.manager.createInitializeState(this.manager);this.manager.change(p)}},{key:"ready",value:function(){}},{key:"playing",value:function(){var p=this.manager.createPlayingState(this.manager);this.manager.change(p)}},{key:"fail",value:function(){}},{key:"finish",value:function(){var p=this.manager.createFinishState(this.manager);this.manager.change(p)}},{key:"update",value:function(){}}]),s}(ps);g._RF.pop(),g._RF.push({},"a9bc11SkV9L/5L+Y+fhswfJ","FinishState",void 0);var pm=globalThis.game,pb=pm.analytics,pw=pm.player,pS=pm.leaderboard,pE=pm.match,pk=pm.monitorError,pC=GameCore.Match.Modes,p_=function(p){Ie(s,p);var v,g,E,k,C,_=xe(s);function s(p){var v;return Ce(this,s),(v=_.call(this,p)).handleFinishStateFlow(),v}return Ae(s,[{key:"handleFinishStateFlow",value:(C=Ee(function(){var p,v;return _ts_generator(this,function(g){switch(g.label){case 0:this.processCrazyGamesEvent(),this.attemptCallCreateShortcut(),nQ.turnUpMusic(),null===(p=this.game)||void 0===p||p.uiManager.pauseTime();v=sx.getMatchMode();v!==pC.CHALLENGE_FRIEND&&this.updatePlayerProgress(),this.updateMatchCustomData(),this.handlePostScoreToLeaderboard();if(v!==pC.CHALLENGE_FRIEND)return[3,1];this.handleChallengeOver();return[3,3];case 1:return[4,this.handleTournamentCreateFlow()];case 2:g.sent(),this.showLevelCompleteScreen();g.label=3;case 3:this.logLevelCompleteAnalytics();return[2]}})}),function(){return C.apply(this,arguments)})},{key:"handleChallengeOver",value:(k=Ee(function(){var p,v,g;return _ts_generator(this,function(E){switch(E.label){case 0:E.trys.push([0,3,,5]);p=pE.getMatchState().id;return[4,sx.getMatchExtraDataAsync(p)];case 1:v=E.sent();return[4,sx.finishMatchAsync({extraData:null!=v?v:void 0})];case 2:E.sent();return[3,5];case 3:g=E.sent();console.warn(g);return[4,sx.finishMatchAsync()];case 4:E.sent();return[3,5];case 5:this.game.node.scene.emit(aR.SHOW_CHALLENGE_RESULTS);return[2]}})}),function(){return k.apply(this,arguments)})},{key:"processCrazyGamesEvent",value:function(){"gameplayStop"in GameSDK.extra&&GameSDK.extra.gameplayStop()}},{key:"updateMatchCustomData",value:function(){var p,v,g=this.data.level,E=void 0===g?1:g,k=null!==(p=null===(v=this.game)||void 0===v?void 0:v.scoreManager.getCurrentScore())&&void 0!==p?p:0;sx.updateMatchStateAfterLevelFinish(E,k)}},{key:"logLevelCompleteAnalytics",value:function(){if(this.game){var p=this.data.level,v=void 0===p?0:p,g=this.game.scoreManager.getCurrentScore();pb.levelComplete(v,g)}}},{key:"showLevelCompleteScreen",value:(E=Ee(function(){var p,v,g,E;return _ts_generator(this,function(k){g=this.data.level;nQ.turnOffMusic(),nQ.playSound(nB.LEVEL_COMPLETE);E=null!==(p=null===(v=pw.getGameData())||void 0===v?void 0:v.coins)&&void 0!==p?p:0;s8.openScreen(nH.LEVEL_COMPLETE_SCREEN,{level:g,currentCoin:E});return[2]})}),function(){return E.apply(this,arguments)})},{key:"updatePlayerProgress",value:function(){if(this.game){var p=this.data.level;if(p){var v=p+1,g=pw.getGameData();if(g){var E=g.totalLevel,k=g.level,C=Math.max(k,v),_=we({},g);C<E&&(_.level=C),pw.setGameData(_)}}}}},{key:"attemptCallCreateShortcut",value:function(){var p=this.data.level;(void 0===p?0:p)<2||"checkAndCreateShortcutAsync"in GameSDK.extra&&GameSDK.extra.checkAndCreateShortcutAsync().catch(function(p){console.warn("createShortcutAsync",p)})}},{key:"handleTournamentCreateFlow",value:(g=Ee(function(){var p,v,g,E;return _ts_generator(this,function(k){switch(k.label){case 0:if(sx.getMatchMode()!==pC.SINGLE)return[3,4];p=pw.getGameData();if(!p)return[3,4];v=p.lastCreateTournamentShown,g=void 0===v?0:v;if(!(Date.now()-g>3e5))return[3,4];k.label=1;case 1:k.trys.push([1,3,,4]);return[4,sx.processCreateTournamentAsync()];case 2:k.sent();return[3,4];case 3:E=k.sent();if(_instanceof(E,sl))return[2];return[2,(_instanceof(E,ss)&&(null==pk||pk.sendException(E)),void console.error(E))];case 4:return[2]}})}),function(){return g.apply(this,arguments)})},{key:"handlePostScoreToLeaderboard",value:(v=Ee(function(){var p,v,g,E,k,C,_;return _ts_generator(this,function(A){switch(A.label){case 0:if(sx.getMatchMode()!==pC.TOURNAMENT)return[3,7];v=null===(p=this.game)||void 0===p?void 0:p.scoreManager.getCurrentScore();if(!v)return[3,7];A.label=1;case 1:A.trys.push([1,3,,4]);return[4,GameSDK.tournament.postScoreAsync(v)];case 2:A.sent();return[3,4];case 3:g=A.sent();console.warn("GameSDK post score async",g);return[3,4];case 4:E=sx.getMatchCustomData();if(!E)return[3,7];k=E.leaderboardId,C=E.playerId;_=k&&C;if(!_)return[3,6];return[4,pS.setLeaderboardScoreAsync(k,C,v)];case 5:_=A.sent();A.label=6;case 6:A.label=7;case 7:return[2]}})}),function(){return v.apply(this,arguments)})},{key:"initialize",value:function(){var p=this.manager.createInitializeState(this.manager);this.manager.change(p)}},{key:"ready",value:function(){}},{key:"playing",value:function(){}},{key:"fail",value:function(){}},{key:"finish",value:function(){}},{key:"update",value:function(){}}]),s}(ps);g._RF.pop(),g._RF.push({},"37a5cRy3ANBGpVlH3wyS3Ra","InitializeState",void 0);var pA=globalThis.game,pT=pA.player,pI=pA.match,pR=GameCore.Match.Modes,pP=function(p){Ie(a,p);var v,g,E=xe(a);function a(p){var v;return Ce(this,a),(v=E.call(this,p)).handleSingleGameStart=function(){var p=Ee(function(p){var g,E,k,C;return _ts_generator(this,function(_){switch(_.label){case 0:E=v.game.levelManager.getLevelData(),k=v.data.level,C=pT.getPlayerId();return[4,Promise.all([sx.setMatchCustomDataAsync({level:k,score:0}),sx.setProfileMatchDataAsync({id:C,score:0})])];case 1:_.sent(),v.game.board.create(p,E),v.game.board.setIgnoreInput(!0);return[4,v.game.board.animateTilesAppear()];case 2:_.sent(),null!==(g=v.game.guidelinesManager)&&void 0!==g&&g.isNewbieGuideLevel()||v.game.board.setIgnoreInput(!1),v.ready();return[2]}})});return function(v){return p.apply(this,arguments)}}(),v.enableUI(),v.clearBoard(),v.loadLevel(),v.initCountdown(),v.initScore(),v}return Ae(a,[{key:"enableUI",value:function(){var p;null===(p=this.game)||void 0===p||p.uiManager.enableHeader()}},{key:"clearBoard",value:function(){this.game&&(this.game.rescueTiles=[],this.game.board.destroyTiles(),this.game.pathDraw.clearMatchPath())}},{key:"loadLevel",value:(g=Ee(function(){var p,v,g,E,k,C,_,A,T,I;return _ts_generator(this,function(R){switch(R.label){case 0:if(!this.game)return[3,9];p=sx.getMatchMode();R.label=1;case 1:R.trys.push([1,7,,9]);if(p!==pR.CHALLENGE_FRIEND)return[3,4];v=pI.getMatchState().id;return[4,sx.getMatchExtraDataAsync(v)];case 2:g=R.sent();if(null==g)throw new Error("Match mode ".concat(pR.CHALLENGE_FRIEND," but no extraData (for opponent initialization) was found in match data."));E=this.getLevelSkin(g.level);return[4,this.game.levelManager.loadLevel(g.level,E)];case 3:k=R.sent();this.updateGameData({level:g.level,levelData:this.game.levelManager.getLevelData()}),nQ.playSound(nB.LEVEL_START),this.handleChallengeFriendGameStart(k,g);return[3,6];case 4:C=this.getLevelSkin(this.data.level);return[4,this.game.levelManager.loadLevel(this.data.level,C)];case 5:_=R.sent();this.updateGameData({levelData:this.game.levelManager.getLevelData()}),nQ.playSound(nB.LEVEL_START),this.handleSingleGameStart(_);R.label=6;case 6:return[3,9];case 7:A=R.sent();console.error("Error loading level:",A);T=this.getLevelSkin(this.data.level);return[4,this.game.levelManager.loadLevel(this.data.level,T)];case 8:I=R.sent();this.updateGameData({levelData:this.game.levelManager.getLevelData()}),nQ.playSound(nB.LEVEL_START),this.handleSingleGameStart(I);return[3,9];case 9:return[2]}})}),function(){return g.apply(this,arguments)})},{key:"getLevelSkin",value:function(p){var v=sS.getLevelSkin(p),g=sS.getUnlockedSkins();if(g.length<=1)return v;if(ea.random()<=.5)return v;var E=g.indexOf(v);return g.splice(E,1),g[ea.randomRangeInt(0,g.length)]}},{key:"handleChallengeFriendGameStart",value:(v=Ee(function(p,v){var g,E,k,C,_,A,T;return _ts_generator(this,function(I){switch(I.label){case 0:g=this.game.levelManager.getLevelData(),E=v.level,k=v.fen,C=v.gravity,_=v.rules,A=v.time,T=pT.getPlayerId();return[4,Promise.all([sx.setMatchCustomDataAsync({level:E,score:0}),sx.setProfileMatchDataAsync({id:T,score:0})])];case 1:I.sent(),this.game.board.create(p,we(we({},g),{},{level:E,customFen:k,mode:C,rules:_,time:A})),this.game.board.setIgnoreInput(!0);return[4,this.game.board.animateTilesAppear()];case 2:I.sent(),this.game.board.setIgnoreInput(!1),this.ready();return[2]}})}),function(p,g){return v.apply(this,arguments)})},{key:"initScore",value:function(){this.game&&this.game.scoreManager.init()}},{key:"initCountdown",value:function(){this.game&&this.game.uiManager.initCountdown()}},{key:"initialize",value:function(){}},{key:"ready",value:function(){var p=this.manager.createReadyState(this.manager);this.manager.change(p)}},{key:"pause",value:function(){}},{key:"playing",value:function(){}},{key:"fail",value:function(){}},{key:"finish",value:function(){}},{key:"update",value:function(){}}]),a}(ps);g._RF.pop(),g._RF.push({},"e3b372NaI5HvY5HnTleBQKd","PlayingState",void 0);var pN=function(p){Ie(n,p);var v=xe(n);function n(p){var g;return Ce(this,n),(g=v.call(this,p)).startCountdown(),g}return Ae(n,[{key:"startCountdown",value:function(){var p;null===(p=this.game)||void 0===p||p.uiManager.startCountdown()}},{key:"initialize",value:function(){var p=this.manager.createInitializeState(this.manager);this.manager.change(p)}},{key:"ready",value:function(){var p=this.manager.createReadyState(this.manager);this.manager.change(p)}},{key:"playing",value:function(){}},{key:"fail",value:function(p){var v=this.manager.createFailState(this.manager,p);this.manager.change(v)}},{key:"finish",value:function(){var p=this.manager.createFinishState(this.manager);this.manager.change(p)}},{key:"update",value:function(){this.updateStateData()}}]),n}(ps);g._RF.pop(),g._RF.push({},"5ef69tJ5eNNv7o22H/XfSD2","ReadyState",void 0);var pD,pL=globalThis.game,pO=pL.analytics,pM=pL.match,px=GameCore.Utils.Valid,pF=function(p){Ie(n,p);var v=xe(n);function n(p){var g;return Ce(this,n),g=v.call(this,p),nQ.stopAllSounds(),nQ.turnDownMusic(),g.handleGuideFlow(),g.setLevelText(),g.setLevelTime(),g.setGridPlayable(),g.logLevelStartAnalytics(),g}return Ae(n,[{key:"initialize",value:function(){var p=this.manager.createInitializeState(this.manager);this.manager.change(p)}},{key:"ready",value:function(){}},{key:"playing",value:function(){var p=this.manager.createPlayingState(this.manager);this.manager.change(p)}},{key:"fail",value:function(p){if(px.isDebugger()){var v=this.manager.createFailState(this.manager);this.manager.change(v)}}},{key:"finish",value:function(){if(px.isDebugger()){var p=this.manager.createFinishState(this.manager);this.manager.change(p)}}},{key:"update",value:function(){}},{key:"setGridPlayable",value:function(){var p;null!==(p=this.manager.getGameplay().guidelinesManager)&&void 0!==p&&p.isNewbieGuideLevel()||this.manager.getGameplay().board.setIgnoreInput(!1)}},{key:"handleGuideFlow",value:function(){var p,v;null!==(p=this.game.guidelinesManager)&&void 0!==p&&p.isNewbieGuideLevel()||this.game.handleShowUI(),null===(v=this.game.guidelinesManager)||void 0===v||v.show()}},{key:"setLevelTime",value:function(){if(this.game){var p=this.data.levelData;p&&this.game.uiManager.setCountdownTime(p.time)}}},{key:"setLevelText",value:function(){if(this.game){var p=this.data.level,v=void 0===p?0:p;this.game.uiManager.setLevelText(v)}}},{key:"logLevelStartAnalytics",value:function(){if(this.game){var p=this.data.level,v=void 0===p?0:p,g=pM.getMatchState().customData.score,E=void 0===g?0:g;pO.levelStart(v,E)}}}]),n}(ps);g._RF.pop(),g._RF.push({},"bb0e3beWSxOOLCv7gjyg2s0","StateManager",void 0);var pB,pU,pz,pG,pY,pj=(0,E.ccclass)("StateManager")(pD=function(p){Ie(n,p);var v=xe(n);function n(){return Ce(this,n),v.apply(this,arguments)}return Ae(n,[{key:"getGameplay",value:function(){return this.gameplay}},{key:"init",value:function(p){this.gameplay=p,this.state=new pP(this)}},{key:"change",value:function(p){this.state=p}},{key:"initialize",value:function(){this.state.initialize()}},{key:"isInitialize",value:function(){return _instanceof(this.state,pP)}},{key:"ready",value:function(){this.state.ready()}},{key:"isReady",value:function(){return _instanceof(this.state,pF)}},{key:"playing",value:function(){this.state.playing()}},{key:"isPlaying",value:function(){return _instanceof(this.state,pN)}},{key:"fail",value:function(p){this.state.fail(p)}},{key:"isFail",value:function(){return _instanceof(this.state,pg)}},{key:"finish",value:function(){this.state.finish()}},{key:"isFinished",value:function(){return _instanceof(this.state,p_)}},{key:"update",value:function(p){this.state&&this.state.update(p)}},{key:"createInitializeState",value:function(){for(var p=arguments.length,v=new Array(p),g=0;g<p;g++)v[g]=arguments[g];return Oe(pP,v)}},{key:"createReadyState",value:function(){for(var p=arguments.length,v=new Array(p),g=0;g<p;g++)v[g]=arguments[g];return Oe(pF,v)}},{key:"createPlayingState",value:function(){for(var p=arguments.length,v=new Array(p),g=0;g<p;g++)v[g]=arguments[g];return Oe(pN,v)}},{key:"createFailState",value:function(){for(var p=arguments.length,v=new Array(p),g=0;g<p;g++)v[g]=arguments[g];return Oe(pg,v)}},{key:"createFinishState",value:function(){for(var p=arguments.length,v=new Array(p),g=0;g<p;g++)v[g]=arguments[g];return Oe(p_,v)}}]),n}(L))||pD;g._RF.pop(),g._RF.push({},"659a5DHz/dCjaYaS9/4ZunE","Digit",void 0);var pH,pV,pq,pW,pK,pX,pJ,pQ=E.ccclass,pZ=E.property,p$=(pB=pQ("Digit"),pU=pZ(I),pB((pY=Ye((pG=function(p){Ie(n,p);var v=xe(n);function n(){var p;Ce(this,n);for(var g=arguments.length,E=new Array(g),k=0;k<g;k++)E[k]=arguments[k];return je(p=v.call.apply(v,[this].concat(E)),"numberLabels",pY,Ne(p)),p.labelUITransforms=[],p.labelUIOpacitys=[],p.previousNumber=0,p}return Ae(n,[{key:"onLoad",value:function(){this.uiTransform=this.getComponent(A),this.labelUITransforms=this.numberLabels.map(function(p){return p.getComponent(A)}),this.labelUIOpacitys=this.numberLabels.map(function(p){return p.getComponent(et)}),e7.lazyValidateProperties(this)}},{key:"setNumber",value:function(p){this.previousNumber!==p&&(this.labelUIOpacitys[this.previousNumber].opacity=0,this.numberLabels[p].node.active||(this.numberLabels[p].node.active=!0),this.labelUIOpacitys[p].opacity=255,this.uiTransform.setContentSize(this.labelUITransforms[p].contentSize),this.previousNumber=p)}}]),n}(L)).prototype,"numberLabels",[pU],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),pz=pG))||pz);g._RF.pop(),g._RF.push({},"9e40aEq56tMKLFoeACyl+eH","Clock",void 0);var p0,p1=E.ccclass,p2=E.disallowMultiple,p4=E.property,p3=(pH=p1("Clock"),pV=p4(k),pq=p4(p$),pH(pW=p2((pX=Ye((pK=function(p){Ie(n,p);var v=xe(n);function n(){var p;Ce(this,n);for(var g=arguments.length,E=new Array(g),k=0;k<g;k++)E[k]=arguments[k];return je(p=v.call.apply(v,[this].concat(E)),"clockIcon",pX,Ne(p)),je(p,"digits",pJ,Ne(p)),p.time=0,p.remaining=0,p.running=!1,p.halfTime=!1,p.handleUpdateConfig=function(v){p.enabled&&console.log("Clock: handleUpdateConfig",v)},p.refillTime=function(){var v=Date.now(),g=G(p.node).to(.5,{scale:new ef(1.1,1.1,1)}),E=G(p.node).to(.5,{scale:new ef(1,1,1)}),k=G(p.clockIcon).to(.15,{angle:-15},{easing:"cubicOut"}).to(.15,{angle:0},{easing:"cubicIn"}).to(.15,{angle:15},{easing:"cubicOut"}).to(.15,{angle:0},{easing:"cubicIn"}),C=G(p.clockIcon).repeat(5,k),_=G(p.node).to(3,{position:new ef(0,0,0)},{onUpdate:function(){var g=Date.now(),E=(g-v)/3e3>1?1:(g-v)/3e3,k=ea.lerp(0,120,E);p.setTime(k)}}).call(function(){p.setTime(120),E.start(),p.node.scene.emit(aR.RESCUE_FINISHED)});G(p.node).parallel(g,_).start(),C.start()},p}return Ae(n,[{key:"__preload",value:function(){this.listenEvents()}},{key:"start",value:function(){this.init()}},{key:"init",value:function(){this.running=!1,this.halfTime=!1}},{key:"listenEvents",value:function(){this.node.scene.on(iV,this.handleUpdateConfig),this.node.scene.on(aR.RESCUE_START,this.refillTime)}},{key:"setTime",value:function(p){this.time=p,this.updateTimeLabel(p),this.remaining=p}},{key:"startCountdown",value:function(){this.running=!0,this.remaining=this.time}},{key:"pause",value:function(){this.running=!1}},{key:"resume",value:function(){this.running=!0}},{key:"endCountDown",value:function(){this.running=!1,this.remaining=0,this.node.scene.emit(aR.TIME_OUT)}},{key:"update",value:function(p){this.running&&(this.remaining<=0?this.endCountDown():(this.remaining-=p,!this.halfTime&&this.remaining<=this.time/2&&(this.halfTime=!0,this.node.scene.emit(aR.HALF_TIME)),this.remaining>=0&&this.updateTimeLabel(this.remaining)))}},{key:"updateTimeLabel",value:function(p){for(var v=this.convertSecondsToMmSs(p),g=0;g<v.length;g++)this.digits[g].setNumber(parseInt(v[g]))}},{key:"convertSecondsToMmSs",value:function(p){var v=Math.floor(p/60),g=Math.floor(p%60),E=this.padZero(v),k=this.padZero(g);return"".concat(E).concat(k)}},{key:"padZero",value:function(p){return p<10?"0".concat(p):"".concat(p)}}]),n}(L)).prototype,"clockIcon",[pV],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),pJ=Ye(pK.prototype,"digits",[pq],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),pW=pK))||pW)||pW);g._RF.pop(),g._RF.push({},"ed00dMDxYRJP4fZMawN9JnW","ComboProgressBar",void 0);var p5,p6,p9,p8,p7,fe,ft,fn,fi,fa=E.ccclass,fr=fa("ComboProgressBar")(p0=function(p){Ie(n,p);var v=xe(n);function n(){return Ce(this,n),v.apply(this,arguments)}return Ae(n,[{key:"start",value:function(){this.progressBar=this.getComponent(rN),this.opacity=this.getComponent(et),this.comboTimer=0,this.isActive=!1,this.node.scene.on(aR.COMBO_UPDATED,this.handleComboUpdated,this)}},{key:"update",value:function(p){this.isActive&&(this.comboTimer>0?(this.comboTimer-=p,this.progressBar.progress=this.comboTimer/3):(this.isActive=!1,this.opacity.opacity=0,this.node.scene.emit(aR.COMBO_ENDED)))}},{key:"handleComboUpdated",value:function(p){0===p?this.opacity.opacity=0:p>0&&(this.isActive=!0,this.comboTimer=3),p>1&&(this.opacity.opacity=255)}},{key:"pause",value:function(){this.isActive=!1}},{key:"resume",value:function(){this.isActive=!0}}]),n}(L))||p0;g._RF.pop(),g._RF.push({},"46f05OkhTtGz6xBJuPMZGqH","ScoreBlock",void 0);var fo,fs,fl,fu,fc,fd,fp,ff,fy,fv,fg,fm,fb,fw,fS,fE,fk,fC=E.ccclass,f_=E.property,fA=GameCore.Utils.Image,fT=(p5=fC("ScoreBlock"),p6=f_(V),p9=f_(Z),p8=f_(I),p5((ft=Ye((fe=function(p){Ie(a,p);var v,g,E=xe(a);function a(){var p;Ce(this,a);for(var v=arguments.length,g=new Array(v),k=0;k<v;k++)g[k]=arguments[k];return je(p=E.call.apply(E,[this].concat(g)),"avatar",ft,Ne(p)),je(p,"defaultAvatar",fn,Ne(p)),je(p,"scoreText",fi,Ne(p)),p}return Ae(a,[{key:"onLoad",value:function(){this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){e7.lazyValidateProperties(this)}},{key:"updateInfo",value:(g=Ee(function(p,v){var g,E;return _ts_generator(this,function(k){switch(k.label){case 0:v?(this.score=v,this.scoreText.string=v.toString()):(this.score=0,this.scoreText.string="0");k.label=1;case 1:k.trys.push([1,3,,4]);return[4,fA.loadImage(p)];case 2:g=k.sent();if(!g)return[2];E=Z.createWithImage(g);E.packable=!0,this.avatar.spriteFrame=E;return[3,4];case 3:k.sent();this.avatar.spriteFrame=this.defaultAvatar;return[3,4];case 4:return[2]}})}),function(p,v){return g.apply(this,arguments)})},{key:"updateScore",value:(v=Ee(function(p){var v,g,E;return _ts_generator(this,function(k){switch(k.label){case 0:v=this,g=p-this.score,E=G(this.node).to(.1,{},{onUpdate:function(p,E){if(E){var k=Math.floor(g*E)+v.score;v.scoreText.string=k.toString()}}});return[4,tJ.runTweenAsync(E)];case 1:k.sent(),this.scoreText.string=p.toString(),this.score=p;return[2]}})}),function(p){return v.apply(this,arguments)})}]),a}(L)).prototype,"avatar",[p6],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),fn=Ye(fe.prototype,"defaultAvatar",[p9],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),fi=Ye(fe.prototype,"scoreText",[p8],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),p7=fe))||p7);g._RF.pop(),g._RF.push({},"61791zAr2tJR4p22EZ5QRfk","Header",void 0);var fI,fR,fP,fN,fD,fL=E.ccclass,fO=E.property,fM=globalThis.game.match,fx=(fo=fL("Header"),fs=fO(I),fl=fO(k),fu=fO(k),fc=fO(k),fd=fO(k),fp=fO(fT),ff=fO(fT),fo((fg=Ye((fv=function(p){Ie(n,p);var v=xe(n);function n(){var p;Ce(this,n);for(var g=arguments.length,E=new Array(g),k=0;k<g;k++)E[k]=arguments[k];return je(p=v.call.apply(v,[this].concat(E)),"levelText",fg,Ne(p)),je(p,"settingNode",fm,Ne(p)),je(p,"homeNode",fb,Ne(p)),je(p,"leftNode",fw,Ne(p)),je(p,"coinNode",fS,Ne(p)),je(p,"playerScoreBlock",fE,Ne(p)),je(p,"opponentScoreBlock",fk,Ne(p)),p.challengeScoreBlockShown=!1,p}return Ae(n,[{key:"onLoad",value:function(){this.validateRequiredComponents(),this.listenGameEvents()}},{key:"listenGameEvents",value:function(){this.node.scene.on(aR.SCORE_UPDATED,this.updateScore,this)}},{key:"unlistenGameEvents",value:function(){this.node.scene.off(aR.SCORE_UPDATED,this.updateScore,this)}},{key:"validateRequiredComponents",value:function(){e7.lazyValidateProperties(this)}},{key:"handleClickedPauseGame",value:function(){this.showSettingScreen(),this.node.scene.emit(aR.GAME_PAUSE)}},{key:"handleReturnHome",value:function(){s8.openScreen(nH.QUIT_LEVEL_SCREEN),this.node.scene.emit(aR.GAME_PAUSE)}},{key:"highlightCoinContainer",value:function(){var p=W("Canvas/Screens");if(p){var v=this.coinNode.worldPosition.clone();this.coinNode.parent=p,this.coinNode.worldPosition=v}}},{key:"removeCoinContainerHighlight",value:function(){var p=this.coinNode.worldPosition.clone();this.coinNode.parent=this.leftNode,this.coinNode.worldPosition=p}},{key:"showSettingScreen",value:function(){s8.openScreen(nH.SETTINGS_SCREEN,{})}},{key:"setLevelText",value:function(p){this.levelText.string="Level ".concat(p)}},{key:"setButtonsSelectable",value:function(p){var v=!(arguments.length>0&&void 0!==p)||p;this.enableBtnNode(this.settingNode,v,!0),this.enableBtnNode(this.homeNode,v,!0)}},{key:"showChallengeScoreBlock",value:function(){if(!this.challengeScoreBlockShown){this.challengeScoreBlockShown=!0;var p=fM.getMatchState(),v=p.id,g=p.customData,E=g.playerId,k=g.opponentId;if(v&&E&&k){this.playerScoreBlock.node.active=!0,this.opponentScoreBlock.node.active=!0;var C=p.profiles[E],_=p.profiles[k];this.playerScoreBlock.updateInfo(C.photo,C.score),this.opponentScoreBlock.updateInfo(_.photo,_.score)}}}},{key:"hideChallengeScoreBlock",value:function(){this.challengeScoreBlockShown&&(this.challengeScoreBlockShown=!1,this.playerScoreBlock.node.active=!1,this.opponentScoreBlock.node.active=!1)}},{key:"enableBtnNode",value:function(p,v,g){var E=p.getComponent(N);if(E&&(E.interactable=v),p.active=g,g)p.getComponent(iz)}},{key:"updateScore",value:function(p){this.challengeScoreBlockShown&&this.playerScoreBlock.updateScore(p)}},{key:"onDestroy",value:function(){this.unlistenGameEvents()}}]),n}(L)).prototype,"levelText",[fs],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),fm=Ye(fv.prototype,"settingNode",[fl],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),fb=Ye(fv.prototype,"homeNode",[fu],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),fw=Ye(fv.prototype,"leftNode",[fc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),fS=Ye(fv.prototype,"coinNode",[fd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),fE=Ye(fv.prototype,"playerScoreBlock",[fp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),fk=Ye(fv.prototype,"opponentScoreBlock",[ff],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),fy=fv))||fy);g._RF.pop(),g._RF.push({},"396015KIPBL3bHTUOHN7pCl","UIMasks",void 0);var fF=E.ccclass,fB=E.property,fU=(fI=fF("UIMasks"),fR=fB(iz),fI((fD=Ye((fN=function(p){Ie(a,p);var v,g,E=xe(a);function a(){var p;Ce(this,a);for(var v=arguments.length,g=new Array(v),k=0;k<v;k++)g[k]=arguments[k];return je(p=E.call.apply(E,[this].concat(g)),"background",fD,Ne(p)),p}return Ae(a,[{key:"__preload",value:function(){this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){e7.lazyValidateProperties(this)}},{key:"show",value:(g=Ee(function(){return _ts_generator(this,function(p){switch(p.label){case 0:this.background.node.active=!0;return[4,this.background.changeStateFade(!0,.25)];case 1:p.sent();return[2]}})}),function(){return g.apply(this,arguments)})},{key:"hide",value:(v=Ee(function(){return _ts_generator(this,function(p){switch(p.label){case 0:return[4,this.background.changeStateFade(!1,.25)];case 1:p.sent(),this.background.node.active=!1;return[2]}})}),function(){return v.apply(this,arguments)})}]),a}(L)).prototype,"background",[fR],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),fP=fN))||fP);g._RF.pop(),g._RF.push({},"805dbJxaCpKBpzq9ejSgrc8","TileType",void 0);var fz,fG,fY,fj,fH,fV="bomb";g._RF.pop(),g._RF.push({},"151afQBVDpOYpTjtwP+wYH+","DevTools",void 0);var fq,fW,fK,fX,fJ,fQ,fZ,f$,f0,f1,f2,f4,f3,f5,f6,f9,f8,f7,ye,yt=GameCore,yn=yt.Dtos.Player,yi=yt.Utils.Function,ya=E.ccclass,yr=E.property,yo=globalThis.game.player,ys=(fz=ya("DevToolsContainer"),fG=yr(k),fz((fH=Ye((fj=function(p){Ie(o,p);var v,g,E,k=xe(o);function o(){var p;Ce(this,o);for(var v=arguments.length,g=new Array(v),E=0;E<v;E++)g[E]=arguments[E];return je(p=k.call.apply(k,[this].concat(g)),"devToolsToggle",fH,Ne(p)),p.isActive=!0,p.game=null,p.debouncedStarsNotification=yi.debounce(function(){var p=yo.getGameData();p&&s8.showNotificationScreen("Stars added. Current stars: ".concat(p.stars))},700),p}return Ae(o,[{key:"injectGameplay",value:function(p){this.game=p}},{key:"hideAllButtons",value:function(){var p=this;this.getComponentsInChildren(N).forEach(function(v){var g=v.node.parent;g&&g.name!==p.devToolsToggle.name&&(g.active=!1)})}},{key:"showAllButtons",value:function(){var p=this;this.getComponentsInChildren(N).forEach(function(v){var g=v.node.parent;g&&g.name!==p.devToolsToggle.name&&(g.active=!0)})}},{key:"handleClickDevToolsButton",value:function(){this.isActive?(this.hideAllButtons(),this.isActive=!1):(this.showAllButtons(),this.isActive=!0)}},{key:"handleResetData",value:function(){yo.setPlayerData(yn.Data.getDefaultData()),s8.openScreen(nH.NOTIFICATION_SCREEN,{duration:3,message:"Items and stars will only be reset if you refresh the game page now."}),this.node.scene.emit(aR.START_OVER)}},{key:"handleNextLevel",value:(E=Ee(function(){var p,v,g,E;return _ts_generator(this,function(k){E=(null!==(p=null===(v=this.game)||void 0===v||null===(v=v.getGameData())||void 0===v?void 0:v.level)&&void 0!==p?p:1)+1;null===(g=this.game)||void 0===g||g.setGameData({level:E-1}),yo.setGameData({level:E}),this.node.scene.emit(aR.NEXT_LEVEL);return[2]})}),function(){return E.apply(this,arguments)})},{key:"handlePrevLevel",value:(g=Ee(function(){var p,v,g,E;return _ts_generator(this,function(k){E=Math.max((null!==(p=null===(v=this.game)||void 0===v||null===(v=v.getGameData())||void 0===v?void 0:v.level)&&void 0!==p?p:2)-1,1);null===(g=this.game)||void 0===g||g.setGameData({level:E-1}),yo.setGameData({level:E}),this.node.scene.emit(aR.NEXT_LEVEL);return[2]})}),function(){return g.apply(this,arguments)})},{key:"handleEnterSelectLevel",value:(v=Ee(function(p){var v,g;return _ts_generator(this,function(E){g=Number(p.string);null===(v=this.game)||void 0===v||v.setGameData({level:g-1}),yo.setGameData({level:g}),this.node.scene.emit(aR.NEXT_LEVEL);return[2]})}),function(p){return v.apply(this,arguments)})},{key:"handleClickBuildVersionButton",value:function(){var p=globalThis.game.getBuildVersion();s8.showNotificationScreen("Build version: ".concat(p))}},{key:"handleClickWinLevelButton",value:function(){this.node.scene.emit(aR.GAME_FINISH)}},{key:"handleClickTimeOutButton",value:function(){this.node.scene.emit(aR.TIME_OUT)}},{key:"handleClickExplodeButton",value:function(){var p,v,g=this.game;if(g){var E=null===(p=g.getGameData())||void 0===p||null===(p=p.levelData)||void 0===p?void 0:p.specials.bomb;if(E&&!(E<=0)){var k=g.board.getBombTiles();if(0!==k.length){var C=k[0];if((null===(v=C.special)||void 0===v?void 0:v.type)!==fV)throw new Error("Invalid bomb tile");C.special.detonateImmediately()}else console.info("No bomb tiles found")}}}},{key:"handleFillItem",value:function(){this.node.scene.emit(aR.ADD_ITEM,{animate:function(){return Promise.resolve()},item:oG.HINT,quantity:2}),this.node.scene.emit(aR.ADD_ITEM,{animate:function(){return Promise.resolve()},item:oG.STORM,quantity:2}),this.node.scene.emit(aR.ADD_ITEM,{animate:function(){return Promise.resolve()},item:oG.THUNDER,quantity:2}),this.node.scene.emit(aR.ADD_ITEM,{animate:function(){return Promise.resolve()},item:oG.PLIERS,quantity:2})}},{key:"handleAutoPlay",value:function(){this.node.scene.emit(aR.AUTO_PLAY)}},{key:"handleAddStars",value:function(){var p=yo.getGameData();p&&(yo.setGameData({stars:p.stars+10}),this.debouncedStarsNotification())}},{key:"handleSwitchBundle",value:function(){ec.emit(iJ)}}]),o}(L)).prototype,"devToolsToggle",[fG],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),fY=fj))||fY);g._RF.pop(),g._RF.push({},"a3b0f6zU+1D97PyszsgST1H","UIManager",void 0);var yl,yu,yc,yh,yd,yp,yf,yy,yv=E.ccclass,yg=E.property,ym=GameCore,yb=ym.Utils.Valid,yw=ym.Match.Modes,yS=globalThis.game.match,yE=(fq=yv("UIManager"),fW=yg(p3),fK=yg(fx),fX=yg(ys),fJ=yg(fr),fQ=yg(k),fZ=yg(fU),f$=yg([k]),f0=yg([k]),fq((f4=Ye((f2=function(p){Ie(r,p);var v,g,E,k,C=xe(r);function r(){var p;Ce(this,r);for(var v=arguments.length,g=new Array(v),E=0;E<v;E++)g[E]=arguments[E];return je(p=C.call.apply(C,[this].concat(g)),"clock",f4,Ne(p)),je(p,"header",f3,Ne(p)),je(p,"devTools",f5,Ne(p)),je(p,"comboProgressBar",f6,Ne(p)),je(p,"comboContainer",f9,Ne(p)),je(p,"uiMasks",f8,Ne(p)),je(p,"topAnimNodes",f7,Ne(p)),p.originTopNodesPos=[],je(p,"botAnimNodes",ye,Ne(p)),p.originBotNodesPos=[],p.hideBotWorldY=-80,p.entranceSignal=new na,p.exitSignal=new na,p.showDevTools=function(){p.devTools&&(p.devTools.node.active=!0)},p}return Ae(r,[{key:"onLoad",value:function(){var p=this;this.validateRequiredComponents(),this.listensDevToolsEvents(),this.listenRescueEvents(),D.once(em.EVENT_AFTER_UPDATE,function(){p.saveOriginPos(),p.initUIPos()})}},{key:"validateRequiredComponents",value:function(){e7.lazyValidateProperties(this)}},{key:"saveOriginPos",value:function(){var p=this;this.topAnimNodes.forEach(function(v){p.originTopNodesPos.push(v.position.clone())}),this.botAnimNodes.forEach(function(v){p.originBotNodesPos.push(v.position.clone())})}},{key:"initUIPos",value:function(){var p=this;this.topAnimNodes.forEach(function(v,g){var E=p.originTopNodesPos[g].clone();E.y+=200,v.setPosition(E)});var v=new ef(0,this.hideBotWorldY,0);this.botAnimNodes.forEach(function(g,E){var k,C,_=p.originBotNodesPos[E].clone();v.y=p.hideBotWorldY;var A=null!==(k=null===(C=g.parent)||void 0===C?void 0:C.inverseTransformPoint(v,v).y)&&void 0!==k?k:200;_.y=A,g.setPosition(_)})}},{key:"listensDevToolsEvents",value:function(){this.node.scene.on(oQ.Events.UNLOCK_DEV_TOOLS,this.showDevTools)}},{key:"listenRescueEvents",value:function(){this.node.scene.on(aR.RESCUE_START,this.showRescueAnimation,this),this.node.scene.on(aR.RESCUE_FINISHED,this.hideRescueAnimation,this)}},{key:"initDevTools",value:function(p){var v=this;window.addEventListener("reset-game-data",function(){var p;null===(p=v.devTools)||void 0===p||p.handleResetData()}),this.devTools&&(this.devTools.node.active=yb.isDebugger(),this.devTools.injectGameplay(p))}},{key:"setLevelText",value:function(p){this.header.setLevelText(p)}},{key:"initCountdown",value:function(){this.clock.init()}},{key:"setCountdownTime",value:function(p){this.clock.setTime(p)}},{key:"startCountdown",value:function(){this.clock.startCountdown()}},{key:"pauseTime",value:function(){this.comboProgressBar.pause(),this.clock.pause()}},{key:"resumeTime",value:function(){this.comboProgressBar.resume(),this.clock.resume()}},{key:"setComboUI",value:function(p){this.comboContainer.getComponent(iz).changeStateFade(p,.1)}},{key:"disableHeader",value:function(){this.header.setButtonsSelectable(!1)}},{key:"enableHeader",value:function(){this.header.setButtonsSelectable()}},{key:"updateStatus",value:function(){yS.getMatchState().mode===yw.CHALLENGE_FRIEND?this.header.showChallengeScoreBlock():this.header.hideChallengeScoreBlock()}},{key:"showRescueAnimation",value:(k=Ee(function(){return _ts_generator(this,function(p){switch(p.label){case 0:return[4,this.uiMasks.show()];case 1:p.sent();return[2]}})}),function(){return k.apply(this,arguments)})},{key:"hideRescueAnimation",value:(E=Ee(function(){return _ts_generator(this,function(p){switch(p.label){case 0:return[4,this.uiMasks.hide()];case 1:p.sent();return[2]}})}),function(){return E.apply(this,arguments)})},{key:"playExitAnimUI",value:(g=Ee(function(){var p,v,g;return _ts_generator(this,function(E){switch(E.label){case 0:p=this;this.entranceSignal.abort(),this.exitSignal.abort(),this.exitSignal=new na;v=[];this.topAnimNodes.forEach(function(g,E){var k=new ef(g.position.x,p.originTopNodesPos[E].y+200,0),C=G(g);C.to(.17,{position:k},{easing:"backIn"}),v.push(tJ.runTweenAsync(C,p.exitSignal))});g=new ef(0,this.hideBotWorldY,0);this.botAnimNodes.forEach(function(E){var k,C;g.y=p.hideBotWorldY;var _=null!==(k=null===(C=E.parent)||void 0===C?void 0:C.inverseTransformPoint(g,g).y)&&void 0!==k?k:200,A=new ef(E.position.x,_,0),T=G(E);T.to(.17,{position:A},{easing:"backIn"}),v.push(tJ.runTweenAsync(T,p.exitSignal))});return[4,Promise.all(v)];case 1:E.sent(),this.exitSignal.aborted||(this.header.node.active=!1);return[2]}})}),function(){return g.apply(this,arguments)})},{key:"playEntranceAnimUI",value:(v=Ee(function(){var p,v;return _ts_generator(this,function(g){switch(g.label){case 0:p=this;this.exitSignal.abort(),this.entranceSignal.abort(),this.entranceSignal=new na,this.header.node.active=!0;v=[];this.topAnimNodes.forEach(function(g,E){var k=new ef(g.position.x,p.originTopNodesPos[E].y,0),C=G(g);C.to(.2,{position:k},{easing:"backOut"}),v.push(tJ.runTweenAsync(C,p.entranceSignal))}),this.botAnimNodes.forEach(function(g,E){var k=new ef(g.position.x,p.originBotNodesPos[E].y,0),C=G(g);C.to(.2,{position:k},{easing:"backOut"}),v.push(tJ.runTweenAsync(C,p.entranceSignal))});return[4,Promise.all(v)];case 1:g.sent();return[2]}})}),function(){return v.apply(this,arguments)})},{key:"highlightCoinContainer",value:function(){this.header.highlightCoinContainer()}},{key:"unHighlightCoinContainer",value:function(){this.header.removeCoinContainerHighlight()}},{key:"setInteractableItemButtons",value:function(p){var v=!(arguments.length>0&&void 0!==p)||p;this.botAnimNodes.forEach(function(p){var g=p.getComponent(dQ);if(g){if(!v)return void(g.button.interactable=!1);g.canActivate()&&(g.button.interactable=!0)}})}}]),r}(L)).prototype,"clock",[fW],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),f3=Ye(f2.prototype,"header",[fK],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),f5=Ye(f2.prototype,"devTools",[fX],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),f6=Ye(f2.prototype,"comboProgressBar",[fJ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),f9=Ye(f2.prototype,"comboContainer",[fQ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),f8=Ye(f2.prototype,"uiMasks",[fZ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),f7=Ye(f2.prototype,"topAnimNodes",[f$],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),ye=Ye(f2.prototype,"botAnimNodes",[f0],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),f1=f2))||f1);g._RF.pop(),g._RF.push({},"157f203vjtMma2FDvAlyM6h","Gameplay",void 0);var yk=globalThis.game,yC=yk.player,y_=yk.ads,yA=yk.event,yT=yk.match,yI=yk.storage,yR=yk.analytics,yP=yk.monitorError,yN=yk.frameCapture,yD=yk.leaderboard,yL=GameCore,yO=yL.Events,yM=yL.Utils,yx=yM.Time,yF=yM.Array,yB=yL.Configs.Gameplay,yU=yL.Match.Modes,yz=E.ccclass,yG=E.property,yY=[];yl=yz("Gameplay"),yu=yG(ub),yc=yG(iz),yh=yG(ce),yl((yp=Ye((yd=function(p){Ie(i,p);var v,g=xe(i);function i(){var p;Ce(this,i);for(var v=arguments.length,E=new Array(v),k=0;k<v;k++)E[k]=arguments[k];return je(p=g.call.apply(g,[this].concat(E)),"board",yp,Ne(p)),je(p,"opacityToggler",yf,Ne(p)),je(p,"pathDraw",yy,Ne(p)),p.gameData=null,p.defaultData={level:1,isMatchStartFromLoader:!1},p.rescueTiles=[],p.isAutoPlayEnabled=!1,p.handleOpenScreen=function(v){v.screenName===nV[nH.GET_ITEM_SCREEN]&&p.uiManager.highlightCoinContainer()},p.handleShowUI=Ee(function(){return _ts_generator(this,function(v){switch(v.label){case 0:p.uiManager.updateStatus(),p.uiManager.disableHeader(),p.uiManager.setInteractableItemButtons(!1);return[4,p.uiManager.playEntranceAnimUI()];case 1:v.sent(),p.uiManager.enableHeader(),p.uiManager.setInteractableItemButtons(!0);return[2]}})}),p.handleHideUI=Ee(function(){return _ts_generator(this,function(v){switch(v.label){case 0:p.uiManager.disableHeader(),p.uiManager.setInteractableItemButtons(!1);return[4,p.uiManager.playExitAnimUI()];case 1:v.sent();return[2]}})}),p.handleCloseScreen=function(v){v.screenName===nV[nH.GET_ITEM_SCREEN]&&p.uiManager.unHighlightCoinContainer()},p.handlePauseGame=function(){p.node.scene.emit(aR.PAUSE_TIME),p.node.pauseSystemEvents(!0),p.opacityToggler.changeStateFade(!1,.1),p.uiManager.setComboUI(!1),p.processCrazyGamesGameplayStop()},p.handleResumeGame=function(){var v;p.node.resumeSystemEvents(!0),p.stateManager.isPlaying()&&p.node.scene.emit(aR.RESUME_TIME),p.processCrazyGamesGameplayStart(),p.opacityToggler.changeStateFade(!0,.1),p.uiManager.setComboUI(!0),null===(v=p.guidelinesManager)||void 0===v||v.startAutoGuides()},p.handleReplayGame=function(){var v=Ee(function(v){var g,E,k,C;return _ts_generator(this,function(_){switch(_.label){case 0:p.handleHideHint();g=we(we({},p.defaultData),v);_.label=1;case 1:_.trys.push([1,6,,7]);E=yT.getMatchState().mode===yU.SINGLE;if(!E)return[3,3];return[4,sx.finishMatchAsync()];case 2:E=_.sent();_.label=3;case 3:k=yT.getMatchState().mode!==yU.CHALLENGE_FRIEND;if(!k)return[3,5];return[4,sx.startMatchAsync()];case 4:k=_.sent();_.label=5;case 5:return[3,7];case 6:C=_.sent();console.warn("handleReplayGame",C);return[3,7];case 7:p.setGameData(g),p.stateManager.initialize();return[2]}})});return function(p){return v.apply(this,arguments)}}(),p.handleFinishGame=function(){var v;p.attemptCallCreateShortcut(),null!==(v=p.guidelinesManager)&&void 0!==v&&v.isNewbieGuideLevel()?(p.guidelinesManager.guideSkipButton.active=!1,p.handleNextLevel()):p.stateManager.finish()},p.handleNextLevel=Ee(function(){var v,g,E,k;return _ts_generator(this,function(C){switch(C.label){case 0:if(!p.gameData)return[3,7];C.label=1;case 1:C.trys.push([1,4,,5]);g=yT.getMatchState().mode===yU.SINGLE;if(!g)return[3,3];return[4,sx.finishMatchAsync()];case 2:g=C.sent();C.label=3;case 3:yT.getMatchState().mode===yU.TOURNAMENT&&p.scoreManager.updateTournamentStartScore();return[3,5];case 4:E=C.sent();console.warn("handleReplayGame",E);return[3,5];case 5:k=(null!==(v=p.gameData.level)&&void 0!==v?v:1)+1;p.setGameData({level:k});return[4,Promise.all([sx.setMatchCustomDataAsync({level:k,score:0}),sx.startMatchAsync()])];case 6:C.sent(),p.stateManager.initialize(),console.log("Next level",p.gameData.level);C.label=7;case 7:return[2]}})}),p.handleStartOver=Ee(function(){var v;return _ts_generator(this,function(g){yC.setGameData({level:yB.Tutorial.Enabled?0:1}),p.gameData=yC.getGameData(),p.stateManager.initialize(),console.info("Start over",null===(v=p.gameData)||void 0===v?void 0:v.level);return[2]})}),p.handleMaxLevel=function(){p.gameData&&(p.initData(),s8.openScreen(nH.CONGRATULATION_SCREEN,{level:p.gameData.level}),console.info("Max level",p.gameData.level))},p.handleExitGame=Ee(function(){return _ts_generator(this,function(p){try{yI.setStorageData("dashboard","animateToCurrentLevel",!0),yI.setStorageData("collection","animateMapPackUnlock",!0)}catch(p){console.warn("handleExitGame",p)}return[2]})}),p.handleTileClick=function(v){p.stateManager.playing(),p.board.handleTileClick(v),p.handleHideHint()},p.handleGridMatchSuccess=function(v,g){p.pathDraw.drawMatchPath(v,function(v){var g=v.x,E=v.y;return p.board.getAnyTileWorldPosition(g,E)}),p.comboManager.addCombo(),p.handleAddScore(),p.effectManager.playClearFXAt([g[0].node.worldPosition,g[1].node.worldPosition])},p.handleGridMatchFail=function(v){var g;null!==(g=p.guidelinesManager)&&void 0!==g&&g.isShowErrorPathLevel()&&p.pathDraw.drawErrorPath(v,function(v){var g=v.x,E=v.y;return p.board.getAnyTileWorldPosition(g,E)})},p.checkIfGameIsFinish=function(){0===p.board.getUncleared().length&&p.node.scene.emit(aR.GAME_FINISH)},p.handlePauseTime=function(){p.uiManager.pauseTime()},p.handleResumeTime=function(){p.uiManager.resumeTime()},p.handleClockTimeout=function(){p.stateManager.fail(lc)},p.handleHalfTime=function(){void 0!==p.guidelinesManager&&(p.board.getUncleared().length>=p.board.getCleared().length&&p.guidelinesManager.startThunderGuide()||p.board.getBombTiles().length>0&&p.guidelinesManager.startPliersGuide())},p.handleStartRescue=function(){var v,g;for(nP.setBlockInput(!0),p.board.setIgnoreInput(!0);p.rescueTiles.length>0;){var E=p.rescueTiles.pop();null==E||E.restore()}yR.levelRescue(null!==(v=null===(g=p.gameData)||void 0===g?void 0:g.level)&&void 0!==v?v:1)},p.handleFinishRescue=function(){nP.setBlockInput(!1),p.board.setIgnoreInput(!1)},p.handleBombExplode=function(){var v=Ee(function(v){var g;return _ts_generator(this,function(E){switch(E.label){case 0:p.rescueTiles.push(v),p.board.setIgnoreInput(!0),nP.getBlockInput()||(nQ.playSound(nB.BOMB_EXPLODE_1),nP.setBlockInput(!0));g=v.node.worldPosition;return[4,p.effectManager.createBombExplosionAt(new ef(g.x,g.y,0))];case 1:E.sent(),nP.setBlockInput(!1),p.stateManager.isFail()||p.stateManager.fail(ld);return[2]}})});return function(p){return v.apply(this,arguments)}}(),p.handleShowHint=function(){if(!p.pathDraw.isDrawingHint){var v=p.board.getHintPath();v&&(nQ.playSound(nB.HINT_ITEM),p.pathDraw.drawHintPath(v,function(v){return p.board.getAnyTileWorldPosition(v.x,v.y)}),p.board.showHint())}},p.handleHideHint=function(){p.pathDraw.isDrawingHint&&(p.pathDraw.clearHintPath(),p.board.hideHint())},p.handleAddScore=function(){var v=p.levelManager.getLevelData().level,g=p.comboManager.getCombo();p.scoreManager.addScore(10,v,g)},p.handleUseItem=function(v){p.stateManager.playing(),v!==oG.HINT&&p.handleHideHint()},p.handleAutoPlay=function(){p.isAutoPlayEnabled?p.disableAutoPlay():p.enableAutoPlay()},p.enableAutoPlay=function(){p.isAutoPlayEnabled=!0;p.node.scene.once(aR.GAME_FINISH,function(){p.disableAutoPlay()}),p.schedule(p.autoPlay,.5)},p.disableAutoPlay=function(){p.isAutoPlayEnabled=!1,p.unschedule(p.autoPlay)},p.autoPlay=function(){var v=p.board.getHintPath();if(!v)throw new Error("No path found");var g=v[0].a,E=v.slice(-1)[0].b,k=p.board.getTileAt(g.x,g.y),C=p.board.getTileAt(E.x,E.y);if(!k||!C)throw new Error("Tile is null");k.onClick(),C.onClick()},p.handleAddStars=function(v){var g=yC.getGameData();if(!g)return Promise.resolve([]);yC.setGameData({stars:g.stars+1});var E=v.startAnimationAt;E&&p.effectManager.playStarFXAt(E)},p.handleInviteFriends=Ee(function(){var v,g,E,k,C,_,A,T,I,R,P,N,D,L;return _ts_generator(this,function(O){switch(O.label){case 0:O.trys.push([0,2,,3]);s8.showLoadingScreen();k=p.board.generateFenFromCurrentLevel(),C=(null!==(v=yC.getGameData())&&void 0!==v?v:{}).level,_=void 0===C?1:C;_=Math.max(1,_);A=null!==(g=null===(E=p.gameData)||void 0===E?void 0:E.levelData)&&void 0!==g?g:{},T=A.mode,I=void 0===T?"":T,R=A.rules,P=void 0===R?{addRandomTilesPerMove:0,maxSpaceOfPair:0}:R,N=A.time,D=void 0===N?0:N;yN.addWideframeRender("renderResultChallenge",so);return[4,yT.context.choose.processAsync({playerId:yC.getPlayerId(),fallbackSingleMode:!1,extraData:{level:_,fen:k,gravity:I,rules:P,time:D}})];case 1:O.sent(),s8.closeLoadingScreen(),p.node.scene.emit(aR.GAME_RESUME),p.node.scene.emit(aR.GAME_REPLAY,{level:_});return[3,3];case 2:L=O.sent();if(console.warn("Unable to invite friends",L),s8.closeLoadingScreen(),s8.showNotificationScreen("Sorry, please try again later"),!_instanceof(L,Error))return[2];null==yP||yP.sendException(L),p.node.scene.emit(aR.GAME_RESUME),p.node.scene.emit(aR.SHOW_UI);return[3,3];case 3:return[2]}})}),p.handleAdShow=function(v){var g=v.placementId;g&&-1!==yY.indexOf(g)&&(yY.splice(yY.indexOf(g),1),y_.hideBannerAdAsync(g).catch(function(){}),0===yY.length&&yA.off(yO.AD_SHOWING,p.handleAdShow))},p.handleAddItem=function(){var v=Ee(function(v){var g,E,k,C,_;return _ts_generator(this,function(A){switch(A.label){case 0:g=v.animate,E=v.item,k=v.quantity,C=yF.search(p.itemManager.items,function(p){return p.itemType===E});if(!(void 0!==C))return[3,2];_=C.getQuantity()+k;C.saveQuantity(_),p.uiManager.setInteractableItemButtons(!1),p.handlePauseGame();return[4,g()];case 1:A.sent(),C.setQuantity(_,!0),p.uiManager.setInteractableItemButtons(!0),p.handleResumeGame();return[3,3];case 2:console.warn("Item ".concat(E," not found"));A.label=3;case 3:return[2]}})});return function(p){return v.apply(this,arguments)}}(),p}return Ae(i,[{key:"__preload",value:function(){this.initComponents(),this.validateRequiredComponents(),this.listenCoreEvents(),this.listenInputEvents(),this.listenFlowEvents()}},{key:"onLoad",value:function(){sS.init()}},{key:"initComponents",value:function(){this.initUIManager(),this.initLevelManager(),this.initStateManager(),this.initEffectManager(),this.initItemManager(),this.initComboManager(),this.initScoreManager(),this.initInputController(),this.initGuidelinesManager()}},{key:"initUIManager",value:function(){var p;this.uiManager=null===(p=this.node.parent)||void 0===p?void 0:p.getComponentInChildren(yE),this.uiManager.initDevTools(this)}},{key:"initLevelManager",value:function(){this.levelManager=this.getComponent(d5)}},{key:"initStateManager",value:function(){this.stateManager=this.getComponent(pj)}},{key:"initInputController",value:function(){this.inputController=this.getComponent(lp)}},{key:"initEffectManager",value:function(){this.effectManager=this.getComponent(c4)}},{key:"initItemManager",value:function(){var p=this;this.itemManager=this.getComponent(d$),this.itemManager.syncItems(),this.itemManager.items.forEach(function(v){v.init(p)})}},{key:"initComboManager",value:function(){this.comboManager=this.getComponent(cb),this.comboManager.init()}},{key:"initScoreManager",value:function(){this.scoreManager=this.getComponent(d8),this.scoreManager.init()}},{key:"initGuidelinesManager",value:function(){yB.Tutorial.Enabled&&(this.guidelinesManager=this.getComponent(dW),this.guidelinesManager.init(this))}},{key:"validateRequiredComponents",value:function(){e7.lazyValidateProperties(this)}},{key:"listenCoreEvents",value:function(){yY=[],yA.off(yO.AD_SHOWING,this.handleAdShow),yA.clear(yO.OPENING_SCREEN),yA.clear(yO.CLOSING_SCREEN),yA.on(yO.OPENING_SCREEN,this.handleOpenScreen),yA.on(yO.CLOSING_SCREEN,this.handleCloseScreen)}},{key:"listenInputEvents",value:function(){this.node.scene.on(aR.SHOW_UI,this.handleShowUI),this.node.scene.on(aR.HIDE_UI,this.handleHideUI),this.node.scene.on(aR.GAME_PAUSE,this.handlePauseGame),this.node.scene.on(aR.GAME_RESUME,this.handleResumeGame),this.node.scene.on(aR.GAME_REPLAY,this.handleReplayGame),this.node.scene.on(aR.GAME_FINISH,this.handleFinishGame),this.node.scene.on(aR.NEXT_LEVEL,this.handleNextLevel),this.node.scene.on(aR.START_OVER,this.handleStartOver),this.node.scene.on(aR.MAX_LEVEL,this.handleMaxLevel),this.node.scene.on(aR.GAME_EXIT,this.handleExitGame),this.node.scene.on(aR.TILE_CLICK,this.handleTileClick),this.node.scene.on(aR.GRID_MATCH_SUCCESS,this.handleGridMatchSuccess),this.node.scene.on(aR.GRID_MATCH_FAIL,this.handleGridMatchFail),this.node.scene.on(aR.PAUSE_TIME,this.handlePauseTime),this.node.scene.on(aR.RESUME_TIME,this.handleResumeTime),this.node.scene.on(aR.TIME_OUT,this.handleClockTimeout),this.node.scene.on(aR.HALF_TIME,this.handleHalfTime),this.node.scene.on(aR.RESCUE_START,this.handleStartRescue),this.node.scene.on(aR.RESCUE_FINISHED,this.handleFinishRescue),this.node.scene.on(aR.BOMB_EXPLODE,this.handleBombExplode),this.node.scene.on(aR.SHOW_HINT,this.handleShowHint),this.node.scene.on(aR.ADD_SCORE,this.handleAddScore),this.node.scene.on(aR.GRID_CLEAR,this.checkIfGameIsFinish),this.node.scene.on(aR.USE_ITEM,this.handleUseItem),this.node.scene.on(aR.ADD_ITEM,this.handleAddItem),this.node.scene.on(aR.AUTO_PLAY,this.handleAutoPlay),this.node.scene.on(aR.ADD_STARS,this.handleAddStars)}},{key:"listenFlowEvents",value:function(){this.node.scene.on(aR.INVITE_FRIENDS,this.handleInviteFriends)}},{key:"start",value:function(){this.initDataFirstTime(),this.initGame(),this.trySetTournamentStorage()}},{key:"initDataFirstTime",value:function(){var p=this.getSceneData(),v=(null!=p?p:{}).level;void 0===v&&(v=sx.getMatchMode()===yU.TOURNAMENT?1:0),this.initData(),this.setGameData({level:v})}},{key:"initData",value:function(){var p,v=null!==(p=yC.getGameData())&&void 0!==p?p:{},g=v.level,E=void 0===g?1:g,k=v.items;k&&this.checkItemsRewardable()&&(k.hint<5&&(k.hint+=1),k.thunder<5&&(k.thunder+=1),k.storm<5&&(k.storm+=1),k.pliers<5&&(k.pliers+=1),yC.setGameData({items:k,lastRewardedItems:Date.now()})),this.setGameData(we(we({},this.defaultData),{},{level:E}))}},{key:"checkItemsRewardable",value:function(){var p,v=(null!==(p=yC.getGameData())&&void 0!==p?p:{}).lastRewardedItems,g=void 0===v?0:v;return!yx.isToday(g)}},{key:"initGame",value:function(){this.stateManager.init(this),this.stateManager.initialize()}},{key:"trySetTournamentStorage",value:(v=Ee(function(){var p,v,g,E,k,C,_;return _ts_generator(this,function(A){switch(A.label){case 0:if(sx.getMatchMode()!==yU.TOURNAMENT)return[3,3];v=(null!==(p=sx.getMatchCustomData())&&void 0!==p?p:{}).leaderboardId;if(!v)return[3,3];return[4,ll.requestTournamentDataAsync()];case 1:A.sent();g=yD.getLeaderboardName(v);if(!g)return[3,3];return[4,yD.getLeadersByPlayerIdsAsync(g,[yC.getPlayerId()])];case 2:E=A.sent();if(0!==E.length){k=E[0],C=k.score,_=k.rank;yI.setStorageData("tournament","previousScore",C),yI.setStorageData("tournament","previousRank",_)}A.label=3;case 3:return[2]}})}),function(){return v.apply(this,arguments)})},{key:"setGameData",value:function(p){var v,g,E,k=null!==(v=null!==(g=p.level)&&void 0!==g?g:null===(E=this.gameData)||void 0===E?void 0:E.level)&&void 0!==v?v:1;this.gameData=we(we(we({},this.gameData),p),{},{level:k})}},{key:"getGameData",value:function(){return this.gameData}},{key:"getSceneData",value:function(){return sq.getSceneData(this.node.scene)}},{key:"attemptCallCreateShortcut",value:function(){var p,v=null!==(p=this.getGameData())&&void 0!==p?p:{},g=v.level,E=void 0===g?0:g,k=v.nextLevelCount;E<2||(void 0===k?0:k)<2||"checkAndCreateShortcutAsync"in GameSDK.extra&&GameSDK.extra.checkAndCreateShortcutAsync().catch(function(p){console.warn("checkAndCreateShortcutAsync",p)})}},{key:"processCrazyGamesGameplayStart",value:function(){"gameplayStart"in GameSDK.extra&&GameSDK.extra.gameplayStart()}},{key:"processCrazyGamesGameplayStop",value:function(){"gameplayStop"in GameSDK.extra&&GameSDK.extra.gameplayStop()}},{key:"disableRewardAdsItemForCrazyGames",value:function(){GameSDK.getSDKName()}}]),i}(L)).prototype,"board",[yu],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),yf=Ye(yd.prototype,"opacityToggler",[yc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),yy=Ye(yd.prototype,"pathDraw",[yh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),yd));g._RF.pop(),g._RF.push({},"c863f/bTTdAjqEM+Kj9OaKi","DashboardEventButtonTypes",void 0);var yj=function(p){return p[p.STAR_CHEST=0]="STAR_CHEST",p[p.BALLOON=1]="BALLOON",p}(yj||{});q(yj),g._RF.pop(),g._RF.push({},"17fa4eEXEhIfZh+ad9Oqcmw","Leaderboard",void 0);var yH=function(p){return p.WORLD_TAB_SELECTED="world-tab-selected",p.FRIENDS_TAB_SELECTED="friends-tab-selected",p}(yH||{}),yV="#AE4212",yq="#3D5172",yW="#92200C",yK="#8F5542",yX="#8A4733",yJ="#3e7110",yQ="#3e7110";g._RF.pop(),g._RF.push({},"4cd93d4ECxKDYSG9apAx603","LevelMission",void 0),g._RF.pop(),g._RF.push({},"78297LLtrJKMpOIidCw/BA9","index",void 0),g._RF.pop(),g._RF.push({},"176c3V0yoFEhIdpVcCIhDz7","isEmptyBoard",void 0),g._RF.pop(),g._RF.push({},"5262atLmldNy7Q3MtHgiSRI","HintItem",void 0);var yZ=E.ccclass,y$=globalThis.game,y0=y$.player,y1=y$.analytics,y2=GameCore.Plugins.Analytics.Events;yZ("HintItem")(function(p){Ie(i,p);var v,g=xe(i);function i(){var p;Ce(this,i);for(var v=arguments.length,E=new Array(v),k=0;k<v;k++)E[k]=arguments[k];return(p=g.call.apply(g,[this].concat(E))).requestItem=function(){s8.openScreen(nH.GET_ITEM_SCREEN,{item:oG.HINT,message:"Shows a pair of tiles\nthat can be connected.",quantity:1})},p.loadQuantity=function(){var p=y0.getGameData();return null!=p&&p.items&&p?p.items[oG.HINT]:0},p}return Ae(i,[{key:"itemType",get:function(){return oG.HINT}},{key:"init",value:function(p){this.boardInstance=p.board,this.pathDrawer=p.pathDraw,this.setQuantity(this.loadQuantity()),Fe(Pe(i.prototype),"init",this).call(this,p)}},{key:"onDestroy",value:function(){var p;if(this.boardInstance){this.node.scene.targetOff(this);var v,g=this.boardInstance.node;if(null!=g)this.boardInstance.node.targetOff(this),null===(p=Fe(Pe(i.prototype),"onDestroy",this))||void 0===p||p.call(this);else null===(v=Fe(Pe(i.prototype),"onDestroy",this))||void 0===v||v.call(this)}}},{key:"validateRequiredComponents",value:function(){Fe(Pe(i.prototype),"validateRequiredComponents",this).call(this),e7.lazyValidateProperties(this)}},{key:"canActivate",value:function(){try{return this.boardInstance.getUncleared().length>0}catch(p){return!1}}},{key:"activate",value:(v=Ee(function(){var p,v;return _ts_generator(this,function(g){switch(g.label){case 0:p=this.pathDrawer.isDrawingHint;if(p)return[3,5];if(!(this.getQuantity()<=0))return[3,2];return[4,Fe(Pe(i.prototype),"activate",this).call(this)];case 1:v=g.sent();return[3,4];case 2:return[4,Fe(Pe(i.prototype),"activate",this).call(this)];case 3:v=(g.sent(),y1.event(y2.USE_ITEM,{item_name:oG.HINT}),this.node.scene.emit(aR.USE_ITEM,oG.HINT),this.node.scene.emit(aR.SHOW_HINT));g.label=4;case 4:p=v;g.label=5;case 5:return[2]}})}),function(){return v.apply(this,arguments)})},{key:"saveQuantity",value:function(p,v){var g=arguments.length>0&&void 0!==p?p:this.getQuantity(),E=arguments.length>1?v:void 0;Fe(Pe(i.prototype),"saveQuantity",this).call(this,g,E);var k=y0.getGameData();k&&y0.setGameData({items:we(we({},k.items),{},Re({},oG.HINT,g))})}}]),i}(dQ));g._RF.pop(),g._RF.push({},"3f4c1AB+jdNFqylpogoaiDZ","PliersItem",void 0);var y4=E.ccclass,y3=globalThis.game,y5=y3.player,y6=y3.analytics,y9=GameCore.Plugins.Analytics.Events;y4("PliersItem")(function(p){Ie(i,p);var v,g=xe(i);function i(){var p;Ce(this,i);for(var v=arguments.length,E=new Array(v),k=0;k<v;k++)E[k]=arguments[k];return(p=g.call.apply(g,[this].concat(E))).requestItem=function(){s8.openScreen(nH.GET_ITEM_SCREEN,{item:oG.PLIERS,message:"Removes a random bomb\nfrom the game field.",quantity:1})},p.loadQuantity=function(){var p=y5.getGameData();return null!=p&&p.items&&p?p.items[oG.PLIERS]:0},p}return Ae(i,[{key:"itemType",get:function(){return oG.PLIERS}},{key:"init",value:function(p){this.boardInstance=p.board,this.effectManager=p.effectManager,Fe(Pe(i.prototype),"init",this).call(this,p)}},{key:"onDestroy",value:function(){var p;if(this.boardInstance){this.node.scene.targetOff(this);var v,g=this.boardInstance.node;if(null!=g)this.boardInstance.node.targetOff(this),null===(p=Fe(Pe(i.prototype),"onDestroy",this))||void 0===p||p.call(this);else null===(v=Fe(Pe(i.prototype),"onDestroy",this))||void 0===v||v.call(this)}}},{key:"validateRequiredComponents",value:function(){Fe(Pe(i.prototype),"validateRequiredComponents",this).call(this),e7.lazyValidateProperties(this)}},{key:"canActivate",value:function(){try{return this.boardInstance.getBombTiles().length>0}catch(p){return!1}}},{key:"activate",value:(v=Ee(function(){var p,v;return _ts_generator(this,function(g){switch(g.label){case 0:if(!(this.getQuantity()<=0))return[3,2];return[4,Fe(Pe(i.prototype),"activate",this).call(this)];case 1:g.sent();return[3,4];case 2:return[4,Fe(Pe(i.prototype),"activate",this).call(this)];case 3:g.sent(),y6.event(y9.USE_ITEM,{item_name:oG.PLIERS}),this.node.scene.emit(aR.USE_ITEM,oG.PLIERS);p=qc(this.boardInstance.getBombTiles()),v=p.node.worldPosition;this.effectManager.createDefuseExplosionAt(new ef(v.x,v.y,0)),nQ.playSound(nB.BOMB_DEFUSE),p.special.switch(lW.none),this.applyActivationStatus();g.label=4;case 4:return[2]}})}),function(){return v.apply(this,arguments)})},{key:"saveQuantity",value:function(p,v){var g=arguments.length>0&&void 0!==p?p:this.getQuantity(),E=arguments.length>1?v:void 0;Fe(Pe(i.prototype),"saveQuantity",this).call(this,g,E);var k=y5.getGameData();k&&y5.setGameData({items:we(we({},k.items),{},Re({},oG.PLIERS,g))})}}]),i}(dQ));g._RF.pop(),g._RF.push({},"d6e51+oy6NCF7cKvf6KOWiu","StormItem",void 0);var y8=E.ccclass,y7=globalThis.game,ve=y7.player,vt=y7.analytics,vn=GameCore.Plugins.Analytics.Events;y8("StormItem")(function(p){Ie(i,p);var v,g=xe(i);function i(){var p;Ce(this,i);for(var v=arguments.length,E=new Array(v),k=0;k<v;k++)E[k]=arguments[k];return(p=g.call.apply(g,[this].concat(E))).requestItem=function(){s8.openScreen(nH.GET_ITEM_SCREEN,{item:oG.STORM,message:"Randomly rearranges the \ntiles on the game field.",quantity:1})},p.loadQuantity=function(){var p=ve.getGameData();return null!=p&&p.items&&p?p.items[oG.STORM]:0},p}return Ae(i,[{key:"itemType",get:function(){return oG.STORM}},{key:"init",value:function(p){this.boardInstance=p.board,this.effectManager=p.effectManager,Fe(Pe(i.prototype),"init",this).call(this,p)}},{key:"onDestroy",value:function(){var p;if(this.boardInstance){this.node.scene.targetOff(this);var v,g=this.boardInstance.node;if(null!=g)this.boardInstance.node.targetOff(this),null===(p=Fe(Pe(i.prototype),"onDestroy",this))||void 0===p||p.call(this);else null===(v=Fe(Pe(i.prototype),"onDestroy",this))||void 0===v||v.call(this)}}},{key:"validateRequiredComponents",value:function(){Fe(Pe(i.prototype),"validateRequiredComponents",this).call(this),e7.lazyValidateProperties(this)}},{key:"canActivate",value:function(){try{return this.boardInstance.getUncleared().length>2}catch(p){return!1}}},{key:"activate",value:(v=Ee(function(){var p,v,g;return _ts_generator(this,function(E){switch(E.label){case 0:p=this;if(!(this.getQuantity()<=0))return[3,2];return[4,Fe(Pe(i.prototype),"activate",this).call(this)];case 1:E.sent();return[3,5];case 2:return[4,Fe(Pe(i.prototype),"activate",this).call(this)];case 3:E.sent(),vt.event(vn.USE_ITEM,{item_name:oG.STORM}),this.node.scene.emit(aR.USE_ITEM,oG.STORM),this.node.scene.emit(aR.HIDE_UI);v=new Promise(function(v){return p.scheduleOnce(v,.5)});return[4,Promise.race([this.effectManager.loadTornadoAnimation(),v])];case 4:E.sent();g=function(){var v=Ee(function(v,g){var E;return _ts_generator(this,function(k){switch(k.label){case 0:nQ.muteMusic(!0),nQ.playSound(nB.SHUFFLE_ITEM),nQ.playSound(nB.WIND);E=function(){var v=Ee(function(){return _ts_generator(this,function(v){switch(v.label){case 0:g.forEach(function(p,v,E){p.node.setSiblingIndex(g.asArray().length-1-(v+E*g.width))});return[4,Promise.all(g.map(function(v){return v.fly({getTilePosition:function(v){return Mc(g,p.boardInstance.getTileSize(),v)}})}))];case 1:v.sent();return[2]}})});return function(){return v.apply(this,arguments)}}();return[4,Promise.all(v.map(function(g,E,k){return g.sync({duration:.4,easing:"smooth",getTargetPosition:function(){return Mc(v,p.boardInstance.getTileSize(),{x:E,y:k},10)}})}))];case 1:k.sent(),p.effectManager.playTornadoAnimation();return[4,E()];case 2:k.sent(),p.node.scene.emit(aR.SHOW_UI),nQ.muteMusic(!1);return[2]}})});return function(p,g){return v.apply(this,arguments)}}();this.boardInstance.processShuffleRequest(g);E.label=5;case 5:return[2]}})}),function(){return v.apply(this,arguments)})},{key:"saveQuantity",value:function(p,v){var g=arguments.length>0&&void 0!==p?p:this.getQuantity(),E=arguments.length>1?v:void 0;Fe(Pe(i.prototype),"saveQuantity",this).call(this,g,E);var k=ve.getGameData();k&&ve.setGameData({items:we(we({},k.items),{},Re({},oG.STORM,g))})}}]),i}(dQ));g._RF.pop(),g._RF.push({},"b30ffJjU2lAH5yu2NkzVVnO","ThunderItem",void 0);var vi,va=E.ccclass,vr=globalThis.game,vo=vr.player,vs=vr.analytics,vl=GameCore.Plugins.Analytics.Events;va("ThunderItem")(function(p){Ie(i,p);var v,g=xe(i);function i(){var p;Ce(this,i);for(var v=arguments.length,E=new Array(v),k=0;k<v;k++)E[k]=arguments[k];return(p=g.call.apply(g,[this].concat(E))).requestItem=function(){s8.openScreen(nH.GET_ITEM_SCREEN,{item:oG.THUNDER,message:"Remove 2 pair of tiles\non the game field.",quantity:1})},p.loadQuantity=function(){var p=vo.getGameData();return null!=p&&p.items&&p?p.items[oG.THUNDER]:0},p}return Ae(i,[{key:"itemType",get:function(){return oG.THUNDER}},{key:"init",value:function(p){this.boardInstance=p.board,this.effectManager=p.effectManager,Fe(Pe(i.prototype),"init",this).call(this,p)}},{key:"onDestroy",value:function(){var p;if(this.boardInstance){this.node.scene.targetOff(this);var v,g=this.boardInstance.node;if(null!=g)this.boardInstance.node.targetOff(this),null===(p=Fe(Pe(i.prototype),"onDestroy",this))||void 0===p||p.call(this);else null===(v=Fe(Pe(i.prototype),"onDestroy",this))||void 0===v||v.call(this)}}},{key:"validateRequiredComponents",value:function(){Fe(Pe(i.prototype),"validateRequiredComponents",this).call(this),e7.lazyValidateProperties(this)}},{key:"canActivate",value:function(){try{return this.boardInstance.getUncleared().length>=4}catch(p){return!1}}},{key:"activate",value:(v=Ee(function(){var p,v;return _ts_generator(this,function(g){switch(g.label){case 0:if(!(this.getQuantity()<=0))return[3,2];return[4,Fe(Pe(i.prototype),"activate",this).call(this)];case 1:g.sent();return[3,6];case 2:return[4,Fe(Pe(i.prototype),"activate",this).call(this)];case 3:g.sent(),vs.event(vl.USE_ITEM,{item_name:oG.THUNDER}),this.node.scene.emit(aR.USE_ITEM,oG.THUNDER),this.node.scene.emit(aR.HIDE_UI);return[4,this.effectManager.loadThunderAnimation()];case 4:g.sent(),nQ.muteMusic(!0);p=this.boardInstance.getUncleared();if(p.length<4)throw new Error("Not enough uncleared tiles");v=this.boardInstance.getPairs(2);nP.setBlockInput(!0),this.boardInstance.clearSelectedTile();return[4,this.effectManager.playThunderAnimation(v,this.boardInstance)];case 5:g.sent(),p.length>4&&this.node.scene.emit(aR.SHOW_UI),nQ.muteMusic(!1),nP.setBlockInput(!1);g.label=6;case 6:return[2]}})}),function(){return v.apply(this,arguments)})},{key:"saveQuantity",value:function(p,v){var g=arguments.length>0&&void 0!==p?p:this.getQuantity(),E=arguments.length>1?v:void 0;Fe(Pe(i.prototype),"saveQuantity",this).call(this,g,E);var k=vo.getGameData();k&&vo.setGameData({items:we(we({},k.items),{},Re({},oG.THUNDER,g))})}}]),i}(dQ));g._RF.pop(),g._RF.push({},"0a97aK0agJOHb07cLs0JICj","PathHolder",void 0);var vu,vc,vd,vp,vf,vy,vv,vg,vm,vb,vw,vS,vE,vk=E.ccclass,vC=E.requireComponent;vk("PathHolder")(vi=vC(et)(vi=function(p){Ie(n,p);var v=xe(n);function n(){return Ce(this,n),v.apply(this,arguments)}return Ae(n,[{key:"onLoad",value:function(){var p=this;this.node.scene.on(aR.GRID_RESIZE,function(v){p.node.setScale(v,v)})}}]),n}(L))||vi);g._RF.pop(),g._RF.push({},"944cbG3+yRMsJZimXjukGdn","Coin",void 0);var v_,vA,vT,vI,vR,vP,vN,vD=E.ccclass,vL=E.property,vO=(vu=vD("Coin"),vc=vL(e_),vd=vL(e_),vp=vL(M),vf=vL(J),vy=vL(J),vu((vm=Ye((vg=function(p){Ie(n,p);var v=xe(n);function n(){var p;Ce(this,n);for(var g=arguments.length,E=new Array(g),k=0;k<g;k++)E[k]=arguments[k];return je(p=v.call.apply(v,[this].concat(E)),"explodeParticles",vm,Ne(p)),je(p,"emittingParticles",vb,Ne(p)),je(p,"animation",vw,Ne(p)),je(p,"spin",vS,Ne(p)),je(p,"rest",vE,Ne(p)),p}return Ae(n,[{key:"__preload",value:function(){e7.lazyValidateProperties(this)}},{key:"playAnimation",value:function(p,v){var g=this,E=arguments.length>0&&void 0!==p?p:0,k=arguments.length>1?v:void 0;E>0&&this.scheduleOnce(function(){null!=k&&k.aborted||g.animation.play(g.spin.name)},E),this.animation.play(this.spin.name)}},{key:"stopAnimation",value:function(){this.animation.play(this.rest.name)}}]),n}(L)).prototype,"explodeParticles",[vc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),vb=Ye(vg.prototype,"emittingParticles",[vd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),vw=Ye(vg.prototype,"animation",[vp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),vS=Ye(vg.prototype,"spin",[vf],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),vE=Ye(vg.prototype,"rest",[vy],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),vv=vg))||vv);g._RF.pop(),g._RF.push({},"0c6a8vx5IhFvKJ5IUimm0Je","CoinTextPopup",void 0);var vM,vx,vF,vB,vU,vz,vG,vY,vj,vH=E.ccclass,vV=E.property,vq=ef.ZERO.clone().add3f(0,-100,0),vW=ef.ZERO.clone().add3f(0,100,0),vK=GameCore.Utils.Number,vX=(v_=vH("CoinTextPopup"),vA=vV(I),vT=vV(et),v_((vP=Ye((vR=function(p){Ie(i,p);var v,g=xe(i);function i(){var p;Ce(this,i);for(var v=arguments.length,E=new Array(v),k=0;k<v;k++)E[k]=arguments[k];return je(p=g.call.apply(g,[this].concat(E)),"label",vP,Ne(p)),je(p,"uiOpacity",vN,Ne(p)),p}return Ae(i,[{key:"__preload",value:function(){e7.lazyValidateProperties(this),this.node.active=!1}},{key:"show",value:(v=Ee(function(p,v){var g;return _ts_generator(this,function(E){switch(E.label){case 0:g=vK.getShortNumber(p,3);this.label.string=g,this.node.active=!0,this.uiOpacity.opacity=255,this.node.setScale(.5,.5,.5),this.node.setPosition(vq);return[4,Promise.all([tJ.runTweenAsync(G(this.node).to(1.5,{position:vW},{easing:"sineOut"}),v),tJ.runTweenAsync(G(this.node).to(.5,{scale:ef.ONE},{easing:"backOut"}),v)])];case 1:E.sent(),this.node.setScale(ef.ONE),this.node.setPosition(vW);return[4,tJ.runTweenAsync(G(this.uiOpacity).to(.5,{opacity:0}))];case 2:E.sent(),this.node.active=!1;return[2]}})}),function(p,g){return v.apply(this,arguments)})}]),i}(L)).prototype,"label",[vA],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),vN=Ye(vR.prototype,"uiOpacity",[vT],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),vI=vR))||vI);g._RF.pop(),g._RF.push({},"8a5c3m7o41LNqGBKPo0oqf1","CoinManager",void 0);var vJ=E.ccclass,vQ=E.disallowMultiple,vZ=E.property,v$=globalThis.game,v0=v$.player,v1=v$.monitorError,v2=999999999,v4=10,v3=1,v5=1,v6=(vM=vJ("CoinManager"),vx=vZ(K),vF=vZ(K),vB=vZ(k),vM(vU=vQ((vG=Ye((vz=function(p){Ie(s,p);var v,g,E,k,C,_=xe(s);function s(){var p;Ce(this,s);for(var v=arguments.length,g=new Array(v),E=0;E<v;E++)g[E]=arguments[E];return(p=_.call.apply(_,[this].concat(g))).coins=0,je(p,"coinPrefab",vG,Ne(p)),je(p,"coinTextPopup",vY,Ne(p)),je(p,"coinAnimContainer",vj,Ne(p)),p.collectionAnimSignal=null,p.coinObjects=[],p}return Ae(s,[{key:"__preload",value:function(){this.lifeCycleSignal=new na,this.validateRequiredComponents(),this.getCoinsFromPlayerData()}},{key:"onLoad",value:function(){this.prepareCoinCollection(),this.prepareCoinTextPopup(),this.listenToCoinEvents()}},{key:"start",value:function(){this.emitCoinAmount()}},{key:"init",value:function(p){this.updateCoins({coins:this.coins,collectionAnimation:void 0}),this.animSkipOverlay=p}},{key:"listenToCoinEvents",value:function(){this.node.scene.on(aR.ADD_COINS,this.addCoins,this),this.node.scene.on(aR.REMOVE_COINS,this.removeCoins,this)}},{key:"validateRequiredComponents",value:function(){e7.lazyValidateProperties(this)}},{key:"prepareCoinCollection",value:function(){for(var p=0;p<v4;p++){var v=T(this.coinPrefab);v.setParent(this.coinAnimContainer),v.setPosition(0,0),v.active=!1,this.coinObjects.push(v.getComponent(vO))}}},{key:"prepareCoinTextPopup",value:function(){var p=T(this.coinTextPopup);p.setParent(this.node),p.active=!1,this.coinTextPopupNode=p.getComponent(vX)}},{key:"handleCollectionAnim",value:(C=Ee(function(p,v,g){var E,k,C,_,A,T;return _ts_generator(this,function(I){switch(I.label){case 0:C=this;if(!this.targetContainer)return[3,4];_=this.coinObjects.slice(0,this.getShortAmount(p));if(0===_.length)return[2,(console.warn("Requested coins amount is ".concat(p,". Shortened to ").concat(this.getShortAmount(p),". No coin objects was found to animate collection.")),void(null==v1||v1.sendException(new Error("Requested coins amount is ".concat(p,". Shortened to ").concat(this.getShortAmount(p),". No coin objects was found to animate collection.")),{coins:p,animatedCoins:_.length,hasCoinTextPopup:!!this.coinTextPopupNode,hasTargetContainer:!!this.targetContainer,coinCollectionCount:this.coinObjects.length})))];return[4,null===(E=this.animSkipOverlay)||void 0===E?void 0:E.open({onSkip:function(){return C.collectionAnimSignal.abort()},opacity:150})];case 1:I.sent(),nQ.playSound(nB.COLLECT_STOCK_COINS);A=_.map(function(){var p=Ee(function(p){var E,k,_,A;return _ts_generator(this,function(T){switch(T.label){case 0:p.explodeParticles.stopSystem(),p.emittingParticles.stopSystem(),p.node.active=!0;E=[0,.5*Math.min(v,g)],k=ek.apply(void 0,E),_=v-k,A=g+k;return[4,C.animateCoinExplode(p.node,_)];case 1:T.sent(),p.playAnimation(2*k,C.collectionAnimSignal),p.emittingParticles.resetSystem();return[4,C.animateCoinFlyBack(C.collectionAnimSignal,p,A)];case 2:T.sent(),p.emittingParticles.stopSystem(),p.stopAnimation();return[2]}})});return function(v){return p.apply(this,arguments)}}()),T=function(){var p=Ee(function(){var p;return _ts_generator(this,function(v){switch(v.label){case 0:return[4,Promise.all(A)];case 1:v.sent();return[4,null===(p=C.targetContainer)||void 0===p?void 0:p.emitExplodeEffect(C.collectionAnimSignal)];case 2:v.sent();return[2]}})});return function(){return p.apply(this,arguments)}}();return[4,Promise.all([T(),this.animateCoinTextPopup(p,this.collectionAnimSignal,v+g/2)])];case 2:I.sent();return[4,null===(k=this.animSkipOverlay)||void 0===k?void 0:k.close()];case 3:I.sent(),this.collectionAnimSignal.abort();return[3,5];case 4:console.warn("No target coin container assigned to CoinManager. No coin collection animation will be played");I.label=5;case 5:return[2]}})}),function(p,v,g){return C.apply(this,arguments)})},{key:"animateCoinTextPopup",value:(k=Ee(function(p,v,g){return _ts_generator(this,function(E){switch(E.label){case 0:return[4,tJ.waitTweenAsync(g,v)];case 1:E.sent();return[4,this.coinTextPopupNode.show(p,v)];case 2:E.sent();return[2]}})}),function(p,v,g){return k.apply(this,arguments)})},{key:"animateCoinFlyBack",value:(E=Ee(function(p,v,g){var E,k,C,_;return _ts_generator(this,function(A){switch(A.label){case 0:E=this,k=v.node.worldPosition.clone(),C=ef.ZERO.clone(),_=this.targetContainer.getCoinIconWorldScale();return[4,tJ.runTweenAsync(G(v.node).to(g,{scale:_},{onUpdate:function(p,g){if(void 0!==g){var _=ee.cubicIn(g),A=E.targetContainer.getCoinIconWorldPosition();v.node.worldPosition=ef.lerp(C,k,A,_)}}}),p)];case 1:A.sent(),v.node.scale=ef.ZERO,this.explodeParticlesAndDisableAfter(1,v);return[2]}})}),function(p,v,g){return E.apply(this,arguments)})},{key:"explodeParticlesAndDisableAfter",value:(g=Ee(function(p,v){var g,E;return _ts_generator(this,function(k){switch(k.label){case 0:g=v.explodeParticles;g.resetSystem();return[4,tJ.waitTweenAsync(p/10,this.lifeCycleSignal)];case 1:k.sent();E=na.hasBeenAborted(this.lifeCycleSignal);if(E)return[3,3];g.stopSystem();return[4,tJ.waitTweenAsync(p/10*9,this.lifeCycleSignal)];case 2:E=(k.sent(),na.hasBeenAborted(this.lifeCycleSignal)||(v.node.setPosition(0,0,v.node.position.z),v.node.active=!1));k.label=3;case 3:return[2]}})}),function(p,v){return g.apply(this,arguments)})},{key:"animateCoinExplode",value:(v=Ee(function(p,v){var g,E,k,C,_;return _ts_generator(this,function(A){switch(A.label){case 0:g=[-200,200],E=[-200,200],k=ek(g[0],g[1]),C=ek(E[0],E[1]);p.setPosition(0,0,p.position.z),p.setScale(ef.ZERO);_=new ef(k,C,p.position.z);return[4,Promise.all([tJ.runTweenAsync(G(p).delay(.1*v).to(.8*v,{scale:ef.ONE},{easing:"elasticOut"}),this.collectionAnimSignal),tJ.runTweenAsync(G(p).to(v,{position:_},{easing:"circOut"}),this.collectionAnimSignal)])];case 1:A.sent();return[2]}})}),function(p,g){return v.apply(this,arguments)})},{key:"getCoinsFromPlayerData",value:function(){var p=v0.getGameData();this.coins=p?p.coins:0}},{key:"getCoins",value:function(){return this.coins}},{key:"updateCoins",value:function(p){var v,g;if(console.info("updateCoins",p.coins,null===(v=p.collectionAnimation)||void 0===v?void 0:v.animateTextOnly),this.coins>v2&&(this.coins=v2),p.coins!==this.coins){var E=Math.max(0,p.coins-this.coins);this.coins=p.coins,v0.setGameData({coins:this.coins});var k=p.collectionAnimation;if(void 0===k||k.animateTextOnly)this.node.scene.emit(aR.COIN_CHANGED,we(we({},p),{},{collectionAnimation:{animateTextOnly:!0,signal:this.collectionAnimSignal}}));else{null===(g=this.collectionAnimSignal)||void 0===g||g.abort();var C=k.floatDuration,_=void 0===C?v3:C,A=k.flyDuration,T=void 0===A?v5:A,I=k.signal,R=void 0===I?new na:I,P=k.target,N=void 0===P?this.targetContainer:P;this.collectionAnimSignal=R,this.targetContainer=N;var D=we(we({},p),{},{collectionAnimation:{floatDuration:_,flyDuration:T,animateTextOnly:!1,signal:R,target:N}});this.node.scene.emit(aR.COIN_CHANGED,D),this.handleCollectionAnim(E,_,T)}}}},{key:"addCoins",value:function(p){this.updateCoins(we(we({},p),{},{coins:this.coins+p.coins}))}},{key:"removeCoins",value:function(p){this.coins<p.coins?this.node.scene.emit(aR.REMOVE_COINS_FAILED):(this.updateCoins(we(we({},p),{},{coins:this.coins-p.coins})),this.node.scene.emit(aR.REMOVE_COINS_SUCCESS))}},{key:"emitCoinAmount",value:function(){this.node.scene.emit(aR.COIN_CHANGED,{coins:this.coins})}},{key:"getShortAmount",value:function(p){return Math.min(p,v4)}},{key:"untilFinishesCollectAnim",value:function(){return null===this.collectionAnimSignal?Promise.resolve():this.collectionAnimSignal.untilAborted()}},{key:"setTargetContainer",value:function(p){this.targetContainer=p}},{key:"getTargetContainer",value:function(){return this.targetContainer}},{key:"onDestroy",value:function(){var p,v;null===(p=this.collectionAnimSignal)||void 0===p||p.abort(),null===(v=this.lifeCycleSignal)||void 0===v||v.abort()}}]),s}(L)).prototype,"coinPrefab",[vx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),vY=Ye(vz.prototype,"coinTextPopup",[vF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),vj=Ye(vz.prototype,"coinAnimContainer",[vB],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),vU=vz))||vU)||vU);g._RF.pop(),g._RF.push({},"d2a57+mB4NG9rcdh+dy1VPe","traverse4",void 0),g._RF.pop(),g._RF.push({},"ca614iJ+X5LrL1rX/wDQDTD","shuffle",void 0),g._RF.pop(),g._RF.push({},"1cf4cygDSdP5JL+7w3wIJL7","traverseRandom",void 0),g._RF.pop(),g._RF.push({},"1faa9NgJrBE7p8Zs/HBWrZn","pad",void 0),g._RF.pop(),g._RF.push({},"f3b1eQ+t3FJYa35I0oznLiF","ParticleProperties",void 0);var v9,v8,v7,ge,gt,gn=Ae(function e(){Ce(this,e),this.lifeCurrent=0,this.life=0,this.velocityX=0,this.velocityY=0,this.alpha=255,this.totalRotation=0,this.lastChange=0,this.currentFrame=0});g._RF.pop(),g._RF.push({},"32b8eGxcghFHZOi1WYXHCjF","BaseParticle",void 0);var gi,ga,gr,go,gs,gl,gu,gc=E.ccclass,gh=E.property,gd=(v9=gc("BaseParticle"),v8=gh(V),v9((gt=Ye((ge=function(p){Ie(n,p);var v=xe(n);function n(){var p;Ce(this,n);for(var g=arguments.length,E=new Array(g),k=0;k<g;k++)E[k]=arguments[k];return je(p=v.call.apply(v,[this].concat(E)),"sprite",gt,Ne(p)),p.properties=new gn,p}return Ae(n,[{key:"__preload",value:function(){this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){if(!this.sprite)throw new Error("BaseParticle: Sprite not found")}},{key:"manualInit",value:function(p,v){this.manager=p;var g=v.tint,E=v.velocityX,k=v.velocityY,_=v.totalRotation,A=v.lifespan,T=v.startAngle,I=v.scale;this.properties.lastChange=0;var R=new C;C.fromHEX(R,g),this.sprite.color=R,this.properties.velocityX=E,this.properties.velocityY=k,this.properties.life=A,this.properties.lifeCurrent=A,this.properties.totalRotation=_,this.node.angle=T,this.node.setScale(I,I,1)}},{key:"manualUpdate",value:function(p){return this.computeVelocity(p),this.node.setPosition(this.node.position.x+this.properties.velocityX*p,this.node.position.y+this.properties.velocityY*p,0),this.node.angle+=this.properties.totalRotation*p/this.properties.life,this.properties.lifeCurrent-=p,this.properties.lifeCurrent<=0}},{key:"computeVelocity",value:function(p){var v=this.properties,g=v.velocityX,E=v.velocityY;E+=this.manager.getGravityY()*p,this.properties.velocityX=g,this.properties.velocityY=E}}]),n}(L)).prototype,"sprite",[v8],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),v7=ge))||v7);g._RF.pop(),g._RF.push({},"b6123+a2K1LoY60oZO9SYKX","StarConfetti",void 0);var gp=E.ccclass,gf=E.property,gy=(gi=gp("StarConfetti"),ga=gf([Z]),gr=gf([Z]),gi((gl=Ye((gs=function(p){Ie(n,p);var v=xe(n);function n(){var p;Ce(this,n);for(var g=arguments.length,E=new Array(g),k=0;k<g;k++)E[k]=arguments[k];return je(p=v.call.apply(v,[this].concat(E)),"starXFrames",gl,Ne(p)),je(p,"starYFrames",gu,Ne(p)),p.msPerFrame=.15,p.isYoyo=!1,p.isGravityChanged=!1,p}return Ae(n,[{key:"manualInit",value:function(p,v){Fe(Pe(n.prototype),"manualInit",this).call(this,p,v),this.msPerFrame=.15,this.isYoyo=!1,this.isGravityChanged=!1}},{key:"manualUpdate",value:function(p){var v=Fe(Pe(n.prototype),"manualUpdate",this).call(this,p);return this.updateGravity(),this.updateVelocity(),this.updateFrameRate(),this.updateFrames(p),v}},{key:"updateGravity",value:function(){if(!(this.properties.lifeCurrent>this.properties.life-2||this.isGravityChanged)){this.isGravityChanged=!0;this.properties.velocityX/=3,this.manager.setGravityY(-23745/667)}}},{key:"updateVelocity",value:function(){if(!(this.properties.lifeCurrent>this.properties.life-2))this.properties.velocityX>0?this.properties.velocityX+=ea.randomRangeInt(-12,6):this.properties.velocityX+=ea.randomRangeInt(-6,12)}},{key:"updateFrames",value:function(p){if(this.properties.lastChange+=p,this.properties.lastChange>=this.msPerFrame){this.isYoyo?this.properties.currentFrame--:this.properties.currentFrame++,this.properties.currentFrame<0&&(this.isYoyo=!1,this.properties.currentFrame=1),this.properties.currentFrame>=4&&(this.isYoyo=!0,this.properties.currentFrame-=1);var v=Math.random()>.5?this.starXFrames:this.starYFrames;this.sprite.spriteFrame=v[this.properties.currentFrame],this.properties.lastChange-=this.msPerFrame}}},{key:"updateFrameRate",value:function(){this.properties.lifeCurrent<this.properties.life-2?this.msPerFrame=.15:this.msPerFrame=ea.randomRangeInt(300,600)/1e3}}]),n}(gd)).prototype,"starXFrames",[ga],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),gu=Ye(gs.prototype,"starYFrames",[gr],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),go=gs))||go);g._RF.pop(),g._RF.push({},"9caadUsaKtPEoOe+T2+pqtd","Properties",void 0);var gv,gg=Ae(function e(){Ce(this,e),this.delay=200,this.timeScale=2,this.tints=["#F1D171","#97E1FD","#7765D1","#ED4440","#F9E02A"],this.speedX={min:1583/75,max:1583*.24},this.speedY={min:1139.76,max:1219.76},this.gravityY=-664.86,this.lifespan={min:5,max:8},this.rotate={totalRotation:1080,random:!0},this.scale={min:.6,max:1},this.originGravityY=-664.86});g._RF.pop(),g._RF.push({},"d1648PsavVBn7B059PS5fj6","BaseEmitter",void 0);var gm,gb=(0,E.ccclass)("BaseEmitter")(gv=function(p){Ie(n,p);var v=xe(n);function n(){var p;Ce(this,n);for(var g=arguments.length,E=new Array(g),k=0;k<g;k++)E[k]=arguments[k];return(p=v.call.apply(v,[this].concat(E))).properties=new gg,p}return Ae(n,[{key:"getGravityY",value:function(){return this.properties.gravityY}},{key:"setGravityY",value:function(p){this.properties.gravityY=p}}]),n}(L))||gv;g._RF.pop(),g._RF.push({},"654983p4rREVKci1CE8cSJ2","ConfettiEmitter",void 0);var gw,gS,gE,gk,gC,g_,gA,gT,gI,gR,gP,gN=(0,E.ccclass)("ConfettiEmitter")(gm=function(p){Ie(a,p);var v,g,E=xe(a);function a(){var p;Ce(this,a);for(var v=arguments.length,g=new Array(v),k=0;k<v;k++)g[k]=arguments[k];return(p=E.call.apply(E,[this].concat(g))).activeStarConfetti=[],p}return Ae(a,[{key:"__preload",value:function(){this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){e7.lazyValidateProperties(this)}},{key:"createConfettiPool",value:(g=Ee(function(){var p,v;return _ts_generator(this,function(g){switch(g.label){case 0:p=this;v=this;return[4,nP.loadPrefabAsync("particles/StarConfetti")];case 1:v.starConfettiPrefab=g.sent(),this.starConfettiPool=new uD(function(){var v=T(p.starConfettiPrefab);return p.node.addChild(v),v.active=!1,v},0,function(v){var g=v.getComponent(gy);g?(p.activeStarConfetti.push(g),v.active=!0):console.error("StarConfetti not found")},function(p){p.getComponent(gy)?p.active=!1:console.error("StarConfetti not found")},function(p){p.isValid&&p.destroy()}),this.properties.timeScale=1.5,this.properties.gravityY=688.605,this.properties.lifespan.min=4,this.properties.lifespan.max=6,this.properties.rotate.totalRotation=1800;return[2]}})}),function(){return g.apply(this,arguments)})},{key:"runEffect",value:(v=Ee(function(p,v,g){var E,k,C,_,A,T,I,R,P,N,D,L,O;return _ts_generator(this,function(M){switch(M.label){case 0:E=this.starConfettiPool;if(E)return[3,2];return[4,this.createConfettiPool()];case 1:E=M.sent();M.label=2;case 2:this.properties.gravityY=this.properties.originGravityY;for(k=0;k<p;k++){C=this.starConfettiPool.alloc(),_=C.getComponent(gy);if(!_)return[2,void console.error("StarConfetti not found")];C.setPosition(v.clone());A=this.properties.tints[Math.floor(Math.random()*this.properties.tints.length)],T=Math.random()*(this.properties.speedX.max-this.properties.speedX.min),I=Math.random()*(this.properties.speedY.max-this.properties.speedY.min)+this.properties.speedY.min,R=Math.random()*(this.properties.lifespan.max-this.properties.lifespan.min)+this.properties.lifespan.min,P=this.properties.rotate.random?180*Math.random():0,N=Math.random()*(this.properties.scale.max-this.properties.scale.min)+this.properties.scale.min,D={tint:A,velocityX:T,velocityY:I,lifespan:R,totalRotation:this.properties.rotate.totalRotation,startAngle:P,scale:N};_.manualInit(this,D);L=this.starConfettiPool.alloc(),O=L.getComponent(gy);if(!O)return[2,void console.error("StarConfetti not found")];L.setPosition(g.clone()),D.velocityX=-T,O.manualInit(this,D)}return[2]}})}),function(p,g,E){return v.apply(this,arguments)})},{key:"clearEffect",value:function(){var p,v=We(this.activeStarConfetti);try{for(v.s();!(p=v.n()).done;){var g=p.value;this.starConfettiPool.free(g.node)}}catch(p){v.e(p)}finally{v.f()}this.activeStarConfetti=[]}},{key:"update",value:function(p){var v=this,g=p*this.properties.timeScale,E=[];this.activeStarConfetti.forEach(function(p){p.manualUpdate(g)&&E.push(p)}),E.forEach(function(p){v.starConfettiPool.free(p.node),v.activeStarConfetti.splice(v.activeStarConfetti.indexOf(p),1)})}}]),a}(gb))||gm;g._RF.pop(),g._RF.push({},"78c97IkjeJFQohPZudvcfeS","Ribbon",void 0);var gD,gL,gO,gM,gx,gF=E.ccclass,gB=E.property,gU=GameCore.Utils.Array,gz=(gw=gF("Ribbon"),gS=gB([Z]),gE=gB([Z]),gk=gB([Z]),gC=gB([Z]),gw((gT=Ye((gA=function(p){Ie(n,p);var v=xe(n);function n(){var p;Ce(this,n);for(var g=arguments.length,E=new Array(g),k=0;k<g;k++)E[k]=arguments[k];return je(p=v.call.apply(v,[this].concat(E)),"ribbonA",gT,Ne(p)),je(p,"ribbonB",gI,Ne(p)),je(p,"ribbonC",gR,Ne(p)),je(p,"ribbonD",gP,Ne(p)),p.useFrames=[],p.msPerFrame=.15,p.isYoyo=!1,p.isGravityChanged=!1,p.points=[],p}return Ae(n,[{key:"manualInit",value:function(p,v){Fe(Pe(n.prototype),"manualInit",this).call(this,p,v),this.msPerFrame=.15,this.isYoyo=!1,this.isGravityChanged=!1,this.points=gU.fillWith(10,function(){return{x:0,y:0}});var g=Math.random();this.useFrames=g<.25?this.ribbonA:g<.5?this.ribbonB:g<.75?this.ribbonC:this.ribbonD,this.sprite.enabled=!1}},{key:"manualUpdate",value:function(p){var v=Fe(Pe(n.prototype),"manualUpdate",this).call(this,p);return this.updateFrames(p),this.updatePoints(),this.updateGravity(),this.updateVelocity(),v}},{key:"updateFrames",value:function(p){this.properties.lastChange+=p,this.properties.lastChange>=this.msPerFrame&&(this.isYoyo?this.properties.currentFrame--:this.properties.currentFrame++,this.properties.currentFrame<0&&(this.isYoyo=!1,this.properties.currentFrame=1),this.properties.currentFrame>=this.useFrames.length&&(this.isYoyo=!0,this.properties.currentFrame-=1),this.sprite.spriteFrame=this.useFrames[this.properties.currentFrame],this.properties.lastChange-=this.msPerFrame)}},{key:"updatePoints",value:function(){if(!this.isGravityChanged){this.points.shift();var p=this.node.worldPosition,v=p.x,g=p.y;this.points.push({x:v,y:g})}}},{key:"updateGravity",value:function(){if(!(this.properties.lifeCurrent>this.properties.life-2||this.isGravityChanged)){this.isGravityChanged=!0,this.points=[],this.sprite.enabled=!0,this.properties.velocityX/=3;this.manager.setGravityY(-23745/667)}}},{key:"updateVelocity",value:function(){if(!this.isGravityChanged)this.properties.lifeCurrent>this.properties.life-1.8?this.properties.velocityX+=ea.randomRangeInt(-24,24):this.properties.velocityX>0?this.properties.velocityX+=ea.randomRangeInt(-20,12):this.properties.velocityX+=ea.randomRangeInt(-12,20)}},{key:"getGlobalPoints",value:function(){return this.points}},{key:"getColor",value:function(){return this.sprite.color}}]),n}(gd)).prototype,"ribbonA",[gS],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),gI=Ye(gA.prototype,"ribbonB",[gE],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),gR=Ye(gA.prototype,"ribbonC",[gk],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),gP=Ye(gA.prototype,"ribbonD",[gC],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),g_=gA))||g_);g._RF.pop(),g._RF.push({},"f2427J2HhBKdpkcqDn2Vv5H","RibbonEmitter",void 0);var gG,gY,gj,gH,gV,gq,gW,gK=E.ccclass,gX=E.property,gJ=(gD=gK("RibbonEmitter"),gL=gX(eu),gD((gx=Ye((gM=function(p){Ie(a,p);var v,g,E=xe(a);function a(){var p;Ce(this,a);for(var v=arguments.length,g=new Array(v),k=0;k<v;k++)g[k]=arguments[k];return je(p=E.call.apply(E,[this].concat(g)),"graphics",gx,Ne(p)),p.activeRibbonConfetti=[],p}return Ae(a,[{key:"__preload",value:function(){this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){e7.lazyValidateProperties(this)}},{key:"createConfettiPool",value:(g=Ee(function(){var p,v;return _ts_generator(this,function(g){switch(g.label){case 0:p=this;v=this;return[4,nP.loadPrefabAsync("particles/Ribbon")];case 1:v.ribbonPrefab=g.sent(),this.ribbonConfettiPool=new uD(function(){var v=T(p.ribbonPrefab);return p.node.addChild(v),v.active=!1,v},0,function(v){var g=v.getComponent(gz);g?(p.activeRibbonConfetti.push(g),v.active=!0):console.error("StarConfetti not found")},function(p){p.getComponent(gz)?p.active=!1:console.error("StarConfetti not found")},function(p){p.destroy()});return[2]}})}),function(){return g.apply(this,arguments)})},{key:"runEffect",value:(v=Ee(function(p,v,g){var E,k,C,_,A,T,I,R,P,N,D,L,O;return _ts_generator(this,function(M){switch(M.label){case 0:E=this.ribbonConfettiPool;if(E)return[3,2];return[4,this.createConfettiPool()];case 1:E=M.sent();M.label=2;case 2:this.properties.gravityY=this.properties.originGravityY;for(k=0;k<p;k++){C=this.ribbonConfettiPool.alloc(),_=C.getComponent(gz);if(!_)return[2,void console.error("StarConfetti not found")];C.setPosition(v.clone());A=this.properties.tints[Math.floor(Math.random()*this.properties.tints.length)],T=Math.random()*(this.properties.speedX.max-this.properties.speedX.min),I=Math.random()*(this.properties.speedY.max-this.properties.speedY.min)+this.properties.speedY.min,R=Math.random()*(this.properties.lifespan.max-this.properties.lifespan.min)+this.properties.lifespan.min,P=this.properties.rotate.random?180*Math.random():0,N=Math.random()*(this.properties.scale.max-this.properties.scale.min)+this.properties.scale.min,D={tint:A,velocityX:T,velocityY:I,lifespan:R,totalRotation:this.properties.rotate.totalRotation,startAngle:P,scale:N};_.manualInit(this,D);L=this.ribbonConfettiPool.alloc(),O=L.getComponent(gz);if(!O)return[2,void console.error("StarConfetti not found")];L.setPosition(g.clone()),D.velocityX=-T,O.manualInit(this,D)}return[2]}})}),function(p,g,E){return v.apply(this,arguments)})},{key:"clearEffect",value:function(){var p,v=We(this.activeRibbonConfetti);try{for(v.s();!(p=v.n()).done;){var g=p.value;this.ribbonConfettiPool.free(g.node)}}catch(p){v.e(p)}finally{v.f()}this.activeRibbonConfetti=[]}},{key:"update",value:function(p){var v=this,g=p*this.properties.timeScale;this.graphics.clear();var E=[];this.activeRibbonConfetti.forEach(function(p){p.manualUpdate(g)&&E.push(p),v.drawGraphics(p.getGlobalPoints(),p.getColor())}),E.forEach(function(p){v.ribbonConfettiPool.free(p.node),v.activeRibbonConfetti.splice(v.activeRibbonConfetti.indexOf(p),1)})}},{key:"drawGraphics",value:function(p,v){if(this.graphics.node.active){var g,E=We(p);try{for(E.s();!(g=E.n()).done;)if(0===g.value.y)return}catch(p){E.e(p)}finally{E.f()}if(!(p.length<2)){this.graphics.strokeColor=v;var k=new ef(p[0].x,p[0].y,0);k=this.node.inverseTransformPoint(k,k),this.graphics.moveTo(k.x,k.y);for(var C=1;C<p.length;C++)k.x=p[C].x,k.y=p[C].y,k=this.node.inverseTransformPoint(k,k),this.graphics.lineTo(k.x,k.y);this.graphics.stroke()}}}}]),a}(gb)).prototype,"graphics",[gL],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),gO=gM))||gO);g._RF.pop(),g._RF.push({},"f7cfcFAL8tBE70g2A0+qMTR","PaperConfetti",void 0);var gQ,gZ=E.ccclass,g$=E.property,g0=(gG=gZ("PaperConfetti"),gY=g$(gN),gj=g$(gJ),gG((gq=Ye((gV=function(p){Ie(n,p);var v=xe(n);function n(){var p;Ce(this,n);for(var g=arguments.length,E=new Array(g),k=0;k<g;k++)E[k]=arguments[k];return(p=v.call.apply(v,[this].concat(E))).spawnLeftPos=new ef(-375,-791.5,0),p.spawnRightPos=new ef(375,-791.5,0),je(p,"confettiEmitter",gq,Ne(p)),je(p,"ribbonEmitter",gW,Ne(p)),p}return Ae(n,[{key:"__preload",value:function(){this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){if(!this.confettiEmitter)throw new Error("PaperConfetti: ConfettiEmitter not found");if(!this.ribbonEmitter)throw new Error("PaperConfetti: RibbonEmitter not found")}},{key:"runEffect",value:function(){var p=this;this.scheduleOnce(function(){p.confettiEmitter.runEffect(25,p.spawnLeftPos,p.spawnRightPos)},.2),this.ribbonEmitter.runEffect(20,this.spawnLeftPos,this.spawnRightPos)}},{key:"clearEffect",value:function(){this.unscheduleAllCallbacks(),this.confettiEmitter.clearEffect(),this.ribbonEmitter.clearEffect()}}]),n}(L)).prototype,"confettiEmitter",[gY],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),gW=Ye(gV.prototype,"ribbonEmitter",[gj],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),gH=gV))||gH);g._RF.pop(),g._RF.push({},"4a9beTdMntC0q9yngb8a2go","BootScene",void 0);var g1,g2,g4,g3,g5,g6,g9,g8,g7,me,mt,mn=E.ccclass,mi=E.disallowMultiple,ma=GameCore,mr=ma.Events,mo=ma.Configs,ms=ma.Utils,ml=ms.Time,mu=ms.Valid,mc=globalThis.game,md=mc.ads,mp=mc.player,mf=mc.event;mn("BootScene")(gQ=mi(gQ=function(p){Ie(i,p);var v,g=xe(i);function i(){var p;Ce(this,i);for(var v=arguments.length,E=new Array(v),k=0;k<v;k++)E[k]=arguments[k];return(p=g.call.apply(g,[this].concat(E))).processWhenGameSdkStarted=function(){p.setupGameData()},p.processPreloadAssets=function(){p.loadCurrentPlayerTheme().catch(function(p){return console.error("loadCurrentPlayerTheme",p)})},p.handleShowAdWhenLoadGame=Ee(function(){var v,g,E,k,C,_,A,T,I;return _ts_generator(this,function(R){switch(R.label){case 0:v=mo.Ads,g=v.Enabled,E=v.ShowAdOnLoad;if(!g)return[3,7];k=E.Enabled,C=E.DelaySeconds,_=E.PlacementId;if(!k)return[3,7];R.label=1;case 1:R.trys.push([1,5,6,7]);A=C>0;if(!A)return[3,3];return[4,ml.sleepAsync(1e3*C)];case 2:A=R.sent();R.label=3;case 3:T=md.getAdByPlacementId(_);if(!T)return[2];return[4,p.showAdWhenLoadGame(T)];case 4:R.sent();return[3,7];case 5:I=R.sent();console.warn("handleShowAdWhenLoadGame failed",I);return[3,7];case 6:po.preloadAds();return[7];case 7:return[2]}})}),p.handlePauseAudio=function(){mf.on(mr.VISIBILITY_HIDDEN,p.handleMuteAudio),mf.on(mr.VISIBILITY_VISIBLE,p.handleUnMuteAudio),mf.on(mr.VISIBILITY_VISIBLE,p.handleForceEngineRunning)},p.handleMuteAudio=function(){nQ.muteAudio(!0)},p.handleUnMuteAudio=function(){md.isAdFullSizeShowing()||nQ.muteAudio(!1)},p.handleForceEngineRunning=function(){D.resume()},p}return Ae(i,[{key:"__preload",value:function(){this.setupAndroidPlatformAds(),this.processCrazyGamesLoadingStart(),this.validateRequiredComponents(),this.listenEvents()}},{key:"validateRequiredComponents",value:function(){e7.lazyValidateProperties(this)}},{key:"onLoad",value:function(){this.handlePauseAudio(),this.processPreloadAssets(),mo.Core.StartSDKAfterLoadGame||s8.showLoadingFullScreen(o6)}},{key:"start",value:function(){this.processCrazyGamesLoadingStop()}},{key:"listenEvents",value:function(){mf.once(mr.GAME_SDK_STARTED,this.processWhenGameSdkStarted),mf.once(mr.GAME_READY,this.handleShowAdWhenLoadGame)}},{key:"setupGameData",value:function(){var p=mp.getGameData();if(p){var v=p.totalLevel,g=we(we({},p),{},{totalLevel:0===v?80:v});mp.setGameData(g)}}},{key:"loadCurrentPlayerTheme",value:function(){var p=su.mapOrder,v=p[0],g=mp.getGameData();console.log("loadCurrentPlayerTheme",g);var E=null==g?void 0:g.level;if(!mu.isNumber(E))return nP.loadThemeAsync(v.theme);var k,C=We(p);try{for(C.s();!(k=C.n()).done;){var _=k.value;if((E-=_.levelCount)<=0){v=_;break}}}catch(p){C.e(p)}finally{C.f()}return nP.loadThemeAsync(v.theme)}},{key:"showAdWhenLoadGame",value:(v=Ee(function(p){var v,g,E;return _ts_generator(this,function(k){switch(k.label){case 0:k.trys.push([0,3,4,5]);v=p.type,g=p.placementId;return[4,md.loadAdAsync(v,g)];case 1:k.sent(),nQ.muteAudio(!0);return[4,md.showAdAsync(v,g)];case 2:k.sent();return[3,5];case 3:E=k.sent();console.warn("showAdWhenLoadGame failed",E);return[3,5];case 4:nQ.muteAudio(!1);return[7];case 5:return[2]}})}),function(p){return v.apply(this,arguments)})},{key:"processCrazyGamesLoadingStart",value:function(){"gameLoadingStart"in GameSDK.extra&&GameSDK.extra.gameLoadingStart()}},{key:"processCrazyGamesLoadingStop",value:function(){"gameLoadingStop"in GameSDK.extra&&GameSDK.extra.gameLoadingStop()}},{key:"setupAndroidPlatformAds",value:function(){}}]),i}(L))||gQ);g._RF.pop(),g._RF.push({},"29f874DL75LO5NzzNYZvHDh","RigidBodyObject",void 0);var my,mv,mg,mm,mb,mw,mS,mE,mk,mC=E.ccclass,m_=E.property,mA=(g1=mC("RigidBodyObject"),g2=m_(Y),g4=m_(eg),g3=m_(Y),g5=m_(es),g1((g8=Ye((g9=function(p){Ie(n,p);var v=xe(n);function n(){var p;Ce(this,n);for(var g=arguments.length,E=new Array(g),k=0;k<g;k++)E[k]=arguments[k];return je(p=v.call.apply(v,[this].concat(E)),"gravityScale",g8,Ne(p)),je(p,"linearVelocity",g7,Ne(p)),je(p,"bounce",me,Ne(p)),je(p,"simulate",mt,Ne(p)),p}return Ae(n,[{key:"onLoad",value:function(){this.canvas=this.node.scene.getComponentInChildren(_).getComponent(A),this.uiTransform=this.node.getComponent(A)}},{key:"update",value:function(p){if(this.simulate){this.applyGravity();var v=this.node.worldPosition.clone();v.add(new ef(this.linearVelocity.x*p,this.linearVelocity.y*p,0)),v=this.applyBounce(v),this.node.setWorldPosition(v)}}},{key:"applyForce",value:function(p){this.linearVelocity.add(p)}},{key:"applyGravity",value:function(){var p=new eg(0,-9.8*this.gravityScale);this.applyForce(p)}},{key:"applyBounce",value:function(p){var v=this.uiTransform.getBoundingBoxToWorld();v.yMin<0&&(p.y=v.height/2,this.linearVelocity.y*=-this.bounce),v.xMin<0&&(p.x=v.width/2,this.linearVelocity.x*=-1);var g=this.canvas.width;return v.xMax>g&&(p.x=g-v.width/2,this.linearVelocity.x*=-1),p}}]),n}(L)).prototype,"gravityScale",[g2],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),g7=Ye(g9.prototype,"linearVelocity",[g4],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new eg(0,0)}}),me=Ye(g9.prototype,"bounce",[g3],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),mt=Ye(g9.prototype,"simulate",[g5],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),g6=g9))||g6);g._RF.pop(),g._RF.push({},"93d88BQCU5B0L/TmaCaYNfm","AnimSkipOverlay",void 0);var mT,mI,mR,mP,mN,mD,mL,mO,mM,mx=E.ccclass,mF=E.property,mB=E.disallowMultiple,$k=function(){},mU=(my=mx("AnimSkipOverlay"),mv=mF(et),mg=mF(et),mm=mF(N),my(mb=mB((mS=Ye((mw=function(p){Ie(a,p);var v,g,E=xe(a);function a(){var p;Ce(this,a);for(var v=arguments.length,g=new Array(v),k=0;k<v;k++)g[k]=arguments[k];return je(p=E.call.apply(E,[this].concat(g)),"containerUIOpacity",mS,Ne(p)),je(p,"maskUIOpacity",mE,Ne(p)),je(p,"skipButton",mk,Ne(p)),p.isOpened=!1,p.currentCallback=$k,p}return Ae(a,[{key:"__preload",value:function(){this.validateRequiredComponents(),this.containerUIOpacity.node.active=!1,this.skipButton.interactable=!1}},{key:"onSkipButtonPress",value:function(){this.currentCallback(),this.close()}},{key:"validateRequiredComponents",value:function(){e7.lazyValidateProperties(this)}},{key:"open",value:(g=Ee(function(p){var v,g,E,k,C;return _ts_generator(this,function(_){switch(_.label){case 0:this.containerUIOpacity.node.active=!0;v=p.onSkip,g=p.opacity,E=void 0===g?255:g,k=p.transitionDuration,C=void 0===k?.2:k;this.maskUIOpacity.opacity=E;return[4,this.animateUIOpacity(0,255,C)];case 1:_.sent(),this.currentCallback=v,this.skipButton.interactable=!0,this.isOpened=!0,this.node.scene.emit(iq,p);return[2]}})}),function(p){return g.apply(this,arguments)})},{key:"close",value:(v=Ee(function(){var p;var v=arguments;return _ts_generator(this,function(g){switch(g.label){case 0:p=v.length>0&&void 0!==v[0]?v[0]:.2;this.skipButton.interactable=!1,this.currentCallback=$k;return[4,this.animateUIOpacity(255,0,p)];case 1:g.sent(),this.maskUIOpacity.opacity=0,this.containerUIOpacity.node.active=!1,this.isOpened=!1,this.node.scene.emit(iW);return[2]}})}),function(){return v.apply(this,arguments)})},{key:"animateUIOpacity",value:function(p,v,g){return this.containerUIOpacity.opacity=p,tJ.runTweenAsync(G(this.containerUIOpacity).to(g,{opacity:v}))}},{key:"untilClosed",value:function(){var p=this;return!1===this.isOpened?Promise.resolve():new Promise(function(v){p.node.scene.once(iW,v)})}}]),a}(L)).prototype,"containerUIOpacity",[mv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),mE=Ye(mw.prototype,"maskUIOpacity",[mg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),mk=Ye(mw.prototype,"skipButton",[mm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),mb=mw))||mb)||mb);g._RF.pop(),g._RF.push({},"755d1r2cMRLvo4fObNWxss/","CoinContainer",void 0);var mz,mG,mY,mj,mH,mV,mq,mW,mK,mX,mJ,mQ,mZ,m$,m0,m1,m2=E.ccclass,m4=E.property,m3=GameCore.Utils.Number,m5=(mT=m2("CoinContainer"),mI=m4(I),mR=m4(V),mP=m4(et),mT((mL=Ye((mD=function(p){Ie(o,p);var v,g,E,k=xe(o);function o(){var p;Ce(this,o);for(var v=arguments.length,g=new Array(v),E=0;E<v;E++)g[E]=arguments[E];return je(p=k.call.apply(k,[this].concat(g)),"coinLabel",mL,Ne(p)),je(p,"coinIcon",mO,Ne(p)),je(p,"explosionCircle",mM,Ne(p)),p.currentCoin=0,p}return Ae(o,[{key:"setCoinText",value:function(p){this.coinLabel.string=p}},{key:"handleAddCoinButton",value:function(){s8.openScreen(nH.GET_COIN_SCREEN,{quantity:oW})}},{key:"onLoad",value:function(){this.validateRequiredComponents(),this.listenToEvents()}},{key:"validateRequiredComponents",value:function(){e7.lazyValidateProperties(this)}},{key:"listenToEvents",value:function(){this.node.scene.on(aR.COIN_CHANGED,this.updateCoins,this)}},{key:"updateCoins",value:(E=Ee(function(p){var v,g,E,k,C,_;return _ts_generator(this,function(A){switch(A.label){case 0:g=p.coins,E=p.collectionAnimation;if(!(void 0!==E&&!1!==this.node.activeInHierarchy))return[3,4];k=E.signal;if(null===(v=this.animAbortSignal)||void 0===v||v.abort(),this.animAbortSignal=null!=k?k:new na,!E.animateTextOnly)return[3,2];return[4,this.animateCoinText(g,0,k)];case 1:return[2,(A.sent(),void this.setCoins(g))];case 2:C=E.flyDuration,_=E.floatDuration+C;return[4,this.animateCoinText(g,_,k)];case 3:A.sent(),this.setCoins(g);return[3,5];case 4:this.setCoins(g);A.label=5;case 5:return[2]}})}),function(p){return E.apply(this,arguments)})},{key:"setCoins",value:function(p){this.setCoinText(m3.getShortNumber(p,3)),this.currentCoin=p}},{key:"animateCoinText",value:(g=Ee(function(p,v,g){var E,k;return _ts_generator(this,function(C){switch(C.label){case 0:E=this,k=this.currentCoin;return[4,tJ.waitTweenAsync(v,g)];case 1:C.sent(),nQ.playSound(nB.COLLECT_COINS);return[4,tJ.runOnUpdateAsync(this.node,1,function(v){var g=Math.round(k+(p-k)*v);E.setCoinText(m3.getShortNumber(g,3))},g)];case 2:C.sent();return[2]}})}),function(p,v,E){return g.apply(this,arguments)})},{key:"emitExplodeEffect",value:(v=Ee(function(p){return _ts_generator(this,function(v){switch(v.label){case 0:this.explosionCircle.opacity=255,this.explosionCircle.node.setScale(0,0);return[4,Promise.all([tJ.runTweenAsync(G(this.explosionCircle.node).to(.4,{scale:new ef(3,3,3)},{easing:"quadOut"}),p),tJ.runTweenAsync(G(this.explosionCircle).delay(.2).to(.2,{opacity:0}),p)])];case 1:v.sent(),this.explosionCircle.node.setScale(0,0),this.explosionCircle.opacity=0;return[2]}})}),function(p){return v.apply(this,arguments)})},{key:"getCoinIconWorldPosition",value:function(){return this.coinIcon.node.worldPosition}},{key:"getCoinIconWorldScale",value:function(){return this.coinIcon.node.worldScale}},{key:"onDestroy",value:function(){var p;null===(p=this.animAbortSignal)||void 0===p||p.abort()}}]),o}(L)).prototype,"coinLabel",[mI],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),mO=Ye(mD.prototype,"coinIcon",[mR],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),mM=Ye(mD.prototype,"explosionCircle",[mP],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),mN=mD))||mN);g._RF.pop(),g._RF.push({},"a1833nGls5Ac4p0tpu/jEqi","ItemContainer",void 0);var m6,m9,m8,m7,be,bt,bn,bi,ba,br,bo,bs,bl,bu,bc,bd,bp,bf,by,bv,bg,bm=E.ccclass,bb=E.property,bw=globalThis.game.player,bS=[1e3,1500];mz=bm("ItemContainer"),mG=bb({type:k,group:"Hint"}),mY=bb({type:I,group:"Hint"}),mj=bb({type:k,group:"Thunder"}),mH=bb({type:I,group:"Thunder"}),mV=bb({type:k,group:"Storm"}),mq=bb({type:I,group:"Storm"}),mW=bb(K),mz((mX=Ye((mK=function(p){Ie(u,p);var v,g,E,k,C,A=xe(u);function u(){var p;Ce(this,u);for(var v=arguments.length,g=new Array(v),E=0;E<v;E++)g[E]=arguments[E];return je(p=A.call.apply(A,[this].concat(g)),"hintNode",mX,Ne(p)),je(p,"hintLabel",mJ,Ne(p)),p.hintCollection=[],je(p,"thunderNode",mQ,Ne(p)),je(p,"thunderLabel",mZ,Ne(p)),p.thunderCollection=[],je(p,"stormNode",m$,Ne(p)),je(p,"stormLabel",m0,Ne(p)),p.stormCollection=[],je(p,"itemPrefab",m1,Ne(p)),p}return Ae(u,[{key:"onLoad",value:function(){this.canvas=this.node.scene.getComponentInChildren(_).node,this.widget=this.getComponent(j),this.defaultRightWidget=this.widget.right,this.uiOpacity=this.getComponent(et),this.validateRequiredComponents(),this.listenToEvents()}},{key:"start",value:function(){this.prepareItemCollection()}},{key:"validateRequiredComponents",value:function(){e7.lazyValidateProperties(this)}},{key:"listenToEvents",value:function(){this.node.scene.on(aR.ADD_ITEMS,this.handleAddItems,this)}},{key:"prepareItemCollection",value:function(){for(var p=0;p<9;p++){var v=T(this.itemPrefab),g=T(this.itemPrefab),E=T(this.itemPrefab);v.parent=this.canvas,g.parent=this.canvas,E.parent=this.canvas,v.active=!1,g.active=!1,E.active=!1,this.hintCollection.push(v.getComponent(mA)),this.thunderCollection.push(g.getComponent(mA)),this.stormCollection.push(E.getComponent(mA))}}},{key:"updateStatus",value:function(p){var v=p.items;this.hintLabel.string="".concat(v.hint),this.thunderLabel.string="".concat(v.thunder),this.stormLabel.string="".concat(v.storm)}},{key:"show",value:(C=Ee(function(){var p;return _ts_generator(this,function(v){switch(v.label){case 0:this.uiOpacity.opacity=255;p=G(this.widget).to(1.5,{right:0},{easing:"quadOut"});return[4,tJ.runTweenAsync(p,this.animAbortSignal)];case 1:v.sent(),this.widget.right=0;return[2]}})}),function(){return C.apply(this,arguments)})},{key:"hide",value:(k=Ee(function(){var p;return _ts_generator(this,function(v){switch(v.label){case 0:p=G(this.widget).to(1,{right:this.defaultRightWidget},{easing:"quadIn"});return[4,tJ.runTweenAsync(p)];case 1:v.sent(),this.uiOpacity.opacity=0;return[2]}})}),function(){return k.apply(this,arguments)})},{key:"handleAddItems",value:(E=Ee(function(p){var v,g,E,k,C;return _ts_generator(this,function(_){switch(_.label){case 0:g=this;this.animAbortSignal=null!==(v=p.signal)&&void 0!==v?v:new na;E=bw.getGameData();if(!E)return[3,3];this.updateStatus(E);k=this.show(),C=p.items.map(function(p){return g.animateItemCollection(p.item,p.quantity,1.5)});return[4,Promise.all([k].concat(He(C)))];case 1:_.sent(),E.items=we(we({},E.items),{},{hint:E.items.hint+p.items[0].quantity,thunder:E.items.thunder+p.items[1].quantity,storm:E.items.storm+p.items[2].quantity}),bw.setGameData(E),this.updateStatus(E);return[4,this.hide()];case 2:_.sent();_.label=3;case 3:return[2]}})}),function(p){return E.apply(this,arguments)})},{key:"animateItemCollection",value:(g=Ee(function(p,v,g){var E,k,C;return _ts_generator(this,function(_){switch(_.label){case 0:E=this,k=this.getItemCollection(p).slice(0,v);if(!(0!==k.length))return[3,2];C=k.map(function(v,k){v.node.active=!0,v.node.position=new ef(0,0,v.node.position.z),v.linearVelocity=new eg(0,0),v.simulate=!0;var C=ek(Math.PI/3,2*Math.PI/3),_=ek(bS[0],bS[1])*Math.cos(C),A=ek(bS[0],bS[1])*Math.sin(C);v.applyForce(new eg(_,A));var T=E.getTargetNode(p);if(T)return v.getComponent(V).spriteFrame=T.getComponent(V).spriteFrame,E.getItemAnimation(v,T,g+.03*k)});return[4,Promise.all(C)];case 1:_.sent();_.label=2;case 2:return[2]}})}),function(p,v,E){return g.apply(this,arguments)})},{key:"getItemCollection",value:function(p){switch(p){case"hint":return this.hintCollection;case"thunder":return this.thunderCollection;case"storm":return this.stormCollection;default:return[]}}},{key:"getTargetNode",value:function(p){switch(p){case"hint":return this.hintNode;case"thunder":return this.thunderNode;case"storm":return this.stormNode;default:return null}}},{key:"getItemAnimation",value:(v=Ee(function(p,v){var g,E,k;var C=arguments;return _ts_generator(this,function(_){switch(_.label){case 0:g=C.length>2&&void 0!==C[2]?C[2]:0;p.node.scale=new ef(2,2,2);return[4,tJ.waitTweenAsync(g,this.animAbortSignal)];case 1:_.sent();E=p.node.worldPosition.clone(),k=G(p.node).to(1,{scale:v.scale},{onUpdate:function(g,k){if(g&&k){var C=ee.cubicIn(k);v&&(p.node.worldPosition=E.lerp(v.worldPosition,C))}},onComplete:function(){p.node.setPosition(0,0),p.node.active=!1}});return[4,tJ.runTweenAsync(k,this.animAbortSignal)];case 2:_.sent(),p.node.scale=v.scale.clone(),p.node.setPosition(0,0),p.node.active=!1;return[2]}})}),function(p,g){return v.apply(this,arguments)})},{key:"onDestroy",value:function(){var p;null===(p=this.animAbortSignal)||void 0===p||p.abort()}}]),u}(L)).prototype,"hintNode",[mG],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),mJ=Ye(mK.prototype,"hintLabel",[mY],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),mQ=Ye(mK.prototype,"thunderNode",[mj],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),mZ=Ye(mK.prototype,"thunderLabel",[mH],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),m$=Ye(mK.prototype,"stormNode",[mV],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),m0=Ye(mK.prototype,"stormLabel",[mq],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),m1=Ye(mK.prototype,"itemPrefab",[mW],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),mK));g._RF.pop(),g._RF.push({},"ba822axo49BibgkqkEhhqVp","DashboardPage",void 0);var bE,bk,bC,b_,bA,bT,bI,bR,bP,bN,bD,bL=E.ccclass,bO=E.property,bM=E.disallowMultiple,bx=E.requireComponent,bF=(m6=bL("DashboardPage"),m9=bx(j),m8=bx(et),m7=bO({type:k,displayName:"Page's container"}),be=bO({type:k,displayName:"Placeholder"}),bt=bO({displayName:"Don't load page",tooltip:"Tell the component to not preload the page even if it hasn't loaded yet"}),bn=bO({type:K,displayName:"Page prefab",visible:function(){return!this.hasLoaded}}),bi=bO({displayName:"Darken background"}),ba=bO({type:F,min:0,max:255,displayName:"Background opacity",visible:function(){return this.darkenBackground}}),br=bO({displayName:"Use navbar shadow"}),bo=bO({type:F,min:0,max:255,displayName:"Navbar shadow opacity",visible:function(){return this.useNavbarShadow}}),m6(bs=bM(bs=m9(bs=m8((bu=Ye((bl=function(p){Ie(a,p);var v,g,E=xe(a);function a(){var p;Ce(this,a);for(var v=arguments.length,g=new Array(v),k=0;k<v;k++)g[k]=arguments[k];return je(p=E.call.apply(E,[this].concat(g)),"container",bu,Ne(p)),je(p,"placeholder",bc,Ne(p)),je(p,"hasLoaded",bd,Ne(p)),je(p,"pagePrefab",bp,Ne(p)),je(p,"darkenBackground",bf,Ne(p)),je(p,"backgroundOpacity",by,Ne(p)),je(p,"useNavbarShadow",bv,Ne(p)),je(p,"navbarShadowOpacity",bg,Ne(p)),p}return Ae(a,[{key:"onLoad",value:function(){this.containerUIOpacity=this.container.getComponent(et),this.placeholderUIOpacity=this.placeholder.getComponent(et),this.widgetComponent=this.node.getComponent(j),this.uiOpacity=this.node.getComponent(et),this.validateRequiredComponents();var p=this.container.getComponent(H);this.layoutComponents=p?[p]:[],this.widgetComponents=[this.widgetComponent].concat(He(this.container.getComponentsInChildren(j)))}},{key:"start",value:function(){this.container.active=!0,this.placeholder.active=!0}},{key:"getWidget",value:function(){return this.widgetComponent}},{key:"updateWidgets",value:function(){this.widgetComponents.forEach(function(p){p.updateAlignment()})}},{key:"updateLayouts",value:function(){this.layoutComponents.forEach(function(p){p.updateLayout()})}},{key:"show",value:function(){this.uiOpacity.opacity=255}},{key:"hide",value:function(){this.uiOpacity.opacity=0}},{key:"mount",value:(g=Ee(function(){var p;return _ts_generator(this,function(v){switch(v.label){case 0:p=this.hasLoaded;if(p)return[3,2];return[4,this.create()];case 1:p=v.sent();v.label=2;case 2:this.placeholderUIOpacity.opacity=0,this.containerUIOpacity.opacity=255,nJ.trackCurrentPage(this.node.name,!0);return[2]}})}),function(){return g.apply(this,arguments)})},{key:"unmount",value:function(){255===this.placeholderUIOpacity.opacity&&0===this.containerUIOpacity.opacity||(this.placeholderUIOpacity.opacity=255,this.containerUIOpacity.opacity=0)}},{key:"transitionIn",value:function(){return Promise.resolve()}},{key:"transitionOut",value:function(){return Promise.resolve()}},{key:"hasLoadedPage",value:function(){return this.hasLoaded}},{key:"getContainer",value:function(){return this.container}},{key:"getDarkenBackground",value:function(){return this.darkenBackground?this.backgroundOpacity:0}},{key:"getNavbarShadow",value:function(){return this.useNavbarShadow?this.navbarShadowOpacity:0}},{key:"create",value:(v=Ee(function(){var p,v,g,E,k;return _ts_generator(this,function(C){switch(C.label){case 0:if(!(this.pagePrefab&&!this.hasLoaded))return[3,2];g=T(this.pagePrefab),E=g.getComponentsInChildren(j);(p=this.widgetComponents).push.apply(p,He(E));k=g.getComponentsInChildren(H);(v=this.layoutComponents).push.apply(v,He(k)),this.container.addChild(g);return[4,tJ.waitTweenAsync(0)];case 1:C.sent(),this.hasLoaded=!0;C.label=2;case 2:return[2]}})}),function(){return v.apply(this,arguments)})},{key:"validateRequiredComponents",value:function(){e7.lazyValidateProperties(this)}}]),a}(L)).prototype,"container",[m7],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),bc=Ye(bl.prototype,"placeholder",[be],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),bd=Ye(bl.prototype,"hasLoaded",[bt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),bp=Ye(bl.prototype,"pagePrefab",[bn],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),bf=Ye(bl.prototype,"darkenBackground",[bi],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),by=Ye(bl.prototype,"backgroundOpacity",[ba],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 150}}),bv=Ye(bl.prototype,"useNavbarShadow",[br],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),bg=Ye(bl.prototype,"navbarShadowOpacity",[bo],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 150}}),bs=bl))||bs)||bs)||bs)||bs);g._RF.pop(),g._RF.push({},"18bbbp5z2VHVKp4jjjmsAhu","ThemeProgressBar",void 0);var bB,bU,bz,bG,bY,bj,bH,bV,bq,bW,bK,bX,bJ,bQ,bZ,b$=E.ccclass,b0=E.property,b1=(bE=b$("ThemeProgressBar"),bk=b0(k),bC=b0(k),b_=b0(k),bA=b0(k),bE((bR=Ye((bI=function(p){Ie(n,p);var v=xe(n);function n(){var p;Ce(this,n);for(var g=arguments.length,E=new Array(g),k=0;k<g;k++)E[k]=arguments[k];return je(p=v.call.apply(v,[this].concat(E)),"progressBar",bR,Ne(p)),je(p,"progressText",bP,Ne(p)),je(p,"leftCap",bN,Ne(p)),je(p,"rightCap",bD,Ne(p)),p}return Ae(n,[{key:"onLoad",value:function(){this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){if(!this.progressBar)throw new Error("ThemeProgressBar: progressBar not found");if(!this.progressText)throw new Error("ThemeProgressBar: progressText not found");if(!this.leftCap)throw new Error("ThemeProgressBar: leftCap not found");if(!this.rightCap)throw new Error("ThemeProgressBar: rightCap not found")}},{key:"setProgress",value:function(p,v){p<=0?(this.leftCap.active=!1,this.rightCap.active=!1):(this.leftCap.active=!0,this.rightCap.active=!0);var g=this.progressBar.getComponent(ey);if(!g)throw new Error("ThemeProgressBar: progressBarComponent not found");g.progress=p/v;var E=this.progressText.getComponent(I);if(!E)throw new Error("ThemeProgressBar: progressTextComponent not found");E.string="".concat(p,"/").concat(v)}}]),n}(L)).prototype,"progressBar",[bk],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),bP=Ye(bI.prototype,"progressText",[bC],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),bN=Ye(bI.prototype,"leftCap",[b_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),bD=Ye(bI.prototype,"rightCap",[bA],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),bT=bI))||bT);g._RF.pop(),g._RF.push({},"e62f9TdkTxOyJy6vcnplnCB","LockAnimator",void 0);var b2,b4,b3,b5,b6,b9,b8,b7,wt,wn,wi,wa,wr,wo,ws,wl,wu,wc,wd,wp,wf,wy,wv=E.ccclass,wg=E.disallowMultiple,wm=E.property,wb=[50,160],ww=(bB=wv("LockAnimator"),bU=wm(e_),bz=wm(M),bG=wm(J),bY=wm(J),bj=wm(o_),bH=wm({type:F,min:0}),bB(bV=wg((bW=Ye((bq=function(p){Ie(a,p);var v,g,E=xe(a);function a(){var p;Ce(this,a);for(var v=arguments.length,g=new Array(v),k=0;k<v;k++)g[k]=arguments[k];return je(p=E.call.apply(E,[this].concat(g)),"floatingParticles",bW,Ne(p)),je(p,"iconAnimation",bK,Ne(p)),je(p,"lockClip",bX,Ne(p)),je(p,"unlockClip",bJ,Ne(p)),je(p,"trailTemplate",bQ,Ne(p)),je(p,"trailCount",bZ,Ne(p)),p.trails=[],p}return Ae(a,[{key:"onLoad",value:function(){this.validateRequiredComponents(),this.prepareTrails(),this.floatingParticles.node.active=!1}},{key:"unlock",value:(g=Ee(function(p){return _ts_generator(this,function(v){switch(v.label){case 0:this.floatingParticles.node.active=!0,this.floatingParticles.resetSystem();return[4,this.playAnimation(this.unlockClip.name,p)];case 1:v.sent(),this.floatingParticles.stopSystem();return[2]}})}),function(p){return g.apply(this,arguments)})},{key:"fireExplosionParticles",value:function(){this.explodeTrails()}},{key:"lock",value:function(){this.playAnimation(this.lockClip.name),this.floatingParticles.node.active&&this.floatingParticles.stopSystem()}},{key:"explodeTrails",value:function(){var p=this;return Promise.all(this.trails.map(function(v){return tJ.runTweenAsync(p.getExplodeTrail(v))}))}},{key:"getExplodeTrail",value:function(p,v){var g=arguments.length>1&&void 0!==v?v:0,E=ek(0,2*Math.PI),k=ek(wb[0],wb[1])*Math.cos(E),C=ek(wb[0],wb[1])*Math.sin(E),_=new ef(k,C,p.node.position.z),A=p.node.scale.clone();return G(p.node).delay(g).call(function(){p.node.setPosition(0,0),p.reset(),p.node.active=!0}).to(.5,{position:_.clone()},{easing:"expoOut"}).to(.5,{scale:new ef(0,0,1)},{easing:"expoIn"}).call(function(){p.node.setPosition(0,0),p.node.scale=A,p.reset(),p.node.active=!1})}},{key:"prepareTrails",value:function(){this.trailTemplate.node.active=!1;for(var p=0;p<this.trailCount;p++){var v=T(this.trailTemplate.node);v.setParent(this.node),v.active=!1,this.trails.push(v.getComponent(o_))}}},{key:"validateRequiredComponents",value:function(){e7.lazyValidateProperties(this)}},{key:"playAnimation",value:(v=Ee(function(p,v){var g;return _ts_generator(this,function(E){g=this;return[2,v&&null!=v&&v.aborted?Promise.resolve():new Promise(function(E){g.iconAnimation.once(M.EventType.FINISHED,function(){E()}),null==v||v.addAbortListener(function(){g.iconAnimation.off(M.EventType.FINISHED),g.iconAnimation.stop(),E()}),g.iconAnimation.play(p)})]})}),function(p,g){return v.apply(this,arguments)})}]),a}(L)).prototype,"floatingParticles",[bU],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),bK=Ye(bq.prototype,"iconAnimation",[bz],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),bX=Ye(bq.prototype,"lockClip",[bG],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),bJ=Ye(bq.prototype,"unlockClip",[bY],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),bQ=Ye(bq.prototype,"trailTemplate",[bj],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),bZ=Ye(bq.prototype,"trailCount",[bH],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),bV=bq))||bV)||bV);g._RF.pop(),g._RF.push({},"aef0d6qo8hNUJ7qNl2wuT29","ThemeBlock",void 0);var wS,wE,wk,wC,w_,wA,wT,wI,wR,wP,wN,wD=E.ccclass,wL=E.property,wO={progress:0,max:10,isLocked:!0,themeId:sp.SUMMER,skin:sd},wM=(b2=wD("ThemeBlock"),b4=wL(k),b3=wL(et),b5=wL(k),b6=wL(et),b9=wL(ww),b8=wL(k),b7=wL(V),wt=wL([V]),wn=wL(I),wi=wL(es),b2((wo=Ye((wr=function(p){Ie(r,p);var v,g,E,k,C=xe(r);function r(){var p;Ce(this,r);for(var v=arguments.length,g=new Array(v),E=0;E<v;E++)g[E]=arguments[E];return je(p=C.call.apply(C,[this].concat(g)),"mask",wo,Ne(p)),je(p,"nodeUIOpacity",ws,Ne(p)),je(p,"progressBar",wl,Ne(p)),je(p,"backgroundUI",wu,Ne(p)),je(p,"lockAnimator",wc,Ne(p)),je(p,"themeLoadingRing",wd,Ne(p)),je(p,"themeSprite",wp,Ne(p)),je(p,"tileBlockIconSprite",wf,Ne(p)),je(p,"titleLabel",wy,Ne(p)),p.visibilityTween=null,p.isVisible=!1,p.payload=wO,p}return Ae(r,[{key:"isLocked",get:function(){return this.payload.isLocked},set:function(p){this.payload.isLocked=p,this.updateThemeBlockDisplay()}},{key:"getSkinName",value:function(){return this.payload.skin}},{key:"__preload",value:function(){this.uiTransform=this.getComponent(A),this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){e7.lazyValidateProperties(this)}},{key:"updateThemeBlockDisplay",value:function(p){var v=arguments.length>0&&void 0!==p?p:wO;this.payload=v;var g=v.progress,E=v.max,k=v.isLocked,C=v.themeId,_=v.skin;this.updateTitle(C),this.updateSkinAsync(_),this.updateThemeAsync(C);var A=this.progressBar.getComponent(b1);if(!A)throw new Error("ThemeBlock: progressBarComponent not found");this.mask.active=k,this.progressBar.active=!k,this.lockAnimator.node.active=k,k||A.setProgress(g,E)}},{key:"playUnlockAnim",value:(k=Ee(function(p){var v,g,E,k;var C=arguments;return _ts_generator(this,function(_){switch(_.label){case 0:v=C.length>1&&void 0!==C[1]?C[1]:wO;this.payload=we(we({},v),{},{isLocked:!1});g=v.progress,E=v.max,k=this.progressBar.getComponent(b1);if(!k)throw new Error("ThemeBlock: progressBarComponent not found");this.mask.active=!0,this.progressBar.active=!1,this.lockAnimator.node.active=!0,k.setProgress(g,E);return[4,this.animateUnlockedState(p)];case 1:_.sent();return[2]}})}),function(p){return k.apply(this,arguments)})},{key:"updateTitle",value:function(p){switch(p){case sp.SUMMER:this.titleLabel.string="Summer";break;case sp.WINTER:this.titleLabel.string="Winter";break;case sp.AUTUMN:this.titleLabel.string="Autumn"}}},{key:"updateSkinAsync",value:(E=Ee(function(p){var v,g;return _ts_generator(this,function(E){switch(E.label){case 0:v=this;return[4,nP.loadSkinPreviewAsync(p)];case 1:g=E.sent();this.tileBlockIconSprite&&g.forEach(function(p,g){p&&(v.tileBlockIconSprite[g].spriteFrame=p)});return[2]}})}),function(p){return E.apply(this,arguments)})},{key:"updateThemeAsync",value:(g=Ee(function(p){var v;return _ts_generator(this,function(g){switch(g.label){case 0:return[4,nP.loadThemePreviewAsync(p)];case 1:v=g.sent();this.themeSprite&&v&&(this.themeSprite.spriteFrame=v,this.themeLoadingRing&&(this.themeLoadingRing.active=!1));return[2]}})}),function(p){return g.apply(this,arguments)})},{key:"animateUnlockedState",value:(v=Ee(function(p){var v,g,E;return _ts_generator(this,function(k){switch(k.label){case 0:g=this.mask.getComponent(et),E=this.progressBar.getComponent(et);if(!g)throw new Error("ThemeBlock: maskUIOpacity not found");if(!E)throw new Error("ThemeBlock: progressBarUIOpacity not found");this.mask.active=!0,g.opacity=null!==(v=g.opacity)&&void 0!==v?v:255,this.progressBar.active=!0,E.opacity=0;return[4,this.lockAnimator.unlock(p)];case 1:k.sent(),this.lockAnimator.node.active=!1;return[4,Promise.all([tJ.runTweenAsync(G(g).to(.25,{opacity:0}),p),tJ.runTweenAsync(G(E).to(.25,{opacity:255}),p)])];case 2:k.sent(),this.mask.active=!1,g.opacity=0,E.opacity=255;return[2]}})}),function(p){return v.apply(this,arguments)})},{key:"getUITransform",value:function(){return this.uiTransform}},{key:"setVisible",value:function(p){var v;this.isVisible!==p&&(this.isVisible=p,null===(v=this.visibilityTween)||void 0===v||v.stop(),this.visibilityTween=G(this.nodeUIOpacity).to(.05,{opacity:p?255:0}).start())}}]),r}(L)).prototype,"mask",[b4],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ws=Ye(wr.prototype,"nodeUIOpacity",[b3],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wl=Ye(wr.prototype,"progressBar",[b5],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wu=Ye(wr.prototype,"backgroundUI",[b6],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wc=Ye(wr.prototype,"lockAnimator",[b9],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wd=Ye(wr.prototype,"themeLoadingRing",[b8],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wp=Ye(wr.prototype,"themeSprite",[b7],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wf=Ye(wr.prototype,"tileBlockIconSprite",[wt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),wy=Ye(wr.prototype,"titleLabel",[wn],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ye(wr.prototype,"isLocked",[wi],Object.getOwnPropertyDescriptor(wr.prototype,"isLocked"),wr.prototype),wa=wr))||wa);g._RF.pop(),g._RF.push({},"b3a4dy5XgpIT6stybzgYjnu","CollectionsContent",void 0);var wx,wF=E.ccclass,wB=E.property,wU=globalThis.game.storage,wz=GameCore.Utils.Array,wG=(wS=wF("CollectionsContent"),wE=wB(a4),wk=wB(eR),wC=wB(iz),w_=wB({type:Y,displayName:"Offset from top of scroll view",tooltip:"The offset between the first theme tab and the top of the scroll view"}),wS((wI=Ye((wT=function(p){Ie(o,p);var v,g,E,k=xe(o);function o(){var p;Ce(this,o);for(var v=arguments.length,g=new Array(v),E=0;E<v;E++)g[E]=arguments[E];return(p=k.call.apply(k,[this].concat(g))).animateThemeTabUnlock=null,je(p,"panelAnimator",wI,Ne(p)),je(p,"themeScrollView",wR,Ne(p)),je(p,"contentOpacity",wP,Ne(p)),p.themeBlocks=[],p.preservedScrollPosition=new eg,je(p,"offsetFromTopOfScrollView",wN,Ne(p)),p.updateBlocksVisibility=function(){var v=p.uiTransform.getBoundingBoxToWorld(),g=v.yMax,E=v.yMin;p.themeBlocks.forEach(function(p){var v=p.getUITransform().getBoundingBoxToWorld(),k=v.yMax,C=v.yMin,_=k<E||C>g;p.setVisible(!_)})},p.hideContent=function(){p.contentOpacity.changeStateFade(!1,.1)},p.showContent=function(){p.contentOpacity.changeStateFade(!0,.1)},p}return Ae(o,[{key:"__preload",value:function(){var p,v;this.uiTransform=this.getComponent(A),this.themeBlocks=null!==(p=null===(v=this.themeScrollView.content)||void 0===v?void 0:v.getComponentsInChildren(wM))&&void 0!==p?p:[],this.validateRequiredComponents()}},{key:"listenEvents",value:function(){this.themeScrollView.node.on(eR.EventType.SCROLLING,this.updateBlocksVisibility),this.node.scene.on(aR.HIDE_UI,this.hideContent),this.node.scene.on(aR.SHOW_UI,this.showContent)}},{key:"unlistenEvents",value:function(){this.themeScrollView.node.off(eR.EventType.SCROLLING,this.updateBlocksVisibility),this.unlistenUIEvents()}},{key:"unlistenUIEvents",value:function(){this.node.scene.off(aR.HIDE_UI,this.hideContent),this.node.scene.off(aR.SHOW_UI,this.showContent)}},{key:"init",value:function(p){0!==p.length&&this.getThemeTabs().forEach(function(v,g){return v.updateThemeBlockDisplay(p[g])})}},{key:"preserveScrollPosition",value:function(){this.themeScrollView.stopAutoScroll(),this.preservedScrollPosition.set(this.themeScrollView.getScrollOffset())}},{key:"restoreScrollPosition",value:function(){this.themeScrollView.scrollToOffset(this.preservedScrollPosition,0)}},{key:"updateUnlockedProgress",value:function(p){var v=this,g=wU.getStorageData("collection","animateMapPackUnlock"),E=wU.getStorageData("collection","lastMapPack");p.forEach(function(p,k){var C=p.skin,_=p.progress,A=p.max,T=p.isLocked;if(_<A&&!T&&g&&E!==k+1)return v.animateThemeTabUnlock=p,wU.setStorageData("collection","animateMapPackUnlock",!1),wU.setStorageData("collection","lastMapPack",k+1),void v.setProgressToThemeTab(C,we(we({},p),{},{isLocked:!0}));v.setProgressToThemeTab(C,p)})}},{key:"shouldAnimateThemeTabUnlock",value:function(){return null!==this.animateThemeTabUnlock}},{key:"playThemeTabUnlockAnim",value:(E=Ee(function(p){var v;return _ts_generator(this,function(g){switch(g.label){case 0:if(!this.animateThemeTabUnlock)return[3,2];v=this.findThemeTab(this.animateThemeTabUnlock.skin);if(void 0===v)throw new Error("CollectionsContent: ThemeTab not found");return[4,v.playUnlockAnim(p,we(we({},this.animateThemeTabUnlock),{},{isLocked:!0}))];case 1:g.sent(),this.animateThemeTabUnlock=null;g.label=2;case 2:return[2]}})}),function(p){return E.apply(this,arguments)})},{key:"scrollToCurrentUnlockingTheme",value:(g=Ee(function(p,v){var g,E;return _ts_generator(this,function(k){switch(k.label){case 0:g=this.findThemeTab(p);if(!g)return[3,2];E=-g.node.position.y-this.offsetFromTopOfScrollView;return[4,this.scrollToOffset(new eg(0,E),2,v)];case 1:k.sent();k.label=2;case 2:return[2]}})}),function(p,v){return g.apply(this,arguments)})},{key:"scrollToOffset",value:(v=Ee(function(p,v,g){return _ts_generator(this,function(E){switch(E.label){case 0:this.themeScrollView.scrollToOffset(p,v);return[4,tJ.waitTweenAsync(v,g)];case 1:E.sent(),g.aborted&&(this.themeScrollView.stopAutoScroll(),this.themeScrollView.scrollToOffset(p,0));return[2]}})}),function(p,g,E){return v.apply(this,arguments)})},{key:"setProgressToThemeTab",value:function(p,v){var g=this.findThemeTab(p);if(void 0===g)throw new Error("CollectionsContent: ThemeTab not found");g.updateThemeBlockDisplay(v)}},{key:"findThemeTab",value:function(p){return wz.search(this.getThemeTabs(),function(v){return v.getSkinName()===p})}},{key:"getThemeTabs",value:function(){return this.themeScrollView.content.getComponentsInChildren(wM)}},{key:"enableUIAnimator",value:function(){this.panelAnimator.enabled=!0}},{key:"disableUIAnimator",value:function(){this.panelAnimator.enabled=!1}},{key:"validateRequiredComponents",value:function(){e7.lazyValidateProperties(this)}}]),o}(L)).prototype,"panelAnimator",[wE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wR=Ye(wT.prototype,"themeScrollView",[wk],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wP=Ye(wT.prototype,"contentOpacity",[wC],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wN=Ye(wT.prototype,"offsetFromTopOfScrollView",[w_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 407.5}}),wA=wT))||wA);g._RF.pop(),g._RF.push({},"dab8cbliOBAeZ7iVs959mBm","CollectionsPage",void 0);var wY,wj,wH,wV,wq,wW,wK,wX,wJ,wQ,wZ,w$,w0,w1,w2,w4,w3,w5,w6,w9,w8,w7,Se,St,Sn,Si,Sa,Sr=(0,E.ccclass)("CollectionsPage")(wx=function(p){Ie(o,p);var v,g,E,k=xe(o);function o(){var p;Ce(this,o);for(var v=arguments.length,g=new Array(v),E=0;E<v;E++)g[E]=arguments[E];return(p=k.call.apply(k,[this].concat(g))).payload=null,p}return Ae(o,[{key:"setPayload",value:function(p){this.payload=p}},{key:"mount",value:(E=Ee(function(){var p;return _ts_generator(this,function(v){switch(v.label){case 0:if(!!this.pagePrefab)return[3,2];return[4,nP.loadPrefabAsync(nr.COLLECTIONS_PAGE)];case 1:p=v.sent();p&&this.node&&(this.pagePrefab=p);v.label=2;case 2:return[4,Fe(Pe(o.prototype),"mount",this).call(this)];case 3:if(v.sent(),this.containerUIOpacity.opacity=0,!this.themeContent&&(this.themeContent=this.container.getComponentInChildren(wG),!this.themeContent))throw new Error("No theme content found");this.payload&&this.themeContent.init(this.payload);return[2]}})}),function(){return E.apply(this,arguments)})},{key:"transitionIn",value:(g=Ee(function(){var p,v,g;return _ts_generator(this,function(E){switch(E.label){case 0:p=this;return[4,Fe(Pe(o.prototype),"transitionIn",this).call(this)];case 1:E.sent(),this.themeContent.restoreScrollPosition(),this.themeContent.updateBlocksVisibility(),this.themeContent.enableUIAnimator(),this.themeContent.listenEvents();v=tJ.runTweenAsync(G(this.containerUIOpacity).to(.2,{opacity:255})),g=new Promise(function(v){p.node.scene.emit(aR.SHOW_UI,{onComplete:function(){v()}})});return[4,Promise.all([v,g])];case 2:E.sent();return[2]}})}),function(){return g.apply(this,arguments)})},{key:"transitionOut",value:(v=Ee(function(){var p;return _ts_generator(this,function(v){switch(v.label){case 0:p=this;return[4,Fe(Pe(o.prototype),"transitionOut",this).call(this)];case 1:v.sent(),this.themeContent.preserveScrollPosition(),this.themeContent.unlistenUIEvents();return[4,new Promise(function(v){p.node.scene.emit(aR.HIDE_UI,{onComplete:function(){v()}})})];case 2:v.sent(),this.themeContent.disableUIAnimator(),this.themeContent.unlistenEvents();return[2]}})}),function(){return v.apply(this,arguments)})}]),o}(bF))||wx;g._RF.pop(),g._RF.push({},"2381b1mKt1PUq5W+fsaaOYP","PageManager",void 0);var So,Ss,Sl,Su,Sc,Sd,Sp,Sf,Sy,Sv,Sg,Sm,Sb,Sw=E.ccclass,SS=E.property,SE=E.disallowMultiple,Sk=E.requireComponent,SC=GameCore.Utils.Array,S_=(wY=Sw("PageManagerItem"),wj=SS(bF),wH=SS({type:$(nn)}),wY((wW=Ye((wq=Ae(function e(){Ce(this,e),je(this,"page",wW,this),je(this,"pageType",wK,this)})).prototype,"page",[wj],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wK=Ye(wq.prototype,"pageType",[wH],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wV=wq))||wV),SA=(wX=Sw("PageManager"),wJ=Sk(A),wQ=SS({type:et,displayName:"Background Mask",group:"Background Mask"}),wZ=SS({type:Y,displayName:"Transition duration",group:"Background Mask"}),w$=SS({type:Y,displayName:"Transition delay",group:"Background Mask"}),w0=SS({type:et,displayName:"Nav Bar Shadow",group:"Nav Bar Shadow"}),w1=SS({type:Y,displayName:"Transition duration",group:"Nav Bar Shadow"}),w2=SS({type:Y,displayName:"Transition delay",group:"Nav Bar Shadow"}),w4=SS({type:[S_]}),w3=SS({type:$(nn)}),wX(w5=SE(w5=wJ((w9=Ye((w6=function(p){Ie(r,p);var v,g,E,k,C=xe(r);function r(){var p;Ce(this,r);for(var v=arguments.length,g=new Array(v),E=0;E<v;E++)g[E]=arguments[E];return je(p=C.call.apply(C,[this].concat(g)),"backgroundMask",w9,Ne(p)),je(p,"backgroundMaskTransitionDuration",w8,Ne(p)),je(p,"backgroundMaskTransitionDelay",w7,Ne(p)),je(p,"navBarShadow",Se,Ne(p)),je(p,"navBarShadowTransitionDuration",St,Ne(p)),je(p,"navBarShadowTransitionDelay",Sn,Ne(p)),je(p,"pageItems",Si,Ne(p)),je(p,"currentScreen",Sa,Ne(p)),p}return Ae(r,[{key:"unmountAndHideAll",value:function(){var p=this;this.pageItems.forEach(function(v){var g=v.page;v.pageType!==p.currentScreen&&(g.unmount(),g.hide())})}},{key:"onLoad",value:function(){this.uiTransform=this.getComponent(A),this.validateRequiredComponents()}},{key:"updateCollectionsContentPayload",value:function(p){var v=this.getPage(nn.collections);v&&_instanceof(v,Sr)&&v.setPayload(p)}},{key:"navigate",value:(k=Ee(function(p,v,g){var E,k,C,_,A,T,I,R,P,N,D,L,O,M,x,F;return _ts_generator(this,function(B){switch(B.label){case 0:E=p.from,k=p.to;if(null!==E)return[3,5];C=this.getPage(this.currentScreen);C.show();return[4,C.mount()];case 1:B.sent();return[4,null==v?void 0:v(C)];case 2:B.sent(),this.node.scene.emit(ne,{from:null,to:k});return[4,C.transitionIn()];case 3:B.sent();return[4,null==g?void 0:g(C)];case 4:return[2,(B.sent(),void(this.currentScreen=k))];case 5:if(E!==this.currentScreen)throw new Error("PageManager: Cannot navigate from a different screen. Perhaps you forgot to update the currentScreen property.");_=this.getPage(this.currentScreen),A=this.getPage(k);if(!A||!_)throw new Error("PageManager: Cannot navigate to/from a null page. Perhaps you forgot to add the page to the pageItems array in the editor.");T=this.uiTransform.width,I=this.getPageIndex(E),R=this.getPageIndex(k),P=Math.min(I,R),N=Math.max(I,R),D=(N-P)*T,L=I<R?1:-1,O=this.pageItems.slice(P,N+1);O.forEach(function(p,v){var g=p.page;g.show(),g.getWidget().enabled=!1,g.node.position=new ef((v+P-I)*T,g.node.position.y,g.node.position.z)});M=!1;x=A.hasLoadedPage();if(x)return[3,7];M=!0,s8.showLoadingScreen();return[4,tJ.waitTweenAsync(.5)];case 6:x=B.sent();B.label=7;case 7:return[4,A.mount()];case 8:B.sent();return[4,null==v?void 0:v(A)];case 9:B.sent(),this.node.scene.emit(ne,{from:E,to:k});return[4,Promise.all([_.transitionOut(),this.transition(D,L,O),this.handleBackgroundMask(this.backgroundMaskTransitionDuration,A.getDarkenBackground()),this.handleNavBarShadow(this.navBarShadowTransitionDuration,A.getNavbarShadow())])];case 10:B.sent();F=A.getWidget();F.enabled=!0,F.left=0,F.right=0,A.updateWidgets(),A.updateLayouts(),O.forEach(function(p){p.pageType!==k&&(p.page.unmount(),p.page.hide())}),this.currentScreen=k;return[4,A.transitionIn()];case 11:B.sent();return[4,null==g?void 0:g(A)];case 12:B.sent(),M&&s8.closeLoadingScreen();return[2]}})}),function(p,v,g){return k.apply(this,arguments)})},{key:"getPage",value:function(p){var v=this.getPageIndex(p);return -1!==v?this.pageItems[v].page:null}},{key:"handleBackgroundMask",value:(E=Ee(function(p,v){return _ts_generator(this,function(g){switch(g.label){case 0:return[4,tJ.runTweenAsync(G(this.backgroundMask).delay(this.backgroundMaskTransitionDelay).to(p,{opacity:v}).start())];case 1:g.sent();return[2]}})}),function(p,v){return E.apply(this,arguments)})},{key:"handleNavBarShadow",value:(g=Ee(function(p,v){return _ts_generator(this,function(g){switch(g.label){case 0:return[4,tJ.runTweenAsync(G(this.navBarShadow).delay(this.navBarShadowTransitionDelay).to(p,{opacity:v}).start())];case 1:g.sent();return[2]}})}),function(p,v){return g.apply(this,arguments)})},{key:"getPageIndex",value:function(p){return SC.searchIndex(this.pageItems,function(v){return v.pageType===p})}},{key:"transition",value:(v=Ee(function(p,v,g){return _ts_generator(this,function(E){switch(E.label){case 0:return[4,Promise.all(g.map(function(g){var E=g.page;return tJ.runTweenAsync(G(E.node).to(.5,{position:new ef(E.node.position.x-p*v,E.node.position.y,E.node.position.z)},{easing:ee.quintInOut}))}))];case 1:E.sent();return[2]}})}),function(p,g,E){return v.apply(this,arguments)})},{key:"validateRequiredComponents",value:function(){if(!this.uiTransform)throw new Error("PageManager requires UITransform component");if(!this.backgroundMask)throw new Error("PageManager requires background mask")}}]),r}(L)).prototype,"backgroundMask",[wQ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),w8=Ye(w6.prototype,"backgroundMaskTransitionDuration",[wZ],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return .5}}),w7=Ye(w6.prototype,"backgroundMaskTransitionDelay",[w$],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return .3}}),Se=Ye(w6.prototype,"navBarShadow",[w0],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),St=Ye(w6.prototype,"navBarShadowTransitionDuration",[w1],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return .5}}),Sn=Ye(w6.prototype,"navBarShadowTransitionDelay",[w2],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return .3}}),Si=Ye(w6.prototype,"pageItems",[w4],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Sa=Ye(w6.prototype,"currentScreen",[w3],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return nn.home}}),w5=w6))||w5)||w5)||w5);g._RF.pop(),g._RF.push({},"500274Qu9dAjJwYv27wMaMU","StarProgressBar",void 0);var ST,SI,SR,SP,SN,SD,SL=E.ccclass,SO=E.property,SM=(So=SL("StarProgressBar"),Ss=SO(rN),Sl=SO(I),Su=SO(F),Sc=SO(F),Sd=SO(x),So((Sy=Ye((Sf=function(p){Ie(i,p);var v,g=xe(i);function i(){var p;Ce(this,i);for(var v=arguments.length,E=new Array(v),k=0;k<v;k++)E[k]=arguments[k];return je(p=g.call.apply(g,[this].concat(E)),"progressBar",Sy,Ne(p)),je(p,"progressLabel",Sv,Ne(p)),je(p,"current",Sg,Ne(p)),je(p,"total",Sm,Ne(p)),je(p,"separator",Sb,Ne(p)),p}return Ae(i,[{key:"setRange",value:function(p,v){this.total=v,this.current=p,this.updateProgress()}},{key:"onLoad",value:function(){this.validateRequiredComponents()}},{key:"updateProgress",value:function(){this.progressBar.progress=Math.min(this.current,this.total)/this.total,this.updateProgressLabel()}},{key:"updateProgressLabel",value:function(){this.progressLabel.string="".concat(this.current).concat(this.separator).concat(this.total)}},{key:"animateTo",value:(v=Ee(function(p,v,g){var E,k,C,_,A;return _ts_generator(this,function(T){switch(T.label){case 0:E=this,k=Math.min(p,this.total)/this.total,C=this.current,_=1,A=G(this.progressBar).to(3,{progress:k},{easing:"quadOut",onUpdate:function(v,k){k&&(E.current=C+Math.floor((p-C)*k),null==g||g(E.current),E.current===C-_&&(_++,G(E.progressLabel.node).to(.05,{scale:new ef(1.2,1.2,1.2)}).to(.05,{scale:ef.ONE}).start()),E.updateProgressLabel())}});null==v||v.addAbortListener(function(){E.current=p,E.updateProgress()});return[4,tJ.runTweenAsync(A,v)];case 1:T.sent();return[2]}})}),function(p,g,E){return v.apply(this,arguments)})},{key:"validateRequiredComponents",value:function(){if(!this.progressBar)throw new Error("JourneyProgressBar: Missing required component TapperedProgressBar");if(!this.progressLabel)throw new Error("JourneyProgressBar: Missing required component Label")}}]),i}(L)).prototype,"progressBar",[Ss],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Sv=Ye(Sf.prototype,"progressLabel",[Sl],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Sg=Ye(Sf.prototype,"current",[Su],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Sm=Ye(Sf.prototype,"total",[Sc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Sb=Ye(Sf.prototype,"separator",[Sd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Sp=Sf))||Sp);g._RF.pop(),g._RF.push({},"83036ocqiZHXrI3Aq0dBJRD","EventButton",void 0);var Sx,SF,SB,SU,Sz,SG,SY,Sj,SH,SV,Sq,SW=E.ccclass,SK=E.property,SX=(ST=SW("EventButton"),SI=SK({type:$(yj)}),SR=SK(es),ST((SD=Ye((SN=function(p){Ie(n,p);var v=xe(n);function n(){var p;Ce(this,n);for(var g=arguments.length,E=new Array(g),k=0;k<g;k++)E[k]=arguments[k];return je(p=v.call.apply(v,[this].concat(E)),"eventType",SD,Ne(p)),p._isAvailable=!1,p}return Ae(n,[{key:"isAvailable",get:function(){return this._isAvailable},set:function(p){this._isAvailable=p,this.fakeClick()}},{key:"handleClick",value:function(){this.node.scene.emit(nt,{type:this.eventType})}},{key:"setAnimationState",value:function(p){this.animationController.setValue("RESET-SPECIAL",this._isAvailable),Fe(Pe(n.prototype),"setAnimationState",this).call(this,p)}}]),n}(ix)).prototype,"eventType",[SI],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return yj.STAR_CHEST}}),Ye(SN.prototype,"isAvailable",[SR],Object.getOwnPropertyDescriptor(SN.prototype,"isAvailable"),SN.prototype),SP=SN))||SP);g._RF.pop(),g._RF.push({},"87a11fQFYVFcphsqf5ivVof","DashboardHeader",void 0);var SJ,SQ,SZ,S$,S0,S1,S2,S4,S3,S5,S6,S9,S8,S7,Et,En,Ei,Ea,Er=E.ccclass,Eo=E.property,Es=globalThis.game.player,El=(Sx=Er("DashboardHeader"),SF=Eo({type:SM,displayName:"Progress bar",group:"Star Chest"}),SB=Eo({type:SX,displayName:"Button Component",group:"Star Chest"}),SU=Eo({type:J,displayName:"Default Rest animation",group:"Star Chest"}),Sz=Eo({type:J,displayName:"Special Rest animation",group:"Star Chest"}),Sx((Sj=Ye((SY=function(p){Ie(n,p);var v=xe(n);function n(){var p;Ce(this,n);for(var g=arguments.length,E=new Array(g),k=0;k<g;k++)E[k]=arguments[k];return je(p=v.call.apply(v,[this].concat(E)),"starProgressBar",Sj,Ne(p)),je(p,"chestButton",SH,Ne(p)),je(p,"defaultRestAnimation",SV,Ne(p)),je(p,"specialRestAnimation",Sq,Ne(p)),p.handleStarsUpdateEvent=function(v){var g,E;void 0!==(v=null!==(g=v)&&void 0!==g?g:null===(E=Es.getGameData())||void 0===E?void 0:E.stars)&&(p.starProgressBar.setRange(v,20),p.updateStarChestButtonAnimation(v))},p}return Ae(n,[{key:"__preload",value:function(){this.validateRequiredComponents(),ec.on(t9,this.handleStarsUpdateEvent)}},{key:"onDestroy",value:function(){ec.off(t9,this.handleStarsUpdateEvent)}},{key:"updateStarProgress",value:function(p){this.handleStarsUpdateEvent(p)}},{key:"updateStarChestButtonAnimation",value:function(p){this.chestButton.isAvailable=p>=20}},{key:"validateRequiredComponents",value:function(){if(!this.starProgressBar)throw new Error("DashboardHeader: starProgressBar not found");if(!this.chestButton)throw new Error("DashboardHeader: chestButton not found");if(!this.defaultRestAnimation)throw new Error("DashboardHeader: defaultRestAnimation not found");if(!this.specialRestAnimation)throw new Error("DashboardHeader: specialRestAnimation not found")}}]),n}(L)).prototype,"starProgressBar",[SF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),SH=Ye(SY.prototype,"chestButton",[SB],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),SV=Ye(SY.prototype,"defaultRestAnimation",[SU],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Sq=Ye(SY.prototype,"specialRestAnimation",[Sz],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),SG=SY))||SG);g._RF.pop(),g._RF.push({},"3b954Re2cRHvYJeBVAukYp9","JourneyLevelAvatar",void 0);var Eu,Ec,Eh,Ed,Ep,Ef,Ey,Ev,Eg,Em,Eb,Ew,ES=E.ccclass,EE=E.property,Ek=E.executeInEditMode,EC=(SJ=ES("JourneyLevelAvatar"),SQ=EE({type:V,displayName:"Avatar node"}),SZ=EE(k),S$=EE(M),S0=EE(et),S1=EE({type:J,group:"Animation"}),S2=EE({type:J,group:"Animation"}),S4=EE({type:J,group:"Animation"}),S3=EE({type:Z,displayName:"Avatar sprite"}),SJ(S5=Ek((S9=Ye((S6=function(p){Ie(o,p);var v,g,E,k=xe(o);function o(){var p;Ce(this,o);for(var v=arguments.length,g=new Array(v),E=0;E<v;E++)g[E]=arguments[E];return je(p=k.call.apply(k,[this].concat(g)),"sprite",S9,Ne(p)),je(p,"lockIcon",S8,Ne(p)),je(p,"animation",S7,Ne(p)),je(p,"opacity",Et,Ne(p)),je(p,"flashAnimation",En,Ne(p)),je(p,"unlockAnimation",Ei,Ne(p)),je(p,"spawnAnimation",Ea,Ne(p)),p}return Ae(o,[{key:"avatarSprite",get:function(){var p,v;return null!==(p=null===(v=this.sprite)||void 0===v?void 0:v.spriteFrame)&&void 0!==p?p:null},set:function(p){this.sprite&&(this.sprite.spriteFrame=p)}},{key:"playUnlockAnimation",value:(E=Ee(function(){var p,v,g,E,k,C,_,A,T,I,R;return _ts_generator(this,function(P){switch(P.label){case 0:p=this.playAnimation(this.unlockAnimation),v=this.lockIcon.position.x,g=this.lockIcon.position.y,E=[45,135],k=(Math.random()*(E[1]-E[0])+E[0])*(Math.PI/180),C=this.lockIcon.position.x+150*Math.cos(k),_=this.lockIcon.position.y+150*Math.sin(k),A=g-400,T=tJ.runTweenAsync(G(this.lockIcon).delay(.3).to(.2,{position:new ef(C,_,this.lockIcon.position.z)},{easing:"sineOut"}).to(.4,{position:new ef(C,A,this.lockIcon.position.z)},{easing:"cubicIn"})),I=[0,360],R=tJ.runTweenAsync(G(this.lockIcon).delay(.3).to(.6,{eulerAngles:new ef(0,0,Math.random()*(I[1]-I[0])*(C>v?-1:1))},{easing:"sineOut"}));return[4,Promise.all([p,T,R])];case 1:P.sent(),this.lockIcon.position=new ef(v,g,this.lockIcon.position.z),this.lockIcon.eulerAngles=new ef(0,0,0);return[2]}})}),function(){return E.apply(this,arguments)})},{key:"playFlashAnimation",value:(g=Ee(function(){var p,v,g;return _ts_generator(this,function(E){switch(E.label){case 0:p=this.node.position.y,v=this.playAnimation(this.flashAnimation),g=tJ.runTweenAsync(G(this.node).to(.1,{position:new ef(this.node.position.x,this.node.position.y+10,this.node.position.z)},{easing:"sineOut"}).to(.1,{position:new ef(this.node.position.x,p,this.node.position.z)},{easing:"sineIn"}));return[4,Promise.all([v,g])];case 1:E.sent();return[2]}})}),function(){return g.apply(this,arguments)})},{key:"playSpawnAnimation",value:function(){this.opacity.opacity=255,this.playAnimation(this.spawnAnimation)}},{key:"hideImmediately",value:function(){this.opacity.opacity=0,this.node.setScale(ef.ZERO)}},{key:"playAnimation",value:(v=Ee(function(p){return _ts_generator(this,function(v){switch(v.label){case 0:return[4,tJ.runAnimationAsync(this.animation,p.name)];case 1:v.sent();return[2]}})}),function(p){return v.apply(this,arguments)})},{key:"onLoad",value:function(){this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){var p=this;if(!this.sprite)throw new Error("JourneyLevelAvatar: Avatar node is required");if(!this.lockIcon)throw new Error("JourneyLevelAvatar: Lock icon is required");if(!this.flashAnimation)throw new Error("JourneyLevelAvatar: Flash animation is required");if(!this.unlockAnimation)throw new Error("JourneyLevelAvatar: Unlock animation is required");if(!this.animation)throw new Error("JourneyLevelAvatar: Animation component is required");if(!this.animation.clips.some(function(v){return null!==v&&(v.name===p.flashAnimation.name||v.name===p.unlockAnimation.name||v.name===p.spawnAnimation.name)}))throw new Error("JourneyLevelAvatar: Animation component does not contain required animations")}}]),o}(L)).prototype,"sprite",[SQ],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),S8=Ye(S6.prototype,"lockIcon",[SZ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),S7=Ye(S6.prototype,"animation",[S$],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Et=Ye(S6.prototype,"opacity",[S0],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),En=Ye(S6.prototype,"flashAnimation",[S1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ei=Ye(S6.prototype,"unlockAnimation",[S2],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ea=Ye(S6.prototype,"spawnAnimation",[S4],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ye(S6.prototype,"avatarSprite",[S3],Object.getOwnPropertyDescriptor(S6.prototype,"avatarSprite"),S6.prototype),S5=S6))||S5)||S5);g._RF.pop(),g._RF.push({},"a392bibG75JPKzG0y2ZS2YY","JourneyProgressBar",void 0);var E_,EA,ET,EI,ER,EP,EN,ED,EL,EO,EM,Ex,EF,EB,EU,Ez,EG,EY,Ej,EH,EV,Eq,EW=E.ccclass,EK=E.property,EX=E.executeInEditMode,EJ=(Eu=EW("JourneyProgressBar"),Ec=EK(rN),Eh=EK(I),Ed=EK(et),Ep=EK(F),Ef=EK(F),Ey=EK(x),Eu(Ev=EX((Em=Ye((Eg=function(p){Ie(i,p);var v,g=xe(i);function i(){var p;Ce(this,i);for(var v=arguments.length,E=new Array(v),k=0;k<v;k++)E[k]=arguments[k];return je(p=g.call.apply(g,[this].concat(E)),"progressBar",Em,Ne(p)),je(p,"progressLabel",Eb,Ne(p)),je(p,"labelUIOpacity",Ew,Ne(p)),p.currentProgress=10,p.totalProgress=10,p.labelSeparator="/",p}return Ae(i,[{key:"total",get:function(){return this.totalProgress}},{key:"current",get:function(){return this.currentProgress}},{key:"separator",get:function(){return this.labelSeparator},set:function(p){this.labelSeparator=p,this.updateProgress()}},{key:"setRange",value:function(p,v){this.totalProgress=v,p>v&&(p=v),this.currentProgress=p,this.updateProgress()}},{key:"onLoad",value:function(){this.validateRequiredComponents()}},{key:"animateTo",value:(v=Ee(function(p){var v,g,E,k,C,_,A,T,I,R,P,N,D,L,O,M;return _ts_generator(this,function(x){switch(x.label){case 0:v=this,g=p.nextCurr,E=p.nextTotal,k=p.numberOfProgressBar,C=void 0===k?0:k,_=p.onProgressBarPassed,A=p.signal,T=g/E,I=G(this.labelUIOpacity).to(.2,{opacity:0}),R=G(this.labelUIOpacity).to(.2,{opacity:255}),P=C<1?1:Math.sqrt(C)+1,N=0===C?T:C+T,D=1,L=this.progressBar.progress,O=N,M=tJ.runOnUpdateAsync(this.node,P,function(p){var g=ee.sineInOut(p),E=eP(L,O,g);v.progressBar.progress=E%1,E>D&&(D=0===E?1:Math.ceil(E),null==_||_())},A);return[4,Promise.all([tJ.runTweenAsync(I,A),M])];case 1:x.sent(),this.currentProgress=g,this.totalProgress=E,this.updateProgress();return[4,tJ.runTweenAsync(R,A)];case 2:return[2,(x.sent(),this.labelUIOpacity.opacity=255,T)]}})}),function(p){return v.apply(this,arguments)})},{key:"updateProgress",value:function(){this.progressBar.progress=this.currentProgress/this.totalProgress,this.progressLabel.string="".concat(this.currentProgress).concat(this.separator).concat(this.totalProgress)}},{key:"validateRequiredComponents",value:function(){if(!this.progressBar)throw new Error("JourneyProgressBar: Missing required component TapperedProgressBar");if(!this.progressLabel)throw new Error("JourneyProgressBar: Missing required component Label")}}]),i}(L)).prototype,"progressBar",[Ec],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Eb=Ye(Eg.prototype,"progressLabel",[Eh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ew=Ye(Eg.prototype,"labelUIOpacity",[Ed],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ye(Eg.prototype,"total",[Ep],Object.getOwnPropertyDescriptor(Eg.prototype,"total"),Eg.prototype),Ye(Eg.prototype,"current",[Ef],Object.getOwnPropertyDescriptor(Eg.prototype,"current"),Eg.prototype),Ye(Eg.prototype,"separator",[Ey],Object.getOwnPropertyDescriptor(Eg.prototype,"separator"),Eg.prototype),Ev=Eg))||Ev)||Ev);g._RF.pop(),g._RF.push({},"8a41bfxLylDhLk57kewW14A","JourneyProgressAnimator",void 0);var EQ,EZ,E$,E0,E1,E2,E4,E3,E5,E6,E9,E8,E7,kt,kn,ki,ka,kr=E.ccclass,ko=E.property,ks=GameCore.Utils.Array,kl=(E_=kr("ProgressConfiguration"),EA=ko(Z),ET=ko(x),E_((EP=Ye((ER=Ae(function e(){Ce(this,e),je(this,"avatar",EP,this),je(this,"themeId",EN,this)})).prototype,"avatar",[EA],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),EN=Ye(ER.prototype,"themeId",[ET],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),EI=ER))||EI),ku=(ED=kr("JourneyProgressAnimator"),EL=ko(EJ),EO=ko(k),EM=ko(V),Ex=ko(EC),EF=ko(kl),EB=ko({type:Y,displayName:"Next Level Y Offset on Animation",group:"Unlocked Animation"}),ED((EG=Ye((Ez=function(p){Ie(r,p);var v,g,E,k,C=xe(r);function r(){var p;Ce(this,r);for(var v=arguments.length,g=new Array(v),E=0;E<v;E++)g[E]=arguments[E];return je(p=C.call.apply(C,[this].concat(g)),"progressBar",EG,Ne(p)),je(p,"currentLevelAvatarNode",EY,Ne(p)),je(p,"currentLevelAvatar",Ej,Ne(p)),je(p,"nextLevelAvatar",EH,Ne(p)),je(p,"progressConfigs",EV,Ne(p)),je(p,"nextLevelYOffset",Eq,Ne(p)),p.isAnimating=!1,p}return Ae(r,[{key:"setRange",value:function(p,v){this.progressBar.setRange(p,v)}},{key:"animateTo",value:(k=Ee(function(p,v){var g;return _ts_generator(this,function(E){switch(E.label){case 0:if(this.isAnimating)return[2,(console.warn("JourneyProgressAnimator: animation already in progress"),Promise.resolve())];this.isAnimating=!0;g=p!==this.progressBar.current;if(!g)return[3,2];return[4,this.progressBar.animateTo({nextCurr:p,nextTotal:this.progressBar.total,signal:v})];case 1:g=E.sent();E.label=2;case 2:this.isAnimating=!1;return[2]}})}),function(p,v){return k.apply(this,arguments)})},{key:"animateToNextLevel",value:(E=Ee(function(p){var v,g,E,k,C,_,A,T,I;return _ts_generator(this,function(R){switch(R.label){case 0:v=this,g=p.nextCurr,E=p.nextTotal,k=p.mapsPassed,C=p.signal;if(!this.isAnimating)return[3,1];console.warn("JourneyProgressAnimator: animation already in progress");return[3,7];case 1:this.isAnimating=!0;_=k.length-2;if(0!==_)return[3,3];return[4,this.progressBar.animateTo({nextCurr:g,nextTotal:E,signal:C})];case 2:return[2,(R.sent(),void(this.isAnimating=!1))];case 3:return[4,this.animateTargetAvaToCenter(C)];case 4:R.sent();A=1;return[4,this.progressBar.animateTo({signal:C,nextCurr:g,nextTotal:E,numberOfProgressBar:_,onProgressBarPassed:function(){if(1===A)return v.nextLevelAvatar.playUnlockAnimation(),void(A+=1);if(A>=k.length)throw new Error("JourneyProgressAnimator: currThemeIndex out of bounds");v.nextLevelAvatar.playFlashAnimation(),v.setNextLevelAvatar(k[A].theme),A+=1}})];case 5:R.sent();return[4,this.animateTargetAvaToPrev(C)];case 6:R.sent();T=k[k.length-1].theme,I=k[k.length-2].theme;this.setCurrentLevelAvatar(I),this.nextLevelAvatar.hideImmediately(),this.moveTargetAvaToOriginal(),this.nextLevelAvatar.avatarSprite=this.getSpriteFrameByThemeId(T),this.nextLevelAvatar.playSpawnAnimation(),this.isAnimating=!1;R.label=7;case 7:return[2]}})}),function(p){return E.apply(this,arguments)})},{key:"animateTargetAvaToCenter",value:(g=Ee(function(p){var v;return _ts_generator(this,function(g){switch(g.label){case 0:v=new ef(0,this.nextLevelYOffset+this.nextLevelAvatar.node.position.y,this.nextLevelAvatar.node.position.z);return[4,tJ.runTweenAsync(G(this.nextLevelAvatar.node).to(1,{position:v},{easing:"cubicInOut"}),p)];case 1:g.sent(),this.nextLevelAvatar.node.position=v;return[2]}})}),function(p){return g.apply(this,arguments)})},{key:"moveTargetAvaToOriginal",value:function(){this.nextLevelAvatar.node.position=this.originalNextLevelAvatarPosition.clone()}},{key:"animateTargetAvaToPrev",value:(v=Ee(function(p){var v;return _ts_generator(this,function(g){switch(g.label){case 0:v=this.currentLevelAvatarNode.position.clone();return[4,tJ.runTweenAsync(G(this.nextLevelAvatar.node).to(1,{position:v},{easing:"cubicInOut"}),p)];case 1:g.sent(),this.nextLevelAvatar.node.position=v;return[2]}})}),function(p){return v.apply(this,arguments)})},{key:"getSpriteFrameByThemeId",value:function(p){var v=ks.search(this.progressConfigs,function(v){return v.themeId===p});if(!v)throw new Error("JourneyProgressController: config not found for themeId ".concat(p));return v.avatar}},{key:"setAvatar",value:function(p,v){var g=this.getSpriteFrameByThemeId(p);_instanceof(v,EC)?v.avatarSprite=g:v.spriteFrame=g}},{key:"setCurrentLevelAvatar",value:function(p){this.setAvatar(p,this.currentLevelAvatar)}},{key:"setNextLevelAvatar",value:function(p){this.setAvatar(p,this.nextLevelAvatar)}},{key:"onLoad",value:function(){this.validateRequiredComponents(),this.originalNextLevelAvatarPosition=this.nextLevelAvatar.node.position.clone()}},{key:"validateRequiredComponents",value:function(){e7.lazyValidateProperties(this)}}]),r}(L)).prototype,"progressBar",[EL],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),EY=Ye(Ez.prototype,"currentLevelAvatarNode",[EO],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ej=Ye(Ez.prototype,"currentLevelAvatar",[EM],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),EH=Ye(Ez.prototype,"nextLevelAvatar",[Ex],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),EV=Ye(Ez.prototype,"progressConfigs",[EF],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Eq=Ye(Ez.prototype,"nextLevelYOffset",[EB],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),EU=Ez))||EU);g._RF.pop(),g._RF.push({},"c2ddaEnKBVFvrM5x5nbfT7h","HomeContent",void 0);var kc,kh,kd,kp,kf,ky,kv,kg,km,kb,kw,kS,kE,kk,kC,k_=E.ccclass,kA=E.property,kT=globalThis.game.storage,kI=(EQ=k_("HomeContent"),EZ=kA(I),E$=kA(N),E0=kA(ku),E1=kA(a4),E2=kA(El),E4=kA(et),E3=kA(m5),EQ((E9=Ye((E6=function(p){Ie(a,p);var v,g,E=xe(a);function a(){var p;Ce(this,a);for(var v=arguments.length,g=new Array(v),k=0;k<v;k++)g[k]=arguments[k];return je(p=E.call.apply(E,[this].concat(g)),"playButtonLabel",E9,Ne(p)),je(p,"playButton",E8,Ne(p)),je(p,"journeyProgressAnimator",E7,Ne(p)),je(p,"panelAnimator",kt,Ne(p)),je(p,"dashboardHeader",kn,Ne(p)),je(p,"overlayDuringAnim",ki,Ne(p)),je(p,"coinContainer",ka,Ne(p)),p}return Ae(a,[{key:"__preload",value:function(){this.validateRequiredComponents()}},{key:"getCoinContainer",value:function(){return this.coinContainer}},{key:"handlePlayButtonPress",value:function(){this.playButton.interactable=!1,this.node.scene.emit(t8)}},{key:"setPlayButtonLabel",value:function(p){this.playButtonLabel.string=p}},{key:"updateStarProgress",value:function(p){this.dashboardHeader.updateStarProgress(p)}},{key:"setUnlockProgress",value:function(p){this.setProgress(p),this.updateCurrentMapInStorage(p)}},{key:"prepareUnlockProgressAnimation",value:function(p,v,g,E){var k=this;if(p.id===v.id){this.setProgress(we(we({},v),{},{progress:p.progress})),this.updateCurrentMapInStorage(v);var C=v.progress;return Ee(function(){return _ts_generator(this,function(p){switch(p.label){case 0:k.playButton.interactable=!1;return[4,k.showOwnOverlay(E)];case 1:p.sent();return[4,k.journeyProgressAnimator.animateTo(C,E)];case 2:p.sent();return[4,k.hideOwnOverlay(E)];case 3:p.sent(),k.playButton.interactable=!0;return[2]}})})}return this.setProgress(p),this.updateCurrentMapInStorage(v),Ee(function(){return _ts_generator(this,function(p){switch(p.label){case 0:k.playButton.interactable=!1;return[4,k.showOwnOverlay(E)];case 1:p.sent();return[4,k.journeyProgressAnimator.animateToNextLevel({nextCurr:v.progress,nextTotal:v.max,mapsPassed:g,signal:E})];case 2:p.sent();return[4,k.hideOwnOverlay(E)];case 3:p.sent(),k.playButton.interactable=!0;return[2]}})})}},{key:"hideOwnOverlay",value:(g=Ee(function(p){return _ts_generator(this,function(v){switch(v.label){case 0:return[4,tJ.runTweenAsync(G(this.overlayDuringAnim).to(.3,{opacity:0}),p)];case 1:v.sent(),this.overlayDuringAnim.opacity=0;return[2]}})}),function(p){return g.apply(this,arguments)})},{key:"showOwnOverlay",value:(v=Ee(function(p){return _ts_generator(this,function(v){switch(v.label){case 0:return[4,tJ.runTweenAsync(G(this.overlayDuringAnim).to(.3,{opacity:150}),p)];case 1:v.sent();return[2]}})}),function(p){return v.apply(this,arguments)})},{key:"setProgress",value:function(p){var v=p.currentTheme,g=p.nextTheme,E=p.progress,k=p.max;this.journeyProgressAnimator.setCurrentLevelAvatar(v),this.journeyProgressAnimator.setNextLevelAvatar(null!=g?g:v),this.journeyProgressAnimator.setRange(E,k)}},{key:"updateCurrentMapInStorage",value:function(p){kT.setStorageData("dashboard","animateToCurrentLevel",!1),kT.setStorageData("dashboard","lastMapPayload",p)}},{key:"enableUIAnimator",value:function(){this.panelAnimator.enabled=!0}},{key:"disableUIAnimator",value:function(){this.panelAnimator.enabled=!1}},{key:"validateRequiredComponents",value:function(){e7.lazyValidateProperties(this)}}]),a}(L)).prototype,"playButtonLabel",[EZ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),E8=Ye(E6.prototype,"playButton",[E$],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),E7=Ye(E6.prototype,"journeyProgressAnimator",[E0],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),kt=Ye(E6.prototype,"panelAnimator",[E1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),kn=Ye(E6.prototype,"dashboardHeader",[E2],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ki=Ye(E6.prototype,"overlayDuringAnim",[E4],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ka=Ye(E6.prototype,"coinContainer",[E3],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),E5=E6))||E5);g._RF.pop(),g._RF.push({},"f555belwQ1NHJr4np65OtcU","NavManager",void 0);var kR,kP,kN,kD,kL,kO,kM,kx,kF,kB,kU,kz,kG,kY=E.ccclass,kj=E.property,kH=globalThis.game.ads,kV=GameCore.Utils.Array,kq=(kc=kY("NavManager"),kh=kj(k),kd=kj(k),kp=kj(t3),kf=kj(es),ky=kj({type:j,visible:function(){return this.useOffsetWhenSAB}}),kv=kj({type:Y,visible:function(){return this.useOffsetWhenSAB}}),kc((kb=Ye((km=function(p){Ie(s,p);var v,g,E,k,C,_=xe(s);function s(){var p;Ce(this,s);for(var v=arguments.length,g=new Array(v),E=0;E<v;E++)g[E]=arguments[E];return je(p=_.call.apply(_,[this].concat(g)),"selectorNode",kb,Ne(p)),je(p,"selectedButtonNode",kw,Ne(p)),je(p,"autoLayout",kS,Ne(p)),je(p,"useOffsetWhenSAB",kE,Ne(p)),je(p,"offsetWidget",kk,Ne(p)),je(p,"offsetWhenSAB",kC,Ne(p)),p.navButtons=[],p.isNavigating=!1,p}return Ae(s,[{key:"currentButton",get:function(){return this.selectedButton}},{key:"onLoad",value:function(){var p;this.navButtons=this.node.getComponentsInChildren("NavButton"),this.selectedButton=null===(p=this.selectedButtonNode)||void 0===p?void 0:p.getComponentInChildren("NavButton"),e7.lazyValidateProperties(this)}},{key:"start",value:function(){this.useOffsetWhenSAB&&kH.getSafeAreaBottom(i_.cssSizeToWorldSize(1))>0&&(this.offsetWidget.bottom=this.offsetWhenSAB)}},{key:"select",value:(C=Ee(function(p){var v;return _ts_generator(this,function(g){v=this;if(!this.isNavigating){if(!kV.has(this.navButtons,p))throw new Error("NavManager: Button not found");if(p!==this.selectedButton){if(!p.isWIP)return[2,(this.isNavigating=!0,this.node.scene.emit(t7,{from:this.selectedButton.buttonType,to:p.buttonType}),new Promise(function(g){v.node.scene.once(ne,function(){var E=v.selectedButton.deselect();v.autoLayout.selectedIndex=v.navButtons.indexOf(p),v.selectedButton=p;var k=v.autoLayout.getSelectedWorldX()-p.getSelectedWorldDistanceX(),C=v.playSelectorAnimation(k),_=p.select();Promise.all([E,_,C]).then(function(){v.isNavigating=!1,g()})})}))];this.handleWIPButton()}}return[2]})}),function(p){return C.apply(this,arguments)})},{key:"selectUsingSceneTransition",value:(k=Ee(function(p){var v,g;return _ts_generator(this,function(E){switch(E.label){case 0:v=this.isNavigating;if(v)return[3,4];if(!kV.has([nn.store],p.buttonType))return[3,1];g=this.handleWIPButton();return[3,3];case 1:return[4,this.select(p)];case 2:g=E.sent();E.label=3;case 3:v=g;E.label=4;case 4:return[2]}})}),function(p){return k.apply(this,arguments)})},{key:"selectByType",value:(E=Ee(function(p){var v;return _ts_generator(this,function(g){switch(g.label){case 0:v=kV.search(this.navButtons,function(v){return v.buttonType===p});if(!v)throw new Error("NavManager: Button not found");return[4,this.selectUsingSceneTransition(v)];case 1:g.sent();return[2]}})}),function(p){return E.apply(this,arguments)})},{key:"handleWIPButton",value:function(){s8.openScreen(nH.STAR_CHEST_SCREEN)}},{key:"selectDefaultNavBtn",value:(g=Ee(function(){var p,v;return _ts_generator(this,function(g){p=this;if(!this.currentButton||!kV.has(this.navButtons,this.currentButton))throw new Error("NavManager: Button not found");v=this.currentButton.buttonType;return[2,(this.node.scene.emit(t7,{from:null,to:v}),new Promise(function(v){p.node.scene.once(ne,function(){p.autoLayout.selectedIndex=p.navButtons.indexOf(p.currentButton);var g=p.navButtons.map(function(v){return v===p.currentButton?v.select(!1):v.deselect(!1,!0)}),E=p.autoLayout.getSelectedWorldX()-p.currentButton.getSelectedWorldDistanceX();p.selectorNode.worldPosition=new ef(E,p.selectorNode.worldPosition.y,0),Promise.all(g).then(function(){v()})})}))]})}),function(){return g.apply(this,arguments)})},{key:"playSelectorAnimation",value:(v=Ee(function(p){var v,g,E,k;return _ts_generator(this,function(C){switch(C.label){case 0:v=this,g=new ef(1,1,1),E=this.selectorNode.worldPosition.clone(),k=new ef(1.2*g.x,.8*g.y,1);return[4,tJ.runTweenAsync(G(this.selectorNode).to(.3,{worldPosition:new ef(p,E.y,0)},{easing:"quintInOut",onUpdate:function(p,E){if(void 0!==E){var C=v.calculateCurrentSquashScale(g,k,E);v.selectorNode.scale=C}}}))];case 1:C.sent();return[2]}})}),function(p){return v.apply(this,arguments)})},{key:"setIgnoreInput",value:function(p){var v=!(arguments.length>0&&void 0!==p)||p;this.navButtons.forEach(function(p){var g=p.getComponentInChildren(N);g&&(g.interactable=!v)})}},{key:"calculateCurrentSquashScale",value:function(p,v,g){var E=this.splitIntoSquashRatio(g);return p.clone().lerp(v,E)}},{key:"splitIntoSquashRatio",value:function(p){return p<.5?2*p:1-2*(p-.5)}}]),s}(L)).prototype,"selectorNode",[kh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),kw=Ye(km.prototype,"selectedButtonNode",[kd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),kS=Ye(km.prototype,"autoLayout",[kp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),kE=Ye(km.prototype,"useOffsetWhenSAB",[kf],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),kk=Ye(km.prototype,"offsetWidget",[ky],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),kC=Ye(km.prototype,"offsetWhenSAB",[kv],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),kg=km))||kg);g._RF.pop(),g._RF.push({},"d48a1TnKg1F4YRzzKmQOD5k","DashboardScene",void 0);var kW,kK,kX,kJ,kQ=E.ccclass,kZ=E.disallowMultiple,k$=E.property,k0=globalThis.game,k1=k0.event,k2=k0.storage,k4=k0.player,k3=k0.leaderboard,k5=GameCore,k6=k5.Events,k9=k5.Match.Modes,k8=k5.Configs.DailyRewards,k7=k5.Utils,Ct=k7.Time,Cn=k7.Json,Ci=k7.Array;kR=kQ("DashboardScene"),kP=k$(v6),kN=k$(kq),kD=k$(nM),kL=k$(SA),kO=k$(mU),kR(kM=kZ((kF=Ye((kx=function(p){Ie(l,p);var v,g,E,k,C,_,A=xe(l);function l(){var p;Ce(this,l);for(var v=arguments.length,g=new Array(v),E=0;E<v;E++)g[E]=arguments[E];return je(p=A.call.apply(A,[this].concat(g)),"coinManager",kF,Ne(p)),je(p,"navManager",kB,Ne(p)),je(p,"bgComp",kU,Ne(p)),je(p,"pageManager",kz,Ne(p)),je(p,"pageAnimSkipOverlay",kG,Ne(p)),p.firstNavigation=!0,p.isFirstNavToCollections=!0,p.playBgAnim=Ee(function(){var v,g,E,k,C,_,A;return _ts_generator(this,function(T){switch(T.label){case 0:g=k2.getStorage("dashboard");if(null==g)throw new Error("DashboardScene: dashboardStorage not found");E=null!==(v=g.animateToCurrentLevel)&&void 0!==v&&v,k=we({},g.lastMapPayload),C=sS.getCurrentMapProgress(),_=k.currentTheme===C.currentTheme&&k.nextTheme===C.nextTheme,A=C.currentTheme;if(!(E&&!_))return[3,5];return[4,tJ.waitTweenAsync(2)];case 1:T.sent();T.label=2;case 2:T.trys.push([2,4,,5]);return[4,p.bgComp.animateToNextTheme(A)];case 3:T.sent();return[3,5];case 4:T.sent();return[3,5];case 5:return[2]}})}),p.handlePlayButtonPress=Ee(function(){var v,g,E,k,C,_,A,T;return _ts_generator(this,function(I){switch(I.label){case 0:I.trys.push([0,4,,5]);g=sS.getCurrentMapProgress(),E=(null!==(v=k4.getGameData())&&void 0!==v?v:{}).level,k=void 0===E?1:E;C=Promise.all;return[4,sx.setMatchCustomDataAsync({level:k})];case 1:_=[I.sent()];return[4,sx.startMatchAsync(k9.SINGLE)];case 2:return[4,C.apply(Promise,[_.concat([I.sent()])])];case 3:I.sent(),p.updateCurrentMapInStorage(g),k2.setStorageData("collection","lastMapPack",g.id),k2.setStorageData("collection","animateMapPackUnlock",!1);A=k2.getStorage("leaderboard_content").lastTabOpened;p.getPlayerLeader(A).then(function(p){if(p){var v=p.score,g=p.rank;k2.setStorageData("leaderboard_content","previousScore",v),k2.setStorageData("leaderboard_content","previousRank",g)}}),sq.switchScene(o9,{level:k});return[3,5];case 4:T=I.sent();return[2,void console.error(T)];case 5:return[2]}})}),p.onNavigate=function(){var v=Ee(function(v){var g;return _ts_generator(this,function(E){switch(E.label){case 0:g=(p.firstNavigation&&(p.firstNavigation=!1,p.pageManager.unmountAndHideAll()),v.to);switch(g){case nn.store:return[3,1];case nn.collections:return[3,3];case nn.tournaments:return[3,5];case nn.leaderboard:return[3,7];case nn.home:return[3,9]}return[3,11];case 1:p.navManager.setIgnoreInput();return[4,p.pageManager.navigate(v)];case 2:E.sent(),p.handleNavigateToStore(),p.navManager.setIgnoreInput(!1);return[3,12];case 3:return[4,p.onNavigateToCollections(we(we({},v),{},{to:nn.collections}))];case 4:E.sent();return[3,12];case 5:return[4,p.onNavigateToTournaments(v)];case 6:E.sent();return[3,12];case 7:return[4,p.onNavigateToLeaderboard(we(we({},v),{},{to:nn.leaderboard}))];case 8:E.sent();return[3,12];case 9:return[4,p.handleNavigateToHome(v)];case 10:E.sent();return[3,12];case 11:throw new Error("DashboardScene: Unhandled page name");case 12:return[2]}})});return function(p){return v.apply(this,arguments)}}(),p.handleEventButtonPress=function(p){switch(p.type){case yj.STAR_CHEST:s8.openScreen(nH.STAR_CHEST_SCREEN);break;case yj.BALLOON:s8.showNotificationScreen("Coming soon!");break;default:throw new Error("DashboardScene: Unhandled event button type")}},p}return Ae(l,[{key:"__preload",value:function(){this.panelAnimationController=this.getComponent(aK),this.validateRequiredComponents(),this.listenNavigationEvents(),this.listenDashboardEvents(),this.panelAnimationController.init()}},{key:"listenNavigationEvents",value:function(){this.node.scene.on(t7,this.onNavigate)}},{key:"listenDashboardEvents",value:function(){this.node.scene.on(t8,this.handlePlayButtonPress),this.node.scene.on(nt,this.handleEventButtonPress)}},{key:"onLoad",value:function(){this.coinManager.init(this.pageAnimSkipOverlay),sS.init(),this.setPlayerLevel(),this.initBgComp(),this.pageManager.updateCollectionsContentPayload(sS.getCollectionUnlockProgress())}},{key:"setPlayerLevel",value:function(){var p,v=(null!==(p=k4.getGameData())&&void 0!==p?p:{}).level,g=void 0===v?1:v;g=0===g?1:g,k4.setGameData({level:g})}},{key:"start",value:function(){k4.getPlayerSetting("music")&&nQ.playMusic(),this.playBgAnim(),this.navManager.selectDefaultNavBtn(),this.updateVolumeBackgroundMusic(),this.scheduleOnce(this.preloadScenes,2)}},{key:"preloadScenes",value:function(){sq.preloadGameScene()}},{key:"initBgComp",value:function(){var p,v=k2.getStorage("dashboard");if(null==v)throw new Error("DashboardScene: dashboardStorage not found");var g=null!==(p=v.animateToCurrentLevel)&&void 0!==p&&p,E=we({},v.lastMapPayload),k=sS.getCurrentMapProgress(),C=E.currentTheme===k.currentTheme&&E.nextTheme===k.nextTheme,_=k.currentTheme;g&&!C?this.bgComp.setCurrentTheme(E.currentTheme):this.bgComp.setCurrentTheme(_)}},{key:"getPlayerLeader",value:(_=Ee(function(p){var v,g,E;return _ts_generator(this,function(k){switch(k.label){case 0:v="global"==p?o0:o1;if(!v)return[2,null];g=k4.getPlayerId();return[4,k3.getLeadersByPlayerIdsAsync(v,[g])];case 1:E=k.sent();return[2,0===E.length?null:E[0]]}})}),function(p){return _.apply(this,arguments)})},{key:"updateCurrentMapInStorage",value:function(p){k2.setStorageData("dashboard","animateToCurrentLevel",!1),k2.setStorageData("dashboard","lastMapPayload",p)}},{key:"updateVolumeBackgroundMusic",value:function(){nQ.turnUpMusic()}},{key:"checkDailyRewardsOpenable",value:function(){var p=k4.getPlayerData().dailyRewarded,v=p.logDays,g=void 0===v?[]:v,E=p.lastRewarded,k=void 0===E?0:E;if(g.length>k8.MaxDays)return!0;if(k8.MockTime>0&&Date.now()-k>=1e3*k8.MockTime)return!0;return!Ct.isToday(k)}},{key:"validateRequiredComponents",value:function(){e7.lazyValidateProperties(this)}},{key:"handleNavigateToStore",value:function(){}},{key:"onNavigateToCollections",value:(C=Ee(function(p){var v,g,E,k,C,_,A,T;return _ts_generator(this,function(I){switch(I.label){case 0:this.navManager.setIgnoreInput();g=sS.getCollectionUnlockProgress(),E=this.getCurrentUnlockingTheme();return[4,this.pageManager.navigate(p,function(p){return(v=p.getContainer().getComponentInChildren(wG)).updateUnlockedProgress(g),Promise.resolve()})];case 1:if(I.sent(),void 0===v)throw new Error("CollectionsContent not found");k=new na,C=v.shouldAnimateThemeTabUnlock();_=C;if(!_)return[3,3];return[4,this.pageAnimSkipOverlay.open({onSkip:function(){return k.abort()},opacity:200})];case 2:_=I.sent();I.label=3;case 3:A=this.isFirstNavToCollections&&null!==E;if(!A)return[3,5];return[4,v.scrollToCurrentUnlockingTheme(E.skin,k)];case 4:A=(I.sent(),this.isFirstNavToCollections=!1);I.label=5;case 5:return[4,v.playThemeTabUnlockAnim(k)];case 6:I.sent();T=C;if(!T)return[3,8];return[4,this.pageAnimSkipOverlay.close()];case 7:T=I.sent();I.label=8;case 8:k.abort(),this.navManager.setIgnoreInput(!1);return[2]}})}),function(p){return C.apply(this,arguments)})},{key:"onNavigateToTournaments",value:(k=Ee(function(p){return _ts_generator(this,function(v){switch(v.label){case 0:this.navManager.setIgnoreInput();return[4,this.pageManager.navigate(p)];case 1:v.sent(),this.navManager.setIgnoreInput(!1);return[2]}})}),function(p){return k.apply(this,arguments)})},{key:"onNavigateToLeaderboard",value:(E=Ee(function(p){return _ts_generator(this,function(v){switch(v.label){case 0:this.navManager.setIgnoreInput();return[4,this.pageManager.navigate(p)];case 1:v.sent(),this.navManager.setIgnoreInput(!1);return[2]}})}),function(p){return E.apply(this,arguments)})},{key:"setHomeDataAndGetNavAnim",value:function(){var p,v,g,E,k,C=this,_=this.pageManager.getPage(nn.home).getContainer().getComponentInChildren(kI);this.coinManager.setTargetContainer(_.getCoinContainer());var A=null!==(p=null===(v=k4.getGameData())||void 0===v?void 0:v.level)&&void 0!==p?p:1,T="Level ".concat(A);_.setPlayButtonLabel(T),this.coinManager.emitCoinAmount();var I=null!==(g=null===(E=k4.getGameData())||void 0===E?void 0:E.stars)&&void 0!==g?g:0;_.updateStarProgress(I);var R=k2.getStorage("dashboard");if(null==R)throw new Error("DashboardScene: dashboardStorage not found");var P=null!==(k=R.animateToCurrentLevel)&&void 0!==k&&k,N=we({},R.lastMapPayload),D=we({},sS.getCurrentMapProgress());if(k2.getStorage("tournament").animateTournamentLeader)return _.setUnlockProgress(D),Ee(function(){return _ts_generator(this,function(p){switch(p.label){case 0:return[4,C.navManager.selectByType(nn.tournaments)];case 1:p.sent();return[2]}})});if(Cn.encode(N)===Cn.encode(D))_.setUnlockProgress(D);else if(P){var L=Ci.searchIndex(su.mapOrder,function(p){return p.id===N.id}),O=Ci.searchIndex(su.mapOrder,function(p){return p.id===D.id}),M=L===O;if(-1===L||-1===O)throw new Error("DashboardScene: map not found");if(!(L>O)){var x=su.mapOrder.slice(L,O+2),F=new na,B=_.prepareUnlockProgressAnimation(N,D,x,F);return Ee(function(){var p;return _ts_generator(this,function(v){switch(v.label){case 0:return[4,C.pageAnimSkipOverlay.open({onSkip:function(){return F.abort()},opacity:150})];case 1:v.sent();return[4,B()];case 2:v.sent();p=F.aborted||M;if(p)return[3,4];return[4,C.navManager.selectByType(nn.collections)];case 3:p=v.sent();v.label=4;case 4:return[4,C.pageAnimSkipOverlay.close()];case 5:v.sent();return[2]}})})}_.setUnlockProgress(D)}else _.setUnlockProgress(D)}},{key:"handleNavigateToHome",value:(g=Ee(function(p){var v,g,E;return _ts_generator(this,function(k){switch(k.label){case 0:E=this;this.navManager.setIgnoreInput();return[4,this.pageManager.navigate(p,Ee(function(){return _ts_generator(this,function(p){g=E.setHomeDataAndGetNavAnim();return[2]})}))];case 1:k.sent(),this.navManager.setIgnoreInput(!1);return[4,this.tryOpenDailyRewardsScreen()];case 2:k.sent();return[4,this.coinManager.untilFinishesCollectAnim()];case 3:k.sent();return[4,this.pageAnimSkipOverlay.untilClosed()];case 4:k.sent();return[4,null===(v=g)||void 0===v?void 0:v()];case 5:k.sent();return[2]}})}),function(p){return g.apply(this,arguments)})},{key:"tryOpenDailyRewardsScreen",value:(v=Ee(function(){return _ts_generator(this,function(p){if(this.checkDailyRewardsOpenable())return[2,(s8.openScreen(nH.DAILY_REWARDS_SCREEN),new Promise(function(p){k1.on(k6.CLOSED_SCREEN,function t(v){v.screenName===nV[nH.DAILY_REWARDS_SCREEN]&&(p(),k1.off(k6.CLOSED_SCREEN,t))})}))];return[2]})}),function(){return v.apply(this,arguments)})},{key:"getCurrentUnlockingTheme",value:function(){var p=sS.getCollectionUnlockProgress();if(0===p.length)return null;var v,g=p[0],E=We(p);try{for(E.s();!(v=E.n()).done;){var k=v.value;k.isLocked||(g=k)}}catch(p){E.e(p)}finally{E.f()}return g}}]),l}(L)).prototype,"coinManager",[kP],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),kB=Ye(kx.prototype,"navManager",[kN],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),kU=Ye(kx.prototype,"bgComp",[kD],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),kz=Ye(kx.prototype,"pageManager",[kL],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),kG=Ye(kx.prototype,"pageAnimSkipOverlay",[kO],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),kM=kx))||kM);g._RF.pop(),g._RF.push({},"53f87ljsxFJUKsBbXk8WVkJ","HomePage",void 0);var Ca,Cr=E.ccclass,Co=E.property,Cs=globalThis.game.player,Cl=GameCore.Utils.Number;kW=Cr("HomePage"),kK=Co({type:I,group:"Placeholders"}),kW((kJ=Ye((kX=function(p){Ie(r,p);var v,g,E,k,C=xe(r);function r(){var p;Ce(this,r);for(var v=arguments.length,g=new Array(v),E=0;E<v;E++)g[E]=arguments[E];return je(p=C.call.apply(C,[this].concat(g)),"coinLabel",kJ,Ne(p)),p}return Ae(r,[{key:"__preload",value:function(){var p;null===(p=Fe(Pe(r.prototype),"__preload",this))||void 0===p||p.call(this),this.validateOwnRequiredComponents(),this.listenToCoinUpdateEvent()}},{key:"listenToCoinUpdateEvent",value:function(){this.node.scene.on(aR.COIN_CHANGED,this.updateplaceholderCoins,this)}},{key:"updateplaceholderCoins",value:(k=Ee(function(p){return _ts_generator(this,function(v){this.coinLabel.string=Cl.getShortNumber(p.coins,3);return[2]})}),function(p){return k.apply(this,arguments)})},{key:"mount",value:(E=Ee(function(){var p,v,g;return _ts_generator(this,function(E){switch(E.label){case 0:return[4,Fe(Pe(r.prototype),"mount",this).call(this)];case 1:if(E.sent(),!this.homeContent&&(this.homeContent=this.container.getComponentInChildren(kI),!this.homeContent))throw new Error("HomePage: homeContent not found");g=null!==(p=null===(v=Cs.getGameData())||void 0===v?void 0:v.coins)&&void 0!==p?p:0;this.updateplaceholderCoins({coins:g});return[2]}})}),function(){return E.apply(this,arguments)})},{key:"transitionIn",value:(g=Ee(function(){return _ts_generator(this,function(p){switch(p.label){case 0:return[4,Fe(Pe(r.prototype),"transitionIn",this).call(this)];case 1:p.sent(),this.homeContent.enableUIAnimator();return[2]}})}),function(){return g.apply(this,arguments)})},{key:"transitionOut",value:(v=Ee(function(){return _ts_generator(this,function(p){switch(p.label){case 0:this.homeContent.disableUIAnimator();return[4,Fe(Pe(r.prototype),"transitionOut",this).call(this)];case 1:p.sent();return[2]}})}),function(){return v.apply(this,arguments)})},{key:"validateOwnRequiredComponents",value:function(){if(!this.coinLabel)throw new Error("HomePage: coinLabel not found")}}]),r}(bF)).prototype,"coinLabel",[kK],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),kX));g._RF.pop(),g._RF.push({},"332aaP3dkhKxZNHiMFB1bKn","LeaderboardIsEmpty",void 0);var Cu,Cc,Ch,Cd,Cp,Cf,Cy,Cv,Cg,Cm,Cb,Cw,CS,CE,Ck,CC,C_,CA,CT,CI,CR=(0,E.ccclass)("LeaderboardIsEmpty")(Ca=function(p){Ie(i,p);var v,g=xe(i);function i(){return Ce(this,i),g.apply(this,arguments)}return Ae(i,[{key:"onLoad",value:function(){this.uiOpacity=this.getComponent(et),this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){e7.lazyValidateProperties(this)}},{key:"show",value:(v=Ee(function(){var p,v,g;return _ts_generator(this,function(E){switch(E.label){case 0:this.uiOpacity.opacity=255;p=this.node.position.clone(),v=G(this.node);v.to(.05,{position:p.clone().add3f(5,0,0)}),v.to(.05,{position:p.clone().add3f(-5,0,0)});g=G(this.node).repeat(2,v);g.to(.05,{position:p});return[4,tJ.runTweenAsync(g)];case 1:E.sent();return[2]}})}),function(){return v.apply(this,arguments)})},{key:"hide",value:function(){this.uiOpacity.opacity=0}}]),i}(L))||Ca;g._RF.pop(),g._RF.push({},"aa4b0d0u0hLeqd3+/PQZ/QD","SwitchButton",void 0);var CP,CN,CD,CL,CO,CM,Cx,CF=E.ccclass,CB=E.property,CU=E.requireComponent,Cz=globalThis.game.analytics,CG=GameCore,CY=CG.Utils.Array,Cj=CG.Plugins.Analytics.Events,CH=(Cu=CF("SwitchButton"),Cc=CU([N,M]),Ch=CB(es),Cd=CB(k),Cp=CB(k),Cf=CB(es),Cy=CB({visible:function(){return this.useSound},type:nz}),Cv=CB(es),Cg=CB({visible:function(){return this.useDesktopHover},type:J}),Cm=CB({visible:function(){return this.useDesktopHover},type:J}),Cu(Cb=Cc((CS=Ye((Cw=function(p){Ie(n,p);var v=xe(n);function n(){var p;Ce(this,n);for(var g=arguments.length,E=new Array(g),k=0;k<g;k++)E[k]=arguments[k];return je(p=v.call.apply(v,[this].concat(E)),"enable",CS,Ne(p)),je(p,"nodeOn",CE,Ne(p)),je(p,"nodeOff",Ck,Ne(p)),je(p,"useSound",CC,Ne(p)),je(p,"soundKey",C_,Ne(p)),je(p,"useDesktopHover",CA,Ne(p)),je(p,"mouseEnterClip",CT,Ne(p)),je(p,"mouseLeaveClip",CI,Ne(p)),p.isMouseLeaved=!1,p.onMouseEnter=function(v){p.useDesktopHover&&p.buttonComponent.interactable&&(p.isMouseLeaved=!1,p.animationComponent.play(p.mouseEnterClip.name))},p.onMouseLeave=function(v){p.useDesktopHover&&p.buttonComponent.interactable&&(p.isMouseLeaved||(p.isMouseLeaved=!0,p.animationComponent.play(p.mouseLeaveClip.name)))},p}return Ae(n,[{key:"__preload",value:function(){this.buttonComponent=this.getComponent(N),this.animationComponent=this.getComponent(M),this.validateRequiredComponents()}},{key:"onLoad",value:function(){var p=this.animationComponent.clips.map(function(p){return null==p?void 0:p.name}).filter(function(p){return null!=p&&"string"==typeof p});this.useDesktopHover&&(CY.has(p,this.mouseEnterClip.name)||this.animationComponent.addClip(this.mouseEnterClip),CY.has(p,this.mouseLeaveClip.name)||this.animationComponent.addClip(this.mouseLeaveClip))}},{key:"validateRequiredComponents",value:function(){e7.lazyValidateProperties(this)}},{key:"onEnable",value:function(){this.node.on(k.EventType.MOUSE_ENTER,this.onMouseEnter),this.node.on(k.EventType.MOUSE_LEAVE,this.onMouseLeave)}},{key:"onDisable",value:function(){this.node.off(k.EventType.MOUSE_ENTER,this.onMouseEnter),this.node.off(k.EventType.MOUSE_LEAVE,this.onMouseLeave)}},{key:"switch",value:function(){return!!this.node.active&&(Cz.event(Cj.BUTTON_CLICK,{button_name:this.node.name,enable:!this.enable}),this.useSound&&nQ.playSound(nj[this.soundKey]),this.updateStatus(!this.enable))}},{key:"setEnabled",value:function(p){this.node.active&&this.updateStatus(p)}},{key:"updateStatus",value:function(p){return this.enable===p||(this.onMouseLeave(null),this.enable=p,this.nodeOn.active=p,this.nodeOff.active=!p),this.enable}}]),n}(L)).prototype,"enable",[Ch],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),CE=Ye(Cw.prototype,"nodeOn",[Cd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ck=Ye(Cw.prototype,"nodeOff",[Cp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),CC=Ye(Cw.prototype,"useSound",[Cf],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),C_=Ye(Cw.prototype,"soundKey",[Cy],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return nz[nB.BUTTON_CLICK]}}),CA=Ye(Cw.prototype,"useDesktopHover",[Cv],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),CT=Ye(Cw.prototype,"mouseEnterClip",[Cg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),CI=Ye(Cw.prototype,"mouseLeaveClip",[Cm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Cb=Cw))||Cb)||Cb);g._RF.pop(),g._RF.push({},"2871awUXL9J0I+rBEFNHN7o","Tabs",void 0);var CV,Cq,CW,CK,CX,CJ=E.ccclass,CQ=E.property,CZ=globalThis.game.analytics,C$=GameCore.Plugins.Analytics.Events,C0=(CP=CJ("Tabs"),CN=CQ(CH),CD=CQ(CH),CP((CM=Ye((CO=function(p){Ie(n,p);var v=xe(n);function n(){var p;Ce(this,n);for(var g=arguments.length,E=new Array(g),k=0;k<g;k++)E[k]=arguments[k];return je(p=v.call.apply(v,[this].concat(E)),"tabWorld",CM,Ne(p)),je(p,"tabFriends",Cx,Ne(p)),p}return Ae(n,[{key:"onLoad",value:function(){this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){if(!this.tabWorld)throw new Error("Tabs: tabWorld not found");if(!this.tabFriends)throw new Error("Tabs: tabFriends not found")}},{key:"setInteractableButtons",value:function(p){this.tabWorld.getComponent(N).interactable=p,this.tabFriends.getComponent(N).interactable=p}},{key:"updateStatus",value:function(p){this.tabWorld.setEnabled("global"===p),this.tabFriends.setEnabled("friends"===p)}},{key:"handleTabWorldSelect",value:function(){this.tabWorld.setEnabled(!0),this.tabFriends.setEnabled(!1),CZ.event(C$.BUTTON_CLICK,{button_name:this.node.name,screen_name:nJ.getCurrentPage()}),this.node.scene.emit(yH.WORLD_TAB_SELECTED)}},{key:"handleTabFriendsSelect",value:function(){this.tabWorld.setEnabled(!1),this.tabFriends.setEnabled(!0),CZ.event(C$.BUTTON_CLICK,{button_name:this.node.name,screen_name:nJ.getCurrentPage()}),this.node.scene.emit(yH.FRIENDS_TAB_SELECTED)}}]),n}(L)).prototype,"tabWorld",[CN],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Cx=Ye(CO.prototype,"tabFriends",[CD],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),CL=CO))||CL);g._RF.pop(),g._RF.push({},"69c90PvoTtGfZyDw8FbbOvV","LeaderSkeleton",void 0);var C1,C2,C4,C3,C5,C6,C9,C8,C7,_t,_n,_i,_a,_r,_o,_s,_l,_u,_c,_h,_d,_p,_f,_y,_v,_g,_m,_b,_w,_S,_E,_k,_C,__,_A,_T,_I,_R,_P,_N,_D,_L=E.ccclass,_O=E.disallowMultiple,_M=E.property,_x=(CV=_L("LeaderSkeleton"),Cq=_M(k),CV(CW=_O((CX=Ye((CK=function(p){Ie(a,p);var v,g,E=xe(a);function a(){var p;Ce(this,a);for(var v=arguments.length,g=new Array(v),k=0;k<v;k++)g[k]=arguments[k];return je(p=E.call.apply(E,[this].concat(g)),"container",CX,Ne(p)),p}return Ae(a,[{key:"__preload",value:function(){this.uiOpacity=this.getComponent(et),this.validateRequiredComponents()}},{key:"hide",value:(g=Ee(function(p){var v;return _ts_generator(this,function(g){switch(g.label){case 0:v=this;return[4,tJ.runTweenAsync(G(this.uiOpacity).to(.2,{opacity:0}).call(function(){v.node.active=!1}),p)];case 1:g.sent();return[2]}})}),function(p){return g.apply(this,arguments)})},{key:"show",value:(v=Ee(function(p,v){var g,E,k,C;return _ts_generator(this,function(_){switch(_.label){case 0:this.node.active=!0,this.node.scale=new ef(.8,.8,.8),this.uiOpacity.opacity=0;g=this.container.position.clone();this.container.position=new ef(g.x,g.y-100,g.z);E=G(this.node).delay(p);E.to(.2,{scale:ef.ONE},{easing:"cubicOut"});k=G(this.container).delay(p);k.to(.2,{position:g},{easing:"cubicOut"});C=G(this.uiOpacity).delay(p);C.to(.2,{opacity:255},{easing:"cubicOut"});return[4,Promise.all([tJ.runTweenAsync(E,v),tJ.runTweenAsync(k,v),tJ.runTweenAsync(C,v)])];case 1:_.sent();return[2]}})}),function(p,g){return v.apply(this,arguments)})},{key:"validateRequiredComponents",value:function(){if(!this.uiOpacity)throw new Error("UIOpacity component is not attached to the same node");if(!this.container)throw new Error("Container is not attached to the same node")}}]),a}(L)).prototype,"container",[Cq],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),CW=CK))||CW)||CW);g._RF.pop(),g._RF.push({},"53da1+ne4RJ4p0kTjp52K/1","Leader",void 0);var _F,_B,_U,_z,_G,_Y,_j,_H,_V,_q,_W,_K,_X,_J=E.ccclass,_Q=E.property,_Z=GameCore.Utils.Number,_$=(C1=_J("Leader"),C2=_Q(I),C4=_Q(et),C3=_Q({type:k,group:"Container"}),C5=_Q({type:V,group:"Background"}),C6=_Q({type:Z,group:"Background"}),C9=_Q({type:V,group:"Rank"}),C8=_Q({type:I,group:"Rank"}),C7=_Q({type:Z,group:"Rank"}),_t=_Q({type:Z,group:"Rank"}),_n=_Q({type:Z,group:"Rank"}),_i=_Q({type:Z,group:"Rank"}),_a=_Q({type:V,group:"Avatar"}),_r=_Q({type:et,group:"Avatar"}),_o=_Q({type:V,group:"Score"}),_s=_Q({type:I,group:"Score"}),_l=_Q({type:Z,group:"Score"}),_u=_Q({type:et,group:"Score"}),_c=_Q({type:et}),_h=_Q({type:A}),C1((_f=Ye((_p=function(p){Ie(l,p);var v,g,E,k,_,A=xe(l);function l(){var p;Ce(this,l);for(var v=arguments.length,g=new Array(v),E=0;E<v;E++)g[E]=arguments[E];return je(p=A.call.apply(A,[this].concat(g)),"nameLabel",_f,Ne(p)),je(p,"nameOpacity",_y,Ne(p)),je(p,"container",_v,Ne(p)),je(p,"background",_g,Ne(p)),je(p,"highlightBackground",_m,Ne(p)),je(p,"rankSprite",_b,Ne(p)),je(p,"rankLabel",_w,Ne(p)),je(p,"goldRank",_S,Ne(p)),je(p,"silverRank",_E,Ne(p)),je(p,"bronzeRank",_k,Ne(p)),je(p,"highlightRank",_C,Ne(p)),je(p,"avatar",__,Ne(p)),je(p,"avatarOpacity",_A,Ne(p)),je(p,"scoreBackground",_T,Ne(p)),je(p,"scoreLabel",_I,Ne(p)),je(p,"highlightScoreBackground",_R,Ne(p)),je(p,"scoreOpacity",_P,Ne(p)),je(p,"uiOpacity",_N,Ne(p)),je(p,"uiTransform",_D,Ne(p)),p}return Ae(l,[{key:"onLoad",value:function(){this.defaultBackground=this.background.spriteFrame,this.defaultRank=this.rankSprite.spriteFrame,this.defaultScoreBackground=this.scoreBackground.spriteFrame,this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){e7.lazyValidateProperties(this)}},{key:"updateInfo",value:function(p,v){this.updateBackground(p),this.updateRank(p,v),this.resetPhoto(),this.updateUsername(p),this.updateScore(p)}},{key:"updateBackground",value:function(p){this.background.spriteFrame=p.isHighlight?this.highlightBackground:this.defaultBackground}},{key:"updateRank",value:function(p,v){var g=p.rank;if(this.rankLabel.string!==g.toString()){this.rankLabel.string=v&&g>v?"".concat(v,"+"):g.toString(),this.rankSprite.spriteFrame=this.defaultRank;var E=new C(yX);switch(p.isHighlight&&(this.rankSprite.spriteFrame=this.highlightRank,E=new C(yQ)),g){case 1:this.rankSprite.spriteFrame=this.goldRank,E=new C(yV);break;case 2:this.rankSprite.spriteFrame=this.silverRank,E=new C(yq);break;case 3:this.rankSprite.spriteFrame=this.bronzeRank,E=new C(yW)}this.rankLabel.shadowColor=E,this.rankLabel.outlineColor=E}}},{key:"setPhoto",value:function(p){p&&this.node.active&&(p.packable=!0,this.avatar.spriteFrame=p)}},{key:"resetPhoto",value:(_=Ee(function(){var p;return _ts_generator(this,function(v){switch(v.label){case 0:if(!!this.defaultAvatar)return[3,2];return[4,nP.loadSpriteFrameAsync("images/avatar-bg/spriteFrame")];case 1:p=v.sent();if(!p)return[2];this.defaultAvatar=p;v.label=2;case 2:this.avatar.spriteFrame=this.defaultAvatar;return[2]}})}),function(){return _.apply(this,arguments)})},{key:"updateUsername",value:function(p){this.nameLabel.string=p.name,this.nameLabel.color=new C(p.isHighlight?yJ:yK)}},{key:"updateScore",value:function(p){var v=Math.floor(p.score);this.scoreLabel.string=_Z.getShortNumber(v,7);var g=this.scoreLabel.getComponent(I);g.outlineColor=new C(p.isHighlight?yQ:yX),g.shadowColor=new C(p.isHighlight?yQ:yX),this.scoreBackground.spriteFrame=p.isHighlight?this.highlightScoreBackground:this.defaultScoreBackground}},{key:"runShowUpAnimation",value:(k=Ee(function(p,v){var g,E,k,C,_,A;var T=arguments;return _ts_generator(this,function(I){switch(I.label){case 0:g=this,E=T.length>2&&void 0!==T[2]?T[2]:.3;this.node.scale=new ef(.8,.8,.8),this.setOpacity(0);k=this.container.position.clone();this.container.position=new ef(k.x,k.y-100,k.z);C=G(this.node).delay(v);C.to(E,{scale:ef.ONE},{easing:"elasticOut"});_=G(this.container).delay(v);_.to(E,{position:k},{easing:"backOut"});A=G(this.uiOpacity).delay(v);A.to(E,{opacity:255},{easing:"cubicOut",onUpdate:function(){g.nameOpacity.opacity=g.uiOpacity.opacity,g.scoreOpacity.opacity=g.uiOpacity.opacity,g.avatarOpacity.opacity=g.uiOpacity.opacity}}),p.addAbortListener(function(){g.node.scale=ef.ONE,g.container.position=k,g.uiOpacity.opacity=255,g.avatar.node.active=!0});return[4,Promise.all([tJ.runTweenAsync(C,p),tJ.runTweenAsync(_,p),tJ.runTweenAsync(A,p)])];case 1:I.sent();return[2]}})}),function(p,v){return k.apply(this,arguments)})},{key:"runWorldPositionAnimation",value:(E=Ee(function(p,v){var g;return _ts_generator(this,function(E){switch(E.label){case 0:g=G(this.node).to(v,{worldPosition:p},{easing:"quadOut"});return[4,tJ.runTweenAsync(g)];case 1:E.sent();return[2]}})}),function(p,v){return E.apply(this,arguments)})},{key:"runScaleAnimation",value:(g=Ee(function(p,v,g){var E;return _ts_generator(this,function(k){switch(k.label){case 0:E=G(this.node).to(g,{scale:new ef(v,v,v)},{easing:"backOut"});return[4,tJ.runTweenAsync(E,p)];case 1:k.sent();return[2]}})}),function(p,v,E){return g.apply(this,arguments)})},{key:"runUpdateDataAnimation",value:(v=Ee(function(p,v,g,E,k){var C;return _ts_generator(this,function(_){switch(_.label){case 0:C=this;return[4,tJ.runOnUpdateAsync(this.node,k,function(k){var _=Math.floor(p+(v-p)*k),A=Math.floor(g+(E-g)*k);C.updateRank({rank:_,isHighlight:!0}),C.updateScore({score:A,isHighlight:!0})})];case 1:_.sent();return[2]}})}),function(p,g,E,k,C){return v.apply(this,arguments)})},{key:"setOpacity",value:function(p){this.uiOpacity.opacity=p,this.nameOpacity.opacity=p,this.scoreOpacity.opacity=p,this.avatarOpacity.opacity=p}}]),l}(L)).prototype,"nameLabel",[C2],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_y=Ye(_p.prototype,"nameOpacity",[C4],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_v=Ye(_p.prototype,"container",[C3],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_g=Ye(_p.prototype,"background",[C5],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_m=Ye(_p.prototype,"highlightBackground",[C6],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_b=Ye(_p.prototype,"rankSprite",[C9],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_w=Ye(_p.prototype,"rankLabel",[C8],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_S=Ye(_p.prototype,"goldRank",[C7],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_E=Ye(_p.prototype,"silverRank",[_t],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_k=Ye(_p.prototype,"bronzeRank",[_n],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_C=Ye(_p.prototype,"highlightRank",[_i],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),__=Ye(_p.prototype,"avatar",[_a],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_A=Ye(_p.prototype,"avatarOpacity",[_r],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_T=Ye(_p.prototype,"scoreBackground",[_o],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_I=Ye(_p.prototype,"scoreLabel",[_s],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_R=Ye(_p.prototype,"highlightScoreBackground",[_l],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_P=Ye(_p.prototype,"scoreOpacity",[_u],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_N=Ye(_p.prototype,"uiOpacity",[_c],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_D=Ye(_p.prototype,"uiTransform",[_h],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_d=_p))||_d);g._RF.pop(),g._RF.push({},"173acdyc/VOnLkPsoSfdfnr","Leaders",void 0);var _0,_1,_2,_4,_3,_5,_6,_9,_8,_7,At,An,Ai,Aa,Ar,Ao,As,Al=E.ccclass,Au=E.property,Ac=globalThis.game,Ah=Ac.player,Ad=Ac.frameCapture,Ap=GameCore.Utils.Image,Af=(_F=Al("Leaders"),_B=Au(K),_U=Au(k),_z=Au(H),_G=Au(A),_Y=Au(F),_F((_V=Ye((_H=function(p){Ie(u,p);var v,g,E,k,C,_=xe(u);function u(){var p;Ce(this,u);for(var v=arguments.length,g=new Array(v),E=0;E<v;E++)g[E]=arguments[E];return je(p=_.call.apply(_,[this].concat(g)),"leaderPrefab",_V,Ne(p)),je(p,"inactiveNodeContainer",_q,Ne(p)),je(p,"layout",_W,Ne(p)),je(p,"viewport",_K,Ne(p)),je(p,"maxLeader",_X,Ne(p)),p.cachedPhotos=new Map,p.leaderData=[],p.leaderPoolArray=[],p.playerLeader=null,p.isHidden=!0,p}return Ae(u,[{key:"onLoad",value:function(){this.uiTransform=this.getComponent(A),this.batchNodes=this.getComponents(oO),this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){e7.lazyValidateProperties(this)}},{key:"__preload",value:function(){this.currentPlayerId=Ah.getPlayerId();for(var p=0;p<this.maxLeader;p++){var v=this.createLeader();this.leaderPoolArray.push(v)}var g=this.leaderPoolArray[0].uiTransform.contentSize;this.leaderContentHeight=g.height+this.layout.spacingY}},{key:"createLeader",value:function(){var p=T(this.leaderPrefab);return this.addLeaderToInactiveNode(p),p.getComponent(_$)}},{key:"updateData",value:(C=Ee(function(p){var v;return _ts_generator(this,function(g){switch(g.label){case 0:v=this;if(this.playerLeader=null,this.isHidden=!1,this.leaderData=p,this.leaderData.sort(function(p,v){return v.score-p.score}),null==Ah)throw new Error("Player is not defined");this.batchNodes.every(function(p){return p.enabled=!0});return[4,Promise.all(this.leaderData.map(function(p,g){var E=p.playerId,k=p.photo,C=p.score,_=p.name,A=v.currentPlayerId===E;v.leaderData[g].rank=g+1;var T=v.maxLeader-1;if(!(g>=T)||A){var I=A&&g>T-1?v.leaderPoolArray[T]:v.leaderPoolArray[g];return v.layout.node.addChild(I.node),I.setOpacity(0),A&&(v.playerLeader=I),I.updateInfo({isHighlight:A,name:_,photo:k,rank:g+1,score:C},T),v.getAndSetLeaderPhoto({playerId:E,url:k,leader:I})}}))];case 1:g.sent();return[2]}})}),function(p){return C.apply(this,arguments)})},{key:"getAndSetLeaderPhoto",value:(k=Ee(function(p){var v,g,E,k,C,_;return _ts_generator(this,function(A){switch(A.label){case 0:v=p.playerId,g=p.url,E=p.leader;if(!("default"!==g))return[3,4];if(!this.cachedPhotos.has(v))return[3,1];E.setPhoto(this.cachedPhotos.get(v));return[3,4];case 1:A.trys.push([1,3,,4]);return[4,this.loadAvatarImage(g,85,85,v)];case 2:k=A.sent();if(!k)return[2];C=Z.createWithImage(k);this.cachedPhotos.set(v,C),E.setPhoto(C);return[3,4];case 3:_=A.sent();if(_instanceof(_,DOMException)&&"AbortError"===_.name)return[2,void console.info("Leaders: getAndSetLeaderPhoto was aborted")];throw _;case 4:return[2]}})}),function(p){return k.apply(this,arguments)})},{key:"removeLeaders",value:function(){var p=this;this.isHidden=!0,this.getActiveLeaders().forEach(function(v){v.resetPhoto(),p.addLeaderToInactiveNode(v.node)}),this.batchNodes.every(function(p){return p.enabled=!1})}},{key:"getActiveLeaders",value:function(){var p=this;return this.leaderPoolArray.filter(function(v){return v.node.parent===p.layout.node})}},{key:"getActiveLeaderChildren",value:function(){return this.layout.getComponentsInChildren(_$)}},{key:"showLeaders",value:(E=Ee(function(p){var v,g,E,k;return _ts_generator(this,function(C){switch(C.label){case 0:v=this;if(!!this.isHidden)return[3,2];g=this.getActiveLeaders();if(g.length<1)return[3,2];E=Math.ceil(this.viewport.contentSize.height/this.leaderContentHeight),k=Math.min(g.length,E);return[4,Promise.all(g.map(function(){var g=Ee(function(g,E){var C,_;return _ts_generator(this,function(A){switch(A.label){case 0:C=v.isHidden;if(C)return[3,3];_=E<k;if(!_)return[3,2];return[4,g.runShowUpAnimation(p,.1*E,.3)];case 1:_=A.sent();A.label=2;case 2:C=_;A.label=3;case 3:return[2]}})});return function(p,v){return g.apply(this,arguments)}}()))];case 1:C.sent();C.label=2;case 2:return[2]}})}),function(p){return E.apply(this,arguments)})},{key:"runUpdateLeadersRankAnimation",value:(g=Ee(function(p,v){var g,E,k,C,_,A,T;return _ts_generator(this,function(I){switch(I.label){case 0:g=null!=p?p:0,E=null!=v?v:this.leaderData.length;E=Math.min(E,100);for(k=this.getActiveLeaderChildren(),C=this.leaderContentHeight,_=[],A=g;A<E;A++){k[A].updateRank({rank:A+1,isHighlight:!1});T=k[A].node.worldPosition.clone();_.push(k[A].runWorldPositionAnimation(T.add3f(0,-C,0),.25))}return[4,Promise.all(_)];case 1:I.sent();return[2]}})}),function(p,v){return g.apply(this,arguments)})},{key:"getLeaderData",value:function(){return this.leaderData}},{key:"getPlayerLeader",value:function(){return this.playerLeader}},{key:"getLeaderByRank",value:function(p){return this.getActiveLeaders()[p-1]||null}},{key:"getLeaderDataByRank",value:function(p){return this.leaderData[p-1]||null}},{key:"updateVisibility",value:function(){var p=this.viewport.getBoundingBoxToWorld(),v=p.yMax,g=p.yMin;this.getActiveLeaders().forEach(function(p){var E=p.uiTransform;if(void 0!==E){var k=E.getBoundingBoxToWorld(),C=k.yMax,_=k.yMin,A=C<g||_>v;p.setOpacity(A?0:255)}})}},{key:"loadAvatarImage",value:(v=Ee(function(p,v,g,E){var k,C;return _ts_generator(this,function(_){switch(_.label){case 0:_.trys.push([0,5,,6]);return[4,Ad.captureAsync({width:v,height:g,name:"LeaderAvatar",renderOptions:Re({},E,{name:E,type:"image",depth:0,position:[0,0],size:[v,g],image:p})})];case 1:k=_.sent();if(!k)return[3,3];return[4,Ap.loadImage(k)];case 2:C=_.sent();return[3,4];case 3:C=null;_.label=4;case 4:return[2,C];case 5:_.sent();return[2,null];case 6:return[2]}})}),function(p,g,E,k){return v.apply(this,arguments)})},{key:"addLeaderToInactiveNode",value:function(p){this.inactiveNodeContainer.addChild(p),p.getComponent(_$).setOpacity(0)}}]),u}(L)).prototype,"leaderPrefab",[_B],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_q=Ye(_H.prototype,"inactiveNodeContainer",[_U],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_W=Ye(_H.prototype,"layout",[_z],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_K=Ye(_H.prototype,"viewport",[_G],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_X=Ye(_H.prototype,"maxLeader",[_Y],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_j=_H))||_j);g._RF.pop(),g._RF.push({},"2aa67vEWR9HaJkCtpsuUyRX","LeaderboardContent",void 0);var Ay=E.ccclass,Av=E.property,Ag=globalThis.game,Am=Ag.storage,Ab=Ag.leaderboard,Aw=Ag.player,AS=GameCore,AE=AS.Utils,Ak=AE.Object,AC=AE.Array,A_=AS.Configs.Leaderboards,AA=(_0=Ay("LeaderboardContent"),_1=Av(a4),_2=Av(C0),_4=Av(Af),_3=Av(eR),_5=Av({type:[_x]}),_6=Av(CR),_9=Av(iz),_0((At=Ye((_7=function(p){Ie(c,p);var v,g,E,k,C,_,T,I=xe(c);function c(){var p;Ce(this,c);for(var v=arguments.length,g=new Array(v),E=0;E<v;E++)g[E]=arguments[E];return je(p=I.call.apply(I,[this].concat(g)),"panelAnimator",At,Ne(p)),je(p,"tabs",An,Ne(p)),je(p,"leaders",Ai,Ne(p)),je(p,"scrollview",Aa,Ne(p)),je(p,"leaderSkeletons",Ar,Ne(p)),je(p,"leaderboardIsEmpty",Ao,Ne(p)),je(p,"contentOpacity",As,Ne(p)),p.isHidden=!0,p.currentLb=null,p.animAbortSignal=null,p.fetchAbortController=null,p.handleUpdateVisibility=function(){p.leaders.updateVisibility()},p.handleFriendsTabSelected=Ee(function(){return _ts_generator(this,function(v){switch(v.label){case 0:Am.setStorageData("leaderboard_content","lastTabOpened","friends"),p.cleanupSideEffects();return[4,p.updateStatus("friends")];case 1:v.sent();return[2]}})}),p.handleWorldTabSelected=Ee(function(){return _ts_generator(this,function(v){switch(v.label){case 0:Am.setStorageData("leaderboard_content","lastTabOpened","global"),p.cleanupSideEffects();return[4,p.updateStatus("global")];case 1:v.sent();return[2]}})}),p.hideContent=function(){p.contentOpacity.changeStateFade(!1,.1)},p.showContent=function(){p.contentOpacity.changeStateFade(!0,.1)},p}return Ae(c,[{key:"onLoad",value:function(){this.uiTransform=this.getComponent(A),this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){e7.lazyValidateProperties(this)}},{key:"enableUIAnimator",value:function(){this.panelAnimator.enabled=!0}},{key:"disableUIAnimator",value:function(){this.panelAnimator.enabled=!1}},{key:"listenEvents",value:function(){this.node.scene.on(yH.FRIENDS_TAB_SELECTED,this.handleFriendsTabSelected),this.node.scene.on(yH.WORLD_TAB_SELECTED,this.handleWorldTabSelected),this.node.scene.on(aR.HIDE_UI,this.hideContent),this.node.scene.on(aR.SHOW_UI,this.showContent),this.scrollview.node.on(eR.EventType.SCROLLING,this.handleUpdateVisibility)}},{key:"unlistenEvents",value:function(){this.node.scene.off(yH.FRIENDS_TAB_SELECTED,this.handleFriendsTabSelected),this.node.scene.off(yH.WORLD_TAB_SELECTED,this.handleWorldTabSelected),this.unlistenUIEvents(),this.scrollview.node.off(eR.EventType.SCROLLING,this.handleUpdateVisibility)}},{key:"unlistenUIEvents",value:function(){this.node.scene.off(aR.HIDE_UI,this.hideContent),this.node.scene.off(aR.SHOW_UI,this.showContent)}},{key:"loadLeaderboard",value:(T=Ee(function(p,v){var g,E;return _ts_generator(this,function(k){switch(k.label){case 0:if(v.aborted)return[2,null];g=this.getLeaderboardName(p);if(!g)return[3,2];return[4,Ab.requestLeaderboardAsync(g,A_.Limit)];case 1:E=(k.sent(),v.aborted?null:Ab.getLeaderboard(g));return[3,3];case 2:E=null;k.label=3;case 3:return[2,E]}})}),function(p,v){return T.apply(this,arguments)})},{key:"getLeaderboardName",value:function(p){return"friends"===p?o1:o0}},{key:"loadMoreLeaderboard",value:(_=Ee(function(p,v){var g,E;return _ts_generator(this,function(k){switch(k.label){case 0:if(v.aborted)return[2,null];g=this.getLeaderboardName(p);if(!g)return[3,2];return[4,Ab.loadMoreLeaderboardAsync(g,1e3)];case 1:E=(k.sent(),v.aborted?null:Ab.getLeaderboard(g));return[3,3];case 2:E=null;k.label=3;case 3:return[2,E]}})}),function(p,v){return _.apply(this,arguments)})},{key:"showLoading",value:(C=Ee(function(p){var v;var g=arguments;return _ts_generator(this,function(E){switch(E.label){case 0:v=g.length>1&&void 0!==g[1]?g[1]:0;this.scrollview.scrollToTop(0),this.scrollview.enabled=!1;return[4,Promise.all([this.leaderSkeletons.map(function(g,E){return g.show(E*v,p)})])];case 1:E.sent();return[2]}})}),function(p){return C.apply(this,arguments)})},{key:"hideLoading",value:(k=Ee(function(p){return _ts_generator(this,function(v){switch(v.label){case 0:return[4,Promise.all(this.leaderSkeletons.map(function(v){return v.hide(p)}))];case 1:v.sent();return[2]}})}),function(p){return k.apply(this,arguments)})},{key:"enter",value:function(){this.listenEvents(),this.isHidden=!1;var p=Am.getStorageData("leaderboard_content","lastTabOpened");"friends"===p&&this.handleFriendsTabSelected(),"global"===p&&this.handleWorldTabSelected()}},{key:"hide",value:function(){this.isHidden=!0}},{key:"cleanup",value:function(){this.unlistenEvents(),this.cleanupSideEffects()}},{key:"cleanupSideEffects",value:function(){var p,v;null===(p=this.animAbortSignal)||void 0===p||p.abort(),this.animAbortSignal=null,null===(v=this.fetchAbortController)||void 0===v||v.abort(),this.fetchAbortController=null,this.leaders.removeLeaders(),this.leaderboardIsEmpty.hide()}},{key:"isAborted",value:function(){var p,v,g,E,k=null===(p=null===(v=this.animAbortSignal)||void 0===v?void 0:v.aborted)||void 0===p||p,C=null===(g=null===(E=this.fetchAbortController)||void 0===E?void 0:E.signal.aborted)||void 0===g||g;return k||C}},{key:"updateStatus",value:(E=Ee(function(p){var v,g,E,k,C,_,A,T,I,R,P,N,D,L,O;return _ts_generator(this,function(M){switch(M.label){case 0:if(null!==this.animAbortSignal||null!==this.fetchAbortController)throw new Error("LeaderboardContent: LeaderboardContent is already loading. Please handle cancelling gracefully.");g=!this.isHidden;if(!g)return[3,3];this.tabs.updateStatus(p),this.animAbortSignal=new na,this.fetchAbortController=new AbortController;return[4,this.showLoading(this.animAbortSignal)];case 1:M.sent();E=this;return[4,this.loadLeaderboard(p,this.animAbortSignal)];case 2:g=(E.currentLb=M.sent(),this.currentLb);M.label=3;case 3:if(!g)return[3,10];if(0===Ak.vals(this.currentLb.leaders).length)return[2,(this.leaderboardIsEmpty.show(),this.tabs.setInteractableButtons(!0),void this.hideLoading(this.animAbortSignal))];k=Aw.getPlayerId(),C=this.currentLb.leaders[k];if(!!C)return[3,5];_=this.getLeaderboardName(p);if(!_)return[3,5];return[4,Ab.getLeadersByPlayerIdsAsync(_,[k])];case 4:A=M.sent();A.length>0&&(C=A[0],this.currentLb.leaders[k]=C);M.label=5;case 5:T=Am.getStorage("leaderboard_content"),I=T.previousScore,R=T.previousRank,P=null!==(v=C)&&void 0!==v?v:{},N=P.score,D=P.rank;I&&I<N&&R&&R!==D&&(this.currentLb.leaders[k].score=I);L=Ak.vals(this.currentLb.leaders);nP.setBlockInput(!0),this.tabs.setInteractableButtons(!1);return[4,this.hideLoading(this.animAbortSignal)];case 6:if(M.sent(),this.isAborted())return[2,(nP.setBlockInput(!1),void this.tabs.setInteractableButtons(!0))];this.leaders.updateData(L),this.scrollview.enabled=!0;return[4,this.leaders.showLeaders(this.animAbortSignal)];case 7:if(M.sent(),this.isAborted())return[2,(nP.setBlockInput(!1),void this.tabs.setInteractableButtons(!0))];O=this.leaders.getPlayerLeader();if(!O)return[2,(nP.setBlockInput(!1),void this.tabs.setInteractableButtons(!0))];return[4,this.scrollToLeader(O,1)];case 8:if(M.sent(),this.isAborted())return[2,(nP.setBlockInput(!1),void this.tabs.setInteractableButtons(!0))];return[4,this.runPlayerRankChangeAnimation(this.animAbortSignal,N)];case 9:if(M.sent(),this.isAborted())return[2,(nP.setBlockInput(!1),void this.tabs.setInteractableButtons(!0))];Am.setStorageData("leaderboard_content","previousScore",N),Am.setStorageData("leaderboard_content","previousRank",D),nP.setBlockInput(!1),this.tabs.setInteractableButtons(!0);M.label=10;case 10:return[2]}})}),function(p){return E.apply(this,arguments)})},{key:"runPlayerRankChangeAnimation",value:(g=Ee(function(p,v){var g,E,k,C,_,A,T,I,R,P,N,D,L,O;return _ts_generator(this,function(M){switch(M.label){case 0:g=Am.getStorage("leaderboard_content").previousScore;if(!(g&&!(g>=v)))return[3,6];E=this.leaders.getLeaderData(),k=AC.searchIndex(E,function(p){return p.playerId===Aw.getPlayerId()});if(!(-1!==k))return[3,6];C=E[k],_=C.score,A=C.rank;C.score=v,E.sort(function(p,v){return v.score-p.score}),E.forEach(function(p,v){p.rank=v+1});T=this.leaders.getPlayerLeader();if(!T)return[3,6];if(!(A!==C.rank))return[3,5];I=this.leaders.getLeaderByRank(C.rank);if(!I)return[3,4];this.leaders.layout.enabled=!1;return[4,T.runScaleAnimation(p,1.1,.5)];case 1:M.sent();R=Math.min(.5*(A-C.rank),2),P=[T.runUpdateDataAnimation(A,C.rank,_,C.score,R),this.scrollToLeader(I,R)],N=this.uiTransform.contentSize.height,D=this.scrollview.getMaxScrollOffset().y,L=-I.node.position.y-N/2,O=ef.ZERO;L<0?O=new ef(T.node.worldPosition.x,N+I.node.position.y,T.node.worldPosition.z):this.scrollview.getScrollOffset().y>=D-5&&(O=L<D?new ef(T.node.worldPosition.x,N/2,T.node.worldPosition.z):I.node.worldPosition),O.equals(ef.ZERO)||P.push(T.runWorldPositionAnimation(O,R));return[4,Promise.all(P)];case 2:M.sent();return[4,Promise.all([T.runScaleAnimation(p,1,.25),T.node.setSiblingIndex(C.rank-1),this.leaders.runUpdateLeadersRankAnimation(C.rank,A)])];case 3:M.sent(),this.leaders.layout.enabled=!0,this.leaders.layout.updateLayout();M.label=4;case 4:return[3,6];case 5:T.updateScore({score:C.score,isHighlight:!0});M.label=6;case 6:return[2]}})}),function(p,v){return g.apply(this,arguments)})},{key:"scrollToLeader",value:(v=Ee(function(p,v){var g,E,k,C;return _ts_generator(this,function(_){g=this.uiTransform.contentSize,E=new eg(0,-p.node.position.y-g.height/2),k=this.scrollview.getScrollOffset().clone();E.y=Math.max(E.y,0),k.y=Math.max(k.y,0);C=E.y-k.y;if(!(Math.abs(C)<5))return[2,(this.scrollview.scrollToOffset(E,v),tJ.waitTweenAsync(v))];return[2]})}),function(p,g){return v.apply(this,arguments)})}]),c}(L)).prototype,"panelAnimator",[_1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),An=Ye(_7.prototype,"tabs",[_2],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ai=Ye(_7.prototype,"leaders",[_4],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Aa=Ye(_7.prototype,"scrollview",[_3],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ar=Ye(_7.prototype,"leaderSkeletons",[_5],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Ao=Ye(_7.prototype,"leaderboardIsEmpty",[_6],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),As=Ye(_7.prototype,"contentOpacity",[_9],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_8=_7))||_8);g._RF.pop(),g._RF.push({},"ae514KD4phHMYC0AD3CIw68","LeaderboardPage",void 0);var AT,AI,AR,AP,AN,AD,AL,AO,AM,Ax,AF,AB,AU,Az,AG,AY,Aj;(0,E.ccclass)("LeaderboardPage")(function(p){Ie(o,p);var v,g,E,k=xe(o);function o(){return Ce(this,o),k.apply(this,arguments)}return Ae(o,[{key:"mount",value:(E=Ee(function(){var p;return _ts_generator(this,function(v){switch(v.label){case 0:if(!!this.pagePrefab)return[3,2];return[4,nP.loadPrefabAsync(nr.LEADERBOARD_PAGE)];case 1:p=v.sent();p&&this.node&&(this.pagePrefab=p);v.label=2;case 2:return[4,Fe(Pe(o.prototype),"mount",this).call(this)];case 3:if(v.sent(),this.containerUIOpacity.opacity=0,this.content=this.container.getComponentInChildren(AA),!this.content)throw new Error("LeaderboardPage: Leaders not found");return[2]}})}),function(){return E.apply(this,arguments)})},{key:"transitionIn",value:(g=Ee(function(){var p,v,g;return _ts_generator(this,function(E){switch(E.label){case 0:p=this;return[4,Fe(Pe(o.prototype),"transitionIn",this).call(this)];case 1:E.sent(),this.content.enableUIAnimator();v=tJ.runTweenAsync(G(this.containerUIOpacity).to(.2,{opacity:255})),g=new Promise(function(v){p.node.scene.emit(aR.SHOW_UI,{onComplete:function(){v()}})});return[4,Promise.all([v,g])];case 2:E.sent(),this.content.enter();return[2]}})}),function(){return g.apply(this,arguments)})},{key:"transitionOut",value:(v=Ee(function(){var p;return _ts_generator(this,function(v){switch(v.label){case 0:p=this;return[4,Fe(Pe(o.prototype),"transitionOut",this).call(this)];case 1:v.sent(),this.content.unlistenUIEvents();return[4,new Promise(function(v){p.node.scene.emit(aR.HIDE_UI,{onComplete:function(){v()}})})];case 2:v.sent(),this.content.disableUIAnimator();return[2]}})}),function(){return v.apply(this,arguments)})},{key:"unmount",value:function(){var p,v;null===(p=this.content)||void 0===p||p.hide(),null===(v=this.content)||void 0===v||v.cleanup(),Fe(Pe(o.prototype),"unmount",this).call(this)}}]),o}(bF));g._RF.pop(),g._RF.push({},"8cd04RxbahLDaxq9FJf6hBh","TournamentBlock",void 0);var AH,AV,Aq,AW,AK,AX=E.ccclass,AJ=E.property,AQ=globalThis.game,AZ=AQ.leaderboard,A$=AQ.player,A0=GameCore.Utils.Time,A1=(AT=AX("TournamentBlock"),AI=AJ(k),AR=AJ(I),AP=AJ(I),AN=AJ(I),AD=AJ(I),AL=AJ(A),AO=AJ({type:[V]}),AT((AF=Ye((Ax=function(p){Ie(o,p);var v,g,E,k=xe(o);function o(){var p;Ce(this,o);for(var v=arguments.length,g=new Array(v),E=0;E<v;E++)g[E]=arguments[E];return je(p=k.call.apply(k,[this].concat(g)),"container",AF,Ne(p)),je(p,"titleLabel",AB,Ne(p)),je(p,"timeLabel",AU,Ne(p)),je(p,"playerCountLabel",Az,Ne(p)),je(p,"playButtonLabel",AG,Ne(p)),je(p,"uiTransform",AY,Ne(p)),je(p,"banners",Aj,Ne(p)),p}return Ae(o,[{key:"onLoad",value:function(){this.uiOpacity=this.node.getComponent(et),this.validateRequiredComponents()}},{key:"activateThemeBanner",value:function(p){var v=!1;this.banners.forEach(function(g){g.node.active=g.node.name.toLowerCase()===p,g.node.active&&(v=!0)}),v||this.banners.forEach(function(p){p.node.active=p.node.name.toLowerCase()===sp.SUMMER})}},{key:"validateRequiredComponents",value:function(){e7.lazyValidateProperties(this)}},{key:"updateInfo",value:(E=Ee(function(p){var v,g,E,k,C,_,A,T,I,R,P,N;return _ts_generator(this,function(D){switch(D.label){case 0:this.payload=p;v=p.endTime,g=p.title,E=p.payload,k=E.leaderboardId,C=E.themeId;if(!k)return[3,5];this.setPlayerCountWaiting(),this.updateTitle(g),this.updateEndTime(v),this.updateTournamentBanner(C);_={leaders:[],isPlayerInTournament:!1};D.label=1;case 1:D.trys.push([1,3,,4]);return[4,this.getLeadersPayload(k)];case 2:A=D.sent();A&&(_=A);return[3,4];case 3:T=D.sent();console.error("Fetch lb for tournament ".concat(g),T);return[3,4];case 4:this.leadersPayload=_;I=this.leadersPayload,R=I.leaders,P=I.isPlayerInTournament,N=R.length;this.updatePlayerCount(N),this.updatePlayButtonLabel(P);D.label=5;case 5:return[2]}})}),function(p){return E.apply(this,arguments)})},{key:"updateTitle",value:function(p){p&&(this.titleLabel.string=p)}},{key:"updateEndTime",value:function(p){var v=A0.getRelativeTime(p);this.timeLabel.string="Ends ".concat(v)}},{key:"updatePlayerCount",value:function(p){this.playerCountLabel.string="".concat(p," ")+(p>1?"players":"player")}},{key:"setPlayerCountWaiting",value:function(){this.playerCountLabel.string="Loading..."}},{key:"updateTournamentBanner",value:function(p){p?this.activateThemeBanner(p):this.activateThemeBanner(sp.SUMMER)}},{key:"updatePlayButtonLabel",value:function(p){this.playButtonLabel.string=p?"Continue":"Join"}},{key:"getLeadersPayload",value:(g=Ee(function(p){var v,g,E,k,C,_,A,T;return _ts_generator(this,function(I){switch(I.label){case 0:v=AZ.getLeaderboardName(p);if(!v)return[2,null];return[4,AZ.requestLeaderboardAsync(v,0)];case 1:I.sent();g=AZ.getLeaderboard(v);if(!g)return[2,null];k=GameCore.Utils.Object.vals(g.leaders),C=A$.getPlayerId(),_={leaders:[],player:void 0,isPlayerInTournament:!1},A=We(k);try{for(A.s();!(E=A.n()).done;){T=E.value;T.playerId===C?(_.player=T,_.isPlayerInTournament=!0,_.leaders.push(T)):_.leaders.push(T)}}catch(p){A.e(p)}finally{A.f()}return[2,_]}})}),function(p){return g.apply(this,arguments)})},{key:"runShowPopUpAnimation",value:(v=Ee(function(p,v,g){var E,k,C,_,A;return _ts_generator(this,function(T){switch(T.label){case 0:E=this;this.node.scale=new ef(.8,.8,.8),this.uiOpacity.opacity=0;k=this.container.position.clone();this.container.position=new ef(k.x,k.y-100,k.z);C=G(this.node).delay(p);C.to(v,{scale:ef.ONE},{easing:"elasticOut"});_=G(this.container).delay(p);_.to(v,{position:k},{easing:"backOut"});A=G(this.uiOpacity).delay(p);A.to(v,{opacity:255},{easing:"cubicOut"}),g.addAbortListener(function(){E.node.scale=ef.ONE,E.container.position=k,E.uiOpacity.opacity=255});return[4,Promise.all([tJ.runTweenAsync(C,g),tJ.runTweenAsync(_,g),tJ.runTweenAsync(A,g)])];case 1:T.sent();return[2]}})}),function(p,g,E){return v.apply(this,arguments)})},{key:"handleOnTournamentClicked",value:function(){var p=this.payload.id||"";if(ll.validateTournamentExpired(p))return this.node.scene.emit(se.RELOAD_TOURNAMENT),void s8.showNotificationScreen("Tournament has ended",2);try{var v=JSON.stringify(this.payload);s8.showTournamentDetailScreen(v,"tournament_start")}catch(p){console.warn("handleOnTournamentClicked",p)}}}]),o}(L)).prototype,"container",[AI],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),AB=Ye(Ax.prototype,"titleLabel",[AR],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),AU=Ye(Ax.prototype,"timeLabel",[AP],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Az=Ye(Ax.prototype,"playerCountLabel",[AN],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),AG=Ye(Ax.prototype,"playButtonLabel",[AD],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),AY=Ye(Ax.prototype,"uiTransform",[AL],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Aj=Ye(Ax.prototype,"banners",[AO],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),AM=Ax))||AM);g._RF.pop(),g._RF.push({},"a409buwLfZLQq7cmBGiqhF5","TournamentBlockSkeleton",void 0);var A2,A4,A3,A5,A6,A9,A8,A7,Tt,Tn,Ti,Ta=E.ccclass,Tr=E.property,To=(AH=Ta("TournamentBlockSkeleton"),AV=Tr(k),AH((AK=Ye((AW=function(p){Ie(a,p);var v,g,E=xe(a);function a(){var p;Ce(this,a);for(var v=arguments.length,g=new Array(v),k=0;k<v;k++)g[k]=arguments[k];return je(p=E.call.apply(E,[this].concat(g)),"container",AK,Ne(p)),p}return Ae(a,[{key:"__preload",value:function(){this.uiOpacity=this.getComponent(et),this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){e7.lazyValidateProperties(this)}},{key:"hide",value:(g=Ee(function(p){var v;return _ts_generator(this,function(g){switch(g.label){case 0:v=this;return[4,tJ.runTweenAsync(G(this.uiOpacity).to(.2,{opacity:0}).call(function(){v.node.active=!1}),p)];case 1:g.sent();return[2]}})}),function(p){return g.apply(this,arguments)})},{key:"show",value:(v=Ee(function(p,v){var g,E,k,C,_;return _ts_generator(this,function(A){switch(A.label){case 0:g=this;this.node.active=!0,this.node.scale=new ef(.8,.8,.8),this.uiOpacity.opacity=0;E=this.container.position.clone();this.container.position=new ef(E.x,E.y-100,E.z);k=G(this.node).delay(p);k.to(.2,{scale:ef.ONE},{easing:"elasticOut"});C=G(this.container).delay(p);C.to(.2,{position:E},{easing:"backOut"});_=G(this.uiOpacity).delay(p);_.to(.2,{opacity:255},{easing:"cubicOut"}),v.addAbortListener(function(){g.node.scale=ef.ONE,g.container.position=E,g.uiOpacity.opacity=255});return[4,Promise.all([tJ.runTweenAsync(k,v),tJ.runTweenAsync(C,v),tJ.runTweenAsync(_,v)])];case 1:A.sent();return[2]}})}),function(p,g){return v.apply(this,arguments)})}]),a}(L)).prototype,"container",[AV],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Aq=AW))||Aq);g._RF.pop(),g._RF.push({},"5f82fye3oxHQrxKbP9TC2di","TournamentsBoard",void 0);var Ts,Tl,Tu,Tc,Th,Td=E.ccclass,Tp=E.property,Tf=globalThis.game.player,Ty=(A2=Td("TournamentsBoard"),A4=Tp(K),A3=Tp(k),A5=Tp(H),A6=Tp(k),A2((A7=Ye((A8=function(p){Ie(i,p);var v,g=xe(i);function i(){var p;Ce(this,i);for(var v=arguments.length,E=new Array(v),k=0;k<v;k++)E[k]=arguments[k];return je(p=g.call.apply(g,[this].concat(E)),"tournamentBlockPrefab",A7,Ne(p)),p.tournamentBlockArray=[],je(p,"inactiveNodeContainer",Tt,Ne(p)),je(p,"layout",Tn,Ne(p)),je(p,"createTournamentButton",Ti,Ne(p)),p}return Ae(i,[{key:"onLoad",value:function(){this.uiTransform=this.getComponent(A),this.uiOpacity=this.getComponent(et),this.validateRequiredComponents()}},{key:"start",value:function(){for(var p=0;p<20;p++)this.addTournamentBlock();this.tournamentBlockContentHeight=this.tournamentBlockArray[0].uiTransform.contentSize.height+this.layout.spacingY}},{key:"validateRequiredComponents",value:function(){e7.lazyValidateProperties(this)}},{key:"updateData",value:function(p){var v=this,g=!1;p.forEach(function(p,E){var k=v.tournamentBlockArray[E];p.payload.playerId===Tf.getPlayerId()&&(g=!0),k||(k=v.addTournamentBlock()),k.updateInfo(p),v.layout.node.addChild(k.node)}),g||this.setCreateTournamentButtonActive(!0)}},{key:"addTournamentBlock",value:function(){var p=T(this.tournamentBlockPrefab);this.inactiveNodeContainer.addChild(p);var v=p.getComponent(A1);return this.tournamentBlockArray.push(v),v}},{key:"removeTournamentBlocks",value:function(){var p=this;this.getActiveTournamentBlocks().forEach(function(v){p.inactiveNodeContainer.addChild(v.node)}),this.setCreateTournamentButtonActive(!1)}},{key:"getActiveTournamentBlocks",value:function(){var p=this;return this.tournamentBlockArray.filter(function(v){return v.node.parent===p.layout.node})}},{key:"setCreateTournamentButtonActive",value:function(p){p?this.layout.node.addChild(this.createTournamentButton):this.layout.node.removeChild(this.createTournamentButton),this.createTournamentButton.active=p}},{key:"showTournamentBlocks",value:(v=Ee(function(p,v){var g,E,k;return _ts_generator(this,function(C){switch(C.label){case 0:g=this.getActiveTournamentBlocks();if(g.length<1)return[3,2];E=Math.ceil(p/this.tournamentBlockContentHeight),k=Math.min(g.length,E);return[4,Promise.all(g.map(function(){var p=Ee(function(p,g){return _ts_generator(this,function(E){switch(E.label){case 0:if(!(g>=k))return[3,2];return[4,p.runShowPopUpAnimation(.1*g,.3,v)];case 1:E.sent();return[3,3];case 2:p.uiOpacity.opacity=255;E.label=3;case 3:return[2]}})});return function(v,g){return p.apply(this,arguments)}}()))];case 1:C.sent();C.label=2;case 2:return[2]}})}),function(p,g){return v.apply(this,arguments)})},{key:"updateVisibility",value:function(){var p=this.uiTransform.getBoundingBoxToWorld(),v=p.yMax,g=p.yMin;this.getActiveTournamentBlocks().forEach(function(p){var E=p.uiTransform;if(void 0!==E){var k=E.getBoundingBoxToWorld(),C=k.yMax,_=k.yMin,A=C<g||_>v;p.uiOpacity.opacity=A?0:255}})}}]),i}(L)).prototype,"tournamentBlockPrefab",[A4],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Tt=Ye(A8.prototype,"inactiveNodeContainer",[A3],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Tn=Ye(A8.prototype,"layout",[A5],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ti=Ye(A8.prototype,"createTournamentButton",[A6],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),A9=A8))||A9);g._RF.pop(),g._RF.push({},"f8a7b0St3FAkb1PvvvJTLCh","TournamentsNotAvailable",void 0);var Tv,Tg,Tm,Tb,Tw,TS,TE,Tk,TC,T_,TA,TT,TI,TR,TP,TN=E.ccclass,TD=E.property,TL=(Ts=TN("TournamentsNotAvailable"),Tl=TD(N),Ts((Th=Ye((Tc=function(p){Ie(i,p);var v,g=xe(i);function i(){var p;Ce(this,i);for(var v=arguments.length,E=new Array(v),k=0;k<v;k++)E[k]=arguments[k];return je(p=g.call.apply(g,[this].concat(E)),"createButton",Th,Ne(p)),p}return Ae(i,[{key:"onLoad",value:function(){this.uiOpacity=this.getComponent(et),this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){e7.lazyValidateProperties(this)}},{key:"show",value:(v=Ee(function(){var p,v,g;return _ts_generator(this,function(E){switch(E.label){case 0:this.createButton.interactable=!0,this.uiOpacity.opacity=255;p=this.node.position.clone(),v=G(this.node);v.to(.05,{position:p.clone().add3f(5,0,0)}),v.to(.05,{position:p.clone().add3f(-5,0,0)});g=G(this.node).repeat(2,v);g.to(.05,{position:p});return[4,tJ.runTweenAsync(g)];case 1:E.sent();return[2]}})}),function(){return v.apply(this,arguments)})},{key:"hide",value:function(){this.createButton.interactable=!1,this.uiOpacity.opacity=0}}]),i}(L)).prototype,"createButton",[Tl],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Tu=Tc))||Tu);g._RF.pop(),g._RF.push({},"199fcQ5IEZFbJCfSrGNrGDQ","TournamentContent",void 0);var TO=E.ccclass,TM=E.property,Tx=globalThis.game,TF=Tx.storage,TB=Tx.match,TU=GameCore.Utils,Tz=TU.Object,TG=TU.Array,TY=(Tv=TO("TournamentContent"),Tg=TM({type:a4}),Tm=TM(Ty),Tb=TM(TL),Tw=TM(eR),TS=TM({type:[To]}),TE=TM(iz),Tv((T_=Ye((TC=function(p){Ie(r,p);var v,g,E,k,C=xe(r);function r(){var p;Ce(this,r);for(var v=arguments.length,g=new Array(v),E=0;E<v;E++)g[E]=arguments[E];return je(p=C.call.apply(C,[this].concat(g)),"panelAnimator",T_,Ne(p)),je(p,"tournamentsBoard",TA,Ne(p)),je(p,"tournamentsNotAvailable",TT,Ne(p)),je(p,"scrollView",TI,Ne(p)),je(p,"skeletons",TR,Ne(p)),je(p,"contentOpacity",TP,Ne(p)),p.animAbortSignal=null,p.softAbortSignal=null,p.hideContent=function(){p.contentOpacity.changeStateFade(!1,.1)},p.showContent=function(){p.contentOpacity.changeStateFade(!0,.1)},p}return Ae(r,[{key:"onLoad",value:function(){this.uiTransform=this.node.getComponent(A),this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){e7.lazyValidateProperties(this)}},{key:"listenEvents",value:function(){this.scrollView.node.on(eR.EventType.SCROLLING,this.onScrolling,this),this.node.scene.on(se.RELOAD_TOURNAMENT,this.reload,this),this.node.scene.on(aR.HIDE_UI,this.hideContent),this.node.scene.on(aR.SHOW_UI,this.showContent)}},{key:"unlistenEvents",value:function(){this.scrollView.node.off(eR.EventType.SCROLLING,this.onScrolling,this),this.node.scene.off(se.RELOAD_TOURNAMENT,this.reload,this),this.unlistenUIEvents()}},{key:"unlistenUIEvents",value:function(){this.node.scene.off(aR.HIDE_UI,this.hideContent),this.node.scene.off(aR.SHOW_UI,this.showContent)}},{key:"onScrolling",value:function(){this.tournamentsBoard.updateVisibility()}},{key:"enableUIAnimator",value:function(){this.panelAnimator.enabled=!0}},{key:"disableUIAnimator",value:function(){this.panelAnimator.enabled=!1}},{key:"enter",value:(k=Ee(function(){var p,v,g,E,k;return _ts_generator(this,function(C){switch(C.label){case 0:if(this.listenEvents(),null!==this.animAbortSignal||null!==this.softAbortSignal)throw new Error("TournamentContent: TournamentContent is already running");this.animAbortSignal=new na,this.softAbortSignal=new na;return[4,this.showLoading(this.animAbortSignal)];case 1:if(C.sent(),!!this.isAborted())return[3,9];return[4,ll.requestTournamentDataAsync()];case 2:v=C.sent();g=this.isAborted();if(g)return[3,8];return[4,this.hideLoading(this.animAbortSignal)];case 3:C.sent();E=this.isAborted();if(E)return[3,7];if(!(0!==v.length||null!==(p=this.softAbortSignal)&&void 0!==p&&p.aborted))return[3,5];this.tryShowTournamentResult(),this.scrollView.enabled=!0,this.tournamentsBoard.updateData(v);return[4,this.tournamentsBoard.showTournamentBlocks(this.uiTransform.contentSize.height-this.tournamentsBoard.layout.paddingTop,this.animAbortSignal)];case 4:k=C.sent();return[3,6];case 5:k=this.tournamentsNotAvailable.show();C.label=6;case 6:E=k;C.label=7;case 7:g=E;C.label=8;case 8:C.label=9;case 9:return[2]}})}),function(){return k.apply(this,arguments)})},{key:"showLoading",value:(E=Ee(function(p){return _ts_generator(this,function(v){switch(v.label){case 0:this.scrollView.scrollToTop(0),this.scrollView.enabled=!1;return[4,Promise.all([this.skeletons.map(function(v){return v.show(0,p)})])];case 1:v.sent();return[2]}})}),function(p){return E.apply(this,arguments)})},{key:"hideLoading",value:(g=Ee(function(p){return _ts_generator(this,function(v){switch(v.label){case 0:return[4,Promise.all([this.skeletons.map(function(v){return v.hide(p)})])];case 1:v.sent();return[2]}})}),function(p){return g.apply(this,arguments)})},{key:"tryShowTournamentResult",value:function(){try{if(!TF.getStorage("tournament").animateTournamentLeader)return;var p=ll.getAllTournamentData(),v=TB.getMatchState().customData.tournamentId;if(!v)throw new Error("Tournament ID not found");var g=TG.search(p,function(p){return p.id===v});if(!g)throw new Error("Tournament not found");var E=JSON.stringify(g);s8.showTournamentDetailScreen(E,"tournament_end")}catch(p){TF.setStorageData("tournament","animateTournamentLeader",!1),console.warn("showTournamentResult",p)}}},{key:"processCreateTournament",value:(v=Ee(function(){var p;return _ts_generator(this,function(v){switch(v.label){case 0:v.trys.push([0,2,,3]);return[4,sx.processCreateTournamentAsync()];case 1:v.sent();return[3,3];case 2:p=v.sent();if(!Tz.hasOwn(p,"code"))return[2,void s8.showNotificationScreen("Sorry. Unknown error. Failed to Create Tournament")];if("USER_INPUT"===p.code)return[2];"INVALID_OPERATION"===p.code?s8.showNotificationScreen(p.message):s8.showNotificationScreen("Sorry. Unknown error. Failed to Create Tournament");return[3,3];case 3:this.reload();return[2]}})}),function(){return v.apply(this,arguments)})},{key:"isAborted",value:function(){var p,v;return null===(p=null===(v=this.animAbortSignal)||void 0===v?void 0:v.aborted)||void 0===p||p}},{key:"cleanup",value:function(){var p;this.unlistenEvents(),null===(p=this.animAbortSignal)||void 0===p||p.abort(),this.animAbortSignal=null,this.tournamentsBoard.removeTournamentBlocks(),this.tournamentsNotAvailable.hide()}},{key:"softAbort",value:function(){var p;null===(p=this.softAbortSignal)||void 0===p||p.abort(),this.softAbortSignal=null}},{key:"reload",value:function(){this.softAbort(),this.cleanup(),this.enter()}}]),r}(L)).prototype,"panelAnimator",[Tg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),TA=Ye(TC.prototype,"tournamentsBoard",[Tm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),TT=Ye(TC.prototype,"tournamentsNotAvailable",[Tb],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),TI=Ye(TC.prototype,"scrollView",[Tw],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),TR=Ye(TC.prototype,"skeletons",[TS],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),TP=Ye(TC.prototype,"contentOpacity",[TE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Tk=TC))||Tk);g._RF.pop(),g._RF.push({},"bce5eh0LHVP2bCJ6u+kFjuA","TournamentPage",void 0);var Tj,TH,TV,Tq,TW;(0,E.ccclass)("TournamentPage")(function(p){Ie(o,p);var v,g,E,k=xe(o);function o(){return Ce(this,o),k.apply(this,arguments)}return Ae(o,[{key:"mount",value:(E=Ee(function(){var p;return _ts_generator(this,function(v){switch(v.label){case 0:if(!!this.pagePrefab)return[3,2];return[4,nP.loadPrefabAsync(nr.TOURNAMENTS_PAGE)];case 1:p=v.sent();p&&this.node&&(this.pagePrefab=p);v.label=2;case 2:return[4,Fe(Pe(o.prototype),"mount",this).call(this)];case 3:if(v.sent(),this.containerUIOpacity.opacity=0,this.content=this.container.getComponentInChildren(TY),!this.content)throw new Error("LeaderboardPage: Leaders not found");return[2]}})}),function(){return E.apply(this,arguments)})},{key:"transitionIn",value:(g=Ee(function(){var p,v,g;return _ts_generator(this,function(E){switch(E.label){case 0:p=this;return[4,Fe(Pe(o.prototype),"transitionIn",this).call(this)];case 1:E.sent(),this.content.enableUIAnimator();v=tJ.runTweenAsync(G(this.containerUIOpacity).to(.2,{opacity:255})),g=new Promise(function(v){p.node.scene.emit(aR.SHOW_UI,{onComplete:function(){v()}})});return[4,Promise.all([v,g])];case 2:E.sent(),this.content.enter();return[2]}})}),function(){return g.apply(this,arguments)})},{key:"transitionOut",value:(v=Ee(function(){var p,v;return _ts_generator(this,function(g){switch(g.label){case 0:v=this;null===(p=this.content)||void 0===p||p.softAbort(),this.content.unlistenUIEvents();return[4,Fe(Pe(o.prototype),"transitionOut",this).call(this)];case 1:g.sent();return[4,new Promise(function(p){v.node.scene.emit(aR.HIDE_UI,{onComplete:function(){p()}})})];case 2:g.sent(),this.content.disableUIAnimator();return[2]}})}),function(){return v.apply(this,arguments)})},{key:"unmount",value:function(){var p;null===(p=this.content)||void 0===p||p.cleanup(),Fe(Pe(o.prototype),"unmount",this).call(this)}}]),o}(bF));g._RF.pop(),g._RF.push({},"b8271vI+3pO9q8SKMYpqLKv","EventBadge",void 0);var TK,TX,TJ,TQ,TZ,T$,T0,T1,T2=E.ccclass,T4=E.property;Tj=T2("EventBadge"),TH=T4(I),TV=T4(x),Tj((TW=Ye((Tq=function(p){Ie(n,p);var v=xe(n);function n(){var p;Ce(this,n);for(var g=arguments.length,E=new Array(g),k=0;k<g;k++)E[k]=arguments[k];return je(p=v.call.apply(v,[this].concat(E)),"label",TW,Ne(p)),p}return Ae(n,[{key:"text",get:function(){return this.label.string},set:function(p){this.label.string=p}},{key:"onLoad",value:function(){this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){if(!this.label)throw new Error("EventBadge: Missing required component Label")}}]),n}(L)).prototype,"label",[TH],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ye(Tq.prototype,"text",[TV],Object.getOwnPropertyDescriptor(Tq.prototype,"text"),Tq.prototype),Tq));g._RF.pop(),g._RF.push({},"7712cs4XLJAgpKqlO3gPqkF","EventProgressBar",void 0);var T3,T5,T6,T9,T8,T7,It,In,Ii,Ia,Ir,Io,Is,Il,Iu,Ic,Ih,Id,Ip,If,Iy,Iv,Ig,Im,Ib,Iw,IS,IE,Ik,IC,I_,IA,IT,II,IR,IP,IN,ID,IL,IO,IM,Ix,IF,IB,IU,Iz=E.ccclass,IG=E.property;TK=Iz("EventProgressBar"),TX=IG(rN),TJ=IG(I),TQ=IG(x),TZ=IG({range:[0,1,.01],slide:!0,tooltip:"i18n:progress.progress"}),TK((T0=Ye((T$=function(p){Ie(n,p);var v=xe(n);function n(){var p;Ce(this,n);for(var g=arguments.length,E=new Array(g),k=0;k<g;k++)E[k]=arguments[k];return je(p=v.call.apply(v,[this].concat(E)),"progressBar",T0,Ne(p)),je(p,"progressLabel",T1,Ne(p)),p}return Ae(n,[{key:"text",get:function(){return this.progressLabel.string},set:function(p){this.progressLabel.string=p}},{key:"progress",get:function(){return this.progressBar.progress},set:function(p){this.progressBar.progress=p}},{key:"__preload",value:function(){}},{key:"onLoad",value:function(){this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){if(!this.progressBar)throw new Error("EventProgressBar: Missing required component TapperedProgressBar");if(!this.progressLabel)throw new Error("EventProgressBar: Missing required component Label")}}]),n}(L)).prototype,"progressBar",[TX],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),T1=Ye(T$.prototype,"progressLabel",[TJ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ye(T$.prototype,"text",[TQ],Object.getOwnPropertyDescriptor(T$.prototype,"text"),T$.prototype),Ye(T$.prototype,"progress",[TZ],Object.getOwnPropertyDescriptor(T$.prototype,"progress"),T$.prototype),T$));g._RF.pop(),g._RF.push({},"7741dWPNcdHRqGVvif/L/MP","NavButton",void 0);var IY,Ij,IH,IV,Iq,IW,IK,IX=E.ccclass,IJ=E.property,IQ=E.executeInEditMode,IZ=globalThis.game.analytics,I$=GameCore.Plugins.Analytics.Events;T3=IX("NavButton"),T5=IJ(es),T6=IJ({group:{name:"Animation"},displayName:"Is Selected",tooltip:"This is for the editor only and will be ignored at runtime",editorOnly:!0}),T9=IJ({type:Y,group:{name:"Animation"}}),T8=IJ({type:Y,group:{name:"Animation"}}),T7=IJ({type:Y,group:{name:"Animation"}}),It=IJ({type:Y,group:{name:"Animation"}}),In=IJ({type:Y,group:{name:"Animation"}}),Ii=IJ({group:{name:"Animation"}}),Ia=IJ({type:Y,group:{name:"Animation"}}),Ir=IJ({type:Y,group:{name:"Animation"}}),Io=IJ({group:{name:"Animation"}}),Is=IJ({type:Y,group:{name:"Animation"}}),Il=IJ({type:Y,group:{name:"Animation"}}),Iu=IJ({type:Y,group:{name:"Animation"}}),Ic=IJ({type:Y,group:{name:"Animation"}}),Ih=IJ({type:A}),Id=IJ(k),Ip=IJ(et),If=IJ({type:A}),Iy=IJ({type:$(nn)}),Iv=IJ(kq),T3(Ig=IQ((Ib=Ye((Im=function(p){Ie(o,p);var v,g,E=xe(o);function o(){var p;Ce(this,o);for(var v=arguments.length,g=new Array(v),k=0;k<v;k++)g[k]=arguments[k];return je(p=E.call.apply(E,[this].concat(g)),"wip",Ib,Ne(p)),je(p,"isSelectedInEditor",Iw,Ne(p)),je(p,"animationDuration",IS,Ne(p)),je(p,"selectedSpacing",IE,Ne(p)),je(p,"deselectedSpacing",Ik,Ne(p)),je(p,"selectedIconY",IC,Ne(p)),je(p,"selectedIconX",I_,Ne(p)),je(p,"selectedIconScale",IA,Ne(p)),je(p,"deselectedIconY",IT,Ne(p)),je(p,"deselectedIconX",II,Ne(p)),je(p,"deselectedIconScale",IR,Ne(p)),je(p,"selectedTextY",IP,Ne(p)),je(p,"selectedTextX",IN,Ne(p)),je(p,"deselectedTextY",ID,Ne(p)),je(p,"deselectedTextX",IL,Ne(p)),je(p,"spacer",IO,Ne(p)),je(p,"icon",IM,Ne(p)),je(p,"text",Ix,Ne(p)),je(p,"uiTransform",IF,Ne(p)),je(p,"screenType",IB,Ne(p)),je(p,"navManager",IU,Ne(p)),p.isSelected=!1,p.onMouseEnter=function(v){p.isSelected||p.playHoverOnAnimation()},p.onMouseLeave=function(v){p.isSelected||p.playHoverOffAnimation()},p}return Ae(o,[{key:"isWIP",get:function(){return this.wip}},{key:"buttonType",get:function(){return this.screenType}},{key:"update",value:function(){}},{key:"onEnable",value:function(){this.node.on(k.EventType.MOUSE_ENTER,this.onMouseEnter),this.node.on(k.EventType.MOUSE_LEAVE,this.onMouseLeave)}},{key:"onDisable",value:function(){this.node.off(k.EventType.MOUSE_ENTER,this.onMouseEnter),this.node.off(k.EventType.MOUSE_LEAVE,this.onMouseLeave)}},{key:"onEditorUpdate",value:function(){null!==this.icon&&void 0!==this.icon&&null!==this.text&&void 0!==this.icon&&null!==this.spacer&&void 0!==this.spacer&&(this.isSelectedInEditor?(this.icon.setScale(this.selectedIconScale),this.icon.setPosition(this.selectedIconX,this.selectedIconY,0),this.text.node.setPosition(this.selectedTextX,this.selectedTextY,0),this.spacer.width=this.selectedSpacing,this.text.opacity=255):(this.icon.setScale(this.deselectedIconScale),this.icon.setPosition(this.deselectedIconX,this.deselectedIconY,0),this.text.node.setPosition(this.deselectedTextX,this.deselectedTextY,0),this.spacer.width=this.deselectedSpacing,this.text.opacity=0))}},{key:"setSelected",value:function(){var p,v;this.isSelected||(nQ.playSound(nB.PATCH_SHIFT),this.navManager.selectUsingSceneTransition(this),IZ.event(I$.BUTTON_CLICK,{button_name:null!==(p=null===(v=this.node.parent)||void 0===v?void 0:v.name)&&void 0!==p?p:this.node.name,screen_name:nJ.getCurrentPage()}))}},{key:"select",value:(g=Ee(function(){var p;var v=arguments;return _ts_generator(this,function(g){switch(g.label){case 0:p=!(v.length>0&&void 0!==v[0])||v[0];if(this.isSelected)throw new Error("NavButton: Already selected");this.isSelected=!0;if(!p)return[3,2];return[4,tJ.runTweenAsync(this.playSelectAnimation())];case 1:g.sent();return[3,3];case 2:this.icon.setScale(this.selectedIconScale),this.icon.setPosition(this.selectedIconX,this.selectedIconY,0),this.text.node.setPosition(this.selectedTextX,this.selectedTextY,0),this.spacer.width=this.selectedSpacing,this.text.opacity=255;g.label=3;case 3:return[2]}})}),function(){return g.apply(this,arguments)})},{key:"deselect",value:(v=Ee(function(){var p,v;var g=arguments;return _ts_generator(this,function(E){switch(E.label){case 0:p=!(g.length>0&&void 0!==g[0])||g[0],v=g.length>1&&void 0!==g[1]&&g[1];if(!this.isSelected&&!v)throw new Error("NavButton: Already deselected");this.isSelected=!1;if(!p)return[3,2];return[4,tJ.runTweenAsync(this.deselectAnimation())];case 1:E.sent();return[3,3];case 2:this.icon.setScale(this.deselectedIconScale),this.icon.setPosition(this.deselectedIconX,this.deselectedIconY,0),this.text.node.setPosition(this.deselectedTextX,this.deselectedTextY,0),this.spacer.width=this.deselectedSpacing,this.text.opacity=0;E.label=3;case 3:return[2]}})}),function(){return v.apply(this,arguments)})},{key:"getSelectedWorldDistanceX",value:function(){var p=new ef(this.selectedIconX,this.selectedIconY,0),v=new ef(this.deselectedIconX,this.deselectedIconY,0),g=this.node.scale.clone();this.node.scale=this.selectedIconScale;var E=this.uiTransform.convertToWorldSpaceAR(p),k=this.uiTransform.convertToWorldSpaceAR(v);return this.node.scale=g,k.x-E.x}},{key:"playHoverOnAnimation",value:function(){var p=G(this.icon);return p.to(.1,{scale:this.deselectedIconScale.clone().add3f(.1,.1,0)},{easing:"cubicIn"}),tJ.runTweenAsync(p)}},{key:"playHoverOffAnimation",value:function(){var p=G(this.icon);return p.to(.1,{scale:this.deselectedIconScale},{easing:"cubicOut"}),tJ.runTweenAsync(p)}},{key:"playSelectAnimation",value:function(){var p=this;return G(this.spacer).to(this.animationDuration,{width:this.selectedSpacing},{easing:"linear",onUpdate:function(v,g){if(void 0!==g){var E=ee.quintInOut(g),k=ee.backOut(g),C=ee.linear(g),_=g<.5?2*g:1,A=p.deselectedIconY+(p.selectedIconY-p.deselectedIconY)*k,T=p.deselectedIconX+(p.selectedIconX-p.deselectedIconX)*C;p.icon.setPosition(T,A,0);var I=p.deselectedIconScale.clone().lerp(p.selectedIconScale,E);p.icon.setScale(I.x,I.y,p.icon.scale.z);var R=255*_,P=p.deselectedTextY+(p.selectedTextY-p.deselectedTextY)*C,N=p.deselectedTextX+(p.selectedTextX-p.deselectedTextX)*C;p.text.opacity=R,p.text.node.setPosition(N,P,0)}}})}},{key:"deselectAnimation",value:function(){var p=this;return G(this.spacer).to(this.animationDuration,{width:this.deselectedSpacing},{easing:"linear",onUpdate:function(v,g){if(void 0!==g){var E=eP(p.selectedIconY,p.deselectedIconY,g),k=eP(p.selectedIconX,p.deselectedIconX,g);p.icon.setPosition(k,E,0);var C=eP(255,0,g<.5?2*g:1);p.text.opacity=C;var _=eP(p.selectedTextY,p.deselectedTextY,g),A=eP(p.selectedTextX,p.deselectedTextX,g);p.text.node.setPosition(A,_,0);var T=p.selectedIconScale.clone().lerp(p.deselectedIconScale,ee.quintInOut(g));p.icon.setScale(T.x,T.y,p.icon.scale.z)}}})}},{key:"onLoad",value:function(){this.uiTransform=this.getComponent(A),this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){e7.lazyValidateProperties(this)}}]),o}(L)).prototype,"wip",[T5],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Iw=Ye(Im.prototype,"isSelectedInEditor",[T6],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),IS=Ye(Im.prototype,"animationDuration",[T9],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return .3}}),IE=Ye(Im.prototype,"selectedSpacing",[T8],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 150}}),Ik=Ye(Im.prototype,"deselectedSpacing",[T7],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 88}}),IC=Ye(Im.prototype,"selectedIconY",[It],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 20}}),I_=Ye(Im.prototype,"selectedIconX",[In],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),IA=Ye(Im.prototype,"selectedIconScale",[Ii],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new ef(1,1,1)}}),IT=Ye(Im.prototype,"deselectedIconY",[Ia],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),II=Ye(Im.prototype,"deselectedIconX",[Ir],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),IR=Ye(Im.prototype,"deselectedIconScale",[Io],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new ef(.8,.8,1)}}),IP=Ye(Im.prototype,"selectedTextY",[Is],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return -10}}),IN=Ye(Im.prototype,"selectedTextX",[Il],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),ID=Ye(Im.prototype,"deselectedTextY",[Iu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),IL=Ye(Im.prototype,"deselectedTextX",[Ic],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),IO=Ye(Im.prototype,"spacer",[Ih],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),IM=Ye(Im.prototype,"icon",[Id],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ix=Ye(Im.prototype,"text",[Ip],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),IF=Ye(Im.prototype,"uiTransform",[If],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),IB=Ye(Im.prototype,"screenType",[Iy],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),IU=Ye(Im.prototype,"navManager",[Iv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ig=Im))||Ig);g._RF.pop(),g._RF.push({},"9b83boaSv9PE6mRFqy0MSI8","GameScene",void 0);var I0,I1,I2,I4,I3,I5,I6,I9,I8,I7,Rt,Rn,Ri,Ra,Rr=E.ccclass,Ro=E.property,Rs=E.disallowMultiple,Rl=globalThis.game,Ru=Rl.audio,Rc=Rl.player,Rh=i1;IY=Rr("GameScene"),Ij=Ro(mU),IH=Ro(v6),IY(IV=Rs((IW=Ye((Iq=function(p){Ie(n,p);var v=xe(n);function n(){var p;Ce(this,n);for(var g=arguments.length,E=new Array(g),k=0;k<g;k++)E[k]=arguments[k];return je(p=v.call.apply(v,[this].concat(E)),"animSkipOverlay",IW,Ne(p)),je(p,"coinManager",IK,Ne(p)),p.handleGameExit=function(){po.hideBannerAds(),sq.switchScene(o8)},p.handleShowResults=function(){sq.switchScene(o7)},p.handleGameMaskWhenLayoutChanged=function(p){var v=W("Canvas/Game/GameObjects");if(v){var g=v.getComponent(eN);g&&(g.enabled=p===Rh.Landscape)}},p.attemptCallSubscribeBot=function(){"subscribeBotAsync"in GameSDK.extra&&GameSDK.extra.subscribeBotAsync().catch(function(p){console.warn("subscribeBotAsync",p)})},p}return Ae(n,[{key:"__preload",value:function(){this.validateRequiredComponents(),this.listenGameEvents(),po.showBannerAds()}},{key:"onLoad",value:function(){this.coinManager.init(this.animSkipOverlay)}},{key:"validateRequiredComponents",value:function(){e7.lazyValidateProperties(this)}},{key:"listenGameEvents",value:function(){ec.on(iH,this.handleGameMaskWhenLayoutChanged),this.node.scene.on(aR.GAME_EXIT,this.handleGameExit),this.node.scene.on(aR.SHOW_CHALLENGE_RESULTS,this.handleShowResults)}},{key:"start",value:function(){this.scheduleOnce(this.attemptCallSubscribeBot,.5),Rc.getPlayerSetting("music")&&nQ.playMusic(),this.updateVolumeBackgroundMusic(),this.scheduleOnce(this.preloadScenes,2)}},{key:"preloadScenes",value:function(){sq.preloadDashboardScene()}},{key:"updateVolumeBackgroundMusic",value:function(){Ru.setVolume(1,"global_music")}}]),n}(L)).prototype,"animSkipOverlay",[Ij],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),IK=Ye(Iq.prototype,"coinManager",[IH],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),IV=Iq))||IV);g._RF.pop(),g._RF.push({},"48081huyTZGu5rme4u8PrdR","Item",void 0);var Rd,Rp,Rf,Ry,Rv,Rg,Rm=E.ccclass,Rb=E.property;I0=Rm("ItemButton"),I1=Rb(es),I2=Rb(N),I4=Rb({type:F}),I3=Rb(I),I5=Rb(k),I6=Rb(k),I0((I8=Ye((I9=function(p){Ie(n,p);var v=xe(n);function n(){var p;Ce(this,n);for(var g=arguments.length,E=new Array(g),k=0;k<g;k++)E[k]=arguments[k];return je(p=v.call.apply(v,[this].concat(E)),"isDebug",I8,Ne(p)),je(p,"button",I7,Ne(p)),je(p,"quantity",Rt,Ne(p)),je(p,"quantityLabel",Rn,Ne(p)),je(p,"plusNode",Ri,Ne(p)),je(p,"quantityNode",Ra,Ne(p)),p}return Ae(n,[{key:"__preload",value:function(){this.item=this.getComponent(dQ),this.validateRequiredComponents()}},{key:"start",value:function(){this.quantity=this.item.loadQuantity(),this.quantityLabel.string="".concat(this.quantity),this.validateButton(),this.node.scene.on(aR.GRID_CREATE,this.validateButton,this),this.node.scene.on(aR.GRID_MATCH_SUCCESS,this.validateButton,this),this.node.scene.on(aR.GRID_CLEAR,this.validateButton,this)}},{key:"validateRequiredComponents",value:function(){if(!this.item)throw new Error("Item: BaseItem component not found");if(!this.button)throw new Error("Item: Button component not found");if(!this.quantityLabel)throw new Error("Item: Quantity label not found");if(!this.plusNode)throw new Error("Item: Plus node not found");if(!this.quantityNode)throw new Error("Item: Quantity node not found")}},{key:"validateButton",value:function(){var p=this;console.log("VALIDATE BUTTON"),this.canActivate().then(function(v){p.button.interactable=!0,p.plusNode.active=0==p.quantity,p.quantityNode.active=p.quantity>0})}},{key:"activate",value:function(){var p=this;return new Promise(function(v){if(p.quantity<=0)return p.handleShowAddItemScreen(),void v();p.item.activate().then(function(){p.isDebug||(p.quantity--,p.quantityLabel.string="".concat(p.quantity),p.item.saveQuantity()),p.validateButton(),v()})})}},{key:"canActivate",value:function(){return Promise.resolve(!0)}},{key:"addQuantity",value:function(p){this.quantity+=p,this.quantityLabel.string="".concat(this.quantity),this.item.saveQuantity(),this.validateButton()}},{key:"clearQuantity",value:function(){this.quantity=0,this.quantityLabel.string="".concat(this.quantity),this.item.saveQuantity(),this.validateButton()}},{key:"handleShowAddItemScreen",value:function(){s8.openScreen(nH.GET_ITEM_SCREEN,{item:oG.HINT,quantity:1})}}]),n}(L)).prototype,"isDebug",[I1],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),I7=Ye(I9.prototype,"button",[I2],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Rt=Ye(I9.prototype,"quantity",[I4],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Rn=Ye(I9.prototype,"quantityLabel",[I3],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ri=Ye(I9.prototype,"plusNode",[I5],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ra=Ye(I9.prototype,"quantityNode",[I6],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),I9));g._RF.pop(),g._RF.push({},"0c0b4cnFOFJ6pJmGNHnMo7m","ComboEffect",void 0);var Rw,RS,RE,Rk,RC,R_,RA=E.ccclass,RT=E.property;Rd=RA("ComboEffect"),Rp=RT(et),Rf=RT(e_),Rd((Rv=Ye((Ry=function(p){Ie(n,p);var v=xe(n);function n(){var p;Ce(this,n);for(var g=arguments.length,E=new Array(g),k=0;k<g;k++)E[k]=arguments[k];return je(p=v.call.apply(v,[this].concat(E)),"circleOpacity",Rv,Ne(p)),je(p,"particle",Rg,Ne(p)),p}return Ae(n,[{key:"onLoad",value:function(){this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){if(!this.circleOpacity)throw new Error("ComboEffect requires a circleOpacity component");if(!this.particle)throw new Error("ComboEffect requires a particle component")}},{key:"start",value:function(){this.node.scene.on(aR.COMBO_UPDATED,this.handleOnComboUpdated,this)}},{key:"handleOnComboUpdated",value:function(p){p>1&&(this.circleOpacity.node.scale=ef.ZERO,this.circleOpacity.opacity=127.5,this.particle.resetSystem(),G(this.circleOpacity.node).to(.2,{scale:new ef(1.3,1.3,1.3)},{easing:"quadOut"}).start(),G(this.circleOpacity).delay(.2).to(.2,{opacity:0},{easing:"expoIn"}).start())}}]),n}(L)).prototype,"circleOpacity",[Rp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Rg=Ye(Ry.prototype,"particle",[Rf],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ry));g._RF.pop(),g._RF.push({},"0506aJZ1EdPqJejQ2PpB980","ComboLabel",void 0);var RI,RR,RP,RN,RD,RL,RO,RM,Rx=E.ccclass,RF=E.property;Rw=Rx("ComboLabel"),RS=RF(I),RE=RF(k),Rw((RC=Ye((Rk=function(p){Ie(n,p);var v=xe(n);function n(){var p;Ce(this,n);for(var g=arguments.length,E=new Array(g),k=0;k<g;k++)E[k]=arguments[k];return je(p=v.call.apply(v,[this].concat(E)),"comboNumber",RC,Ne(p)),je(p,"comboContainer",R_,Ne(p)),p}return Ae(n,[{key:"onLoad",value:function(){this.opacity=this.getComponent(et),this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){e7.lazyValidateProperties(this)}},{key:"start",value:function(){this.node.scene.on(aR.COMBO_UPDATED,this.handleOnComboUpdated,this)}},{key:"handleOnComboUpdated",value:function(p){0===p?this.opacity.opacity=0:p>1?(this.opacity.opacity=255,this.comboNumber.string="".concat(p),G(this.comboContainer).to(.1,{scale:new ef(1.3,1.3,1.3)},{easing:"sineIn"}).to(.1,{scale:ef.ONE},{easing:"sineOut"}).start()):this.opacity.opacity=0}}]),n}(L)).prototype,"comboNumber",[RS],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),R_=Ye(Rk.prototype,"comboContainer",[RE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Rk));g._RF.pop(),g._RF.push({},"51871oF8CFOkp81rgCf90UQ","ComboPopup",void 0);var RB,RU,Rz,RG,RY,Rj,RH,RV,Rq,RW=E.ccclass,RK=E.property;RI=RW("ComboPopup"),RR=RK(V),RP=RK(Z),RN=RK(M),RI((RL=Ye((RD=function(p){Ie(n,p);var v=xe(n);function n(){var p;Ce(this,n);for(var g=arguments.length,E=new Array(g),k=0;k<g;k++)E[k]=arguments[k];return je(p=v.call.apply(v,[this].concat(E)),"textSprite",RL,Ne(p)),je(p,"comboSprites",RO,Ne(p)),je(p,"animation",RM,Ne(p)),p}return Ae(n,[{key:"onLoad",value:function(){this.validateRequiredComponents()}},{key:"start",value:function(){this.node.scene.on(aR.COMBO_UPDATED,this.handleOnComboUpdated,this)}},{key:"validateRequiredComponents",value:function(){if(!this.textSprite)throw new Error("ComboPopup: textSprite not found");if(0===this.comboSprites.length)throw new Error("ComboPopup: comboSprites not found");if(!this.animation)throw new Error("ComboPopup: animation not found")}},{key:"handleOnComboUpdated",value:function(p){if(!(p<2)){for(var v=this.comboSprites.length-1;v>=0;v--)if(p>=v+2){this.textSprite.spriteFrame=this.comboSprites[v],this.animation.play();break}}}}]),n}(L)).prototype,"textSprite",[RR],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),RO=Ye(RD.prototype,"comboSprites",[RP],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),RM=Ye(RD.prototype,"animation",[RN],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),RD));g._RF.pop(),g._RF.push({},"a0819yK3HpO2505QqLUOChz","PlayerScore",void 0);var RX,RJ,RQ,RZ,R$,R0,R1,R2,R4,R3,R5,R6,R9,R8,R7,Pt=E.ccclass,Pn=E.property,Pi=GameCore.Utils.Image,Pa=(RB=Pt("PlayerScore"),RU=Pn(k),Rz=Pn(I),RG=Pn(V),RB((RH=Ye((Rj=function(p){Ie(i,p);var v,g=xe(i);function i(){var p;Ce(this,i);for(var v=arguments.length,E=new Array(v),k=0;k<v;k++)E[k]=arguments[k];return je(p=g.call.apply(g,[this].concat(E)),"crown",RH,Ne(p)),je(p,"playerScore",RV,Ne(p)),je(p,"avatar",Rq,Ne(p)),p}return Ae(i,[{key:"showCrown",value:function(p){this.crown.active=p}},{key:"setPlayerScore",value:function(p){this.playerScore.string=p.toString()}},{key:"playWaitingAnimation",value:function(){var p=this,v=0;this.playerScore.schedule(function(){v=(v+1)%4;var g=Array(v+1).join(".");p.playerScore.string="Waiting"+g},.5);var g=this.playerScore.getComponent(et),E=G(g).to(1,{opacity:130},{easing:"sineInOut"}).to(1,{opacity:255},{easing:"sineInOut"}).delay(.25);this.waitingAnimation=G(g).repeatForever(E).start()}},{key:"stopWaitingAnimation",value:function(){this.playerScore.unscheduleAllCallbacks(),this.waitingAnimation&&this.waitingAnimation.stop(),this.playerScore.getComponent(et).opacity=255}},{key:"loadPhoto",value:(v=Ee(function(p){var v,g,E;return _ts_generator(this,function(k){switch(k.label){case 0:k.trys.push([0,2,,3]);return[4,Pi.loadImage(p)];case 1:v=k.sent();if(!v)throw new Error("Failed to load image");g=Z.createWithImage(v);if(!g)throw new Error("Failed to create sprite frame");g.packable=!0,this.avatar.spriteFrame=g;return[3,3];case 2:E=k.sent();return[2,void console.error(E)];case 3:return[2]}})}),function(p){return v.apply(this,arguments)})}]),i}(L)).prototype,"crown",[RU],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),RV=Ye(Rj.prototype,"playerScore",[Rz],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Rq=Ye(Rj.prototype,"avatar",[RG],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),RY=Rj))||RY);g._RF.pop(),g._RF.push({},"4b062RYQK5PQbgs7yH66gDw","ChallengeResultScene",void 0);var Pr,Po,Ps,Pl,Pu,Pc,Ph,Pd,Pp,Pf=E.ccclass,Py=E.disallowMultiple,Pv=E.property,Pg=globalThis.game,Pm=Pg.match,Pb=Pg.player,Pw=Pg.monitorError,PS="Waiting",PE=GameCore.Dtos.Match.Data;RX=Pf("ChallengeResultScene"),RJ=Pv(F),RQ=Pv({type:Pa,group:"Score"}),RZ=Pv({type:Pa,group:"Score"}),R$=Pv(g0),R0=Pv(I),R1=Pv(d5),RX(R2=Py((R3=Ye((R4=function(p){Ie(i,p);var v,g=xe(i);function i(){var p;Ce(this,i);for(var v=arguments.length,E=new Array(v),k=0;k<v;k++)E[k]=arguments[k];return je(p=g.call.apply(g,[this].concat(E)),"pollingInterval",R3,Ne(p)),je(p,"playerScore",R5,Ne(p)),je(p,"opponentScore",R6,Ne(p)),je(p,"paperConfetti",R9,Ne(p)),je(p,"titleText",R8,Ne(p)),je(p,"levelManager",R7,Ne(p)),p.goToDashboardScene=function(){po.hideBannerAds(),sq.switchScene(o8)},p.pollMatchState=Ee(function(){var v,g,E,k,C,_,A,T,I,R,P,N,D,L,O,M,x,F;return _ts_generator(this,function(B){switch(B.label){case 0:B.trys.push([0,2,,3]);v=Pm.getMatchState().id;if(null===v)throw new Error("Match id is not found");g=Pb.getPlayerId(),E=Date.now();return[4,Pm.api.getMatchAPI().getMatchDetailByIdAsync(v)];case 1:k=B.sent(),C=Date.now(),_=Math.max(0,C-E,p.pollingInterval),A=new PE(k).toObject(),T=A.blackPlayerId,I=A.blackPlayerScore,R=A.whitePlayerScore,P=A.blackPlayerFinish,N=A.whitePlayerFinish,D=g===T?I:R,L=g===T?R:I,O=g===T?P:N,M=g===T?N:P,x=P&&N;if(p.playerScore.setPlayerScore(D),p.opponentScore.setPlayerScore(L),p.playerScore.showCrown(x&&D>L),p.opponentScore.showCrown(x&&L>D),p.stopWaitingAnimation(),p.playerScore.stopWaitingAnimation(),p.opponentScore.stopWaitingAnimation(),x){if(D===L)p.titleText.string="Draw";else if(D>L)p.titleText.string="You Win";else{if(!(D<L))return[2];p.titleText.string="You Lose"}}else p.titleText.string=PS,p.playWaitingAnimation(),O||p.playerScore.playWaitingAnimation(),M||p.opponentScore.playWaitingAnimation();p.scheduleOnce(p.pollMatchState,_);return[3,3];case 2:F=B.sent();console.warn("ResultScene: Error on pollMatchState",F),p.scheduleOnce(p.pollMatchState,p.pollingInterval);return[3,3];case 3:return[2]}})}),p}return Ae(i,[{key:"__preload",value:function(){this.validateRequiredComponents(),this.listenEvents(),po.showBannerAds()}},{key:"validateRequiredComponents",value:function(){e7.lazyValidateProperties(this)}},{key:"onLoad",value:function(){try{var p=Pm.getMatchState(),v=p.customData,g=v.playerId,E=v.opponentId;if(null===g||null===E)throw new Error("ResultScene: playerId is ".concat(g," and opponentId is ").concat(E,". Expected to not be null."));var k=Pb.getPlayer().photo,C=p.profiles[g],_=C.score,A=void 0===_?0:_,T=C.finished,I=void 0!==T&&T,R=p.profiles[E],P=R.photo,N=R.score,D=void 0===N?0:N,L=R.finished,O=void 0!==L&&L,M=I&&O,x=M&&A>D,F=M&&D>A;this.playerScore.loadPhoto(k),this.opponentScore.loadPhoto(P),this.playerScore.setPlayerScore(A),this.opponentScore.setPlayerScore(D),this.playerScore.showCrown(x),this.opponentScore.showCrown(F),I&&O?A===D?this.titleText.string="Draw":x?this.titleText.string="You Win":F&&(this.titleText.string="You Lose"):(this.titleText.string=PS,this.playWaitingAnimation(),I||this.playerScore.playWaitingAnimation(),O||this.opponentScore.playWaitingAnimation())}catch(p){console.warn("ResultScene: Error on load",p),this.goToDashboardScene()}}},{key:"listenEvents",value:function(){this.node.scene.on(iX,this.goToDashboardScene),this.node.scene.on(iK,this.onReplayButtonPressed,this)}},{key:"start",value:function(){var p=this;this.scheduleOnce(this.pollMatchState,this.pollingInterval),this.scheduleOnce(function(){p.paperConfetti.runEffect()},.2)}},{key:"onDestroy",value:function(){this.unschedule(this.pollMatchState)}},{key:"onReplayButtonPressed",value:(v=Ee(function(){var p,v,g,E,k,C,_,A,T,I,R,P,N,D;return _ts_generator(this,function(L){switch(L.label){case 0:v=(null!==(p=Pb.getGameData())&&void 0!==p?p:{}).level,g=void 0===v?1:v;g=Math.max(1,g);return[4,this.levelManager.loadLevelData(g)];case 1:E=L.sent();L.label=2;case 2:L.trys.push([2,4,,5]);if(!E)throw new Error("Level data is not found");k=Pm.getMatchState().customData.opponentId;if(!k)throw new Error("Opponent id is not found");s8.showLoadingScreen();C=ub.generateFen(E),_=E.mode,A=void 0===_?"":_,T=E.rules,I=void 0===T?{addRandomTilesPerMove:0,maxSpaceOfPair:0}:T,R=E.time,P=void 0===R?0:R,N=E.level;return[4,Pm.challenge.friend.processAsync({playerId:Pb.getPlayerId(),opponentId:k,extraData:{level:N,fen:C,gravity:A,rules:I,time:P}})];case 3:L.sent(),s8.closeLoadingScreen(),this.goToGameScene();return[3,5];case 4:D=L.sent();console.warn("ReplayChallengeFriend",D),s8.closeLoadingScreen(),s8.showNotificationScreen("Sorry, you cannot replay\nat this time.",2),null==Pw||Pw.sendException(_instanceof(D,Error)?D:new Error("ReplayChallengeFriend"+JSON.stringify(D))),this.scheduleOnce(this.goToDashboardScene,2);return[3,5];case 5:return[2]}})}),function(){return v.apply(this,arguments)})},{key:"onHomeButtonPressed",value:function(){this.goToDashboardScene()}},{key:"goToGameScene",value:function(){sq.switchScene(o9)}},{key:"playWaitingAnimation",value:function(){var p=this,v=0;this.titleText.schedule(function(){v=(v+1)%4;var g=Array(v+1).join(".");p.titleText.string=PS+g},.5);var g=this.titleText.getComponent(et),E=G(g).to(1,{opacity:130},{easing:"sineInOut"}).to(1,{opacity:255},{easing:"sineInOut"}).delay(.25);this.waitingAnimation=G(g).repeatForever(E).start()}},{key:"stopWaitingAnimation",value:function(){this.titleText.unscheduleAllCallbacks(),this.waitingAnimation&&this.waitingAnimation.stop(),this.titleText.getComponent(et).opacity=255}}]),i}(L)).prototype,"pollingInterval",[RJ],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 15}}),R5=Ye(R4.prototype,"playerScore",[RQ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),R6=Ye(R4.prototype,"opponentScore",[RZ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),R9=Ye(R4.prototype,"paperConfetti",[R$],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),R8=Ye(R4.prototype,"titleText",[R0],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),R7=Ye(R4.prototype,"levelManager",[R1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),R2=R4))||R2);g._RF.pop(),g._RF.push({},"acb0egHPppFmYJalVNrDDv/","BaseScreen",void 0);var Pk,PC=E.ccclass,P_=E.property,PA=E.disallowMultiple,PT=GameCore.Events,PI=globalThis.game.event,PR=(Pr=PC("BaseScreen"),Po=P_(k),Ps=P_(k),Pl=P_(et),Pr(Pu=PA((Ph=Ye((Pc=function(p){Ie(n,p);var v=xe(n);function n(){var p;Ce(this,n);for(var g=arguments.length,E=new Array(g),k=0;k<g;k++)E[k]=arguments[k];return je(p=v.call.apply(v,[this].concat(E)),"container",Ph,Ne(p)),je(p,"backgroundMask",Pd,Ne(p)),je(p,"screenOpacity",Pp,Ne(p)),p.data={},p}return Ae(n,[{key:"__preload",value:function(){this.animation=this.getComponent(M),this.validateRequiredComponents(),this.initializeNodes()}},{key:"initializeNodes",value:function(){var p=this.getMaskOpacity(),v=this.getContainerOpacity();p&&v&&(p.opacity=0,v.opacity=0)}},{key:"validateRequiredComponents",value:function(){e7.lazyValidateProperties(this)}},{key:"setScreenOpacity",value:function(p){this.screenOpacity.opacity=p}},{key:"open",value:function(p){p&&(this.data=p),this.show(),this.runAnimation("OpenScreen")}},{key:"close",value:function(){var p=this;this.node.active&&(this.animation.once(M.EventType.FINISHED,function(){PI.emit(PT.CLOSED_SCREEN,{screenName:p.node.name}),p.hide()}),this.runAnimation("CloseScreen"))}},{key:"runAnimation",value:function(p){if(!this.isAnimationExist(p))throw new Error("".concat(this.node.name,": Animation component must have ").concat(p," clip"));this.animation.play(p)}},{key:"isAnimationExist",value:function(p){return this.animation.clips.some(function(v){return!(!v||v.name!==p)})}},{key:"getMaskOpacity",value:function(){var p=this.backgroundMask.getComponent(et);return p||(console.warn("BaseScreen: maskOpacity not found"),null)}},{key:"getContainerOpacity",value:function(){var p=this.container.getComponent(et);return p||(console.warn("BaseScreen: containerOpacity not found"),null)}},{key:"show",value:function(){this.setScreenOpacity(255);var p=this.node.getComponent(j);p&&(p.enabled=!0,p.updateAlignment(),this.node.getComponentsInChildren(j).forEach(function(p){p.updateAlignment()}))}},{key:"hide",value:function(){this.setScreenOpacity(0),this.node.setWorldPosition(new ef(-1e3,-1e3,0));var p=this.node.getComponent(j);p&&(p.enabled=!1)}}]),n}(L)).prototype,"container",[Po],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Pd=Ye(Pc.prototype,"backgroundMask",[Ps],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Pp=Ye(Pc.prototype,"screenOpacity",[Pl],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Pu=Pc))||Pu)||Pu);g._RF.pop(),g._RF.push({},"f3521L4Mn5I3bhxr0QZJ9y9","BackgroundMask",void 0);var PP,PN,PD,PL,PO,PM=E.ccclass,Px=E.requireComponent;PM("BackgroundMask")(Pk=Px([et])(Pk=function(p){Ie(n,p);var v=xe(n);function n(){return Ce(this,n),v.apply(this,arguments)}return Ae(n,[{key:"onLoad",value:function(){var p=this.getComponent(et);p?(this.opacity=p,this.updateMaskAlpha()):console.warn("BackgroundMask: UIOpacity not found")}},{key:"updateMaskAlpha",value:function(){var p,v,g=this.opacity.opacity/255;p=g,(v=document.getElementById("app-mask"))&&(v.style.background="rgb(0 0 0 / ".concat(p,")"))}}]),n}(L))||Pk);g._RF.pop(),g._RF.push({},"d25c5ZVzYVC/YcfG5prmRdB","Screens",void 0);var PF,PB,PU,Pz,PG,PY,Pj,PH,PV,Pq,PW,PK,PX,PJ,PQ=E.ccclass,PZ=E.property,P$=(PP=PQ("Screens"),PN=PZ({type:$(nH)}),PP((PO=Ye((PL=function(p){Ie(n,p);var v=xe(n);function n(){var p;Ce(this,n);for(var g=arguments.length,E=new Array(g),k=0;k<g;k++)E[k]=arguments[k];return je(p=v.call.apply(v,[this].concat(E)),"screenKeys",PO,Ne(p)),p}return Ae(n)}(L)).prototype,"screenKeys",[PN],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),PD=PL))||PD);g._RF.pop(),g._RF.push({},"cecf2nUBzhIWZw7uJgVliXz","CongratulationScreen",void 0);var P0,P1,P2,P4,P3,P5,P6,P9,P8,P7,Nt,Nn,Ni,Na,Nr,No,Ns,Nl,Nu,Nc,Nd,Np=E.ccclass,Nf=E.property,Ny=E.disallowMultiple,Nv=E.requireComponent,Ng=GameCore.Events,Nm=globalThis.game.event;PF=Np("CongratulationScreen"),PB=Nv(PR),PU=Nf(k),Pz=Nf(k),PG=Nf(N),PY=Nf(N),Pj=Nf(N),PF(PH=Ny(PH=PB((Pq=Ye((PV=function(p){Ie(n,p);var v=xe(n);function n(){var p;Ce(this,n);for(var g=arguments.length,E=new Array(g),k=0;k<g;k++)E[k]=arguments[k];return je(p=v.call.apply(v,[this].concat(E)),"congratulation",Pq,Ne(p)),je(p,"confirmation",PW,Ne(p)),je(p,"closeButtonComponent",PK,Ne(p)),je(p,"yesButtonComponent",PX,Ne(p)),je(p,"noButtonComponent",PJ,Ne(p)),p.handleOpeningScreen=function(v){if(!p.screen)throw new Error("CongratulationScreen: screen not found");p.validateEventPayload(v)&&(p.closeButtonComponent.interactable=!0,p.yesButtonComponent.interactable=!0,p.noButtonComponent.interactable=!0)},p.handleOpenedScreen=function(v){p.validateEventPayload(v)&&p.open()},p}return Ae(n,[{key:"__preload",value:function(){this.enabled=!1,this.screen=this.getComponent(PR),this.confirmationUIOpacity=this.confirmation.getComponent(et),this.validateRequiredComponents(),this.listenScreenEvents()}},{key:"onDestroy",value:function(){this.unListenScreenEvents()}},{key:"validateRequiredComponents",value:function(){e7.lazyValidateProperties(this)}},{key:"listenScreenEvents",value:function(){Nm.on(Ng.OPENING_SCREEN,this.handleOpeningScreen),Nm.on(Ng.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"unListenScreenEvents",value:function(){Nm.off(Ng.OPENING_SCREEN,this.handleOpeningScreen),Nm.off(Ng.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"validateEventPayload",value:function(p){return p.screenName===this.node.name}},{key:"open",value:function(){this.confirmation.active=!1,this.congratulation.active=!0}},{key:"close",value:function(){this.closeButtonComponent.interactable=!1,this.yesButtonComponent.interactable=!1,this.noButtonComponent.interactable=!1,s8.closeScreen(nq[this.node.name])}},{key:"handleStartOver",value:function(){this.confirmation.active=!0,this.congratulation.active=!1,G(this.confirmationUIOpacity).set({opacity:0}).to(.2,{opacity:255}).start(),G(this.confirmation).set({scale:new ef(.8,.8,.8)}).to(.2,{scale:new ef(1,1,1)},{easing:"backOut"}).start()}},{key:"handleYesStartOver",value:function(){this.close(),this.node.scene.emit(aR.START_OVER)}},{key:"handleNoStartOver",value:function(){this.requestGameReplay()}},{key:"handleClickedClose",value:function(){this.requestGameReplay()}},{key:"requestGameReplay",value:function(){this.close(),this.node.scene.emit(aR.GAME_REPLAY,{level:this.screen.data.level})}}]),n}(L)).prototype,"congratulation",[PU],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),PW=Ye(PV.prototype,"confirmation",[Pz],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),PK=Ye(PV.prototype,"closeButtonComponent",[PG],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),PX=Ye(PV.prototype,"yesButtonComponent",[PY],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),PJ=Ye(PV.prototype,"noButtonComponent",[Pj],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),PH=PV))||PH)||PH);g._RF.pop(),g._RF.push({},"01c067hcjNDc7prJzSE6UEq","DayBlock",void 0);var Nb,Nw,NS,NE,Nk,NC,N_=E.ccclass,NA=E.property,NT=(P0=N_("DayBlock"),P1=NA({type:V,group:"Background"}),P2=NA({type:V,group:"Background"}),P4=NA({type:Z,group:"Background"}),P3=NA({type:Z,group:"Background"}),P5=NA(I),P6=NA(I),P9=NA(k),P8=NA(k),P7=NA(k),P0((Ni=Ye((Nn=function(p){Ie(n,p);var v=xe(n);function n(){var p;Ce(this,n);for(var g=arguments.length,E=new Array(g),k=0;k<g;k++)E[k]=arguments[k];return je(p=v.call.apply(v,[this].concat(E)),"background",Ni,Ne(p)),je(p,"topBackground",Na,Ne(p)),je(p,"blueBackground",Nr,Ne(p)),je(p,"blueTopBackground",No,Ne(p)),je(p,"dayLabel",Ns,Ne(p)),je(p,"coinLabel",Nl,Ne(p)),je(p,"rewardItemsNode",Nu,Ne(p)),je(p,"checkNode",Nc,Ne(p)),je(p,"glowNodes",Nd,Ne(p)),p}return Ae(n,[{key:"onLoad",value:function(){this.uiOpacity=this.getComponent(et),this.initDefaultProperties(),this.validateRequiredComponents()}},{key:"initDefaultProperties",value:function(){this.defaultBackground=this.background.spriteFrame,this.defaultTopBackground=this.topBackground.spriteFrame,this.defaultDayLabelOutlineColor=new C(this.dayLabel.outlineColor),this.blueDayLabelOutlineColor=new C("#3469bf")}},{key:"validateRequiredComponents",value:function(){e7.lazyValidateProperties(this)}},{key:"updateInfo",value:function(p){this.updateBackground(p),this.updateDayLabel(p),this.coinLabel.string=p.value.toString(),this.updateRewardItems(p)}},{key:"updateBackground",value:function(p){if(this.blueTopBackground&&this.blueBackground)switch(p.status){case"ready":this.background.spriteFrame=this.blueBackground,this.topBackground.spriteFrame=this.blueTopBackground;break;case"waiting":this.background.spriteFrame=this.defaultBackground,this.topBackground.spriteFrame=this.blueTopBackground;break;case"rewarded":this.background.spriteFrame=this.defaultBackground,this.topBackground.spriteFrame=this.defaultTopBackground}}},{key:"updateDayLabel",value:function(p){this.dayLabel.string="Day ".concat(p.day.toString());var v=this.defaultDayLabelOutlineColor;"rewarded"!==p.status&&(v=this.blueDayLabelOutlineColor),this.dayLabel.outlineColor=v,this.dayLabel.shadowColor=v}},{key:"updateRewardItems",value:function(p){switch(p.status){case"ready":this.rewardItemsNode.active=!0,this.checkNode.active=!1,this.setGlowNodesActive(!0);break;case"waiting":this.rewardItemsNode.active=!0,this.checkNode.active=!1,this.setGlowNodesActive(!1);break;case"rewarded":this.rewardItemsNode.active=!1,this.checkNode.active=!0,this.setGlowNodesActive(!1)}}},{key:"setGlowNodesActive",value:function(p){this.glowNodes&&this.glowNodes.forEach(function(v){v.active=p})}}]),n}(L)).prototype,"background",[P1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Na=Ye(Nn.prototype,"topBackground",[P2],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Nr=Ye(Nn.prototype,"blueBackground",[P4],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),No=Ye(Nn.prototype,"blueTopBackground",[P3],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ns=Ye(Nn.prototype,"dayLabel",[P5],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Nl=Ye(Nn.prototype,"coinLabel",[P6],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Nu=Ye(Nn.prototype,"rewardItemsNode",[P9],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Nc=Ye(Nn.prototype,"checkNode",[P8],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Nd=Ye(Nn.prototype,"glowNodes",[P7],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Nt=Nn))||Nt);g._RF.pop(),g._RF.push({},"cc662r8eR5Al6FdOBdcAkHG","DailyRewardsScreen",void 0);var NI=E.ccclass,NR=E.property,NP=E.requireComponent,NN=GameCore,ND=NN.Events,NL=NN.Utils,NO=NL.Object,NM=NL.Array,Nx=NN.Configs.DailyRewards,NF=globalThis.game,NB=NF.event,NU=NF.dailyRewards,Nz=NF.player,NG=NF.monitorError;Nb=NI("DailyRewardsScreen"),Nw=NP(PR),NS=NR([NT]),Nb(NE=Nw((NC=Ye((Nk=function(p){Ie(o,p);var v,g,E,k=xe(o);function o(){var p;Ce(this,o);for(var v=arguments.length,g=new Array(v),E=0;E<v;E++)g[E]=arguments[E];return(p=k.call.apply(k,[this].concat(g))).rewardsData=[],p.debugScreenOpened=!1,p.debugUpdatedRewardsData=!1,je(p,"dailyBlocks",NC,Ne(p)),p.handleOpeningScreen=function(v){p.validateEventPayload(v)},p.handleOpenedScreen=function(v){p.validateEventPayload(v)&&p.open()},p}return Ae(o,[{key:"__preload",value:function(){this.enabled=!1,this.screen=this.getComponent(PR),this.validateRequiredComponents(),this.listenScreenEvents()}},{key:"onDestroy",value:function(){this.unListenScreenEvents()}},{key:"validateRequiredComponents",value:function(){e7.lazyValidateProperties(this)}},{key:"listenScreenEvents",value:function(){NB.on(ND.OPENING_SCREEN,this.handleOpeningScreen),NB.on(ND.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"unListenScreenEvents",value:function(){NB.off(ND.OPENING_SCREEN,this.handleOpeningScreen),NB.off(ND.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"validateEventPayload",value:function(p){return(null!=p?p:{}).screenName===this.node.name}},{key:"open",value:(E=Ee(function(){return _ts_generator(this,function(p){switch(p.label){case 0:this.debugScreenOpened=!0,this.node.scene.emit(aR.HIDE_UI),this.resetState();return[4,this.updateRewardsData()];case 1:p.sent(),this.loginDailyRewards(),this.updateDayBlocks(),this.runPopUpAnimation();return[2]}})}),function(){return E.apply(this,arguments)})},{key:"close",value:function(){NB.emit(ND.CLOSE_SCREEN,{screenName:this.node.name}),this.node.scene.emit(aR.SHOW_UI)}},{key:"resetState",value:function(){this.dailyBlocks.forEach(function(p){p.uiOpacity.opacity=0,p.node.scale=new ef(1.2,1.2,1.2)})}},{key:"runPopUpAnimation",value:function(){var p=this;this.screen.container||console.warn("DailyRewardScreen: screen not found"),this.dailyBlocks.forEach(function(v,g){p.runAppearTween(v,.15*g)})}},{key:"runAppearTween",value:function(p,v){G(p.uiOpacity).delay(v).to(.3,{opacity:255},{easing:"quadOut"}).start(),G(p.node).delay(v).to(.3,{scale:ef.ONE},{easing:"backOut"}).start()}},{key:"handleOnClaim",value:function(){var p=this.getCurrentRewardData();if(!p)return null==NG||NG.sendException(new Error("DailyRewardsScreen: rewardData not found"),{nodeIsActive:this.node.activeInHierarchy,nodeHasParent:null!==this.node.parent&&void 0!==this.node.parent,hasLoadedRewardsData:this.debugUpdatedRewardsData,hasOpenedScreen:this.debugScreenOpened}),void s8.showNotificationScreen("Unable to validate rewards. Please try again later...",2);this.claimReward(p)}},{key:"handleOnClaimX2",value:(g=Ee(function(){var p;return _ts_generator(this,function(v){switch(v.label){case 0:p=this.getCurrentRewardData();if(!p)return[2,(null==NG||NG.sendException(new Error("DailyRewardsScreen: rewardData not found"),{nodeIsActive:this.node.activeInHierarchy,nodeHasParent:null!==this.node.parent&&void 0!==this.node.parent,hasLoadedRewardsData:this.debugUpdatedRewardsData,hasOpenedScreen:this.debugScreenOpened}),void s8.showNotificationScreen("Unable to validate rewards. Please try again later...",2))];return[4,po.showRewardVideoAdAsync({})];case 1:v.sent()&&this.claimReward(p,!0);return[2]}})}),function(){return g.apply(this,arguments)})},{key:"getCurrentRewardData",value:function(){return NM.search(this.rewardsData,function(p){return"ready"===p.status})}},{key:"claimReward",value:function(p,v){var g=arguments.length>1&&void 0!==v&&v,E=p.value*(g?2:1),k=new na;if(this.node.scene.emit(aR.ADD_COINS,{coins:E,collectionAnimation:{animateTextOnly:!1,signal:k}}),p.items){var C=p.items.hint*(g?2:1),_=p.items.thunder*(g?2:1),A=p.items.storm*(g?2:1),T=Nz.getGameData();T?(Nz.setGameData({items:{hint:T.items.hint+C,thunder:T.items.thunder+_,storm:T.items.storm+A,pliers:T.items.pliers}}),this.close()):this.close()}else this.close()}},{key:"updateRewardsData",value:(v=Ee(function(){var p,v;return _ts_generator(this,function(g){switch(g.label){case 0:return[4,NU.requestDailyRewardsAsync()];case 1:g.sent();for(p=we({},NU.getDailyRewards()),v=0;v<Nx.MaxDays;v++)p[v]=we(we({},p[v]),{},{value:oK[v].value,items:oK[v].items});p&&(this.rewardsData=NO.vals(p),this.debugUpdatedRewardsData=!0,console.log("DailyRewardsScreen: rewardsData",this.rewardsData));return[2]}})}),function(){return v.apply(this,arguments)})},{key:"loginDailyRewards",value:function(){NU.logLoginReward()}},{key:"updateDayBlocks",value:function(){var p=this;this.dailyBlocks.length>this.rewardsData.length&&(console.warn("DailyRewardsScreen: dailyBlocks not enough"),null==NG||NG.sendException(new Error("DailyRewardsScreen: dailyBlocks not enough"),{dailyBlocksCount:this.dailyBlocks.length,rewardsDataCount:this.rewardsData.length,nodeIsActive:this.node.activeInHierarchy,nodeHasParent:null!==this.node.parent&&void 0!==this.node.parent,hasLoadedRewardsData:this.debugUpdatedRewardsData,hasOpenedScreen:this.debugScreenOpened})),this.dailyBlocks.forEach(function(v,g){if(!(g>=p.rewardsData.length)){var E=p.rewardsData[g],k=E.id,C=E.type,_=E.value,A=E.status;v.updateInfo({day:k,type:C,value:_,status:A})}})}}]),o}(L)).prototype,"dailyBlocks",[NS],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),NE=Nk))||NE);g._RF.pop(),g._RF.push({},"5a6aeaMAdtMGYA8B1wIuhDa","DayBlockRed",void 0);var NY,Nj,NH,NV,NW,NK,NX,NJ,NQ,NZ;(0,E.ccclass)("DayBlockRed")(function(p){Ie(n,p);var v=xe(n);function n(){return Ce(this,n),v.apply(this,arguments)}return Ae(n,[{key:"updateBackground",value:function(p){if(this.blueTopBackground&&this.blueBackground)switch(p.status){case"ready":this.background.spriteFrame=this.blueBackground,this.topBackground.spriteFrame=this.blueTopBackground;break;case"waiting":this.background.spriteFrame=this.defaultBackground,this.topBackground.spriteFrame=this.defaultTopBackground}}},{key:"updateDayLabel",value:function(p){this.dayLabel.string="Day ".concat(p.day.toString());var v=this.defaultDayLabelOutlineColor;"ready"===p.status&&(v=this.blueDayLabelOutlineColor),this.dayLabel.shadowColor=v,this.dayLabel.outlineColor=v}}]),n}(NT));g._RF.pop(),g._RF.push({},"6fed95tFh5MRKzFqaFB2Ts8","GetCoinScreen",void 0);var N$,N0,N1,N2,N4,N3,N5,N6,N9,N8=E.ccclass,N7=E.property,Dt=E.requireComponent,Dn=globalThis.game.event,Di=GameCore.Events;NY=N8("GetCoinScreen"),Nj=Dt(PR),NH=N7(I),NV=N7(N),NW=N7(N),NY(NK=Nj((NJ=Ye((NX=function(p){Ie(i,p);var v,g=xe(i);function i(){var p;Ce(this,i);for(var v=arguments.length,E=new Array(v),k=0;k<v;k++)E[k]=arguments[k];return je(p=g.call.apply(g,[this].concat(E)),"quantityLabel",NJ,Ne(p)),je(p,"closeButtonComponent",NQ,Ne(p)),je(p,"getNowButtonComponent",NZ,Ne(p)),p.handleOpeningScreen=function(v){console.log("GetCoinScreen.OPENING_SCREEN",v),p.validateEventPayload(v)&&(p.closeButtonComponent.interactable=!0,p.getNowButtonComponent.interactable=!0,p.updateStatus())},p.handleOpenedScreen=function(v){p.validateEventPayload(v)&&p.open()},p}return Ae(i,[{key:"__preload",value:function(){this.enabled=!1,this.screen=this.getComponent(PR),this.validateRequiredComponents(),this.listenScreenEvents()}},{key:"onDestroy",value:function(){this.unListenScreenEvents()}},{key:"validateRequiredComponents",value:function(){e7.lazyValidateProperties(this)}},{key:"listenScreenEvents",value:function(){Dn.on(Di.OPENING_SCREEN,this.handleOpeningScreen),Dn.on(Di.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"unListenScreenEvents",value:function(){Dn.off(Di.OPENING_SCREEN,this.handleOpeningScreen),Dn.off(Di.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"validateEventPayload",value:function(p){return"screenName"in p&&p.screenName===this.node.name&&(this.payload=p,!0)}},{key:"open",value:function(){this.updateStatus(),this.runPopUpAnimation(),this.node.scene.emit(aR.HIDE_UI)}},{key:"close",value:function(){this.closeButtonComponent.interactable=!1,this.getNowButtonComponent.interactable=!1,Dn.emit(Di.CLOSE_SCREEN,{screenName:this.node.name}),this.node.scene.emit(aR.SHOW_UI)}},{key:"updateStatus",value:function(){this.updateCoinQuantity()}},{key:"runPopUpAnimation",value:function(){this.screen.container||console.warn("GetCoinScreen: screen not found")}},{key:"updateCoinQuantity",value:function(){var p=this.getQuantity();p&&this.updateQuantityLabel(p)}},{key:"updateQuantityLabel",value:function(p){this.quantityLabel.string="x".concat(p.toString())}},{key:"getQuantity",value:function(){if(!this.payload||!("screenData"in this.payload))return 0;var p=this.payload.screenData;return p&&"quantity"in p&&p.quantity&&"number"==typeof p.quantity?p.quantity:0}},{key:"handleAddCoin",value:function(){var p=this.getQuantity();this.node.scene.emit(aR.ADD_COINS,{coins:p,collectionAnimation:{animateTextOnly:!1}}),this.close()}},{key:"handleGetNowButtonClicked",value:(v=Ee(function(){return _ts_generator(this,function(p){switch(p.label){case 0:nQ.stopAllSounds();return[4,po.showRewardVideoAdAsync({})];case 1:p.sent()&&this.handleAddCoin();return[2]}})}),function(){return v.apply(this,arguments)})}]),i}(L)).prototype,"quantityLabel",[NH],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),NQ=Ye(NX.prototype,"closeButtonComponent",[NV],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),NZ=Ye(NX.prototype,"getNowButtonComponent",[NW],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),NK=NX))||NK);g._RF.pop(),g._RF.push({},"91e6dGDvN1FKLi7g/JQPwl8","ItemCollectionFX",void 0);var Da,Dr,Do,Ds,Du,Dc,Dh,Dd,Dp,Df,Dy,Dv,Dg,Dm,Db,Dw,DS,DE,Dk,DC,D_,DA,DT,DI,DR=E.ccclass,DP=E.property,DN=(N$=DR("ItemCollectionFX"),N0=DP(V),N1=DP(et),N2=DP(e_),N$((N5=Ye((N3=function(p){Ie(n,p);var v=xe(n);function n(){var p;Ce(this,n);for(var g=arguments.length,E=new Array(g),k=0;k<g;k++)E[k]=arguments[k];return je(p=v.call.apply(v,[this].concat(E)),"sprite",N5,Ne(p)),je(p,"glowUIOpacity",N6,Ne(p)),je(p,"particles",N9,Ne(p)),p}return Ae(n,[{key:"__preload",value:function(){e7.lazyValidateProperties(this)}},{key:"playExplosionParticles",value:function(){this.particles.resetSystem()}}]),n}(L)).prototype,"sprite",[N0],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),N6=Ye(N3.prototype,"glowUIOpacity",[N1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),N9=Ye(N3.prototype,"particles",[N2],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),N4=N3))||N4);g._RF.pop(),g._RF.push({},"f016fTAlsNKRYkdu72AyCLI","GetItemScreen",void 0);var DD,DL,DO,DM,Dx,DF,DB,DU,Dz,DG,DY,Dj,DH,DV,Dq,DW,DK,DX,DJ,DQ,DZ,D$,D0,D1,D2,D4,D3,D5,D6,D9,D8=E.ccclass,D7=E.property,Lt=globalThis.game,Ln=Lt.event,Li=Lt.player,La=Lt.analytics,Lr=GameCore,Lo=Lr.Events,Ls=Lr.Utils,Lu=Ls.Object,Lc=Ls.Array,Lh=Lr.Plugins.Analytics.Events;Da=D8("GetItemScreen"),Dr=D7(K),Do=D7(V),Ds=D7(V),Du=D7(V),Dc=D7(V),Dh=D7(I),Dd=D7(I),Dp=D7(I),Df=D7(N),Dy=D7(N),Dv=D7(N),Da((Dm=Ye((Dg=function(p){Ie(s,p);var v,g,E,k,C,_=xe(s);function s(){var p;Ce(this,s);for(var v=arguments.length,g=new Array(v),E=0;E<v;E++)g[E]=arguments[E];return je(p=_.call.apply(_,[this].concat(g)),"itemFxPrefab",Dm,Ne(p)),je(p,"hintSprite",Db,Ne(p)),je(p,"stormSprite",Dw,Ne(p)),je(p,"pliersSprite",DS,Ne(p)),je(p,"thunderSprite",DE,Ne(p)),je(p,"titleLabel",Dk,Ne(p)),je(p,"descriptionLabel",DC,Ne(p)),je(p,"coinLabel",D_,Ne(p)),je(p,"closeButtonComponent",DA,Ne(p)),je(p,"buyItemButtonComponent",DT,Ne(p)),je(p,"getNowButtonComponent",DI,Ne(p)),p.handleOpeningScreen=function(v){if(!p.screen)throw new Error("GetItemScreen: screen not found");if(p.validateEventPayload(v)){p.closeButtonComponent.interactable=!0,p.getNowButtonComponent.interactable=!0,p.buyItemButtonComponent.interactable=!0;var g=p.getItemType();g&&p.updateStatus(g)}},p.handleOpenedScreen=function(v){p.validateEventPayload(v)&&p.open()},p}return Ae(s,[{key:"__preload",value:function(){this.enabled=!1,this.screen=this.getComponent(PR),this.validateRequiredComponents(),this.listenScreenEvents()}},{key:"onDestroy",value:function(){this.unListenScreenEvents()}},{key:"validateRequiredComponents",value:function(){e7.lazyValidateProperties(this)}},{key:"listenScreenEvents",value:function(){Ln.on(Lo.OPENING_SCREEN,this.handleOpeningScreen),Ln.on(Lo.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"unListenScreenEvents",value:function(){Ln.off(Lo.OPENING_SCREEN,this.handleOpeningScreen),Ln.off(Lo.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"validateEventPayload",value:function(p){return(null!=p?p:{}).screenName===this.node.name&&(this.payload=p,!0)}},{key:"open",value:function(){this.node.scene.emit(aR.GAME_PAUSE)}},{key:"close",value:function(){this.closeButtonComponent.interactable=!1,this.buyItemButtonComponent.interactable=!1,this.getNowButtonComponent.interactable=!1,Ln.emit(Lo.CLOSE_SCREEN,{screenName:this.node.name}),this.node.scene.emit(aR.GAME_RESUME)}},{key:"updateStatus",value:function(p){this.updateItemIcon(p),this.updateTitle(p),this.updateDescription(),this.updateButtons(p)}},{key:"updateItemIcon",value:function(p){switch([this.hintSprite,this.stormSprite,this.thunderSprite,this.pliersSprite].forEach(function(p){p.node.active=!1}),p){case oG.HINT:this.activeIcon=this.hintSprite;break;case oG.STORM:this.activeIcon=this.stormSprite;break;case oG.THUNDER:this.activeIcon=this.thunderSprite;break;case oG.PLIERS:this.activeIcon=this.pliersSprite}this.activeIcon.node.active=!0}},{key:"updateTitle",value:function(p){var v=p.charAt(0).toUpperCase()+p.slice(1);this.titleLabel.string=v}},{key:"updateDescription",value:function(){var p,v=null===(p=this.payload.screenData)||void 0===p?void 0:p.message;v&&(this.descriptionLabel.string=v)}},{key:"updateButtons",value:function(p){var v=this.canBuyItem(p);this.buyItemButtonComponent.node.active=v,this.getNowButtonComponent.node.active=!v,v&&(this.coinLabel.string="".concat(3*oV[p]))}},{key:"canBuyItem",value:function(p){var v=Li.getGameData();return!!v&&v.coins>=3*oV[p]}},{key:"getItemType",value:function(){var p=this.payload.screenData;return p&&p.item&&Lc.has(Lu.vals(oG),p.item)?p.item:null}},{key:"handleAddItem",value:(C=Ee(function(){var p,v;return _ts_generator(this,function(g){p=this,v=this.getItemType();v&&(La.event(Lh.EARN_ITEM,{item_name:v,value:3}),this.node.scene.emit(aR.ADD_ITEM,{animate:function(){return p.animateAddItem(v)},item:v,quantity:3}));return[2]})}),function(){return C.apply(this,arguments)})},{key:"animateAddItem",value:(k=Ee(function(p){var v,g,E,k,C,_;return _ts_generator(this,function(A){switch(A.label){case 0:v=this.activeIcon.spriteFrame,g=Ue(this.createItemCollectionNode(v),2),E=g[0],k=g[1],C=this.getItemButtonWorldPosition(p),_=new ef(.5,.5,.5);k.glowUIOpacity.opacity=150;return[4,this.playScaleUpItemAnim(E,k)];case 1:A.sent();return[4,tJ.runTweenAsync(G(k.glowUIOpacity).to(.8,{opacity:0},{easing:"cubicIn"}))];case 2:A.sent();return[4,this.playMoveCloseToItemButtonAnim(E,C,_)];case 3:A.sent();return[4,this.playJumpAnim(E,_,C)];case 4:A.sent(),nQ.playSound("sounds/clicks"),E.destroy();return[2]}})}),function(p){return k.apply(this,arguments)})},{key:"playJumpAnim",value:(E=Ee(function(p,v,g){var E,k;return _ts_generator(this,function(C){switch(C.label){case 0:E=g.clone().add3f(0,70,0),k=v.clone().multiplyScalar(1.3);return[4,Promise.all([tJ.runTweenAsync(G(p).to(.3,{worldPosition:E},{easing:"cubicOut"})),tJ.runTweenAsync(G(p).to(.3,{scale:k},{easing:"cubicOut"}))])];case 1:C.sent();return[4,tJ.runTweenAsync(G(p).to(.5,{worldPosition:g},{easing:"cubicIn"}))];case 2:C.sent();return[2]}})}),function(p,v,g){return E.apply(this,arguments)})},{key:"playMoveCloseToItemButtonAnim",value:function(p,v,g){var E=v.clone().add3f(0,30,0);return tJ.runTweenAsync(G(p).to(1,{worldPosition:E,scale:g},{easing:"cubicInOut"}))}},{key:"createItemCollectionNode",value:function(p){var v=T(this.itemFxPrefab),g=v.getComponent(DN);return v.setParent(this.node.parent),g.sprite.spriteFrame=p,v.setWorldPosition(this.activeIcon.node.worldPosition.clone()),[v,g]}},{key:"playScaleUpItemAnim",value:function(p,v){return p.setScale(ef.ZERO),tJ.runTweenAsync(G(p).delay(.2).call(function(){v.playExplosionParticles(),nQ.playSound("sounds/item_reward")}).to(.1,{scale:new ef(.8,1.2,1)}).to(.1,{scale:new ef(1.2,.8,1)}).to(.1,{scale:new ef(1,1,1)}))}},{key:"getItemButtonWorldPosition",value:function(p){return this.getItemButton(p).worldPosition.clone()}},{key:"handleGetNowButtonClicked",value:(g=Ee(function(){return _ts_generator(this,function(p){switch(p.label){case 0:this.stopAllSounds();return[4,po.showRewardVideoAdAsync({})];case 1:p.sent()&&(this.handleAddItem(),this.close());return[2]}})}),function(){return g.apply(this,arguments)})},{key:"handleBuyItemButtonClicked",value:(v=Ee(function(){return _ts_generator(this,function(p){this.node.scene.emit(aR.REMOVE_COINS,{coins:3*oV[this.getItemType()],collectionAnimation:{animateTextOnly:!0}}),this.handleAddItem(),this.close();return[2]})}),function(){return v.apply(this,arguments)})},{key:"stopAllSounds",value:function(){var p;null===(p=W("Sound"))||void 0===p||null===(p=p.getComponent(tR))||void 0===p||p.stopAll()}},{key:"getItemButton",value:function(p){switch(p){case oG.HINT:return W("Canvas/UI/Footer/HintItemButton");case oG.STORM:return W("Canvas/UI/Footer/StormItemButton");case oG.THUNDER:return W("Canvas/UI/Footer/ThunderItemButton");case oG.PLIERS:return W("Canvas/UI/Footer/PliersItemButton")}}}]),s}(L)).prototype,"itemFxPrefab",[Dr],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Db=Ye(Dg.prototype,"hintSprite",[Do],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Dw=Ye(Dg.prototype,"stormSprite",[Ds],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),DS=Ye(Dg.prototype,"pliersSprite",[Du],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),DE=Ye(Dg.prototype,"thunderSprite",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Dk=Ye(Dg.prototype,"titleLabel",[Dh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),DC=Ye(Dg.prototype,"descriptionLabel",[Dd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),D_=Ye(Dg.prototype,"coinLabel",[Dp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),DA=Ye(Dg.prototype,"closeButtonComponent",[Df],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),DT=Ye(Dg.prototype,"buyItemButtonComponent",[Dy],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),DI=Ye(Dg.prototype,"getNowButtonComponent",[Dv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Dg));g._RF.pop(),g._RF.push({},"31829DUddVEq6NgIYHvnI68","LevelCompleteScreen",void 0);var Ld,Lp=E.ccclass,Lf=E.property,Ly=E.requireComponent,Lv=GameCore,Lg=Lv.Events,Lm=Lv.Utils.Valid,Lb=globalThis.game,Lw=Lb.event,LS=Lb.player,LE="Coin Container";DD=Lp("LevelCompleteScreen"),DL=Ly(PR),DO=Lf(m5),DM=Lf(k),Dx=Lf(I),DF=Lf(k),DB=Lf(k),DU=Lf(N),Dz=Lf(k),DG=Lf(M),DY=Lf(k),Dj=Lf({type:M,group:LE}),DH=Lf({type:J,group:LE}),DV=Lf({type:J,group:LE}),Dq=Lf(g0),DD(DW=DL((DX=Ye((DK=function(p){Ie(r,p);var v,g,E,k,C=xe(r);function r(){var p;Ce(this,r);for(var v=arguments.length,g=new Array(v),E=0;E<v;E++)g[E]=arguments[E];return(p=C.call.apply(C,[this].concat(g))).levelId=1,p.coins=40,p.currentCoin=0,je(p,"coinContainer",DX,Ne(p)),je(p,"playButton",DJ,Ne(p)),je(p,"coinText",DQ,Ne(p)),je(p,"levelText",DZ,Ne(p)),je(p,"nextLevelText",D$,Ne(p)),je(p,"playButtonComponent",D0,Ne(p)),je(p,"wellDoneText",D1,Ne(p)),je(p,"coinAnimation",D2,Ne(p)),je(p,"playButtonContainer",D4,Ne(p)),je(p,"coinContainerAnimation",D3,Ne(p)),je(p,"coinContainerEnterClip",D5,Ne(p)),je(p,"coinContainerExitClip",D6,Ne(p)),je(p,"paperConfetti",D9,Ne(p)),p.handleOpeningScreen=function(v){if(!p.screen)throw new Error("StarChestScreen: screen not found");p.validateEventPayload(v)&&(p.playButtonComponent.interactable=!0)},p.handleOpenedScreen=function(v){p.validateEventPayload(v)&&p.open()},p}return Ae(r,[{key:"__preload",value:function(){this.enabled=!1,this.screen=this.getComponent(PR),this.validateRequiredComponents(),this.listenScreenEvents()}},{key:"onLoad",value:function(){var p=this,v=this.screen.open;this.screen.open=function(g){p.overrideOpenHandler(v,g)}}},{key:"onDestroy",value:function(){this.unListenScreenEvents()}},{key:"validateRequiredComponents",value:function(){e7.lazyValidateProperties(this)}},{key:"listenScreenEvents",value:function(){Lw.on(Lg.OPENING_SCREEN,this.handleOpeningScreen),Lw.on(Lg.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"unListenScreenEvents",value:function(){Lw.off(Lg.OPENING_SCREEN,this.handleOpeningScreen),Lw.off(Lg.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"validateEventPayload",value:function(p){var v=null!=p?p:{},g=v.screenName,E=v.screenData;return g===this.node.name&&!!Lm.isObject(E)&&(Lm.isNumber(E.level)&&(this.levelId=E.level,this.coins=this.levelId<5?oY:oj),Lm.isNumber(E.currentCoin)&&(this.currentCoin=E.currentCoin),!0)}},{key:"open",value:function(){this.updateComponents(),this.node.scene.emit(aR.HIDE_UI)}},{key:"close",value:(k=Ee(function(){return _ts_generator(this,function(p){switch(p.label){case 0:return[4,tJ.runAnimationAsync(this.coinContainerAnimation,this.coinContainerExitClip.name)];case 1:p.sent(),Lw.emit(Lg.CLOSE_SCREEN,{screenName:this.node.name});return[4,po.showInterstitialAdAsync({forLevel:this.screen.data.level})];case 2:p.sent(),this.handleNextLevel();return[2]}})}),function(){return k.apply(this,arguments)})},{key:"overrideOpenHandler",value:(E=Ee(function(p,v){var g,E;return _ts_generator(this,function(k){switch(k.label){case 0:E=this;this.screen.setScreenOpacity(255),this.coinText.string="x0",this.playButtonComponent.interactable=!1,this.paperConfetti.runEffect();return[4,this.animateWellDoneText()];case 1:k.sent(),this.playButtonContainer.setScale(0,0,this.playButtonContainer.scale.z),p.call(this.screen,v),null===(g=this.screen.getComponent(M))||void 0===g||g.once(M.EventType.FINISHED,function(){E.animateCoin()});return[2]}})}),function(p,v){return E.apply(this,arguments)})},{key:"handleNextLevel",value:function(){var p=this.screen.data.level;if(p){var v=LS.getGameData();if(v)p>=v.totalLevel?this.node.scene.emit(aR.MAX_LEVEL):this.node.scene.emit(aR.NEXT_LEVEL);else console.warn("LevelCompleteScreen: gameData not found")}else console.warn("LevelCompleteScreen: level not found")}},{key:"updateComponents",value:function(){this.updateLevelText(),this.updateCoinContainer()}},{key:"updateCoinContainer",value:function(){this.coinContainer.updateCoins({coins:this.currentCoin})}},{key:"updateLevelText",value:function(){var p=LS.getGameData();if(p){this.levelText.getComponent(I).string="Level ".concat(this.levelId),console.log("LevelCompleteScreen: updateLevelText",this.levelId);var v=this.levelId+1>p.totalLevel?"Complete":"Level ".concat(this.levelId+1);this.nextLevelText.getComponent(I).string=v}else console.warn("LevelCompleteScreen: gameData not found")}},{key:"updateCoinString",value:function(){this.coinText.string="x".concat(this.coins),console.log("LevelCompleteScreen: updateCoinString",this.coins)}},{key:"animateCoin",value:(g=Ee(function(){var p;return _ts_generator(this,function(v){switch(v.label){case 0:p=this;if(!this.screen.container)return[3,4];this.coinAnimation.play();return[4,tJ.runOnUpdateAsync(this.node,.8,function(v){var g=eP(0,p.coins,v),E=Math.floor(g);p.coinText.string="x".concat(E)})];case 1:v.sent();return[4,this.animateCoinCollection()];case 2:v.sent();return[4,tJ.runTweenAsync(this.showPlayButton())];case 3:v.sent(),this.updateCoinString();return[3,5];case 4:console.warn("LevelCompleteScreen: screen not found");v.label=5;case 5:return[2]}})}),function(){return g.apply(this,arguments)})},{key:"animateCoinCollection",value:(v=Ee(function(){return _ts_generator(this,function(p){switch(p.label){case 0:return[4,tJ.runAnimationAsync(this.coinContainerAnimation,this.coinContainerEnterClip.name)];case 1:p.sent(),this.node.scene.emit(aR.ADD_COINS,{coins:this.coins,collectionAnimation:{animateTextOnly:!1,target:this.coinContainer}});return[2]}})}),function(){return v.apply(this,arguments)})},{key:"showPlayButton",value:function(){var p=this;return G(this.playButtonContainer).call(function(){p.playButtonContainer.setScale(0,0,p.playButtonContainer.scale.z)}).to(.5,{scale:new ef(1,1,1)},{easing:"backOut"}).call(function(){p.playButtonComponent.interactable=!0})}},{key:"handleClickedPlay",value:function(){this.playButtonComponent.interactable=!1,this.close()}},{key:"animateWellDoneText",value:function(){var p=this,v=this.wellDoneText.position.clone(),g=G(this.wellDoneText).call(function(){p.wellDoneText.setPosition(0,0,p.wellDoneText.position.z),p.wellDoneText.setScale(0,0,p.wellDoneText.scale.z)}).to(.5,{scale:new ef(1.5,1.5,1)},{easing:"cubicOut"}).to(.5,{scale:new ef(1,1,1)},{easing:"backOut"}).to(.5,{position:v},{easing:"backOut"});return tJ.runTweenAsync(g)}}]),r}(L)).prototype,"coinContainer",[DO],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),DJ=Ye(DK.prototype,"playButton",[DM],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),DQ=Ye(DK.prototype,"coinText",[Dx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),DZ=Ye(DK.prototype,"levelText",[DF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),D$=Ye(DK.prototype,"nextLevelText",[DB],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),D0=Ye(DK.prototype,"playButtonComponent",[DU],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),D1=Ye(DK.prototype,"wellDoneText",[Dz],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),D2=Ye(DK.prototype,"coinAnimation",[DG],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),D4=Ye(DK.prototype,"playButtonContainer",[DY],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),D3=Ye(DK.prototype,"coinContainerAnimation",[Dj],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),D5=Ye(DK.prototype,"coinContainerEnterClip",[DH],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),D6=Ye(DK.prototype,"coinContainerExitClip",[DV],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),D9=Ye(DK.prototype,"paperConfetti",[Dq],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),DW=DK))||DW);g._RF.pop(),g._RF.push({},"61985gSEDBMY6nVNc9Q1D6W","LoadingScreen",void 0);var Lk,LC,L_,LA,LT,LI,LR,LP,LN=E.ccclass,LD=E.disallowMultiple,LL=E.requireComponent,LO=GameCore.Events,LM=globalThis.game.event;LN("LoadingScreen")(Ld=LD(Ld=LL(PR)(Ld=function(p){Ie(n,p);var v=xe(n);function n(){var p;Ce(this,n);for(var g=arguments.length,E=new Array(g),k=0;k<g;k++)E[k]=arguments[k];return(p=v.call.apply(v,[this].concat(E))).handleOpeningScreen=function(v){p.validateEventPayload(v)&&(p.enabled=!0)},p.handleOpenedScreen=function(v){p.validateEventPayload(v)&&p.open()},p.handleClosingScreen=function(v){p.validateEventPayload(v)&&p.unscheduleAllCallbacks()},p.handleClosedScreen=function(v){p.validateEventPayload(v)&&(p.enabled=!1)},p.handleOnCloseScreen=function(){s8.closeScreen(nq[p.node.name])},p}return Ae(n,[{key:"onLoad",value:function(){this.enabled=!1,this.screen=this.getComponent(PR),this.validateRequiredComponents(),this.listenScreenEvents()}},{key:"onDestroy",value:function(){this.unListenScreenEvents()}},{key:"validateRequiredComponents",value:function(){e7.lazyValidateProperties(this)}},{key:"listenScreenEvents",value:function(){LM.on(LO.OPENING_SCREEN,this.handleOpeningScreen),LM.on(LO.OPENED_SCREEN,this.handleOpenedScreen),LM.on(LO.CLOSING_SCREEN,this.handleClosingScreen),LM.on(LO.CLOSED_SCREEN,this.handleClosedScreen)}},{key:"unListenScreenEvents",value:function(){LM.off(LO.OPENING_SCREEN,this.handleOpeningScreen),LM.off(LO.OPENED_SCREEN,this.handleOpenedScreen),LM.off(LO.CLOSING_SCREEN,this.handleClosingScreen),LM.off(LO.CLOSED_SCREEN,this.handleClosedScreen)}},{key:"validateEventPayload",value:function(p){return p.screenName===this.node.name}},{key:"open",value:function(){if(this.enabled){var p=this.screen.data.duration;p&&p>0&&this.scheduleOnce(this.handleOnCloseScreen,p)}}}]),n}(L))||Ld)||Ld);g._RF.pop(),g._RF.push({},"6460akNFfhP9pDOT2Z0+s2R","NotificationScreen",void 0);var Lx,LF,LB,LU,Lz,LG,LY,Lj,LH=E.ccclass,LV=E.disallowMultiple,Lq=E.requireComponent,LW=E.property,LK=GameCore,LX=LK.Events,LJ=LK.Utils.Valid,LQ=globalThis.game.event;Lk=LH("NotificationScreen"),LC=Lq(PR),L_=LW(I),LA=LW(N),Lk(LT=LV(LT=LC((LR=Ye((LI=function(p){Ie(n,p);var v=xe(n);function n(){var p;Ce(this,n);for(var g=arguments.length,E=new Array(g),k=0;k<g;k++)E[k]=arguments[k];return je(p=v.call.apply(v,[this].concat(E)),"message",LR,Ne(p)),je(p,"touchZone",LP,Ne(p)),p.enableCloseOnTouch=!0,p.handleOpeningScreen=function(v){p.validateEventPayload(v)&&p.updateScreenData(v)},p.handleClosingScreen=function(v){p.validateEventPayload(v)&&p.unscheduleAllCallbacks()},p}return Ae(n,[{key:"__preload",value:function(){this.listenScreenEvents()}},{key:"onDestroy",value:function(){this.unListenScreenEvents()}},{key:"onLoad",value:function(){this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){e7.lazyValidateProperties(this)}},{key:"listenScreenEvents",value:function(){LQ.on(LX.OPENING_SCREEN,this.handleOpeningScreen),LQ.on(LX.CLOSING_SCREEN,this.handleClosingScreen)}},{key:"unListenScreenEvents",value:function(){LQ.off(LX.OPENING_SCREEN,this.handleOpeningScreen),LQ.off(LX.CLOSING_SCREEN,this.handleClosingScreen)}},{key:"validateEventPayload",value:function(p){return p.screenName===this.node.name}},{key:"updateScreenData",value:function(p){var v=this,g=p.screenData;LJ.isObject(g)?(g.message&&(this.message.string=g.message),g.duration&&g.duration>0&&this.scheduleOnce(function(){s8.closeScreen(nq[v.node.name])},g.duration),!1===g.enableCloseOnTouch?this.enableCloseOnTouch=!1:this.enableCloseOnTouch=!0):console.warn("NotificationScreen: screenData not found")}},{key:"handleClickedClose",value:function(){this.unscheduleAllCallbacks(),s8.closeScreen(nq[this.node.name])}},{key:"closeOnTouch",value:function(){this.enableCloseOnTouch&&this.handleClickedClose()}}]),n}(L)).prototype,"message",[L_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),LP=Ye(LI.prototype,"touchZone",[LA],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),LT=LI))||LT)||LT);g._RF.pop(),g._RF.push({},"7129ca71jRMGaTHxWhEL4F4","QuitLevelScreen",void 0);var LZ,L$,L0,L1,L2,L4,L3,L5,L6,L9,L8,L7,Ot,On,Oi,Oa,Or,Oo,Os,Ou,Oc,Oh,Od=E.ccclass,Op=E.property,Of=E.requireComponent,Oy=GameCore.Events,Ov=globalThis.game.event;Lx=Od("QuitLevelScreen"),LF=Of(PR),LB=Op(N),LU=Op(N),Lx(Lz=LF((LY=Ye((LG=function(p){Ie(n,p);var v=xe(n);function n(){var p;Ce(this,n);for(var g=arguments.length,E=new Array(g),k=0;k<g;k++)E[k]=arguments[k];return je(p=v.call.apply(v,[this].concat(E)),"noButton",LY,Ne(p)),je(p,"yesButton",Lj,Ne(p)),p.handleOpeningScreen=function(v){p.validateEventPayload(v)&&(p.noButton.interactable=!0,p.yesButton.interactable=!0)},p.handleOpenedScreen=function(v){p.validateEventPayload(v)&&p.open()},p}return Ae(n,[{key:"__preload",value:function(){this.enabled=!1,this.screen=this.getComponent(PR),this.validateRequiredComponents(),this.listenScreenEvents()}},{key:"onDestroy",value:function(){this.unListenScreenEvents()}},{key:"validateRequiredComponents",value:function(){e7.lazyValidateProperties(this)}},{key:"listenScreenEvents",value:function(){Ov.on(Oy.OPENING_SCREEN,this.handleOpeningScreen),Ov.on(Oy.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"unListenScreenEvents",value:function(){Ov.off(Oy.OPENING_SCREEN,this.handleOpeningScreen),Ov.off(Oy.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"validateEventPayload",value:function(p){return(null!=p?p:{}).screenName===this.node.name}},{key:"open",value:function(){this.runPopUpAnimation(),this.node.scene.emit(aR.HIDE_UI)}},{key:"close",value:function(){this.noButton.interactable=!1,this.yesButton.interactable=!1,s8.closeScreen(nq[this.node.name]),this.node.scene.emit(aR.SHOW_UI),this.node.scene.emit(aR.GAME_RESUME)}},{key:"runPopUpAnimation",value:function(){this.screen.container||console.warn("StartLevelScreen: screen not found")}},{key:"handleClickedNo",value:function(){this.close()}},{key:"handleClickedYes",value:function(){this.node.scene.emit(aR.GAME_EXIT)}}]),n}(L)).prototype,"noButton",[LB],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Lj=Ye(LG.prototype,"yesButton",[LU],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Lz=LG))||Lz);g._RF.pop(),g._RF.push({},"85907Tnp/NBq7myeciP/4h3","RescuesScreen",void 0);var Og,Om,Ob,Ow,OS,OE,Ok,OC,O_,OA,OT,OI,OR,OP,ON,OD,OL,OO,OM,Ox,OF,OB,OU,Oz,OG,OY,Oj=E.ccclass,OH=E.property,OV=E.disallowMultiple,Oq=E.requireComponent,OW=GameCore.Events,OK=globalThis.game,OX=OK.event,OJ=OK.player;LZ=Oj("RescuesScreen"),L$=Oq(PR),L0=OH(et),L1=OH([k]),L2=OH(I),L4=OH(I),L3=OH(k),L5=OH(k),L6=OH(M),L9=OH(k),L8=OH(k),LZ(L7=OV(L7=L$((On=Ye((Ot=function(p){Ie(s,p);var v,g,E,k,C,_=xe(s);function s(){var p;Ce(this,s);for(var v=arguments.length,g=new Array(v),E=0;E<v;E++)g[E]=arguments[E];return je(p=_.call.apply(_,[this].concat(g)),"adOpacity",On,Ne(p)),je(p,"animNodes",Oi,Ne(p)),je(p,"titleLabel",Oa,Ne(p)),je(p,"descriptionLabel",Or,Ne(p)),je(p,"timer",Oo,Ne(p)),je(p,"bomb",Os,Ne(p)),je(p,"bombAnim",Ou,Ne(p)),je(p,"replayButton",Oc,Ne(p)),je(p,"buyTimeButton",Oh,Ne(p)),p.handleOpeningScreen=function(v){if(!p.screen)throw new Error("RescuesScreen: screen not found");p.validateEventPayload(v)},p.handleOpenedScreen=function(v){p.validateEventPayload(v)&&p.open()},p}return Ae(s,[{key:"__preload",value:function(){this.enabled=!1,this.screen=this.getComponent(PR),this.validateRequiredComponents(),this.listenScreenEvents()}},{key:"onDestroy",value:function(){this.unListenScreenEvents()}},{key:"validateRequiredComponents",value:function(){e7.lazyValidateProperties(this)}},{key:"listenScreenEvents",value:function(){OX.on(OW.OPENING_SCREEN,this.handleOpeningScreen),OX.on(OW.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"unListenScreenEvents",value:function(){OX.off(OW.OPENING_SCREEN,this.handleOpeningScreen),OX.off(OW.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"validateEventPayload",value:function(p){return p.screenName===this.node.name&&(this.payload=p,!0)}},{key:"open",value:(C=Ee(function(){return _ts_generator(this,function(p){switch(p.label){case 0:return[4,this.resetState()];case 1:p.sent(),this.runOpenAnimation(),this.node.scene.emit(aR.HIDE_UI);return[2]}})}),function(){return C.apply(this,arguments)})},{key:"close",value:function(){OX.emit(OW.CLOSE_SCREEN,{screenName:this.node.name})}},{key:"resetState",value:(k=Ee(function(){var p,v,g,E;return _ts_generator(this,function(k){v=(null===(p=this.payload.screenData)||void 0===p?void 0:p.failKey)===ld;this.titleLabel.string=v?"Boom!":"Time's Up!",this.descriptionLabel.string=v?"The bomb exploded!":"Restart or add 2 minutes?",this.timer.active=!v,this.bomb.active=v,v&&this.bombAnim.play();g=OJ.getGameData();if(g){E=g.coins>=oq;this.replayButton.active=!E,this.buyTimeButton.active=E,this.adOpacity.opacity=0}return[2]})}),function(){return k.apply(this,arguments)})},{key:"runOpenAnimation",value:(E=Ee(function(){var p;return _ts_generator(this,function(v){switch(v.label){case 0:p=this;if(!this.screen.container)return[3,3];return[4,Promise.all(this.animNodes.map(function(v,g){p.runAppearTween(v,.1*g)}))];case 1:v.sent();return[4,this.runShowAdContainer()];case 2:v.sent();return[3,4];case 3:console.warn("TimeUpScreen: screen not found");v.label=4;case 4:return[2]}})}),function(){return E.apply(this,arguments)})},{key:"runAppearTween",value:(g=Ee(function(p,v){return _ts_generator(this,function(g){switch(g.label){case 0:return[4,tJ.runTweenAsync(G(p).set({scale:new ef(0,0,0)}).delay(v).to(1,{scale:new ef(1,1,1)},{progress:function(p,v,g,E){return p+(v-p)*tJ.elasticOut(E,.1,.45)}}))];case 1:g.sent();return[2]}})}),function(p,v){return g.apply(this,arguments)})},{key:"runShowAdContainer",value:function(){var p=G(this.adOpacity);return p.delay(1),p.to(.5,{opacity:255}),tJ.runTweenAsync(p)}},{key:"handleClickReplayButton",value:function(){this.close(),this.node.scene.emit(aR.GAME_REPLAY,{level:this.screen.data.level})}},{key:"handleClickBuyTimeButton",value:function(){this.node.scene.emit(aR.REMOVE_COINS,{coins:oq,collectionAnimation:{animateTextOnly:!0}}),this.startRescue()}},{key:"handleClickAdButton",value:(v=Ee(function(){return _ts_generator(this,function(p){switch(p.label){case 0:return[4,po.showRewardVideoAdAsync({})];case 1:p.sent()&&this.startRescue();return[2]}})}),function(){return v.apply(this,arguments)})},{key:"startRescue",value:function(){this.node.scene.emit(aR.SHOW_UI),this.node.scene.emit(aR.RESCUE_START),this.close()}}]),s}(L)).prototype,"adOpacity",[L0],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Oi=Ye(Ot.prototype,"animNodes",[L1],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Oa=Ye(Ot.prototype,"titleLabel",[L2],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Or=Ye(Ot.prototype,"descriptionLabel",[L4],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Oo=Ye(Ot.prototype,"timer",[L3],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Os=Ye(Ot.prototype,"bomb",[L5],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ou=Ye(Ot.prototype,"bombAnim",[L6],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Oc=Ye(Ot.prototype,"replayButton",[L9],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Oh=Ye(Ot.prototype,"buyTimeButton",[L8],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),L7=Ot))||L7)||L7);g._RF.pop(),g._RF.push({},"61932YLC/5CFrE0eD0ez8Zg","SettingsScreen",void 0);var OQ,OZ,O$,O0,O1,O2,O4,O3,O5,O6,O9,O8,O7,Mt,Mn,Mi,Ma,Mr,Mo,Ms,Ml,Mu,Md,Mp=E.ccclass,Mf=E.property,My=E.requireComponent,Mv=GameCore,Mg=Mv.Events,Mm=Mv.Utils.Device,Mb=globalThis.game,Mw=Mb.player,MS=Mb.event;Og=Mp("SettingsScreen"),Om=My(PR),Ob=Mf(k),Ow=Mf(k),OS=Mf(k),OE=Mf(CH),Ok=Mf(CH),OC=Mf(CH),O_=Mf(N),OA=Mf(N),OT=Mf(N),OI=Mf(N),OR=Mf(k),Og(OP=Om((OD=Ye((ON=function(p){Ie(i,p);var v,g=xe(i);function i(){var p;Ce(this,i);for(var v=arguments.length,E=new Array(v),k=0;k<v;k++)E[k]=arguments[k];return je(p=g.call.apply(g,[this].concat(E)),"musicSetting",OD,Ne(p)),je(p,"soundSetting",OL,Ne(p)),je(p,"vibrateSetting",OO,Ne(p)),je(p,"musicSwitch",OM,Ne(p)),je(p,"soundSwitch",Ox,Ne(p)),je(p,"vibrateSwitch",OF,Ne(p)),je(p,"closeButtonComponent",OB,Ne(p)),je(p,"continueButtonComponent",OU,Ne(p)),je(p,"restartButtonComponent",Oz,Ne(p)),je(p,"inviteFriendsButtonComponent",OG,Ne(p)),je(p,"animNodes",OY,Ne(p)),p.triggerSequence="",p.handleOpeningScreen=function(v){p.validateSwitchScreenPayload(v)&&(p.closeButtonComponent.interactable=!0,p.continueButtonComponent.interactable=!0,p.restartButtonComponent.interactable=!0,p.inviteFriendsButtonComponent.interactable=!0,p.updateStatus())},p.handleOpenedScreen=function(v){p.validateSwitchScreenPayload(v)&&p.open()},p.handleResetSequence=function(){p.triggerSequence=""},p.handleTriggerUnlockKey=function(v){if("code"in v){var g=v.code,E=oQ.UNLOCK_SEQUENCE;"number"==typeof g&&-1!==E.indexOf(g.toString())&&(p.triggerSequence+=g.toString(),console.log("SettingsScreen: handleTriggerUnlockKey",g,p.triggerSequence,p.triggerSequence===E),p.triggerSequence===E&&(p.node.scene.emit(oQ.Events.UNLOCK_DEV_TOOLS),p.node.off(oQ.Events.TRIGGER_UNLOCK_KEY)))}},p.updateVibrateButton=function(){var v=p.vibrateSetting.getComponentInChildren(N),g=p.vibrateSetting.getComponentInChildren(CH),E=p.vibrateSetting.getComponentInChildren(iz);if(v&&g&&E){if(Mm.isMobile()){var k,C=null!==(k=Mw.getPlayerSetting("vibrate"))&&void 0!==k&&k;g.setEnabled(C)}else v.interactable=!1,g.setEnabled(!1),E.changeState(!1)}else console.warn("SettingsScreen: vibrate button missing components")},p}return Ae(i,[{key:"onLoad",value:function(){this.enabled=!1,this.screen=this.getComponent(PR),this.validateRequiredComponents(),this.listenScreenEvents(),this.listenUnlockDevTools()}},{key:"onDestroy",value:function(){this.unListenScreenEvents(),this.unListenUnlockDevTools()}},{key:"validateRequiredComponents",value:function(){e7.lazyValidateProperties(this)}},{key:"listenScreenEvents",value:function(){MS.on(Mg.OPENING_SCREEN,this.handleOpeningScreen),MS.on(Mg.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"unListenScreenEvents",value:function(){MS.off(Mg.OPENING_SCREEN,this.handleOpeningScreen),MS.off(Mg.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"validateSwitchScreenPayload",value:function(p){return p.screenName===this.node.name}},{key:"listenUnlockDevTools",value:function(){this.node.off(oQ.Events.TRIGGER_UNLOCK_KEY),this.node.on(oQ.Events.TRIGGER_RESET_SEQUENCE,this.handleResetSequence),this.node.on(oQ.Events.TRIGGER_UNLOCK_KEY,this.handleTriggerUnlockKey)}},{key:"unListenUnlockDevTools",value:function(){this.node.off(oQ.Events.TRIGGER_RESET_SEQUENCE,this.handleResetSequence),this.node.off(oQ.Events.TRIGGER_UNLOCK_KEY,this.handleTriggerUnlockKey)}},{key:"open",value:function(){this.updateStatus(),this.runPopUpAnimation(),this.node.emit(oQ.Events.TRIGGER_RESET_SEQUENCE),this.node.scene.emit(aR.HIDE_UI)}},{key:"close",value:function(){this.closeButtonComponent.interactable=!1,this.continueButtonComponent.interactable=!1,this.restartButtonComponent.interactable=!1,this.inviteFriendsButtonComponent.interactable=!1,this.node.emit(oQ.Events.TRIGGER_RESET_SEQUENCE),s8.closeScreen(nq[this.node.name])}},{key:"updateStatus",value:function(){var p,v,g,E={music:null!==(p=Mw.getPlayerSetting("music"))&&void 0!==p&&p,sound:null!==(v=Mw.getPlayerSetting("sound"))&&void 0!==v&&v,vibrate:null!==(g=Mw.getPlayerSetting("vibrate"))&&void 0!==g&&g};this.musicSwitch?this.soundSwitch?(this.musicSwitch.setEnabled(E.music),this.soundSwitch.setEnabled(E.sound),"GameDistributions"!==GameSDK.getSDKName()&&this.scheduleOnce(this.updateVibrateButton,.1)):console.warn("SettingsScreen: soundSwitch not found"):console.warn("SettingsScreen: musicSwitch not found")}},{key:"runPopUpAnimation",value:function(){var p=this;this.screen.container||console.warn("SettingsScreen: screen not found"),this.animNodes.forEach(function(v,g){p.runAppearTween(v,.1*g)})}},{key:"runAppearTween",value:function(p,v){var g=G(p);g.set({scale:new ef(0,0,0)}),g.delay(v),g.to(1,{scale:new ef(1,1,1)},{progress:function(p,v,g,E){return p+(v-p)*tJ.elasticOut(E,.1,.45)}}),g.start()}},{key:"switchMusicButton",value:function(){if(this.musicSwitch){var p=this.musicSwitch.switch();Mw.setSetting("music",p),this.node.emit(oQ.Events.TRIGGER_UNLOCK_KEY,{code:p?1:0}),p?nQ.playMusic():nQ.pauseMusic()}else console.warn("SettingsScreen: musicSwitch not found")}},{key:"switchSoundButton",value:function(){if(this.soundSwitch){var p=this.soundSwitch.switch();Mw.setSetting("sound",p),this.node.emit(oQ.Events.TRIGGER_UNLOCK_KEY,{code:p?3:2})}else console.warn("SettingsScreen: soundSwitch not found")}},{key:"switchVibrateButton",value:function(){if(this.vibrateSwitch){var p=this.vibrateSwitch.switch();Mw.setSetting("vibrate",p)}else console.warn("SettingsScreen: vibrateSwitch not found")}},{key:"handleClickedResume",value:function(){this.resumeGame()}},{key:"handleClickedClose",value:function(){this.resumeGame()}},{key:"handleClickedReplayGame",value:function(){this.restartGame()}},{key:"handleClickedInviteFriends",value:(v=Ee(function(){return _ts_generator(this,function(p){switch(p.label){case 0:if("MsGames"!==GameSDK.getSDKName())return[3,2];s8.showLoadingScreen();return[4,GameSDK.extra.shareAsync()];case 1:return[2,(p.sent(),void s8.closeLoadingScreen())];case 2:this.close(),this.node.scene.emit(aR.INVITE_FRIENDS);return[2]}})}),function(){return v.apply(this,arguments)})},{key:"resumeGame",value:function(){this.close(),this.node.scene.emit(aR.GAME_RESUME),this.node.scene.emit(aR.SHOW_UI)}},{key:"restartGame",value:function(){var p;this.close(),this.node.scene.emit(aR.GAME_RESUME);var v=(null!==(p=Mw.getGameData())&&void 0!==p?p:{}).level,g=void 0===v?1:v;this.node.scene.emit(aR.GAME_REPLAY,{level:g})}}]),i}(L)).prototype,"musicSetting",[Ob],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),OL=Ye(ON.prototype,"soundSetting",[Ow],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),OO=Ye(ON.prototype,"vibrateSetting",[OS],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),OM=Ye(ON.prototype,"musicSwitch",[OE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ox=Ye(ON.prototype,"soundSwitch",[Ok],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),OF=Ye(ON.prototype,"vibrateSwitch",[OC],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),OB=Ye(ON.prototype,"closeButtonComponent",[O_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),OU=Ye(ON.prototype,"continueButtonComponent",[OA],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Oz=Ye(ON.prototype,"restartButtonComponent",[OT],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),OG=Ye(ON.prototype,"inviteFriendsButtonComponent",[OI],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),OY=Ye(ON.prototype,"animNodes",[OR],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),OP=ON))||OP);g._RF.pop(),g._RF.push({},"891d37NJ6lLdp3CNLPHxZ6d","StarChest",void 0);var ME,Mk,MC,M_,MA,MT,MI,MR,MP,MN,MD,ML,MO,MM,Mx,MF,MB,MU,Mz,MG,MY=E.ccclass,Mj=E.property,MH=(OQ=MY("StarChest"),OZ=Mj(V),O$=Mj(et),O0=Mj(e_),O1=Mj(et),O2=Mj(et),O4=Mj({type:Y,readonly:!0,displayName:"Starting Offset X",group:"Reward Animations"}),O3=Mj({type:Y,readonly:!0,displayName:"Starting Offset Y",group:"Reward Animations"}),O5=Mj({type:Y,displayName:"Centered Offset X",group:"Reward Animations"}),O6=Mj({type:Y,displayName:"Centered Offset Y",group:"Reward Animations"}),O9=Mj({type:Y,min:0,displayName:"Starting Scale",group:"Reward Animations"}),O8=Mj({type:Y,min:0,displayName:"Ending Scale",group:"Reward Animations"}),OQ((Mn=Ye((Mt=function(p){Ie(s,p);var v,g,E,k,C,_=xe(s);function s(){var p;Ce(this,s);for(var v=arguments.length,g=new Array(v),E=0;E<v;E++)g[E]=arguments[E];return je(p=_.call.apply(_,[this].concat(g)),"sprite",Mn,Ne(p)),je(p,"glowOpacity",Mi,Ne(p)),je(p,"explosionParticles",Ma,Ne(p)),je(p,"circle",Mr,Ne(p)),je(p,"uiOpacity",Mo,Ne(p)),p.ogCenterX=0,p.ogCenterY=0,je(p,"endingOffsetX",Ms,Ne(p)),je(p,"endingOffsetY",Ml,Ne(p)),je(p,"startingScale",Mu,Ne(p)),je(p,"endingScale",Md,Ne(p)),p}return Ae(s,[{key:"startingOffsetX",get:function(){return this.node.position.x}},{key:"startingOffsetY",get:function(){return this.node.position.y}},{key:"__preload",value:function(){this.validateRequiredComponents(),this.ogCenterX=this.startingOffsetX,this.ogCenterY=this.startingOffsetY}},{key:"validateRequiredComponents",value:function(){e7.lazyValidateProperties(this)}},{key:"moveToCenter",value:(C=Ee(function(p){var v;return _ts_generator(this,function(g){switch(g.label){case 0:v=new ef(this.endingOffsetX,this.endingOffsetY,this.node.position.z);return[4,tJ.runTweenAsync(G(this.node).to(.7,{position:v},{easing:"quintInOut"}),p)];case 1:g.sent(),this.node.position=v;return[2]}})}),function(p){return C.apply(this,arguments)})},{key:"respawnAtStartingState",value:function(){this.node.position=new ef(this.ogCenterX,this.ogCenterY,this.node.position.z),this.glowOpacity.opacity=0,this.sprite.node.setScale(this.startingScale,this.startingScale,this.startingScale),this.glowOpacity.node.setScale(this.startingScale,this.startingScale,this.startingScale),this.uiOpacity.opacity=255}},{key:"scale",value:(k=Ee(function(p,v){var g,E;return _ts_generator(this,function(k){switch(k.label){case 0:g=this.startingScale+(this.endingScale-this.startingScale)*p,E=new ef(g,g,g);return[4,Promise.all([tJ.runTweenAsync(G(this.sprite.node).to(.2,{scale:E},{easing:"backOut"}),v),tJ.runTweenAsync(G(this.glowOpacity.node).to(.2,{scale:E},{easing:"backOut"}),v)])];case 1:k.sent(),this.sprite.node.setScale(E),this.glowOpacity.node.setScale(E);return[2]}})}),function(p,v){return k.apply(this,arguments)})},{key:"startShaking",value:function(){var p=this,v=this.node.position.clone();this.shakingTween={ogPos:v,tw:G(this.node).to(.1,{},{onUpdate:function(g,E){if(E){var k=v.x+10*(E-.5);p.node.position=new ef(k,v.y,v.z)}}}).repeatForever().start()}}},{key:"stopShaking",value:function(){this.shakingTween&&(this.shakingTween.tw.stop(),this.node.position=this.shakingTween.ogPos,this.shakingTween=void 0)}},{key:"glow",value:(E=Ee(function(p){var v;return _ts_generator(this,function(g){switch(g.label){case 0:v=this.sprite.node.scale.clone().multiplyScalar(1.1);return[4,Promise.all([tJ.runTweenAsync(G(this.sprite.node).to(.2,{scale:v},{easing:"cubicInOut"}),p),tJ.runTweenAsync(G(this.glowOpacity.node).to(.2,{scale:v}),p),tJ.runTweenAsync(G(this.glowOpacity).to(.5,{opacity:255}),p)])];case 1:g.sent();return[2]}})}),function(p){return E.apply(this,arguments)})},{key:"explode",value:(g=Ee(function(p){var v,g,E,k;return _ts_generator(this,function(C){switch(C.label){case 0:v=this,g=new ef(8,8,8),E=function(){var E=Ee(function(){return _ts_generator(this,function(E){switch(E.label){case 0:v.circle.opacity=255,v.circle.node.setScale(ef.ZERO);return[4,Promise.all([tJ.runTweenAsync(G(v.circle).to(.3,{opacity:0}),p),tJ.runTweenAsync(G(v.circle.node).to(.3,{scale:g},{easing:"cubicOut"}),p)])];case 1:E.sent(),v.circle.opacity=0,v.circle.node.scale=g;return[2]}})});return function(){return E.apply(this,arguments)}}(),k=function(){var g=Ee(function(){return _ts_generator(this,function(g){switch(g.label){case 0:return[4,Promise.all([tJ.runTweenAsync(G(v.glowOpacity.node).to(.3,{scale:ef.ZERO},{easing:"cubicOut"}),p),tJ.runTweenAsync(G(v.sprite.node).to(.3,{scale:ef.ZERO},{easing:"cubicOut"}),p)])];case 1:g.sent(),v.sprite.node.setScale(ef.ZERO),v.glowOpacity.node.setScale(ef.ZERO);return[2]}})});return function(){return g.apply(this,arguments)}}();return[4,Promise.all([this.explodeParticles(p),E(),k()])];case 1:C.sent();return[2]}})}),function(p){return g.apply(this,arguments)})},{key:"explodeParticles",value:(v=Ee(function(p){var v;return _ts_generator(this,function(g){switch(g.label){case 0:v=p.aborted;if(v)return[3,2];this.explosionParticles.node.active=!0,this.explosionParticles.resetSystem();return[4,tJ.waitTweenAsync(1)];case 1:v=(g.sent(),this.explosionParticles.node.active=!1);g.label=2;case 2:return[2]}})}),function(p){return v.apply(this,arguments)})}]),s}(L)).prototype,"sprite",[OZ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Mi=Ye(Mt.prototype,"glowOpacity",[O$],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ma=Ye(Mt.prototype,"explosionParticles",[O0],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Mr=Ye(Mt.prototype,"circle",[O1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Mo=Ye(Mt.prototype,"uiOpacity",[O2],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ye(Mt.prototype,"startingOffsetX",[O4],Object.getOwnPropertyDescriptor(Mt.prototype,"startingOffsetX"),Mt.prototype),Ye(Mt.prototype,"startingOffsetY",[O3],Object.getOwnPropertyDescriptor(Mt.prototype,"startingOffsetY"),Mt.prototype),Ms=Ye(Mt.prototype,"endingOffsetX",[O5],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Ml=Ye(Mt.prototype,"endingOffsetY",[O6],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Mu=Ye(Mt.prototype,"startingScale",[O9],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return .5}}),Md=Ye(Mt.prototype,"endingScale",[O8],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),O7=Mt))||O7);g._RF.pop(),g._RF.push({},"e414bczbutHJKcOfhl1sc4p","StarChestScreen",void 0);var MV,Mq,MW,MK,MX,MJ,MQ,MZ,M$,M0,M1,M2,M4,M3,M5=E.ccclass,M6=E.property,M9=E.requireComponent,M8=GameCore.Events,M7=globalThis.game,xt=M7.event,xn=M7.player;ME=M5("StarChestScreen"),Mk=M9(PR),MC=M6(SM),M_=M6(I),MA=M6(N),MT=M6(M),MI=M6(MH),MR=M6(et),MP=M6(mU),MN=M6(I),ME(MD=Mk((MO=Ye((ML=function(p){Ie(r,p);var v,g,E,k,C=xe(r);function r(){var p;Ce(this,r);for(var v=arguments.length,g=new Array(v),E=0;E<v;E++)g[E]=arguments[E];return je(p=C.call.apply(C,[this].concat(g)),"starProgressBar",MO,Ne(p)),je(p,"buttonLabel",MM,Ne(p)),je(p,"button",Mx,Ne(p)),je(p,"chestAnimation",MF,Ne(p)),je(p,"starChest",MB,Ne(p)),je(p,"chestUnlockFXMask",MU,Ne(p)),je(p,"skipOverlay",Mz,Ne(p)),je(p,"messageLabel",MG,Ne(p)),p.handleOpeningScreen=function(v){if(!p.screen)throw new Error("StarChestScreen: screen not found");p.validateEventPayload(v)},p.handleOpenedScreen=function(v){p.validateEventPayload(v)&&p.open()},p}return Ae(r,[{key:"__preload",value:function(){this.enabled=!1,this.screen=this.getComponent(PR),this.validateRequiredComponents(),this.listenScreenEvents()}},{key:"onDestroy",value:function(){this.unListenScreenEvents()}},{key:"validateRequiredComponents",value:function(){e7.lazyValidateProperties(this)}},{key:"listenScreenEvents",value:function(){xt.on(M8.OPENING_SCREEN,this.handleOpeningScreen),xt.on(M8.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"unListenScreenEvents",value:function(){xt.off(M8.OPENING_SCREEN,this.handleOpeningScreen),xt.off(M8.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"validateEventPayload",value:function(p){return(null!=p?p:{}).screenName===this.node.name}},{key:"open",value:function(){this.runPopUpAnimation(),this.node.scene.emit(aR.HIDE_UI);var p=xn.getGameData();if(p){var v=p.stars;this.numChestAvailable=Math.floor(v/20),this.starProgressBar.setRange(v,20),this.buttonLabel.string=this.numChestAvailable?"Open":"Continue",this.messageLabel.string=this.numChestAvailable?"Congrats, you have enough stars to open the chest!":"Win more stars to open!",this.button.interactable=!0,this.numChestAvailable?this.chestAnimation.play():this.chestAnimation.stop(),this.chestUnlockFXMask.node.active=!1,this.chestUnlockFXMask.opacity=0,this.starChest.respawnAtStartingState()}}},{key:"close",value:function(){xt.emit(M8.CLOSE_SCREEN,{screenName:this.node.name}),this.node.scene.emit(aR.SHOW_UI)}},{key:"runPopUpAnimation",value:function(){this.screen.container||console.warn("StarChestScreen: screen not found")}},{key:"handleClickButton",value:(k=Ee(function(){var p,v,g;return _ts_generator(this,function(E){switch(E.label){case 0:if(!(0!==this.numChestAvailable))return[3,5];nQ.turnDownMusic();p=xn.getGameData();if(!p)return[3,4];this.button.interactable=!1;v=p.stars;xn.setGameData({stars:p.stars-20*this.numChestAvailable});g=new na;return[4,this.skipOverlay.open({opacity:200,onSkip:function(){return g.abort()}})];case 1:E.sent();return[4,this.handleUnlockAnimation(v,p.stars,g)];case 2:E.sent();return[4,this.skipOverlay.close()];case 3:E.sent(),nQ.turnUpMusic(),ec.emit(t9),this.close();E.label=4;case 4:return[3,6];case 5:this.close();E.label=6;case 6:return[2]}})}),function(){return k.apply(this,arguments)})},{key:"handleUnlockAnimation",value:(E=Ee(function(p,v,g){var E,k,C,_;return _ts_generator(this,function(A){switch(A.label){case 0:E=this;return[4,Promise.all([this.starChest.moveToCenter(g),this.fadeInChestUnlockFX(g)])];case 1:A.sent(),this.chestAnimation.stop(),this.starChest.startShaking(),nQ.playSound(nB.STAR_CHEST_DRUM_ROLL,{loop:!0});return[4,tJ.waitTweenAsync(0)];case 2:A.sent();k=p,C=this.numChestAvailable;return[4,Promise.all([this.starProgressBar.animateTo(v,g,function(p){var v;k-p>=20&&(k=p,C--,E.starChest.scale((v=C,E.numChestAvailable>2?1-v/E.numChestAvailable:.35*(1-v/E.numChestAvailable)),g),nQ.playSound(nB.STAR_CHEST_OPEN))})])];case 3:A.sent();return[4,tJ.waitTweenAsync(1,g)];case 4:A.sent(),this.starChest.stopShaking();return[4,this.starChest.glow(g)];case 5:A.sent(),nQ.stopSound(nB.STAR_CHEST_DRUM_ROLL);_=oH*this.numChestAvailable;this.node.scene.emit(aR.ADD_COINS,{coins:_,collectionAnimation:{animateTextOnly:!1,floatDuration:3,signal:g}});return[4,this.starChest.explode(g)];case 6:A.sent();return[4,tJ.waitTweenAsync(1,g)];case 7:A.sent();return[4,Promise.all([this.fadeOutChestUnlockFX(g)])];case 8:A.sent();return[2]}})}),function(p,v,g){return E.apply(this,arguments)})},{key:"fadeInChestUnlockFX",value:(g=Ee(function(p){return _ts_generator(this,function(v){switch(v.label){case 0:this.chestUnlockFXMask.node.active=!0;return[4,tJ.runTweenAsync(G(this.chestUnlockFXMask).to(.5,{opacity:150}),p)];case 1:v.sent();return[2]}})}),function(p){return g.apply(this,arguments)})},{key:"fadeOutChestUnlockFX",value:(v=Ee(function(p){return _ts_generator(this,function(v){switch(v.label){case 0:return[4,tJ.runTweenAsync(G(this.chestUnlockFXMask).to(.3,{opacity:0}),p)];case 1:v.sent(),this.chestUnlockFXMask.opacity=0,this.chestUnlockFXMask.node.active=!1;return[2]}})}),function(p){return v.apply(this,arguments)})}]),r}(L)).prototype,"starProgressBar",[MC],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),MM=Ye(ML.prototype,"buttonLabel",[M_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Mx=Ye(ML.prototype,"button",[MA],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),MF=Ye(ML.prototype,"chestAnimation",[MT],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),MB=Ye(ML.prototype,"starChest",[MI],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),MU=Ye(ML.prototype,"chestUnlockFXMask",[MR],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Mz=Ye(ML.prototype,"skipOverlay",[MP],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),MG=Ye(ML.prototype,"messageLabel",[MN],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),MD=ML))||MD);g._RF.pop(),g._RF.push({},"ecbb9MLxRlP2Kv7swFe9AXo","StartLevelScreen",void 0);var xi,xa,xr,xo,xs,xl=E.ccclass,xu=E.property,xd=E.requireComponent,xp=GameCore.Events,xf=globalThis.game.event;MV=xl("StartLevelScreen"),Mq=xd(PR),MW=xu(k),MK=xu(k),MX=xu(k),MJ=xu(k),MQ=xu(N),MV(MZ=Mq((M0=Ye((M$=function(p){Ie(n,p);var v=xe(n);function n(){var p;Ce(this,n);for(var g=arguments.length,E=new Array(g),k=0;k<g;k++)E[k]=arguments[k];return je(p=v.call.apply(v,[this].concat(E)),"playButton",M0,Ne(p)),je(p,"goalText",M1,Ne(p)),je(p,"levelText",M2,Ne(p)),je(p,"missionText",M4,Ne(p)),je(p,"playButtonComponent",M3,Ne(p)),p.handleOpeningScreen=function(v){if(!p.screen)throw new Error("StartLevelScreen: screen not found");p.validateEventPayload(v)&&(p.playButtonComponent.interactable=!0)},p.handleOpenedScreen=function(v){p.validateEventPayload(v)&&p.open()},p}return Ae(n,[{key:"__preload",value:function(){this.enabled=!1,this.screen=this.getComponent(PR),this.validateRequiredComponents(),this.listenScreenEvents()}},{key:"onDestroy",value:function(){this.unListenScreenEvents()}},{key:"validateRequiredComponents",value:function(){e7.lazyValidateProperties(this)}},{key:"listenScreenEvents",value:function(){xf.on(xp.OPENING_SCREEN,this.handleOpeningScreen),xf.on(xp.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"unListenScreenEvents",value:function(){xf.off(xp.OPENING_SCREEN,this.handleOpeningScreen),xf.off(xp.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"validateEventPayload",value:function(p){var v=null!=p?p:{},g=v.screenName,E=v.screenData;return g===this.node.name&&(null!=E&&E.level&&(this.levelId=E.level),null!=E&&E.mission&&(this.mission=E.mission),!0)}},{key:"open",value:function(){this.updateComponents(),this.runPopUpAnimation(),this.node.scene.emit(aR.HIDE_UI)}},{key:"close",value:function(){this.playButtonComponent.interactable=!1,xf.emit(xp.CLOSE_SCREEN,{screenName:this.node.name}),this.node.scene.emit(aR.SHOW_UI)}},{key:"updateComponents",value:function(){this.updateGoalText(),this.updateLevelText(),this.updateDescriptionText()}},{key:"updateGoalText",value:function(){var p=this.mission.mission;this.goalText.getComponent(I).string=p>1?"Goals":"Goal"}},{key:"updateLevelText",value:function(){this.levelText.getComponent(I).string="Level ".concat(this.levelId)}},{key:"updateDescriptionText",value:function(){this.missionText.getComponent(I).string=this.mission.description}},{key:"runPopUpAnimation",value:function(){this.screen.container||console.warn("StartLevelScreen: screen not found")}},{key:"handleClickedPlay",value:function(){this.node.scene.emit(aR.GAME_START),this.close()}}]),n}(L)).prototype,"playButton",[MW],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),M1=Ye(M$.prototype,"goalText",[MK],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),M2=Ye(M$.prototype,"levelText",[MX],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),M4=Ye(M$.prototype,"missionText",[MJ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),M3=Ye(M$.prototype,"playButtonComponent",[MQ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),MZ=M$))||MZ);g._RF.pop(),g._RF.push({},"fe274iMNmBCzZ13Ie1nGU1R","TournamentLeaderSkeleton",void 0);var xy,xv,xg,xm,xb,xw,xS,xE,xk,xC,x_,xA,xT,xI,xR,xP,xN,xD,xL,xO,xM,xx,xF,xB,xU,xz,xG=E.ccclass,xY=E.property,xj=(xi=xG("TournamentLeaderSkeleton"),xa=xY(k),xi((xs=Ye((xo=function(p){Ie(a,p);var v,g,E=xe(a);function a(){var p;Ce(this,a);for(var v=arguments.length,g=new Array(v),k=0;k<v;k++)g[k]=arguments[k];return je(p=E.call.apply(E,[this].concat(g)),"container",xs,Ne(p)),p}return Ae(a,[{key:"__preload",value:function(){this.uiOpacity=this.getComponent(et),this.validateRequiredComponents()}},{key:"hide",value:(g=Ee(function(p){var v;return _ts_generator(this,function(g){switch(g.label){case 0:v=this;return[4,tJ.runTweenAsync(G(this.uiOpacity).to(.2,{opacity:0}).call(function(){v.node.active=!1}),p)];case 1:g.sent();return[2]}})}),function(p){return g.apply(this,arguments)})},{key:"show",value:(v=Ee(function(p,v){var g,E,k,C;return _ts_generator(this,function(_){switch(_.label){case 0:this.node.active=!0,this.node.scale=new ef(.8,.8,.8),this.uiOpacity.opacity=0;g=this.container.position.clone();this.container.position=new ef(g.x,g.y-100,g.z);E=G(this.node).delay(p);E.to(.2,{scale:ef.ONE},{easing:"elasticOut"});k=G(this.container).delay(p);k.to(.2,{position:g},{easing:"backOut"});C=G(this.uiOpacity).delay(p);C.to(.2,{opacity:255},{easing:"cubicOut"});return[4,Promise.all([tJ.runTweenAsync(E,v),tJ.runTweenAsync(k,v),tJ.runTweenAsync(C,v)])];case 1:_.sent();return[2]}})}),function(p,g){return v.apply(this,arguments)})},{key:"validateRequiredComponents",value:function(){if(!this.uiOpacity)throw new Error("UIOpacity component is not attached to the same node");if(!this.container)throw new Error("Container is not attached to the same node")}}]),a}(L)).prototype,"container",[xa],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),xr=xo))||xr);g._RF.pop(),g._RF.push({},"cdaa9B4pK9PFrDmP6/GQcMn","TournamentDetailScreen",void 0);var xH=E.ccclass,xV=E.property,xq=E.requireComponent,xW=GameCore,xK=xW.Events,xX=xW.Utils,xJ=xX.Object,xQ=xX.Time,xZ=xX.Number,x$=xX.Array,x0=globalThis.game,x1=x0.event,x2=x0.storage,x4=x0.player,x3=x0.leaderboard;xy=xH("TournamentDetailScreen"),xv=xq(PR),xg=xV(I),xm=xV(I),xb=xV(I),xw=xV(Af),xS=xV(A),xE=xV({type:k,group:"Buttons"}),xk=xV({type:k,group:"Buttons"}),xC=xV({type:k,group:"Buttons"}),x_=xV({type:[xj]}),xA=xV({type:[V]}),xT=xV(g0),xy(xI=xv((xP=Ye((xR=function(p){Ie(y,p);var v,g,E,k,C,_,A,T,I,R,P,N,D=xe(y);function y(){var p;Ce(this,y);for(var v=arguments.length,g=new Array(v),E=0;E<v;E++)g[E]=arguments[E];return je(p=D.call.apply(D,[this].concat(g)),"titleLabel",xP,Ne(p)),je(p,"timeLabel",xN,Ne(p)),je(p,"playerCountLabel",xD,Ne(p)),je(p,"tournamentLeaders",xL,Ne(p)),je(p,"viewport",xO,Ne(p)),je(p,"playButton",xM,Ne(p)),je(p,"continueButton",xx,Ne(p)),je(p,"replayButton",xF,Ne(p)),je(p,"leaderSkeletons",xB,Ne(p)),je(p,"banners",xU,Ne(p)),je(p,"paperConfetti",xz,Ne(p)),p.animAbortSignal=null,p.fetchAbortController=null,p.leadersPayload=null,p.handleOpeningScreen=function(v){if(!p.screen)throw new Error("TournamentDetailScreen: screen not found");p.validateEventPayload(v)},p.handleOpenedScreen=function(v){p.validateEventPayload(v)&&p.open()},p}return Ae(y,[{key:"__preload",value:function(){this.enabled=!1,this.screen=this.getComponent(PR),this.tournamentScrollView=this.tournamentLeaders.node.getComponent(eR),this.validateRequiredComponents(),this.listenScreenEvents()}},{key:"onDestroy",value:function(){this.unListenScreenEvents()}},{key:"validateRequiredComponents",value:function(){e7.lazyValidateProperties(this)}},{key:"listenScreenEvents",value:function(){x1.on(xK.OPENING_SCREEN,this.handleOpeningScreen),x1.on(xK.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"unListenScreenEvents",value:function(){x1.off(xK.OPENING_SCREEN,this.handleOpeningScreen),x1.off(xK.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"updateVisibility",value:function(){this.tournamentLeaders.updateVisibility()}},{key:"validateEventPayload",value:function(p){return(null!=p?p:{}).screenName===this.node.name&&(this.payload=p,!0)}},{key:"open",value:function(){if(this.updateButtonVisibility(),this.setPlayerCountWaiting(),this.runPopUpAnimation(),this.node.scene.emit(aR.HIDE_UI),this.tournamentScrollView.node.on(eR.EventType.SCROLLING,this.updateVisibility,this),null!==this.animAbortSignal)throw new Error("TournamentContent: TournamentContent is already loading. Please handle cancelling gracefully.");this.animAbortSignal=new na,this.updateInfo(this.animAbortSignal)}},{key:"close",value:function(){s8.closeTournamentDetailScreen(),this.node.scene.emit(aR.SHOW_UI),this.tournamentScrollView.node.off(eR.EventType.SCROLLING,this.updateVisibility,this),this.cleanup()}},{key:"cleanup",value:function(){var p,v;null===(p=this.fetchAbortController)||void 0===p||p.abort(),null===(v=this.animAbortSignal)||void 0===v||v.abort(),this.animAbortSignal=null,this.fetchAbortController=null,this.tournamentLeaders.removeLeaders()}},{key:"runPopUpAnimation",value:function(){this.screen.container||console.warn("StartLevelScreen: screen not found")}},{key:"updateInfo",value:(N=Ee(function(p){var v,g,E,k,C,_,A,T,I,R,P,N,D,L,O,M,x,F,B,U,z,G,Y;return _ts_generator(this,function(j){switch(j.label){case 0:k=null===(v=this.payload)||void 0===v||null===(v=v.screenData)||void 0===v?void 0:v.tournament;if(!k)return[3,7];C=JSON.parse(k);C.id=C.id.toString(),this.tournamentPayload=C;_=this.tournamentPayload,A=_.endTime,T=_.payload,I=_.title,R=T.leaderboardId,P=void 0===R?"":R,N=T.themeId;this.updateTitle(I),this.updateEndTime(A),this.updateTournamentBanner(N);D=x2.getStorage("tournament"),L=D.previousScore,O=D.previousRank,M=D.animateTournamentLeader;this.updateButtonsVisibility(M);return[4,this.showLoading(p)];case 1:j.sent();x=this;return[4,this.getLeadersPayload(P)];case 2:if(x.leadersPayload=j.sent(),!this.leadersPayload)return[2,(this.updatePlayerCount(0),void this.hideLoading(p))];F=this.leadersPayload,B=F.player,U=F.leaders;this.updatePlayerCount(U.length);z=null!==(g=null==B?void 0:B.score)&&void 0!==g?g:0,G=null!==(E=null==B?void 0:B.rank)&&void 0!==E?E:0;B&&M&&L&&L<z&&O&&O!==G&&(x$.search(U,function(p){return p.playerId===B.playerId}).score=L);return[4,this.hideLoading(p)];case 3:j.sent(),this.tournamentLeaders.updateData(U);return[4,this.runShowUpAnimation(p)];case 4:j.sent();Y=M;if(!Y)return[3,6];x2.setStorageData("tournament","animateTournamentLeader",!1);return[4,this.runPlayerRankChangeAnimation(p,z)];case 5:Y=j.sent();j.label=6;case 6:j.label=7;case 7:return[2]}})}),function(p){return N.apply(this,arguments)})},{key:"updateTournamentBanner",value:function(p){p?this.activateThemeBanner(p):this.activateThemeBanner(sp.SUMMER)}},{key:"activateThemeBanner",value:function(p){var v=!1;this.banners.forEach(function(g){g.node.active=g.node.name.toLowerCase()===p,g.node.active&&(v=!0)}),v||this.banners.forEach(function(p){p.node.active=p.node.name.toLowerCase()===sp.SUMMER})}},{key:"showLoading",value:(P=Ee(function(p){var v;var g=arguments;return _ts_generator(this,function(E){switch(E.label){case 0:v=g.length>1&&void 0!==g[1]?g[1]:0;return[4,Promise.all([this.leaderSkeletons.map(function(g,E){return g.show(E*v,p)})])];case 1:E.sent();return[2]}})}),function(p){return P.apply(this,arguments)})},{key:"hideLoading",value:(R=Ee(function(p){return _ts_generator(this,function(v){switch(v.label){case 0:return[4,Promise.all(this.leaderSkeletons.map(function(v){return v.hide(p)}))];case 1:v.sent();return[2]}})}),function(p){return R.apply(this,arguments)})},{key:"runShowUpAnimation",value:(I=Ee(function(p){var v,g;return _ts_generator(this,function(E){switch(E.label){case 0:return[4,this.tournamentLeaders.showLeaders(p)];case 1:E.sent();v=this.tournamentLeaders.getPlayerLeader();g=v;if(!g)return[3,3];return[4,this.scrollToLeader(v,1)];case 2:g=E.sent();E.label=3;case 3:return[2]}})}),function(p){return I.apply(this,arguments)})},{key:"runPlayerRankChangeAnimation",value:(T=Ee(function(p,v){var g,E,k,C,_,A,T,I,R,P,N,D,L;return _ts_generator(this,function(O){switch(O.label){case 0:g=this.tournamentLeaders.getLeaderData(),E=x$.search(g,function(p){return p.playerId===x4.getPlayerId()});if(!E)return[3,4];k=E.score,C=E.rank;if(!(k!==v))return[3,4];E.score=v,g.sort(function(p,v){return v.score-p.score}),g.forEach(function(p,v){p.rank=v+1});_=this.tournamentLeaders.getPlayerLeader();if(!_)return[3,4];A=this.tournamentLeaders.getLeaderByRank(E.rank);if(!A)return[3,4];this.tournamentLeaders.layout.enabled=!1,_.node.setParent(this.node,!0);return[4,_.runScaleAnimation(p,1.1,.5)];case 1:O.sent(),E.rank<=10&&nQ.playSound(nB.STAR_CHEST_DRUM_ROLL);T=Math.min(.5*(C-E.rank),2),I=[_.runUpdateDataAnimation(C,E.rank,k,E.score,T),this.scrollToLeader(A,T)],R=this.viewport.contentSize.height,P=this.viewport.getBoundingBoxToWorld(),N=this.tournamentScrollView.getMaxScrollOffset().y,D=-A.node.position.y-R/2,L=ef.ZERO;D<0?L=new ef(_.node.worldPosition.x,P.yMax+A.node.position.y,_.node.worldPosition.z):this.tournamentScrollView.getScrollOffset().y>=N-5&&(L=D<N?new ef(_.node.worldPosition.x,P.center.y,_.node.worldPosition.z):A.node.worldPosition),L.equals(ef.ZERO)||I.push(_.runWorldPositionAnimation(L,T));return[4,Promise.all(I)];case 2:O.sent(),nQ.stopSound(nB.STAR_CHEST_DRUM_ROLL);return[4,Promise.all([_.runScaleAnimation(p,1,.25),_.node.setParent(this.tournamentLeaders.layout.node,!0),_.node.setSiblingIndex(E.rank-1),this.tournamentLeaders.runUpdateLeadersRankAnimation(E.rank,C),this.runPaperConfettiEffect(E.rank)])];case 3:O.sent(),this.tournamentLeaders.layout.enabled=!0,this.tournamentLeaders.layout.updateLayout();O.label=4;case 4:return[2]}})}),function(p,v){return T.apply(this,arguments)})},{key:"runPaperConfettiEffect",value:function(p){p>10||(this.paperConfetti.runEffect(),nQ.playSound(nB.LEADERBOARD_TRIUMPH))}},{key:"scrollToLeader",value:(A=Ee(function(p,v){var g,E,k,C;return _ts_generator(this,function(_){g=this.tournamentLeaders.uiTransform.contentSize,E=new eg(0,-p.node.position.y-g.height/2),k=this.tournamentScrollView.getScrollOffset().clone();E.y=Math.max(E.y,0),k.y=Math.max(k.y,0);C=E.y-k.y;if(!(Math.abs(C)<5))return[2,(this.tournamentScrollView.scrollToOffset(E,v),tJ.waitTweenAsync(v))];return[2]})}),function(p,v){return A.apply(this,arguments)})},{key:"updateTitle",value:function(p){p&&(this.titleLabel.string=p)}},{key:"updateEndTime",value:function(p){var v=xQ.getRelativeTime(p);v=(v=v.replace("seconds","secs").replace("second","sec")).replace("minutes","mins").replace("minute","min"),this.timeLabel.string="Ends ".concat(v)}},{key:"updatePlayerCount",value:function(p){var v=xZ.getShortNumber(p,3);this.playerCountLabel.string="".concat(v," ")+(p>1?"players":"player")}},{key:"setPlayerCountWaiting",value:function(){this.playerCountLabel.string="Loading..."}},{key:"getLeadersPayload",value:(_=Ee(function(p){var v,g,E,k,C,_,A,T;return _ts_generator(this,function(I){switch(I.label){case 0:v=x3.getLeaderboardName(p);if(!v)return[2,null];return[4,x3.requestLeaderboardAsync(v,0)];case 1:I.sent();g=x3.getLeaderboard(v);if(!g)return[2,null];k=xJ.vals(g.leaders),C=x4.getPlayerId(),_={leaders:[],player:void 0,isPlayerInTournament:!1},A=We(k);try{for(A.s();!(E=A.n()).done;){T=E.value;T.playerId===C?(_.player=T,_.isPlayerInTournament=!0,_.leaders.push(T)):_.leaders.push(T)}}catch(p){A.e(p)}finally{A.f()}return[2,_]}})}),function(p){return _.apply(this,arguments)})},{key:"updateButtonsVisibility",value:function(p){this.playButton.active=!p,this.continueButton.active=p,this.replayButton.active=p}},{key:"handleOnPlay",value:(C=Ee(function(){var p,v,g;return _ts_generator(this,function(E){switch(E.label){case 0:p=this.tournamentPayload.id||"";if(ll.validateTournamentExpired(p))return[2,(this.close(),this.node.scene.emit(se.RELOAD_TOURNAMENT),void s8.showNotificationScreen("Tournament has ended",2))];E.label=1;case 1:E.trys.push([1,4,,9]);s8.showLoadingNotificationScreen();return[4,sx.setMatchCustomDataAsync({level:1,score:0})];case 2:E.sent();return[4,this.processJoinTournament()];case 3:E.sent();return[3,9];case 4:v=E.sent();if(xJ.hasOwn(v,"code")&&"USER_INPUT"===v.code)return[2,void s8.closeNotificationScreen()];E.label=5;case 5:E.trys.push([5,7,,8]);return[4,this.processContinueTournament()];case 6:E.sent();return[3,8];case 7:g=E.sent();if(xJ.hasOwn(g,"code")&&"USER_INPUT"===g.code)return[2,void s8.closeNotificationScreen()];console.error("processPlayButtonPressed",g),s8.showNotificationScreen("Sorry, you cannot join\nat this time.",2);return[3,8];case 8:return[3,9];case 9:return[2]}})}),function(){return C.apply(this,arguments)})},{key:"processJoinTournament",value:(k=Ee(function(){var p;return _ts_generator(this,function(v){switch(v.label){case 0:v.trys.push([0,2,,3]);return[4,this.joinTournamentAsync()];case 1:v.sent(),sq.switchScene(o9,{level:1});return[3,3];case 2:p=v.sent();throw console.warn("processJoinTournament",p),p;case 3:return[2]}})}),function(){return k.apply(this,arguments)})},{key:"processContinueTournament",value:(E=Ee(function(){var p;return _ts_generator(this,function(v){switch(v.label){case 0:v.trys.push([0,2,,3]);return[4,this.continueTournamentAsync()];case 1:v.sent(),sq.switchScene(o9,{level:1});return[3,3];case 2:p=v.sent();throw console.warn("processContinueTournament",p),p;case 3:return[2]}})}),function(){return E.apply(this,arguments)})},{key:"joinTournamentAsync",value:(g=Ee(function(){var p;return _ts_generator(this,function(v){switch(v.label){case 0:p=this.tournamentPayload.id||"";return[4,sx.joinTournamentAsync(p)];case 1:v.sent();return[2]}})}),function(){return g.apply(this,arguments)})},{key:"continueTournamentAsync",value:(v=Ee(function(){var p,v;return _ts_generator(this,function(g){switch(g.label){case 0:v=null!==(p=GameSDK.context.getID())&&void 0!==p?p:"";return[4,sx.continueTournamentAsync(v)];case 1:g.sent();return[2]}})}),function(){return v.apply(this,arguments)})},{key:"updateButtonVisibility",value:function(){var p,v,g=(null!==(p=null===(v=this.payload)||void 0===v?void 0:v.screenData)&&void 0!==p?p:{}).tournamentContextType;switch(void 0===g?"tournament_start":g){case"tournament_end":this.playButton.active=!1,this.continueButton.active=!0,this.replayButton.active=!0;break;case"tournament_start":this.playButton.active=!0,this.continueButton.active=!1,this.replayButton.active=!1}}}]),y}(L)).prototype,"titleLabel",[xg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),xN=Ye(xR.prototype,"timeLabel",[xm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),xD=Ye(xR.prototype,"playerCountLabel",[xb],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),xL=Ye(xR.prototype,"tournamentLeaders",[xw],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),xO=Ye(xR.prototype,"viewport",[xS],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),xM=Ye(xR.prototype,"playButton",[xE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),xx=Ye(xR.prototype,"continueButton",[xk],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),xF=Ye(xR.prototype,"replayButton",[xC],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),xB=Ye(xR.prototype,"leaderSkeletons",[x_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),xU=Ye(xR.prototype,"banners",[xA],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),xz=Ye(xR.prototype,"paperConfetti",[xT],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),xI=xR))||xI);g._RF.pop(),g._RF.push({},"36d58kn8v5POaqgX4C8S3ct","TournamentLeader",void 0);(0,E.ccclass)("TournamentLeader")(function(p){Ie(n,p);var v=xe(n);function n(){return Ce(this,n),v.apply(this,arguments)}return Ae(n)}(_$));g._RF.pop(),g._RF.push({},"43001Am3F9GVZjL3Nj2K44h","CoreManager",void 0);var x5=GameCore.Events,x6=globalThis.game,x9=x6.event,x8=x6.monitorError,x7=function(){function e(){var p=this;Ce(this,e),this.callbackCoreBooting=null,this.callbackCoreStarting=null,this.callbackCoreReady=null,this.handleWhenCoreBooting=function(){if(!p.callbackCoreBooting)return console.error("Core: Booting callback is not set"),void(null==x8||x8.sendException(new Error("Core: Booting callback is not set")));console.info("\uD83D\uDE80 Core: Boot"),p.callbackCoreBooting(),p.callbackCoreBooting=null},this.handleWhenCoreStarting=function(){if(!p.callbackCoreStarting)return console.error("Core: Starting callback is not set"),void(null==x8||x8.sendException(new Error("Core: Starting callback is not set")));console.info("\uD83D\uDE80 Core: Starting"),p.callbackCoreStarting(),p.callbackCoreStarting=null},this.handleWhenCoreReady=function(){if(!p.callbackCoreReady)return console.error("Core: Ready callback is not set"),void(null==x8||x8.sendException(new Error("Core: Ready callback is not set")));console.info("\uD83D\uDE80 Core: Ready"),p.callbackCoreReady(),p.callbackCoreReady=null}}return Ae(e,[{key:"init",value:function(){this.listenEvents(),console.info("Core Manager: Initialized")}},{key:"listenEvents",value:function(){x9.once(x5.CORE_BOOTING,this.handleWhenCoreBooting),x9.once(x5.CORE_STARTING,this.handleWhenCoreStarting),x9.once(x5.CORE_READY,this.handleWhenCoreReady)}},{key:"requestStart",value:function(){x9.emit(x5.REQUEST_CORE_START)}},{key:"onCoreBoot",value:function(p){this.callbackCoreBooting=p,x9.getEventEmitCount(x5.CORE_BOOTING)>0&&(x9.off(x5.CORE_BOOTING,this.handleWhenCoreBooting),this.handleWhenCoreBooting())}},{key:"onCoreStart",value:function(p){this.callbackCoreStarting=p,x9.getEventEmitCount(x5.CORE_STARTING)>0&&(x9.off(x5.CORE_STARTING,this.handleWhenCoreStarting),this.handleWhenCoreStarting())}},{key:"onCoreReady",value:function(p){this.callbackCoreReady=p,x9.getEventEmitCount(x5.CORE_READY)>0&&(x9.off(x5.CORE_READY,this.handleWhenCoreReady),this.handleWhenCoreReady())}}]),e}();g._RF.pop(),g._RF.push({},"b4ad5mMokdAa6EVNGzNedpF","EngineManager",void 0);var Ft=GameCore,Fn=Ft.Configs.GameEngine.DynamicAtlas,Fi=Ft.Utils.Valid,Fa=function(){function e(){var p=this;Ce(this,e),this.overrideSettings=function(){eM.overrideSettings(ex.Category.ENGINE,"debug",Fi.isDebugger())},this.handleResizeView=function(v){eI.instance.resizeWithBrowserSize(!1);var g=v.width,E=v.height;p.resizeView(g,E)},this.handleViewResized=function(p){var v=p.width,g=p.height;eI.instance.resizeWithBrowserSize(!0),console.info("✨ New View Size",{width:v,height:g})}}return Ae(e,[{key:"init",value:function(){this.overrideSettings(),this.setupAutoAtlas(),this.setupBatcherLimit(),this.setupDynamicAtlas(),this.listenEvents(),console.info("Engine Manager: Initialized")}},{key:"listenEvents",value:function(){ec.on(iG,this.handleResizeView),ec.on(iY,this.handleViewResized)}},{key:"setupAutoAtlas",value:function(){eD.instance.cacheAsset=!0}},{key:"setupDynamicAtlas",value:function(){switch(ep.os){case ep.OS.IOS:this.setupDynamicAtlasForIOS();break;case ep.OS.ANDROID:this.setupDynamicAtlasForAndroid();break;default:this.setupDynamicAtlasForDesktop()}}},{key:"setDynamicAtlas",value:function(p){var v=p.Enabled,g=p.AutoAtlasSize,E=p.MaxAtlasCount,k=p.MaxAtlasSize,C=p.MaxFrameSize;if(eL.instance.enabled=v,eL.instance.textureSize=k,eL.instance.maxFrameSize=C,eL.instance.maxAtlasCount=E,eL.instance.textureBleeding=!0,g){var _=this.getMaxTextureSize();if(!_)return;eL.instance.maxAtlasCount=1,eL.instance.textureSize=_}}},{key:"getMaxTextureSize",value:function(){if(!D.root)return -1;var p=D.root.device.capabilities.maxTextureSize;return p>8192?7168:p-1024}},{key:"setupDynamicAtlasForIOS",value:function(){var p=Fn.IOS;this.setDynamicAtlas(p)}},{key:"setupDynamicAtlasForAndroid",value:function(){var p=Fn.Android;this.setDynamicAtlas(p)}},{key:"setupDynamicAtlasForDesktop",value:function(){var p=Fn.Desktop;this.setDynamicAtlas(p)}},{key:"setupBatcherLimit",value:function(){eO.BATCHER2D_MEM_INCREMENT=288,eO.MAX_LABEL_CANVAS_POOL_SIZE=125}},{key:"resizeView",value:function(p,v){var g,E=window.devicePixelRatio,k=E>=2?2/E:1,C=p*E*k,_=v*E*k;null===(g=D.root)||void 0===g||g.resize(C,_),ei.windowSize=new ea.Size(C,_),D.once(em.EVENT_AFTER_UPDATE,function(){ec.emit(iY,{width:C,height:_})})}}]),e}();g._RF.pop();var Fr,Fo=new(function(){function e(){Ce(this,e),this._registry={},this._moduleCache={}}return Ae(e,[{key:"define",value:function(p,v,g){this._registry[p]={factory:v,resolveMap:g}}},{key:"require",value:function(p){return this._require(p)}},{key:"throwInvalidWrapper",value:function(p,v){throw new Error("Module '".concat(p,"' imported from '").concat(v,"' is expected be an ESM-wrapped CommonJS module but it doesn't."))}},{key:"_require",value:function(p,v){var g=this._moduleCache[p];if(g)return g.exports;var E={id:p,exports:{}};return this._moduleCache[p]=E,this._tryModuleLoad(E,p),E.exports}},{key:"_resolve",value:function(p,v){return this._resolveFromInfos(p,v)||this._throwUnresolved(p,v)}},{key:"_resolveFromInfos",value:function(p,v){var g,E;return p in cjsInfos?p:v&&null!==(g=null===(E=cjsInfos[v])||void 0===E?void 0:E.resolveCache[p])&&void 0!==g?g:void 0}},{key:"_tryModuleLoad",value:function(p,v){var g=!0;try{this._load(p,v),g=!1}finally{g&&delete this._moduleCache[v]}}},{key:"_load",value:function(p,v){var g=this._loadWrapper(v),E=g.factory,k=g.resolveMap,C=this._createRequire(p),_=k?this._createRequireWithResolveMap("function"==typeof k?k():k,C):C;E(p.exports,_,p)}},{key:"_loadWrapper",value:function(p){return p in this._registry?this._registry[p]:this._loadHostProvidedModules(p)}},{key:"_loadHostProvidedModules",value:function(p){return{factory:function(v,g,E){if("undefined"==typeof require)throw new Error("Current environment does not provide a require() for requiring '".concat(p,"'."));try{E.exports=require(p)}catch(v){throw new Error("Exception thrown when calling host defined require('".concat(p,"')."),{cause:v})}}}}},{key:"_createRequire",value:function(p){var v=this;return function(g){return v._require(g,p)}}},{key:"_createRequireWithResolveMap",value:function(p,v){return function(g){var E=p[g];if(E)return v(E);throw new Error("Unresolved specifier "+g)}}},{key:"_throwUnresolved",value:function(p,v){throw new Error("Unable to resolve ".concat(p," from ").concat(parent,"."))}}]),e}());function Nq(p){return(Nq="function"==typeof Symbol&&"symbol"==_type_of(Symbol.iterator)?function(p){return void 0===p?"undefined":_type_of(p)}:function(p){return p&&"function"==typeof Symbol&&p.constructor===Symbol&&p!==Symbol.prototype?"symbol":void 0===p?"undefined":_type_of(p)})(p)}var Fs="file:///D:/VSCode%20Project/tile-connect-remaster-game/node_modules/resize-observer-polyfill/dist/ResizeObserver.js";Fo.define(Fs,function(p,v,g,E,k){(function(v,E){"object"===Nq(p)&&void 0!==g?g.exports=E():"function"==typeof define&&define.amd?define(E):v.ResizeObserver=E()})(this,function(){var p=function(){if("undefined"!=typeof Map)return Map;function e(p,v){var g=-1;return p.some(function(p,E){return p[0]===v&&(g=E,!0)}),g}return function(){function t(){this.__entries__=[]}return Object.defineProperty(t.prototype,"size",{get:function(){return this.__entries__.length},enumerable:!0,configurable:!0}),t.prototype.get=function(p){var v=e(this.__entries__,p),g=this.__entries__[v];return g&&g[1]},t.prototype.set=function(p,v){var g=e(this.__entries__,p);~g?this.__entries__[g][1]=v:this.__entries__.push([p,v])},t.prototype.delete=function(p){var v=this.__entries__,g=e(v,p);~g&&v.splice(g,1)},t.prototype.has=function(p){return!!~e(this.__entries__,p)},t.prototype.clear=function(){this.__entries__.splice(0)},t.prototype.forEach=function(p,v){void 0===v&&(v=null);for(var g=0,E=this.__entries__;g<E.length;g++){var k=E[g];p.call(v,k[1],k[0])}},t}()}(),v="undefined"!=typeof window&&"undefined"!=typeof document&&window.document===document,g="undefined"!=typeof global&&global.Math===Math?global:"undefined"!=typeof self&&self.Math===Math?self:"undefined"!=typeof window&&window.Math===Math?window:Function("return this")(),E="function"==typeof requestAnimationFrame?requestAnimationFrame.bind(g):function(p){return setTimeout(function(){return p(Date.now())},1e3/60)};var k=["top","right","bottom","left","width","height","size","weight"],C="undefined"!=typeof MutationObserver,_=function(){function e(){this.connected_=!1,this.mutationEventsAdded_=!1,this.mutationsObserver_=null,this.observers_=[],this.onTransitionEnd_=this.onTransitionEnd_.bind(this),this.refresh=function(p,v){var g=!1,k=!1,C=0;function r(){g&&(g=!1,p()),k&&l()}function s(){E(r)}function l(){var p=Date.now();if(g){if(p-C<2)return;k=!0}else g=!0,k=!1,setTimeout(s,v);C=p}return l}(this.refresh.bind(this),20)}return e.prototype.addObserver=function(p){~this.observers_.indexOf(p)||this.observers_.push(p),this.connected_||this.connect_()},e.prototype.removeObserver=function(p){var v=this.observers_,g=v.indexOf(p);~g&&v.splice(g,1),!v.length&&this.connected_&&this.disconnect_()},e.prototype.refresh=function(){this.updateObservers_()&&this.refresh()},e.prototype.updateObservers_=function(){var p=this.observers_.filter(function(p){return p.gatherActive(),p.hasActive()});return p.forEach(function(p){return p.broadcastActive()}),p.length>0},e.prototype.connect_=function(){v&&!this.connected_&&(document.addEventListener("transitionend",this.onTransitionEnd_),window.addEventListener("resize",this.refresh),C?(this.mutationsObserver_=new MutationObserver(this.refresh),this.mutationsObserver_.observe(document,{attributes:!0,childList:!0,characterData:!0,subtree:!0})):(document.addEventListener("DOMSubtreeModified",this.refresh),this.mutationEventsAdded_=!0),this.connected_=!0)},e.prototype.disconnect_=function(){v&&this.connected_&&(document.removeEventListener("transitionend",this.onTransitionEnd_),window.removeEventListener("resize",this.refresh),this.mutationsObserver_&&this.mutationsObserver_.disconnect(),this.mutationEventsAdded_&&document.removeEventListener("DOMSubtreeModified",this.refresh),this.mutationsObserver_=null,this.mutationEventsAdded_=!1,this.connected_=!1)},e.prototype.onTransitionEnd_=function(p){var v=p.propertyName,g=void 0===v?"":v;k.some(function(p){return!!~g.indexOf(p)})&&this.refresh()},e.getInstance=function(){return this.instance_||(this.instance_=new e),this.instance_},e.instance_=null,e}(),s=function(p,v){for(var g=0,E=Object.keys(v);g<E.length;g++){var k=E[g];Object.defineProperty(p,k,{value:v[k],enumerable:!1,writable:!1,configurable:!0})}return p},l=function(p){return p&&p.ownerDocument&&p.ownerDocument.defaultView||g},A=f(0,0,0,0);function c(p){return parseFloat(p)||0}function h(p){for(var v=[],g=1;g<arguments.length;g++)v[g-1]=arguments[g];return v.reduce(function(v,g){return v+c(p["border-"+g+"-width"])},0)}function d(p){var v=p.clientWidth,g=p.clientHeight;if(!v&&!g)return A;var E=l(p).getComputedStyle(p),k=function(p){for(var v={},g=0,E=["top","right","bottom","left"];g<E.length;g++){var k=E[g],C=p["padding-"+k];v[k]=c(C)}return v}(E),C=k.left+k.right,_=k.top+k.bottom,T=c(E.width),I=c(E.height);if("border-box"===E.boxSizing&&(Math.round(T+C)!==v&&(T-=h(E,"left","right")+C),Math.round(I+_)!==g&&(I-=h(E,"top","bottom")+_)),!function(p){return p===l(p).document.documentElement}(p)){var R=Math.round(T+C)-v,P=Math.round(I+_)-g;1!==Math.abs(R)&&(T-=R),1!==Math.abs(P)&&(I-=P)}return f(k.left,k.top,T,I)}var T="undefined"!=typeof SVGGraphicsElement?function(p){return _instanceof(p,l(p).SVGGraphicsElement)}:function(p){return _instanceof(p,l(p).SVGElement)&&"function"==typeof p.getBBox};function y(p){return v?T(p)?function(p){var v=p.getBBox();return f(0,0,v.width,v.height)}(p):d(p):A}function f(p,v,g,E){return{x:p,y:v,width:g,height:E}}var I=function(){function e(p){this.broadcastWidth=0,this.broadcastHeight=0,this.contentRect_=f(0,0,0,0),this.target=p}return e.prototype.isActive=function(){var p=y(this.target);return this.contentRect_=p,p.width!==this.broadcastWidth||p.height!==this.broadcastHeight},e.prototype.broadcastRect=function(){var p=this.contentRect_;return this.broadcastWidth=p.width,this.broadcastHeight=p.height,p},e}(),m=function(p,v){var g,E,k,C,_,A,T,I=(E=(g=v).x,k=g.y,C=g.width,_=g.height,A="undefined"!=typeof DOMRectReadOnly?DOMRectReadOnly:Object,T=Object.create(A.prototype),s(T,{x:E,y:k,width:C,height:_,top:k,right:E+C,bottom:_+k,left:E}),T);s(this,{target:p,contentRect:I})},R=function(){function t(v,g,E){if(this.activeObservations_=[],this.observations_=new p,"function"!=typeof v)throw new TypeError("The callback provided as parameter 1 is not a function.");this.callback_=v,this.controller_=g,this.callbackCtx_=E}return t.prototype.observe=function(p){if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");if("undefined"!=typeof Element&&_instanceof(Element,Object)){if(!_instanceof(p,l(p).Element))throw new TypeError('parameter 1 is not of type "Element".');var v=this.observations_;v.has(p)||(v.set(p,new I(p)),this.controller_.addObserver(this),this.controller_.refresh())}},t.prototype.unobserve=function(p){if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");if("undefined"!=typeof Element&&_instanceof(Element,Object)){if(!_instanceof(p,l(p).Element))throw new TypeError('parameter 1 is not of type "Element".');var v=this.observations_;v.has(p)&&(v.delete(p),v.size||this.controller_.removeObserver(this))}},t.prototype.disconnect=function(){this.clearActive(),this.observations_.clear(),this.controller_.removeObserver(this)},t.prototype.gatherActive=function(){var p=this;this.clearActive(),this.observations_.forEach(function(v){v.isActive()&&p.activeObservations_.push(v)})},t.prototype.broadcastActive=function(){if(this.hasActive()){var p=this.callbackCtx_,v=this.activeObservations_.map(function(p){return new m(p.target,p.broadcastRect())});this.callback_.call(p,v,p),this.clearActive()}},t.prototype.clearActive=function(){this.activeObservations_.splice(0)},t.prototype.hasActive=function(){return this.activeObservations_.length>0},t}(),P="undefined"!=typeof WeakMap?new WeakMap:new p,S=function e(p){if(!_instanceof(this,e))throw new TypeError("Cannot call a class as a function.");if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");var v=_.getInstance(),g=new R(p,v,this);P.set(this,g)};return["observe","unobserve","disconnect"].forEach(function(p){S.prototype[p]=function(){var v;return(v=P.get(this))[p].apply(v,arguments)}}),void 0!==g.ResizeObserver?g.ResizeObserver:S}),Fr=g.exports},{}),Fo.require(Fs),g._RF.push({},"9f0a0l1uXlNwqKEKardFRyv","LayoutManager",void 0);var Fl=i1,Fu=i2,Fd=Fu.Portrait,Fp=Fu.Landscape,Ff=GameCore.Utils.Function,Fy=function(){function e(){var p=this;Ce(this,e),this.currentLayout="",this.handleViewResizeBySystem=function(v){console.info("\uD83D\uDCF1 View resize by system"),window.devicePixelRatio=v||window.devicePixelRatio,p.setupOrientationByScreenSize(),p.resizeGameView()},this.handleViewResize=Ff.debounce(function(){console.info("\uD83D\uDCF1 View resize by window"),p.setupOrientationByScreenSize(),p.resizeGameView()},200),this.handleBodyResize=Ff.debounce(function(){p.resizeGameDiv()&&(console.info("\uD83D\uDCF1 View resize by body"),p.setupOrientationByScreenSize(),p.resizeGameView())},200)}return Ae(e,[{key:"init",value:function(){this.listenResizeEvent(),this.listenObserverEvent(),this.setupResolutionPolicy(),ec.emit(ij),console.info("Layout Manager: Initialized")}},{key:"listenResizeEvent",value:function(){ep.isBrowser?(ei.on("window-resize",this.handleViewResize,this),ei.on("orientation-change",this.handleViewResize,this)):ep.isMobile?window.addEventListener("resize",this.handleViewResize,{capture:!1,passive:!0}):console.warn("LayoutManager: Not support this platform"),ec.on(ij,this.handleViewResizeBySystem)}},{key:"listenObserverEvent",value:function(){new Fr(this.handleBodyResize).observe(document.body)}},{key:"setupResolutionPolicy",value:function(){eI.instance.resizeWithBrowserSize(!0),eI.instance.setOrientation(eO.ORIENTATION_AUTO),eI.instance.setResolutionPolicy(eF.ContentStrategy.FIXED_WIDTH),eI.instance.setResolutionPolicy(eF.ContainerStrategy.EQUAL_TO_FRAME),this.resolutionPolicy=eI.instance.getResolutionPolicy()}},{key:"setupOrientationByScreenSize",value:function(){var p=this.getScreenRatio();this.resolutionPolicy.setContentStrategy(eF.ContentStrategy.FIXED_WIDTH),p<1?this.setPortraitView():this.setLandscapeView()}},{key:"resizeGameDiv",value:function(){var p=document.getElementById("GameDiv");if(!p)return!1;var v=i_.getScreenWidthCss(),g=i_.getScreenHeightCss(),E=p.getBoundingClientRect(),k=E.width,C=E.height;return(v!==k||g!==C)&&(p.style.width="".concat(v,"px"),p.style.height="".concat(g,"px"),!0)}},{key:"resizeGameView",value:function(){var p=i_.getScreenWidthCss(),v=i_.getScreenHeightCss();ec.emit(iG,{width:p,height:v})}},{key:"setPortraitView",value:function(){var p=Fd.WIDTH,v=Fd.HEIGHT;this.currentLayout=Fl.Portrait,this.changeDesignResolutionSize(p,v)}},{key:"setLandscapeView",value:function(){var p=Fp.WIDTH,v=Fp.HEIGHT;this.currentLayout=Fl.Landscape,this.changeDesignResolutionSize(p,v)}},{key:"changeDesignResolutionSize",value:function(p,v){eI.instance.setDesignResolutionSize(p,v,this.resolutionPolicy),ec.emit(iH,this.currentLayout),console.info("\uD83D\uDCF1 Change layout to",this.currentLayout)}},{key:"getScreenRatio",value:function(){return i_.getScreenWidthCss()/i_.getScreenHeightCss()}}]),e}();g._RF.pop(),g._RF.push({},"535cbXcmXdEzLn3H3LOIS27","MatchManager",void 0);var Fv=GameCore,Fg=Fv.Utils,Fm=Fg.Valid,Fb=Fg.Object,Fw=Fg.Array,FS=Fv.Dtos.Match,FE=FS.CustomData,Fk=FS.Data,FC=["code","cols","encoding","idSize","rows"],F_=["addRandomTilesPerMove","maxSpaceOfPair"],FA=function(){function e(){Ce(this,e)}return Ae(e,[{key:"init",value:function(){console.info("Match Manager: Initialized")}},{key:"setupDefaultMatchData",value:function(){this.setupMatchData(),this.setupMatchCustomData()}},{key:"setupMatchCustomData",value:function(){FE.addDefaultData(o3),FE.addValidateFunction("score",function(p){if(!Fm.isNumber(p)||p<0)throw new Error("score ".concat(p," is invalid"))})}},{key:"setupMatchData",value:function(){var p=this;Fk.addDefaultData(oX),Fk.addValidateFunction("extraData",function(v){if(null!=v){if(!Fm.isObject(v))throw new Error("extraData ".concat(v," must be a record of string keys"));var g=v,E=Object.keys(g);if(!Fw.has(E,"level"))throw new Error("extraData.level is missing");if(!Fm.isNumber(g.level))throw new Error("extraData.level ".concat(g.level," must be a number"));if(!Fw.has(E,"fen"))throw new Error("extraData.fen is missing");if(p.validateFen(g.fen),!Fw.has(E,"gravity"))throw new Error("extraData.gravity is missing");if(!Fm.isString(g.gravity))throw new Error("extraData.gravity ".concat(g.gravity," must be a string"));if(!Fw.has(E,"rules"))throw new Error("extraData.rules is missing");if(p.validateLevelRules(g.rules),!Fw.has(E,"time"))throw new Error("extraData.time is missing");if(!Fm.isNumber(g.time))throw new Error("extraData.time ".concat(g.time," must be a number"))}})}},{key:"validateFen",value:function(p){if(!Fm.isObject(p))throw new Error("extraData.fen ".concat(p," must be a record of string keys"));var v=this.validateKeys(p,FC);if(!Fm.isNumber(v.idSize))throw new Error("fen.idSize must be a number");if(!Fm.isString(v.code))throw new Error("fen.code must be a string");if(!Fm.isNumber(v.rows))throw new Error("fen.rows must be a number");if(!Fm.isNumber(v.cols))throw new Error("fen.cols must be a number");if(!Fm.isObject(v.encoding))throw new Error("fen.encoding must be a record of string keys");var g=this.validateKeys(v.encoding,Fb.vals(lW));Object.entries(g).forEach(function(p){var v=Ue(p,2),g=v[0],E=v[1];if(!Fm.isString(E))throw new Error("fen.encoding.".concat(g," ").concat(E," must be a string"))})}},{key:"validateLevelRules",value:function(p){if(!Fm.isObject(p))throw new Error("extraData.rules ".concat(p," must be a record of string keys"));var v=this.validateKeys(p,F_);if(!Fm.isNumber(v.addRandomTilesPerMove))throw new Error("rules.addRandomTilesPerMove must be a number");if(!Fm.isNumber(v.maxSpaceOfPair))throw new Error("rules.maxSpaceOfPair must be a number")}},{key:"validateKeys",value:function(p,v){return Object.keys(p).forEach(function(p){if(!Fw.has(v,p))throw new Error("Key ".concat(p," is missing"))}),p}}]),e}();g._RF.pop(),g._RF.push({},"d675ctpYslBHp4qqiYEki+q","PlayerManager",void 0);var FT=GameCore,FI=FT.Utils,FR=FI.Valid,FP=FI.Array,FN=FI.Object,FD=FT.Dtos,FL=globalThis.game.player,FO=function(){function e(){Ce(this,e)}return Ae(e,[{key:"init",value:function(){console.info("Player Manager: Initialized")}},{key:"setupDefaultGameData",value:function(){var p=FD.Player;p.Data.addDefaultData(o5),p.GameData.addDefaultData(o$),p.GameData.addValidateFunction("stars",function(p){if(!FR.isNumber(p)||p<0)throw new Error("stars ".concat(p," is invalid"))}),p.GameData.addValidateFunction("totalLevel",function(p){if(!FR.isNumber(p)||p<1)throw new Error("totalLevel ".concat(p," is invalid"))}),p.GameData.addValidateFunction("levelVersion",function(p){if(!FR.isNumber(p)||p<0)throw new Error("levelVersion ".concat(p," is invalid"))}),p.GameData.addValidateFunction("lastRewardedItems",function(p){if(!FR.isNumber(p)||p<0)throw new Error("lastRewardedItems ".concat(p," is invalid"))}),p.GameData.addValidateFunction("lastCreateTournamentShown",function(p){if(!FR.isNumber(p)||p<0)throw new Error("lastCreateTournamentShown ".concat(p," is invalid"))}),p.GameData.addValidateFunction("guideItemShowed",function(p){if(!Array.isArray(p))throw new Error("guideItemShowed ".concat(p," is invalid"))}),p.GameData.addValidateFunction("items",function(p){if(!FR.isObject(p))throw new Error("items ".concat(p," is invalid"));var v=Object.keys(p),g=FN.vals(p);if(!FP.has(v,oG.HINT))throw new Error("item ".concat(oG.HINT," not found"));if(!FP.has(v,oG.THUNDER))throw new Error("item ".concat(oG.THUNDER," not found"));if(!FP.has(v,oG.STORM))throw new Error("item ".concat(oG.STORM," not found"));if(!FP.has(v,oG.PLIERS))throw new Error("item ".concat(oG.PLIERS," not found"));g.forEach(function(p){if(!FR.isNumber(p)||p<0)throw new Error("item ".concat(p," is invalid"))})}),p.GameData.addValidateFunction("skins",function(p){if(!FR.isObject(p))throw new Error("skins ".concat(p," is invalid"))})}},{key:"requestConnectedPlayers",value:function(){FL.requestConnectedPlayers().catch(function(p){console.warn("player.requestConnectedPlayers",p)})}}]),e}();g._RF.pop(),g._RF.push({},"51079bCfn9MZK6cuxbahS7M","AdaptivePerformance",void 0);var FM=GameCore,Fx=FM.Events,FF=FM.Utils.Valid,FB=globalThis.game,FU=FB.event,Fz=FB.adaptivePerformance,FG=function(){function e(){var p=this;Ce(this,e),this.handleBeginFrame=function(){D.on(em.EVENT_AFTER_UPDATE,p.lateUpdate),D.on(em.EVENT_BEFORE_UPDATE,p.updateActualFPS)},this.handleAfterSceneLaunch=function(p){Fz&&Fz.trackingScene(p.name)},this.handleRequestResizeGame=function(p){var v=p.forcePixelRatio;FF.isNumber(v)&&ec.emit(ij,v)},this.lateUpdate=function(){var p=1e3*ec.deltaTime;null==Fz||Fz.updatePostStepDeltaTime(p)},this.updateActualFPS=function(){var p,v=null===(p=D.root)||void 0===p?void 0:p.fps;FF.isNumber(v)&&(null==Fz||Fz.updateActualFPS(v))}}return Ae(e,[{key:"init",value:function(){Fz&&this.listenEvents()}},{key:"listenEvents",value:function(){FU.on(Fx.REQUEST_RESIZE_GAME,this.handleRequestResizeGame),D.once(em.EVENT_BEGIN_FRAME,this.handleBeginFrame),D.on(em.EVENT_AFTER_SCENE_LAUNCH,this.handleAfterSceneLaunch)}}]),e}();g._RF.pop(),g._RF.push({},"0bbd4wf2fRDcKljBcls6K8a","CanvasRecorder",void 0);var FY=globalThis.game.canvasRecorder,Fj=function(){function e(){Ce(this,e)}return Ae(e,[{key:"init",value:function(){if(ec.canvas&&FY){FY.setCanvas(ec.canvas);var p=FY.getOptions(),v=FY.waitNextFrame;FY.waitNextFrame=Ee(function(){var g;return _ts_generator(this,function(E){switch(E.label){case 0:if(!p.syncFps)return[3,1];g=new Promise(function(p){D.once(em.EVENT_AFTER_RENDER,p),ec.pause(),ec.step()});return[3,3];case 1:ec.resume();return[4,v.call(FY)];case 2:g=(E.sent(),Promise.resolve());E.label=3;case 3:return[2,g]}})})}}}]),e}();g._RF.pop(),g._RF.push({},"4a29byVcRpBGogGcAwYASiP","CocosStats",void 0);var FH=function(){function e(){var p=this;Ce(this,e),this.hideCocosStats=function(){clearInterval(p.waiter),p.waiter=setInterval(p.checkProfilerReady,100)},this.checkProfilerReady=function(){if(ed){ed._showFPS=!1;var v=ed._rootNode;v&&(v.active=!1,v.isValid&&(v.destroyAllChildren(),v.removeAllChildren(),v.destroy(),clearInterval(p.waiter)))}}}return Ae(e,[{key:"init",value:function(){ed&&D.on(em.EVENT_BEFORE_SCENE_LAUNCH,this.hideCocosStats)}}]),e}();g._RF.pop(),g._RF.push({},"49a72YoKFFCKbOm5Xgp9R+k","DynamicAssets",void 0);var FV=GameCore,Fq=FV.Configs.GameEngine.DynamicAssets,FW=FV.Events,FK=FV.Utils.Array,FX=globalThis.game.event,FJ=[".png",".jpg",".jpeg",".webp"],FQ=function(){function e(){var p=this;Ce(this,e),this.useHighQuality=!1,this.upgradableAssets=new Map,this.requestUpdateDynamicAssets=function(){ec.emit(iQ)},this.collectUpgradableAssets=function(v){var g,E=We(v.output=v.input);try{for(E.s();!(g=E.n()).done;){var k=g.value;if(FK.has(FJ,k.ext)&&!p.upgradableAssets.has(k.uuid)){p.useHighQuality&&(k.url=p.replaceAssetUrl(k.url),k.requestUpgrade=!0);var C={uuid:k.uuid,url:k.url,options:k.options,upgraded:k.upgraded,requestUpgrade:k.requestUpgrade,ext:k.ext};p.upgradableAssets.set(k.uuid,C)}}}catch(p){E.e(p)}finally{E.f()}},this.replaceAssetUrl=function(v){return p.useHighQuality?v.replace("native/","native32/"):v},this.handleUpgradeQuality=function(){p.useHighQuality=!0;var v=0,g=0,E=eD.instance,k=E.assets,C=E.loadAny,_=0;p.upgradableAssets.forEach(function(E){if(E.upgraded||E.requestUpgrade)v++;else{g++;var A=k.get(E.uuid);_instanceof(A,Q)?(E.url=p.replaceAssetUrl(E.url),console.info("DynamicAssets: Process upgrade quality",E.uuid,E,A),C(E,E.options,function(v,k){_++,v?console.warn("DynamicAssets: Upgrade error",v):(A.reset(k),E.upgraded=!0,p.upgradableAssets.set(E.uuid,E),console.info("DynamicAssets: Upgrade done",E.uuid,k,A),_>=g&&p.requestUpdateDynamicAssets())})):console.warn("DynamicAssets: Asset not found",E.uuid)}}),console.warn("DynamicAssets: Upgradable Assets Info",{needUpgrade:g,upgraded:v,total:p.upgradableAssets.size})}}return Ae(e,[{key:"init",value:function(){var p=Fq.Enabled;console.info("DynamicAssets: init",{EDITOR:false,Enabled:p}),p&&(eD.instance.transformPipeline.insert(this.collectUpgradableAssets,3),this.listenEvents())}},{key:"listenEvents",value:function(){var p=this;ec.on(iJ,this.handleUpgradeQuality),FX.on(FW.SCENE_LAUNCHED,function(v){var g=v.sceneName,E=[o6];FK.has(E,g)||p.handleUpgradeQuality()})}}]),e}();g._RF.pop(),g._RF.push({},"15ecbqnx5lFtYRSJp2lOLCm","DynamicAtlas",void 0);var FZ=GameCore,F$=FZ.Configs.GameEngine.DynamicAtlas,F0=FZ.Utils.Array,F1=FZ.Events,F2=globalThis.game.event,F4=function(){function e(){var p=this;Ce(this,e),this.drawInfo=[],this.atlasInfo=null,this.lastRenderTime=0,this.updateRenderTime=function(){p.lastRenderTime=performance.now()},this.checkRenderTimeHighers=function(){var v=performance.now()-p.lastRenderTime;v>8&&(D.off(em.EVENT_AFTER_RENDER,p.checkRenderTimeHighers),console.warn("DynamicAtlas: Laggy frame detected, render time is ".concat(v.toFixed(2),"ms")),p.requestUpdateDynamicAtlas(),setTimeout(function(){D.on(em.EVENT_AFTER_RENDER,p.checkRenderTimeHighers)},2e3))},this.requestUpdateDynamicAtlas=function(){D.once(em.EVENT_AFTER_RENDER,p.updateDynamicAtlas)},this.updateDynamicAtlas=function(){var v=D.getScene();if(v){var g=v.getComponentsInChildren(eB),E=[],k={};g.forEach(function(p){if(p.enabled&&p.node.activeInHierarchy&&"spriteFrame"in p&&_instanceof(p.spriteFrame,Z)){var v=p.spriteFrame,g=v.uuid,C=v.packable,_=v.texture,A=v.original;if(C){if(_instanceof(_,eU)){var T=_.getId(),I=_.width,R=_.height,P=(null==A?void 0:A._texture)||{width:0,height:0},N=P.width,D=P.height;if(A){var L=A._texture.getId();if(T===L)return void console.warn("DynamicAtlas: Skip original texture",p.name,{ori:A._texture,tex:_});T=L}var O=A?N:I,M=A?D:R;if(O<=1||M<=1)console.warn("DynamicAtlas: Skip invalid texture size",p.name,{w:O,h:M});else{var x={id:T,w:O+=2,h:M+=2,x:-1,y:-1};k[T]?k[T].components.push(p):(E.push(x),k[T]=we(we({},x),{},{name:g,components:[p]}))}}else console.warn("DynamicAtlas: Skip non-texture2d texture",p.name)}else console.warn("DynamicAtlas: Skip non-packable texture",p.name)}}),console.info("DynamicAtlas: collect info",k),E.length<1||(console.info("DynamicAtlas: process textures",E),p.drawInfo=[],p.atlasInfo=null,p.generateDrawInfo(E),p.atlasInfo?(p.updateAtlasData(),p.refreshComponents(g)):console.warn("DynamicAtlas: Atlas info not found",{textures:E}))}},this.generateDrawInfo=function(v){if(!(v.length<1)){console.info("DynamicAtlas: generate draw info",v);var g=eL.instance.textureSize;if(p.calculateOptimizedAtlas(v,g),p.atlasInfo){var E=p.atlasInfo.textures;if(E.forEach(function(v){p.drawInfo.push(v)}),v.length>E.length){var k=v.filter(function(p){return!E.some(function(v){return v.id===p.id})});console.warn("DynamicAtlas: Missing textures",k),p.generateDrawInfo(k)}}else console.warn("DynamicAtlas: Atlas info not found",{textures:v})}},this.calculateOptimizedAtlas=function(v,g){var E=function(p){var v,g=0,E=0,k=We(p);try{for(k.s();!(v=k.n()).done;){var C=v.value;g+=C.w*C.h,E=Math.max(E,C.w)}}catch(p){k.e(p)}finally{k.f()}p.sort(function(p,v){return v.h-p.h});var _,A=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(g/.95)),E),h:1/0}],T=0,I=0,R=We(p);try{for(R.s();!(_=R.n()).done;)for(var P=_.value,N=A.length-1;N>=0;N--){var D=A[N];if(!(P.w>D.w||P.h>D.h)){if(P.x=D.x,P.y=D.y,I=Math.max(I,P.y+P.h),T=Math.max(T,P.x+P.w),P.w===D.w&&P.h===D.h){var L=A.pop();N<A.length&&(A[N]=L)}else P.h===D.h?(D.x+=P.w,D.w-=P.w):P.w===D.w?(D.y+=P.h,D.h-=P.h):(A.push({x:D.x+P.w,y:D.y,w:D.w-P.w,h:P.h}),D.y+=P.h,D.h-=P.h);break}}}catch(p){R.e(p)}finally{R.f()}return{w:T,h:I,fill:g/(T*I)||0}}(v),k=E.w,C=E.h,_=E.fill;k>g||C>g?v.pop()?p.calculateOptimizedAtlas(v,g):console.warn("DynamicAtlas: Texture size is too big",k,C,g):p.atlasInfo={textures:v,atlasSize:g,packedInfo:{width:k,height:C,fillRate:_}}},this.drawTexture=function(v,g,E){var k=g.texture,C=k.getId(),_=F0.search(He(p.drawInfo),function(p){return p.id===C})||{x:-1,y:-1},A=_.x,T=_.y;if(!(A<0||T<0)){var I=v._innerTextureInfos[C];I||(E&&(v._texture.drawTextureAt(k.image,A-1,T),v._texture.drawTextureAt(k.image,A+1,T),v._texture.drawTextureAt(k.image,A,T-1),v._texture.drawTextureAt(k.image,A,T+1)),v._texture.drawTextureAt(k.image,A,T),v._count++,v._innerTextureInfos[C]={texture:k,x:A,y:T});var R=g.rect,P=R.x,N=R.y;P+=(null==I?void 0:I.x)||A,N+=(null==I?void 0:I.y)||T;var D={texture:v._texture,x:P,y:N};return v._innerSpriteFrames.push(g),D}},this.refreshComponents=function(p){p.forEach(function(p){p.node.active&&(p.node.active=!1,p.node.active=!0)})}}return Ae(e,[{key:"init",value:function(){var p=F$.TextureAtlasOptimize;p&&(console.info("DynamicAtlas: init",{TextureAtlasOptimize:p}),this.listenEvents(),this.overrideDynamicAtlas())}},{key:"listenEvents",value:function(){F2.on(F1.SCENE_LAUNCHED,this.requestUpdateDynamicAtlas),ec.on(iQ,this.requestUpdateDynamicAtlas),D.on(em.EVENT_BEFORE_RENDER,this.updateRenderTime),D.on(em.EVENT_AFTER_RENDER,this.checkRenderTimeHighers)}},{key:"overrideDynamicAtlas",value:function(){var p=this,v=eL.instance;eL.instance.insertSpriteFrame=function(g){if(v._atlasIndex>=v._maxAtlasCount)return null;if(!g||g.original)return null;if(!g.packable)return null;var E=p.getAtlas(),k=E?E.insertSpriteFrame(g):null;return!k&&v._atlasIndex<v._maxAtlasCount?(E=p.getAtlas())?E.insertSpriteFrame(g):null:k}}},{key:"createAtlas",value:function(){return eL.instance.newAtlas()}},{key:"getAtlas",value:function(){var p=this,v=eL.instance,g=v._atlases,E=void 0===g?[]:g,k=v._atlasIndex,C=v.textureBleeding,_=E[k];return _||(_=this.createAtlas()),_.originalInsertSpriteFrame||(_.originalInsertSpriteFrame=_.insertSpriteFrame,_.insertSpriteFrame=function(v){return p.drawTexture(_,v,C)}),_}},{key:"updateAtlasData",value:function(){if(this.atlasInfo){console.info("DynamicAtlas: atlas info",this.atlasInfo);var p=this.atlasInfo.packedInfo;eL.instance.reset();var v=this.getAtlas();if(v){var g=p.width,E=p.height,k=Math.max(g,E);v._texture.initWithSize(k,k),console.info("DynamicAtlas: Resize texture",k,v._texture)}}}}]),e}();g._RF.pop();var F3={text:{level:"Level",settings:"SETTINGS",music:"Music",sound:"Sound",vibrate:"Vibrate",resume:"CONTINUE",on:"ON",off:"OFF",notification:"Notification",adsNotComplete:"Sorry, No Rewards!\nYou have cancelled the ad!",loadingAds:"Loading ads...",loading:"Loading...",load:"Loading",rewardNotReady:"No ads to display!",next:"NEXT",completed:"COMPLETED",tryAgain:"TRY AGAIN",retry:"RETRY",congratulation:"CONGRATULATION",you_have_pass_all_levels:"You have passed all levels.",please_come_back_later:"Please come back later,\nwe will update soon!",start_over:"START OVER",confirmation:"CONFIRMATION",are_you_sure_to_start_over:"ARE YOU SURE TO START OVER?",you_will_play_the_game_again:"You will play the game again\nfrom the beginning, at level 1.",no:"NO",yes:"YES"},texture:{image:"image"}};g._RF.push({},"14b76Yew19JgY7K+L9F5mmu","Languages",void 0);var F5=GameCore.Events,F6=globalThis.game,F9=F6.event,F8=F6.language,F7=function(){function e(){var p=this;Ce(this,e),this.handleLanguageChanged=function(){var v=Ee(function(v){var g;return _ts_generator(this,function(E){g=v.locale;ec.emit("update-language",g),p.updateComponentInEditor();return[2]})});return function(p){return v.apply(this,arguments)}}()}var p,g,E;return Ae(e,[{key:"init",value:function(){var p=this;this.addLanguage("en").then(function(){p.setLanguage("en"),p.listenEvent()})}},{key:"listenEvent",value:function(){F9.on(F5.LANGUAGE_CHANGED,this.handleLanguageChanged)}},{key:"addLanguage",value:(E=Ee(function(p){var v;return _ts_generator(this,function(g){switch(g.label){case 0:return[4,this.getLangData(p)];case 1:v=g.sent();F8.add(p,v);return[2]}})}),function(p){return E.apply(this,arguments)})},{key:"setLanguage",value:function(p){F8.choose(p)}},{key:"getLangData",value:(g=Ee(function(p){return _ts_generator(this,function(v){switch(p){case"en":return[2,F3];case"ru":return[2,this.loadLanguageAsync(p)];default:throw new Error("Language ".concat(p," not supported"))}return[2]})}),function(p){return g.apply(this,arguments)})},{key:"loadLanguageAsync",value:(p=Ee(function(p){var g;return _ts_generator(this,function(E){switch(E.label){case 0:return[4,v.import("db://assets/resources/locales/".concat(p,".json"))];case 1:g=E.sent().default;F8.add(p,g);return[2]}})}),function(v){return p.apply(this,arguments)})},{key:"updateComponentInEditor",value:function(){}}]),e}();g._RF.pop(),g._RF.push({},"fb33bK/6Y5FAas5AwmmBM/X","Leaderboards",void 0);var Bt=GameCore,Bn=Bt.Configs,Bi=Bn.Mockup,Ba=Bi.Leaderboards,Br=Bi.GameSDK.Player,Bo=Bn.Leaderboards,Bs=Bt.Utils.Number,Bl=globalThis.game.leaderboard,Bu=function(){function e(){var p=this;Ce(this,e),this.handleWhenGameSDKStarted=function(){Ba.Enabled?p.setupLeaderboardsMockup():p.setupLeaderboards()}}var p,v,g,E,k;return Ae(e,[{key:"init",value:function(){this.handleWhenGameSDKStarted()}},{key:"setupLeaderboards",value:(k=Ee(function(){return _ts_generator(this,function(p){this.setupLeaderboardByConfigs();return[2]})}),function(){return k.apply(this,arguments)})},{key:"setupLeaderboardByConfigs",value:function(){var p=Bo.LeaderboardId;p?(Bl.addLeaderboard({name:o0,type:"global",autoSortRank:!0,leaderboardId:p}),Bl.addLeaderboard({name:o1,type:"friends",autoSortRank:!0,leaderboardId:p})):console.warn("LeaderboardId in Configs is not set")}},{key:"setupLeaderboardsMockup",value:(E=Ee(function(){return _ts_generator(this,function(p){this.setupMockGlobalLeaderboard(),this.setupMockFriendsLeaderboard(),this.setupMockGlobalTournamentLeaderboard();return[2]})}),function(){return E.apply(this,arguments)})},{key:"setupMockGlobalLeaderboard",value:(g=Ee(function(){var p,v,g,E;return _ts_generator(this,function(k){switch(k.label){case 0:p=o0,v=o2;return[4,Bl.createLeaderboardAsync({_id:v,name:p,numberOfLeaders:100})];case 1:g=k.sent();Bl.addLeaderboard({name:p,type:"global",autoSortRank:!0,leaderboardId:g});return[4,Bl.requestLeaderboardAsync(p,10)];case 2:k.sent();E=Bl.getLeaderboard(p);console.info("setupGlobalLeaderboard fetch new",E,E&&Object.keys(E.leaders).length),E=Bl.getLeaderboard(p),console.info("setupGlobalLeaderboard load more",E,E&&Object.keys(E.leaders).length);return[2]}})}),function(){return g.apply(this,arguments)})},{key:"setupMockFriendsLeaderboard",value:(v=Ee(function(){var p,v,g,E,k,C;return _ts_generator(this,function(_){switch(_.label){case 0:p=o1,v=o4,g=0,E=Br.ConnectedPlayers;E.Enabled&&(g=Bs.random(E.NumOfPlayers));return[4,Bl.createLeaderboardAsync({_id:v,name:p,numberOfLeaders:g})];case 1:k=_.sent();Bl.addLeaderboard({name:p,type:"friends",autoSortRank:!0,leaderboardId:k});return[4,Bl.requestLeaderboardAsync(p,10)];case 2:_.sent();C=Bl.getLeaderboard(p);console.info("setupFriendsLeaderboard done",C);return[2]}})}),function(){return v.apply(this,arguments)})},{key:"setupMockGlobalTournamentLeaderboard",value:(p=Ee(function(){var p;return _ts_generator(this,function(v){switch(v.label){case 0:return[4,ll.requestTournamentDataAsync()];case 1:p=v.sent();p.forEach(function(p){var v=p.payload.leaderboardId;v&&(Bl.isExistLeaderboardId(v)||Bl.addLeaderboard({type:"tournament",name:v,autoSortRank:!0,leaderboardId:v}))}),console.info("setupGlobalTournamentLeaderboard done",p);return[2]}})}),function(){return p.apply(this,arguments)})}]),e}();g._RF.pop(),g._RF.push({},"e7bf73g4jJGuI9FqvW5YBsS","PerformanceMonitor",void 0);var Bd=GameCore,Bp=Bd.Configs.PerformanceMonitor,Bf=Bd.Utils,By=Bd.Events,Bv=globalThis.game.event,Bg=function(){function e(){var p=this;Ce(this,e),this.markName="FPS Tracking",this.handleStartTraceFps=function(){p.startTraceFps()},this.handleLateUpdate=function(){if(p.mark){if(p.fpsTraceDuration-=ec.deltaTime,p.fpsTraceDuration<=0&&!p.traceStopped)return p.traceStopped=!0,p.unListenEvents(),p.updateFPS(),void p.mark.stop(p.markName);p.fpsTraceIntervalTimer-=ec.deltaTime,p.fpsTraceIntervalTimer>0||(p.fpsTraceIntervalTimer=p.fpsTraceInterval,p.updateFPS(),p.mark.stop(p.markName),p.startTraceFps())}}}return Ae(e,[{key:"mark",get:function(){return Bp.FpsTracking?Bf.Mark:null}},{key:"init",value:function(){var p=Bp.FpsTracking,v=p.TrackingDuration,g=p.TrackingInterval;this.fpsTraceDuration=null!=v?v:60,this.fpsTraceInterval=null!=g?g:10,this.fpsTraceIntervalTimer=this.fpsTraceInterval,this.traceStopped=!1,this.listenEvents()}},{key:"listenEvents",value:function(){Bv.once(By.GAME_READY,this.handleStartTraceFps),D.on(em.EVENT_AFTER_UPDATE,this.handleLateUpdate)}},{key:"unListenEvents",value:function(){D.off(em.EVENT_AFTER_UPDATE,this.handleLateUpdate)}},{key:"startTraceFps",value:function(){this.mark&&(this.mark.measure(this.markName),this.mark.start(this.markName))}},{key:"updateFPS",value:function(){var p,v;if(this.mark){var g=this.getFPS(),E=this.getDrawCalls(),k=this.getDeviceRender(),C=this.getTextureMemory();this.minFps=Math.min(null!==(p=this.minFps)&&void 0!==p?p:g,g),this.maxFps=Math.max(null!==(v=this.maxFps)&&void 0!==v?v:0,g),this.mark.putMetric(this.markName,"FPS Metric",g),this.mark.putAttr(this.markName,"Page Title",document.title),this.mark.putAttr(this.markName,"Device Render",k),this.mark.putAttr(this.markName,"Draw Calls",E.toString()),this.mark.putAttr(this.markName,"Texture Memory",C.toFixed(2)),this.mark.putAttr(this.markName,"Min FPS",this.minFps.toString()),this.mark.putAttr(this.markName,"Max FPS",this.maxFps.toString()),console.info("FPS: ".concat(g," Min: ").concat(this.minFps," Max: ").concat(this.maxFps,", draw calls: ").concat(E,", texture memory: ").concat(C.toFixed(2),"MB"))}}},{key:"getFPS",value:function(){if(!D.root)return 0;var p=D.root.fps;return Math.floor(p)||0}},{key:"getDrawCalls",value:function(){return D.root&&D.root.device.numDrawCalls||0}},{key:"getDeviceRender",value:function(){return D.root&&D.root.device.renderer||"Unknown"}},{key:"getTextureMemory",value:function(){return D.root&&D.root.device.memoryStatus.textureSize/1048576||0}}]),e}();g._RF.pop(),g._RF.push({},"58248LBip1DBrMjK0UWw2rM","RemoteConfig",void 0);var Bm=GameCore.Events,Bb=globalThis.game.event,Bw=function(){function e(){Ce(this,e),this.handleHotReload=function(){ec.restart()},this.handleUpdateConfig=function(p){if("Gameplay"===p.type){ec.emit(iV,p.config);var v=p.id,g=p.type;Bb.emit(Bm.REMOTE_CONFIG_UPDATED,{id:v,type:g})}}}return Ae(e,[{key:"init",value:function(){this.listenEvents()}},{key:"listenEvents",value:function(){Bb.on(Bm.REQUEST_HOT_RELOAD,this.handleHotReload),Bb.on(Bm.REQUEST_UPDATE_CONFIG,this.handleUpdateConfig)}}]),e}();g._RF.pop(),g._RF.push({},"c34a93D1BREiKms1T21AkQS","PluginsManager",void 0);var BS=function(){function e(){Ce(this,e)}return Ae(e,[{key:"init",value:function(){console.info("Plugins Manager: Initialized"),this.initCocosStats(),this.initDynamicAtlas()}},{key:"initLanguages",value:function(){(new F7).init()}},{key:"initCocosStats",value:function(){(new FH).init()}},{key:"initLeaderboards",value:function(){(new Bu).init()}},{key:"initRemoteConfig",value:function(){(new Bw).init()}},{key:"initDynamicAtlas",value:function(){(new F4).init()}},{key:"initDynamicAssets",value:function(){(new FQ).init()}},{key:"initCanvasRecorder",value:function(){(new Fj).init()}},{key:"initPerformanceMonitor",value:function(){(new Bg).init()}},{key:"initAdaptivePerformance",value:function(){(new FG).init()}}]),e}();g._RF.pop(),g._RF.push({},"ac8b03T+rFB061sXoEEsCUH","SceneManager",void 0);var BE=globalThis.game,Bk=BE.event,BC=BE.monitorError,B_=GameCore,BA=B_.Events,BT=B_.Configs.PerformanceMonitor,BI=B_.Utils.Mark,BR=function(){function e(){var p=this;Ce(this,e),this.markName="Load Scene",this.queueLoadScene={},this.callbackSwitchScene=null,this.switchScene=function(){var v=Ee(function(v){var g,E,k;return _ts_generator(this,function(C){g=v.sceneName,E=v.sceneData,k=p.correctSceneName(g);console.info("Switching",k,null!=E?E:{}),k&&(s8.showLoadingFullScreen(k),p.startScene({sceneName:k,sceneData:E}));return[2]})});return function(p){return v.apply(this,arguments)}}(),this.preloadScene=function(v,g){var E=v.sceneName;p.startMeasure(E),D.preloadScene(E,p.onSceneProgress,p.onScenePreloaded(E,g))},this.startMeasure=function(v){p.mark&&(p.queueLoadScene[v]&&(p.mark.putAttr(p.markName,"Canceled","true"),p.stopMeasure(v)),console.groupCollapsed("\uD83D\uDCE6 Load scene progress"),p.mark.measure(p.markName),p.mark.putAttr(p.markName,"Cancel","false"),p.mark.putAttr(p.markName,"Success","false"),p.mark.putMetric(p.markName,v),p.mark.start(p.markName),p.queueLoadScene[v]=!0)},this.stopMeasure=function(v){p.mark&&p.queueLoadScene[v]&&(p.mark.rmAttr(p.markName,"File"),p.mark.putAttr(p.markName,"Success","true"),p.mark.stop(p.markName),p.queueLoadScene[v]=!1,console.groupEnd())},this.onSceneProgress=function(v,g,E){var k=v/g;p.mark&&p.mark.putAttr(p.markName,"Last File","".concat(E.id," (").concat(E.ext,")"));var C=Math.floor(70*k+30);GameSDK.setLoadingProgress(C)},this.onScenePreloaded=function(p,v){return function(g){g?console.warn("SceneManager.onScenePreloaded",{sceneName:p,error:g}):(v&&v(p,g),Bk.emit(BA.SCENE_LOADED,{sceneName:p,isPreload:!0}))}},this.onDirectorLoadScene=function(v){return function(g,E){if(g)console.warn("SceneManager.onSceneLoaded",g);else if(null!=E&&E.scene){var k=E.name;p.handleBeforeSceneLaunch(E,v)(),D.once(em.EVENT_AFTER_SCENE_LAUNCH,p.handleSceneLaunched(k,v))}else console.warn("SceneManager.onSceneLoaded","Scene not found")}},this.handleBeforeSceneLaunch=function(v,g){return function(){p.setSceneData(v,null!=g?g:{}),ec.emit(ij),Bk.emit(BA.SCENE_LOADED,{sceneName:v.name})}},this.handleSceneLaunched=function(v,g){return function(){var E;s8.hideLoadingFullScreen(v),nJ.switchSceneTracking(),null==BC||BC.addMetadata({currentScene:v}),null===(E=p.callbackSwitchScene)||void 0===E||E.call(p,{sceneName:v,sceneData:g}),Bk.emit(BA.SCENE_LAUNCHED,{sceneName:v})}},this.handleSceneLoaded=function(v){var g=v.sceneName;p.stopMeasure(g)}}return Ae(e,[{key:"init",value:function(){this.listenEvents(),console.info("Scene Manager: Initialized")}},{key:"listenEvents",value:function(){Bk.on(BA.SWITCH_SCENE,this.switchScene),Bk.on(BA.PRELOAD_SCENE,this.preloadScene),Bk.on(BA.SCENE_LOADED,this.handleSceneLoaded)}},{key:"correctSceneName",value:function(p){var v=this.getCurrentScene();return v&&p===v.name?null:p}},{key:"startScene",value:function(p){var v=this,g=p.sceneName,E=p.sceneData;this.preloadScene({sceneName:g},function(p,k){p===g&&(k?console.warn("SceneManager.startScene",{sceneName:g,error:k}):D.loadScene(g,v.onDirectorLoadScene(E)))})}},{key:"mark",get:function(){return BT.LoadResources?BI:null}},{key:"getCurrentScene",value:function(){return D.getScene()}},{key:"getLoadedScenes",value:function(){var p=this,v=[];return Object.keys(this.queueLoadScene).map(function(g){p.queueLoadScene[g]||v.push(g)}),v}},{key:"onSwitchScene",value:function(p){this.callbackSwitchScene=p}},{key:"setSceneData",value:function(p,v){if(v&&("data"in p||p.scene.attr({data:{}}),"data"in p)){var g=p.data||{};p.scene.attr({data:we(we({},g),v)}),console.info("SceneManager.setSceneData",{sceneName:p.name,sceneData:v,currentData:g})}}}]),e}();g._RF.pop(),g._RF.push({},"617b2SRAL5CyL75C998xBnx","ScreenManager",void 0);var BP=globalThis.game,BN=BP.event,BD=BP.monitorError,BL=GameCore,BO=BL.Events,BM=BL.Utils.Object,Bx=function(){function e(){var p=this;Ce(this,e),this.screens={},this.handleOpenScreen=function(v){var g=v.screenName,E=v.screenData;p.openScreen(g,E)},this.handleCloseScreen=function(v){var g=v.screenName;p.closeScreen(g)}}var p,v,g,E;return Ae(e,[{key:"init",value:function(){this.listenEvents(),console.info("Screen Manager: Initialized")}},{key:"listenEvents",value:function(){BN.on(BO.OPEN_SCREEN,this.handleOpenScreen),BN.on(BO.CLOSE_SCREEN,this.handleCloseScreen)}},{key:"reorderScreens",value:function(){var p=BM.vals(this.screens).filter(function(p){return"ready"===p.state});p.sort(function(p,v){return p.order-v.order});for(var v=0;v<p.length;v++){var g=p[v];g.order=v,g.comp.node.setSiblingIndex(g.order)}}},{key:"addScreenKeys",value:function(p,v){var g=this;p.forEach(function(p,E){g.screens[nV[p]]&&(g.screens[nV[p]].order=E),g.screens[nV[p]]={state:"key",parent:v,key:p,order:E}})}},{key:"addScreens",value:function(p){var v=this;p.forEach(function(p,g){v.screens[p.node.name]={state:"ready",comp:p,order:g}})}},{key:"preloadScreens",value:(E=Ee(function(){var p;return _ts_generator(this,function(v){switch(v.label){case 0:p=BM.vals(this.screens).reduce(function(p,v){if("key"===v.state){var g=nP.loadPrefabAsync("screens/".concat(nV[v.key]));p.push(g)}return p},[]);return[4,Promise.all(p)];case 1:return[2,v.sent()]}})}),function(){return E.apply(this,arguments)})},{key:"getScreen",value:(g=Ee(function(p){var v,g,E,k,C,_,A;return _ts_generator(this,function(I){switch(I.label){case 0:v=this.screens[p];if(null==v)return[2,(null==BD||BD.sendException(new Error("ScreenManager.openScreen Screen ".concat(p," not found")),{screenName:p,screens:this.getScreensAsMetadata()}),null)];if("ready"===v.state)return[2,v.comp];console.info("ScreenManager.getScreen","Screen ".concat(p," not found in cache, instantiating it..."));g=v.parent,E=v.key,k=v.order;return[4,nP.loadPrefabAsync("screens/".concat(nV[E]))];case 1:C=I.sent();if(!C)return[2,(null==BD||BD.sendException(new Error("ScreenManager.getScreen: Failed to load Screen ".concat(p," prefab...")),{screenName:p,screens:this.getScreensAsMetadata()}),null)];_=T(C);_.name=p,g.addChild(_),_.active=!1;A=_.getComponent(PR);return[2,A?(this.screens[p]={state:"ready",comp:A,order:k},this.reorderScreens(),A):(null==BD||BD.sendException(new Error("ScreenManager.getScreen: Screen ".concat(p," prefab doesn't have BaseScreen component...")),{screenName:p,screens:this.getScreensAsMetadata()}),null)]}})}),function(p){return g.apply(this,arguments)})},{key:"getScreensAsMetadata",value:function(){var p=this;return Object.keys(this.screens).map(function(v){var g=p.screens[v];return"ready"===g.state?"".concat(g.comp.node.name,"(loaded)"):"".concat(nV[g.key],"(notloaded)")}).join(", ")}},{key:"clearScreens",value:function(){this.screens={}}},{key:"openScreen",value:(v=Ee(function(p,v){var g,E,k;return _ts_generator(this,function(C){switch(C.label){case 0:C.trys.push([0,3,,4]);nP.setBlockInput(!0);return[4,this.getScreen(p)];case 1:g=C.sent();if(nP.setBlockInput(!1),null==g||!g.node)return[2,void console.warn("ScreenManager.openScreen","Screen ".concat(p," not found"))];g.node.active=!0,g.node.setPosition(new ef(0,0,0));E={screenName:p,screenData:v};BN.emit(BO.OPENING_SCREEN,E),nJ.trackCurrentPage(p,!0),null==BD||BD.addMetadata({currentScreen:p});return[4,tJ.waitTweenAsync(0)];case 2:C.sent(),g.open(v),BN.emit(BO.OPENED_SCREEN,E);return[3,4];case 3:k=C.sent();console.error("ScreenManager.openScreen",k);return[3,4];case 4:return[2]}})}),function(p,g){return v.apply(this,arguments)})},{key:"closeScreen",value:(p=Ee(function(p){var v,g,E,k;return _ts_generator(this,function(C){switch(C.label){case 0:C.trys.push([0,2,,3]);return[4,this.getScreen(p)];case 1:g=C.sent();if(!g)return[2,void console.warn("ScreenManager.closeScreen","Screen ".concat(p," not found"))];if(null===(v=g.node)||void 0===v||!v.active)return[2];E={screenName:p};BN.emit(BO.CLOSING_SCREEN,E),g.close(),nJ.trackCurrentPage(p,!1),null==BD||BD.removeMetadata("currentScreen");return[3,3];case 2:k=C.sent();console.error("ScreenManager.closeScreen",k);return[3,3];case 3:return[2]}})}),function(v){return p.apply(this,arguments)})},{key:"closeAllScreens",value:function(){var p=this;Object.keys(this.screens).forEach(function(v){"ready"===p.screens[v].state&&p.closeScreen(v)})}}]),e}();g._RF.pop(),g._RF.push({},"a851bnZR1RCUILrjMPf7nMm","CorecosSystem",void 0);var BF=GameCore,BB=BF.Configs.Core,BU=BF.Events,Bz=BF.Plugins.Analytics.Events,BG=globalThis.game,BY=BG.context,Bj=BG.storage,BH=BG.event,BV=BG.analytics,Bq=BG.monitorError;new(function(){function e(){var p=this;Ce(this,e),this.coreManager=new x7,this.matchManager=new FA,this.sceneManager=new BR,this.screenManager=new Bx,this.engineManager=new Fa,this.layoutManager=new Fy,this.playerManager=new FO,this.pluginsManager=new BS,this.handleWhenCoreBoot=function(){ec.inited?p.handleCocosInit():ec.once(ez.EVENT_POST_PROJECT_INIT,p.handleCocosInit)},this.handleCocosInit=function(){p.coreManager.requestStart()},this.handleWhenCoreStart=function(){p.playerManager.setupDefaultGameData(),p.matchManager.setupDefaultMatchData(),console.groupEnd()},this.handleWhenCoreReady=function(){p.initPlugins(),console.groupEnd(),BB.StartSDKAfterLoadGame?BH.once(BU.SCENE_LOADED,p.handleStartGameWhenMainSceneReady):p.processStartGame(),p.preloadScenes()},this.handleStartGameWhenMainSceneReady=function(){p.processStartGame()},this.handleSwitchScene=function(v){var g=v.sceneName,E=p.sceneManager.getCurrentScene();if((null==E?void 0:E.name)===g){p.screenManager.closeAllScreens(),p.screenManager.clearScreens();var k=null==E?void 0:E.getComponentsInChildren(PR);if(k.length>0){var C=k.map(function(p){return p.node.name}).join(", ");console.info("\uD83D\uDCFA Loaded Screens in ".concat(g,": ").concat(C)),p.screenManager.addScreens(k)}var _=null==E?void 0:E.getComponentInChildren(P$);if(_){var A=_.screenKeys.filter(function(p){return!k.some(function(v){return v.node.name===nV[p]})});if(0!==A.length){var T=A.map(function(p){return nV[p]}).join(", ");console.info("\uD83D\uDCFA Lazy-loading Screens in ".concat(g,": ").concat(T)),p.screenManager.addScreenKeys(A,_.node),p.screenManager.preloadScreens()}}}},console.groupCollapsed("\uD83D\uDCE6 Corecos System"),console.info("Corecos Initializing..."),this.listenEvents(),this.initManagers(),console.groupEnd()}var p,v;return Ae(e,[{key:"initManagers",value:function(){this.coreManager.init(),this.engineManager.init(),this.layoutManager.init(),this.sceneManager.init(),this.screenManager.init(),this.playerManager.init(),this.matchManager.init(),this.pluginsManager.init()}},{key:"listenEvents",value:function(){this.coreManager.onCoreBoot(this.handleWhenCoreBoot),this.coreManager.onCoreStart(this.handleWhenCoreStart),this.coreManager.onCoreReady(this.handleWhenCoreReady),this.sceneManager.onSwitchScene(this.handleSwitchScene)}},{key:"preloadScenes",value:function(){"solo"===Bj.getStorageData("context","sessionContextType")?sq.preloadDashboardScene():sq.preloadGameScene()}},{key:"processStartGame",value:(v=Ee(function(){return _ts_generator(this,function(p){switch(p.label){case 0:console.groupEnd(),BV.event(Bz.LOAD_COMPLETE);return[4,this.startGameAsync()];case 1:p.sent(),this.startProcessContextData(),this.playerManager.requestConnectedPlayers(),BV.event(Bz.APP_READY,{success:!0}),BH.emit(BU.GAME_READY);return[2]}})}),function(){return v.apply(this,arguments)})},{key:"startGameAsync",value:(p=Ee(function(){var p;return _ts_generator(this,function(v){switch(v.label){case 0:v.trys.push([0,2,,3]);return[4,GameSDK.startGameAsync()];case 1:v.sent(),BV.event(Bz.GAME_SDK_READY,{success:!0});return[3,3];case 2:p=v.sent();console.warn("GameSDK.startGameAsync",p),BV.event(Bz.GAME_SDK_READY,{success:!1}),_instanceof(p,Error)&&(null==Bq||Bq.sendException(p));return[3,3];case 3:return[2]}})}),function(){return p.apply(this,arguments)})},{key:"startProcessContextData",value:function(){BH.getEventEmitCount(BU.PLAYER_INFO_LOADED)?BY.processContextData().catch(function(p){console.error("startProcessContextData",p)}):BH.once(BU.PLAYER_INFO_LOADED,this.startProcessContextData)}},{key:"initPlugins",value:function(){this.pluginsManager.initLeaderboards(),this.pluginsManager.initDynamicAssets(),this.pluginsManager.initCanvasRecorder(),this.pluginsManager.initPerformanceMonitor(),this.pluginsManager.initAdaptivePerformance()}}]),e}()),g._RF.pop()}}});(function(p){p("virtual:///prerequisite-imports/start-scene","chunks:///start-scene.js")})(function(p,v){System.register(p,[v],function(p,v){return{setters:[function(v){var g={};for(var E in v)if("default"!==E&&"__esModule"!==E)g[E]=v[E];p(g)}],execute:function(){}}})});