System.register("chunks:///start-scene.js",["cc"],(function(e,t){var i,n,a,s,o,r,l,c,h,d,u,p,m,g,y,b,f,w,S,v,C,E,T,A,R,I,P,_,L,D,O,N,M,k,x,F,B,z,U,G,H,V,q,W,K,Y,j,X,$,J,Q,Z,ee,te,ie,ne,ae,se,oe,re,le,ce,he,de,ue,pe,me,ge,ye,be,fe,we,Se;return{setters:[function(e){i=e.cclegacy,n=e.Node,a=e._decorator,s=e.Component,o=e.Color,r=e.Canvas,l=e.UITransform,c=e.instantiate,h=e.Label,d=e.RichText,u=e.Toggle,p=e.Button,m=e.director,g=e.isCCObject,y=e.Animation,b=e.CCString,f=e.CCInteger,w=e.AudioSource,S=e.resources,v=e.AudioClip,C=e.tween,E=e.CCFloat,T=e.Layout,A=e.Widget,R=e.Sprite,I=e.ccenum,P=e.find,_=e.Prefab,L=e.JsonAsset,D=e.AnimationClip,O=e.ImageAsset,N=e.SpriteFrame,M=e.Enum,k=e.easing,x=e.UIOpacity,F=e.view,B=e.screen,z=e.math,U=e.EventHandler,G=e.animation,H=e.CCBoolean,V=e.Input,q=e.Graphics,W=e.game,K=e.profiler,Y=e.sys,j=e.Vec3,X=e.ProgressBar,$=e.Font,J=e.Vec2,Q=e.Director,Z=e.Layers,ee=e.randomRangeInt,te=e.pseudoRandomRangeInt,ie=e.pseudoRandom,ne=e.randomRange,ae=e.Pool,se=e.ParticleSystem2D,oe=e.HorizontalTextAlignment,re=e.Tween,le=e.View,ce=e.ScrollView,he=e.lerp,de=e.Mask,ue=e.settings,pe=e.Settings,me=e.AssetManager,ge=e.DynamicAtlasManager,ye=e.macro,be=e.ResolutionPolicy,fe=e.UIRenderer,we=e.Texture2D,Se=e.Game}],execute:function(){function e(e,t,i,n){i&&Object.defineProperty(e,t,{enumerable:i.enumerable,configurable:i.configurable,writable:i.writable,value:i.initializer?i.initializer.call(n):void 0})}function ve(e,t,i,n,a){var s={};return Object.keys(n).forEach((function(e){s[e]=n[e]})),s.enumerable=!!s.enumerable,s.configurable=!!s.configurable,("value"in s||s.initializer)&&(s.writable=!0),s=i.slice().reverse().reduce((function(i,n){return n(e,t,i)||i}),s),a&&void 0!==s.initializer&&(s.value=s.initializer?s.initializer.call(a):void 0,s.initializer=void 0),void 0===s.initializer&&(Object.defineProperty(e,t,s),s=null),s}var Ce,Ee,Te,Ae,Re,Ie,Pe,_e,Le;i._RF.push({},"b2bd1+njXxJxaFY3ymm06WU","debug-view-runtime-control",void 0);const{ccclass:De,property:Oe}=a;Ce=De("internal.DebugViewRuntimeControl"),Ee=Oe(n),Te=Oe(n),Ae=Oe(n),Ce((Pe=ve((Ie=class extends s{constructor(){super(...arguments),e(this,"compositeModeToggle",Pe,this),e(this,"singleModeToggle",_e,this),e(this,"EnableAllCompositeModeButton",Le,this),this._single=0,this.strSingle=["No Single Debug","Vertex Color","Vertex Normal","Vertex Tangent","World Position","Vertex Mirror","Face Side","UV0","UV1","UV Lightmap","Project Depth","Linear Depth","Fragment Normal","Fragment Tangent","Fragment Binormal","Base Color","Diffuse Color","Specular Color","Transparency","Metallic","Roughness","Specular Intensity","IOR","Direct Diffuse","Direct Specular","Direct All","Env Diffuse","Env Specular","Env All","Emissive","Light Map","Shadow","AO","Fresnel","Direct Transmit Diffuse","Direct Transmit Specular","Env Transmit Diffuse","Env Transmit Specular","Transmit All","Direct Internal Specular","Env Internal Specular","Internal All","Fog"],this.strComposite=["Direct Diffuse","Direct Specular","Env Diffuse","Env Specular","Emissive","Light Map","Shadow","AO","Normal Map","Fog","Tone Mapping","Gamma Correction","Fresnel","Transmit Diffuse","Transmit Specular","Internal Specular","TT"],this.strMisc=["CSM Layer Coloration","Lighting With Albedo"],this.compositeModeToggleList=[],this.singleModeToggleList=[],this.miscModeToggleList=[],this.textComponentList=[],this.labelComponentList=[],this.textContentList=[],this._currentColorIndex=0,this.strColor=["<color=#ffffff>","<color=#000000>","<color=#ff0000>","<color=#00ff00>","<color=#0000ff>"],this.color=[o.WHITE,o.BLACK,o.RED,o.GREEN,o.BLUE]}start(){if(!this.node.parent.getComponent(r))return void console.error("debug-view-runtime-control should be child of Canvas");const e=this.node.parent.getComponent(l),t=.5*e.width,i=.5*e.height;let n=.1*t-t,a=i-.1*i;const s=this.node.getChildByName("MiscMode"),m=c(s);m.parent=this.node,m.name="Buttons";const g=c(s);g.parent=this.node,g.name="Titles";for(let e=0;e<2;e++){const t=c(this.EnableAllCompositeModeButton.getChildByName("Label"));t.setPosition(n+(e>0?450:150),a,0),t.setScale(.75,.75,.75),t.parent=g;const i=t.getComponent(h);i.string=e?"----------Composite Mode----------":"----------Single Mode----------",i.color=o.WHITE,i.overflow=0,this.labelComponentList[this.labelComponentList.length]=i}a-=20;let y=0;for(let e=0;e<this.strSingle.length;e++,y++){e===this.strSingle.length>>1&&(n+=200,y=0);const t=e?c(this.singleModeToggle):this.singleModeToggle;t.setPosition(n,a-20*y,0),t.setScale(.5,.5,.5),t.parent=this.singleModeToggle.parent;const i=t.getComponentInChildren(d);i.string=this.strSingle[e],this.textComponentList[this.textComponentList.length]=i,this.textContentList[this.textContentList.length]=i.string,t.on(u.EventType.TOGGLE,this.toggleSingleMode,this),this.singleModeToggleList[e]=t}n+=200,this.EnableAllCompositeModeButton.setPosition(n+15,a,0),this.EnableAllCompositeModeButton.setScale(.5,.5,.5),this.EnableAllCompositeModeButton.on(p.EventType.CLICK,this.enableAllCompositeMode,this),this.EnableAllCompositeModeButton.parent=m;let b=this.EnableAllCompositeModeButton.getComponentInChildren(h);this.labelComponentList[this.labelComponentList.length]=b;const f=c(this.EnableAllCompositeModeButton);f.setPosition(n+90,a,0),f.setScale(.5,.5,.5),f.on(p.EventType.CLICK,this.changeTextColor,this),f.parent=m,b=f.getComponentInChildren(h),b.string="TextColor",this.labelComponentList[this.labelComponentList.length]=b;const w=c(this.EnableAllCompositeModeButton);w.setPosition(n+200,a,0),w.setScale(.5,.5,.5),w.on(p.EventType.CLICK,this.hideUI,this),w.parent=this.node.parent,b=w.getComponentInChildren(h),b.string="Hide UI",this.labelComponentList[this.labelComponentList.length]=b,this.hideButtonLabel=b,a-=40;for(let e=0;e<this.strMisc.length;e++){const t=c(this.compositeModeToggle);t.setPosition(n,a-20*e,0),t.setScale(.5,.5,.5),t.parent=s;const i=t.getComponentInChildren(d);i.string=this.strMisc[e],this.textComponentList[this.textComponentList.length]=i,this.textContentList[this.textContentList.length]=i.string;t.getComponent(u).isChecked=!!e,t.on(u.EventType.TOGGLE,e?this.toggleLightingWithAlbedo:this.toggleCSMColoration,this),this.miscModeToggleList[e]=t}a-=150;for(let e=0;e<this.strComposite.length;e++){const t=e?c(this.compositeModeToggle):this.compositeModeToggle;t.setPosition(n,a-20*e,0),t.setScale(.5,.5,.5),t.parent=this.compositeModeToggle.parent;const i=t.getComponentInChildren(d);i.string=this.strComposite[e],this.textComponentList[this.textComponentList.length]=i,this.textContentList[this.textContentList.length]=i.string,t.on(u.EventType.TOGGLE,this.toggleCompositeMode,this),this.compositeModeToggleList[e]=t}}isTextMatched(e,t){let i=new String(e);const n=i.search(">");return-1===n?e===t:(i=i.substr(n+1),i=i.substr(0,i.search("<")),i===t)}toggleSingleMode(e){const t=m.root.debugView,i=e.getComponentInChildren(d);for(let e=0;e<this.strSingle.length;e++)this.isTextMatched(i.string,this.strSingle[e])&&(t.singleMode=e)}toggleCompositeMode(e){const t=m.root.debugView,i=e.getComponentInChildren(d);for(let n=0;n<this.strComposite.length;n++)this.isTextMatched(i.string,this.strComposite[n])&&t.enableCompositeMode(n,e.isChecked)}toggleLightingWithAlbedo(e){m.root.debugView.lightingWithAlbedo=e.isChecked}toggleCSMColoration(e){m.root.debugView.csmLayerColoration=e.isChecked}enableAllCompositeMode(e){const t=m.root.debugView;t.enableAllCompositeMode(!0);for(let e=0;e<this.compositeModeToggleList.length;e++){this.compositeModeToggleList[e].getComponent(u).isChecked=!0}let i=this.miscModeToggleList[0].getComponent(u);i.isChecked=!1,t.csmLayerColoration=!1,i=this.miscModeToggleList[1].getComponent(u),i.isChecked=!0,t.lightingWithAlbedo=!0}hideUI(e){const t=this.node.getChildByName("Titles"),i=!t.active;this.singleModeToggleList[0].parent.active=i,this.miscModeToggleList[0].parent.active=i,this.compositeModeToggleList[0].parent.active=i,this.EnableAllCompositeModeButton.parent.active=i,t.active=i,this.hideButtonLabel.string=i?"Hide UI":"Show UI"}changeTextColor(e){this._currentColorIndex++,this._currentColorIndex>=this.strColor.length&&(this._currentColorIndex=0);for(let e=0;e<this.textComponentList.length;e++)this.textComponentList[e].string=this.strColor[this._currentColorIndex]+this.textContentList[e]+"</color>";for(let e=0;e<this.labelComponentList.length;e++)this.labelComponentList[e].color=this.color[this._currentColorIndex]}onLoad(){}update(e){}}).prototype,"compositeModeToggle",[Ee],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),_e=ve(Ie.prototype,"singleModeToggle",[Te],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Le=ve(Ie.prototype,"EnableAllCompositeModeButton",[Ae],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Re=Ie));i._RF.pop(),i._RF.push({},"95972yG/ulEg4gycbc+QB5Y","ComponentUtils",void 0);const{Utils:{Array:Ne,Object:Me,Valid:ke}}=GameCore,xe=["cc.Mask","cc.Label","cc.Canvas","cc.Camera","cc.Layout","cc.Button","cc.Sprite","cc.Widget","cc.Renderer","cc.Animation","cc.UIOpacity"];class Fe{constructor(){this.validComponentCalled={}}static get inst(){return this._instance||(this._instance=new Fe),this._instance}static lazyValidateProperties(e){if(!(!(arguments.length>1&&void 0!==arguments[1])||arguments[1]))return;const{constructor:t}=e,{name:i}=t;if(!this.inst.validComponentCalled[i])try{this.inst.validateRequiredComponents(e),this.inst.validateRequiredProperties(e),this.inst.validateCustomProperties(e)}catch(t){e.enabled=!1,console.error(t)}finally{this.inst.validComponentCalled[i]=!0}}validateRequiredComponents(e){const{name:t,constructor:i}=e,n=this.getRequiredComponentNames(i);for(const i of n)if(!e.getComponent(i))throw new Error(`${t}: Missing required ${i} component`)}validateRequiredProperties(e){const{name:t,constructor:i}=e,n=this.getRequiredPropNames(i);for(const i of n){if(!Me.hasOwn(e,i))throw new Error(`${t}: Missing required ${i} property`);const n=this.getProperty(i,e);if(!g(n))throw new Error(`${t}: ${i} property is not a cc object`)}}validateCustomProperties(e){const{name:t}=e,i=this.getCustomPropNames(e);for(const n of i){if(!Me.hasOwn(e,n))throw new Error(`${t}: Missing required ${n} property`);const i=this.getProperty(n,e);if(!g(i))throw new Error(`${t}: ${n} property is not a cc object`)}}getProperty(e,t){if(!Me.hasOwn(t,e))return;const{value:i}=Object.getOwnPropertyDescriptor(t,e)??{};return i}getProps(e){if(!Me.hasOwn(e,"__props__"))return[];const{__props__:t}=e;return Array.isArray(t)?t:[]}getRequiredPropNames(e){return this.getProps(e).filter((t=>"node"!==t&&(!!Me.hasOwn(e,t)&&(!!g(e[t])&&t.indexOf("_")<0))))}getBaseComponentName(e){for(const t of xe){if(t.indexOf(e)>=0)return t}return e}getRequiredComponentNames(e){if(!Me.hasOwn(e,"_requireComponent"))return[];const{_requireComponent:t}=e;return Array.isArray(t)?t.map((e=>this.getBaseComponentName(e))):[]}getCustomPropNames(e){const t=Object.keys(e),i=this.getProps(e.constructor);return Ne.difference(t,i).filter((e=>e.indexOf("_")<0)).filter((t=>{if(!Me.hasOwn(e,t))return!1;const i=this.getProperty(t,e);return!(!ke.isObject(i)||!g(i))}))}}try{new Fe}catch(e){console.error("ComponentUtils",e)}var Be,ze,Ue,Ge,He,Ve,qe,We,Ke;i._RF.pop(),i._RF.push({},"60ac3vor0dMT5bXi8D3VSJN","BubbleAnimation",void 0);const{ccclass:Ye,property:je}=a,{Array:Xe}=GameCore.Utils;Be=Ye("BubbleAnimation"),ze=je(y),Ue=je(b),Ge=je(f),Be((qe=ve((Ve=class extends s{constructor(){super(...arguments),e(this,"animation",qe,this),e(this,"clipName",We,this),e(this,"repeat",Ke,this),this.currentRepeat=-1}__preload(){this.animation=this.getComponent(y),this.validateRequiredComponents()}validateRequiredComponents(){Fe.lazyValidateProperties(this)}play(){if(!this.animation)return;Xe.search(this.animation.clips,(e=>e?.name===this.clipName))?(this.currentRepeat=-1,this.animation.play(this.clipName)):console.warn(`BubbleAnimation: Animation component must have ${this.clipName} clip`)}onBubbleAnimationLoop(){this.animation&&-1!==this.repeat&&(this.currentRepeat++,this.currentRepeat>this.repeat&&this.animation.stop())}}).prototype,"animation",[ze],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),We=ve(Ve.prototype,"clipName",[Ue],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"Bubble"}}),Ke=ve(Ve.prototype,"repeat",[Ge],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return-1}}),He=Ve));i._RF.pop(),i._RF.push({},"cc0a5OvhdRCMZRZuRscaz+7","AudioPlayer",void 0);const{Plugins:{Audio:{BaseAudioPlayer:$e}}}=GameCore;class Je extends $e{constructor(e,t){super(e),this.audioSource=t}play(e){if(e){const{volume:t=1,loop:i=!1}=e;this.audioSource.volume=t,this.audioSource.loop=i}this.audioSource.play()}pause(){this.audioSource.pause()}resume(){this.audioSource.state===w.AudioState.PAUSED&&this.audioSource.play()}stop(){this.audioSource.stop()}setVolume(e){this.audioSource.volume=e}getAudioSource(){return this.audioSource}}i._RF.pop(),i._RF.push({},"8b5ecHv/+BJiorK1kiVbTcf","AudioChannel",void 0);const{Plugins:{Audio:{BaseChannelManager:Qe}},Utils:{Array:Ze}}=GameCore;class et extends Qe{constructor(e,t){super(t),this.allowMultipleTracking={},this.handleLoadedAudio=(e,t)=>{const i=this.node.addComponent(w);return i.clip=t,i.playOnAwake=!1,new Je(e,i)},this.node=e}playing(e){const t=this.getAudioClip(e)?.audioPlayer;return!!t&&t.getAudioSource().state===w.AudioState.PLAYING}async onLoadAudio(e,t){return new Promise(((t,i)=>{S.load(e,v,((n,a)=>{try{if(n)throw new Error(n.message);if(!this.node.isValid)return;const i=this.handleLoadedAudio(e,a);t(i)}catch(n){n instanceof Error?i(n):i(new Error("Audio load: Unknown error"))}}))}))}playWithRealConfig(e,t){if(this.isCanPlay(t)){if(t){const{volume:i=1,allowMultiple:n=!1}=t;if(t.volume=this.getVolume()*i,n){return void this.requestDuplicateAudioPlayer(e.getKey(),e.getAudioSource().clip,t).play(t)}}e.play(t)}}isCanPlay(e){if(e){const{checkList:t=[]}=e;if(t.some((e=>{const t=this.getAudioClip(e);if(t){return t.audioPlayer.getAudioSource().state===w.AudioState.PLAYING}return!1})))return!1}return!0}requestDuplicateAudioPlayer(e,t,i){const n=this.getDuplicateAudioFromPool(e);if(n){if(i){const{key:e}=n,{volume:t=1}=i;this.setAudioClip(e,{volume:t})}return n.audioPlayer}const a=`${e}_${this.allowMultipleTracking[e].currentPostFix}`,s=this.handleLoadedAudio(a,t);return this.allowMultipleTracking[e].list.push({audioPlayer:s,key:a}),this.allowMultipleTracking[e].currentPostFix+=1,this.setAudioClip(a,{audioPlayer:s,volume:1}),s}getDuplicateAudioFromPool(e){if(this.allowMultipleTracking[e]){const{list:t}=this.allowMultipleTracking[e],i=Ze.search(t,(e=>e.audioPlayer.getAudioSource().state!==w.AudioState.PLAYING));if(i)return i}else this.allowMultipleTracking[e]={currentPostFix:1,list:[]};return null}}i._RF.pop();var tt,it,nt,at,st;i._RF.push({},"1a025mmN7BL7r5cF6gWR4b/","Music",void 0);const{ccclass:ot,property:rt}=a,{audio:lt,player:ct}=globalThis.game;let ht=(tt=ot("Music"),it=rt(b),tt((st=ve((at=class extends s{constructor(){super(...arguments),e(this,"channelId",st,this),this.channel=null}__preload(){this.makePersistent(),this.channel=new et(this.node,this.channelId),lt.addChannel(this.channel)}makePersistent(){m.addPersistRootNode(this.node)}playing(e){return this.channel?.playing(e)??!1}play(e,t){this.isMusicEnable()&&(t?.loop||(t={...t,loop:!0}),lt.play(e,t,this.channelId))}isMusicEnable(){return!!ct.getPlayerSetting("music")}setVolume(e){lt.setVolume(e,this.channelId)}pause(e){lt.pause(e,this.channelId)}resume(e){this.isMusicEnable()&&lt.resume(e,this.channelId)}stop(e){lt.stop(e,this.channelId)}mute(e){e?lt.mute(this.channelId):lt.unmute(this.channelId)}}).prototype,"channelId",[it],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"global_music"}}),nt=at))||nt);var dt,ut,pt,mt,gt;i._RF.pop(),i._RF.push({},"1299a7X1XNNEKxSKMV6E5jQ","Sound",void 0);const{ccclass:yt,property:bt}=a,{audio:ft,player:wt}=globalThis.game;let St=(dt=yt("Sound"),ut=bt(b),dt((gt=ve((mt=class extends s{constructor(){super(...arguments),e(this,"channelId",gt,this),this.channel=null}__preload(){this.channel=new et(this.node,this.channelId),ft.addChannel(this.channel)}onLoad(){""===this.channelId&&(this.channelId=this.node.uuid)}makePersistent(){m.addPersistRootNode(this.node)}removePersistent(){m.removePersistRootNode(this.node)}play(e,t){this.isSoundEnable()&&ft.play(e,t,this.channelId)}isSoundEnable(){return!!wt.getPlayerSetting("sound")}setVolume(e){ft.setVolume(e,this.channelId)}pause(e){ft.pause(e,this.channelId)}resume(e){this.isSoundEnable()&&ft.resume(e,this.channelId)}stop(e){ft.stop(e,this.channelId)}stopAll(){ft.stopAll(this.channelId)}mute(e){e?ft.mute(this.channelId):ft.unmute(this.channelId)}}).prototype,"channelId",[ut],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),pt=mt))||pt);i._RF.pop(),i._RF.push({},"99b8eEF6WlE8pzPfD+whiJu","AnimUtils",void 0);class vt{static get inst(){return this._instance||(this._instance=new vt),this._instance}static elasticOut(e,t,i){if(void 0===t&&(t=.1),void 0===i&&(i=.1),0===e)return 0;if(1===e)return 1;{let n=i/4;return t<1?t=1:n=i*Math.asin(1/t)/(2*Math.PI),t*Math.pow(2,-10*e)*Math.sin((e-n)*(2*Math.PI)/i)+1}}static easeOutExpo(e){return 1===e?1:1-Math.pow(2,-10*e)}static easeInExpo(e){return 0===e?0:Math.pow(2,10*e-10)}static runTweenAsync(e,t){return new Promise((i=>{const n=e.call((()=>{i({tween:e})})).start();t&&(t.aborted?(n.stop(),i({tween:e})):t.addAbortListener((()=>{n.stop(),i({tween:e})})))}))}static runOnUpdateAsync(e,t,i,n){return new Promise(((a,s)=>{const o=C(e).to(t,{},{onUpdate:(e,t)=>{if(void 0!==t)try{i(t)}catch(e){s(e instanceof Error?e:new Error(JSON.stringify(e)))}}}).call((()=>{a({tween:o})})).start();n&&(n.aborted?(o.stop(),a({tween:o})):n.addAbortListener((()=>{o.stop(),a({tween:o})})))}))}static waitTweenAsync(e,t){return new Promise((i=>{const n=C({});n.delay(e),n.call((()=>{i()})),n.start(),t&&(t.aborted?(n.stop(),i()):t.addAbortListener((()=>{n.stop(),i()})))}))}static runAnimationAsync(e,t){return new Promise((i=>{e.play(t),e.once(y.EventType.FINISHED,(()=>{i()}))}))}}try{new vt}catch(e){console.error("AnimUtils",e)}var Ct,Et,Tt,At,Rt,It,Pt,_t,Lt,Dt,Ot,Nt,Mt,kt,xt,Ft,Bt,zt,Ut,Gt;i._RF.pop(),i._RF.push({},"84a2dB5IaRJ8JB+n9yXfBc7","AutoLayout",void 0);const{ccclass:Ht,property:Vt}=a;let qt=(Ct=Ht("AutoLayoutWrappee"),Et=Vt({type:l}),Tt=Vt({type:l}),Ct((It=ve((Rt=class{constructor(){e(this,"wrapeeContainer",It,this),e(this,"wrapee",Pt,this)}}).prototype,"wrapeeContainer",[Et],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Pt=ve(Rt.prototype,"wrapee",[Tt],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),At=Rt))||At),Wt=(_t=Ht("AutoLayout"),Lt=Vt({displayName:"Use Auto Layout"}),Dt=Vt({type:[qt],displayName:"Children",visible(){return this.useAutoLayout}}),Ot=Vt({visible:!1,serializable:!0}),Nt=Vt({type:f,displayName:"Selected Index",visible(){return this.useAutoLayout}}),Mt=Vt({type:E,displayName:"Deselected Icon Width",group:"Edge Icons",visible(){return this.useAutoLayout}}),kt=Vt({visible:!1,serializable:!0}),_t((Bt=ve((Ft=class extends T{constructor(){super(...arguments),e(this,"useAutoLayout",Bt,this),e(this,"children",zt,this),this.mappedChildren=[],e(this,"selected",Ut,this),e(this,"deselectedIconW",Gt,this),this.tweens=[]}get selectedIndex(){return this.selected}set selectedIndex(e){this.selected=e,this.updateLayout(!0)}get deselectedIconWidth(){return this.deselectedIconW}set deselectedIconWidth(e){this.deselectedIconW=e,this.updateLayout(!0)}__preload(){this.mappedChildren=this.children.map((e=>{const t=e.wrapeeContainer.getComponent(A);if(!t)throw new Error("AutoLayout: Widget component not found");return{...e,wrapeeContainerWidget:t}}))}updateLayout(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];(this._layoutDirty||e)&&(this.updateChildrenAnchors(),this.mappedChildren.forEach((e=>e.wrapeeContainerWidget.updateAlignment()))),super.updateLayout(e)}getSelectedWorldX(){const e=this.mappedChildren[this.selectedIndex].wrapeeContainer;if(0===this.selectedIndex||this.selectedIndex===this.children.length-1){const{xMin:t}=e.getBoundingBoxToWorld();return t+this.getAnchorX(this.selectedIndex)*e.width}return e.getBoundingBoxToWorld().center.x}getAnchorX(e){if(e<this.selectedIndex)return 0;if(e>this.selectedIndex)return 1;if(0===e){const t=this.mappedChildren[e].wrapeeContainer.width,i=this.deselectedIconWidth/2,n=this.paddingLeft;return((n+t+(t-i+this.spacingX))/2-n)/t}if(e===this.children.length-1){const t=this.mappedChildren[e].wrapeeContainer.width,i=t-this.deselectedIconWidth/2+this.spacingX;return((i+t+this.paddingRight)/2-i)/t}return.5}async updateChildrenAnchors(){this.tweens.forEach((e=>e.stop())),this.tweens=[],await Promise.all([this.children.flatMap(((e,t)=>this.getChildrenAnchorsTweens(e,this.getAnchorX(t)))).map((e=>vt.runTweenAsync(e)))])}updateChildrenAnchorsEditor(){this.children.forEach(((e,t)=>{const i=this.getAnchorX(t);e.wrapee.setAnchorPoint(i,e.wrapee.anchorY),e.wrapeeContainer.setAnchorPoint(i,e.wrapeeContainer.anchorY)}))}getChildrenAnchorsTweens(e,t){return[C(e.wrapee).to(.3,{anchorX:t},{easing:"sineInOut"}).call((()=>{e.wrapee.setAnchorPoint(t,e.wrapee.anchorY)})),C(e.wrapeeContainer).to(.3,{anchorX:t},{easing:"sineInOut"}).call((()=>{e.wrapeeContainer.setAnchorPoint(t,e.wrapeeContainer.anchorY)}))]}}).prototype,"useAutoLayout",[Lt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),zt=ve(Ft.prototype,"children",[Dt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Ut=ve(Ft.prototype,"selected",[Ot],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),ve(Ft.prototype,"selectedIndex",[Nt],Object.getOwnPropertyDescriptor(Ft.prototype,"selectedIndex"),Ft.prototype),ve(Ft.prototype,"deselectedIconWidth",[Mt],Object.getOwnPropertyDescriptor(Ft.prototype,"deselectedIconWidth"),Ft.prototype),Gt=ve(Ft.prototype,"deselectedIconW",[kt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),xt=Ft))||xt);var Kt,Yt,jt,Xt,$t;i._RF.pop(),i._RF.push({},"ca427NpeqpC3bUoGTd9I/BM","Background",void 0);const{ccclass:Jt,property:Qt}=a;Kt=Jt("Background"),Yt=Qt({type:R}),Kt(($t=ve((Xt=class extends s{constructor(){super(...arguments),e(this,"sprite",$t,this)}__preload(){this.validateRequiredComponents(),this.listenGameEvents()}validateRequiredComponents(){Fe.lazyValidateProperties(this)}listenGameEvents(){}}).prototype,"sprite",[Yt],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),jt=Xt));i._RF.pop(),i._RF.push({},"bf320amyc1I86bS3oK0M9NR","DashboardEvents",void 0);const Zt="STARS_UPDATED",ei="PLAY_BUTTON_PRESS",ti="REQUEST_NAVIGATION",ii="REQUEST_NAVIGATION_ANIMATION",ni="DASHBOARD_EVENTS_BUTTON_PRESS";i._RF.pop(),i._RF.push({},"68b8bf0Va5JT7NVPECDNC5l","DashboardScreens",void 0);var ai=function(e){return e[e.store=0]="store",e[e.collections=1]="collections",e[e.home=2]="home",e[e.leaderboard=3]="leaderboard",e[e.tournaments=4]="tournaments",e}(ai||{});I(ai),i._RF.pop(),i._RF.push({},"a0756pde9lOeoJ4TckTOcMV","AnimAbortSignal",void 0);const{Utils:{Array:si}}=GameCore;class oi{constructor(){this.callbacks=[],this.isAborted=!1,this.abortReason="",this.callbacks=[]}get aborted(){return this.isAborted}get reason(){return this.abortReason}addAbortListener(e){this.callbacks.push(e)}removeAbortListener(e){const t=si.searchIndex(this.callbacks,(t=>t===e));-1!==t?this.callbacks.splice(t,1):console.warn("Abort listener not found")}abort(e){this.isAborted||(this.isAborted=!0,this.abortReason=e,this.callbacks.forEach((e=>e())),this.callbacks=[])}async untilAborted(){if(!this.isAborted)return new Promise((e=>{this.addAbortListener((()=>e()))}))}static hasBeenAborted(e){return null==e||e.aborted}}i._RF.pop(),i._RF.push({},"a6e4bjV/RVH17qBEx1mZaFg","ResourcePaths",void 0);var ri=function(e){return e.BOMB_RESCUE_PREFAB="game-objects/bomb/BombRescue",e.BOMB_EXPLODE_PREFAB="game-objects/bomb/BombExplode",e.BOMB_DEFUSE_PREFAB="game-objects/bomb/DefuseExplode",e.COLLECTIONS_CONTENT_PREFAB="game-objects/dashboard-scene/CollectionsContent",e.CLOUD_IDLE_ANIM="animations/CloudIdle",e.TORNADO_IDLE_ANIM="animations/TornadoIdle",e.TILE_BREAK_ANIM="animations/TileBreak",e.TILE_CLEAR_ANIM="animations/TileClear",e.TILE_SHAKE_ANIM="animations/TileShake",e.TILE_SKIN_FOLDER="loadable/tiles",e.TILE_SKIN_PREVIEW_FOLDER="loadable/tiles-preview",e.ITEM_POPUP_FOLDER="loadable/item-popup",e.SUMMER_BG="images/bg/summer",e.AUTUMN_BG="images/bg/autumn",e.WINTER_BG="images/bg/winter",e.SUMMER_BG_PREVIEW="images/preview/summer",e.AUTUMN_BG_PREVIEW="images/preview/autumn",e.WINTER_BG_PREVIEW="images/preview/winter",e.COLLECTIONS_PAGE="pages/CollectionsContent",e.LEADERBOARD_PAGE="pages/LeaderboardContent",e.TOURNAMENTS_PAGE="pages/TournamentsContent",e.LEVEL_DATA_FOLDER="levels-json",e}(ri||{});i._RF.pop(),i._RF.push({},"2a657+TsltMe4rrDmyWGrLy","ThemeResourcesPath",void 0);const li={summer:ri.SUMMER_BG,autumn:ri.AUTUMN_BG,winter:ri.WINTER_BG},ci={summer:ri.SUMMER_BG_PREVIEW,autumn:ri.AUTUMN_BG_PREVIEW,winter:ri.WINTER_BG_PREVIEW};i._RF.pop(),i._RF.push({},"669a1OtNF9EDrMRLWTjxk4B","GeneralUtils",void 0);class hi{static get inst(){return this._instance||(this._instance=new hi),this._instance}static setBlockInput(e){const t=P("Canvas/InputBlocker");t?t.active=e:console.warn("InputBlocker not found")}static getBlockInput(){const e=P("Canvas/InputBlocker");return e?e.active:(console.warn("InputBlocker not found"),!1)}static loadPrefabAsync(e){const t=S.getInfoWithPath(e,_);if(t&&null!==S.get(t.path,_)){const e=S.get(t.path,_);if(null!==e)return Promise.resolve(e)}return new Promise((t=>{S.load(e,_,((e,i)=>{t(e?null:i)}))}))}static async loadJsonAsync(e){return new Promise((t=>{const i=S.getInfoWithPath(e,L);if(i&&null!==S.get(i.path,L)){const e=S.get(i.path,L);if(null!==e)return void t(e.json)}S.load(e,L,((e,i)=>{e?t(null):i&&i.json?t(i.json):t(null)}))}))}static async loadAnimClipAsync(e){const t=S.getInfoWithPath(e,D);if(t&&null!==S.get(t.path,D)){const e=S.get(t.path,D);if(null!==e)return Promise.resolve(e)}return new Promise((t=>{S.load(e,D,((e,i)=>{t(e?null:i)}))}))}static async loadImageSpriteFrameAsync(e){const t=S.getInfoWithPath(e,O);if(t&&null!==S.get(t.path,O)){const e=S.get(t.path,O);if(null!==e)return Promise.resolve(N.createWithImage(e))}return new Promise((t=>{S.load(e,O,((e,i)=>{t(e?null:N.createWithImage(i))}))}))}static async loadSpriteFrameAsync(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const i=S.getInfoWithPath(e,N);if(i&&null!==S.get(i.path,N)){const e=S.get(i.path,N);if(null!==e)return e.packable=t,Promise.resolve(e)}return new Promise((i=>{S.load(e,N,((e,n)=>{!e&&n?(n.packable=t,i(n)):i(null)}))}))}static async loadSpriteFramesDirAsync(e){const t=S.getDirWithPath(e,N);if(t.length>0){const i=[];for(const n of t){const t=S.get(n.path,N);if(!t)return this.loadSpriteFramesFromDirAsync(e);i.push(t)}return i}return this.loadSpriteFramesFromDirAsync(e)}static async loadSpriteFramesFromDirAsync(e){return new Promise((t=>{S.loadDir(e,N,((e,i)=>{t(e?[]:i)}))}))}static async lazyLoadDashboardSceneResourcesAsync(){return hi.loadPrefabAsync(ri.COLLECTIONS_CONTENT_PREFAB)}static async loadThemeAsync(e){return this.loadSpriteFrameAsync(`${li[e]}/spriteFrame`)}static async loadThemePreviewAsync(e){return this.loadSpriteFrameAsync(`${ci[e]}/spriteFrame`)}static async loadSkinPreviewAsync(e){const t=[];for(let i=1;i<=4;i++){const n=`${ri.TILE_SKIN_PREVIEW_FOLDER}/${e.replace(/-/g,"_")}_${i}/spriteFrame`;t.push(this.loadSpriteFrameAsync(n))}return Promise.all(t)}}try{new hi}catch(e){console.error("GeneralUtils",e)}var di,ui,pi,mi,gi,yi,bi,fi,wi,Si,vi,Ci,Ei,Ti,Ai,Ri,Ii,Pi,_i,Li,Di;i._RF.pop(),i._RF.push({},"ab9cd/wERRKYqhDoYtJ1L3w","MultiBackground",void 0);const{ccclass:Oi,property:Ni}=a,{monitorError:Mi}=globalThis.game,{Utils:{Number:ki}}=GameCore;let xi=(di=Oi("MultiBackground"),ui=Ni({type:R}),pi=Ni({type:R}),mi=Ni({type:l}),gi=Ni({type:l}),yi=Ni({type:l}),bi=Ni(f),fi=Ni(A),wi=Ni({type:M(ai)}),Si=Ni({type:M(ai)}),di((Ei=ve((Ci=class extends s{constructor(){super(...arguments),e(this,"background1",Ei,this),e(this,"background2",Ti,this),e(this,"screenUiTransform",Ai,this),e(this,"background1Uitransform",Ri,this),e(this,"background2UiTransform",Ii,this),e(this,"backgroundNudgeAmount",Pi,this),e(this,"nudgeableWidget",_i,this),e(this,"pageOrder",Li,this),e(this,"homePage",Di,this),this.currentThemeId="",this.tryNudgeBackground=e=>{let{to:t}=e;const i=this.getDirection(this.homePage,t),n=ki.sign(i),a=Math.abs(i),s=this.backgroundNudgeAmount*a,o=Math.min(this.background1Uitransform.width,this.background2UiTransform.width),r=Math.max(0,(o-this.screenUiTransform.width)/2),l=Math.min(r,s)*n;C(this.nudgeableWidget).to(.5,{horizontalCenter:l},{easing:k.cubicInOut}).start()}}onLoad(){this.currentBackground=this.background1,this.nextBackground=this.background2,Fe.lazyValidateProperties(this),this.listenToNavigationEvents()}onDestroy(){this.tweenSignal?.abort(),this.unlistenToNavigationEvents()}start(){const e=this.getComponent(A),t=this.getComponentsInChildren(A);(e?[e,...t]:t).forEach((e=>{e.updateAlignment()}))}listenToNavigationEvents(){this.node.scene.on(ii,this.tryNudgeBackground)}unlistenToNavigationEvents(){this.node.scene.off(ii,this.tryNudgeBackground)}getDirection(e,t){const i=this.pageOrder.indexOf(e),n=this.pageOrder.indexOf(t);return-1===i||-1===n?(Mi?.sendException(new Error("MultiBackground.getDirection: fromIndex or toIndex is -1")),0):i-n}async setCurrentTheme(e){const t=await hi.loadThemeAsync(e);t?(t.packable=!1,this.background1.spriteFrame=t,this.background2.spriteFrame=t,this.currentThemeId=e):Mi?.sendException(new Error(`MultiBackground.setCurrentTheme: Failed to load theme ${e}'s sprite.`))}async animateToNextTheme(e){if(this.currentThemeId===e)return Promise.resolve();const t=await hi.loadThemeAsync(e);if(!t)return void Mi?.sendException(new Error(`MultiBackground.animateToNextTheme: Failed to load theme ${e}'s sprite.`));t.packable=!1,this.currentThemeId=e,this.nextBackground.node.active=!0,this.nextBackground.spriteFrame=t,this.nextBackground.node.setSiblingIndex(1);const i=this.nextBackground.getComponent(x);if(!i)throw new Error(`${this.nextBackground.node.name} UIOpacity is required`);if(i.opacity=0,this.tweenSignal?.abort(),this.tweenSignal=new oi,await vt.runTweenAsync(C(i).to(1,{opacity:255}),this.tweenSignal),this.tweenSignal.aborted)return;this.currentBackground.node.active=!1;const n=this.currentBackground;this.currentBackground=this.nextBackground,this.nextBackground=n}}).prototype,"background1",[ui],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ti=ve(Ci.prototype,"background2",[pi],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ai=ve(Ci.prototype,"screenUiTransform",[mi],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ri=ve(Ci.prototype,"background1Uitransform",[gi],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ii=ve(Ci.prototype,"background2UiTransform",[yi],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Pi=ve(Ci.prototype,"backgroundNudgeAmount",[bi],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 50}}),_i=ve(Ci.prototype,"nudgeableWidget",[fi],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Li=ve(Ci.prototype,"pageOrder",[wi],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Di=ve(Ci.prototype,"homePage",[Si],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return ai.home}}),vi=Ci))||vi);i._RF.pop(),i._RF.push({},"d159egaUVVLHKLg1UL865ub","SoundKeys",void 0);const{Utils:{Object:Fi}}=GameCore,Bi={BUTTON_CLICK:"sounds/use_item_click",BOMB_DEFUSE:"sounds/bomb_defuse",BOMB_EXPLODE_1:"sounds/bomb_explode_1",BOMB_EXPLODE_2:"sounds/bomb_explode_2",CLICKS:"sounds/clicks",CLOSE_POPUP_CLICK:"sounds/close_popup_click",COLLECT_STARS:"sounds/collect_stars",COMBO_1:"sounds/combo_1",COMBO_2:"sounds/combo_2",COMBO_3:"sounds/combo_3",COMBO_4:"sounds/combo_4",COMBO_5:"sounds/combo_5",DAILY_REWARD:"sounds/daily_reward",EXTRA_TIME_SPAWN:"sounds/extra_time_spawn",GIFT_CHARGE:"sounds/gift_charge",GIFT_EXPLODE:"sounds/gift_explode",GIFT_REVEAL:"sounds/gift_reveal",HINT_ITEM:"sounds/hint_item",INVALID_MATCH:"sounds/invalid_match",LEVEL_COMPLETE:"sounds/level_complete",LEVEL_FAIL:"sounds/level_fail",LEVEL_START:"sounds/level_start",PROGRESS_STAR:"sounds/progress_star",RESCUE_TIMER:"sounds/rescue_timer",ROCKET_FLY:"sounds/rocket_fly",SHUFFLE_ITEM:"sounds/shuffle_item",THREE_STARS:"sounds/three_stars",TICKING_BOMB_BEFORE_EXPLODE:"sounds/ticking_bomb_before_explode",TILE_SELECT:"sounds/tile_select",USE_ITEM_CLICK:"sounds/use_item_click",BG_MUSIC:"musics/bg_music",PATCH_SHIFT:"sounds/patch_shift",THUNDERBOLT:"sounds/thunderbolt",WIND:"sounds/wind",COLLECT_COINS:"sounds/collect_coins",COLLECT_STOCK_COINS:"sounds/collect_stock_coins",LEVEL_FAIL_TIMEOUT:"sounds/level_fail_timeout",STAR_CHEST_DRUM_ROLL:"sounds/star_chest_drum_roll",STAR_CHEST_OPEN:"sounds/star_chest_open",LEADERBOARD_TRIUMPH:"sounds/leaderboard_triumph",ITEM_REWARD:"sounds/item_reward"},zi=Fi.vals(Bi),Ui=zi.reduce(((e,t,i)=>({...e,[t]:i})),{});I(Ui);const Gi=zi;i._RF.pop(),i._RF.push({},"0eeb868JeVE67iFwhbkRCmE","ScreenKeys",void 0);var Hi=function(e){return e[e.RESCUES_SCREEN=0]="RESCUES_SCREEN",e[e.LOADING_SCREEN=1]="LOADING_SCREEN",e[e.GET_ITEM_SCREEN=2]="GET_ITEM_SCREEN",e[e.GET_COIN_SCREEN=3]="GET_COIN_SCREEN",e[e.SETTINGS_SCREEN=4]="SETTINGS_SCREEN",e[e.START_LEVEL_SCREEN=5]="START_LEVEL_SCREEN",e[e.NOTIFICATION_SCREEN=6]="NOTIFICATION_SCREEN",e[e.LEVEL_COMPLETE_SCREEN=7]="LEVEL_COMPLETE_SCREEN",e[e.CONGRATULATION_SCREEN=8]="CONGRATULATION_SCREEN",e[e.QUIT_LEVEL_SCREEN=9]="QUIT_LEVEL_SCREEN",e[e.TOURNAMENT_DETAIL_SCREEN=10]="TOURNAMENT_DETAIL_SCREEN",e[e.DAILY_REWARDS_SCREEN=11]="DAILY_REWARDS_SCREEN",e[e.STAR_CHEST_SCREEN=12]="STAR_CHEST_SCREEN",e}(Hi||{});const Vi={[Hi.RESCUES_SCREEN]:"RescuesScreen",[Hi.LOADING_SCREEN]:"LoadingScreen",[Hi.GET_ITEM_SCREEN]:"GetItemScreen",[Hi.GET_COIN_SCREEN]:"GetCoinScreen",[Hi.SETTINGS_SCREEN]:"SettingsScreen",[Hi.START_LEVEL_SCREEN]:"StartLevelScreen",[Hi.NOTIFICATION_SCREEN]:"NotificationScreen",[Hi.LEVEL_COMPLETE_SCREEN]:"LevelCompleteScreen",[Hi.CONGRATULATION_SCREEN]:"CongratulationScreen",[Hi.QUIT_LEVEL_SCREEN]:"QuitLevelScreen",[Hi.TOURNAMENT_DETAIL_SCREEN]:"TournamentDetailScreen",[Hi.DAILY_REWARDS_SCREEN]:"DailyRewardsScreen",[Hi.STAR_CHEST_SCREEN]:"StarChestScreen"},qi={[Vi[Hi.RESCUES_SCREEN]]:Hi.RESCUES_SCREEN,[Vi[Hi.LOADING_SCREEN]]:Hi.LOADING_SCREEN,[Vi[Hi.GET_ITEM_SCREEN]]:Hi.GET_ITEM_SCREEN,[Vi[Hi.GET_COIN_SCREEN]]:Hi.GET_COIN_SCREEN,[Vi[Hi.SETTINGS_SCREEN]]:Hi.SETTINGS_SCREEN,[Vi[Hi.START_LEVEL_SCREEN]]:Hi.START_LEVEL_SCREEN,[Vi[Hi.NOTIFICATION_SCREEN]]:Hi.NOTIFICATION_SCREEN,[Vi[Hi.LEVEL_COMPLETE_SCREEN]]:Hi.LEVEL_COMPLETE_SCREEN,[Vi[Hi.CONGRATULATION_SCREEN]]:Hi.CONGRATULATION_SCREEN,[Vi[Hi.QUIT_LEVEL_SCREEN]]:Hi.QUIT_LEVEL_SCREEN,[Vi[Hi.TOURNAMENT_DETAIL_SCREEN]]:Hi.TOURNAMENT_DETAIL_SCREEN,[Vi[Hi.DAILY_REWARDS_SCREEN]]:Hi.DAILY_REWARDS_SCREEN,[Vi[Hi.STAR_CHEST_SCREEN]]:Hi.STAR_CHEST_SCREEN},Wi=[Hi[Hi.NOTIFICATION_SCREEN],Hi[Hi.LOADING_SCREEN]];i._RF.pop(),i._RF.push({},"09bc071ZcpI978b1NdKUaqD","AnalyticsUtils",void 0);const{analytics:Ki}=globalThis.game,{Utils:{Array:Yi}}=GameCore;class ji{static get inst(){return this._instance||(this._instance=new ji),this._instance}static trackCurrentPage(e,t){if(Yi.has(Wi,e))return;if(!t&&!Yi.has(this.trackingPages,e))return;this.trackingPages=this.trackingPages.filter((t=>t!==e)),t&&this.trackingPages.push(e);const i=this.getCurrentPage();Ki.pageview(i)}static switchSceneTracking(){this.trackingPages=[];const e=this.getCurrentPage();Ki.pageview(e)}static getCurrentPage(){return this.trackingPages.length>0?this.trackingPages[this.trackingPages.length-1]:m.getScene()?.name??"Unknown Scene"}}ji.trackingPages=[];try{new ji}catch(e){console.error("AnalyticsUtils",e)}i._RF.pop(),i._RF.push({},"31871PLRYRJu7yCCX5F6lWK","AudioUtils",void 0);class Xi{static get inst(){return this._instance||(this._instance=new Xi),this._instance}get sound(){return P("Sound")?.getComponent(St)??null}get music(){return P("Music")?.getComponent(ht)??null}static muteAudio(e){this.muteMusic(e),this.muteSound(e)}static playSound(e,t){this.inst.sound?.play(e,t)}static pauseSound(e){this.inst.sound?.pause(e)}static resumeSound(e){this.inst.sound?.resume(e)}static stopSound(e){this.inst.sound?.stop(e)}static stopAllSounds(){this.inst.sound?.stopAll()}static muteSound(e){this.inst.sound?.mute(e)}static playMusic(){!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])&&this.inst.music?.playing(Bi.BG_MUSIC)||this.inst.music?.play(Bi.BG_MUSIC)}static pauseMusic(){this.inst.music?.pause(Bi.BG_MUSIC)}static muteMusic(e){this.inst.music?.mute(e)}static turnUpMusic(){this.inst.music?.setVolume(.8)}static turnDownMusic(){this.inst.music?.setVolume(.4)}static turnOffMusic(){this.inst.music?.setVolume(0)}}try{new Xi}catch(e){console.error("AudioUtils",e)}i._RF.pop(),i._RF.push({},"05faedSJ2NHFqLe9b3g4RIl","CocosUtils",void 0);class $i{static get inst(){return this._instance||(this._instance=new $i),this._instance}static getBoundingBoxToWorld(e){if(e.parent){const t=e.parent.getWorldMatrix();return this.inst.getBoundingBoxTo(t,e)}const t=e.getComponent(l);if(!t)throw new Error("Node must have UITransform component");return t.getBoundingBox()}static worldSizeToCssSize(e){return e*this.inst.getWindowSizeVsWorldGameRatio()}static cssSizeToWorldSize(e){return e/this.inst.getWindowSizeVsWorldGameRatio()}static getScreenWidthCss(){const{body:e,documentElement:t}=document,{clientWidth:i}=e,{clientWidth:n}=t;return Math.max(n,i)||0}static getScreenHeightCss(){const{body:e,documentElement:t}=document,{clientHeight:i}=e,{clientHeight:n}=t;return Math.max(n,i)||0}getWindowSizeVsWorldGameRatio(){const e=F.getVisibleSize(),{width:t}=B.windowSize;return t/window.devicePixelRatio/e.width}getBoundingBoxTo(e,t){const i=z.mat4();z.Mat4.fromSRT(i,t.getRotation(),t.getPosition(),t.getScale());const n=t.getComponent(l);if(!n)throw new Error("Node must have UITransform component");const{anchorPoint:a,contentSize:s}=n,{width:o,height:r}=s,c=new z.Rect(-a.x*o,-a.y*r,o,r),h=z.mat4();if(z.Mat4.multiply(h,e,i),c.transformMat4(h),!t.children||0===t.children.length)return c;const d=t.children,u=t.getWorldMatrix();for(const e of d){if(!e?.active)continue;if(e.getComponent(l)){const t=this.getBoundingBoxTo(u,e);t&&z.Rect.union(c,c,t)}}return c}}try{new $i}catch(e){console.error("CocosUtils",e)}var Ji,Qi,Zi,en,tn,nn,an,sn,on,rn,ln,cn,hn,dn,un,pn,mn,gn,yn,bn,fn,wn,Sn,vn,Cn,En,Tn,An,Rn,In,Pn,_n,Ln;i._RF.pop(),i._RF.push({},"ef63ctZn6BPAout9ufUgFVq","ExtendedButton",void 0);const{ccclass:Dn,property:On,disallowMultiple:Nn,executionOrder:Mn}=a,{analytics:kn}=globalThis.game,{Plugins:{Analytics:{Events:xn}}}=GameCore;let Fn=(Ji=Dn("ExtendedButton"),Qi=Mn(111),Zi=On(U),en=On(U),tn=On(G.AnimationController),nn=On({override:!0,visible:!1}),an=On({override:!0,visible:!1}),sn=On({override:!0,visible:!1}),on=On({override:!0,visible:!1}),rn=On({override:!0,visible:!1}),ln=On({override:!0,visible:!1}),cn=On({override:!0,visible:!1}),hn=On({override:!0,visible:!1}),dn=On({override:!0,visible:!1}),un=On({override:!0,visible:!1}),pn=On({override:!0,visible:!1}),mn=On(H),gn=On(H),yn=On(H),bn=On({visible(){return this.makeSound},type:Ui}),fn=On({tooltip:"Add a delay after click to prevent spamming (not apply for cancel click)"}),wn=On({visible(){return this.disableSpamClick},tooltip:"Delay time in seconds"}),Ji(Sn=Nn(Sn=Qi((Cn=ve((vn=class extends p{constructor(){super(...arguments),e(this,"clickStartEvents",Cn,this),e(this,"clickEndEvents",En,this),e(this,"animationController",Tn,this),e(this,"useDesktopHover",An,this),e(this,"emitAnalyticsEvents",Rn,this),e(this,"makeSound",In,this),e(this,"soundKey",Pn,this),e(this,"disableSpamClick",_n,this),e(this,"disableSpamDelay",Ln,this),this.currentClickBoundingBox=null,this.hasDown=!1,this.hasUp=!1,this.hasFinishClickCycle=!1,this.onTouchStart=e=>{this.interactable&&(this.hasDown||(this.currentClickBoundingBox=$i.getBoundingBoxToWorld(this.node),this.handleDown(e)))},this.onTouchEnd=e=>{this.interactable&&this.hasDown&&(this.hasUp||this.handleUp(e))},this.onTouchCancel=e=>{if(!this.interactable)return;if(!this.hasDown)return;if(this.hasUp)return;const t=e.getUILocation();this.currentClickBoundingBox?.contains(t)??1?(this.hasUp=!0,this.hasFinishClickCycle=!0,this.handleResetButtonState(),this.emitClickEndEvents(e)):this.handleUp(e)},this.onMouseEnter=e=>{this.useDesktopHover&&this.interactable&&(this.hasDown||(this.hasFinishClickCycle=!1,this.setAnimationState("HOVER")))},this.onMouseLeave=e=>{this.useDesktopHover&&this.interactable&&(this.hasDown||this.hasUp||this.hasFinishClickCycle||this.handleResetButtonState())},this.handleResetButtonState=()=>{this.hasDown=!1,this.hasUp=!1,this.setAnimationState("RESET")}}get transition(){return p.Transition.NONE}set transition(e){super.transition=p.Transition.NONE}get normalColor(){return super.normalColor}set normalColor(e){super.normalColor=e}get pressedColor(){return super.pressedColor}set pressedColor(e){super.pressedColor=e}get hoverColor(){return super.hoverColor}set hoverColor(e){super.hoverColor=e}get disabledColor(){return super.disabledColor}set disabledColor(e){super.disabledColor=e}get normalSprite(){return super.normalSprite}set normalSprite(e){super.normalSprite=e}get pressedSprite(){return super.pressedSprite}set pressedSprite(e){super.pressedSprite=e}get hoverSprite(){return super.hoverSprite}set hoverSprite(e){super.hoverSprite=e}get disabledSprite(){return super.disabledSprite}set disabledSprite(e){super.disabledSprite=e}get duration(){return super.duration}set duration(e){super.duration=e}get zoomScale(){return super.zoomScale}set zoomScale(e){super.zoomScale=e}__preload(){super.__preload(),Fe.lazyValidateProperties(this)}onDestroy(){super.onDestroy?.()}onEnable(){super.onEnable?.(),this.node.off(V.EventType.TOUCH_END,this._onTouchEnded,this),this.node.on(n.EventType.TOUCH_START,this.onTouchStart),this.node.on(n.EventType.TOUCH_END,this.onTouchEnd),this.node.on(n.EventType.TOUCH_CANCEL,this.onTouchCancel),this.node.on(n.EventType.MOUSE_ENTER,this.onMouseEnter),this.node.on(n.EventType.MOUSE_LEAVE,this.onMouseLeave)}onDisable(){super.onDisable?.(),this.node.off(n.EventType.TOUCH_START,this.onTouchStart),this.node.off(n.EventType.TOUCH_END,this.onTouchEnd),this.node.off(n.EventType.TOUCH_CANCEL,this.onTouchCancel),this.node.off(n.EventType.MOUSE_ENTER,this.onMouseEnter),this.node.off(n.EventType.MOUSE_LEAVE,this.onMouseLeave),this.unschedule(this.handleResetButtonState),this.handleResetButtonState()}handleDown(e){this.hasDown=!0,this.setAnimationState("DOWN"),this.makeSound&&Xi.playSound(Gi[this.soundKey]),this.emitClickStartEvents(e)}emitClickStartEvents(e){this.clickStartEvents.forEach((t=>{t.emit([e,t.customEventData])}))}emitClickEndEvents(e){this.clickEndEvents.forEach((t=>{t.emit([e,t.customEventData])}))}handleUp(e){this.hasUp=!0,this.hasFinishClickCycle=!0,this.setAnimationState("RESET"),this.disableSpamClick?this.scheduleOnce(this.handleResetButtonState,this.disableSpamDelay):this.handleResetButtonState(),this.emitButtonEvents(e),this.emitClickEndEvents(e)}emitButtonEvents(e){this.interactable&&(this.emitAnalyticsEvents&&kn.event(xn.BUTTON_CLICK,{button_name:this.node.name,screen_name:ji.getCurrentPage()}),this.clickEvents.forEach((t=>{t.emit([e,t.customEventData])})))}setAnimationState(e){this.animationController.setValue("DOWN","DOWN"===e),this.animationController.setValue("HOVER","HOVER"===e),this.animationController.setValue("RESET","RESET"===e)}fakeClick(){this.setAnimationState("DOWN"),this.scheduleOnce((()=>{this.setAnimationState("RESET")}),0)}resetButtonState(){this.handleResetButtonState()}}).prototype,"clickStartEvents",[Zi],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),En=ve(vn.prototype,"clickEndEvents",[en],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Tn=ve(vn.prototype,"animationController",[tn],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ve(vn.prototype,"transition",[nn],Object.getOwnPropertyDescriptor(vn.prototype,"transition"),vn.prototype),ve(vn.prototype,"normalColor",[an],Object.getOwnPropertyDescriptor(vn.prototype,"normalColor"),vn.prototype),ve(vn.prototype,"pressedColor",[sn],Object.getOwnPropertyDescriptor(vn.prototype,"pressedColor"),vn.prototype),ve(vn.prototype,"hoverColor",[on],Object.getOwnPropertyDescriptor(vn.prototype,"hoverColor"),vn.prototype),ve(vn.prototype,"disabledColor",[rn],Object.getOwnPropertyDescriptor(vn.prototype,"disabledColor"),vn.prototype),ve(vn.prototype,"normalSprite",[ln],Object.getOwnPropertyDescriptor(vn.prototype,"normalSprite"),vn.prototype),ve(vn.prototype,"pressedSprite",[cn],Object.getOwnPropertyDescriptor(vn.prototype,"pressedSprite"),vn.prototype),ve(vn.prototype,"hoverSprite",[hn],Object.getOwnPropertyDescriptor(vn.prototype,"hoverSprite"),vn.prototype),ve(vn.prototype,"disabledSprite",[dn],Object.getOwnPropertyDescriptor(vn.prototype,"disabledSprite"),vn.prototype),ve(vn.prototype,"duration",[un],Object.getOwnPropertyDescriptor(vn.prototype,"duration"),vn.prototype),ve(vn.prototype,"zoomScale",[pn],Object.getOwnPropertyDescriptor(vn.prototype,"zoomScale"),vn.prototype),An=ve(vn.prototype,"useDesktopHover",[mn],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),Rn=ve(vn.prototype,"emitAnalyticsEvents",[gn],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),In=ve(vn.prototype,"makeSound",[yn],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),Pn=ve(vn.prototype,"soundKey",[bn],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Ui[Bi.BUTTON_CLICK]}}),_n=ve(vn.prototype,"disableSpamClick",[fn],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),Ln=ve(vn.prototype,"disableSpamDelay",[wn],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.5}}),Sn=vn))||Sn)||Sn)||Sn);var Bn,zn,Un,Gn;i._RF.pop(),i._RF.push({},"0e570DdAIZPKY6DNtNerFmX","OpacityToggler",void 0);const{ccclass:Hn,requireComponent:Vn,property:qn}=a;let Wn=Hn("OpacityToggler")(Bn=Vn([x])((Un=ve((zn=class extends s{constructor(){super(...arguments),e(this,"activeValue",Un,this),e(this,"inActiveValue",Gn,this),this.signal=new oi}__preload(){this.opacityComponent=this.getComponent(x),this.validateRequiredComponents()}validateRequiredComponents(){Fe.lazyValidateProperties(this)}changeState(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.signal.abort(),this.opacityComponent.opacity=e?this.activeValue:this.inActiveValue}async changeStateFade(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.2;this.signal.abort(),this.signal=new oi;const i=e?this.activeValue:this.inActiveValue;await vt.runTweenAsync(C(this.opacityComponent).to(t,{opacity:i}),this.signal)}}).prototype,"activeValue",[qn],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 255}}),Gn=ve(zn.prototype,"inActiveValue",[qn],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 128}}),Bn=zn))||Bn)||Bn;i._RF.pop(),i._RF.push({},"244e9OHsmpDnpHQKeLzgiiX","GameEvents",void 0);const Kn="view-resize",Yn="view-resized",jn="request-view-resize",Xn="layout-changed",$n="gameplay-update-config",Jn="opened-skip-overlay",Qn="closed-skip-overlay",Zn="result-scene-replay",ea="result-scene-home",ta="upgrade-quality",ia="upgrade-dynamic-atlas";i._RF.pop(),i._RF.push({},"5c76fxO2ppOqYp4WNO+Kavm","GameWorld",void 0);const na={Layout:{Portrait:"portrait",Landscape:"landscape"},DesignSize:{Portrait:{WIDTH:750,HEIGHT:1583},Landscape:{WIDTH:1920,HEIGHT:1583}},FORCE_LAYOUT:"none",FIT_CANVAS_TO_VIEW:!1,FULL_PORTRAIT_SIZE:!0,FULL_LANDSCAPE_SIZE:!0};var aa,sa,oa;i._RF.pop(),i._RF.push({},"7ef37Q3PZpKYaeik5JzGwNy","DebugResolution",void 0);const{ccclass:ra,property:la,requireComponent:ca,disallowMultiple:ha,executeInEditMode:da}=a,{Portrait:ua,Landscape:pa}=na.DesignSize;ra("DebugResolution")(aa=ha(aa=ca([q])(aa=da(!0)(((oa=class e extends s{constructor(){super(...arguments),this.handleLayoutChange=()=>{this.graphics?.clear(),this.start()}}set drawPortrait(t){t!==e._drawPortrait&&(t?this.drawPortraitResolution():this.graphics.clear(),e._drawPortrait=t,e._drawLandscape&&this.drawLandscapeResolution())}get drawPortrait(){return e._drawPortrait}set drawLandscape(t){t!==e._drawLandscape&&(t?this.drawLandscapeResolution():this.graphics.clear(),e._drawLandscape=t,e._drawPortrait&&this.drawPortraitResolution())}get drawLandscape(){return e._drawLandscape}__preload(){this.graphics=this.getComponent(q),this.validateRequiredComponents(),this.listenGameEvents()}validateRequiredComponents(){Fe.lazyValidateProperties(this)}listenGameEvents(){W.on(Xn,this.handleLayoutChange)}start(){this.drawPortrait&&this.drawPortraitResolution(),this.drawLandscape&&this.drawLandscapeResolution()}drawPortraitResolution(){const{graphics:e}=this,t=ua.WIDTH,i=ua.HEIGHT,n=-t/2,a=-i/2;e.strokeColor=o.GREEN,e.rect(n,a,t,i),e.stroke()}drawLandscapeResolution(){const{graphics:e}=this,t=pa.WIDTH,i=pa.HEIGHT,n=-t/2;let a=-i/2;e.strokeColor=o.CYAN,e.rect(n,a,t,i),e.stroke()}})._drawPortrait=!0,oa._drawLandscape=!0,ve((sa=oa).prototype,"drawPortrait",[la],Object.getOwnPropertyDescriptor(sa.prototype,"drawPortrait"),sa.prototype),ve(sa.prototype,"drawLandscape",[la],Object.getOwnPropertyDescriptor(sa.prototype,"drawLandscape"),sa.prototype),aa=sa))||aa)||aa)||aa);var ma,ga,ya,ba,fa,wa,Sa,va,Ca,Ea,Ta,Aa,Ra,Ia,Pa,_a,La,Da,Oa,Na;i._RF.pop(),i._RF.push({},"0e2d6yn/BVObK1kyTJ5a09a","GameStats",void 0);const{ccclass:Ma,executionOrder:ka,property:xa}=a,{Utils:{Valid:Fa}}=GameCore,Ba=o.RED,za=o.BLACK,Ua=o.MAGENTA;ma=Ma("GameStats"),ga=ka(-1e3),ya=xa(h),ba=xa(h),fa=xa(h),wa=xa(h),Sa=xa(h),va=xa(h),Ca=xa(h),Ea=xa(h),ma(Ta=ga((Ra=ve((Aa=class extends s{constructor(){super(...arguments),e(this,"fpsLabel",Ra,this),e(this,"drawCountLabel",Ia,this),e(this,"logicTimeLabel",Pa,this),e(this,"physicTimeLabel",_a,this),e(this,"renderTimeLabel",La,this),e(this,"objectMemoryUsageLabel",Da,this),e(this,"textureMemoryUsageLabel",Oa,this),e(this,"devicePixelRatioLabel",Na,this),this.refreshInterval=.5,this.handleMouseDown=()=>{this.bg.enabled=!this.bg.enabled},this.waitForStats=()=>{K.stats&&(this.unschedule(this.waitForStats),this.node.active=!0,this.stats=K.stats,this.startUpdateStats())},this.updateStats=()=>{this.updateFps(),this.updateDrawCalls(),this.updateLogicTime(),this.updatePhysicTime(),this.updateRenderTime(),this.updateObjectMemoryUsage(),this.updateTextureMemoryUsage(),this.updateDevicePixelRatio()}}__preload(){this.bg=this.getComponent(R),this.validateRequiredComponents(),this.listenInputEvents()}validateRequiredComponents(){Fe.lazyValidateProperties(this)}listenInputEvents(){this.node.on(V.EventType.TOUCH_START,this.handleMouseDown)}start(){this.bg.enabled=!1,this.node.active=!1,K&&Fa.isDebugger()&&(K.showStats(),this.schedule(this.waitForStats,.5,20))}startUpdateStats(){this.schedule(this.updateStats,this.refreshInterval)}updateFps(){const e=this.getFps();this.updateFpsColor(e),this.fpsLabel.string=`FPS: ${e}`}updateFpsColor(e){this.fpsLabel.color=e<30?Ba:e<48?Ua:za}updateDrawCalls(){const e=this.getDrawCalls();this.updateDrawCallsColor(e),this.drawCountLabel.string=`Draw Calls: ${e}`}updateDrawCallsColor(e){const t=Y.os===Y.OS.IOS,i=t?80:25,n=t?60:15;this.drawCountLabel.color=e>i?Ba:e>n?Ua:za}updateLogicTime(){const e=this.getLogicTime();this.updateLogicTimeColor(e),this.logicTimeLabel.string=`Logic Time: ${e.toFixed(2)}ms`}updateLogicTimeColor(e){this.logicTimeLabel.color=e>10?Ba:e>5?Ua:za}updatePhysicTime(){const e=this.getPhysicTime();this.updatePhysicTimeColor(e),this.physicTimeLabel.string=`Physic Time: ${e.toFixed(2)}ms`}updatePhysicTimeColor(e){this.physicTimeLabel.color=e>10?Ba:e>5?Ua:za}updateRenderTime(){const e=this.getRenderTime();this.updateRenderTimeColor(e),this.renderTimeLabel.string=`Render Time: ${e.toFixed(2)}ms`}updateRenderTimeColor(e){this.renderTimeLabel.color=e>10?Ba:e>5?Ua:za}updateObjectMemoryUsage(){const e=this.getObjectMemoryUsage();this.updateObjectMemoryUsageColor(e),this.objectMemoryUsageLabel.string=`Object Mem: ${e.toFixed(2)}MB`}updateObjectMemoryUsageColor(e){this.objectMemoryUsageLabel.color=e>40?Ba:e>25?Ua:za}updateTextureMemoryUsage(){const e=this.getTextureMemoryUsage();this.updateTextureMemoryUsageColor(e),this.textureMemoryUsageLabel.string=`Texture Mem: ${e.toFixed(2)}MB`}updateTextureMemoryUsageColor(e){this.textureMemoryUsageLabel.color=e>50?Ba:e>35?Ua:za}updateDevicePixelRatio(){const e=this.getDevicePixelRatio();this.updateDevicePixelRatioColor(e),this.devicePixelRatioLabel.string=`Device Pixel Ratio: ${e}`}updateDevicePixelRatioColor(e){this.devicePixelRatioLabel.color=e>2?Ba:e<=1?Ua:za}getFps(){const{counter:e}=this.stats.fps;return Math.floor(e.value)||0}getDrawCalls(){const{counter:e}=this.stats.draws;return e.value||0}getLogicTime(){const{counter:e}=this.stats.logic;return Math.floor(1e3*e.value)/1e3||0}getPhysicTime(){const{counter:e}=this.stats.physics;return Math.floor(1e3*e.value)/1e3||0}getRenderTime(){const{counter:e}=this.stats.render;return Math.floor(1e3*e.value)/1e3||0}getObjectMemoryUsage(){const{counter:e}=this.stats.bufferMemory;return Math.floor(1e3*e.value)/1e3||0}getTextureMemoryUsage(){const{counter:e}=this.stats.textureMemory;return Math.floor(1e3*e.value)/1e3||0}getDevicePixelRatio(){return window.devicePixelRatio||0}}).prototype,"fpsLabel",[ya],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ia=ve(Aa.prototype,"drawCountLabel",[ba],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Pa=ve(Aa.prototype,"logicTimeLabel",[fa],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_a=ve(Aa.prototype,"physicTimeLabel",[wa],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),La=ve(Aa.prototype,"renderTimeLabel",[Sa],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Da=ve(Aa.prototype,"objectMemoryUsageLabel",[va],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Oa=ve(Aa.prototype,"textureMemoryUsageLabel",[Ca],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Na=ve(Aa.prototype,"devicePixelRatioLabel",[Ea],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ta=Aa))||Ta);i._RF.pop(),i._RF.push({},"ca922n1V0RLioEyUJg8hQXH","GameEvents",void 0);var Ga,Ha=function(e){return e.INVITE_FRIENDS="invite-friends",e.REPLAY_FRIENDS="replay-friends",e.SHOW_CHALLENGE_RESULTS="show-challenge-results",e.NEXT_LEVEL="next-level",e.MAX_LEVEL="max-level",e.START_OVER="start-over",e.SELECT_LEVEL="select-level",e.GAME_START="game-start",e.GAME_PAUSE="game-pause",e.GAME_RESUME="game-resume",e.GAME_REPLAY="game-replay",e.GAME_FINISH="game-finish",e.GAME_EXIT="game-exit",e.USE_ITEM="use-item",e.SKIP_LEVEL="skip-level",e.ADD_ITEM="add-item",e.ADD_ITEMS="add-items",e.ADD_COINS="add-coins",e.REMOVE_COINS="remove-coins",e.REMOVE_COINS_SUCCESS="remove-coins-success",e.REMOVE_COINS_FAILED="remove-coins-failed",e.COIN_CHANGED="coin-changed",e.ADD_STARS="add-stars",e.PAUSE_TIME="pause-time",e.RESUME_TIME="resume-time",e.TIME_OUT="time-out",e.HALF_TIME="half-time",e.RESCUE_START="rescue-time",e.RESCUE_FINISHED="clock-animation-finished",e.APPLY_GRAVITY="apply-gravity",e.IDLE_ENTER="idle-enter",e.IDLE_EXIT="idle-exit",e.GRID_MATCH="grid-match",e.GRID_MATCH_SUCCESS="grid-match-success",e.GRID_MATCH_FAIL="grid-match-fail",e.GRID_CLEAR="grid-clear",e.GRID_CREATE="grid-create",e.GRID_RESIZE="grid-resize",e.TILE_CLICK="tile-click",e.BOMB_EXPLODE="bomb-explode",e.SHOW_HINT="show-hint",e.ADD_COMBO="add-combo",e.COMBO_UPDATED="combo-updated",e.COMBO_ENDED="combo-ended",e.ADD_SCORE="add-score",e.SCORE_UPDATED="score-updated",e.REGISTER_ANIMATOR="register-animator",e.UNREGISTER_ANIMATOR="unregister-animator",e.SHOW_UI="show-ui",e.HIDE_UI="hide-ui",e.AUTO_PLAY="auto-play",e.GUIDE_MASK_CLICKED="guide-mask-clicked",e}(Ha||{});i._RF.pop(),i._RF.push({},"8249dDH5xBEc4nnCGRgSjaW","PanelAnimationController",void 0);const{ccclass:Va}=a;let qa=Va("PanelAnimationController")(Ga=class extends s{constructor(){super(...arguments),this.animators=new Set,this.handleRegistration=e=>{if(!e)throw new Error("Invalid event payload.");this.animators.has(e)&&console.warn("Animator already registered."),this.animators.add(e)},this.handleUnregistration=e=>{if(!e)throw new Error("Invalid event payload.");this.animators.has(e)||console.warn("Animator not registered."),this.animators.delete(e)},this.handleShowUIs=e=>{let t=!1;const i=[];this.animators.forEach((e=>{i.push(e)}));const n=[];for(const a of i)a.isReadyForAnimation()||t||(t=!0,e?.fallback?.()),n.push(a.handleShowUI());void 0!==e?.onComplete&&n.length>0&&Promise.all(n).then(e.onComplete)},this.handleHideUIs=e=>{let t=!1;const i=[];this.animators.forEach((e=>{i.push(e)}));const n=[];for(const a of i)a.isReadyForAnimation()||t||(t=!0,e?.fallback?.()),n.push(a.handleHideUI());void 0!==e?.onComplete&&n.length>0&&Promise.all(n).then(e.onComplete)}}init(){this.node.scene.off(Ha.REGISTER_ANIMATOR),this.node.scene.off(Ha.UNREGISTER_ANIMATOR),this.node.scene.off(Ha.SHOW_UI),this.node.scene.off(Ha.HIDE_UI),this.node.scene.on(Ha.REGISTER_ANIMATOR,this.handleRegistration),this.node.scene.on(Ha.UNREGISTER_ANIMATOR,this.handleUnregistration),this.node.scene.on(Ha.SHOW_UI,this.handleShowUIs),this.node.scene.on(Ha.HIDE_UI,this.handleHideUIs)}})||Ga;var Wa,Ka,Ya,ja,Xa,$a,Ja,Qa,Za,es,ts,is,ns,as,ss,os,rs,ls;i._RF.pop(),i._RF.push({},"f190aWZvVlGiplYX4XrZG3a","PanelAnimator",void 0);const{ccclass:cs,property:hs}=a,{Utils:{Object:ds}}=GameCore;let us=(Wa=cs("AnimationConfig"),Ka=hs({type:[A]}),Wa((Xa=ve((ja=class{constructor(){e(this,"startHidden",Xa,this),e(this,"nodes",$a,this),e(this,"posOffset",Ja,this),e(this,"showEase",Qa,this),e(this,"hideEase",Za,this),e(this,"showDuration",es,this),e(this,"hideDuration",ts,this)}setConfig(e){e&&ds.assign(this,e)}}).prototype,"startHidden",[hs],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),$a=ve(ja.prototype,"nodes",[Ka],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Ja=ve(ja.prototype,"posOffset",[hs],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Qa=ve(ja.prototype,"showEase",[hs],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"backOut"}}),Za=ve(ja.prototype,"hideEase",[hs],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"backIn"}}),es=ve(ja.prototype,"showDuration",[hs],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),ts=ve(ja.prototype,"hideDuration",[hs],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Ya=ja))||Ya),ps=(is=cs("PanelAnimator"),ns=hs({type:us,displayName:"Top animation nodes"}),as=hs({type:us,displayName:"Bottom animation nodes"}),is((rs=ve((os=class t extends s{constructor(){super(...arguments),e(this,"topConfig",rs,this),e(this,"botConfig",ls,this),this.isReady=!1}onEnable(){this.node.scene.emit(Ha.REGISTER_ANIMATOR,this)}onDisable(){this.node.scene.emit(Ha.UNREGISTER_ANIMATOR,this)}onLoad(){this.topAnimator=this.createAnimator(this.topConfig,"top"),this.botAnimator=this.createAnimator(this.botConfig,"bottom"),this.initUIPos(),this.isReady=!0}initUIPos(){this.topAnimator.switchState(this.topConfig.startHidden?"hidden":"shown",!0),this.botAnimator.switchState(this.botConfig.startHidden?"hidden":"shown",!0)}isReadyForAnimation(){return this.isReady}async handleShowUI(){if(this.isReady)return Promise.all([this.topAnimator.switchState("shown"),this.botAnimator.switchState("shown")]);console.warn(`${this.node.name}'s ${this.name}: not ready`)}async handleHideUI(){if(this.isReady)return Promise.all([this.topAnimator.switchState("hidden"),this.botAnimator.switchState("hidden")]);console.warn(`${this.node.name}'s ${this.name}: not ready`)}createAnimator(e,i){let{nodes:n,posOffset:a,showEase:s,hideEase:o,showDuration:r,hideDuration:l}=e;const c=n.map((e=>"top"===i&&e.isAlignTop?{mode:"top",value:e.top}:"bottom"===i&&e.isAlignBottom?{mode:"bottom",value:e.bottom}:{mode:"position",value:e.node.position.y})),h=n.map((e=>"top"===i&&e.isAlignTop?{mode:"top",value:e.top+a}:"bottom"===i&&e.isAlignBottom?{mode:"bottom",value:e.bottom-a}:{mode:"position",value:e.node.position.y+a}));let d="shown";return{switchState:function(e){let i=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(d===e)return Promise.resolve(null);d=e;const a="hidden"===e?c:h,u="hidden"===e?h:c,p="hidden"===e?l:r,m="hidden"===e?o:s;return i?(n.forEach(((e,t)=>{const i=a[t],n=u[t].value;"top"===i.mode&&(e.top=n),"bottom"===i.mode&&(e.bottom=n),"position"===i.mode&&(e.node.position=new j(e.node.position.x,n,e.node.position.z))})),Promise.resolve(null)):Promise.all(n.map(((e,i)=>{const n=a[i],s=u[i].value;return vt.runTweenAsync(t.getTween({widget:e,config:n,target:s,easing:m,duration:p}))})))}}}setAnimator(e){let{topConfig:t,botConfig:i}=e;const n=new us,a=new us;n.setConfig(t),a.setConfig(i),this.topConfig=n,this.botConfig=a,this.topAnimator=this.createAnimator(this.topConfig,"top"),this.botAnimator=this.createAnimator(this.botConfig,"bottom"),this.initUIPos()}static getTween(e){let{widget:t,config:i,target:n,easing:a,duration:s}=e;return"top"===i.mode?C(t).call((()=>{t.top=i.value})).to(s,{top:n},{easing:a}):"bottom"===i.mode?C(t).call((()=>{t.bottom=i.value})).to(s,{bottom:n},{easing:a}):C(t.node.position).call((()=>{t.node.position=new j(t.node.position.x,i.value,t.node.position.z)})).to(s,{y:n},{easing:a})}}).prototype,"topConfig",[ns],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new us}}),ls=ve(os.prototype,"botConfig",[as],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new us}}),ss=os))||ss);var ms,gs,ys,bs;i._RF.pop(),i._RF.push({},"6ea01hdw/9MHb28SCDAiRss","ResizeWithBannerAd",void 0);const{ccclass:fs,requireComponent:ws,property:Ss}=a,{ads:vs,event:Cs}=globalThis.game,{Events:Es,Configs:{Ads:Ts},Plugins:{Ads:{Types:As,Status:Rs}}}=GameCore;fs("ResizeWithBannerAd")(ms=ws(A)((ys=ve((gs=class t extends s{constructor(){super(...arguments),e(this,"willShowBanner",ys,this),e(this,"includeSAB",bs,this),this.handleAdShow=e=>{let{placementId:t}=e;if(null===t)return;vs.getAdByPlacementId(t)?.type===As.BANNER&&this.resizeToFitBannerAd()},this.handleAdClose=e=>{let{placementId:t}=e;if(null===t)return;vs.getAdByPlacementId(t)?.type===As.BANNER&&this.updateWidgets(vs.getSafeAreaBottom($i.cssSizeToWorldSize(1)))}}__preload(){this.widget=this.getComponent(A),Fe.lazyValidateProperties(this),Cs.on(Es.AD_SHOWING,this.handleAdShow),Cs.on(Es.AD_CLOSED,this.handleAdClose)}onDestroy(){Cs.off(Es.AD_SHOWING,this.handleAdShow),Cs.off(Es.AD_CLOSED,this.handleAdClose)}start(){const e=vs.getSafeAreaBottom($i.cssSizeToWorldSize(1));this.willShowBanner||t.isBannerAdShowing()?this.resizeToFitBannerAd():e>0&&this.includeSAB&&this.updateWidgets(e)}resizeToFitBannerAd(){const{Enabled:e,BannerDisplayAdOptions:t}=Ts;if(!e)return;if(!this.widget.isAlignBottom)return void console.warn("Widget does not align to bottom, ResizeWithBannerAds will have no effect!");let i=null,n=null,a=null,s=null;const o=$i.cssSizeToWorldSize(1);t.forEach((e=>{let{PlacementId:t,Position:r,BannerWidth:l}=e;if(vs.canbeShowBannerAd(t))switch(r){case"top":i=vs.getBannerHeight(t,o);break;case"bottom":n=vs.getBannerHeight(t,o,this.includeSAB);break;case"left":{if(void 0===l)break;let e=l;"getBannerOffset"in GameSDK.extra&&(e+=GameSDK.extra.getBannerOffset()),a=e*o;break}case"right":{if(void 0===l)break;let e=l;"getBannerOffset"in GameSDK.extra&&(e+=GameSDK.extra.getBannerOffset()),s=e*o;break}}})),this.updateWidgets(i,n,a,s)}updateWidgets(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;this.widget.top=e??this.widget.top,this.widget.bottom=t??this.widget.bottom,this.widget.left=i??this.widget.left,this.widget.right=n??this.widget.right,this.widget.updateAlignment();this.getComponentsInChildren(A).forEach((e=>{e.updateAlignment()}))}static isBannerAdShowing(){return vs.enabled&&vs.getAdStatus(As.BANNER)===Rs.SHOWING}}).prototype,"willShowBanner",[Ss],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),bs=ve(gs.prototype,"includeSAB",[Ss],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),ms=gs))||ms);var Is,Ps,_s,Ls,Ds,Os,Ns,Ms,ks,xs,Fs;i._RF.pop(),i._RF.push({},"3d28fQaHU5Lm4/Zyq/Jd2b6","TapperedProgressBar",void 0);const{ccclass:Bs,property:zs,executeInEditMode:Us,requireComponent:Gs}=a;let Hs=(Is=Bs("TapperedProgressBar"),Ps=Gs(x),_s=zs({type:x,displayName:"Fill opacity"}),Ls=zs({type:R,displayName:"Left Cap",tooltip:"If assigned, will be displayed when progress is larger than 0%"}),Ds=zs({type:R,displayName:"Right Cap",tooltip:"If assigned, will be displayed when progress is at 100%"}),Os=zs({range:[0,1,.01],slide:!0,tooltip:"i18n:progress.progress",override:!0}),Is(Ns=Us(Ns=Ps((ks=ve((Ms=class extends X{constructor(){super(...arguments),e(this,"uiOpacity",ks,this),e(this,"leftCap",xs,this),e(this,"rightCap",Fs,this)}get progress(){return super.progress}set progress(e){super.progress=e,this.updateAppearance()}updateAppearance(){if(null===this.uiOpacity)return;if(this.progress<=0)return void(this.uiOpacity.opacity=0);if(this.progress>.1)return void(this.uiOpacity.opacity=255);const e=Math.floor(this.progress/.05*255);this.uiOpacity.opacity=e}start(){this.updateAppearance()}}).prototype,"uiOpacity",[_s],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),xs=ve(Ms.prototype,"leftCap",[Ls],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Fs=ve(Ms.prototype,"rightCap",[Ds],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ve(Ms.prototype,"progress",[Os],Object.getOwnPropertyDescriptor(Ms.prototype,"progress"),Ms.prototype),Ns=Ms))||Ns)||Ns)||Ns);var Vs,qs,Ws,Ks,Ys,js,Xs,$s,Js,Qs;i._RF.pop(),i._RF.push({},"bce15LcVrxOfYMa9rbXN/qi","Localize",void 0);const{ccclass:Zs,property:eo,requireComponent:to,executeInEditMode:io,disallowMultiple:no}=a,{language:ao}=globalThis.game;Vs=Zs("Localize"),qs=to(h),Ws=io(!0),Ks=eo({visible:!0}),Ys=eo({group:{name:"Fonts",id:"fonts",displayOrder:1},type:$}),js=eo({group:{name:"Fonts",id:"fonts",displayOrder:2},type:$}),Vs(Xs=no(Xs=qs(Xs=Ws((ve(($s=class extends s{constructor(){super(...arguments),e(this,"enFont",Js,this),e(this,"ruFont",Qs,this),this.handleLanguageChanged=()=>{this.updateTransToNode()}}set key(e){e&&(this._key=e,this.updateTransToNode())}get key(){return this._key}__preload(){this.label=this.getComponent(h),this.validateRequiredComponents(),this.updateTransToNode()}validateRequiredComponents(){Fe.lazyValidateProperties(this)}start(){this.listenEvent()}listenEvent(){W.on("update-language",this.handleLanguageChanged)}updateTransToNode(){if(this.node.active&&this._key)try{const e=ao.getText(this._key),t=this.getFontByLang();this.label.font=t,this.label.string=e,this.node.emit("update-trans",e)}catch(e){console.warn(e)}}getFontByLang(){if(!this.enFont||!this.ruFont)throw new Error("Font is not found");switch(ao.getCurrentLocale()){case"en":return this.enFont;case"ru":return this.ruFont;default:return this.enFont}}}).prototype,"key",[Ks],Object.getOwnPropertyDescriptor($s.prototype,"key"),$s.prototype),Js=ve($s.prototype,"enFont",[Ys],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Qs=ve($s.prototype,"ruFont",[js],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Xs=$s))||Xs)||Xs)||Xs);var so,oo,ro,lo,co,ho,uo,po,mo;i._RF.pop(),i._RF.push({},"aef305TaZhKVo1f4/qH1kf+","SecondOrderDynamics",void 0);const{ccclass:go,property:yo}=a;class bo{constructor(e,t){t=t??{response:1,dampen:1,eager:1},this.k1=bo.calcK1(t),this.k2=bo.calcK2(t),this.k3=bo.calcK3(t),this.xp=e.clone(),this.y=e.clone(),this.yd=new J(0,0)}update(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;null===i&&(i=new J((t.x-this.xp.x)/e,(t.y-this.xp.y)/e),this.xp.x=t.x,this.xp.y=t.y);const n=Math.max(this.k2,e*e/2+e*this.k1/2,e*this.k1);return this.y.x=this.y.x+e*this.yd.x,this.y.y=this.y.y+e*this.yd.y,this.yd.x=this.yd.x+e*(t.x+this.k3*i.x-this.y.x-this.k1*this.yd.x)/n,this.yd.y=this.yd.y+e*(t.y+this.k3*i.y-this.y.y-this.k1*this.yd.y)/n,this.y}setDynamics(e){this.k1=bo.calcK1(e),this.k2=bo.calcK2(e),this.k3=bo.calcK3(e)}reset(e){this.xp.set(e.x,e.y),this.y.set(e.x,e.y),this.yd.set(0,0)}get currentState(){return this.y}static calcK1(e){return e.dampen/(Math.PI*e.response)}static calcK2(e){return 1/(2*Math.PI*e.response*(2*Math.PI*e.response))}static calcK3(e){return e.eager*e.dampen/(2*Math.PI*e.response)}}let fo=(so=go("SODConfig"),oo=yo({type:E,displayName:"Responsiveness",tooltip:"Higher values will result shorter response times."}),ro=yo({type:E,displayName:"Dampening",tooltip:"Higher values will result in less overshoot and oscillation."}),lo=yo({type:E,displayName:"Eagerness",tooltip:"Higher values will result in more overshoot and oscillation, negative values will result in anticipation."}),so((uo=ve((ho=class{constructor(){e(this,"response",uo,this),e(this,"dampen",po,this),e(this,"eager",mo,this)}}).prototype,"response",[oo],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 200}}),po=ve(ho.prototype,"dampen",[ro],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 20}}),mo=ve(ho.prototype,"eager",[lo],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),co=ho))||co);var wo,So,vo,Co,Eo,To,Ao,Ro,Io;i._RF.pop(),i._RF.push({},"e9e74FEHyRLvar32WZD/F11","Trail",void 0);const{ccclass:Po,property:_o}=a;let Lo=(wo=Po("Trail"),So=_o({type:n,displayName:"Target"}),vo=_o({type:q,displayName:"Graphics"}),Co=_o({type:[fo],displayName:"Trail Nodes"}),wo((Ao=ve((To=class extends s{constructor(){super(...arguments),e(this,"target",Ao,this),e(this,"graphics",Ro,this),e(this,"trailNodes",Io,this),this.trailNodeInstances=[]}reset(){for(const e of this.trailNodeInstances)e.reset(new J(this.node.worldPosition.x,this.node.worldPosition.y));this.graphics.clear()}onLoad(){this.validateRequiredComponents(),this.spawnTrailNodes()}update(e){this.graphics.clear();const t=this.trailNodeInstances[0];this.drawTrail(e,t,this.target.worldPosition.x,this.target.worldPosition.y);for(let t=1;t<this.trailNodeInstances.length;t++){const i=this.trailNodeInstances[t-1],n=this.trailNodeInstances[t];this.drawTrail(e,n,i.currentState.x,i.currentState.y)}}drawTrail(e,t,i,n){const{graphics:a}=this,s=new J(i,n),o=t.update(e,s),r=new j(s.x,s.y,0),l=new j(o.x,o.y,0);a.node.inverseTransformPoint(r,r),a.node.inverseTransformPoint(l,l),a.moveTo(r.x,r.y),a.lineTo(l.x,l.y),a.stroke()}spawnTrailNodes(){for(const e of this.trailNodes){const t=new J(this.node.worldPosition.x,this.node.worldPosition.y),i=new bo(t,e);this.trailNodeInstances.push(i)}}validateRequiredComponents(){if(!this.target)throw new Error("Target is not set");if(!this.graphics)throw new Error("Graphics is not set");0===this.trailNodes.length&&console.warn("No trail nodes are set")}}).prototype,"target",[So],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ro=ve(To.prototype,"graphics",[vo],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Io=ve(To.prototype,"trailNodes",[Co],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Eo=To))||Eo);var Do,Oo,No,Mo,ko,xo,Fo,Bo,zo,Uo,Go,Ho,Vo,qo,Wo,Ko,Yo,jo,Xo,$o,Jo,Qo,Zo,er,tr,ir;i._RF.pop(),i._RF.push({},"a2260jBMJFPCrn/Q4Vo4iB1","BatchNodes",void 0);const{ccclass:nr,executionOrder:ar,property:sr}=a,{Utils:{Array:or}}=GameCore,rr="Batch By Name",lr="Batch Label",cr="Batch Sprite";let hr=(Do=nr("BatchNodes"),Oo=ar(99999),No=sr({group:{name:rr}}),Mo=sr({type:[f],group:{name:rr}}),ko=sr({type:[b],group:{name:rr}}),xo=sr({group:{name:lr}}),Fo=sr({group:{name:lr}}),Bo=sr({group:{name:lr}}),zo=sr({group:{name:cr}}),Uo=sr({group:{name:cr}}),Go=sr({readonly:!0}),Ho=sr({readonly:!0}),Vo=sr({readonly:!0}),Do(qo=Oo((Ko=ve((Wo=class extends s{constructor(){super(...arguments),e(this,"batchByName",Ko,this),e(this,"depthNames",Yo,this),e(this,"listName",jo,this),e(this,"batchLabel",Xo,this),e(this,"depthLabel",$o,this),e(this,"typeLabel",Jo,this),e(this,"batchSprite",Qo,this),e(this,"depthSprite",Zo,this),e(this,"batchAllNodes",er,this),e(this,"batchDepth",tr,this),e(this,"checkOverlap",ir,this),this.batchNode={},this.labelChildren=[],this.spriteChildren=[],this.allChildren=[],this.nameChildren=[],this.originalParents={},this.isInited=!1,this.onAfterUpdate=()=>{this.isInited&&this.hierarchyChildren()},this.onAfterRender=()=>{this.isInited&&this.restoreOriginalChildren()}}__preload(){this.enabled&&(m.on(Q.EVENT_AFTER_UPDATE,this.onAfterUpdate),m.on(Q.EVENT_AFTER_RENDER,this.onAfterRender))}onDestroy(){m.off(Q.EVENT_AFTER_UPDATE,this.onAfterUpdate),m.off(Q.EVENT_AFTER_RENDER,this.onAfterRender)}onLoad(){this.enabled&&(this.setupBatchNodes(this.node),this.isInited=!0)}onEnable(){m.on(Q.EVENT_AFTER_UPDATE,this.onAfterUpdate),m.on(Q.EVENT_AFTER_RENDER,this.onAfterRender),this.setupBatchNodes(this.node),this.isInited=!0}onDisable(){this.restoreOriginalChildren(),m.off(Q.EVENT_AFTER_UPDATE,this.onAfterUpdate),m.off(Q.EVENT_AFTER_RENDER,this.onAfterRender),this.isInited=!1}setupBatchNodes(e){this.allChildren=[],this.nameChildren=[],this.labelChildren=[],this.spriteChildren=[],this.saveOriginalChildren(e),this.createGlobalNodes(e),this.createGlobalNameNodes(e),this.createGlobalLabelNode(e),this.createGlobalSpriteNode(e),this.sortGlobalNodes()}sortGlobalNodes(){this.batchNode.node?.setSiblingIndex(0),this.batchNode.label?.setSiblingIndex(this.depthLabel),this.batchNode.sprite?.setSiblingIndex(this.depthSprite),this.listName.forEach(((e,t)=>{this.batchNode[e]?.setSiblingIndex(this.depthNames[t])}))}createGlobalNodes(e){if(!this.batchAllNodes)return;const t=new n("GlobalBatchNode");t.active=!0,this.batchNode.node=t,e.addChild(t)}createGlobalNameNodes(e){this.batchByName&&this.listName.forEach((t=>{if(this.batchNode[t])return;const i=new n(t);i.active=!0,this.batchNode[t]=i,e.addChild(i)}))}createGlobalLabelNode(e){if(!this.batchLabel)return;const t=new n("GlobalLabelNode");t.active=!0,this.batchNode.label=t,e.addChild(t)}createGlobalSpriteNode(e){if(!this.batchSprite)return;const t=new n("GlobalSpriteNode");t.active=!0,this.batchNode.sprite=t,e.addChild(t)}saveOriginalParents(){[...this.labelChildren,...this.spriteChildren].forEach((e=>{e.node.parent&&(this.originalParents[e.uuid]=e.node.parent)})),this.nameChildren.forEach((e=>{e.parent&&(this.originalParents[e.uuid]=e.parent)}))}saveOriginalChildren(e){e.children.forEach((e=>{this.saveLabelChildren(e),this.saveSpriteChildren(e),this.saveNodeChildrenByName(e),this.saveNodeChildrenByType(e)})),this.saveOriginalParents()}saveLabelChildren(e){if(!this.batchLabel)return;const t=e.getComponentsInChildren(h);"char"===this.typeLabel&&t.filter((e=>e.cacheMode===h.CacheMode.CHAR)),0!==t.length&&this.labelChildren.push(...t)}saveSpriteChildren(e){if(!this.batchSprite)return;const t=e.getComponentsInChildren(R);0!==t.length&&this.spriteChildren.push(...t)}saveNodeChildrenByName(e){this.batchByName&&e.children.forEach((e=>{or.has(this.listName,e.name)?this.nameChildren.push(e):this.saveNodeChildrenByName(e)}))}saveNodeChildrenByType(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!this.batchAllNodes)return;const i=e.getComponentsInChildren(s);this.allChildren.push(...i),this.batchDepth>0&&t<this.batchDepth&&this.allChildren.forEach((e=>{this.saveNodeChildrenByType(e.node,this.batchDepth)}))}hierarchyChildren(){let e;this.labelChildren.forEach((t=>{t.node.isValid&&t.node.activeInHierarchy&&(e=this.batchNode.label,t.node.isChildOf(e)||(t.node.setParent(e,!0),t.node.layer=Z.Enum.UI_2D))})),this.spriteChildren.forEach((t=>{t.node.isValid&&t.node.activeInHierarchy&&(e=this.batchNode.sprite,t.node.isChildOf(e)||(t.node.setParent(e,!0),t.node.layer=Z.Enum.UI_2D))})),this.allChildren.forEach((t=>{t.node.isValid&&t.node.activeInHierarchy&&(e=this.batchNode.node,t.node.isChildOf(e)||(t.node.setParent(e,!0),t.node.layer=Z.Enum.UI_2D))})),this.allChildren.sort(((e,t)=>{const i=e.constructor.name,n=t.constructor.name;return i<n?-1:i>n?1:0})),this.nameChildren.forEach((t=>{if(!t.isValid)return;if(!t.activeInHierarchy)return;if(!t.isTransformDirty())return;const i=t.getComponent(x);i&&i.opacity<1||(e=this.batchNode[t.name],t.isChildOf(e)||(t.setParent(e,!0),t.layer=Z.Enum.UI_2D))}))}restoreOriginalChildren(){const e=[...this.labelChildren,...this.spriteChildren];e.length>0&&e.forEach((e=>{const t=this.originalParents[e.uuid];t&&(e.node.isChildOf(t)||e.node.setParent(t,!0))})),this.nameChildren.forEach((e=>{const t=this.originalParents[e.uuid];t&&(e.isChildOf(t)||e.setParent(t,!0))}))}}).prototype,"batchByName",[No],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Yo=ve(Wo.prototype,"depthNames",[Mo],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),jo=ve(Wo.prototype,"listName",[ko],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Xo=ve(Wo.prototype,"batchLabel",[xo],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),$o=ve(Wo.prototype,"depthLabel",[Fo],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),Jo=ve(Wo.prototype,"typeLabel",[Bo],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"char"}}),Qo=ve(Wo.prototype,"batchSprite",[zo],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Zo=ve(Wo.prototype,"depthSprite",[Uo],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),er=ve(Wo.prototype,"batchAllNodes",[Go],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),tr=ve(Wo.prototype,"batchDepth",[Ho],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),ir=ve(Wo.prototype,"checkOverlap",[Vo],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),qo=Wo))||qo)||qo);var dr;i._RF.pop(),i._RF.push({},"9b958Lf6PFClb/JuJfTLzxG","Vibrate",void 0);const{ccclass:ur}=a,{Utils:{Browser:pr}}=GameCore,{player:mr}=globalThis.game;let gr=ur("Vibrate")(dr=class extends s{vibrate(e){if(!this.isVibrateEnable())return;if(!pr.vibrate(e)){if("performHapticFeedbackAsync"in GameSDK.extra)return void GameSDK.extra.performHapticFeedbackAsync();console.warn("Vibrate failed")}}isVibrateEnable(){return!!mr.getPlayerSetting("vibrate")}})||dr;i._RF.pop(),i._RF.push({},"358fdIqjFdNzZGa95REWt2F","Ads",void 0);const yr=1/6;i._RF.pop(),i._RF.push({},"542caJcCPRMI5EaOkgOzhek","ItemKeys",void 0);const br={HINT:"hint",THUNDER:"thunder",STORM:"storm",PLIERS:"pliers"};i._RF.pop(),i._RF.push({},"62927KYr+tCcIzOaPtVc/q8","CoinData",void 0);const fr=10,wr=50,Sr=100,vr={[br.HINT]:80,[br.THUNDER]:200,[br.STORM]:150,[br.PLIERS]:150},Cr=200,Er=40;i._RF.pop(),i._RF.push({},"8328a20Ku5GF4anma0sBaxm","DailyRewardsData",void 0);const Tr={0:{id:1,type:"coin",value:20},1:{id:2,type:"coin",value:30},2:{id:3,type:"coin",value:50},3:{id:4,type:"coin",value:100},4:{id:5,type:"coin",value:150},5:{id:6,type:"coin",value:200},6:{id:7,type:"coin",value:250,items:{hint:3,thunder:3,storm:3,pliers:0}}};i._RF.pop(),i._RF.push({},"8875b8IrVpJWJr/45aS1gql","DefaultRespMatchData",void 0);const{Dtos:{Match:{Data:Ar}}}=GameCore,Rr={...Ar.getDefaultData(),extraData:null};i._RF.pop(),i._RF.push({},"ad867amogBFGJo9jp78EnQP","DevTools",void 0);var Ir=function(e){return e.UNLOCK_DEV_TOOLS="unlock-dev-tools",e.TRIGGER_UNLOCK_KEY="trigger-unlock-key",e.TRIGGER_RESET_SEQUENCE="trigger-reset-sequence",e}(Ir||{});const Pr={Events:Ir,UNLOCK_SEQUENCE:"101013012031"};i._RF.pop(),i._RF.push({},"7decaASyaFOAp2izq8DsREg","TotalLevel",void 0);i._RF.pop(),i._RF.push({},"f8533KH/fxOfYqya9sgLrSj","GameData",void 0);const _r={level:0,coins:0,stars:0,totalLevel:80,levelVersion:0,lastRewardedItems:0,lastCreateTournamentShown:0,guideItemShowed:[],items:{[br.HINT]:0,[br.THUNDER]:0,[br.STORM]:0,[br.PLIERS]:0},skins:{}};i._RF.pop(),i._RF.push({},"52b52FNwvhBKY/becAy420o","Leaderboard",void 0);const Lr="global-leaderboard-key",Dr="friends-leaderboard-key",Or="global-leaderboard-id",Nr="friends-leaderboard-id";i._RF.pop(),i._RF.push({},"3b9bcPJBxpNOqG2I6exTOVn","MatchCustomData",void 0);const{Dtos:{Match:{CustomData:Mr}}}=GameCore,kr={...Mr.getDefaultData(),score:0};i._RF.pop(),i._RF.push({},"074c4KXFZ1Pq6d+66PrLd2+","PlayerData",void 0);const xr={score:0,endlessScore:0,settings:{sound:!0,music:!0,vibrate:!0,language:"en"},gameData:_r,isFirstLogin:!0,dailyRewarded:{logDays:[],lastRewarded:0}};i._RF.pop(),i._RF.push({},"32598ObpVZK/pecmWIdcs+7","SceneKeys",void 0);const Fr="BootScene",Br="GameScene",zr="DashboardScene",Ur="ChallengeResultScene";i._RF.pop(),i._RF.push({},"f16ffbXQPtDK58g6BNFwzJv","Tournament",void 0);var Gr=function(e){return e.RELOAD_TOURNAMENT="reload-tournament",e}(Gr||{});i._RF.pop(),i._RF.push({},"598f2UgQ+NGBYLWv34s6Vev","renderCustomResultChallenge",void 0);const{Configs:{FrameCapture:{Enabled:Hr,WideframeConfigs:Vr}},Utils:{Object:qr}}=GameCore,Wr=async e=>{if(!Hr)return console.warn("FrameCapture is not enabled"),null;const t=Yr(e);if(!t)return null;Kr(t,Vr.CustomResultChallenge);const{frameCapture:i}=window.game,{Width:n,Height:a}=Vr.CustomResultChallenge;return i.captureAsync({name:"CustomResultChallenge",width:n,height:a,renderOptions:t})},Kr=(e,t)=>{const{Width:i,Height:n,Wideframe:a}=t;e.wideframe={name:"custom-result-challenge",type:"image",depth:0,image:a,size:[i,n],position:[0,0]}},Yr=e=>{try{const{playerId:t="10",playerPhoto:i="",playerScore:n=0,opponentId:a="20",opponentPhoto:s="",opponentScore:o=0,isPlayerFinished:r,isOpponentFinished:l}=e,{RenderOptions:c}=Vr.CustomResultChallenge,h=qr.camelCaseKeys(qr.clone(c)),{playerPhoto:d,opponentPhoto:u}=h,p=n===o,m=n>o,g=r??l,y=r&&l;return"image"===d.type&&(d.name=`${t}`,d.image=i),"image"===u.type&&(u.name=`${a}`,u.image=s),g&&jr(h,{playerScore:n,opponentScore:o,isPlayerFinished:r,isOpponentFinished:l}),!y||p?(delete h.leftCrown,delete h.rightCrown,h):(m?delete h.rightCrown:delete h.leftCrown,h)}catch(e){return console.warn("getRenderOptionsShareScore",e),null}},jr=(e,t)=>{const{leftScore:i,rightScore:n}=e,{playerScore:a=0,opponentScore:s=0,isPlayerFinished:o,isOpponentFinished:r}=t;"text"===i.type&&(i.text=o?`${a}`:"???"),"text"===n.type&&(n.text=r?`${s}`:"???")};i._RF.pop(),i._RF.push({},"ad7acMQ2iJNKKA2RkT+nGNI","CommonError",void 0);class Xr extends Error{constructor(e,t){super(t),this.code=e}}i._RF.pop(),i._RF.push({},"5ff78u05/tPepABfMzNaOjM","PlayerHasTournamentError",void 0);class $r extends Xr{constructor(e,t){super("PLAYER_HAS_TOURNAMENT","Player has a tournament"),this.playerId=e,this.tournamentId=t}}i._RF.pop(),i._RF.push({},"e14dbcdc89LQJIggfi5qO6U","MapData",void 0);const Jr={themeNames:["summer","autumn","winter"],skinNames:["cakes","car","cosmetics","flower","fruit","ice-cream","sport","tool"],mapOrder:[{id:1,theme:"summer",skin:"fruit",levelCount:10},{id:2,theme:"autumn",skin:"flower",levelCount:10},{id:3,theme:"winter",skin:"tool",levelCount:10},{id:4,theme:"summer",skin:"sport",levelCount:10},{id:5,theme:"autumn",skin:"cosmetics",levelCount:10},{id:6,theme:"winter",skin:"ice-cream",levelCount:10},{id:7,theme:"summer",skin:"cakes",levelCount:10},{id:8,theme:"autumn",skin:"car",levelCount:10}]};i._RF.pop(),i._RF.push({},"c0656MbbYRE+KSk63rv74ZI","SkinKeys",void 0);const Qr="cakes",Zr="flower",el="fruit";i._RF.pop(),i._RF.push({},"3f1dbbPrPVBy5lNYySV74Qq","ThemeKeys",void 0);const tl={SUMMER:"summer",AUTUMN:"autumn",WINTER:"winter"};I(tl),i._RF.pop(),i._RF.push({},"6093adbLQZKpqgUpTV/sHj1","ThemeUtils",void 0);const{player:il,storage:nl}=globalThis.game,{Array:al}=GameCore.Utils,sl={currentProgress:0,maxProgress:10,isLocked:!0,themeId:"summer"},ol={id:0,currentSkin:Qr,currentTheme:tl.SUMMER,nextSkin:null,nextTheme:null,progress:0,max:10},rl={skin:"cakes",themeId:"summer",progress:0,max:10,isLocked:!0};class ll{constructor(){this.mapData=Jr,this.playerSkinProgress=null}static getInstance(){return this._instance||(this._instance=new ll),this._instance}static init(){const e=this.getInstance();e.updatePlayerSkinProgress(),e.initDashboardSceneStorage()}initDashboardSceneStorage(){const e=nl.getStorage("dashboard");if(null!=e)return;const t=this.getCurrentMapProgressInstance();nl.addStorage("dashboard",{lastMapPayload:t,numOfMapsPassed:0,animateToCurrentLevel:!1});const i=nl.getStorage("collection");if(null!=i)return;nl.addStorage("collection",{lastMapPack:t.id,animateMapPackUnlock:!1});const n=nl.getStorage("leaderboard_content");if(null!=n)return;nl.addStorage("leaderboard_content",{lastTabOpened:"global"});const a=nl.getStorage("tournament");null==a&&nl.addStorage("tournament",{animateTournamentLeader:!1})}static getCurrentMapProgress(){return this.getInstance().getCurrentMapProgressInstance()}getCurrentMapProgressInstance(){if(null===this.playerSkinProgress)return console.warn("getCurrentMapProgress: playerSkinProgress not found. Have you called init()?"),ol;const e=this.mapData.mapOrder;let t,i,n,a,s=0,o=0,r=0;for(let l=0;l<e.length;l++){const c=this.playerSkinProgress[e[l].skin];if(c.currentProgress<c.maxProgress){r=e[l].id,t=e[l].skin,i=e[l].theme,n=e[l+1]?.skin??t,a=e[l+1]?.theme??i,s=c.currentProgress,o=c.maxProgress;break}}if(void 0===t||void 0===n||void 0===i||void 0===a){const l=e[e.length-1];return r=l.id,t=l.skin,i=l.theme,n=l.skin,a=l.theme,s=l.levelCount,o=l.levelCount,console.log("getMapCurrentProgress: all skin completed"),{id:r,currentSkin:t,currentTheme:i,nextSkin:n,nextTheme:a,progress:s,max:o}}return console.log("getMapCurrentProgress",t,n,s,o),{id:r,currentSkin:t,currentTheme:i,nextSkin:n,nextTheme:a,progress:s,max:o}}static getUnlockedSkins(){return this.getInstance().getUnlockedSkinsInstance()}getUnlockedSkinsInstance(){if(null===this.playerSkinProgress||void 0===this.playerSkinProgress)return console.warn("getUnlockedSkins: playerSkinProgress not found. Have you called init()?"),["cakes"];const e=Object.keys(this.playerSkinProgress),t=[];for(const i of e){const{isLocked:e}=this.playerSkinProgress[i];e||t.push(i)}return console.log("getUnlockedSkins",t),t}static getLevelSkin(e){return this.getInstance().getLevelSkinInstance(e)}getLevelSkinInstance(e){const t=e??1,{mapOrder:i}=this.mapData;let n=0;for(const e of i){if(n+e.levelCount>=t)return console.log("getMapSkin",e.skin),e.skin;n+=e.levelCount}const a=i[i.length-1];return console.log("getMapSkin",a.skin),a.skin}static getLevelTheme(e){return this.getInstance().getLevelThemeInstance(e)}getLevelThemeInstance(e){const t=e??1,{mapOrder:i}=this.mapData;let n=0;for(const e of i){if(n+e.levelCount>=t)return console.log("getMapTheme",e.theme),e.theme;n+=e.levelCount}const a=i[i.length-1];return console.log("getMapTheme",a.theme),a.theme}static getCollectionUnlockProgress(){return this.getInstance().getCollectionUnlockProgressInstance()}getCollectionUnlockProgressInstance(){if(null===this.playerSkinProgress)return console.warn("getCollectionUnlockProgress: playerSkinProgress not found. Have you called init()?"),[rl];const e=[];for(const t of Object.entries(this.playerSkinProgress)){const{currentProgress:i,maxProgress:n,isLocked:a,themeId:s}=t[1];e.push({progress:i,max:n,isLocked:a,skin:t[0],themeId:s})}return e}updatePlayerSkinProgress(){const e=il.getGameData();if(e?.skins&&Object.keys(e.skins).length>0){this.playerSkinProgress={};for(const t of Object.keys(e.skins))this.playerSkinProgress[t]={...sl,...e.skins[t]};return}console.log("getPlayerSkinProgress: playerData not found, use data from level");const t=this.mapData.mapOrder;this.playerSkinProgress={};for(const e of t)this.playerSkinProgress[e.skin]={themeId:e.theme,currentProgress:0,maxProgress:e.levelCount,isLocked:!0};this.updatePlayerSkinProgressByLevel(),console.log(this.playerSkinProgress)}updatePlayerSkinProgressByLevel(){let e=(il.getGameData()?.level??1)-1;const{mapOrder:t}=this.mapData;this.playerSkinProgress[t[0].skin].isLocked=!1;for(const i of t){const{levelCount:t,skin:n}=i;if(e<=0)continue;const a=e-t>=0?t:e;e-=a,console.log("getPlayerSkinProgressByLevel",n,a),this.increaseProgressInstance(n,a,!1)}}static increaseProgress(e,t,i){this.getInstance().increaseProgressInstance(e,t,i)}increaseProgressInstance(e,t,i){if(null===this.playerSkinProgress)return void console.warn("increaseProgress: playerSkinProgress not found. Have you called init()?");if(!this.playerSkinProgress[e])return void console.warn("increaseProgress: skin not found",e);const{currentProgress:n,maxProgress:a}=this.playerSkinProgress[e],s=n+t>a?a:n+t;if(s>0&&(this.playerSkinProgress[e].isLocked=!1),s===a){const t=this.mapData.mapOrder,i=t[al.searchIndex(t,(t=>t.skin===e))+1]?.skin;i&&this.unlockSkinInstance(i,!1)}this.playerSkinProgress[e].currentProgress=s,this.playerSkinProgress[e].maxProgress=a,i&&this.syncPlayerSkinProgress()}static unlockSkin(e,t){this.getInstance().unlockSkinInstance(e,t)}unlockSkinInstance(e,t){null!==this.playerSkinProgress?this.playerSkinProgress[e]?(this.playerSkinProgress[e].isLocked=!1,t&&this.syncPlayerSkinProgress()):console.warn("unlockSkin: skin not found",e):console.warn("unlockSkin: playerSkinProgress not found. Have you called init()?")}syncPlayerSkinProgress(){il.setGameData({skins:this.playerSkinProgress})}}i._RF.pop(),i._RF.push({},"0397cr2IpZEwbRzwQhlVHMO","MatchUtils",void 0);const{match:cl,player:hl,leaderboard:dl,frameCapture:ul}=globalThis.game,{Utils:{Object:pl,Valid:ml,String:gl,Array:yl},Match:{Modes:bl},Dtos:{Match:{Data:fl}}}=GameCore,wl=["Champion","Ultimate","Grand","Elite","Master's","Premier","Epic","Pro's","Supreme","Legendary","Victory","Prime","Titan's","Hero's","Star's"];class Sl{static get inst(){return this._instance||(this._instance=new Sl),this._instance}static async startMatchAsync(e){try{switch(e??this.getMatchMode()){case bl.SINGLE:await this.inst.processStartSingleModeAsync();break;case bl.TOURNAMENT:await this.inst.processStartTournamentModeAsync();break;case bl.CHALLENGE_FRIEND:await this.inst.processStartChallengeModeAsync();break;default:await this.inst.processStartSingleModeAsync()}}catch(e){console.warn("startMatchAsync",e)}}static async setProfileMatchDataAsync(e){try{await cl.handler.setProfileData(e)}catch(e){console.warn("setProfileMatchDataAsync",e)}}static async setMatchCustomDataAsync(e){try{await cl.handler.setMatchCustomData(e)}catch(e){console.warn("setMatchCustomDataAsync",e)}}static async setLeaderboardScoreAsync(e){try{await cl.handler.setLeaderboardScore(e)}catch(e){console.warn("setLeaderboardScoreAsync",e)}}static async finishMatchAsync(e){try{switch(this.getMatchMode()){case bl.SINGLE:await this.inst.processFinishSingleModeAsync();break;case bl.TOURNAMENT:await this.inst.processFinishTournamentModeAsync();break;case bl.CHALLENGE_FRIEND:await this.inst.processFinishChallengeModeAsync(e);break;default:await this.inst.processFinishSingleModeAsync()}}catch(e){console.warn("finishMatchAsync",e)}}static async joinTournamentAsync(e){const t=hl.getPlayerId();await cl.tournament.join.processAsync({tournamentId:e,playerId:t})}static async continueTournamentAsync(e){const t=hl.getPlayerId();await cl.tournament.continue.processAsync({playerId:t,contextId:e})}async processStartSingleModeAsync(){const e=hl.getPlayerId();await cl.single.start.processAsync({playerId:e})}async processFinishSingleModeAsync(){await cl.single.finish.processAsync()}async processStartTournamentModeAsync(){const e=hl.getPlayerId(),t=GameSDK.context.getID();await cl.tournament.continue.processAsync({playerId:e,contextId:t})}async processFinishTournamentModeAsync(){const e=hl.getPlayerId(),t=hl.getBestScore();await cl.tournament.finish.processAsync({playerId:e,bestScore:t})}async processStartChallengeModeAsync(){try{await this.processContinueChallengeAsync()}catch(e){if(!pl.hasOwn(e,"name")||ml.isString(e.name))throw e;"PlayerHasFinishedMatch"===e.name&&await this.processChallengeNewOpponentAsync(),"PlayerNotJoinInMatch"===e.name&&await this.processJoinChallengeAsync()}}async processFinishChallengeModeAsync(e){ul.addWideframeRender("renderResultChallenge",ul.wideframe.renderResultChallenge),await cl.challenge.finish.processAsync(e)}async processContinueChallengeAsync(){const{id:e,customData:t}=this.getMatchState(),{playerId:i,opponentId:n}=t;if(!ml.isString(e))throw new Error("Invalid match id");if(!ml.isString(i))throw new Error("Invalid player id");if(!ml.isString(n))throw new Error("Invalid opponent id");const a=GameSDK.context.getID();if(!a)throw new Error("Cannot get contextId");await cl.challenge.continue.processAsync({matchId:e,contextId:a,playerId:i,opponentId:n})}async processChallengeNewOpponentAsync(){const e=hl.getConnectedPlayerIds(100,0),t=Math.floor(Math.random()*e.length),i=hl.getPlayerId(),n=e[t];await cl.challenge.friend.processAsync({playerId:i,opponentId:n})}async processJoinChallengeAsync(){const{id:e,customData:t}=this.getMatchState(),{playerId:i,opponentId:n}=t;if(!ml.isString(e))throw new Error("Invalid match id");if(!ml.isString(i))throw new Error("Invalid player id");if(!ml.isString(n))throw new Error("Invalid opponent id");await cl.challenge.join.processAsync({matchId:e,playerId:i,opponentId:n})}getMatchState(){const e=cl.getMatchState();if(!e)throw new Error("Match state not found");return e}static createTournamentName(){const e=`${wl[z.randomRangeInt(0,wl.length-1)]} Tournament`;return`${gl.removeDiacritics(e)}`}static getShortName(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:50;const i=e.split(" ");let n=0,a="";for(const e of i){if(n+e.length+1>t)break;a+=`${e} `,n+=e.length+1}return a.slice(0,-1)}static createTournamentPayload(){const e=gl.generateObjectId(),t=hl.getPlayerId(),{name:i}=hl.getPlayer(),n=hl.getGameData()?.level??1,a=ll.getLevelTheme(n),s=this.inst.getMatchState(),{profiles:o={}}=s;return{score:o[t]?.score??0,playerId:t,mode:bl.TOURNAMENT,name:this.createTournamentName(),leaderboardId:e,payload:{playerId:t,playerName:i,leaderboardId:e,themeId:a}}}static async getTournamentsAsync(){try{return await GameSDK.tournament.getTournamentsAsync()}catch(e){return console.error(e),[]}}static async processCreateTournamentAsync(){const e=await this.getTournamentsAsync(),t=yl.search(e,(e=>{const t=JSON.parse(e.getPayload()??"{}");return"DEFAULT"===e.getTournamentType()&&t.playerId===hl.getPlayerId()}));if(t)throw new $r(hl.getPlayerId(),t.getID());const i=this.createTournamentPayload();hl.setGameData({lastCreateTournamentShown:Date.now()}),await cl.tournament.create.processAsync(i);const{leaderboardId:n}=i;dl.addLeaderboard({name:n,type:"tournament",autoSortRank:!0,leaderboardId:n})}static getMatchMode(){const e=this.inst.getMatchState();return ml.isString(e.mode)?e.mode:null}static getMatchCustomData(){const e=this.inst.getMatchState();return ml.isObject(e.customData)?e.customData:null}static async getMatchExtraDataAsync(e){const t=await cl.api.getMatchAPI().getMatchDetailByIdAsync(e);return new fl(t).toObject().extraData}static updateMatchStateAfterLevelFinish(e,t){this.setMatchCustomDataAsync({level:e,score:t});const i=hl.getPlayerId();this.setProfileMatchDataAsync({id:i,score:t})}}try{new Sl}catch(e){console.error("MatchUtils",e)}i._RF.pop(),i._RF.push({},"97ca9J9nzNCeIjC1l+ZT/Hm","SceneUtils",void 0);const{event:vl}=globalThis.game,{Events:Cl}=GameCore;class El{static get inst(){return this._instance||(this._instance=new El),this._instance}static switchScene(e,t){vl.emit(Cl.SWITCH_SCENE,{sceneName:e,sceneData:t})}static preloadScene(e){vl.emit(Cl.PRELOAD_SCENE,{sceneName:e})}static preloadDashboardScene(){this.preloadScene(zr)}static switchToDashboardScene(e){this.switchScene(zr,e)}static preloadGameScene(){this.preloadScene(Br)}static switchToGameScene(e){this.switchScene(Br,e)}static getSceneData(e){return"data"in e.scene&&e.scene.data||{}}}try{new El}catch(e){console.error("SceneUtils",e)}var Tl,Al,Rl,Il,Pl,_l,Ll;i._RF.pop(),i._RF.push({},"46b8aK6CThLtpMhZPEfDrNs","LoadingFullScreen",void 0);const{ccclass:Dl,property:Ol}=a;let Nl=(Tl=Dl("LoadingFullScreen"),Al=Ol(X),Rl=Ol(h),Tl((_l=ve((Pl=class extends s{constructor(){super(...arguments),e(this,"progressBar",_l,this),e(this,"loadingText",Ll,this)}__preload(){this.uiOpacity=this.getComponent(x),this.validateRequiredComponents()}validateRequiredComponents(){Fe.lazyValidateProperties(this)}runLoadingTextAnimation(){let e=0;this.schedule((()=>{e=e>2?0:e+1,this.loadingText.string="Loading";for(let t=0;t<e;t++)this.loadingText.string+="."}),.5)}stopLoadingTextAnimation(){this.unscheduleAllCallbacks()}async show(){this.uiOpacity.opacity=0,this.progressBar.progress=0;const e=C(this.uiOpacity).to(.2,{opacity:255},{easing:"cubicOut"}),t=C(this.progressBar).to(8,{progress:.9},{easing:"cubicOut"});this.runLoadingTextAnimation(),vt.runTweenAsync(e),await vt.runTweenAsync(t)}async hide(){if(!this.uiOpacity||!this.progressBar)return;this.uiOpacity.opacity=255,this.progressBar.progress=.9;const e=C(this.uiOpacity).to(.15,{opacity:0},{easing:"cubicIn"}),t=C(this.progressBar).to(.2,{progress:1},{easing:"cubicIn"});this.runLoadingTextAnimation(),await vt.runTweenAsync(t),this.stopLoadingTextAnimation(),await vt.runTweenAsync(e),this.node.active=!1}}).prototype,"progressBar",[Al],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ll=ve(Pl.prototype,"loadingText",[Rl],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Il=Pl))||Il);var Ml,kl,xl,Fl,Bl;i._RF.pop(),i._RF.push({},"74caciRBKZLu7ymXYJK2GYy","Loading",void 0);const{ccclass:zl,property:Ul}=a;let Gl=(Ml=zl("Loading"),kl=Ul(_),Ml((Bl=ve((Fl=class extends s{constructor(){super(...arguments),e(this,"loadingPrefab",Bl,this),this.loadingNode=null}__preload(){this.validateRequiredComponents()}validateRequiredComponents(){Fe.lazyValidateProperties(this)}onLoad(){this.makePersistent()}makePersistent(){m.addPersistRootNode(this.node)}createLoadingFullScreen(){const e=P("Canvas");if(!e)return;if(e.getChildByName("Loading"))return;this.loadingNode||(this.loadingNode=c(this.loadingPrefab));const t=c._clone(this.loadingNode);this.loadingFullScreen=t.getComponent(Nl),this.node.active=!1,P("Canvas")?.addChild(t)}async show(){this.createLoadingFullScreen(),this.node.active||(this.node.active=!0,await this.loadingFullScreen.show())}async hide(){this.node?.active&&this.loadingFullScreen&&(await this.loadingFullScreen.hide(),this.node.active=!1)}}).prototype,"loadingPrefab",[kl],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),xl=Fl))||xl);i._RF.pop(),i._RF.push({},"a0dcdDZxhZImZ8Cfg4Dc7SJ","ScreenUtils",void 0);const{event:Hl}=globalThis.game,{Events:Vl,Utils:{Array:ql}}=GameCore;class Wl{constructor(){this.showedScreens=[]}static get inst(){return this._instance||(this._instance=new Wl),this._instance}static openScreen(e,t){const i=Vi[e];Hl.emit(Vl.OPEN_SCREEN,{screenName:i,screenData:t})}static closeScreen(e){const t=Vi[e];Hl.emit(Vl.CLOSE_SCREEN,{screenName:t})}static showLoadingScreen(e){this.openScreen(Hi.LOADING_SCREEN,{duration:e})}static closeLoadingScreen(){this.closeScreen(Hi.LOADING_SCREEN)}static showNotificationScreen(e,t){this.openScreen(Hi.NOTIFICATION_SCREEN,{message:e,duration:t})}static closeNotificationScreen(){this.closeScreen(Hi.NOTIFICATION_SCREEN)}static addShowedScene(e){ql.has(this.inst.showedScreens,e)||this.inst.showedScreens.push(e)}static async showLoadingFullScreen(e){if(ql.has(this.inst.showedScreens,e))return;this.addShowedScene(e);const t=P("Loading");t&&(t.active=!0,await t.getComponent(Gl).show())}static async hideLoadingFullScreen(e){ql.has(this.inst.showedScreens,e)||await(P("Loading")?.getComponent(Gl).hide())}static showLoadingNotificationScreen(){this.openScreen(Hi.NOTIFICATION_SCREEN,{message:"Loading",enableCloseOnTouch:!1})}static showTournamentDetailScreen(e,t){this.openScreen(Hi.TOURNAMENT_DETAIL_SCREEN,{tournament:e,tournamentContextType:t})}static closeTournamentDetailScreen(){this.closeScreen(Hi.TOURNAMENT_DETAIL_SCREEN)}}try{new Wl}catch(e){console.error("ScreenUtils",e)}i._RF.pop(),i._RF.push({},"d6fb7/+FFxLs7k5w6K38JYb","TournamentUtils",void 0);const{Utils:{String:Kl,Valid:Yl,Array:jl},Configs:{Mockup:{Leaderboards:Xl}}}=GameCore,{leaderboard:$l,player:Jl}=globalThis.game;class Ql{constructor(){this.globalTournamentLBData=[],this.playerTournaments=[],this.tournamentData=[],this.maxTimeRefetch=5e3,this.lastFetchTournamentsData=0,this.lastFetchGlobalTournament=0,this.fetchGlobalTournamentLeaderboardAsync=async()=>{try{Date.now()-this.lastFetchGlobalTournament>this.maxTimeRefetch&&(this.globalTournamentLBData=await $l.requestLeaderboardsAsync({limit:100,type:"world_tournament_leaderboard"}),this.globalTournamentLBData.sort(((e,t)=>e.expireTime-t.expireTime)))}catch(e){console.warn("fetchGlobalTournamentLeaderboardAsync",e)}return this.globalTournamentLBData},this.fetchTournamentsAsync=async()=>{try{Date.now()-this.lastFetchTournamentsData>this.maxTimeRefetch&&(this.playerTournaments=await GameSDK.tournament.getTournamentsAsync(),this.playerTournaments.sort(((e,t)=>e.getEndTime()-t.getEndTime())))}catch(e){console.warn("fetchTournamentsAsync",e)}return this.playerTournaments}}static getInstance(){return this._instance||(this._instance=new Ql),this._instance}static async requestTournamentDataAsync(){const e=this.getInstance();await Promise.all([e.fetchTournamentsAsync(),e.fetchGlobalTournamentLeaderboardAsync()]);const t=e.processPlayerTournamentData(),i=e.processGlobalTournamentLeaderboardData();return e.tournamentData=[...t,...i],e.tournamentData.sort(((e,t)=>e.endTime-t.endTime)),e.tournamentData.forEach((e=>{const{payload:t}=e,{leaderboardId:i}=t;i&&($l.isExistLeaderboardId(i)||$l.addLeaderboard({type:"tournament",name:i,autoSortRank:!0,leaderboardId:i}))})),e.tournamentData}static getAllTournamentData(){return this.getInstance().tournamentData}static getTournamentDataById(e){const t=this.getInstance();return jl.search(t.tournamentData,(t=>t.id===e))}static getPlayerTournamentData(){const e=this.getInstance(),t=Jl.getPlayerId();return e.tournamentData.filter((e=>{const{payload:i}=e;return i.playerId===t}))}static getFriendsTournamentData(){const e=this.getInstance(),t=Jl.getPlayerId();return e.tournamentData.filter((e=>{const{payload:i}=e;return i.playerId!==t&&"global"!==i.playerId}))}static getGlobalTournamentData(){return this.getInstance().tournamentData.filter((e=>{const{payload:t}=e;return"global"===t.playerId}))}static validateTournamentExpired(e){const t=this.getTournamentDataById(e);if(!t)return!1;const{endTime:i}=t;return i<Date.now()/1e3}processPlayerTournamentData(){const e=[];for(const t of this.playerTournaments){const i=`${t.getID()}`,n=t.getContextID(),a=t.getEndTime(),s=this.parseTournamentPayload(t.getPayload());if(!this.validateGameSDKTournamentPayload(s))continue;if(a<Date.now()/1e3)continue;if("PAGE_HOSTED"===t.getTournamentType())continue;const o=s.playerName??"Player",r={id:i,title:t.getTitle()??this.createDefaultTournamentName(o),endTime:a,contextId:n,payload:s};e.push(r)}return e}processGlobalTournamentLeaderboardData(){const e=[],{Enabled:t}=Xl;if(t){for(let t=0;t<this.playerTournaments.length;t++){const i=this.playerTournaments[t],n=i.getTournamentType();if("PAGE_HOSTED"!==n)continue;const a=`${i.getID()}`,s=i.getContextID(),o=i.getEndTime(),r=this.parseTournamentPayload(i.getPayload()),l={id:a,title:i.getTitle()??"Global Tournament",endTime:o,contextId:s,payload:r,tournamentType:n};e.push(l)}return e}for(let t=0;t<this.globalTournamentLBData.length;t++){let i={tournamentId:"",contextId:""};const n=this.globalTournamentLBData[t];try{i=JSON.parse(n.description)}catch(e){continue}if(!this.validateExpireTime(n))continue;if(!this.validateGlobalTournamentPayload(i))continue;const a={id:i.tournamentId,title:n.name,endTime:this.getTournamentEndTime(n),contextId:i.contextId,payload:{playerId:"global",playerName:"global",leaderboardId:n._id,themeId:i.themeId??tl.SUMMER}};e.push(a)}return e}validateGlobalTournamentPayload(e){const{tournamentId:t,contextId:i}=e;return!(!Yl.isString(t)||""===t)&&!(!Yl.isString(i)||""===i)}getTournamentEndTime(e){const t=new Date(e.createdAt).getTime();return Math.round((1e3*e.expireTime+t)/1e3)}validateExpireTime(e){return 1e3*this.getTournamentEndTime(e)-Date.now()>0}validateGameSDKTournamentPayload(e){return!(!Yl.isString(e.playerId)||""===e.playerId)&&(!(!Yl.isString(e.playerName)||""===e.playerName)&&!(!Yl.isString(e.leaderboardId)||""===e.leaderboardId))}createDefaultTournamentName(e){const t=e.substring(0,7),i=`${t.split(" ")[0]||t}'s Tournament`;return`${Kl.removeDiacritics(i)}`}parseTournamentPayload(e){if("string"!=typeof e)return{};try{return JSON.parse(e)}catch(e){return{}}}}i._RF.pop(),i._RF.push({},"d90c4WisP9LybAFqNuS6imZ","FailKeys",void 0);const Zl="time",ec="bomb";var tc;i._RF.pop(),i._RF.push({},"44b50YkamZDD5fO9vdZKeG7","InputController",void 0);const{ccclass:ic}=a;let nc=ic("InputController")(tc=class extends s{constructor(){super(...arguments),this.handleElementPointerDown=()=>{},this.handleElementPointerUp=e=>{}}onLoad(){this.listenInputEvents()}listenInputEvents(){Y.os!==Y.OS.WINDOWS&&Y.os!==Y.OS.OSX||(document.addEventListener("pointerup",this.handleElementPointerUp),document.addEventListener("pointerdown",this.handleElementPointerDown))}onDestroy(){Y.os!==Y.OS.WINDOWS&&Y.os!==Y.OS.OSX||(document.removeEventListener("pointerup",this.handleElementPointerUp),document.removeEventListener("pointerdown",this.handleElementPointerDown))}})||tc;i._RF.pop(),i._RF.push({},"7f144HjLfBLWbFvbRFCCt8e","Directions",void 0);const ac={Up:{x:0,y:1},Down:{x:0,y:-1},Left:{x:-1,y:0},Right:{x:1,y:0}};i._RF.pop(),i._RF.push({},"361eckT3VBO5ZFyetePNmNY","LevelGravity",void 0);const sc="fall-down",oc="fly-up",rc="push-left",lc="push-right",cc="put-column-middle",hc="put-row-middle";function dc(e){const{array:t,isLighter:i,out:n=new Set}=e;for(let e=0;e<t.length;e++)if(i(t.get(e)))for(let a=e+1;a<t.length;a++)if(!i(t.get(a))){t.swap(e,a),n.add(t.get(e));break}return n}i._RF.pop(),i._RF.push({},"cf506DevntPeIl9QrpMEBY0","Grid",void 0);class uc{constructor(e){this.array=[];const{width:t=1,height:i=1}=e??{},n=e instanceof uc?e.array:e?.content??[];if(n.length!==t*i)throw new Error("Invalid content length");this.width=t,this.height=i,this.array=[...n]}asArray(){return this.array}get(e,t){return this.array[t*this.width+e]}set(e,t,i){this.array[t*this.width+e]=i}isInBounds(e,t){return e>=0&&e<this.width&&t>=0&&t<this.height}forEach(e){for(let t=0;t<this.height;t++)for(let i=0;i<this.width;i++)e(this.get(i,t),i,t)}map(e){const t=[];for(let i=0;i<this.height;i++)for(let n=0;n<this.width;n++)t.push(e(this.get(n,i),n,i));return t}reduce(e,t){let i=t;for(let t=0;t<this.height;t++)for(let n=0;n<this.width;n++)i=e(i,this.get(n,t),n,t);return i}swap(e,t){const[i,n]=e,[a,s]=t,o=this.get(i,n);this.set(i,n,this.get(a,s)),this.set(a,s,o)}shuffle(e){e=e??this.map(((e,t,i)=>[t,i]));const t=[...e],i=new Set;for(let e=t.length-1;e>0;e--){const n=ee(0,e+1);[t[e],t[n]]=[t[n],t[e]],i.add(this.get(t[e][0],t[e][1])),i.add(this.get(t[n][0],t[n][1]))}for(let i=0;i<t.length;i++){const[n,a]=e[i],[s,o]=t[i];this.swap([n,a],[s,o])}return i}toShuffled(e){const t=new uc({width:this.width,height:this.height,content:this.array}),i=t.shuffle(e);return[t,i]}gravitate(e){const{rowRange:[t,i],colRange:[n,a],direction:s,isLighter:o,onSwap:r,out:l=new Set}=e,c=a-n+1,h=i-t+1;switch(s){case ac.Up:for(let e=n;e<=a;e++)dc({array:{length:h,get:t=>this.get(e,i-t),swap:(t,n)=>{const a=this.get(e,i-t),s=this.get(e,i-n);this.swap([e,i-t],[e,i-n]),r?.(a,s)}},isLighter:o,out:l});return l;case ac.Down:for(let e=n;e<=a;e++)dc({array:{length:h,get:i=>this.get(e,t+i),swap:(i,n)=>{const a=this.get(e,t+i),s=this.get(e,t+n);this.swap([e,t+i],[e,t+n]),r?.(a,s)}},isLighter:o,out:l});return l;case ac.Left:for(let e=t;e<=i;e++)dc({array:{length:c,get:t=>this.get(n+t,e),swap:(t,i)=>{const a=this.get(n+t,e),s=this.get(n+i,e);this.swap([n+t,e],[n+i,e]),r?.(a,s)}},isLighter:o,out:l});return l;case ac.Right:for(let e=t;e<=i;e++)dc({array:{length:c,get:t=>this.get(a-t,e),swap:(t,i)=>{const n=this.get(a-t,e),s=this.get(a-i,e);this.swap([a-t,e],[a-i,e]),r?.(n,s)}},isLighter:o,out:l});return l;default:throw new Error("Invalid direction")}}toGravitated(){const e=new uc({width:this.width,height:this.height,content:this.array}),t=e.gravitate(...arguments);return[e,t]}toRotated(){const e=new uc({width:this.height,height:this.width,content:new Array(this.width*this.height)});for(let t=0;t<this.height;t++)for(let i=0;i<this.width;i++)e.set(this.height-1-t,i,this.get(i,t));return e}}i._RF.pop(),i._RF.push({},"4046cPYak1BDIVFKksVPsnk","index",void 0),i._RF.pop(),i._RF.push({},"c517dy1TKlPd7mHxulLPv1G","TileSpecialTypes",void 0);const pc={bomb:"bomb",star:"star",none:"none"};var mc,gc,yc,bc,fc,wc,Sc,vc,Cc,Ec,Tc,Ac,Rc,Ic,Pc,_c,Lc,Dc,Oc,Nc,Mc,kc,xc,Fc,Bc;i._RF.pop(),i._RF.push({},"ea140gA27tJa4LD9MT3t93/","Tile",void 0);const{ccclass:zc,property:Uc,requireComponent:Gc}=a;let Hc=(mc=zc("Tile"),gc=Gc([l]),yc=Gc([x]),bc=Uc(R),fc=Uc(R),wc=Uc(R),Sc=Uc(n),vc=Uc({type:l,displayName:"Background's UI Transform"}),Cc=Uc({type:x,displayName:"This UI Opacity"}),Ec=Uc(x),Tc=Uc(x),Ac=Uc(Fn),Rc=Uc(y),mc(Ic=gc(Ic=yc((_c=ve((Pc=class t extends s{constructor(){super(...arguments),e(this,"icon",_c,this),e(this,"bombComponent",Lc,this),e(this,"starComponent",Dc,this),e(this,"background",Oc,this),e(this,"bgUITransform",Nc,this),e(this,"uiOpacity",Mc,this),e(this,"shineOpacity",kc,this),e(this,"glowOpacity",xc,this),e(this,"button",Fc,this),e(this,"animationComponent",Bc,this),this.id=null,this.isEmpty=!1,this.coord=new J,this.restoreSignal=new oi}onLoad(){Fe.lazyValidateProperties(this),this.special=this.createSpecialHandler(pc.none)}update(e){this.special?.type===pc.bomb&&this.special.update(e)}onDestroy(){this.special?.type===pc.bomb&&this.special?.onDestroy()}setIgnoreInput(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.button.interactable=!e}getCoord(){return this.coord}setCoord(e,t){this.coord.set(e,t)}isSimilarTo(e){return this.id===e.id}inSamePositionAs(e,i){return e instanceof t?this.coord.equals(e.getCoord()):this.coord.x===e&&this.coord.y===i}isHidden(){return this.isEmpty}getSize(){return[this.bgUITransform.width,this.bgUITransform.height]}onClick(){this.isHidden()||this.node.scene.emit(Ha.TILE_CLICK,this)}setIdentity(e){this.id=e,this.icon.spriteFrame=e;const[t,i]=this.getSize(),{width:n,height:a}=e.originalSize,s=Math.max(n/(.7*t),a/(.7*i));s>1&&this.icon.node.setScale(new j(1/s,1/s,1))}setSpecialType(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:pc.none,t=arguments.length>1?arguments[1]:void 0;this.special?.switch(e,t)}async setFocused(e){const t=C(this.shineOpacity).to(.2,{opacity:e?255:0},{easing:"quadIn"});this.shineOpacity.node.scale=e?j.ZERO:j.ONE;const i=C(this.shineOpacity.node).to(.2,{scale:e?j.ONE:j.ZERO},{easing:"quadOut"});if(e){const e=C(this.glowOpacity).to(2,{opacity:150});e.to(2,{opacity:20}),this.glowOpacityTween=C(this.glowOpacity).repeatForever(e).start()}else this.glowOpacityTween&&this.glowOpacityTween.stop(),this.glowOpacity.opacity=0;await Promise.all([vt.runTweenAsync(t),vt.runTweenAsync(i)])}setEmpty(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.isEmpty){if(this.restoreSignal.abort(),this.isEmpty=!0,this.setIgnoreInput(!0),this.button.resetButtonState(),e)return this.uiOpacity.opacity=0,void this.special?.switch(pc.none);this.special?.type===pc.star&&this.special.clear(),this.special?.switch(pc.none),this.uiOpacity.opacity=0}}async setHint(e){if(e)await this.loadShakeClip(),this.shakeClip&&this.runAnimation(this.shakeClip.name);else{this.animationComponent.stop();const e=C(this.background).to(.1,{scale:j.ONE,eulerAngles:j.ZERO});await vt.runTweenAsync(e)}}async playClearFX(e){let t=null;"clear"===e?(await this.loadClearClip(),t=this.clearClip):(await this.loadBreakClip(),t=this.breakClip),null!==t&&await this.runAnimation(t.name)}async restore(e){this.restoreSignal.abort(),this.restoreSignal=new oi,this.isEmpty=!1,this.setIgnoreInput(!0),e&&this.setIdentity(e),this.uiOpacity.opacity=255,this.node.setScale(j.ZERO),this.button.fakeClick(),await vt.runTweenAsync(C(this.node).to(.3,{scale:j.ONE},{easing:"backOut"}),this.restoreSignal),this.node.setScale(j.ONE),this.setIgnoreInput(!1)}async sync(e){const{duration:t=.3,delay:i=0,easing:n="cubicOut",getTargetPosition:a}=e,s=a(this.coord),o=new j(s.x,s.y,this.node.position.z);await vt.runTweenAsync(C(this.node).delay(i).to(t,{position:o},{easing:n}))}async fly(e){const t=300,i=Math.sqrt(this.node.position.x**2+this.node.position.y**2),n=Math.max(t-.7*i,0),a=i/1e3,s=this.node.position.clone(),o=e.getTilePosition(this.coord),r=new j(o.x,o.y,this.node.position.z),l=this.background;let c=2;let h=1,d=360;const u=.0025*n;let p=0;const m=new j(0,0,0),g=.75-u,y={value:0,prevElapsed:0},b=C(y);return b.delay(a),b.to(.5,{value:0},{progress:(e,t,i,n)=>{c*=-1;const a=c*n,o=s.clone();return o.x+=a,this.node.setPosition(o),i}}),b.to(u,{value:1},{progress:(e,i,a,s)=>{const o=vt.easeOutExpo(s),r=u*s-y.prevElapsed,c=u*s,p=n*o;this.setHeight(p,t);const m=this.node.position.clone();h+=.1,j.rotateZ(m,m,new j(0,0,0),h*Math.PI*r),this.node.setPosition(new j(m.x,m.y,m.z)),d+=10;const g=d*r;return l.angle+=g,y.prevElapsed=c,a}}),b.call((()=>{m.set((this.node.position.x+r.x)/2,(this.node.position.y+r.y)/2,0),y.prevElapsed=0,l.angle%=360,l.angle-=360,p=l.angle})),b.to(g,{value:0},{progress:(e,i,a,s)=>{const o=g*s-y.prevElapsed,r=g*s,c=n*(1-s);this.setHeight(c,t);const h=this.node.position.clone();return j.rotateZ(h,h,m,Math.PI/g*o),this.node.setPosition(new j(h.x,h.y,h.z)),l.angle+=-p/g*o,y.prevElapsed=r,a}}),b.call((()=>{this.node.setPosition(r),this.setHeight(0,t),l.angle=0})),vt.runTweenAsync(b)}async loadBreakClip(){if(this.breakClip)return Promise.resolve();const e=await hi.loadAnimClipAsync(ri.TILE_BREAK_ANIM);if(!e)return Promise.resolve();this.breakClip=e,this.animationComponent.addClip(this.breakClip)}async loadClearClip(){if(this.clearClip)return Promise.resolve();const e=await hi.loadAnimClipAsync(ri.TILE_CLEAR_ANIM);if(!e)return Promise.resolve();this.clearClip=e,this.animationComponent.addClip(this.clearClip)}async loadShakeClip(){if(this.shakeClip)return Promise.resolve();const e=await hi.loadAnimClipAsync(ri.TILE_SHAKE_ANIM);if(!e)return Promise.resolve();this.shakeClip=e,this.animationComponent.addClip(this.shakeClip)}runAnimation(e){return this.animationComponent.play(e),new Promise((e=>{this.animationComponent.once(y.EventType.FINISHED,(()=>{e()}))}))}setHeight(e,t){const i=this.background;i.setPosition(new j(i.position.x,e,0)),i.setScale(new j(1+e/t*.3,1+e/t*.3,1))}createSpecialHandler(e,t){switch(e){case pc.bomb:return this.createBombHandler(t??90);case pc.star:return this.createStarHandler();default:return{type:pc.none,switch:(e,t)=>{this.special=this.createSpecialHandler(e,t)}}}}createBombHandler(e){let t=!1,i=e;const n=()=>{t=!0},a=()=>{t=!1};this.node.scene.on(Ha.TILE_CLICK,n),this.node.scene.on(Ha.USE_ITEM,n),this.node.scene.on(Ha.RESUME_TIME,n),this.node.scene.on(Ha.PAUSE_TIME,a),this.node.scene.on(Ha.TIME_OUT,a),this.bombComponent.node.active=!0;const s=()=>{t=!1,this.bombComponent.node.active=!1,this.node.scene.emit(Ha.BOMB_EXPLODE,this),this.setEmpty()},o=()=>{t=!1,this.bombComponent.node.active=!1,i=e,this.node.scene.off(Ha.TILE_CLICK,n),this.node.scene.off(Ha.USE_ITEM,n),this.node.scene.off(Ha.GAME_RESUME,n),this.node.scene.off(Ha.GAME_PAUSE,a),this.node.scene.off(Ha.TIME_OUT,a)};return{type:pc.bomb,update:n=>{t&&(i-=n,this.bombComponent.fillRange=-i/e,i<=0&&s())},cleanup:o,onDestroy:()=>{this.node.scene.off(Ha.TILE_CLICK,n),this.node.scene.off(Ha.USE_ITEM,n),this.node.scene.off(Ha.GAME_RESUME,n),this.node.scene.off(Ha.GAME_PAUSE,a),this.node.scene.off(Ha.TIME_OUT,a)},switch:(e,t)=>{o(),this.special=this.createSpecialHandler(e,t)},detonateImmediately:()=>{i=0}}}createStarHandler(){this.starComponent.node.active=!0;const e=()=>{this.starComponent.node.active=!1};return{type:pc.star,clear:()=>{this.starComponent.node.active=!1;const{x:e,y:t}=this.node.worldPosition;this.node.scene.emit(Ha.ADD_STARS,{startAnimationAt:[e,t]})},cleanup:e,switch:t=>{e(),this.special=this.createSpecialHandler(t)}}}}).prototype,"icon",[bc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Lc=ve(Pc.prototype,"bombComponent",[fc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Dc=ve(Pc.prototype,"starComponent",[wc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Oc=ve(Pc.prototype,"background",[Sc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Nc=ve(Pc.prototype,"bgUITransform",[vc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Mc=ve(Pc.prototype,"uiOpacity",[Cc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),kc=ve(Pc.prototype,"shineOpacity",[Ec],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),xc=ve(Pc.prototype,"glowOpacity",[Tc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Fc=ve(Pc.prototype,"button",[Ac],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Bc=ve(Pc.prototype,"animationComponent",[Rc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ic=Pc))||Ic)||Ic)||Ic);function Vc(e,t,i){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;const{x:a,y:s}=i,[o,r]=t;let l=o*(a-(e.width-1)/2)+n*(a-e.width/2),c=r*(s-(e.height-1)/2)+n*(s-e.height/2);return-1===a&&(l+=t[0]/4),a===e.width&&(l-=t[0]/4),-1===s&&(c+=t[1]/4),s===e.height&&(c-=t[1]/4),{x:l,y:c}}function qc(e){switch(e){case sc:return lc;case oc:return rc;case rc:return sc;case lc:return oc;case cc:return hc;case hc:return cc}}function Wc(e){return(e instanceof uc?e.asArray():e).filter((e=>!e.isHidden()))}function Kc(e){return(e instanceof uc?e.asArray():e).filter((e=>e.isHidden()))}i._RF.pop(),i._RF.push({},"d6995j9hvVJYKs6vvV+rs1I","index",void 0),i._RF.pop(),i._RF.push({},"cb8ddC2w59DpqVoQENbYYcU","calcBoardScale",void 0),i._RF.pop(),i._RF.push({},"305c7LJx+ROLI4g8tTiAFyb","calcTilePosition",void 0),i._RF.pop(),i._RF.push({},"c522ca1UPhDYaToWf66t1X2","calcTileSize",void 0),i._RF.pop(),i._RF.push({},"37667B66RZBc5chlMqN6mH8","parseLevelGravity",void 0),i._RF.pop(),i._RF.push({},"f0f0bXgdxJHIJWOmA6n0Ood","getUncleared",void 0),i._RF.pop(),i._RF.push({},"a90bcq22hlMzbYdivjPpm0h","getBombTiles",void 0),i._RF.pop(),i._RF.push({},"92e23drVfRIgbDVZLTSdEkI","getCleared",void 0),i._RF.pop(),i._RF.push({},"7105bfR+Y5F1a0SDiMXZ9mV","getNearbyTiles",void 0);const{Utils:{Object:Yc}}=GameCore;function jc(e,t){const{x:i,y:n}=t.getCoord();return Yc.vals(ac).reduce(((t,a)=>{let{x:s,y:o}=a;const[r,l]=[i+s,n+o];return e.isInBounds(r,l)&&t.push(e.get(r,l)),t}),[])}function Xc(e){return Array.isArray(e)}function $c(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Date.now();const i=Xc(e)?e:e.asArray();return i[te(t,0,i.length)]}i._RF.pop(),i._RF.push({},"d1b9bBg+dBA+7n/Sz+RCIAX","getRandomTile",void 0),i._RF.pop(),i._RF.push({},"c4bf3uyS1pEdrTrwDEXeuZP","getRandomPair",void 0);const{Array:Jc}=GameCore.Utils;function Qc(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Date.now();const i=e instanceof uc?e.asArray():e,n=$c(i,t),a=Jc.search(i,(e=>e.isSimilarTo(n)&&!e.inSamePositionAs(n)));if(void 0===a)throw new Error("Could not find a matching tile");return[n,a]}i._RF.pop(),i._RF.push({},"cf8d6gfx2ZIsqm978cNLWaV","pseudoRandomIterable",void 0);const Zc=e=>e;function eh(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Zc;return function*(){let n=t;e<=0&&(e=1/0);for(let t=0;t<e;t++)yield i(n),n=1e9*ie(n)}()}function th(e){return Array.isArray(e)}function ih(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Date.now();const n=th(e)?e:e.asArray();if(n.length<t)return new Set(n);const a=new Set,s=eh(-1,i);let o=s.next();for(;a.size<t;){if(o.done)throw new Error("RNG exhausted");a.add($c(n,o.value)),o=s.next()}return a}i._RF.pop(),i._RF.push({},"718b6Wu0pdGVK5KYSUDctVX","getRandomTiles",void 0),i._RF.pop(),i._RF.push({},"17ccarKybRNwYcZnBQhCUYy","index",void 0),i._RF.pop(),i._RF.push({},"bab6dqrPz9AaaBN5cy+QzPj","assignSpecialTiles",void 0);const nh=[1,4];function ah(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Date.now();const{specials:n}=t,a=n.bomb,s=te(i,...nh),o=ih(e,a,i),r=e.asArray().filter((e=>!o.has(e))),l=ih(r,s,i);o.forEach((e=>{const i=2*t.time/3;e.setSpecialType(pc.bomb,i)})),l.forEach((e=>e.setSpecialType(pc.star)))}i._RF.pop(),i._RF.push({},"228efPdzUNCMp4yYcBs9r+3","index",void 0),i._RF.pop(),i._RF.push({},"09be7lmGLNMvIObiqskePhz","createGrid",void 0);const{Utils:{Array:sh}}=GameCore;function oh(e){const{levelData:{columns:t,rows:i},identities:n,createTile:a,seed:s=Date.now()}=e,o=function(e,t,i){const n=[],a=t/2,s=e=>te(e,0,i.length);for(const t of eh(a,e,s))n.push(i[t]),n.push(i[t]);return sh.shuffle(n),n}(s,t*i,n).map((e=>{const t=a(e);return t.setIdentity(e),t}));return new uc({width:t,height:i,content:o})}i._RF.pop(),i._RF.push({},"5d998xlab9FLIpvw+sXMIYw","createGridFromFen",void 0);const{Array:rh}=GameCore.Utils;function lh(e,t){const i=rh.search(Object.entries(t),(t=>{let[i,n]=t;return n===e}));if(void 0===i)throw new Error(`Invalid special type ${e}`);return i[0]}i._RF.pop(),i._RF.push({},"30de5d+cW5OjKyEubKVREbU","createRotatedGrid",void 0),i._RF.pop(),i._RF.push({},"9ceb6vNbn9PKozkdGjjZD67","ensureOneMatch",void 0);const{Array:ch}=GameCore.Utils;function hh(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Date.now();const i=e.asArray(),n=$c(e,t),a=jc(e,n);if(a.some((e=>e.isSimilarTo(n))))return;const s=$c(a,t),o=ch.search(i,(e=>!e.inSamePositionAs(n)&&!e.inSamePositionAs(s)&&e.isSimilarTo(s)));o.setIdentity(n.id),s.setIdentity(n.id)}i._RF.pop(),i._RF.push({},"89318H0TDxMlJsVFwuKgrh3","index",void 0),i._RF.pop(),i._RF.push({},"fb4a9VOCxBBvpXFCcSt4P3J","NewbieSteps",void 0);var dh=[{startTile:{x:0,y:1},endTile:{x:3,y:1},description:"Tap to connect"},{startTile:{x:2,y:2},endTile:{x:3,y:0},description:"Connect similar tiles with less than 2 turns"},{startTile:{x:0,y:0},endTile:{x:3,y:3},description:"Connect similar tiles with less than 2 turns"},{startTile:{x:0,y:4},endTile:{x:2,y:3},description:"More than 2 turns are NOT allowed"},{startTile:{x:1,y:4},endTile:{x:1,y:2},description:"There's obstacle between the tiles"}];i._RF.pop(),i._RF.push({},"627d5N3oStP8q9+ABNqnHBq","getBestPath",void 0);const{Array:uh}=GameCore.Utils;function ph(e,t){return e[0]===t[0]&&e[1]===t[1]}function mh(e){return new J(e[0],e[1])}function gh(e,t){return e.x>=-1&&e.x<t.width+1&&e.y>=-1&&e.y<t.height+1}function yh(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:bh;return t.map((t=>[e.tile[0]+t.x,e.tile[1]+t.y]))}const bh=[ac.Up,ac.Down,ac.Left,ac.Right];class fh{constructor(e,t){if(this.f=0,this.g=0,this.h=0,t&&ph(e,t.tile))throw new Error("Tile cannot be its own parent");this.tile=e,this.parent=t;const i=fh.calcDirection(this),n=t&&i&&t.cache.direction&&!i.equals(t.cache.direction)?1:0;this.cache={direction:i,turns:n+(t?.cache.turns??0)}}static calcDirection(e){if(e.parent){const t=e.parent.tile,i=e.tile;return new J(i[0]-t[0],i[1]-t[1])}return null}getKey(){return`x:${this.tile[0]},y:${this.tile[1]},d:${this.cache.direction?.toString()}`}equals(e){return this.getKey()===e.getKey()}}function wh(e,t){const i=e.tile,n=t.tile;return Math.abs(i[0]-n[0])+Math.abs(i[1]-n[1])}function Sh(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];const n=[];for(const a of bh){const s={x:t[0]+a.x,y:t[1]+a.y};if(e.isInBounds(s.x,s.y)){(e.get(s.x,s.y).isHidden()||uh.search(i,(e=>ph(e,[s.x,s.y]))))&&n.push(a)}else gh(s,e)&&n.push(a)}return n}function vh(e,t,i,n){if(n){const e=dh[4].startTile,n=dh[4].endTile;if(t[0]===e.x&&t[1]===e.y&&i[0]===n.x&&i[1]===n.y)return[{a:e,b:n}];if(t[0]===n.x&&t[1]===n.y&&i[0]===e.x&&i[1]===e.y)return[{a:e,b:n}]}return function(e,t,i){const n=[],a=[],s=new fh(t,null),o=new fh(i,null),r=[o.tile];for(n.push(s);n.length>0;){const t=n.shift();if(a.push(t),ph(t.tile,o.tile)){const e=[];let i=t,n=t,a=t.parent;for(;a;)a.cache.turns!==n.cache.turns&&(e.unshift({a:mh(a.tile),b:mh(i.tile)}),i=a),n=a,a=a.parent;return e.unshift({a:mh(n.tile),b:mh(i.tile)}),e}const i=yh(t,Sh(e,t.tile,r));for(const e of i){const i=new fh(e,t);if(i.cache.turns>8)continue;const s=ph(i.tile,o.tile),r=a.some((e=>e.equals(i)));n.some((e=>e.equals(i)))||r&&!s||(i.g=t.g+1+i.cache.turns,i.h=wh(i,o),i.f=i.g+i.h,n.push(i))}n.sort(((e,t)=>e.f-t.f))}const l=s.tile,c=o.tile;return l[0]===c[0]||l[1]===c[1]?[{a:mh(l),b:mh(c)}]:[{a:mh(l),b:{x:l[0],y:c[1]}},{a:{x:l[0],y:c[1]},b:mh(c)}]}(e,t,i)}i._RF.pop(),i._RF.push({},"b622ea7Aw5LT5yfRAx8qSap","getErrorPath",void 0),i._RF.pop(),i._RF.push({},"716f6/ILpZCPp1nebbdk8Oj","getGridFen",void 0);const Ch={[pc.bomb]:"b",[pc.star]:"s",[pc.none]:"t"};function Eh(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Ch;const{width:i,height:n}=e,a=[],s=new Map;for(let o=n-1;o>=0;o--){const n=[];for(let a=0;a<i;a++){const i=e.get(a,o),r=i.isHidden()?null:i.id;if(null===r){n.push(".");continue}const l=t[i.special?.type??pc.none];if(!s.has(r)){const e=s.size.toString();s.set(r,e)}const c=`${l}${s.get(r)}`;n.push(c)}a.push(n.join(""))}return{code:a.join(":"),idSize:s.size,encoding:t,rows:n,cols:i}}function Th(e){return e.reduce(((e,t,i,n)=>(t.inSamePositionAs(i,n)||e.push([t,[i,n]]),e)),[])}function*Ah(e,t){let i=0,n=e-1,a=0,s=t-1;for(;i<=n&&a<=s;){for(let e=i;e<=n;e++)yield{x:e,y:a};a++;for(let e=a;e<=s;e++)yield{x:n,y:e};n--;for(let e=n;e>=i;e--)yield{x:e,y:s};s--;for(let e=s;e>=a;e--)yield{x:i,y:e};i++}}i._RF.pop(),i._RF.push({},"badfeEqwgFEorJVHO9tJSXZ","getOutOfSync",void 0),i._RF.pop(),i._RF.push({},"cd0d548/WxD7KCyW2hwySVO","traverseSpiralIn",void 0),i._RF.pop(),i._RF.push({},"373ceVkYCtMTrQObvzJgg7s","getValidPath",void 0);const{Array:Rh}=GameCore.Utils;class Ih{constructor(e,t){this.coord=new J(e,t)}isHidden(){return!0}isSimilarTo(){return!1}}function Ph(e){return new J(e[0],e[1])}function _h(e,t,i){if(void 0===t||void 0===i)return function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Ah;const i=[];for(const n of t(e.width,e.height)){const t=e.get(n.x,n.y);t.isHidden()||i.push([t,[n.x,n.y]])}const n=[];for(;i.length>0;){const[t,a]=i.shift();if(!Rh.search(n,(e=>Oh(e,a)))){n.push(a);for(const[s,o]of i){if(!s.isSimilarTo(t)||Rh.search(n,(e=>Oh(e,o))))continue;const i=_h(e,a,o);if(null!==i)return i}}}return null}(e);const n=[t[0]+1,t[1]+1],a=[i[0]+1,i[1]+1],s=function(e){const t=Rh.fillWith(e.width+2,(e=>new Ih(e-1,-1))),i=Rh.fillWith(e.width+2,(t=>new Ih(t-1,e.height))),n=Rh.fillWith(e.height,(e=>new Ih(-1,e))),a=Rh.fillWith(e.height,(t=>new Ih(e.width,t))),s=(s,o)=>{const r=s-1,l=o-1;return-1===r?n[l]:r===e.width?a[l]:-1===l?t[r]:l===e.height?i[r]:e.get(r,l)};return{get:(e,t)=>s(e,t),width:e.width+2,height:e.height+2}}(e),o=[n,a];if(n[0]===a[0]&&Mh(s,o,n[1],a[1],n[0])||n[1]===a[1]&&kh(s,o,n[0],a[0],n[1]))return Bh([{a:Ph(n),b:Ph(a)}],{x:-1,y:-1});let r;const l=n[1]<=a[1]?n:a,c=n[1]<=a[1]?a:n,h=n[0]<=a[0]?n:a,d=n[0]<=a[0]?a:n;let u=[],p=[];return-1===(r=xh(s,o,1,Ph(l),Ph(c)))&&-1===(r=xh(s,o,-1,Ph(l),Ph(c)))||(u=[{a:Ph(n),b:{x:n[0],y:r}},{a:{x:n[0],y:r},b:{x:a[0],y:r}},{a:{x:a[0],y:r},b:Ph(a)}]),-1===(r=Fh(s,o,1,Ph(h),Ph(d)))&&-1===(r=Fh(s,o,-1,Ph(h),Ph(d)))||(u=[{a:Ph(n),b:{x:r,y:n[1]}},{a:{x:r,y:n[1]},b:{x:r,y:a[1]}},{a:{x:r,y:a[1]},b:Ph(a)}]),-1!==(r=function(e,t,i,n){for(let a=i.y+1;a<n.y;a++)if(Mh(e,t,i.y,a,i.x)&&kh(e,t,i.x,n.x,a)&&Mh(e,t,a,n.y,n.x))return a;return-1}(s,o,Ph(l),Ph(c)))?p=[{a:Ph(n),b:{x:n[0],y:r}},{a:{x:n[0],y:r},b:{x:a[0],y:r}},{a:{x:a[0],y:r},b:Ph(a)}]:-1!==(r=function(e,t,i,n){for(let a=i.x+1;a<n.x;a++)if(kh(e,t,i.x,a,i.y)&&Mh(e,t,i.y,n.y,a)&&kh(e,t,a,n.x,n.y))return a;return-1}(s,o,Ph(h),Ph(d)))&&(p=[{a:Ph(n),b:{x:r,y:n[1]}},{a:{x:r,y:n[1]},b:{x:r,y:a[1]}},{a:{x:r,y:a[1]},b:Ph(a)}]),u.length>0&&p.length>0?Bh(Lh(u)<=Lh(p)?u:p,{x:-1,y:-1}):u.length>0?Bh(u,{x:-1,y:-1}):p.length>0?Bh(p,{x:-1,y:-1}):null}function Lh(e){let t=0;for(const i of e)t+=Dh(i);return t}function Dh(e){return e.a.x===e.b.x?Math.abs(e.a.y-e.b.y):e.a.y===e.b.y?Math.abs(e.a.x-e.b.x):0}function Oh(e,t){return e[0]===t[0]&&e[1]===t[1]}function Nh(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];const n=e.get(...t);return n.isHidden()||i.some((e=>Oh(e,t)))}function Mh(e,t,i,n,a){const s=Math.min(i,n),o=Math.max(i,n);for(let i=s;i<=o;i++)if(!Nh(e,[a,i],t))return!1;return!0}function kh(e,t,i,n,a){const s=Math.min(i,n),o=Math.max(i,n);for(let i=s;i<=o;i++)if(!Nh(e,[i,a],t))return!1;return!0}function xh(e,t,i,n,a){let s=1===i?a.y:n.y;const o=1===i?n.x:a.x;if(Mh(e,t,n.y,a.y,o))for(;s>=0&&s<e.height&&Nh(e,[n.x,s],t)&&Nh(e,[a.x,s],t);){if(kh(e,t,n.x,a.x,s))return s;s+=i}return-1}function Fh(e,t,i,n,a){let s=1===i?a.x:n.x;const o=1===i?n.y:a.y;if(kh(e,t,n.x,a.x,o))for(;s>=0&&s<e.width&&Nh(e,[s,n.y],t)&&Nh(e,[s,a.y],t);){if(Mh(e,t,n.y,a.y,s))return s;s+=i}return-1}function Bh(e,t){return e.map((e=>({a:{x:e.a.x+t.x,y:e.a.y+t.y},b:{x:e.b.x+t.x,y:e.b.y+t.y}})))}var zh,Uh,Gh,Hh,Vh,qh,Wh,Kh,Yh,jh;i._RF.pop(),i._RF.push({},"0cceagmIDZNoZTxP8hBPplh","Board",void 0);const{ccclass:Xh,property:$h,requireComponent:Jh}=a,{monitorError:Qh}=globalThis.game,{Utils:{Array:Zh}}=GameCore;let ed=(zh=Xh("Board"),Uh=Jh(l),Gh=$h(Hc),Hh=$h(n),Vh=$h({displayName:"Tile Spacing",group:"Create config"}),zh(qh=Uh((Kh=ve((Wh=class t extends s{constructor(){super(...arguments),e(this,"tilePrefab",Kh,this),e(this,"tilesHolder",Yh,this),e(this,"tileTrim",jh,this),this.tileSize=[0,0],this.selectedTile=null,this.layoutType="portrait",this.parsedGravityRules=[],this.normalMatches=0,this.normalMatchesSinceLastSpawn=0,this.spawnAttempts=0,this.hintPath=null,this.hintTiles=null,this.animationQueue=[],this.isConsumingAnimation=!1,this.handleViewResized=()=>{this.updateTilesHolderScale()},this.onLayoutChanged=e=>{this.layoutType=e}}onLoad(){this.uiTransform=this.getComponent(l),Fe.lazyValidateProperties(this),this.tilePrefab.node.active=!1,this.listenLayoutevents()}onDestroy(){this.unlistenLayoutevents()}create(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Date.now();const n=[...e];Zh.shuffle(n),e=n.slice(0,t.colors),this.levelData=t,this.parsedGravityRules=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const i=e.split("-"),n=[];let a=0;for(;a<i.length;){let e=null;switch(i[a]){case"normal":a+=1;break;case"fall":e=sc,a+=2;break;case"fly":e=oc,a+=2;break;case"push":"left"===i[a+1]?(e=rc,a+=2):(e=lc,a+=2);break;case"put":"columns"===i[a+1]?(e=cc,a+=3):(e=hc,a+=3)}e&&(t&&(e=qc(e)),n.push(e))}return n}(t.mode,this.layoutType===na.Layout.Landscape);const a=e=>{const t=c(this.tilePrefab.node),i=t.getComponent(Hc);return i.setIdentity(e),this.tilesHolder.addChild(t),t.active=!0,i};let s=!1;if(void 0!==t.customFen)try{s=!0,this.grid=function(e){let{customFen:t,identities:i,createTile:n}=e;const{idSize:a,cols:s,rows:o,code:r}=t;if(i.length<t.idSize)throw new Error(`Invalid grid code. There are not enough identities/frames ${i.length} to fill it according to fen code ${a}`);const l=r.split(":");if(l.length!==o)throw new Error("Invalid grid code");const c=/[a-zA-Z]+\d+|./g,h=/[a-zA-Z]+/,d=/\d+/,u=l.reduceRight(((e,a)=>{const s=[],o=a.matchAll(c);for(const e of o){const a=e[0],o=d.exec(a)?.[0],r=void 0!==o?parseInt(o,10):void 0,l=void 0!==r&&!isNaN(r)&&r<i.length?i[r]:void 0,c=n(void 0!==l?l:i[0]),u=h.exec(a)?.[0],p=void 0!==u?lh(u,t.encoding):void 0;p&&l?c.setSpecialType(p):c.setEmpty(),s.push(c)}return e.concat(s)}),[]);return new uc({width:s,height:o,content:u})}({customFen:t.customFen,identities:e,createTile:a}),this.grid.forEach(((e,t,i)=>{e.setCoord(t,i),e.setIgnoreInput(!1),e.node.setSiblingIndex(0)}))}catch(e){console.error("Error creating grid from custom fen",e,"falling back to random grid"),s=!1}s||(this.grid=oh({levelData:t,seed:i,identities:e,createTile:a}),this.grid.forEach(((e,t,i)=>{e.setCoord(t,i),e.setIgnoreInput(!1),e.node.setSiblingIndex(0)})),hh(this.grid,i),ah(this.grid,t,i)),this.handleBoardLayout();const o=[this.tileTrim.x,this.tileTrim.y];this.tileSize=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0];const[i,n]=e,[a,s]=t,[o,r]=[1-a,1-s],[l,c]=[i*o,n*r];return[l,c]}(this.tilePrefab.getSize(),o),this.updateTilesHolderScale(),this.node.scene.emit(Ha.GRID_CREATE,this),this.selectedTile=null,this.animationQueue=[],this.normalMatches=0,this.normalMatchesSinceLastSpawn=0,this.spawnAttempts=0,this.hintPath=null,this.processGameplayCycle()}updateTilesHolderScale(){if(!this.grid)return;const e=[this.grid.width,this.grid.height],t=[this.uiTransform.width,this.uiTransform.height],i=function(e,t,i){const[n,a]=e,[s,o]=t,[r,l]=i,[c,h]=[r/(n*s),l/(a*o)];return Math.min(c,h)}(e,this.tilePrefab.getSize(),t);this.tilesHolder.setScale(i,i),this.node.scene.emit(Ha.GRID_RESIZE,i)}handleBoardLayout(){this.layoutType===na.Layout.Landscape&&0!==this.levelData.level&&(this.grid=function(e){const t=e.toRotated();return t.forEach(((e,t,i)=>{e.setCoord(t,i)})),t}(this.grid))}destroyTiles(){this.grid?.forEach((e=>e.node.destroy()))}animateTilesAppear(){const e=(e,t)=>{const i=J.ZERO.clone();return this.parsedGravityRules.forEach((n=>{const a=this.getPrimitiveDirection(e,t,n);i.subtract2f(a.x,a.y)})),i.normalize()};return new Promise((t=>{this.animationQueue.push((async()=>{await Promise.all(this.grid.map(((t,i,n)=>{const a=ne(0,.5),s=t.node.scale.clone(),o=e(i,n),r=Vc(this.grid,this.tileSize,{x:i,y:n}),l=o.multiplyScalar(100).add2f(r.x,r.y);return t.node.setPosition(l.x,l.y),t.node.setScale(0,0),Promise.all([vt.runTweenAsync(C(t.node).delay(a).to(.5,{scale:s},{easing:"elasticOut"})),t.sync({getTargetPosition:e=>Vc(this.grid,this.tileSize,e),easing:"backOut",duration:.5,delay:a})])}))),t()})),this.consumeAnimationQueue()}))}handleTileClick(e){if(!e.isHidden()){if(this.selectedTile===e)return this.selectedTile=null,void e.setFocused(!1);if(!this.selectedTile)return this.selectedTile=e,void e.setFocused(!0);if(!this.selectedTile.isSimilarTo(e))return this.selectedTile.setFocused(!1),this.selectedTile=e,void e.setFocused(!0);this.selectedTile.setFocused(!1),this.match(this.selectedTile,e),this.selectedTile=null}}clearSelectedTile(){this.selectedTile&&(this.selectedTile.setFocused(!1),this.selectedTile=null)}match(e,t){const i=[e.getCoord().x,e.getCoord().y],n=[t.getCoord().x,t.getCoord().y],a=_h(this.grid,i,n);if(null===a){Xi.playSound(Bi.INVALID_MATCH),this.shakeGrid();const a=0===this.levelData.level,s=vh(this.grid,i,n,a);return this.node.scene.emit(Ha.GRID_MATCH,[e,t]),void this.node.scene.emit(Ha.GRID_MATCH_FAIL,s)}this.node.scene.emit(Ha.GRID_MATCH,[e,t]),this.node.scene.emit(Ha.GRID_MATCH_SUCCESS,a,[e,t]),this.clear([[e,t]],"clear")}clear(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"clear";this.normalMatches+=e.length,e.forEach((e=>{let[i,n]=e;i.setEmpty(),n.setEmpty(),i.playClearFX(t),n.playClearFX(t),this.node.scene.emit(Ha.GRID_CLEAR,[i,n])})),this.processGameplayCycle()}showHint(){if(!this.hintPath)return;const e=this.hintPath[0].a,t=this.hintPath[this.hintPath.length-1].b,i=this.getTileAt(e.x,e.y),n=this.getTileAt(t.x,t.y);i.setHint(!0),n.setHint(!0),this.hintTiles=[i,n]}hideHint(){if(this.hintTiles){const[e,t]=this.hintTiles;e.setHint(!1),t.setHint(!1),this.hintTiles=null}}getHintPath(){return this.hintPath}getTileAt(e,t){return this.grid.isInBounds(e,t)?this.grid.get(e,t):null}getAnyTileWorldPosition(e,t){const i=Vc(this.grid,this.tileSize,{x:e,y:t});this.tilePrefab.node.setPosition(i.x,i.y);const n=this.tilePrefab.node.getWorldPosition();return{x:n.x,y:n.y}}getTileSize(){return this.tileSize}getGridSize(){return[this.grid.width,this.grid.height]}getUncleared(){return Wc(this.grid)}getCleared(){return Kc(this.grid)}getBombTiles(){return Wc((e=this.grid)instanceof uc?e.asArray():e).filter((e=>e.special?.type===pc.bomb));var e}getPairs(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;const t=[];let i=!(arguments.length>1&&void 0!==arguments[1])||arguments[1]?Wc(this.grid):Kc(this.grid);for(;t.length<e;){const[e,n]=Qc(i);t.push([e,n]),i=i.filter((t=>t!==e&&t!==n))}return t}setIgnoreInput(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.grid.forEach((t=>t.setIgnoreInput(e)))}processShuffleRequest(e){const t=this.processShuffleStep(this.grid,!0,e);this.grid=t[0],this.hintPath=t[1],this.consumeAnimationQueue()}getCurrentFen(){return Eh(this.grid)}generateFenFromCurrentLevel(e){return t.generateFen(e??this.levelData)}static generateFen(e){const t=e,i=[];for(let e=0;e<t.colors;e++)i.push(e+1);const n=Date.now(),a=oh({levelData:t,seed:n,identities:i,createTile:e=>{let t,i=e;const n=new J(0,0);return{get id(){return i},get special(){return t},get coord(){return n},setIdentity:e=>{i=e},isHidden:()=>!1,setSpecialType:e=>{t={type:e}},setCoord:(e,t)=>n.set(e,t),getCoord:()=>n,isSimilarTo:e=>e.id===i,inSamePositionAs:e=>e.getCoord().equals(n)}}});return a.forEach(((e,t,i)=>{e.setCoord(t,i)})),hh(a,n),ah(a,t,n),Eh(a)}listenLayoutevents(){W.on(Yn,this.handleViewResized),W.on(Xn,this.onLayoutChanged)}unlistenLayoutevents(){W.off(Yn,this.handleViewResized),W.off(Xn,this.onLayoutChanged)}async shakeGrid(){const e=this.tilesHolder.position.clone(),t=C(this.tilesHolder).to(.05,{position:e.clone().add3f(ne(5,10),ne(5,10),0)}).to(.05,{position:e.clone().subtract3f(ne(5,10),ne(5,10),0)}),i=C(this.tilesHolder).repeat(2,t).to(.05,{position:e});await vt.runTweenAsync(i)}processGameplayCycle(){const e=Wc(this.grid);if(0===e.length)return;let t=this.grid;const i=e.length>=2&&this.spawnAttempts<this.levelData.rules.addRandomTilesPerMove&&this.normalMatches>=5,n=this.normalMatchesSinceLastSpawn>=2;i&&(n?(this.spawnAttempts++,this.normalMatchesSinceLastSpawn=0,this.processSpawnStep()):this.normalMatchesSinceLastSpawn++),e.length>14&&(t=this.processGravitationStep(t));const a=this.processShuffleStep(t);this.consumeAnimationQueue(),this.grid=a[0],this.hintPath=a[1]}processSpawnStep(){const[e,t]=ih(Kc(this.grid),2);e.restore(),t.restore(e.id)}processGravitationStep(e){let t=e;const i=[];for(const e of this.parsedGravityRules){t=this.toGravitated(t,e);const n=Th(t);if(0===n.length)continue;n.forEach((e=>{let[t,i]=e;const n=i[0],a=i[1];t.setCoord(n,a)})),t.forEach((e=>{e.node.setSiblingIndex(0)}));const a=async()=>{await Promise.all(n.map((e=>{let[i,[n,a]]=e;return i.sync({delay:.25,duration:.25,getTargetPosition:()=>Vc(t,this.tileSize,{x:n,y:a})})})))};i.push(a)}return this.animationQueue.push((async()=>{for(const e of i)await e()})),t}toGravitated(e,t){const i=new uc(e),n=e.height-1,a=e.width-1,s=[0,n],o=[0,a],r=Math.floor(e.height/2),l=Math.floor(e.width/2),c=e=>e.isHidden();switch(t){case sc:i.gravitate({rowRange:s,colRange:o,direction:ac.Down,isLighter:c});break;case oc:i.gravitate({rowRange:s,colRange:o,direction:ac.Up,isLighter:c});break;case rc:i.gravitate({rowRange:s,colRange:o,direction:ac.Left,isLighter:c});break;case lc:i.gravitate({rowRange:s,colRange:o,direction:ac.Right,isLighter:c});break;case cc:i.gravitate({rowRange:s,colRange:[l,a],direction:ac.Left,isLighter:c,out:i.gravitate({rowRange:s,colRange:[0,l-1],direction:ac.Right,isLighter:c})});break;case hc:i.gravitate({rowRange:[r,n],colRange:o,direction:ac.Down,isLighter:c,out:i.gravitate({rowRange:[0,r-1],colRange:o,direction:ac.Up,isLighter:c})})}return i}getPrimitiveDirection(e,t,i){const n=Math.floor(this.grid.height/2),a=Math.floor(this.grid.width/2);switch(i){case sc:return ac.Down;case oc:return ac.Up;case rc:return ac.Left;case lc:return ac.Right;case cc:return e>=a?ac.Left:ac.Right;case hc:return t>=n?ac.Down:ac.Up}}processShuffleStep(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2?arguments[2]:void 0,n=_h(e);const a=Wc(e).map((e=>{const t=e.getCoord();return[t.x,t.y]}));if(null!==n&&!t)return[e,n];let s,o=100;do{[s]=e.toShuffled(a),n=_h(s),o--}while(null===n&&o>0);if(o<=0)return Qh?.sendException(new Error("No paths found after 100 shuffle attempts"),{message:"No paths found after 100 shuffle attempts",levelData:this.levelData,gridAsArray:s.asArray()}),this.node.scene.emit(Ha.GAME_EXIT),[e,n];const r=Th(s);if(0===r.length)return[s,n];r.forEach((e=>{let[t,[i,n]]=e;t.setCoord(i,n)}));const l=void 0!==i?()=>i(e,s):this.createShuffleAnimationHandler(e,s);return this.animationQueue.push(l),[s,n]}createShuffleAnimationHandler(e,t){const i=async()=>{await Promise.all(e.map(((e,i,n)=>e.sync({duration:.4,easing:"smooth",getTargetPosition:()=>Vc(t,this.tileSize,{x:i,y:n},10)}))))},n=async()=>{t.forEach((e=>{e.node.setSiblingIndex(0)})),await Promise.all(t.map((e=>e.sync({duration:.6,easing:"smooth",delay:ne(0,.4),getTargetPosition:e=>Vc(t,this.tileSize,e)}))))};return async()=>{await i(),await n()}}async consumeAnimationQueue(){if(!this.isConsumingAnimation){for(this.isConsumingAnimation=!0;this.animationQueue.length>0;){if(0===this.getUncleared().length){this.animationQueue=[];break}const e=this.animationQueue.shift();await e()}this.isConsumingAnimation=!1}}}).prototype,"tilePrefab",[Gh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Yh=ve(Wh.prototype,"tilesHolder",[Hh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),jh=ve(Wh.prototype,"tileTrim",[Vh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new J(.025,.1)}}),qh=Wh))||qh)||qh);var td;i._RF.pop(),i._RF.push({},"c92ec8pmUJGbrL9PLjum+i5","Line",void 0);const{ccclass:id}=a;let nd=id("Line")(td=class extends s{onLoad(){this.uiTransform=this.getComponent(l)}setPoints(e,t){this.node.setWorldPosition((e.x+t.x)/2,(e.y+t.y)/2,0),this.uiTransform.width=J.distance(e,t)+10,this.uiTransform.width/=this.node.worldScale.x;const i=180*Math.atan2(t.y-e.y,t.x-e.x)/Math.PI;this.node.eulerAngles=new j(0,0,i)}})||td;i._RF.pop(),i._RF.push({},"1e7cch8i/5DkYHOwJowrjeg","AFPool",void 0);class ad extends ae{constructor(e,t,i,n,a){super(e,t,a),this.ator=i,this.ftor=n}alloc(){const e=super.alloc();return this.ator&&this.ator(e),e}free(e){this.ftor&&this.ftor(e),super.free(e)}}var sd,od,rd,ld,cd,hd,dd,ud,pd,md,gd;i._RF.pop(),i._RF.push({},"6f7a1msxIxIbYLx5PpbL/BZ","PathDrawer",void 0);const{ccclass:yd,property:bd}=a;let fd=(sd=yd("PathDrawer"),od=bd({group:"Line",displayName:"Prefab",type:_}),rd=bd({group:"Line",displayName:"Holder",type:n,tooltip:"Line Prefab"}),ld=bd({group:"Point",displayName:"Prefab",type:_}),cd=bd({group:"Point",displayName:"Holder",type:n}),sd((ud=ve((dd=class extends s{constructor(){super(...arguments),e(this,"linePrefab",ud,this),e(this,"lineHolder",pd,this),this.lineNodes=[],e(this,"pointPrefab",md,this),e(this,"pointHolder",gd,this),this.pointNodes=[]}start(){this.linePool=new ad((()=>{const e=c(this.linePrefab);return this.lineHolder.addChild(e),e.parent=this.lineHolder,e.active=!1,e}),0,(e=>{this.lineNodes.push(e),e.active=!0}),(e=>{e.active=!1}),(e=>{e.isValid&&e.destroy()})),this.pointPool=new ad((()=>{const e=c(this.pointPrefab);return this.pointHolder.addChild(e),e.active=!1,e}),0,(e=>{this.pointNodes.push(e),e.active=!0}),(e=>{e.active=!1}),(e=>{e.isValid&&e.destroy()}))}drawPath(e){this.clearPath();for(const t of e){this.linePool.alloc().getComponent(nd)?.setPoints(t.a,t.b)}}clearPath(){for(const e of this.lineNodes)this.linePool.free(e);this.lineNodes=[];for(const e of this.pointNodes)this.pointPool.free(e);this.pointNodes=[]}}).prototype,"linePrefab",[od],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),pd=ve(dd.prototype,"lineHolder",[rd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),md=ve(dd.prototype,"pointPrefab",[ld],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),gd=ve(dd.prototype,"pointHolder",[cd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),hd=dd))||hd);var wd,Sd,vd,Cd,Ed,Td,Ad,Rd,Id;i._RF.pop(),i._RF.push({},"5cc7bAmTI1JL7nwLzZcp45u","ErrorDrawer",void 0);const{ccclass:Pd,property:_d}=a;let Ld=(wd=Pd("ErrorDrawer"),Sd=_d(N),vd=_d(N),Cd=_d(N),wd((Ad=ve((Td=class extends fd{constructor(){super(...arguments),e(this,"one",Ad,this),e(this,"two",Rd,this),e(this,"error",Id,this)}start(){super.start(),this.pathAppearDuration=0}drawPath(e){if(this.clearPath(),e.forEach(((t,i)=>{if(this.linePool.alloc().getComponent(nd)?.setPoints(t.a,t.b),0!==i){const n=this.pointPool.alloc();n.setWorldPosition(new j(t.a.x,t.a.y,0));const a=n.getComponent(R);1===i&&e.length>3?a.spriteFrame=this.one:2===i&&e.length>3?a.spriteFrame=this.two:a.spriteFrame=this.error}})),1===e.length){const t=this.pointPool.alloc();t.setWorldPosition(new j(e[0].a.x+e[0].b.x,e[0].a.y+e[0].b.y,0).multiplyScalar(.5)),t.getComponent(R).spriteFrame=this.error}this.pathAppearDuration=.8}update(e){this.pathAppearDuration>0&&(this.pathAppearDuration-=e,this.pathAppearDuration<=0&&this.clearPath())}}).prototype,"one",[Sd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Rd=ve(Td.prototype,"two",[vd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Id=ve(Td.prototype,"error",[Cd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ed=Td))||Ed);var Dd;i._RF.pop(),i._RF.push({},"880e8aL9NFPj68zH2xVRIFR","HintDrawer",void 0);const{ccclass:Od}=a;let Nd=Od("HintDrawer")(Dd=class extends fd{drawPath(e){this.clearPath(),this.createPath(e),this.showPath()}createPath(e){e.forEach((e=>{this.linePool.alloc().getComponent(nd)?.setPoints(e.a,e.b);this.pointPool.alloc().setWorldPosition(e.a.x,e.a.y,0)}));this.pointPool.alloc().setWorldPosition(e[e.length-1].b.x,e[e.length-1].b.y,0)}showPath(){for(const e of this.lineNodes){const t=e.getComponent(x);t.opacity=0,C(t).to(.2,{opacity:255},{easing:"quadOut"}).start()}for(const e of this.pointNodes){const t=e.getComponent(x);t.opacity=0,C(t).to(.2,{opacity:255},{easing:"quadOut"}).start()}}clearPath(){for(const e of this.lineNodes){const t=e.getComponent(x);C(t).to(.15,{opacity:0},{onComplete:()=>{t.opacity=255,this.linePool.free(e)}}).start()}for(const e of this.pointNodes){const t=e.getComponent(x);C(t).to(.15,{opacity:0},{onComplete:()=>{t.opacity=255,this.pointPool.free(e)}}).start()}this.lineNodes=[],this.pointNodes=[]}})||Dd;var Md;i._RF.pop(),i._RF.push({},"25f67BW5/5Jzox4v+yBBbyS","MatchDrawer",void 0);const{ccclass:kd}=a;let xd=kd("MatchDrawer")(Md=class extends fd{drawPath(e){e.forEach(((e,t)=>{const i=this.linePool.alloc();i.getComponent(nd)?.setPoints(e.a,e.b),this.animateLine(i);const n=this.pointPool.alloc();n.setWorldPosition(e.a.x,e.a.y,0),this.animatePoint(n,t)}));const t=this.pointPool.alloc();t.setWorldPosition(e[e.length-1].b.x,e[e.length-1].b.y,0),this.animatePoint(t,e.length)}async animateLine(e){const t=e.getComponent(x);t.opacity=0;const i=C(t).to(.25,{opacity:255},{easing:"quadOut"}).delay(.1).to(.2,{opacity:0});await vt.runTweenAsync(i),t.opacity=255,this.linePool.free(e)}async animatePoint(e,t){e.scale=j.ZERO;const i=C(e).delay(.03*t).to(.2,{scale:j.ONE},{easing:"quadOut"}).delay(.1).to(.2,{scale:j.ZERO},{easing:"backIn"});await vt.runTweenAsync(i),this.pointPool.free(e)}clearPath(){this.lineNodes=[],this.pointNodes=[]}})||Md;var Fd,Bd,zd,Ud,Gd,Hd,Vd,qd,Wd;i._RF.pop(),i._RF.push({},"bfdf2THr9lPJ4TOVDN8VgE4","PathDraw",void 0);const{ccclass:Kd,property:Yd}=a;let jd=(Fd=Kd("PathDraw"),Bd=Yd({group:{name:"Path Drawer"},type:xd}),zd=Yd({group:{name:"Path Drawer"},type:Nd}),Ud=Yd({group:{name:"Path Drawer"},type:Ld}),Fd((Vd=ve((Hd=class extends s{constructor(){super(...arguments),e(this,"matchPath",Vd,this),e(this,"hintPath",qd,this),e(this,"errorPath",Wd,this),this.isDrawingHint=!1}drawMatchPath(e,t){e=e.map((e=>({...e})));for(const i of e)i.a=t(i.a),i.b=t(i.b);this.matchPath.drawPath(e)}clearMatchPath(){this.matchPath.clearPath()}drawHintPath(e,t){if(!this.isDrawingHint){this.isDrawingHint=!0,e=e.map((e=>({...e})));for(const i of e)i.a=t(i.a),i.b=t(i.b);this.hintPath.drawPath(e)}}clearHintPath(){this.isDrawingHint&&(this.isDrawingHint=!1,this.hintPath.clearPath())}drawErrorPath(e,t){e=e.map((e=>({...e})));for(const i of e)i.a=t(i.a),i.b=t(i.b);this.errorPath.drawPath(e)}}).prototype,"matchPath",[Bd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),qd=ve(Hd.prototype,"hintPath",[zd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Wd=ve(Hd.prototype,"errorPath",[Ud],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Gd=Hd))||Gd);var Xd;i._RF.pop(),i._RF.push({},"3afb9sM0KZKyod8UtofqZYu","ComboManager",void 0);const{ccclass:$d}=a;let Jd=$d("ComboManager")(Xd=class extends s{init(){this.currentCombo=0,this.setEmitEvent(!0),this.node.scene.on(Ha.COMBO_ENDED,this.resetCombo,this),this.node.scene.on(Ha.GAME_FINISH,this.resetCombo,this),this.node.scene.on(Ha.GAME_REPLAY,this.resetCombo,this),this.node.scene.on(Ha.NEXT_LEVEL,this.resetCombo,this),this.node.scene.on(Ha.ADD_COMBO,this.addCombo,this)}addCombo(){this.setCombo(this.currentCombo+1)}resetCombo(){this.setCombo(0)}getCombo(){return this.currentCombo}setCombo(e){if(this.currentCombo=e,e>0&&e<5){const t=[Bi.COMBO_1,Bi.COMBO_2,Bi.COMBO_3,Bi.COMBO_4,Bi.COMBO_5];Xi.playSound(t[e])}else e>=5&&Xi.playSound(Bi.COMBO_5);e>0&&this.vibrate(e),this.emitEvent&&this.node.scene.emit(Ha.COMBO_UPDATED,e)}vibrate(e){P("Vibrate")?.getComponent(gr)?.vibrate(Math.min(20+20*e,220))}setEmitEvent(e){this.emitEvent=e}})||Xd;var Qd,Zd,eu,tu,iu,nu,au,su,ou,ru,lu,cu,hu,du,uu,pu,mu;i._RF.pop(),i._RF.push({},"da8a1SD+ahMFpc6MIdiFP5H","ShiningStar",void 0);const{ccclass:gu,property:yu,disallowMultiple:bu}=a;let fu=(Qd=gu("ShiningStar"),Zd=yu(R),eu=yu({serializable:!0,visible:!1}),tu=yu({type:E,displayName:"Scale up duration",min:.001}),iu=yu({serializable:!0,visible:!1}),nu=yu({type:E,displayName:"Bounce and Fall duration",min:.001}),au=yu({serializable:!0,visible:!1}),su=yu({type:E,displayName:"Start scale"}),ou=yu({serializable:!0,visible:!1}),ru=yu({type:E,displayName:"End scale"}),Qd(lu=bu((hu=ve((cu=class extends s{constructor(){super(...arguments),e(this,"shine",hu,this),e(this,"twScaleUpDuration",du,this),e(this,"twBounceAndFallDuration",uu,this),e(this,"twStartScale",pu,this),e(this,"twEndScale",mu,this),this.isBeingAnimated=!1}get scaleUpDuration(){return this.twScaleUpDuration}set scaleUpDuration(e){this.twScaleUpDuration=e}get bounceAndFallDuration(){return this.twBounceAndFallDuration}set bounceAndFallDuration(e){this.twBounceAndFallDuration=e}get startScale(){return this.twStartScale}set startScale(e){this.twStartScale=e}get endScale(){return this.twEndScale}set endScale(e){this.twEndScale=e}get isAvailable(){return!this.isBeingAnimated}__preload(){this.shineOpacity=this.shine.node.getComponent(x),this.uiOpacity=this.node.getComponent(x),this.validateRequiredComponents()}onLoad(){this.uiOpacity.opacity=0}async playAnimation(){if(!this.isAvailable)throw new Error("ShiningStar: This star is being animated.");this.isBeingAnimated=!0,await this.animateAppear(),await this.animateDisappear(),this.isBeingAnimated=!1}async animateAppear(){this.shineOpacity.opacity=255,await Promise.all([this.animateFadeIn(),this.animateScaleUp()])}async animateDisappear(){await Promise.all([this.animateBounceAndFall(),this.animateScaleDown()]),this.node.setScale(0,0),this.uiOpacity.opacity=0}async animateBounceAndFall(){const e=this.node.position.x,t=this.node.position.y,i=[60,120],n=(Math.random()*(i[1]-i[0])+i[0])*(Math.PI/180),a=e+200*Math.cos(n),s=t+200*Math.sin(n),o=t-500,r=vt.runTweenAsync(C(this.node).to(.2*this.twBounceAndFallDuration,{position:new j(a,s,this.node.position.z)},{easing:"sineOut"}).to(.4*this.twBounceAndFallDuration,{position:new j(a,o,this.node.position.z)},{easing:"cubicIn"})),l=[0,360],c=vt.runTweenAsync(C(this.node).to(this.twBounceAndFallDuration,{eulerAngles:new j(0,0,Math.random()*(l[1]-l[0])*(a>e?-1:1))},{easing:"sineOut"}));await Promise.all([r,c]),this.node.eulerAngles=new j(0,0,0)}async animateFadeIn(){const e=Math.max(this.scaleUpDuration/4,.01);await vt.runTweenAsync(C(this.uiOpacity).to(e,{opacity:255}))}async animateScaleUp(){this.node.setScale(this.startScale,this.startScale);const e=new j(this.endScale,this.endScale,1);await vt.runTweenAsync(C(this.node).to(this.scaleUpDuration,{scale:e},{easing:"cubicOut"}))}async animateScaleDown(){const e=new j(0,0,1);await vt.runTweenAsync(C(this.node).delay(.1*this.bounceAndFallDuration).to(.5*this.bounceAndFallDuration,{scale:e},{easing:"cubicIn"}))}validateRequiredComponents(){Fe.lazyValidateProperties(this)}}).prototype,"shine",[Zd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),du=ve(cu.prototype,"twScaleUpDuration",[eu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.5}}),ve(cu.prototype,"scaleUpDuration",[tu],Object.getOwnPropertyDescriptor(cu.prototype,"scaleUpDuration"),cu.prototype),uu=ve(cu.prototype,"twBounceAndFallDuration",[iu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.5}}),ve(cu.prototype,"bounceAndFallDuration",[nu],Object.getOwnPropertyDescriptor(cu.prototype,"bounceAndFallDuration"),cu.prototype),pu=ve(cu.prototype,"twStartScale",[au],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.5}}),ve(cu.prototype,"startScale",[su],Object.getOwnPropertyDescriptor(cu.prototype,"startScale"),cu.prototype),mu=ve(cu.prototype,"twEndScale",[ou],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),ve(cu.prototype,"endScale",[ru],Object.getOwnPropertyDescriptor(cu.prototype,"endScale"),cu.prototype),lu=cu))||lu)||lu);var wu,Su,vu,Cu,Eu;i._RF.pop(),i._RF.push({},"2e9aaj8L6lN1pTv2xGEj1sE","StarParticles",void 0);const{ccclass:Tu,property:Au,disallowMultiple:Ru}=a,{Array:Iu}=GameCore.Utils;let Pu=(wu=Tu("StarParticles"),Su=Au({type:[fu],displayName:"Prebuilt Shining stars"}),wu(vu=Ru((Eu=ve((Cu=class extends s{constructor(){super(...arguments),e(this,"shiningStars",Eu,this)}__preload(){this.validateRequiredComponents()}async fireShiningStarAt(e){const t=this.getFirstAvailableShiningStar();if(void 0===t)throw new Error("No available shining stars. Please add more prebuilt shining stars or calls this function later.");const[i,n]=e,a=new j(i,n,this.node.worldPosition.z);t.node.worldPosition=a,await t.playAnimation()}getFirstAvailableShiningStar(){return Iu.search(this.shiningStars,(e=>e.isAvailable))}validateRequiredComponents(){Fe.lazyValidateProperties(this)}}).prototype,"shiningStars",[Su],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),vu=Cu))||vu)||vu);var _u,Lu,Du,Ou,Nu,Mu,ku,xu,Fu,Bu,zu,Uu,Gu,Hu,Vu,qu,Wu,Ku,Yu,ju,Xu;i._RF.pop(),i._RF.push({},"2913d3KShhIEaPfSLUhFqvA","EffectManager",void 0);const{ccclass:$u,property:Ju}=a;let Qu=(_u=$u("EffectManager"),Lu=Ju({group:"Thunder Effect",type:n}),Du=Ju({group:"Thunder Effect",type:n}),Ou=Ju({group:"Mask Effect",type:Wn}),Nu=Ju({group:"Mask Effect",type:n}),Mu=Ju({group:"Tornado Effect",type:n}),ku=Ju({group:"Clear Particle Effect",type:n,displayName:"Particle holder node"}),xu=Ju({group:"Clear Particle Effect",type:se,displayName:"Emitter 1"}),Fu=Ju({group:"Clear Particle Effect",type:se,displayName:"Emitter 2"}),Bu=Ju({group:"Star Particles Effect",type:Pu}),_u((Gu=ve((Uu=class extends s{constructor(){super(...arguments),e(this,"cloud",Gu,this),e(this,"lightnings",Hu,this),e(this,"backgroundMask",Vu,this),e(this,"masks",qu,this),e(this,"tornado",Wu,this),this.bombExplosion=null,this.bombExplosionPool=null,this.defuseExplosion=null,this.defuseExplosionPool=null,e(this,"clearParticleHolder",Ku,this),e(this,"clearParticle1",Yu,this),e(this,"clearParticle2",ju,this),e(this,"starParticle",Xu,this),this.maskTargets=[]}__preload(){this.validateRequiredComponents()}update(){this.maskTargets.length>0&&this.maskTargets.forEach(((e,t)=>{if(e.isHidden())return;this.masks[t].worldPosition=e.node.worldPosition.clone()}))}validateRequiredComponents(){Fe.lazyValidateProperties(this)}start(){this.node.scene.on(Ha.GRID_RESIZE,this.handleBoardResize,this)}playClearFXAt(e){this.clearParticle1.node.setWorldPosition(new j(e[0].x,e[0].y,1)),this.clearParticle2.node.setWorldPosition(new j(e[1].x,e[1].y,1)),this.clearParticle1.resetSystem(),this.clearParticle2.resetSystem()}playStarFXAt(e){this.starParticle.fireShiningStarAt(e)}async playTornadoAnimation(){if(null===this.tornado.getChildByName("Sprite").getComponent(y).defaultClip)return void console.warn("EffectManager: Tornado animation is not loaded when animation play request was made.");this.tornado.active=!0;const e=C(this.tornado);e.set({scale:new j(0,0,0)}),e.delay(.5),e.to(.5,{scale:new j(1,1,1)},{easing:"quadOut"}),e.to(.5,{scale:new j(0,0,0)},{easing:"quadIn"}),e.set({active:!1}),hi.setBlockInput(!0),await vt.runTweenAsync(e),hi.setBlockInput(!1)}async shakeGame(){const e=this.node.position.clone(),t=C(this.node).to(.05,{position:e.clone().add3f(ne(5,10),ne(5,10),0)}).to(.05,{position:e.clone().subtract3f(ne(5,10),ne(5,10),0)}).to(.05,{position:e});await vt.runTweenAsync(t)}handleBoardResize(e){this.clearParticleHolder.setScale(e,e)}async playThunderAnimation(e,t){this.cloud.active=!0;const i=P("Canvas").getComponent(l),{width:n,height:a}=i;let s=0,o=0;switch(Math.floor(4*Math.random())){case 0:s=Math.random()*n-n/2,o=a/2+300;break;case 1:s=Math.random()*n-n/2,o=-a/2-300;break;case 2:s=-n/2-300,o=Math.random()*a-a/2;break;case 3:s=n/2+300,o=Math.random()*a-a/2}this.cloud.position=new j(s,o),this.resetMasks(),this.setMaskProperties(0,e[0][0].node.worldPosition,e[0][0].node.worldScale),this.setMaskProperties(1,e[0][1].node.worldPosition,e[0][1].node.worldScale),this.setMaskProperties(2,e[1][0].node.worldPosition,e[1][0].node.worldScale),this.setMaskProperties(3,e[1][1].node.worldPosition,e[1][1].node.worldScale),this.maskTargets=[e[0][0],e[0][1],e[1][0],e[1][1]],await this.setBackgroundMaskActive(!0);const r=C(this.cloud).to(.8,{position:new j(0,300)},{easing:"quadOut"});await vt.runTweenAsync(r);const c=e[0][0].node.worldPosition.clone(),h=e[0][1].node.worldPosition.clone();this.shakeGame(),P("Vibrate")?.getComponent(gr)?.vibrate(500),Xi.playSound(Bi.THUNDERBOLT),t.clear([e[0]],"break"),await Promise.all([this.playLightningAnimation(c,0),this.playLightningAnimation(h,1)]),this.node.scene.emit(Ha.ADD_COMBO),this.node.scene.emit(Ha.ADD_SCORE);const d=e[1][1].node.worldPosition.clone(),u=e[1][0].node.worldPosition.clone();this.shakeGame(),P("Vibrate")?.getComponent(gr)?.vibrate(500),Xi.playSound(Bi.THUNDERBOLT),t.clear([e[1]],"break"),await Promise.all([this.playLightningAnimation(u,0),this.playLightningAnimation(d,1)]),this.node.scene.emit(Ha.ADD_COMBO),this.node.scene.emit(Ha.ADD_SCORE),this.cloud.active=!1,await this.setBackgroundMaskActive(!1),this.maskTargets=[]}async playLightningAnimation(e,t){const i=this.lightnings[t],n=e.subtract(i.worldPosition),a=Math.atan2(n.y,n.x)*(180/Math.PI)+180,s=n.length();return i.getComponent(l).width=s,i.angle=a,new Promise((e=>{i.active=!0,this.scheduleOnce((()=>{i.active=!1,e()}),.2)}))}async setBackgroundMaskActive(e){e&&(this.backgroundMask.node.active=!0),await this.backgroundMask.changeStateFade(e,.25),e||(this.backgroundMask.node.active=!1)}resetMasks(){this.masks.forEach((e=>{e.worldPosition=new j(-9999,-9999,0)}))}setMaskProperties(e,t,i){i&&(this.masks[e].worldScale=i),this.masks[e].worldPosition=t}async createDefuseExplosionAt(e){await this.loadDefuseExplosionPrefab(),this.defuseExplosionPool||(this.defuseExplosionPool=new ad(this.createDefuseExplosion.bind(this),1,Zu.getBombDefuseExplosion,Zu.returnBombDefuseExplosion,Zu.destroyBombDefuseExplosion));const t=this.defuseExplosionPool.alloc();t.setWorldPosition(e);const i=t.getComponent(y);if(await vt.runAnimationAsync(i),!this.defuseExplosionPool)throw new Error("EffectManager: defuseExplosionPool is null");this.defuseExplosionPool.free(t)}async createBombExplosionAt(e){await this.loadBombExplosionPrefab(),this.bombExplosionPool||(this.bombExplosionPool=new ad(this.createBombExplosion.bind(this),1,ep.getBombExplosion,ep.returnBombExplosion,ep.destroyBombExplosion));const t=this.bombExplosionPool.alloc();t.setWorldPosition(e);const i=t.getComponent(y);if(await vt.runAnimationAsync(i),!this.bombExplosionPool)throw new Error("EffectManager: bombExplosionPool is null");this.bombExplosionPool.free(t)}createDefuseExplosion(){if(!this.defuseExplosion)throw new Error("EffectManager: defuseExplosion is not loaded!");return Zu.createDefuseExplosion(this.defuseExplosion,this.node)}createBombExplosion(){if(!this.bombExplosion)throw new Error("EffectManager: bombExplosion is not loaded!");return ep.createBombExplosion(this.bombExplosion,this.node)}async loadBombExplosionPrefab(){if(this.bombExplosion)return Promise.resolve();const e=await hi.loadPrefabAsync(ri.BOMB_EXPLODE_PREFAB);return e&&(this.bombExplosion=e),Promise.resolve()}async loadDefuseExplosionPrefab(){if(this.defuseExplosion)return Promise.resolve();const e=await hi.loadPrefabAsync(ri.BOMB_DEFUSE_PREFAB);return e&&(this.defuseExplosion=e),Promise.resolve()}async loadThunderAnimation(){const e=this.cloud.getChildByName("Top").getComponent(y);if(null!==e.defaultClip)return Promise.resolve();const t=await hi.loadAnimClipAsync(ri.CLOUD_IDLE_ANIM);return t&&(e.defaultClip=t),Promise.resolve()}async loadTornadoAnimation(){const e=this.tornado.getChildByName("Sprite").getComponent(y);if(null!==e.defaultClip)return Promise.resolve();const t=await hi.loadAnimClipAsync(ri.TORNADO_IDLE_ANIM);return t&&(e.defaultClip=t),Promise.resolve()}}).prototype,"cloud",[Lu],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Hu=ve(Uu.prototype,"lightnings",[Du],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Vu=ve(Uu.prototype,"backgroundMask",[Ou],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),qu=ve(Uu.prototype,"masks",[Nu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Wu=ve(Uu.prototype,"tornado",[Mu],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ku=ve(Uu.prototype,"clearParticleHolder",[ku],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Yu=ve(Uu.prototype,"clearParticle1",[xu],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ju=ve(Uu.prototype,"clearParticle2",[Fu],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Xu=ve(Uu.prototype,"starParticle",[Bu],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),zu=Uu))||zu);class Zu{static createDefuseExplosion(e,t){const i=c(e);return t.addChild(i),i.active=!1,i}static destroyBombDefuseExplosion(e){e.destroy()}static getBombDefuseExplosion(e){e.active=!0}static returnBombDefuseExplosion(e){e.active=!1}}class ep{static createBombExplosion(e,t){const i=c(e);return t.addChild(i),i.active=!1,i}static destroyBombExplosion(e){e.destroy()}static getBombExplosion(e){e.active=!0}static returnBombExplosion(e){e.active=!1}}i._RF.pop(),i._RF.push({},"062f3AVHntKsIyireZmXg9P","GuideKeys",void 0);const tp="newbie",ip="timer",np="combo",ap="hint-item",sp="thunder-item",op="storm-item",rp="pliers-item";i._RF.pop(),i._RF.push({},"6448denZfFEUru9tWmWGb7N","Guide01Newbie",void 0);const lp=.7261538461538461;class cp{constructor(e){this.manager=e,this.gameplay=e.gameplay}setup(){this.currentStep=0,this.manager.node.scene.on(Ha.GRID_MATCH_SUCCESS,this.showNextStep,this),this.manager.node.scene.on(Ha.GRID_MATCH_FAIL,this.showNextStep,this),W.on(Yn,this.handleViewResized,this),W.on(Xn,this.handleViewResized,this),this.showStep(this.currentStep),this.manager.node.scene.emit(Ha.HIDE_UI),this.manager.guideSkipButton.active=!0}showNextStep(){this.currentStep+1<dh.length?(this.currentStep+=1,this.showStep(this.currentStep)):this.close()}async showStep(e){const{board:t,effectManager:i}=this.gameplay,n=dh[e].startTile,a=dh[e].endTile,s=t.getTileAt(n.x,n.y),o=t.getTileAt(a.x,a.y);if(!s||!o)return;const r=s.node.worldPosition,l=o.node.worldPosition;i.resetMasks(),i.setMaskProperties(0,r,s.node.worldScale),i.setMaskProperties(1,l,o.node.worldScale),i.setBackgroundMaskActive(!0);const{guideHand:c,guideTextBox:h}=this.manager;c.node.active=!0,c.playHandAnimation(r,l),this.alignGuideTextBox(),this.alignSkipButton(),await h.hide(),h.setText(dh[e].description),await h.show(),t.setIgnoreInput(!0),s.setIgnoreInput(!1),o.setIgnoreInput(!1),this.gameplay.comboManager.setEmitEvent(!1)}handleViewResized(){const{board:e,effectManager:t}=this.gameplay,i=dh[this.currentStep].startTile,n=dh[this.currentStep].endTile,a=e.getTileAt(i.x,i.y),s=e.getTileAt(n.x,n.y);if(!a||!s)return;const o=a.node.worldPosition,r=s.node.worldPosition;t.setMaskProperties(0,o,a.node.worldScale),t.setMaskProperties(1,r,s.node.worldScale),this.alignGuideTextBox(),this.alignSkipButton()}alignGuideTextBox(){const{board:e}=this.gameplay,{guideTextBox:t}=this.manager,i=e.getTileAt(0,0);if(!i)return;const n=i.node.worldPosition,a=e.tilesHolder.getWorldScale(),s=e.getTileSize()[1]*a.y,o=a.clone().multiplyScalar(lp);t.node.setWorldScale(o),t.node.setWorldPosition(new j(t.node.worldPosition.x,(n.y-s/2)/2))}alignSkipButton(){const{board:e}=this.gameplay,{guideSkipButton:t}=this.manager;if(!t)return;const i=e.getTileAt(0,e.getGridSize()[1]-1);if(!i)return;const n=i.node.worldPosition,a=e.tilesHolder.getWorldScale(),s=e.getTileSize()[1]*a.y,o=a.clone().multiplyScalar(lp),r=t.getComponent(l).contentSize.height*o.y;t.setWorldScale(o),t.setWorldPosition(new j(t.worldPosition.x,n.y+(s+r)/2+30))}async close(){const{board:e,effectManager:t}=this.gameplay;this.manager.node.scene.off(Ha.GRID_MATCH_SUCCESS,this.showNextStep,this),this.manager.node.scene.off(Ha.GRID_MATCH_FAIL,this.showNextStep,this),W.off(Yn,this.handleViewResized,this),W.off(Xn,this.handleViewResized,this),e.setIgnoreInput(!1),await Promise.all([await this.manager.guideTextBox.hide(),await t.setBackgroundMaskActive(!1)]),this.manager.guideHand.node.active=!1,this.manager.completeGuide(tp)}}i._RF.pop(),i._RF.push({},"a52daB3sGxP8JyGBZo5K1+X","Guide02Timer",void 0);class hp{constructor(e){this.manager=e,this.gameplay=e.gameplay}async setup(){const{guideMasks:e,guideInfoText:t}=this.manager,{clock:i}=this.gameplay.uiManager;let{width:n,height:a}=i.getComponent(l).contentSize;const s=i.node.worldPosition;n*=1.5,a*=1.5,await this.gameplay.handleShowUI(),e.node.active=!0,e.setOtherMaskTransform(s.x,s.y,n,a),t.node.active=!0,t.string="Remove all tiles before\nthe time end",t.node.setWorldPosition(s.x,s.y-a/2-50,0),t.horizontalAlign=oe.CENTER,t.getComponent(l).setAnchorPoint(.5,.5),await e.show(),this.manager.node.scene.once(Ha.GUIDE_MASK_CLICKED,this.close,this),this.manager.node.scene.emit(Ha.PAUSE_TIME),W.on(Yn,this.handleViewResized,this),W.on(Xn,this.handleViewResized,this)}handleViewResized(){const{guideMasks:e,guideInfoText:t}=this.manager,{clock:i}=this.gameplay.uiManager;let{width:n,height:a}=i.getComponent(l).contentSize;const s=i.node.worldPosition;n*=1.5,a*=1.5,e.setOtherMaskTransform(s.x,s.y,n,a),t.node.setWorldPosition(s.x,s.y-a/2-50,0)}async close(){const{guideInfoText:e,guideMasks:t}=this.manager;this.gameplay.comboManager.setEmitEvent(!0),this.gameplay.stateManager.isPlaying()&&this.manager.node.scene.emit(Ha.RESUME_TIME),await t.hide(),e.node.active=!1,this.manager.completeGuide(ip),W.off(Yn,this.handleViewResized,this),W.off(Xn,this.handleViewResized,this)}}i._RF.pop(),i._RF.push({},"add56o6JFNHAZiCO6F+Z9jK","Guide03Combo",void 0);class dp{constructor(e){this.manager=e,this.gameplay=e.gameplay}async setup(){const{guideMasks:e,guideInfoText:t}=this.manager,{comboContainer:i}=this.gameplay.uiManager;let{width:n,height:a}=i.getComponent(l).contentSize;const s=i.worldPosition;n*=1.5,a*=1.5,e.node.active=!0,e.setOtherMaskTransform(s.x,s.y,n,a),t.node.active=!0,t.string="Remove tiles continuously\nto increase combo!",t.node.setWorldPosition(s.x-n/2-10,s.y,0),t.horizontalAlign=oe.RIGHT,t.getComponent(l).setAnchorPoint(1,.5),await e.show(),this.manager.node.scene.once(Ha.GUIDE_MASK_CLICKED,this.close,this),this.manager.node.scene.emit(Ha.PAUSE_TIME),W.on(Yn,this.handleViewResized,this),W.on(Xn,this.handleViewResized,this)}handleViewResized(){const{guideMasks:e,guideInfoText:t}=this.manager,{comboContainer:i}=this.gameplay.uiManager;let{width:n,height:a}=i.getComponent(l).contentSize;const s=i.worldPosition;n*=1.5,a*=1.5,e.setOtherMaskTransform(s.x,s.y,n,a),t.node.setWorldPosition(s.x-n/2-10,s.y,0)}async close(){const{guideInfoText:e,guideMasks:t}=this.manager;this.manager.node.scene.emit(Ha.RESUME_TIME),t.node.off(n.EventType.TOUCH_START,this.close,this),await t.hide(),e.node.active=!1,this.manager.completeGuide(np),W.off(Yn,this.handleViewResized,this),W.off(Xn,this.handleViewResized,this)}}i._RF.pop(),i._RF.push({},"fd93d+WLXVHk4yJGmVeSjmR","Guide04Hint",void 0);const{Array:up}=GameCore.Utils;class pp{constructor(e){this.manager=e,this.gameplay=e.gameplay}async setup(){const{guideMasks:e,guideInfoText:t}=this.manager,i=up.search(this.gameplay.itemManager.items,(e=>e.itemType===br.HINT));if(!i)return;const n=i.node.worldPosition;let{width:a,height:s}=i.getComponent(l).contentSize;a+=40,s+=40,e.node.active=!0,e.setItemMaskTransform(n.x,n.y,a,s),t.node.active=!0,t.string="Tap to reveal a connectable pair",t.node.setPosition(0,0),t.node.setWorldPosition(t.node.worldPosition.x,n.y+s/2+30,0),t.horizontalAlign=oe.CENTER,t.getComponent(l).setAnchorPoint(.5,.5),await e.show(),this.manager.node.scene.once(Ha.GUIDE_MASK_CLICKED,this.close,this),this.manager.node.scene.emit(Ha.PAUSE_TIME),W.on(Yn,this.handleViewResized,this),W.on(Xn,this.handleViewResized,this)}handleViewResized(){const{guideMasks:e,guideInfoText:t}=this.manager,i=up.search(this.gameplay.itemManager.items,(e=>e.itemType===br.HINT));if(!i)return;const n=i.node.worldPosition;let{width:a,height:s}=i.getComponent(l).contentSize;a+=40,s+=40,e.setItemMaskTransform(n.x,n.y,a,s),t.node.setWorldPosition(t.node.worldPosition.x,n.y+s/2+30,0)}async close(){const{guideMasks:e,guideInfoText:t}=this.manager;this.manager.node.scene.emit(Ha.RESUME_TIME),await e.hide(),t.node.active=!1,this.manager.completeGuide(ap),W.off(Yn,this.handleViewResized,this),W.off(Xn,this.handleViewResized,this)}}i._RF.pop(),i._RF.push({},"b08f4dC/r1EPbsfAe1wtcBg","Guide05Thunder",void 0);const{Array:mp}=GameCore.Utils;class gp{constructor(e){this.manager=e,this.gameplay=e.gameplay}async setup(){const{guideMasks:e,guideInfoText:t}=this.manager,i=mp.search(this.gameplay.itemManager.items,(e=>e.itemType===br.THUNDER));if(!i)return;const n=i.node.worldPosition;let{width:a,height:s}=i.getComponent(l).contentSize;a+=40,s+=40,e.node.active=!0,e.setItemMaskTransform(n.x,n.y,a,s),t.node.active=!0,t.string="Tap to remove 2 pairs",t.node.setPosition(0,0),t.node.setWorldPosition(t.node.worldPosition.x,n.y+s/2+30,0),t.horizontalAlign=oe.CENTER,t.getComponent(l).setAnchorPoint(.5,.5),await e.show(),this.manager.node.scene.once(Ha.GUIDE_MASK_CLICKED,this.close,this),this.manager.node.scene.emit(Ha.PAUSE_TIME),W.on(Yn,this.handleViewResized,this),W.on(Xn,this.handleViewResized,this)}handleViewResized(){const{guideMasks:e,guideInfoText:t}=this.manager,i=mp.search(this.gameplay.itemManager.items,(e=>e.itemType===br.THUNDER));if(!i)return;const n=i.node.worldPosition;let{width:a,height:s}=i.getComponent(l).contentSize;a+=40,s+=40,e.setItemMaskTransform(n.x,n.y,a,s),t.node.setWorldPosition(t.node.worldPosition.x,n.y+s/2+30,0)}async close(){const{guideMasks:e,guideInfoText:t}=this.manager;this.manager.node.scene.emit(Ha.RESUME_TIME),await e.hide(),t.node.active=!1,this.manager.completeGuide(sp),W.off(Yn,this.handleViewResized,this),W.off(Xn,this.handleViewResized,this)}}i._RF.pop(),i._RF.push({},"f4ef8MBZxxKC4bfuDzsLQ5X","Guide06Storm",void 0);const{Array:yp}=GameCore.Utils;class bp{constructor(e){this.manager=e,this.gameplay=e.gameplay}async setup(){const{guideMasks:e,guideInfoText:t}=this.manager,i=yp.search(this.gameplay.itemManager.items,(e=>e.itemType===br.STORM));if(!i)return;const n=i.node.worldPosition;let{width:a,height:s}=i.getComponent(l).contentSize;a+=40,s+=40,e.node.active=!0,e.setItemMaskTransform(n.x,n.y,a,s),t.node.active=!0,t.string="Tap to rearrange the tiles",t.node.setPosition(0,0),t.node.setWorldPosition(t.node.worldPosition.x,n.y+s/2+30,0),t.horizontalAlign=oe.CENTER,t.getComponent(l).setAnchorPoint(.5,.5),await e.show(),this.manager.node.scene.once(Ha.GUIDE_MASK_CLICKED,this.close,this),this.manager.node.scene.emit(Ha.PAUSE_TIME),W.on(Yn,this.handleViewResized,this),W.on(Xn,this.handleViewResized,this)}handleViewResized(){const{guideMasks:e,guideInfoText:t}=this.manager,i=yp.search(this.gameplay.itemManager.items,(e=>e.itemType===br.STORM));if(!i)return;const n=i.node.worldPosition;let{width:a,height:s}=i.getComponent(l).contentSize;a+=40,s+=40,e.setItemMaskTransform(n.x,n.y,a,s),t.node.setWorldPosition(t.node.worldPosition.x,n.y+s/2+30,0)}async close(){const{guideMasks:e,guideInfoText:t}=this.manager;this.manager.node.scene.emit(Ha.RESUME_TIME),await e.hide(),t.node.active=!1,this.manager.completeGuide(op),W.off(Yn,this.handleViewResized,this),W.off(Xn,this.handleViewResized,this)}}i._RF.pop(),i._RF.push({},"9920dDqYP9ITJp0bSlZ+K9R","Guide07Pliers",void 0);const{Array:fp}=GameCore.Utils;class wp{constructor(e){this.manager=e,this.gameplay=e.gameplay}async setup(){const{guideMasks:e,guideInfoText:t}=this.manager,i=fp.search(this.gameplay.itemManager.items,(e=>e.itemType===br.PLIERS));if(!i)return;const n=i.node.worldPosition;let{width:a,height:s}=i.getComponent(l).contentSize;a+=40,s+=40,e.node.active=!0,e.setItemMaskTransform(n.x,n.y,a,s),t.node.active=!0,t.string="Tap to remove bomb",t.node.setPosition(0,0),t.node.setWorldPosition(t.node.worldPosition.x,n.y+s/2+30,0),t.horizontalAlign=oe.CENTER,t.getComponent(l).setAnchorPoint(.5,.5),await e.show(),this.manager.node.scene.once(Ha.GUIDE_MASK_CLICKED,this.close,this),this.manager.node.scene.emit(Ha.PAUSE_TIME),W.on(Yn,this.handleViewResized,this),W.on(Xn,this.handleViewResized,this)}handleViewResized(){const{guideMasks:e,guideInfoText:t}=this.manager,i=fp.search(this.gameplay.itemManager.items,(e=>e.itemType===br.PLIERS));if(!i)return;const n=i.node.worldPosition;let{width:a,height:s}=i.getComponent(l).contentSize;a+=40,s+=40,e.setItemMaskTransform(n.x,n.y,a,s),t.node.setWorldPosition(t.node.worldPosition.x,n.y+s/2+30,0)}async close(){const{guideMasks:e,guideInfoText:t}=this.manager;this.manager.node.scene.emit(Ha.RESUME_TIME),await e.hide(),t.node.active=!1,this.manager.completeGuide(rp),W.off(Yn,this.handleViewResized,this),W.off(Xn,this.handleViewResized,this)}}var Sp,vp,Cp,Ep,Tp,Ap,Rp,Ip,Pp;i._RF.pop(),i._RF.push({},"8ab11Ocp6VMg5ZkRHXv4Odu","GuideHand",void 0);const{ccclass:_p,property:Lp}=a;let Dp=(Sp=_p("GuideHand"),vp=Lp(n),Cp=Lp(n),Ep=Lp(x),Sp((Rp=ve((Ap=class extends s{constructor(){super(...arguments),e(this,"hand",Rp,this),e(this,"circleHighlight",Ip,this),e(this,"circleHighlightOpacity",Pp,this)}start(){this.circleHighlight.setScale(0,0),this.circleHighlightOpacity.opacity=255}playHandAnimation(e,t){this.handTween&&this.handTween.stop();const i=C(this.hand).to(.8,{worldPosition:t},{easing:"quartOut"}).to(.2,{scale:new j(.9,.9,.9),angle:15}).call((()=>{this.playHighlightAnimation()})).to(.2,{scale:j.ONE,angle:0}).to(.8,{worldPosition:e},{easing:"quartOut"}).to(.2,{scale:new j(.9,.9,.9),angle:15}).call((()=>{this.playHighlightAnimation()})).to(.2,{scale:j.ONE,angle:0});this.handTween=C(this.hand).repeatForever(i).start()}playHighlightAnimation(){this.circleHighlight.setScale(0,0),this.circleHighlightOpacity.opacity=255,this.circleHighlight.position=this.hand.position.clone(),C(this.circleHighlight).to(.6,{scale:new j(1.5,1.5)},{easing:"quadOut"}).start(),C(this.circleHighlightOpacity).to(.6,{opacity:0},{easing:"quadIn"}).start()}}).prototype,"hand",[vp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ip=ve(Ap.prototype,"circleHighlight",[Cp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Pp=ve(Ap.prototype,"circleHighlightOpacity",[Ep],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Tp=Ap))||Tp);var Op,Np,Mp,kp,xp,Fp,Bp;i._RF.pop(),i._RF.push({},"b2213ccDllApaGIouur6a6b","GameMask",void 0);const{ccclass:zp,property:Up}=a;let Gp=(Op=zp("GameMask"),Np=Up(l),Mp=Up(R),Op((Fp=ve((xp=class extends s{constructor(){super(...arguments),e(this,"uiTransform",Fp,this),e(this,"sprite",Bp,this)}get texture(){return this.sprite.spriteFrame.texture}}).prototype,"uiTransform",[Np],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Bp=ve(xp.prototype,"sprite",[Mp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),kp=xp))||kp);var Hp,Vp,qp,Wp,Kp,Yp;i._RF.pop(),i._RF.push({},"ad9c7KiarJHXpRRfn9GOaVx","AlphaMasks",void 0);const{ccclass:jp,property:Xp,executeInEditMode:$p}=a;let Jp=(Hp=jp("AlphaMasks"),Vp=$p(!0),qp=Xp(Gp),Hp(Wp=Vp((Yp=ve((Kp=class extends s{constructor(){super(...arguments),e(this,"masks",Yp,this)}onLoad(){this.UITransform=this.node.getComponent(l)}start(){this.material=this.getComponent(R).getMaterialInstance(0)}update(){const{width:e,height:t}=this.UITransform;this.masks.forEach(((i,n)=>{const{width:a,height:s,anchorX:o,anchorY:r}=i.uiTransform,l=a*i.node.scale.x,c=s*i.node.scale.y,h=new J(l/e,c/t),d=new J(.5+(.5-o)*h.x,.5-(.5-r)*h.y),u=new J(d.x+(i.node.worldPosition.x-this.node.worldPosition.x)/e,d.y-(i.node.worldPosition.y-this.node.worldPosition.y)/t);this.material.setProperty(`mask${n}Texture`,i.texture),this.material.setProperty(`ratio${n}`,h),this.material.setProperty(`center${n}`,u)}))}setMaskActive(e,t){e>=this.masks.length||this.material.setProperty(`useMask${e}`,t?1:0)}}).prototype,"masks",[qp],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Wp=Kp))||Wp)||Wp);var Qp,Zp,em,tm,im,nm,am;i._RF.pop(),i._RF.push({},"69569cXv55L852IkWTL0swz","GuideMasks",void 0);const{ccclass:sm,property:om}=a;let rm=(Qp=sm("GuideMasks"),Zp=om(Wn),em=om(Jp),Qp((nm=ve((im=class extends s{constructor(){super(...arguments),e(this,"background",nm,this),e(this,"alphaMasks",am,this)}__preload(){this.validateRequiredComponents()}validateRequiredComponents(){Fe.lazyValidateProperties(this)}async show(){this.background.node.active=!0,await this.background.changeStateFade(!0,.25)}async hide(){await this.background.changeStateFade(!1,.25),this.background.node.active=!1}onClick(){this.node.scene.emit(Ha.GUIDE_MASK_CLICKED)}setOtherMaskTransform(e,t,i,n){this.alphaMasks.masks[1].node.worldPosition=new j(-9999,-9999,0);const a=this.alphaMasks.masks[0];this.setMaskTransform(a,e,t,i,n)}setItemMaskTransform(e,t,i,n){this.alphaMasks.masks[0].node.worldPosition=new j(-9999,-9999,0);const a=this.alphaMasks.masks[1];this.setMaskTransform(a,e,t,i,n)}setMaskTransform(e,t,i,n,a){e.uiTransform.setContentSize(n,a),e.node.setWorldPosition(t,i,0)}}).prototype,"background",[Zp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),am=ve(im.prototype,"alphaMasks",[em],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),tm=im))||tm);var lm,cm,hm,dm,um;i._RF.pop(),i._RF.push({},"abfb9zudJhHdZfeUgbnBrs0","GuideTextBox",void 0);const{ccclass:pm,property:mm}=a;let gm=(lm=pm("GuideTextBox"),cm=mm(h),lm((um=ve((dm=class extends s{constructor(){super(...arguments),e(this,"guideText",um,this)}__preload(){this.opacityToggler=this.getComponent(Wn),Fe.lazyValidateProperties(this)}setText(e){this.guideText.string=e}async show(){await this.opacityToggler.changeStateFade(!0)}async hide(){await this.opacityToggler.changeStateFade(!1)}}).prototype,"guideText",[cm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),hm=dm))||hm);var ym,bm,fm,wm,Sm,vm,Cm,Em,Tm,Am,Rm,Im,Pm;i._RF.pop(),i._RF.push({},"4d800jyvxFJIYnkeNGud6KJ","GuidelinesManager",void 0);const{player:_m,analytics:Lm}=game,{ccclass:Dm,property:Om}=a,{Plugins:{Analytics:{Events:Nm}},Utils:{Array:Mm}}=GameCore,km=new J(0,10),xm=new J(0,10),Fm="READY",Bm="RUNNING";let zm=(ym=Dm("GuidelinesManager"),bm=Om(Dp),fm=Om(gm),wm=Om(h),Sm=Om(rm),vm=Om(n),ym((Tm=ve((Em=class extends s{constructor(){super(...arguments),e(this,"guideHand",Tm,this),e(this,"guideTextBox",Am,this),e(this,"guideInfoText",Rm,this),e(this,"guideMasks",Im,this),e(this,"guideSkipButton",Pm,this),this.guideHintDelay=null,this.guideStormDelay=null}init(e){this.gameplay=e,this.status=Fm,this.node.scene.on(Ha.COMBO_UPDATED,this.startComboGuide,this),this.node.scene.on(Ha.TILE_CLICK,this.startAutoGuides,this),this.node.scene.on(Ha.USE_ITEM,this.handleUseItem,this),this.node.scene.on(Ha.GAME_FINISH,this.stopAutoGuides,this),this.node.scene.on(Ha.GAME_REPLAY,this.stopAutoGuides,this),this.node.scene.on(Ha.GAME_PAUSE,this.stopAutoGuides,this)}show(){this.isNewbieGuideLevel()?(this.hasGuideItemShowed(tp)&&this.resetGuideItemShowed(),this.startGuide(tp)):this.startGuide(ip)}startGuide(e){if(this.status===Bm)return!1;if(this.hasGuideItemShowed(e))return!1;switch(this.addGuideItemShowed(e),this.status=Bm,e){case tp:Lm.event(Nm.TUTORIAL_BEGIN),this.guide1=new cp(this),this.guide1.setup();break;case ip:this.guide2=new hp(this),this.guide2.setup();break;case np:this.guide3=new dp(this),this.guide3.setup();break;case ap:this.guide4=new pp(this),this.guide4.setup();break;case sp:this.guide5=new gp(this),this.guide5.setup();break;case op:this.guide6=new bp(this),this.guide6.setup();break;case rp:this.guide7=new wp(this),this.guide7.setup()}return!0}completeGuide(e){Lm.event(Nm.TUTORIAL_STEP,{step:e}),this.status=Fm,this.addGuideItemShowed(e),this.gameplay.stateManager.isPlaying()&&this.startAutoGuides()}isHintGuideLevel(){return this.getCurrentLevel()>=km.x&&this.getCurrentLevel()<=km.y}isShowErrorPathLevel(){return this.getCurrentLevel()>=xm.x&&this.getCurrentLevel()<=xm.y}isNewbieGuideLevel(){return 0===this.getCurrentLevel()}hasGuideItemShowed(e){return Mm.has(this.getGuideItemShowed(),e)}addGuideItemShowed(e){if(this.hasGuideItemShowed(e))return;const t=this.getGuideItemShowed();t.push(e),_m.setGameData({guideItemShowed:t})}resetGuideItemShowed(){_m.setGameData({guideItemShowed:[]})}getGuideItemShowed(){return _m.getGameData()?.guideItemShowed??[]}getCurrentLevel(){return this.gameplay.levelManager.getLevelData().level}startComboGuide(e){this.isNewbieGuideLevel()||e<2||(this.startGuide(np),this.node.scene.off(Ha.COMBO_UPDATED,this.startComboGuide,this))}startAutoGuides(){this.startHintGuide(),this.startStormGuide()}stopAutoGuides(){null!==this.guideHintDelay&&this.guideHintDelay.stop(),null!==this.guideStormDelay&&this.guideStormDelay.stop()}startHintGuide(){this.isHintGuideLevel()&&(null===this.guideHintDelay&&(this.guideHintDelay=new re(this.node).delay(5).call((()=>{this.isNewbieGuideLevel()||(this.hasGuideItemShowed(ap)&&this.status===Fm?this.node.scene.emit(Ha.SHOW_HINT):this.startGuide(ap),this.startHintGuide())}))),this.guideHintDelay.stop(),this.guideHintDelay.start())}startStormGuide(){null===this.guideStormDelay&&(this.guideStormDelay=new re(this.node).delay(10).call((()=>{if(this.isNewbieGuideLevel())return;if(this.hasGuideItemShowed(op))return;const e=Mm.search(this.gameplay.itemManager.items,(e=>e.itemType===br.STORM));e&&e.canActivate()&&(this.startGuide(op)||this.startStormGuide())}))),this.guideStormDelay.stop(),this.guideStormDelay.start()}startThunderGuide(){return!this.isNewbieGuideLevel()&&this.startGuide(sp)}startPliersGuide(){return!this.isNewbieGuideLevel()&&this.startGuide(rp)}handleUseItem(e){switch(this.startAutoGuides(),e){case br.HINT:this.addGuideItemShowed(ap);break;case br.THUNDER:this.addGuideItemShowed(sp);break;case br.STORM:this.addGuideItemShowed(op);break;case br.PLIERS:this.addGuideItemShowed(rp)}}async skipNewbieGuide(){this.guideSkipButton.active=!1,await this.guide1.close();const e=this.getCurrentLevel()+1;_m.setGameData({level:e}),this.node.scene.emit(Ha.NEXT_LEVEL)}}).prototype,"guideHand",[bm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Am=ve(Em.prototype,"guideTextBox",[fm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Rm=ve(Em.prototype,"guideInfoText",[wm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Im=ve(Em.prototype,"guideMasks",[Sm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Pm=ve(Em.prototype,"guideSkipButton",[vm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Cm=Em))||Cm);var Um,Gm,Hm,Vm,qm,Wm,Km,Ym,jm,Xm,$m,Jm,Qm,Zm,eg,tg,ig,ng,ag;i._RF.pop(),i._RF.push({},"c3d9fl9+INO3ac7Q2zvmRKy","SpecialItem",void 0);const{ccclass:sg,property:og}=a;let rg=(Um=sg("SpecialItem"),Gm=og({editorOnly:!0,tooltip:"A debug button has infinite quantity"}),Hm=og({type:p,tooltip:"The button that activates the item"}),Vm=og({type:f,group:"Quantity",tooltip:"The starting quantity of the item",displayName:"Quantity"}),qm=og({type:h,group:"Quantity",tooltip:"The label that shows the quantity",displayName:"Label"}),Wm=og({type:n,group:"Quantity",tooltip:"The node that shows the quantity of the item",displayName:"Quantity node"}),Km=og({type:n,group:"Quantity",tooltip:"The node that shows the plus icon when there is no item",displayName:"Plus node"}),Ym=og({type:x,group:"Animation"}),jm=og({type:x,tooltip:"The opacity component of the button",displayName:"Button UI Opacity"}),Um((Jm=ve(($m=class extends s{constructor(){super(...arguments),e(this,"isDevButton",Jm,this),e(this,"button",Qm,this),e(this,"quantity",Zm,this),e(this,"quantityLabel",eg,this),e(this,"quantityNode",tg,this),e(this,"plusNode",ig,this),e(this,"glowUIOpacity",ng,this),e(this,"uiOpacity",ag,this),this.requestItem=null,this.loadQuantity=null}get itemType(){}onLoad(){this.validateRequiredComponents()}init(e){this.node.scene.on(Ha.GRID_CREATE,this.applyActivationStatus,this),this.node.scene.on(Ha.GRID_MATCH,this.applyActivationStatus,this),this.node.scene.on(Ha.GRID_CLEAR,this.applyActivationStatus,this),this.node.scene.on(Ha.IDLE_EXIT,(()=>{this.button.interactable=!1,this.applyActivationStatus()})),this.node.scene.on(Ha.IDLE_ENTER,(()=>{this.button.interactable=!0,this.applyActivationStatus()}))}start(){const e=this.loadQuantity();this.setQuantity(e)}validateRequiredComponents(){Fe.lazyValidateProperties(this)}async applyActivationStatus(){const e=this.canActivate();this.button.interactable=e,await vt.runTweenAsync(C(this.uiOpacity).to(.2,{opacity:e?255:128}))}async activate(){this.quantity<=0?this.requestItem():(this.vibrate(),this.setQuantity(this.quantity-1))}canActivate(){return!1}setQuantity(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.isDevButton)return this.quantityLabel.string="i",this.quantityNode.active=!0,this.plusNode.active=!1,void this.applyActivationStatus();e<0&&(e=0),this.quantity=e,this.quantityLabel.string=`${this.quantity}`,e<=0?(this.quantityNode.active=!1,this.plusNode.active=!0):(this.quantityNode.active=!0,this.plusNode.active=!1),t&&this.animateAddItem(),this.applyActivationStatus(),this.saveQuantity()}getQuantity(){return this.quantity}saveQuantity(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.getQuantity(),t=arguments.length>1?arguments[1]:void 0;this.isDevButton||t&&this.setQuantity(e,t.animate)}vibrate(){P("Vibrate")?.getComponent(gr)?.vibrate(50)}async animateAddItem(){return this.glowUIOpacity.opacity=0,Promise.all([vt.runTweenAsync(C(this.node).to(.1,{scale:new j(1.15,1.15,1.15)},{easing:"cubicOut"}).delay(.2).to(.7,{scale:j.ONE},{easing:"elasticOut"})),vt.runTweenAsync(C(this.glowUIOpacity).to(.1,{opacity:100}).delay(.2).to(.6,{opacity:0}))])}}).prototype,"isDevButton",[Gm],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Qm=ve($m.prototype,"button",[Hm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Zm=ve($m.prototype,"quantity",[Vm],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),eg=ve($m.prototype,"quantityLabel",[qm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),tg=ve($m.prototype,"quantityNode",[Wm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ig=ve($m.prototype,"plusNode",[Km],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ng=ve($m.prototype,"glowUIOpacity",[Ym],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ag=ve($m.prototype,"uiOpacity",[jm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Xm=$m))||Xm);var lg;i._RF.pop(),i._RF.push({},"e1fd9AcoshNdK0i6vow/F2P","ItemManager",void 0);const{ccclass:cg}=a;let hg=cg("ItemManager")(lg=class extends s{constructor(){super(...arguments),this.sceneItems=new Set}get items(){return[...this.sceneItems]}onLoad(){this.syncItems()}syncItems(){const e=P("Canvas/UI");if(!e)return;e.getComponentsInChildren(rg).forEach((e=>{e.node.activeInHierarchy&&this.sceneItems.add(e)}))}})||lg;var dg;i._RF.pop(),i._RF.push({},"bbe87JDGgVEkJdgCL2ydwxX","LevelManager",void 0);const{ccclass:ug}=a,{Utils:{Device:pg,String:mg}}=GameCore,gg={level:1,mode:"normal",time:900,colors:12,specials:{bomb:0,rocket:0},rules:{maxSpaceOfPair:1,addRandomTilesPerMove:0},columns:5,rows:6,theme:["flower"]};let yg=ug("LevelManager")(dg=class extends s{async loadLevel(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Zr;const i=await this.loadLevelData(e);this.levelData=i||this.levelData||gg;const{rows:n,columns:a}=this.levelData;pg.isMobile()&&a>=6&&n>=10&&(this.levelData.columns=5,this.levelData.rows=10);const s=`${ri.TILE_SKIN_FOLDER}/${t}`;return await hi.loadSpriteFramesDirAsync(s)}async loadLevelData(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;const t=this.paddingZero(`${Math.floor(e/10)+1}`,3),i=e%10,n=await hi.loadJsonAsync(`${ri.LEVEL_DATA_FOLDER}/${t}`);return n?n[i]:null}getLevelData(){return this.levelData}paddingZero(e,t){let i="";for(let n=0;n<t-e.length;n++)i+="0";return i+e}})||dg;var bg;i._RF.pop(),i._RF.push({},"3f8fenpEyBKaaNxBYL5960v","ScoreManager",void 0);const{ccclass:fg}=a,{Match:{Modes:wg}}=GameCore;let Sg=fg("ScoreManager")(bg=class extends s{constructor(){super(...arguments),this.currentScore=0,this.tournamentStartScore=0}addScore(e,t,i){const n=this.getLevelMultiplier(t),a=this.getComboMultiplier(i),s=Math.floor(this.currentScore+e*n*a),o=10*Math.ceil(s/10);this.setScore(o)}init(){this.initCurrentScore(),this.updateScore()}initCurrentScore(){const e=Sl.getMatchMode();this.currentScore=e===wg.TOURNAMENT?this.tournamentStartScore:0}setScore(e){this.currentScore=e,this.updateScore()}updateTournamentStartScore(){this.tournamentStartScore=this.currentScore}async updateScore(){this.node.scene.emit(Ha.SCORE_UPDATED,this.currentScore)}getCurrentScore(){return this.currentScore}getLevelMultiplier(e){return 1+.1*(e-1)}getComboMultiplier(e){return 1+.1*(e-1)}})||bg;i._RF.pop(),i._RF.push({},"4a4bfX6KIJCcIozlNHuAwoi","AdsUtils",void 0);const{Configs:vg,Plugins:{Ads:{Types:Cg,Status:Eg}},Utils:{Array:Tg}}=GameCore,{ads:Ag}=globalThis.game;class Rg{static get inst(){return this._instance||(this._instance=new Rg),this._instance}static async preloadAds(){const{Enabled:e,InterstitialAdOptions:t,RewardedVideoAdOptions:i}=vg.Ads;if(!e)return;const{INTERSTITIAL:n,REWARDED_VIDEO:a}=Cg;t.forEach((e=>{const{PlacementId:t}=e;Ag.loadAdAsync(n,t).catch((()=>{}))})),i.forEach((e=>{const{PlacementId:t}=e;Ag.loadAdAsync(a,t).catch((()=>{}))}))}static showBannerAds(){const{Enabled:e,BannerDisplayAdOptions:t}=vg.Ads;if(!e)return;const i=le.instance.getVisibleSize(),n=$i.worldSizeToCssSize(i.height*yr);t.forEach((e=>{let{PlacementId:t,Position:i,BannerHeight:a}=e;"bottom"===i&&a>n||Ag.showBannerAdAsync(t).catch((e=>{}))}))}static hideBannerAds(){const{Enabled:e,BannerDisplayAdOptions:t}=vg.Ads;e&&t.forEach((e=>{let{PlacementId:t}=e;Ag.hideBannerAdAsync(t).catch((e=>{}))}))}static async showInterstitialAdAsync(e){const{forLevel:t=1,includeSDK:i,excludeSDK:n}=e;if(!this.inst.canbeShowInSDK(i,n))return!1;if(vg.Gameplay.StartAdAtLevel>=t)return!1;if(!Ag.canbeShowInterstitialAd())return!1;const a=Date.now();try{Xi.muteAudio(!0),Wl.showLoadingNotificationScreen();return Ag.getAdStatus(Cg.INTERSTITIAL)!==Eg.FILLED&&await Ag.loadAdAsync(Cg.INTERSTITIAL),await Ag.showAdAsync(Cg.INTERSTITIAL),!0}catch(e){return console.warn("showInterstitialAdAsync failed",e),!1}finally{Xi.muteAudio(!1);const e=(Date.now()-a)/1e3;setTimeout((()=>{Wl.closeNotificationScreen()}),e>.5?0:.5),Ag.loadAdAsync(Cg.INTERSTITIAL).catch((()=>{}))}}static async showRewardVideoAdAsync(e){const{includeSDK:t,excludeSDK:i}=e;if(!this.inst.canbeShowInSDK(t,i))return!1;try{Xi.muteAudio(!0),Wl.showLoadingNotificationScreen();return Ag.getAdStatus(Cg.REWARDED_VIDEO)!==Eg.FILLED&&await Ag.loadAdAsync(Cg.REWARDED_VIDEO),await Ag.showAdAsync(Cg.REWARDED_VIDEO),Wl.closeNotificationScreen(),!0}catch(e){if(console.warn("showRewardVideoAdAsync failed",e),e instanceof Object&&"code"in e&&"USER_INPUT"===e.code){const e="Sorry, no rewards!\n You have cancelled the ad.";Wl.showNotificationScreen(e,2)}else Wl.showNotificationScreen("No ads to display.",2);return!1}finally{Xi.muteAudio(!1),Ag.loadAdAsync(Cg.REWARDED_VIDEO).catch((()=>{}))}}canbeShowInSDK(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];const i=GameSDK.getSDKName();return(!t?.length||!Tg.has(t,i))&&!(e?.length&&!Tg.has(e,i))}}try{new Rg}catch(e){console.error("AdsUtils",e)}i._RF.pop(),i._RF.push({},"e6116mseMNPD6VcLUtkvez6","BaseState",void 0);class Ig{constructor(e){this.game=null,this.data={},this.game=e.getGameplay(),this.manager=e,this.updateStateData(),this.logDebug()}logDebug(){const e=this.constructor.name;console.info(`[STATE] ${e}`,this.data)}updateStateData(){if(!this.game)return;const e=this.game.getGameData();e&&(this.data=e)}updateGameData(e){this.game?.setGameData(e)}}i._RF.pop(),i._RF.push({},"e4ee7Ho9zJPVKobpdsCwGlp","FailState",void 0);const{analytics:Pg,monitorError:_g,match:Lg,player:Dg,storage:Og}=globalThis.game,{Match:{Modes:Ng},Dtos:{Match:{Data:Mg}}}=GameCore;class kg extends Ig{constructor(e,t){super(e),Xi.stopAllSounds(),this.vibrateDevice(),this.pauseCountdown(),this.updateMatchCustomData(),this.handleGameOver(t),this.logLevelFailAnalytics()}pauseCountdown(){this.game?.uiManager.pauseTime()}vibrateDevice(){P("Vibrate")?.getComponent(gr)?.vibrate(500)}async handleGameOver(e){const t=Sl.getMatchMode();if(hi.setBlockInput(!0),t===Ng.SINGLE)return await this.handleTournamentCreateFlow(),void this.showFailScreen(e);if(t===Ng.TOURNAMENT)await this.handleTournamentGameOver();else{if(t!==Ng.CHALLENGE_FRIEND)return void this.showFailScreen(e);await this.handleChallengeGameOver()}hi.setBlockInput(!1)}async handleTournamentCreateFlow(){try{await Sl.processCreateTournamentAsync()}catch(e){if(e instanceof $r)return;return e instanceof Xr&&_g?.sendException(e),void console.error(e)}}async handleTournamentGameOver(){const e=Sl.getMatchCustomData()?.tournamentId;if(!e)return;if(Ql.validateTournamentExpired(e)){Og.setStorageData("tournament","animateTournamentLeader",!1);const e=2;return Wl.showNotificationScreen("Tournament has ended",e),void this.game?.scheduleOnce((()=>{this.game?.node.scene.emit(Ha.GAME_EXIT)}),e)}try{await Sl.finishMatchAsync();const{profiles:e}=Lg.getMatchState(),t=Og.getStorageData("tournament","previousScore")??0;(e[Dg.getPlayerId()].score??0)>t&&Og.setStorageData("tournament","animateTournamentLeader",!0)}catch(e){console.warn(e)}this.game?.node.scene.emit(Ha.GAME_EXIT)}async handleChallengeGameOver(){try{const{id:e}=Lg.getMatchState(),t=await Lg.api.getMatchAPI().getMatchDetailByIdAsync(e),i=new Mg(t).toObject().extraData;await Sl.finishMatchAsync({extraData:i??void 0})}catch(e){console.warn(e)}this.game.node.scene.emit(Ha.SHOW_CHALLENGE_RESULTS)}async showFailScreen(e){const{level:t}=this.data;this.game&&await Rg.showInterstitialAdAsync({forLevel:t}),Xi.turnOffMusic(),e===Zl&&Xi.playSound(Bi.LEVEL_FAIL_TIMEOUT),Xi.playSound(Bi.LEVEL_FAIL),Wl.openScreen(Hi.RESCUES_SCREEN,{level:t,failKey:e})}updateMatchCustomData(){const{level:e=1}=this.data,t=this.game?.scoreManager.getCurrentScore()??0;Sl.updateMatchStateAfterLevelFinish(e,t)}logLevelFailAnalytics(){if(!this.game)return;const{level:e=0}=this.data,t=this.game.scoreManager.getCurrentScore();Pg.levelFail(e,t)}initialize(){const e=this.manager.createInitializeState(this.manager);this.manager.change(e)}ready(){}playing(){const e=this.manager.createPlayingState(this.manager);this.manager.change(e)}fail(){}finish(){const e=this.manager.createFinishState(this.manager);this.manager.change(e)}update(){}}i._RF.pop(),i._RF.push({},"a9bc11SkV9L/5L+Y+fhswfJ","FinishState",void 0);const{analytics:xg,player:Fg,leaderboard:Bg,match:zg,monitorError:Ug}=globalThis.game,{Match:{Modes:Gg}}=GameCore;class Hg extends Ig{constructor(e){super(e),this.handleFinishStateFlow()}async handleFinishStateFlow(){this.processCrazyGamesEvent(),this.attemptCallCreateShortcut(),Xi.turnUpMusic(),this.game?.uiManager.pauseTime();const e=Sl.getMatchMode();e!==Gg.CHALLENGE_FRIEND&&this.updatePlayerProgress(),this.updateMatchCustomData(),this.handlePostScoreToLeaderboard(),e===Gg.CHALLENGE_FRIEND?this.handleChallengeOver():(await this.handleTournamentCreateFlow(),this.showLevelCompleteScreen()),this.logLevelCompleteAnalytics()}async handleChallengeOver(){try{const{id:e}=zg.getMatchState(),t=await Sl.getMatchExtraDataAsync(e);await Sl.finishMatchAsync({extraData:t??void 0})}catch(e){console.warn(e),await Sl.finishMatchAsync()}this.game.node.scene.emit(Ha.SHOW_CHALLENGE_RESULTS)}processCrazyGamesEvent(){"gameplayStop"in GameSDK.extra&&GameSDK.extra.gameplayStop()}updateMatchCustomData(){const{level:e=1}=this.data,t=this.game?.scoreManager.getCurrentScore()??0;Sl.updateMatchStateAfterLevelFinish(e,t)}logLevelCompleteAnalytics(){if(!this.game)return;const{level:e=0}=this.data,t=this.game.scoreManager.getCurrentScore();xg.levelComplete(e,t)}async showLevelCompleteScreen(){const{level:e}=this.data;Xi.turnOffMusic(),Xi.playSound(Bi.LEVEL_COMPLETE);const t=Fg.getGameData()?.coins??0;Wl.openScreen(Hi.LEVEL_COMPLETE_SCREEN,{level:e,currentCoin:t})}updatePlayerProgress(){if(!this.game)return;const{level:e}=this.data;if(!e)return;const t=e+1,i=Fg.getGameData();if(!i)return;const n=i.totalLevel,a=i.level,s=Math.max(a,t),o={...i};s<n&&(o.level=s),Fg.setGameData(o)}attemptCallCreateShortcut(){const{level:e=0}=this.data;e<2||"checkAndCreateShortcutAsync"in GameSDK.extra&&GameSDK.extra.checkAndCreateShortcutAsync().catch((e=>{console.warn("createShortcutAsync",e)}))}async handleTournamentCreateFlow(){if(Sl.getMatchMode()!==Gg.SINGLE)return;const e=Fg.getGameData();if(!e)return;const{lastCreateTournamentShown:t=0}=e;if(Date.now()-t>3e5)try{await Sl.processCreateTournamentAsync()}catch(e){if(e instanceof $r)return;return e instanceof Xr&&Ug?.sendException(e),void console.error(e)}}async handlePostScoreToLeaderboard(){if(Sl.getMatchMode()!==Gg.TOURNAMENT)return;const e=this.game?.scoreManager.getCurrentScore();if(!e)return;try{await GameSDK.tournament.postScoreAsync(e)}catch(e){console.warn("GameSDK post score async",e)}const t=Sl.getMatchCustomData();if(!t)return;const{leaderboardId:i,playerId:n}=t;i&&n&&await Bg.setLeaderboardScoreAsync(i,n,e)}initialize(){const e=this.manager.createInitializeState(this.manager);this.manager.change(e)}ready(){}playing(){}fail(){}finish(){}update(){}}i._RF.pop(),i._RF.push({},"37a5cRy3ANBGpVlH3wyS3Ra","InitializeState",void 0);const{player:Vg,match:qg}=globalThis.game,{Match:{Modes:Wg}}=GameCore;class Kg extends Ig{constructor(e){super(e),this.handleSingleGameStart=async e=>{const t=this.game.levelManager.getLevelData(),i=this.data.level,n=Vg.getPlayerId();await Promise.all([Sl.setMatchCustomDataAsync({level:i,score:0}),Sl.setProfileMatchDataAsync({id:n,score:0})]),this.game.board.create(e,t),this.game.board.setIgnoreInput(!0),await this.game.board.animateTilesAppear(),this.game.guidelinesManager?.isNewbieGuideLevel()||this.game.board.setIgnoreInput(!1),this.ready()},this.enableUI(),this.clearBoard(),this.loadLevel(),this.initCountdown(),this.initScore()}enableUI(){this.game?.uiManager.enableHeader()}clearBoard(){this.game&&(this.game.rescueTiles=[],this.game.board.destroyTiles(),this.game.pathDraw.clearMatchPath())}async loadLevel(){if(!this.game)return;const e=Sl.getMatchMode();try{if(e===Wg.CHALLENGE_FRIEND){const{id:e}=qg.getMatchState(),t=await Sl.getMatchExtraDataAsync(e);if(null==t)throw new Error(`Match mode ${Wg.CHALLENGE_FRIEND} but no extraData (for opponent initialization) was found in match data.`);const i=this.getLevelSkin(t.level),n=await this.game.levelManager.loadLevel(t.level,i);this.updateGameData({level:t.level,levelData:this.game.levelManager.getLevelData()}),Xi.playSound(Bi.LEVEL_START),this.handleChallengeFriendGameStart(n,t)}else{const e=this.getLevelSkin(this.data.level),t=await this.game.levelManager.loadLevel(this.data.level,e);this.updateGameData({levelData:this.game.levelManager.getLevelData()}),Xi.playSound(Bi.LEVEL_START),this.handleSingleGameStart(t)}}catch(e){console.error("Error loading level:",e);const t=this.getLevelSkin(this.data.level),i=await this.game.levelManager.loadLevel(this.data.level,t);this.updateGameData({levelData:this.game.levelManager.getLevelData()}),Xi.playSound(Bi.LEVEL_START),this.handleSingleGameStart(i)}}getLevelSkin(e){const t=ll.getLevelSkin(e),i=ll.getUnlockedSkins();if(i.length<=1)return t;if(z.random()<=.5)return t;const n=i.indexOf(t);return i.splice(n,1),i[z.randomRangeInt(0,i.length)]}async handleChallengeFriendGameStart(e,t){const i=this.game.levelManager.getLevelData(),{level:n,fen:a,gravity:s,rules:o,time:r}=t,l=Vg.getPlayerId();await Promise.all([Sl.setMatchCustomDataAsync({level:n,score:0}),Sl.setProfileMatchDataAsync({id:l,score:0})]),this.game.board.create(e,{...i,level:n,customFen:a,mode:s,rules:o,time:r}),this.game.board.setIgnoreInput(!0),await this.game.board.animateTilesAppear(),this.game.board.setIgnoreInput(!1),this.ready()}initScore(){this.game&&this.game.scoreManager.init()}initCountdown(){this.game&&this.game.uiManager.initCountdown()}initialize(){}ready(){const e=this.manager.createReadyState(this.manager);this.manager.change(e)}pause(){}playing(){}fail(){}finish(){}update(){}}i._RF.pop(),i._RF.push({},"e3b372NaI5HvY5HnTleBQKd","PlayingState",void 0);class Yg extends Ig{constructor(e){super(e),this.startCountdown()}startCountdown(){this.game?.uiManager.startCountdown()}initialize(){const e=this.manager.createInitializeState(this.manager);this.manager.change(e)}ready(){const e=this.manager.createReadyState(this.manager);this.manager.change(e)}playing(){}fail(e){const t=this.manager.createFailState(this.manager,e);this.manager.change(t)}finish(){const e=this.manager.createFinishState(this.manager);this.manager.change(e)}update(){this.updateStateData()}}i._RF.pop(),i._RF.push({},"5ef69tJ5eNNv7o22H/XfSD2","ReadyState",void 0);const{analytics:jg,match:Xg}=globalThis.game,{Utils:{Valid:$g}}=GameCore;class Jg extends Ig{constructor(e){super(e),Xi.stopAllSounds(),Xi.turnDownMusic(),this.handleGuideFlow(),this.setLevelText(),this.setLevelTime(),this.setGridPlayable(),this.logLevelStartAnalytics()}initialize(){const e=this.manager.createInitializeState(this.manager);this.manager.change(e)}ready(){}playing(){const e=this.manager.createPlayingState(this.manager);this.manager.change(e)}fail(e){if(!$g.isDebugger())return;const t=this.manager.createFailState(this.manager);this.manager.change(t)}finish(){if(!$g.isDebugger())return;const e=this.manager.createFinishState(this.manager);this.manager.change(e)}update(){}setGridPlayable(){this.manager.getGameplay().guidelinesManager?.isNewbieGuideLevel()||this.manager.getGameplay().board.setIgnoreInput(!1)}handleGuideFlow(){this.game.guidelinesManager?.isNewbieGuideLevel()||this.game.handleShowUI(),this.game.guidelinesManager?.show()}setLevelTime(){if(!this.game)return;const{levelData:e}=this.data;e&&this.game.uiManager.setCountdownTime(e.time)}setLevelText(){if(!this.game)return;const{level:e=0}=this.data;this.game.uiManager.setLevelText(e)}logLevelStartAnalytics(){if(!this.game)return;const{level:e=0}=this.data,t=Xg.getMatchState(),{score:i=0}=t.customData;jg.levelStart(e,i)}}var Qg;i._RF.pop(),i._RF.push({},"bb0e3beWSxOOLCv7gjyg2s0","StateManager",void 0);const{ccclass:Zg}=a;let ey=Zg("StateManager")(Qg=class extends s{getGameplay(){return this.gameplay}init(e){this.gameplay=e,this.state=new Kg(this)}change(e){this.state=e}initialize(){this.state.initialize()}isInitialize(){return this.state instanceof Kg}ready(){this.state.ready()}isReady(){return this.state instanceof Jg}playing(){this.state.playing()}isPlaying(){return this.state instanceof Yg}fail(e){this.state.fail(e)}isFail(){return this.state instanceof kg}finish(){this.state.finish()}isFinished(){return this.state instanceof Hg}update(e){this.state&&this.state.update(e)}createInitializeState(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return new Kg(...t)}createReadyState(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return new Jg(...t)}createPlayingState(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return new Yg(...t)}createFailState(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return new kg(...t)}createFinishState(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return new Hg(...t)}})||Qg;var ty,iy,ny,ay,sy;i._RF.pop(),i._RF.push({},"659a5DHz/dCjaYaS9/4ZunE","Digit",void 0);const{ccclass:oy,property:ry}=a;let ly=(ty=oy("Digit"),iy=ry(h),ty((sy=ve((ay=class extends s{constructor(){super(...arguments),e(this,"numberLabels",sy,this),this.labelUITransforms=[],this.labelUIOpacitys=[],this.previousNumber=0}onLoad(){this.uiTransform=this.getComponent(l),this.labelUITransforms=this.numberLabels.map((e=>e.getComponent(l))),this.labelUIOpacitys=this.numberLabels.map((e=>e.getComponent(x))),Fe.lazyValidateProperties(this)}setNumber(e){this.previousNumber!==e&&(this.labelUIOpacitys[this.previousNumber].opacity=0,this.numberLabels[e].node.active||(this.numberLabels[e].node.active=!0),this.labelUIOpacitys[e].opacity=255,this.uiTransform.setContentSize(this.labelUITransforms[e].contentSize),this.previousNumber=e)}}).prototype,"numberLabels",[iy],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),ny=ay))||ny);var cy,hy,dy,uy,py,my,gy;i._RF.pop(),i._RF.push({},"9e40aEq56tMKLFoeACyl+eH","Clock",void 0);const{ccclass:yy,disallowMultiple:by,property:fy}=a;let wy=(cy=yy("Clock"),hy=fy(n),dy=fy(ly),cy(uy=by((my=ve((py=class extends s{constructor(){super(...arguments),e(this,"clockIcon",my,this),e(this,"digits",gy,this),this.time=0,this.remaining=0,this.running=!1,this.halfTime=!1,this.handleUpdateConfig=e=>{this.enabled&&console.log("Clock: handleUpdateConfig",e)},this.refillTime=()=>{const e=Date.now(),t=C(this.node).to(.5,{scale:new j(1.1,1.1,1)}),i=C(this.node).to(.5,{scale:new j(1,1,1)}),n=C(this.clockIcon).to(.15,{angle:-15},{easing:"cubicOut"}).to(.15,{angle:0},{easing:"cubicIn"}).to(.15,{angle:15},{easing:"cubicOut"}).to(.15,{angle:0},{easing:"cubicIn"}),a=C(this.clockIcon).repeat(5,n),s=C(this.node).to(3,{position:new j(0,0,0)},{onUpdate:()=>{const t=Date.now(),i=(t-e)/3e3>1?1:(t-e)/3e3,n=z.lerp(0,120,i);this.setTime(n)}}).call((()=>{this.setTime(120),i.start(),this.node.scene.emit(Ha.RESCUE_FINISHED)}));C(this.node).parallel(t,s).start(),a.start()}}__preload(){this.listenEvents()}start(){this.init()}init(){this.running=!1,this.halfTime=!1}listenEvents(){this.node.scene.on($n,this.handleUpdateConfig),this.node.scene.on(Ha.RESCUE_START,this.refillTime)}setTime(e){this.time=e,this.updateTimeLabel(e),this.remaining=e}startCountdown(){this.running=!0,this.remaining=this.time}pause(){this.running=!1}resume(){this.running=!0}endCountDown(){this.running=!1,this.remaining=0,this.node.scene.emit(Ha.TIME_OUT)}update(e){this.running&&(this.remaining<=0?this.endCountDown():(this.remaining-=e,!this.halfTime&&this.remaining<=this.time/2&&(this.halfTime=!0,this.node.scene.emit(Ha.HALF_TIME)),this.remaining>=0&&this.updateTimeLabel(this.remaining)))}updateTimeLabel(e){const t=this.convertSecondsToMmSs(e);for(let e=0;e<t.length;e++)this.digits[e].setNumber(parseInt(t[e]))}convertSecondsToMmSs(e){const t=Math.floor(e/60),i=Math.floor(e%60);return`${this.padZero(t)}${this.padZero(i)}`}padZero(e){return e<10?`0${e}`:`${e}`}}).prototype,"clockIcon",[hy],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),gy=ve(py.prototype,"digits",[dy],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),uy=py))||uy)||uy);var Sy;i._RF.pop(),i._RF.push({},"ed00dMDxYRJP4fZMawN9JnW","ComboProgressBar",void 0);const{ccclass:vy}=a;let Cy=vy("ComboProgressBar")(Sy=class extends s{start(){this.progressBar=this.getComponent(Hs),this.opacity=this.getComponent(x),this.comboTimer=0,this.isActive=!1,this.node.scene.on(Ha.COMBO_UPDATED,this.handleComboUpdated,this)}update(e){this.isActive&&(this.comboTimer>0?(this.comboTimer-=e,this.progressBar.progress=this.comboTimer/3):(this.isActive=!1,this.opacity.opacity=0,this.node.scene.emit(Ha.COMBO_ENDED)))}handleComboUpdated(e){0===e?this.opacity.opacity=0:e>0&&(this.isActive=!0,this.comboTimer=3),e>1&&(this.opacity.opacity=255)}pause(){this.isActive=!1}resume(){this.isActive=!0}})||Sy;var Ey,Ty,Ay,Ry,Iy,Py,_y,Ly,Dy;i._RF.pop(),i._RF.push({},"46f05OkhTtGz6xBJuPMZGqH","ScoreBlock",void 0);const{ccclass:Oy,property:Ny}=a,{Utils:{Image:My}}=GameCore;let ky=(Ey=Oy("ScoreBlock"),Ty=Ny(R),Ay=Ny(N),Ry=Ny(h),Ey((_y=ve((Py=class extends s{constructor(){super(...arguments),e(this,"avatar",_y,this),e(this,"defaultAvatar",Ly,this),e(this,"scoreText",Dy,this)}onLoad(){this.validateRequiredComponents()}validateRequiredComponents(){Fe.lazyValidateProperties(this)}async updateInfo(e,t){t?(this.score=t,this.scoreText.string=t.toString()):(this.score=0,this.scoreText.string="0");try{const t=await My.loadImage(e);if(!t)return;const i=N.createWithImage(t);i.packable=!0,this.avatar.spriteFrame=i}catch{this.avatar.spriteFrame=this.defaultAvatar}}async updateScore(e){const t=e-this.score,i=C(this.node).to(.1,{},{onUpdate:(e,i)=>{if(!i)return;const n=Math.floor(t*i)+this.score;this.scoreText.string=n.toString()}});await vt.runTweenAsync(i),this.scoreText.string=e.toString(),this.score=e}}).prototype,"avatar",[Ty],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ly=ve(Py.prototype,"defaultAvatar",[Ay],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Dy=ve(Py.prototype,"scoreText",[Ry],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Iy=Py))||Iy);var xy,Fy,By,zy,Uy,Gy,Hy,Vy,qy,Wy,Ky,Yy,jy,Xy,$y,Jy,Qy;i._RF.pop(),i._RF.push({},"61791zAr2tJR4p22EZ5QRfk","Header",void 0);const{ccclass:Zy,property:eb}=a,{match:tb}=globalThis.game;let ib=(xy=Zy("Header"),Fy=eb(h),By=eb(n),zy=eb(n),Uy=eb(n),Gy=eb(n),Hy=eb(ky),Vy=eb(ky),xy((Ky=ve((Wy=class extends s{constructor(){super(...arguments),e(this,"levelText",Ky,this),e(this,"settingNode",Yy,this),e(this,"homeNode",jy,this),e(this,"leftNode",Xy,this),e(this,"coinNode",$y,this),e(this,"playerScoreBlock",Jy,this),e(this,"opponentScoreBlock",Qy,this),this.challengeScoreBlockShown=!1}onLoad(){this.validateRequiredComponents(),this.listenGameEvents()}listenGameEvents(){this.node.scene.on(Ha.SCORE_UPDATED,this.updateScore,this)}unlistenGameEvents(){this.node.scene.off(Ha.SCORE_UPDATED,this.updateScore,this)}validateRequiredComponents(){Fe.lazyValidateProperties(this)}handleClickedPauseGame(){this.showSettingScreen(),this.node.scene.emit(Ha.GAME_PAUSE)}handleReturnHome(){Wl.openScreen(Hi.QUIT_LEVEL_SCREEN),this.node.scene.emit(Ha.GAME_PAUSE)}highlightCoinContainer(){const e=P("Canvas/Screens");if(!e)return;const t=this.coinNode.worldPosition.clone();this.coinNode.parent=e,this.coinNode.worldPosition=t}removeCoinContainerHighlight(){const e=this.coinNode.worldPosition.clone();this.coinNode.parent=this.leftNode,this.coinNode.worldPosition=e}showSettingScreen(){Wl.openScreen(Hi.SETTINGS_SCREEN,{})}setLevelText(e){this.levelText.string=`Level ${e}`}setButtonsSelectable(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.enableBtnNode(this.settingNode,e,!0),this.enableBtnNode(this.homeNode,e,!0)}showChallengeScoreBlock(){if(this.challengeScoreBlockShown)return;this.challengeScoreBlockShown=!0;const e=tb.getMatchState(),t=e.id,{playerId:i,opponentId:n}=e.customData;if(!t||!i||!n)return;this.playerScoreBlock.node.active=!0,this.opponentScoreBlock.node.active=!0;const a=e.profiles[i],s=e.profiles[n];this.playerScoreBlock.updateInfo(a.photo,a.score),this.opponentScoreBlock.updateInfo(s.photo,s.score)}hideChallengeScoreBlock(){this.challengeScoreBlockShown&&(this.challengeScoreBlockShown=!1,this.playerScoreBlock.node.active=!1,this.opponentScoreBlock.node.active=!1)}enableBtnNode(e,t,i){const n=e.getComponent(p);if(n&&(n.interactable=t),e.active=i,i){e.getComponent(Wn)}}updateScore(e){this.challengeScoreBlockShown&&this.playerScoreBlock.updateScore(e)}onDestroy(){this.unlistenGameEvents()}}).prototype,"levelText",[Fy],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Yy=ve(Wy.prototype,"settingNode",[By],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),jy=ve(Wy.prototype,"homeNode",[zy],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Xy=ve(Wy.prototype,"leftNode",[Uy],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),$y=ve(Wy.prototype,"coinNode",[Gy],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Jy=ve(Wy.prototype,"playerScoreBlock",[Hy],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Qy=ve(Wy.prototype,"opponentScoreBlock",[Vy],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),qy=Wy))||qy);var nb,ab,sb,ob,rb;i._RF.pop(),i._RF.push({},"396015KIPBL3bHTUOHN7pCl","UIMasks",void 0);const{ccclass:lb,property:cb}=a;let hb=(nb=lb("UIMasks"),ab=cb(Wn),nb((rb=ve((ob=class extends s{constructor(){super(...arguments),e(this,"background",rb,this)}__preload(){this.validateRequiredComponents()}validateRequiredComponents(){Fe.lazyValidateProperties(this)}async show(){this.background.node.active=!0,await this.background.changeStateFade(!0,.25)}async hide(){await this.background.changeStateFade(!1,.25),this.background.node.active=!1}}).prototype,"background",[ab],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),sb=ob))||sb);i._RF.pop(),i._RF.push({},"805dbJxaCpKBpzq9ejSgrc8","TileType",void 0);const db="bomb";var ub,pb,mb,gb,yb;i._RF.pop(),i._RF.push({},"151afQBVDpOYpTjtwP+wYH+","DevTools",void 0);const{Dtos:{Player:bb},Utils:{Function:fb}}=GameCore,{ccclass:wb,property:Sb}=a,{player:vb}=globalThis.game;let Cb=(ub=wb("DevToolsContainer"),pb=Sb(n),ub((yb=ve((gb=class extends s{constructor(){super(...arguments),e(this,"devToolsToggle",yb,this),this.isActive=!0,this.game=null,this.debouncedStarsNotification=fb.debounce((()=>{const e=vb.getGameData();e&&Wl.showNotificationScreen(`Stars added. Current stars: ${e.stars}`)}),700)}injectGameplay(e){this.game=e}hideAllButtons(){this.getComponentsInChildren(p).forEach((e=>{const{parent:t}=e.node;t&&t.name!==this.devToolsToggle.name&&(t.active=!1)}))}showAllButtons(){this.getComponentsInChildren(p).forEach((e=>{const{parent:t}=e.node;t&&t.name!==this.devToolsToggle.name&&(t.active=!0)}))}handleClickDevToolsButton(){this.isActive?(this.hideAllButtons(),this.isActive=!1):(this.showAllButtons(),this.isActive=!0)}handleResetData(){vb.setPlayerData(bb.Data.getDefaultData()),Wl.openScreen(Hi.NOTIFICATION_SCREEN,{duration:3,message:"Items and stars will only be reset if you refresh the game page now."}),this.node.scene.emit(Ha.START_OVER)}async handleNextLevel(){const e=(this.game?.getGameData()?.level??1)+1;this.game?.setGameData({level:e-1}),vb.setGameData({level:e}),this.node.scene.emit(Ha.NEXT_LEVEL)}async handlePrevLevel(){const e=Math.max((this.game?.getGameData()?.level??2)-1,1);this.game?.setGameData({level:e-1}),vb.setGameData({level:e}),this.node.scene.emit(Ha.NEXT_LEVEL)}async handleEnterSelectLevel(e){const t=Number(e.string);this.game?.setGameData({level:t-1}),vb.setGameData({level:t}),this.node.scene.emit(Ha.NEXT_LEVEL)}handleClickBuildVersionButton(){const e=globalThis.game.getBuildVersion();Wl.showNotificationScreen(`Build version: ${e}`)}handleClickWinLevelButton(){this.node.scene.emit(Ha.GAME_FINISH)}handleClickTimeOutButton(){this.node.scene.emit(Ha.TIME_OUT)}handleClickExplodeButton(){const e=this.game;if(!e)return;const t=e.getGameData()?.levelData?.specials.bomb;if(!t||t<=0)return;const i=e.board.getBombTiles();if(0===i.length)return void console.info("No bomb tiles found");const n=i[0];if(n.special?.type!==db)throw new Error("Invalid bomb tile");n.special.detonateImmediately()}handleFillItem(){this.node.scene.emit(Ha.ADD_ITEM,{animate:()=>Promise.resolve(),item:br.HINT,quantity:2}),this.node.scene.emit(Ha.ADD_ITEM,{animate:()=>Promise.resolve(),item:br.STORM,quantity:2}),this.node.scene.emit(Ha.ADD_ITEM,{animate:()=>Promise.resolve(),item:br.THUNDER,quantity:2}),this.node.scene.emit(Ha.ADD_ITEM,{animate:()=>Promise.resolve(),item:br.PLIERS,quantity:2})}handleAutoPlay(){this.node.scene.emit(Ha.AUTO_PLAY)}handleAddStars(){const e=vb.getGameData();e&&(vb.setGameData({stars:e.stars+10}),this.debouncedStarsNotification())}handleSwitchBundle(){W.emit(ta)}}).prototype,"devToolsToggle",[pb],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),mb=gb))||mb);var Eb,Tb,Ab,Rb,Ib,Pb,_b,Lb,Db,Ob,Nb,Mb,kb,xb,Fb,Bb,zb,Ub,Gb;i._RF.pop(),i._RF.push({},"a3b0f6zU+1D97PyszsgST1H","UIManager",void 0);const{ccclass:Hb,property:Vb}=a,{Utils:{Valid:qb},Match:{Modes:Wb}}=GameCore,{match:Kb}=globalThis.game;let Yb=(Eb=Hb("UIManager"),Tb=Vb(wy),Ab=Vb(ib),Rb=Vb(Cb),Ib=Vb(Cy),Pb=Vb(n),_b=Vb(hb),Lb=Vb([n]),Db=Vb([n]),Eb((Mb=ve((Nb=class extends s{constructor(){super(...arguments),e(this,"clock",Mb,this),e(this,"header",kb,this),e(this,"devTools",xb,this),e(this,"comboProgressBar",Fb,this),e(this,"comboContainer",Bb,this),e(this,"uiMasks",zb,this),e(this,"topAnimNodes",Ub,this),this.originTopNodesPos=[],e(this,"botAnimNodes",Gb,this),this.originBotNodesPos=[],this.hideBotWorldY=-80,this.entranceSignal=new oi,this.exitSignal=new oi,this.showDevTools=()=>{this.devTools&&(this.devTools.node.active=!0)}}onLoad(){this.validateRequiredComponents(),this.listensDevToolsEvents(),this.listenRescueEvents(),m.once(Q.EVENT_AFTER_UPDATE,(()=>{this.saveOriginPos(),this.initUIPos()}))}validateRequiredComponents(){Fe.lazyValidateProperties(this)}saveOriginPos(){this.topAnimNodes.forEach((e=>{this.originTopNodesPos.push(e.position.clone())})),this.botAnimNodes.forEach((e=>{this.originBotNodesPos.push(e.position.clone())}))}initUIPos(){this.topAnimNodes.forEach(((e,t)=>{const i=this.originTopNodesPos[t].clone();i.y+=200,e.setPosition(i)}));const e=new j(0,this.hideBotWorldY,0);this.botAnimNodes.forEach(((t,i)=>{const n=this.originBotNodesPos[i].clone();e.y=this.hideBotWorldY;const a=t.parent?.inverseTransformPoint(e,e).y??200;n.y=a,t.setPosition(n)}))}listensDevToolsEvents(){this.node.scene.on(Pr.Events.UNLOCK_DEV_TOOLS,this.showDevTools)}listenRescueEvents(){this.node.scene.on(Ha.RESCUE_START,this.showRescueAnimation,this),this.node.scene.on(Ha.RESCUE_FINISHED,this.hideRescueAnimation,this)}initDevTools(e){window.addEventListener("reset-game-data",(()=>{this.devTools?.handleResetData()})),this.devTools&&(this.devTools.node.active=qb.isDebugger(),this.devTools.injectGameplay(e))}setLevelText(e){this.header.setLevelText(e)}initCountdown(){this.clock.init()}setCountdownTime(e){this.clock.setTime(e)}startCountdown(){this.clock.startCountdown()}pauseTime(){this.comboProgressBar.pause(),this.clock.pause()}resumeTime(){this.comboProgressBar.resume(),this.clock.resume()}setComboUI(e){this.comboContainer.getComponent(Wn).changeStateFade(e,.1)}disableHeader(){this.header.setButtonsSelectable(!1)}enableHeader(){this.header.setButtonsSelectable()}updateStatus(){const{mode:e}=Kb.getMatchState();e===Wb.CHALLENGE_FRIEND?this.header.showChallengeScoreBlock():this.header.hideChallengeScoreBlock()}async showRescueAnimation(){await this.uiMasks.show()}async hideRescueAnimation(){await this.uiMasks.hide()}async playExitAnimUI(){this.entranceSignal.abort(),this.exitSignal.abort(),this.exitSignal=new oi;const e=[];this.topAnimNodes.forEach(((t,i)=>{const n=new j(t.position.x,this.originTopNodesPos[i].y+200,0),a=C(t);a.to(.17,{position:n},{easing:"backIn"}),e.push(vt.runTweenAsync(a,this.exitSignal))}));const t=new j(0,this.hideBotWorldY,0);this.botAnimNodes.forEach((i=>{t.y=this.hideBotWorldY;const n=i.parent?.inverseTransformPoint(t,t).y??200,a=new j(i.position.x,n,0),s=C(i);s.to(.17,{position:a},{easing:"backIn"}),e.push(vt.runTweenAsync(s,this.exitSignal))})),await Promise.all(e),this.exitSignal.aborted||(this.header.node.active=!1)}async playEntranceAnimUI(){this.exitSignal.abort(),this.entranceSignal.abort(),this.entranceSignal=new oi,this.header.node.active=!0;const e=[];this.topAnimNodes.forEach(((t,i)=>{const n=new j(t.position.x,this.originTopNodesPos[i].y,0),a=C(t);a.to(.2,{position:n},{easing:"backOut"}),e.push(vt.runTweenAsync(a,this.entranceSignal))})),this.botAnimNodes.forEach(((t,i)=>{const n=new j(t.position.x,this.originBotNodesPos[i].y,0),a=C(t);a.to(.2,{position:n},{easing:"backOut"}),e.push(vt.runTweenAsync(a,this.entranceSignal))})),await Promise.all(e)}highlightCoinContainer(){this.header.highlightCoinContainer()}unHighlightCoinContainer(){this.header.removeCoinContainerHighlight()}setInteractableItemButtons(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.botAnimNodes.forEach((t=>{const i=t.getComponent(rg);if(i){if(!e)return void(i.button.interactable=!1);i.canActivate()&&(i.button.interactable=!0)}}))}}).prototype,"clock",[Tb],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),kb=ve(Nb.prototype,"header",[Ab],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),xb=ve(Nb.prototype,"devTools",[Rb],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Fb=ve(Nb.prototype,"comboProgressBar",[Ib],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Bb=ve(Nb.prototype,"comboContainer",[Pb],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),zb=ve(Nb.prototype,"uiMasks",[_b],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ub=ve(Nb.prototype,"topAnimNodes",[Lb],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Gb=ve(Nb.prototype,"botAnimNodes",[Db],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Ob=Nb))||Ob);var jb,Xb,$b,Jb,Qb,Zb,ef,tf,nf;i._RF.pop(),i._RF.push({},"157f203vjtMma2FDvAlyM6h","Gameplay",void 0);const{player:af,ads:sf,event:of,match:rf,storage:lf,analytics:cf,monitorError:hf,frameCapture:df,leaderboard:uf}=globalThis.game,{Events:pf,Utils:{Time:mf,Array:gf},Configs:{Gameplay:yf},Match:{Modes:bf}}=GameCore,{ccclass:ff,property:wf}=a;let Sf=[];jb=ff("Gameplay"),Xb=wf(ed),$b=wf(Wn),Jb=wf(jd),jb((ef=ve((Zb=class extends s{constructor(){super(...arguments),e(this,"board",ef,this),e(this,"opacityToggler",tf,this),e(this,"pathDraw",nf,this),this.gameData=null,this.defaultData={level:1,isMatchStartFromLoader:!1},this.rescueTiles=[],this.isAutoPlayEnabled=!1,this.handleOpenScreen=e=>{const{screenName:t}=e;t===Vi[Hi.GET_ITEM_SCREEN]&&this.uiManager.highlightCoinContainer()},this.handleShowUI=async()=>{this.uiManager.updateStatus(),this.uiManager.disableHeader(),this.uiManager.setInteractableItemButtons(!1),await this.uiManager.playEntranceAnimUI(),this.uiManager.enableHeader(),this.uiManager.setInteractableItemButtons(!0)},this.handleHideUI=async()=>{this.uiManager.disableHeader(),this.uiManager.setInteractableItemButtons(!1),await this.uiManager.playExitAnimUI()},this.handleCloseScreen=e=>{let{screenName:t}=e;t===Vi[Hi.GET_ITEM_SCREEN]&&this.uiManager.unHighlightCoinContainer()},this.handlePauseGame=()=>{this.node.scene.emit(Ha.PAUSE_TIME),this.node.pauseSystemEvents(!0),this.opacityToggler.changeStateFade(!1,.1),this.uiManager.setComboUI(!1),this.processCrazyGamesGameplayStop()},this.handleResumeGame=()=>{this.node.resumeSystemEvents(!0),this.stateManager.isPlaying()&&this.node.scene.emit(Ha.RESUME_TIME),this.processCrazyGamesGameplayStart(),this.opacityToggler.changeStateFade(!0,.1),this.uiManager.setComboUI(!0),this.guidelinesManager?.startAutoGuides()},this.handleReplayGame=async e=>{this.handleHideHint();const t={...this.defaultData,...e};try{rf.getMatchState().mode===bf.SINGLE&&await Sl.finishMatchAsync(),rf.getMatchState().mode!==bf.CHALLENGE_FRIEND&&await Sl.startMatchAsync()}catch(e){console.warn("handleReplayGame",e)}this.setGameData(t),this.stateManager.initialize()},this.handleFinishGame=()=>{this.attemptCallCreateShortcut(),this.guidelinesManager?.isNewbieGuideLevel()?(this.guidelinesManager.guideSkipButton.active=!1,this.handleNextLevel()):this.stateManager.finish()},this.handleNextLevel=async()=>{if(!this.gameData)return;try{rf.getMatchState().mode===bf.SINGLE&&await Sl.finishMatchAsync(),rf.getMatchState().mode===bf.TOURNAMENT&&this.scoreManager.updateTournamentStartScore()}catch(e){console.warn("handleReplayGame",e)}const e=(this.gameData.level??1)+1;this.setGameData({level:e}),await Promise.all([Sl.setMatchCustomDataAsync({level:e,score:0}),Sl.startMatchAsync()]),this.stateManager.initialize(),console.log("Next level",this.gameData.level)},this.handleStartOver=async()=>{af.setGameData({level:yf.Tutorial.Enabled?0:1}),this.gameData=af.getGameData(),this.stateManager.initialize(),console.info("Start over",this.gameData?.level)},this.handleMaxLevel=()=>{this.gameData&&(this.initData(),Wl.openScreen(Hi.CONGRATULATION_SCREEN,{level:this.gameData.level}),console.info("Max level",this.gameData.level))},this.handleExitGame=async()=>{try{lf.setStorageData("dashboard","animateToCurrentLevel",!0),lf.setStorageData("collection","animateMapPackUnlock",!0)}catch(e){console.warn("handleExitGame",e)}},this.handleTileClick=e=>{this.stateManager.playing(),this.board.handleTileClick(e),this.handleHideHint()},this.handleGridMatchSuccess=(e,t)=>{this.pathDraw.drawMatchPath(e,(e=>{let{x:t,y:i}=e;return this.board.getAnyTileWorldPosition(t,i)})),this.comboManager.addCombo(),this.handleAddScore(),this.effectManager.playClearFXAt([t[0].node.worldPosition,t[1].node.worldPosition])},this.handleGridMatchFail=e=>{this.guidelinesManager?.isShowErrorPathLevel()&&this.pathDraw.drawErrorPath(e,(e=>{let{x:t,y:i}=e;return this.board.getAnyTileWorldPosition(t,i)}))},this.checkIfGameIsFinish=()=>{0===this.board.getUncleared().length&&this.node.scene.emit(Ha.GAME_FINISH)},this.handlePauseTime=()=>{this.uiManager.pauseTime()},this.handleResumeTime=()=>{this.uiManager.resumeTime()},this.handleClockTimeout=()=>{this.stateManager.fail(Zl)},this.handleHalfTime=()=>{void 0!==this.guidelinesManager&&(this.board.getUncleared().length>=this.board.getCleared().length&&this.guidelinesManager.startThunderGuide()||this.board.getBombTiles().length>0&&this.guidelinesManager.startPliersGuide())},this.handleStartRescue=()=>{for(hi.setBlockInput(!0),this.board.setIgnoreInput(!0);this.rescueTiles.length>0;){this.rescueTiles.pop()?.restore()}cf.levelRescue(this.gameData?.level??1)},this.handleFinishRescue=()=>{hi.setBlockInput(!1),this.board.setIgnoreInput(!1)},this.handleBombExplode=async e=>{this.rescueTiles.push(e),this.board.setIgnoreInput(!0),hi.getBlockInput()||(Xi.playSound(Bi.BOMB_EXPLODE_1),hi.setBlockInput(!0));const t=e.node.worldPosition;await this.effectManager.createBombExplosionAt(new j(t.x,t.y,0)),hi.setBlockInput(!1),this.stateManager.isFail()||this.stateManager.fail(ec)},this.handleShowHint=()=>{if(this.pathDraw.isDrawingHint)return;const e=this.board.getHintPath();e&&(Xi.playSound(Bi.HINT_ITEM),this.pathDraw.drawHintPath(e,(e=>this.board.getAnyTileWorldPosition(e.x,e.y))),this.board.showHint())},this.handleHideHint=()=>{this.pathDraw.isDrawingHint&&(this.pathDraw.clearHintPath(),this.board.hideHint())},this.handleAddScore=()=>{const e=this.levelManager.getLevelData().level,t=this.comboManager.getCombo();this.scoreManager.addScore(10,e,t)},this.handleUseItem=e=>{this.stateManager.playing(),e!==br.HINT&&this.handleHideHint()},this.handleAutoPlay=()=>{this.isAutoPlayEnabled?this.disableAutoPlay():this.enableAutoPlay()},this.enableAutoPlay=()=>{this.isAutoPlayEnabled=!0;this.node.scene.once(Ha.GAME_FINISH,(()=>{this.disableAutoPlay()})),this.schedule(this.autoPlay,.5)},this.disableAutoPlay=()=>{this.isAutoPlayEnabled=!1,this.unschedule(this.autoPlay)},this.autoPlay=()=>{const e=this.board.getHintPath();if(!e)throw new Error("No path found");{const t=e[0].a,i=e.slice(-1)[0].b,n=this.board.getTileAt(t.x,t.y),a=this.board.getTileAt(i.x,i.y);if(!n||!a)throw new Error("Tile is null");n.onClick(),a.onClick()}},this.handleAddStars=e=>{const t=af.getGameData();if(!t)return Promise.resolve([]);af.setGameData({stars:t.stars+1});const{startAnimationAt:i}=e;i&&this.effectManager.playStarFXAt(i)},this.handleInviteFriends=async()=>{try{if(Wl.showLoadingScreen(),"MsGames"===GameSDK.getSDKName())return await GameSDK.extra.shareAsync(),Wl.closeLoadingScreen(),this.node.scene.emit(Ha.GAME_RESUME),void this.node.scene.emit(Ha.SHOW_UI);const e=this.board.generateFenFromCurrentLevel();let{level:t=1}=af.getGameData()??{};t=Math.max(1,t);const{mode:i="",rules:n={addRandomTilesPerMove:0,maxSpaceOfPair:0},time:a=0}=this.gameData?.levelData??{};df.addWideframeRender("renderResultChallenge",Wr),await rf.context.choose.processAsync({playerId:af.getPlayerId(),fallbackSingleMode:!1,extraData:{level:t,fen:e,gravity:i,rules:n,time:a}}),Wl.closeLoadingScreen(),this.node.scene.emit(Ha.GAME_RESUME),this.node.scene.emit(Ha.GAME_REPLAY,{level:t})}catch(e){if(console.warn("Unable to invite friends",e),Wl.closeLoadingScreen(),Wl.showNotificationScreen("Sorry, please try again later"),!(e instanceof Error))return;hf?.sendException(e),this.node.scene.emit(Ha.GAME_RESUME),this.node.scene.emit(Ha.SHOW_UI)}},this.handleAdShow=e=>{let{placementId:t}=e;t&&-1!==Sf.indexOf(t)&&(Sf.splice(Sf.indexOf(t),1),sf.hideBannerAdAsync(t).catch((()=>{})),0===Sf.length&&of.off(pf.AD_SHOWING,this.handleAdShow))},this.handleAddItem=async e=>{const{animate:t,item:i,quantity:n}=e,a=gf.search(this.itemManager.items,(e=>e.itemType===i));if(void 0===a)return void console.warn(`Item ${i} not found`);const s=a.getQuantity()+n;a.saveQuantity(s),this.uiManager.setInteractableItemButtons(!1),this.handlePauseGame(),await t(),a.setQuantity(s,!0),this.uiManager.setInteractableItemButtons(!0),this.handleResumeGame()}}__preload(){this.initComponents(),this.validateRequiredComponents(),this.listenCoreEvents(),this.listenInputEvents(),this.listenFlowEvents()}onLoad(){ll.init()}initComponents(){this.initUIManager(),this.initLevelManager(),this.initStateManager(),this.initEffectManager(),this.initItemManager(),this.initComboManager(),this.initScoreManager(),this.initInputController(),this.initGuidelinesManager()}initUIManager(){this.uiManager=this.node.parent?.getComponentInChildren(Yb),this.uiManager.initDevTools(this)}initLevelManager(){this.levelManager=this.getComponent(yg)}initStateManager(){this.stateManager=this.getComponent(ey)}initInputController(){this.inputController=this.getComponent(nc)}initEffectManager(){this.effectManager=this.getComponent(Qu)}initItemManager(){this.itemManager=this.getComponent(hg),this.itemManager.syncItems(),this.itemManager.items.forEach((e=>{e.init(this)}))}initComboManager(){this.comboManager=this.getComponent(Jd),this.comboManager.init()}initScoreManager(){this.scoreManager=this.getComponent(Sg),this.scoreManager.init()}initGuidelinesManager(){yf.Tutorial.Enabled&&(this.guidelinesManager=this.getComponent(zm),this.guidelinesManager.init(this))}validateRequiredComponents(){Fe.lazyValidateProperties(this)}listenCoreEvents(){Sf=[],of.off(pf.AD_SHOWING,this.handleAdShow),of.clear(pf.OPENING_SCREEN),of.clear(pf.CLOSING_SCREEN),of.on(pf.OPENING_SCREEN,this.handleOpenScreen),of.on(pf.CLOSING_SCREEN,this.handleCloseScreen)}listenInputEvents(){this.node.scene.on(Ha.SHOW_UI,this.handleShowUI),this.node.scene.on(Ha.HIDE_UI,this.handleHideUI),this.node.scene.on(Ha.GAME_PAUSE,this.handlePauseGame),this.node.scene.on(Ha.GAME_RESUME,this.handleResumeGame),this.node.scene.on(Ha.GAME_REPLAY,this.handleReplayGame),this.node.scene.on(Ha.GAME_FINISH,this.handleFinishGame),this.node.scene.on(Ha.NEXT_LEVEL,this.handleNextLevel),this.node.scene.on(Ha.START_OVER,this.handleStartOver),this.node.scene.on(Ha.MAX_LEVEL,this.handleMaxLevel),this.node.scene.on(Ha.GAME_EXIT,this.handleExitGame),this.node.scene.on(Ha.TILE_CLICK,this.handleTileClick),this.node.scene.on(Ha.GRID_MATCH_SUCCESS,this.handleGridMatchSuccess),this.node.scene.on(Ha.GRID_MATCH_FAIL,this.handleGridMatchFail),this.node.scene.on(Ha.PAUSE_TIME,this.handlePauseTime),this.node.scene.on(Ha.RESUME_TIME,this.handleResumeTime),this.node.scene.on(Ha.TIME_OUT,this.handleClockTimeout),this.node.scene.on(Ha.HALF_TIME,this.handleHalfTime),this.node.scene.on(Ha.RESCUE_START,this.handleStartRescue),this.node.scene.on(Ha.RESCUE_FINISHED,this.handleFinishRescue),this.node.scene.on(Ha.BOMB_EXPLODE,this.handleBombExplode),this.node.scene.on(Ha.SHOW_HINT,this.handleShowHint),this.node.scene.on(Ha.ADD_SCORE,this.handleAddScore),this.node.scene.on(Ha.GRID_CLEAR,this.checkIfGameIsFinish),this.node.scene.on(Ha.USE_ITEM,this.handleUseItem),this.node.scene.on(Ha.ADD_ITEM,this.handleAddItem),this.node.scene.on(Ha.AUTO_PLAY,this.handleAutoPlay),this.node.scene.on(Ha.ADD_STARS,this.handleAddStars)}listenFlowEvents(){this.node.scene.on(Ha.INVITE_FRIENDS,this.handleInviteFriends)}start(){this.initDataFirstTime(),this.initGame(),this.trySetTournamentStorage()}initDataFirstTime(){const e=this.getSceneData();let{level:t}=e??{};void 0===t&&(t=Sl.getMatchMode()===bf.TOURNAMENT?1:0),this.initData(),this.setGameData({level:t})}initData(){const{level:e=1,items:t}=af.getGameData()??{};t&&this.checkItemsRewardable()&&(t.hint<5&&(t.hint+=1),t.thunder<5&&(t.thunder+=1),t.storm<5&&(t.storm+=1),t.pliers<5&&(t.pliers+=1),af.setGameData({items:t,lastRewardedItems:Date.now()})),this.setGameData({...this.defaultData,level:e})}checkItemsRewardable(){const{lastRewardedItems:e=0}=af.getGameData()??{};return!mf.isToday(e)}initGame(){this.stateManager.init(this),this.stateManager.initialize()}async trySetTournamentStorage(){if(Sl.getMatchMode()!==bf.TOURNAMENT)return;const{leaderboardId:e}=Sl.getMatchCustomData()??{};if(!e)return;await Ql.requestTournamentDataAsync();const t=uf.getLeaderboardName(e);if(!t)return;const i=await uf.getLeadersByPlayerIdsAsync(t,[af.getPlayerId()]);if(0===i.length)return;const{score:n,rank:a}=i[0];lf.setStorageData("tournament","previousScore",n),lf.setStorageData("tournament","previousRank",a)}setGameData(e){const t=e.level??this.gameData?.level??1;this.gameData={...this.gameData,...e,level:t}}getGameData(){return this.gameData}getSceneData(){return El.getSceneData(this.node.scene)}attemptCallCreateShortcut(){const{level:e=0,nextLevelCount:t=0}=this.getGameData()??{};e<2||t<2||"checkAndCreateShortcutAsync"in GameSDK.extra&&GameSDK.extra.checkAndCreateShortcutAsync().catch((e=>{console.warn("checkAndCreateShortcutAsync",e)}))}processCrazyGamesGameplayStart(){"gameplayStart"in GameSDK.extra&&GameSDK.extra.gameplayStart()}processCrazyGamesGameplayStop(){"gameplayStop"in GameSDK.extra&&GameSDK.extra.gameplayStop()}disableRewardAdsItemForCrazyGames(){GameSDK.getSDKName()}}).prototype,"board",[Xb],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),tf=ve(Zb.prototype,"opacityToggler",[$b],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),nf=ve(Zb.prototype,"pathDraw",[Jb],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Qb=Zb));i._RF.pop(),i._RF.push({},"c863f/bTTdAjqEM+Kj9OaKi","DashboardEventButtonTypes",void 0);var vf=function(e){return e[e.STAR_CHEST=0]="STAR_CHEST",e[e.BALLOON=1]="BALLOON",e}(vf||{});I(vf),i._RF.pop(),i._RF.push({},"17fa4eEXEhIfZh+ad9Oqcmw","Leaderboard",void 0);var Cf=function(e){return e.WORLD_TAB_SELECTED="world-tab-selected",e.FRIENDS_TAB_SELECTED="friends-tab-selected",e}(Cf||{});const Ef="#AE4212",Tf="#3D5172",Af="#92200C",Rf="#8F5542",If="#8A4733",Pf="#3e7110",_f="#3e7110";var Lf;i._RF.pop(),i._RF.push({},"4cd93d4ECxKDYSG9apAx603","LevelMission",void 0),i._RF.pop(),i._RF.push({},"78297LLtrJKMpOIidCw/BA9","index",void 0),i._RF.pop(),i._RF.push({},"176c3V0yoFEhIdpVcCIhDz7","isEmptyBoard",void 0),i._RF.pop(),i._RF.push({},"5262atLmldNy7Q3MtHgiSRI","HintItem",void 0);const{ccclass:Df}=a,{player:Of,analytics:Nf}=globalThis.game,{Plugins:{Analytics:{Events:Mf}}}=GameCore;Df("HintItem")(Lf=class extends rg{constructor(){super(...arguments),this.requestItem=()=>{Wl.openScreen(Hi.GET_ITEM_SCREEN,{item:br.HINT,message:"Shows a pair of tiles\nthat can be connected.",quantity:1})},this.loadQuantity=()=>{const e=Of.getGameData();return e?.items&&e?e.items[br.HINT]:0}}get itemType(){return br.HINT}init(e){this.boardInstance=e.board,this.pathDrawer=e.pathDraw,this.setQuantity(this.loadQuantity()),super.init(e)}onDestroy(){if(!this.boardInstance)return;this.node.scene.targetOff(this);const e=this.boardInstance.node;null!=e?(this.boardInstance.node.targetOff(this),super.onDestroy?.()):super.onDestroy?.()}validateRequiredComponents(){super.validateRequiredComponents(),Fe.lazyValidateProperties(this)}canActivate(){try{return this.boardInstance.getUncleared().length>0}catch(e){return!1}}async activate(){this.pathDrawer.isDrawingHint||(this.getQuantity()<=0?await super.activate():(await super.activate(),Nf.event(Mf.USE_ITEM,{item_name:br.HINT}),this.node.scene.emit(Ha.USE_ITEM,br.HINT),this.node.scene.emit(Ha.SHOW_HINT)))}saveQuantity(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.getQuantity(),t=arguments.length>1?arguments[1]:void 0;super.saveQuantity(e,t);const i=Of.getGameData();i&&Of.setGameData({items:{...i.items,[br.HINT]:e}})}});var kf;i._RF.pop(),i._RF.push({},"3f4c1AB+jdNFqylpogoaiDZ","PliersItem",void 0);const{ccclass:xf}=a,{player:Ff,analytics:Bf}=globalThis.game,{Plugins:{Analytics:{Events:zf}}}=GameCore;xf("PliersItem")(kf=class extends rg{constructor(){super(...arguments),this.requestItem=()=>{Wl.openScreen(Hi.GET_ITEM_SCREEN,{item:br.PLIERS,message:"Removes a random bomb\nfrom the game field.",quantity:1})},this.loadQuantity=()=>{const e=Ff.getGameData();return e?.items&&e?e.items[br.PLIERS]:0}}get itemType(){return br.PLIERS}init(e){this.boardInstance=e.board,this.effectManager=e.effectManager,super.init(e)}onDestroy(){if(!this.boardInstance)return;this.node.scene.targetOff(this);const e=this.boardInstance.node;null!=e?(this.boardInstance.node.targetOff(this),super.onDestroy?.()):super.onDestroy?.()}validateRequiredComponents(){super.validateRequiredComponents(),Fe.lazyValidateProperties(this)}canActivate(){try{return this.boardInstance.getBombTiles().length>0}catch(e){return!1}}async activate(){if(this.getQuantity()<=0)return void await super.activate();await super.activate(),Bf.event(zf.USE_ITEM,{item_name:br.PLIERS}),this.node.scene.emit(Ha.USE_ITEM,br.PLIERS);const e=$c(this.boardInstance.getBombTiles()),t=e.node.worldPosition;this.effectManager.createDefuseExplosionAt(new j(t.x,t.y,0)),Xi.playSound(Bi.BOMB_DEFUSE),e.special.switch(pc.none),this.applyActivationStatus()}saveQuantity(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.getQuantity(),t=arguments.length>1?arguments[1]:void 0;super.saveQuantity(e,t);const i=Ff.getGameData();i&&Ff.setGameData({items:{...i.items,[br.PLIERS]:e}})}});var Uf;i._RF.pop(),i._RF.push({},"d6e51+oy6NCF7cKvf6KOWiu","StormItem",void 0);const{ccclass:Gf}=a,{player:Hf,analytics:Vf}=globalThis.game,{Plugins:{Analytics:{Events:qf}}}=GameCore;Gf("StormItem")(Uf=class extends rg{constructor(){super(...arguments),this.requestItem=()=>{Wl.openScreen(Hi.GET_ITEM_SCREEN,{item:br.STORM,message:"Randomly rearranges the \ntiles on the game field.",quantity:1})},this.loadQuantity=()=>{const e=Hf.getGameData();return e?.items&&e?e.items[br.STORM]:0}}get itemType(){return br.STORM}init(e){this.boardInstance=e.board,this.effectManager=e.effectManager,super.init(e)}onDestroy(){if(!this.boardInstance)return;this.node.scene.targetOff(this);const e=this.boardInstance.node;null!=e?(this.boardInstance.node.targetOff(this),super.onDestroy?.()):super.onDestroy?.()}validateRequiredComponents(){super.validateRequiredComponents(),Fe.lazyValidateProperties(this)}canActivate(){try{return this.boardInstance.getUncleared().length>2}catch(e){return!1}}async activate(){if(this.getQuantity()<=0)return void await super.activate();await super.activate(),Vf.event(qf.USE_ITEM,{item_name:br.STORM}),this.node.scene.emit(Ha.USE_ITEM,br.STORM),this.node.scene.emit(Ha.HIDE_UI);const e=new Promise((e=>this.scheduleOnce(e,.5)));await Promise.race([this.effectManager.loadTornadoAnimation(),e]);this.boardInstance.processShuffleRequest((async(e,t)=>{Xi.muteMusic(!0),Xi.playSound(Bi.SHUFFLE_ITEM),Xi.playSound(Bi.WIND);await(()=>Promise.all(e.map(((t,i,n)=>t.sync({duration:.4,easing:"smooth",getTargetPosition:()=>Vc(e,this.boardInstance.getTileSize(),{x:i,y:n},10)})))))(),this.effectManager.playTornadoAnimation(),await(async()=>{t.forEach(((e,i,n)=>{e.node.setSiblingIndex(t.asArray().length-1-(i+n*t.width))})),await Promise.all(t.map((e=>e.fly({getTilePosition:e=>Vc(t,this.boardInstance.getTileSize(),e)}))))})(),this.node.scene.emit(Ha.SHOW_UI),Xi.muteMusic(!1)}))}saveQuantity(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.getQuantity(),t=arguments.length>1?arguments[1]:void 0;super.saveQuantity(e,t);const i=Hf.getGameData();i&&Hf.setGameData({items:{...i.items,[br.STORM]:e}})}});var Wf;i._RF.pop(),i._RF.push({},"b30ffJjU2lAH5yu2NkzVVnO","ThunderItem",void 0);const{ccclass:Kf}=a,{player:Yf,analytics:jf}=globalThis.game,{Plugins:{Analytics:{Events:Xf}}}=GameCore;Kf("ThunderItem")(Wf=class extends rg{constructor(){super(...arguments),this.requestItem=()=>{Wl.openScreen(Hi.GET_ITEM_SCREEN,{item:br.THUNDER,message:"Remove 2 pair of tiles\non the game field.",quantity:1})},this.loadQuantity=()=>{const e=Yf.getGameData();return e?.items&&e?e.items[br.THUNDER]:0}}get itemType(){return br.THUNDER}init(e){this.boardInstance=e.board,this.effectManager=e.effectManager,super.init(e)}onDestroy(){if(!this.boardInstance)return;this.node.scene.targetOff(this);const e=this.boardInstance.node;null!=e?(this.boardInstance.node.targetOff(this),super.onDestroy?.()):super.onDestroy?.()}validateRequiredComponents(){super.validateRequiredComponents(),Fe.lazyValidateProperties(this)}canActivate(){try{return this.boardInstance.getUncleared().length>=4}catch(e){return!1}}async activate(){if(this.getQuantity()<=0)return void await super.activate();await super.activate(),jf.event(Xf.USE_ITEM,{item_name:br.THUNDER}),this.node.scene.emit(Ha.USE_ITEM,br.THUNDER),this.node.scene.emit(Ha.HIDE_UI),await this.effectManager.loadThunderAnimation(),Xi.muteMusic(!0);const e=this.boardInstance.getUncleared();if(e.length<4)throw new Error("Not enough uncleared tiles");const t=this.boardInstance.getPairs(2);hi.setBlockInput(!0),this.boardInstance.clearSelectedTile(),await this.effectManager.playThunderAnimation(t,this.boardInstance),e.length>4&&this.node.scene.emit(Ha.SHOW_UI),Xi.muteMusic(!1),hi.setBlockInput(!1)}saveQuantity(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.getQuantity(),t=arguments.length>1?arguments[1]:void 0;super.saveQuantity(e,t);const i=Yf.getGameData();i&&Yf.setGameData({items:{...i.items,[br.THUNDER]:e}})}});var $f;i._RF.pop(),i._RF.push({},"0a97aK0agJOHb07cLs0JICj","PathHolder",void 0);const{ccclass:Jf,requireComponent:Qf}=a;Jf("PathHolder")($f=Qf(x)($f=class extends s{onLoad(){this.node.scene.on(Ha.GRID_RESIZE,(e=>{this.node.setScale(e,e)}))}})||$f);var Zf,ew,tw,iw,nw,aw,sw,ow,rw,lw,cw,hw,dw;i._RF.pop(),i._RF.push({},"944cbG3+yRMsJZimXjukGdn","Coin",void 0);const{ccclass:uw,property:pw}=a;let mw=(Zf=uw("Coin"),ew=pw(se),tw=pw(se),iw=pw(y),nw=pw(D),aw=pw(D),Zf((rw=ve((ow=class extends s{constructor(){super(...arguments),e(this,"explodeParticles",rw,this),e(this,"emittingParticles",lw,this),e(this,"animation",cw,this),e(this,"spin",hw,this),e(this,"rest",dw,this)}__preload(){Fe.lazyValidateProperties(this)}playAnimation(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1?arguments[1]:void 0;e>0&&this.scheduleOnce((()=>{t?.aborted||this.animation.play(this.spin.name)}),e),this.animation.play(this.spin.name)}stopAnimation(){this.animation.play(this.rest.name)}}).prototype,"explodeParticles",[ew],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),lw=ve(ow.prototype,"emittingParticles",[tw],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),cw=ve(ow.prototype,"animation",[iw],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),hw=ve(ow.prototype,"spin",[nw],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),dw=ve(ow.prototype,"rest",[aw],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),sw=ow))||sw);var gw,yw,bw,fw,ww,Sw,vw;i._RF.pop(),i._RF.push({},"0c6a8vx5IhFvKJ5IUimm0Je","CoinTextPopup",void 0);const{ccclass:Cw,property:Ew}=a,Tw=j.ZERO.clone().add3f(0,-100,0),Aw=j.ZERO.clone().add3f(0,100,0),{Utils:{Number:Rw}}=GameCore;let Iw=(gw=Cw("CoinTextPopup"),yw=Ew(h),bw=Ew(x),gw((Sw=ve((ww=class extends s{constructor(){super(...arguments),e(this,"label",Sw,this),e(this,"uiOpacity",vw,this)}__preload(){Fe.lazyValidateProperties(this),this.node.active=!1}async show(e,t){const i=Rw.getShortNumber(e,3);this.label.string=i,this.node.active=!0,this.uiOpacity.opacity=255,this.node.setScale(.5,.5,.5),this.node.setPosition(Tw),await Promise.all([vt.runTweenAsync(C(this.node).to(1.5,{position:Aw},{easing:"sineOut"}),t),vt.runTweenAsync(C(this.node).to(.5,{scale:j.ONE},{easing:"backOut"}),t)]),this.node.setScale(j.ONE),this.node.setPosition(Aw),
//! not subscribed to signal because in the case the user skipped the animation we'd still want them to see this node disappear
await vt.runTweenAsync(C(this.uiOpacity).to(.5,{opacity:0})),this.node.active=!1}}).prototype,"label",[yw],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),vw=ve(ww.prototype,"uiOpacity",[bw],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),fw=ww))||fw);var Pw,_w,Lw,Dw,Ow,Nw,Mw,kw,xw;i._RF.pop(),i._RF.push({},"8a5c3m7o41LNqGBKPo0oqf1","CoinManager",void 0);const{ccclass:Fw,disallowMultiple:Bw,property:zw}=a,{player:Uw,monitorError:Gw}=globalThis.game,Hw=999999999,Vw={MAX_COIN_COUNT:10,DISTANCE_RANGE:[1e3,1500],STAGGER:.03,FLOAT_DURATION:1,FLY_DURATION:1};let qw=(Pw=Fw("CoinManager"),_w=zw(_),Lw=zw(_),Dw=zw(n),Pw(Ow=Bw((Mw=ve((Nw=class extends s{constructor(){super(...arguments),this.coins=0,e(this,"coinPrefab",Mw,this),e(this,"coinTextPopup",kw,this),e(this,"coinAnimContainer",xw,this),this.collectionAnimSignal=null,this.coinObjects=[]}__preload(){this.lifeCycleSignal=new oi,this.validateRequiredComponents(),this.getCoinsFromPlayerData()}onLoad(){this.prepareCoinCollection(),this.prepareCoinTextPopup(),this.listenToCoinEvents()}start(){this.emitCoinAmount()}init(e){this.updateCoins({coins:this.coins,collectionAnimation:void 0}),this.animSkipOverlay=e}listenToCoinEvents(){this.node.scene.on(Ha.ADD_COINS,this.addCoins,this),this.node.scene.on(Ha.REMOVE_COINS,this.removeCoins,this)}validateRequiredComponents(){Fe.lazyValidateProperties(this)}prepareCoinCollection(){for(let e=0;e<Vw.MAX_COIN_COUNT;e++){const e=c(this.coinPrefab);e.setParent(this.coinAnimContainer),e.setPosition(0,0),e.active=!1,this.coinObjects.push(e.getComponent(mw))}}prepareCoinTextPopup(){const e=c(this.coinTextPopup);e.setParent(this.node),e.active=!1,this.coinTextPopupNode=e.getComponent(Iw)}async handleCollectionAnim(e,t,i){if(!this.targetContainer)return void console.warn("No target coin container assigned to CoinManager. No coin collection animation will be played");const n=this.coinObjects.slice(0,this.getShortAmount(e));if(0===n.length)return console.warn(`Requested coins amount is ${e}. Shortened to ${this.getShortAmount(e)}. No coin objects was found to animate collection.`),void Gw?.sendException(new Error(`Requested coins amount is ${e}. Shortened to ${this.getShortAmount(e)}. No coin objects was found to animate collection.`),{coins:e,animatedCoins:n.length,hasCoinTextPopup:!!this.coinTextPopupNode,hasTargetContainer:!!this.targetContainer,coinCollectionCount:this.coinObjects.length});await(this.animSkipOverlay?.open({onSkip:()=>this.collectionAnimSignal.abort(),opacity:150})),Xi.playSound(Bi.COLLECT_STOCK_COINS);const a=n.map((async e=>{e.explodeParticles.stopSystem(),e.emittingParticles.stopSystem(),e.node.active=!0;const n=[0,.5*Math.min(t,i)],a=ne(...n),s=t-a,o=i+a;await this.animateCoinExplode(e.node,s),e.playAnimation(2*a,this.collectionAnimSignal),e.emittingParticles.resetSystem(),await this.animateCoinFlyBack(this.collectionAnimSignal,e,o),e.emittingParticles.stopSystem(),e.stopAnimation()}));await Promise.all([(async()=>{await Promise.all(a),await(this.targetContainer?.emitExplodeEffect(this.collectionAnimSignal))})(),this.animateCoinTextPopup(e,this.collectionAnimSignal,t+i/2)]),await(this.animSkipOverlay?.close()),this.collectionAnimSignal.abort()}async animateCoinTextPopup(e,t,i){await vt.waitTweenAsync(i,t),await this.coinTextPopupNode.show(e,t)}async animateCoinFlyBack(e,t,i){const n=t.node.worldPosition.clone(),a=j.ZERO.clone(),s=this.targetContainer.getCoinIconWorldScale();await vt.runTweenAsync(C(t.node).to(i,{scale:s},{onUpdate:(e,i)=>{if(void 0===i)return;const s=k.cubicIn(i),o=this.targetContainer.getCoinIconWorldPosition();t.node.worldPosition=j.lerp(a,n,o,s)}}),e),t.node.scale=j.ZERO,this.explodeParticlesAndDisableAfter(1,t)}async explodeParticlesAndDisableAfter(e,t){const i=t.explodeParticles;i.resetSystem(),await vt.waitTweenAsync(e/10,this.lifeCycleSignal),oi.hasBeenAborted(this.lifeCycleSignal)||(i.stopSystem(),await vt.waitTweenAsync(e/10*9,this.lifeCycleSignal),oi.hasBeenAborted(this.lifeCycleSignal)||(t.node.setPosition(0,0,t.node.position.z),t.node.active=!1))}async animateCoinExplode(e,t){const i=[-200,200],n=[-200,200],a=ne(i[0],i[1]),s=ne(n[0],n[1]);e.setPosition(0,0,e.position.z),e.setScale(j.ZERO);const o=new j(a,s,e.position.z);await Promise.all([vt.runTweenAsync(C(e).delay(.1*t).to(.8*t,{scale:j.ONE},{easing:"elasticOut"}),this.collectionAnimSignal),vt.runTweenAsync(C(e).to(t,{position:o},{easing:"circOut"}),this.collectionAnimSignal)])}getCoinsFromPlayerData(){const e=Uw.getGameData();this.coins=e?e.coins:0}getCoins(){return this.coins}updateCoins(e){if(console.info("updateCoins",e.coins,e.collectionAnimation?.animateTextOnly),this.coins>Hw&&(this.coins=Hw),e.coins===this.coins)return;const t=Math.max(0,e.coins-this.coins);this.coins=e.coins,Uw.setGameData({coins:this.coins});const{collectionAnimation:i}=e;if(void 0===i||i.animateTextOnly)return void this.node.scene.emit(Ha.COIN_CHANGED,{...e,collectionAnimation:{animateTextOnly:!0,signal:this.collectionAnimSignal}});this.collectionAnimSignal?.abort();const{floatDuration:n=Vw.FLOAT_DURATION,flyDuration:a=Vw.FLY_DURATION,signal:s=new oi,target:o=this.targetContainer}=i;this.collectionAnimSignal=s,this.targetContainer=o;const r={...e,collectionAnimation:{floatDuration:n,flyDuration:a,animateTextOnly:!1,signal:s,target:o}};this.node.scene.emit(Ha.COIN_CHANGED,r),this.handleCollectionAnim(t,n,a)}addCoins(e){this.updateCoins({...e,coins:this.coins+e.coins})}removeCoins(e){this.coins<e.coins?this.node.scene.emit(Ha.REMOVE_COINS_FAILED):(this.updateCoins({...e,coins:this.coins-e.coins}),this.node.scene.emit(Ha.REMOVE_COINS_SUCCESS))}emitCoinAmount(){this.node.scene.emit(Ha.COIN_CHANGED,{coins:this.coins})}getShortAmount(e){return Math.min(e,Vw.MAX_COIN_COUNT)}untilFinishesCollectAnim(){return null===this.collectionAnimSignal?Promise.resolve():this.collectionAnimSignal.untilAborted()}setTargetContainer(e){this.targetContainer=e}getTargetContainer(){return this.targetContainer}onDestroy(){this.collectionAnimSignal?.abort(),this.lifeCycleSignal?.abort()}}).prototype,"coinPrefab",[_w],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),kw=ve(Nw.prototype,"coinTextPopup",[Lw],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),xw=ve(Nw.prototype,"coinAnimContainer",[Dw],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ow=Nw))||Ow)||Ow);i._RF.pop(),i._RF.push({},"d2a57+mB4NG9rcdh+dy1VPe","traverse4",void 0),i._RF.pop(),i._RF.push({},"ca614iJ+X5LrL1rX/wDQDTD","shuffle",void 0),i._RF.pop(),i._RF.push({},"1cf4cygDSdP5JL+7w3wIJL7","traverseRandom",void 0),i._RF.pop(),i._RF.push({},"1faa9NgJrBE7p8Zs/HBWrZn","pad",void 0),i._RF.pop(),i._RF.push({},"f3b1eQ+t3FJYa35I0oznLiF","ParticleProperties",void 0);class Ww{constructor(){this.lifeCurrent=0,this.life=0,this.velocityX=0,this.velocityY=0,this.alpha=255,this.totalRotation=0,this.lastChange=0,this.currentFrame=0}}var Kw,Yw,jw,Xw,$w;i._RF.pop(),i._RF.push({},"32b8eGxcghFHZOi1WYXHCjF","BaseParticle",void 0);const{ccclass:Jw,property:Qw}=a;let Zw=(Kw=Jw("BaseParticle"),Yw=Qw(R),Kw(($w=ve((Xw=class extends s{constructor(){super(...arguments),e(this,"sprite",$w,this),this.properties=new Ww}__preload(){this.validateRequiredComponents()}validateRequiredComponents(){if(!this.sprite)throw new Error("BaseParticle: Sprite not found")}manualInit(e,t){this.manager=e;const{tint:i,velocityX:n,velocityY:a,totalRotation:s,lifespan:r,startAngle:l,scale:c}=t;this.properties.lastChange=0;const h=new o;o.fromHEX(h,i),this.sprite.color=h,this.properties.velocityX=n,this.properties.velocityY=a,this.properties.life=r,this.properties.lifeCurrent=r,this.properties.totalRotation=s,this.node.angle=l,this.node.setScale(c,c,1)}manualUpdate(e){return this.computeVelocity(e),this.node.setPosition(this.node.position.x+this.properties.velocityX*e,this.node.position.y+this.properties.velocityY*e,0),this.node.angle+=this.properties.totalRotation*e/this.properties.life,this.properties.lifeCurrent-=e,this.properties.lifeCurrent<=0}computeVelocity(e){const{velocityX:t,velocityY:i}=this.properties,n=t;let a=i;a+=this.manager.getGravityY()*e,this.properties.velocityX=n,this.properties.velocityY=a}}).prototype,"sprite",[Yw],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),jw=Xw))||jw);var eS,tS,iS,nS,aS,sS,oS;i._RF.pop(),i._RF.push({},"b6123+a2K1LoY60oZO9SYKX","StarConfetti",void 0);const{ccclass:rS,property:lS}=a;let cS=(eS=rS("StarConfetti"),tS=lS([N]),iS=lS([N]),eS((sS=ve((aS=class extends Zw{constructor(){super(...arguments),e(this,"starXFrames",sS,this),e(this,"starYFrames",oS,this),this.msPerFrame=.15,this.isYoyo=!1,this.isGravityChanged=!1}manualInit(e,t){super.manualInit(e,t),this.msPerFrame=.15,this.isYoyo=!1,this.isGravityChanged=!1}manualUpdate(e){const t=super.manualUpdate(e);return this.updateGravity(),this.updateVelocity(),this.updateFrameRate(),this.updateFrames(e),t}updateGravity(){if(this.properties.lifeCurrent>this.properties.life-2||this.isGravityChanged)return;this.isGravityChanged=!0;this.properties.velocityX/=3,this.manager.setGravityY(-23745/667)}updateVelocity(){if(this.properties.lifeCurrent>this.properties.life-2)return;this.properties.velocityX>0?this.properties.velocityX+=z.randomRangeInt(-12,6):this.properties.velocityX+=z.randomRangeInt(-6,12)}updateFrames(e){if(this.properties.lastChange+=e,this.properties.lastChange>=this.msPerFrame){this.isYoyo?this.properties.currentFrame--:this.properties.currentFrame++,this.properties.currentFrame<0&&(this.isYoyo=!1,this.properties.currentFrame=1),this.properties.currentFrame>=4&&(this.isYoyo=!0,this.properties.currentFrame-=1);const e=Math.random()>.5?this.starXFrames:this.starYFrames;this.sprite.spriteFrame=e[this.properties.currentFrame],this.properties.lastChange-=this.msPerFrame}}updateFrameRate(){this.properties.lifeCurrent<this.properties.life-2?this.msPerFrame=.15:this.msPerFrame=z.randomRangeInt(300,600)/1e3}}).prototype,"starXFrames",[tS],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),oS=ve(aS.prototype,"starYFrames",[iS],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),nS=aS))||nS);i._RF.pop(),i._RF.push({},"9caadUsaKtPEoOe+T2+pqtd","Properties",void 0);class hS{constructor(){this.delay=200,this.timeScale=2,this.tints=["#F1D171","#97E1FD","#7765D1","#ED4440","#F9E02A"],this.speedX={min:1583/75,max:1583*.24},this.speedY={min:1139.76,max:1219.76},this.gravityY=-664.86,this.lifespan={min:5,max:8},this.rotate={totalRotation:1080,random:!0},this.scale={min:.6,max:1},this.originGravityY=-664.86}}var dS;i._RF.pop(),i._RF.push({},"d1648PsavVBn7B059PS5fj6","BaseEmitter",void 0);const{ccclass:uS}=a;let pS=uS("BaseEmitter")(dS=class extends s{constructor(){super(...arguments),this.properties=new hS}getGravityY(){return this.properties.gravityY}setGravityY(e){this.properties.gravityY=e}})||dS;var mS;i._RF.pop(),i._RF.push({},"654983p4rREVKci1CE8cSJ2","ConfettiEmitter",void 0);const{ccclass:gS}=a;let yS=gS("ConfettiEmitter")(mS=class extends pS{constructor(){super(...arguments),this.activeStarConfetti=[]}__preload(){this.validateRequiredComponents()}validateRequiredComponents(){Fe.lazyValidateProperties(this)}async createConfettiPool(){this.starConfettiPrefab=await hi.loadPrefabAsync("particles/StarConfetti"),this.starConfettiPool=new ad((()=>{const e=c(this.starConfettiPrefab);return this.node.addChild(e),e.active=!1,e}),0,(e=>{const t=e.getComponent(cS);t?(this.activeStarConfetti.push(t),e.active=!0):console.error("StarConfetti not found")}),(e=>{e.getComponent(cS)?e.active=!1:console.error("StarConfetti not found")}),(e=>{e.isValid&&e.destroy()})),this.properties.timeScale=1.5,this.properties.gravityY=688.605,this.properties.lifespan.min=4,this.properties.lifespan.max=6,this.properties.rotate.totalRotation=1800}async runEffect(e,t,i){this.starConfettiPool||await this.createConfettiPool(),this.properties.gravityY=this.properties.originGravityY;for(let n=0;n<e;n++){const e=this.starConfettiPool.alloc(),n=e.getComponent(cS);if(!n)return void console.error("StarConfetti not found");e.setPosition(t.clone());const a=this.properties.tints[Math.floor(Math.random()*this.properties.tints.length)],s=Math.random()*(this.properties.speedX.max-this.properties.speedX.min),o=Math.random()*(this.properties.speedY.max-this.properties.speedY.min)+this.properties.speedY.min,r=Math.random()*(this.properties.lifespan.max-this.properties.lifespan.min)+this.properties.lifespan.min,l=this.properties.rotate.random?180*Math.random():0,c=Math.random()*(this.properties.scale.max-this.properties.scale.min)+this.properties.scale.min,h={tint:a,velocityX:s,velocityY:o,lifespan:r,totalRotation:this.properties.rotate.totalRotation,startAngle:l,scale:c};n.manualInit(this,h);const d=this.starConfettiPool.alloc(),u=d.getComponent(cS);if(!u)return void console.error("StarConfetti not found");d.setPosition(i.clone()),h.velocityX=-s,u.manualInit(this,h)}}clearEffect(){for(const e of this.activeStarConfetti)this.starConfettiPool.free(e.node);this.activeStarConfetti=[]}update(e){const t=e*this.properties.timeScale,i=[];this.activeStarConfetti.forEach((e=>{e.manualUpdate(t)&&i.push(e)})),i.forEach((e=>{this.starConfettiPool.free(e.node),this.activeStarConfetti.splice(this.activeStarConfetti.indexOf(e),1)}))}})||mS;var bS,fS,wS,SS,vS,CS,ES,TS,AS,RS,IS;i._RF.pop(),i._RF.push({},"78c97IkjeJFQohPZudvcfeS","Ribbon",void 0);const{ccclass:PS,property:_S}=a,{Utils:{Array:LS}}=GameCore;let DS=(bS=PS("Ribbon"),fS=_S([N]),wS=_S([N]),SS=_S([N]),vS=_S([N]),bS((TS=ve((ES=class extends Zw{constructor(){super(...arguments),e(this,"ribbonA",TS,this),e(this,"ribbonB",AS,this),e(this,"ribbonC",RS,this),e(this,"ribbonD",IS,this),this.useFrames=[],this.msPerFrame=.15,this.isYoyo=!1,this.isGravityChanged=!1,this.points=[]}manualInit(e,t){super.manualInit(e,t),this.msPerFrame=.15,this.isYoyo=!1,this.isGravityChanged=!1,this.points=LS.fillWith(10,(()=>({x:0,y:0})));const i=Math.random();this.useFrames=i<.25?this.ribbonA:i<.5?this.ribbonB:i<.75?this.ribbonC:this.ribbonD,this.sprite.enabled=!1}manualUpdate(e){const t=super.manualUpdate(e);return this.updateFrames(e),this.updatePoints(),this.updateGravity(),this.updateVelocity(),t}updateFrames(e){this.properties.lastChange+=e,this.properties.lastChange>=this.msPerFrame&&(this.isYoyo?this.properties.currentFrame--:this.properties.currentFrame++,this.properties.currentFrame<0&&(this.isYoyo=!1,this.properties.currentFrame=1),this.properties.currentFrame>=this.useFrames.length&&(this.isYoyo=!0,this.properties.currentFrame-=1),this.sprite.spriteFrame=this.useFrames[this.properties.currentFrame],this.properties.lastChange-=this.msPerFrame)}updatePoints(){if(this.isGravityChanged)return;this.points.shift();const{x:e,y:t}=this.node.worldPosition;this.points.push({x:e,y:t})}updateGravity(){if(this.properties.lifeCurrent>this.properties.life-2||this.isGravityChanged)return;this.isGravityChanged=!0,this.points=[],this.sprite.enabled=!0,this.properties.velocityX/=3;this.manager.setGravityY(-23745/667)}updateVelocity(){if(this.isGravityChanged)return;this.properties.lifeCurrent>this.properties.life-1.8?this.properties.velocityX+=z.randomRangeInt(-24,24):this.properties.velocityX>0?this.properties.velocityX+=z.randomRangeInt(-20,12):this.properties.velocityX+=z.randomRangeInt(-12,20)}getGlobalPoints(){return this.points}getColor(){return this.sprite.color}}).prototype,"ribbonA",[fS],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),AS=ve(ES.prototype,"ribbonB",[wS],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),RS=ve(ES.prototype,"ribbonC",[SS],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),IS=ve(ES.prototype,"ribbonD",[vS],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),CS=ES))||CS);var OS,NS,MS,kS,xS;i._RF.pop(),i._RF.push({},"f2427J2HhBKdpkcqDn2Vv5H","RibbonEmitter",void 0);const{ccclass:FS,property:BS}=a;let zS=(OS=FS("RibbonEmitter"),NS=BS(q),OS((xS=ve((kS=class extends pS{constructor(){super(...arguments),e(this,"graphics",xS,this),this.activeRibbonConfetti=[]}__preload(){this.validateRequiredComponents()}validateRequiredComponents(){Fe.lazyValidateProperties(this)}async createConfettiPool(){this.ribbonPrefab=await hi.loadPrefabAsync("particles/Ribbon"),this.ribbonConfettiPool=new ad((()=>{const e=c(this.ribbonPrefab);return this.node.addChild(e),e.active=!1,e}),0,(e=>{const t=e.getComponent(DS);t?(this.activeRibbonConfetti.push(t),e.active=!0):console.error("StarConfetti not found")}),(e=>{e.getComponent(DS)?e.active=!1:console.error("StarConfetti not found")}),(e=>{e.destroy()}))}async runEffect(e,t,i){this.ribbonConfettiPool||await this.createConfettiPool(),this.properties.gravityY=this.properties.originGravityY;for(let n=0;n<e;n++){const e=this.ribbonConfettiPool.alloc(),n=e.getComponent(DS);if(!n)return void console.error("StarConfetti not found");e.setPosition(t.clone());const a=this.properties.tints[Math.floor(Math.random()*this.properties.tints.length)],s=Math.random()*(this.properties.speedX.max-this.properties.speedX.min),o=Math.random()*(this.properties.speedY.max-this.properties.speedY.min)+this.properties.speedY.min,r=Math.random()*(this.properties.lifespan.max-this.properties.lifespan.min)+this.properties.lifespan.min,l=this.properties.rotate.random?180*Math.random():0,c=Math.random()*(this.properties.scale.max-this.properties.scale.min)+this.properties.scale.min,h={tint:a,velocityX:s,velocityY:o,lifespan:r,totalRotation:this.properties.rotate.totalRotation,startAngle:l,scale:c};n.manualInit(this,h);const d=this.ribbonConfettiPool.alloc(),u=d.getComponent(DS);if(!u)return void console.error("StarConfetti not found");d.setPosition(i.clone()),h.velocityX=-s,u.manualInit(this,h)}}clearEffect(){for(const e of this.activeRibbonConfetti)this.ribbonConfettiPool.free(e.node);this.activeRibbonConfetti=[]}update(e){const t=e*this.properties.timeScale;this.graphics.clear();const i=[];this.activeRibbonConfetti.forEach((e=>{e.manualUpdate(t)&&i.push(e),this.drawGraphics(e.getGlobalPoints(),e.getColor())})),i.forEach((e=>{this.ribbonConfettiPool.free(e.node),this.activeRibbonConfetti.splice(this.activeRibbonConfetti.indexOf(e),1)}))}drawGraphics(e,t){if(!this.graphics.node.active)return;for(const t of e)if(0===t.y)return;if(e.length<2)return;this.graphics.strokeColor=t;let i=new j(e[0].x,e[0].y,0);i=this.node.inverseTransformPoint(i,i),this.graphics.moveTo(i.x,i.y);for(let t=1;t<e.length;t++)i.x=e[t].x,i.y=e[t].y,i=this.node.inverseTransformPoint(i,i),this.graphics.lineTo(i.x,i.y);this.graphics.stroke()}}).prototype,"graphics",[NS],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),MS=kS))||MS);var US,GS,HS,VS,qS,WS,KS;i._RF.pop(),i._RF.push({},"f7cfcFAL8tBE70g2A0+qMTR","PaperConfetti",void 0);const{ccclass:YS,property:jS}=a;let XS=(US=YS("PaperConfetti"),GS=jS(yS),HS=jS(zS),US((WS=ve((qS=class extends s{constructor(){super(...arguments),this.spawnLeftPos=new j(-375,-791.5,0),this.spawnRightPos=new j(375,-791.5,0),e(this,"confettiEmitter",WS,this),e(this,"ribbonEmitter",KS,this)}__preload(){this.validateRequiredComponents()}validateRequiredComponents(){if(!this.confettiEmitter)throw new Error("PaperConfetti: ConfettiEmitter not found");if(!this.ribbonEmitter)throw new Error("PaperConfetti: RibbonEmitter not found")}runEffect(){this.scheduleOnce((()=>{this.confettiEmitter.runEffect(25,this.spawnLeftPos,this.spawnRightPos)}),.2),this.ribbonEmitter.runEffect(20,this.spawnLeftPos,this.spawnRightPos)}clearEffect(){this.unscheduleAllCallbacks(),this.confettiEmitter.clearEffect(),this.ribbonEmitter.clearEffect()}}).prototype,"confettiEmitter",[GS],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),KS=ve(qS.prototype,"ribbonEmitter",[HS],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),VS=qS))||VS);var $S;i._RF.pop(),i._RF.push({},"4a9beTdMntC0q9yngb8a2go","BootScene",void 0);const{ccclass:JS,disallowMultiple:QS}=a,{Events:ZS,Configs:ev,Utils:{Time:tv,Valid:iv}}=GameCore,{ads:nv,player:av,event:sv}=globalThis.game;JS("BootScene")($S=QS($S=class extends s{constructor(){super(...arguments),this.processWhenGameSdkStarted=()=>{this.setupGameData()},this.processPreloadAssets=()=>{this.loadCurrentPlayerTheme().catch((e=>console.error("loadCurrentPlayerTheme",e)))},this.handleShowAdWhenLoadGame=async()=>{const{Enabled:e,ShowAdOnLoad:t}=ev.Ads;if(!e)return;const{Enabled:i,DelaySeconds:n,PlacementId:a}=t;if(i)try{n>0&&await tv.sleepAsync(1e3*n);const e=nv.getAdByPlacementId(a);if(!e)return;await this.showAdWhenLoadGame(e)}catch(e){console.warn("handleShowAdWhenLoadGame failed",e)}finally{Rg.preloadAds()}},this.handlePauseAudio=()=>{sv.on(ZS.VISIBILITY_HIDDEN,this.handleMuteAudio),sv.on(ZS.VISIBILITY_VISIBLE,this.handleUnMuteAudio),sv.on(ZS.VISIBILITY_VISIBLE,this.handleForceEngineRunning)},this.handleMuteAudio=()=>{Xi.muteAudio(!0)},this.handleUnMuteAudio=()=>{nv.isAdFullSizeShowing()||Xi.muteAudio(!1)},this.handleForceEngineRunning=()=>{m.resume()}}__preload(){this.setupAndroidPlatformAds(),this.processCrazyGamesLoadingStart(),this.validateRequiredComponents(),this.listenEvents()}validateRequiredComponents(){Fe.lazyValidateProperties(this)}onLoad(){this.handlePauseAudio(),this.processPreloadAssets(),ev.Core.StartSDKAfterLoadGame||Wl.showLoadingFullScreen(Fr)}start(){this.processCrazyGamesLoadingStop()}listenEvents(){sv.once(ZS.GAME_SDK_STARTED,this.processWhenGameSdkStarted),sv.once(ZS.GAME_READY,this.handleShowAdWhenLoadGame)}setupGameData(){const e=av.getGameData();if(!e)return;const{totalLevel:t}=e,i={...e,totalLevel:0===t?80:t};av.setGameData(i)}loadCurrentPlayerTheme(){const e=Jr.mapOrder;let t=e[0];const i=av.getGameData();console.log("loadCurrentPlayerTheme",i);let n=i?.level;if(!iv.isNumber(n))return hi.loadThemeAsync(t.theme);for(const i of e)if(n-=i.levelCount,n<=0){t=i;break}return hi.loadThemeAsync(t.theme)}async showAdWhenLoadGame(e){try{const{type:t,placementId:i}=e;await nv.loadAdAsync(t,i),Xi.muteAudio(!0),await nv.showAdAsync(t,i)}catch(e){console.warn("showAdWhenLoadGame failed",e)}finally{Xi.muteAudio(!1)}}processCrazyGamesLoadingStart(){"gameLoadingStart"in GameSDK.extra&&GameSDK.extra.gameLoadingStart()}processCrazyGamesLoadingStop(){"gameLoadingStop"in GameSDK.extra&&GameSDK.extra.gameLoadingStop()}setupAndroidPlatformAds(){}})||$S);var ov,rv,lv,cv,hv,dv,uv,pv,mv,gv,yv;i._RF.pop(),i._RF.push({},"29f874DL75LO5NzzNYZvHDh","RigidBodyObject",void 0);const{ccclass:bv,property:fv}=a;let wv=(ov=bv("RigidBodyObject"),rv=fv(E),lv=fv(J),cv=fv(E),hv=fv(H),ov((pv=ve((uv=class extends s{constructor(){super(...arguments),e(this,"gravityScale",pv,this),e(this,"linearVelocity",mv,this),e(this,"bounce",gv,this),e(this,"simulate",yv,this)}onLoad(){this.canvas=this.node.scene.getComponentInChildren(r).getComponent(l),this.uiTransform=this.node.getComponent(l)}update(e){if(!this.simulate)return;this.applyGravity();let t=this.node.worldPosition.clone();t.add(new j(this.linearVelocity.x*e,this.linearVelocity.y*e,0)),t=this.applyBounce(t),this.node.setWorldPosition(t)}applyForce(e){this.linearVelocity.add(e)}applyGravity(){const e=new J(0,-9.8*this.gravityScale);this.applyForce(e)}applyBounce(e){const t=this.uiTransform.getBoundingBoxToWorld();t.yMin<0&&(e.y=t.height/2,this.linearVelocity.y*=-this.bounce),t.xMin<0&&(e.x=t.width/2,this.linearVelocity.x*=-1);const i=this.canvas.width;return t.xMax>i&&(e.x=i-t.width/2,this.linearVelocity.x*=-1),e}}).prototype,"gravityScale",[rv],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),mv=ve(uv.prototype,"linearVelocity",[lv],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new J(0,0)}}),gv=ve(uv.prototype,"bounce",[cv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),yv=ve(uv.prototype,"simulate",[hv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),dv=uv))||dv);var Sv,vv,Cv,Ev,Tv,Av,Rv,Iv,Pv;i._RF.pop(),i._RF.push({},"93d88BQCU5B0L/TmaCaYNfm","AnimSkipOverlay",void 0);const{ccclass:_v,property:Lv,disallowMultiple:Dv}=a,Ov=()=>{};let Nv=(Sv=_v("AnimSkipOverlay"),vv=Lv(x),Cv=Lv(x),Ev=Lv(p),Sv(Tv=Dv((Rv=ve((Av=class extends s{constructor(){super(...arguments),e(this,"containerUIOpacity",Rv,this),e(this,"maskUIOpacity",Iv,this),e(this,"skipButton",Pv,this),this.isOpened=!1,this.currentCallback=Ov}__preload(){this.validateRequiredComponents(),this.containerUIOpacity.node.active=!1,this.skipButton.interactable=!1}onSkipButtonPress(){this.currentCallback(),this.close()}validateRequiredComponents(){Fe.lazyValidateProperties(this)}async open(e){this.containerUIOpacity.node.active=!0;const{onSkip:t,opacity:i=255,transitionDuration:n=.2}=e;this.maskUIOpacity.opacity=i,await this.animateUIOpacity(0,255,n),this.currentCallback=t,this.skipButton.interactable=!0,this.isOpened=!0,this.node.scene.emit(Jn,e)}async close(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.2;this.skipButton.interactable=!1,this.currentCallback=Ov,await this.animateUIOpacity(255,0,e),this.maskUIOpacity.opacity=0,this.containerUIOpacity.node.active=!1,this.isOpened=!1,this.node.scene.emit(Qn)}animateUIOpacity(e,t,i){return this.containerUIOpacity.opacity=e,vt.runTweenAsync(C(this.containerUIOpacity).to(i,{opacity:t}))}untilClosed(){return!1===this.isOpened?Promise.resolve():new Promise((e=>{this.node.scene.once(Qn,e)}))}}).prototype,"containerUIOpacity",[vv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Iv=ve(Av.prototype,"maskUIOpacity",[Cv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Pv=ve(Av.prototype,"skipButton",[Ev],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Tv=Av))||Tv)||Tv);var Mv,kv,xv,Fv,Bv,zv,Uv,Gv,Hv;i._RF.pop(),i._RF.push({},"755d1r2cMRLvo4fObNWxss/","CoinContainer",void 0);const{ccclass:Vv,property:qv}=a,{Utils:{Number:Wv}}=GameCore;let Kv=(Mv=Vv("CoinContainer"),kv=qv(h),xv=qv(R),Fv=qv(x),Mv((Uv=ve((zv=class extends s{constructor(){super(...arguments),e(this,"coinLabel",Uv,this),e(this,"coinIcon",Gv,this),e(this,"explosionCircle",Hv,this),this.currentCoin=0}setCoinText(e){this.coinLabel.string=e}handleAddCoinButton(){Wl.openScreen(Hi.GET_COIN_SCREEN,{quantity:Er})}onLoad(){this.validateRequiredComponents(),this.listenToEvents()}validateRequiredComponents(){Fe.lazyValidateProperties(this)}listenToEvents(){this.node.scene.on(Ha.COIN_CHANGED,this.updateCoins,this)}async updateCoins(e){const{coins:t,collectionAnimation:i}=e;if(void 0===i||!1===this.node.activeInHierarchy)return void this.setCoins(t);const{signal:n}=i;if(this.animAbortSignal?.abort(),this.animAbortSignal=n??new oi,i.animateTextOnly)return await this.animateCoinText(t,0,n),void this.setCoins(t);const a=i.flyDuration,s=i.floatDuration+a;await this.animateCoinText(t,s,n),this.setCoins(t)}setCoins(e){this.setCoinText(Wv.getShortNumber(e,3)),this.currentCoin=e}async animateCoinText(e,t,i){const n=this.currentCoin;await vt.waitTweenAsync(t,i),Xi.playSound(Bi.COLLECT_COINS),await vt.runOnUpdateAsync(this.node,1,(t=>{const i=Math.round(n+(e-n)*t);this.setCoinText(Wv.getShortNumber(i,3))}),i)}async emitExplodeEffect(e){this.explosionCircle.opacity=255,this.explosionCircle.node.setScale(0,0),await Promise.all([vt.runTweenAsync(C(this.explosionCircle.node).to(.4,{scale:new j(3,3,3)},{easing:"quadOut"}),e),vt.runTweenAsync(C(this.explosionCircle).delay(.2).to(.2,{opacity:0}),e)]),this.explosionCircle.node.setScale(0,0),this.explosionCircle.opacity=0}getCoinIconWorldPosition(){return this.coinIcon.node.worldPosition}getCoinIconWorldScale(){return this.coinIcon.node.worldScale}onDestroy(){this.animAbortSignal?.abort()}}).prototype,"coinLabel",[kv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Gv=ve(zv.prototype,"coinIcon",[xv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Hv=ve(zv.prototype,"explosionCircle",[Fv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Bv=zv))||Bv);var Yv,jv,Xv,$v,Jv,Qv,Zv,eC,tC,iC,nC,aC,sC,oC,rC,lC,cC;i._RF.pop(),i._RF.push({},"a1833nGls5Ac4p0tpu/jEqi","ItemContainer",void 0);const{ccclass:hC,property:dC}=a,{player:uC}=globalThis.game,pC=[1e3,1500];Yv=hC("ItemContainer"),jv=dC({type:n,group:"Hint"}),Xv=dC({type:h,group:"Hint"}),$v=dC({type:n,group:"Thunder"}),Jv=dC({type:h,group:"Thunder"}),Qv=dC({type:n,group:"Storm"}),Zv=dC({type:h,group:"Storm"}),eC=dC(_),Yv((nC=ve((iC=class extends s{constructor(){super(...arguments),e(this,"hintNode",nC,this),e(this,"hintLabel",aC,this),this.hintCollection=[],e(this,"thunderNode",sC,this),e(this,"thunderLabel",oC,this),this.thunderCollection=[],e(this,"stormNode",rC,this),e(this,"stormLabel",lC,this),this.stormCollection=[],e(this,"itemPrefab",cC,this)}onLoad(){this.canvas=this.node.scene.getComponentInChildren(r).node,this.widget=this.getComponent(A),this.defaultRightWidget=this.widget.right,this.uiOpacity=this.getComponent(x),this.validateRequiredComponents(),this.listenToEvents()}start(){this.prepareItemCollection()}validateRequiredComponents(){Fe.lazyValidateProperties(this)}listenToEvents(){this.node.scene.on(Ha.ADD_ITEMS,this.handleAddItems,this)}prepareItemCollection(){for(let e=0;e<9;e++){const e=c(this.itemPrefab),t=c(this.itemPrefab),i=c(this.itemPrefab);e.parent=this.canvas,t.parent=this.canvas,i.parent=this.canvas,e.active=!1,t.active=!1,i.active=!1,this.hintCollection.push(e.getComponent(wv)),this.thunderCollection.push(t.getComponent(wv)),this.stormCollection.push(i.getComponent(wv))}}updateStatus(e){const{items:t}=e;this.hintLabel.string=`${t.hint}`,this.thunderLabel.string=`${t.thunder}`,this.stormLabel.string=`${t.storm}`}async show(){this.uiOpacity.opacity=255;const e=C(this.widget).to(1.5,{right:0},{easing:"quadOut"});await vt.runTweenAsync(e,this.animAbortSignal),this.widget.right=0}async hide(){const e=C(this.widget).to(1,{right:this.defaultRightWidget},{easing:"quadIn"});await vt.runTweenAsync(e),this.uiOpacity.opacity=0}async handleAddItems(e){this.animAbortSignal=e.signal??new oi;const t=uC.getGameData();if(!t)return;this.updateStatus(t);const i=this.show(),n=e.items.map((e=>this.animateItemCollection(e.item,e.quantity,1.5)));await Promise.all([i,...n]),t.items={...t.items,hint:t.items.hint+e.items[0].quantity,thunder:t.items.thunder+e.items[1].quantity,storm:t.items.storm+e.items[2].quantity},uC.setGameData(t),this.updateStatus(t),await this.hide()}async animateItemCollection(e,t,i){const n=this.getItemCollection(e).slice(0,t);if(0===n.length)return;const a=n.map(((t,n)=>{t.node.active=!0,t.node.position=new j(0,0,t.node.position.z),t.linearVelocity=new J(0,0),t.simulate=!0;const a=ne(Math.PI/3,2*Math.PI/3),s=ne(pC[0],pC[1])*Math.cos(a),o=ne(pC[0],pC[1])*Math.sin(a);t.applyForce(new J(s,o));const r=this.getTargetNode(e);if(r)return t.getComponent(R).spriteFrame=r.getComponent(R).spriteFrame,this.getItemAnimation(t,r,i+.03*n)}));await Promise.all(a)}getItemCollection(e){switch(e){case"hint":return this.hintCollection;case"thunder":return this.thunderCollection;case"storm":return this.stormCollection;default:return[]}}getTargetNode(e){switch(e){case"hint":return this.hintNode;case"thunder":return this.thunderNode;case"storm":return this.stormNode;default:return null}}async getItemAnimation(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;e.node.scale=new j(2,2,2),await vt.waitTweenAsync(i,this.animAbortSignal);const n=e.node.worldPosition.clone(),a=C(e.node).to(1,{scale:t.scale},{onUpdate:(i,a)=>{if(!i||!a)return;const s=k.cubicIn(a);t&&(e.node.worldPosition=n.lerp(t.worldPosition,s))},onComplete:()=>{e.node.setPosition(0,0),e.node.active=!1}});await vt.runTweenAsync(a,this.animAbortSignal),e.node.scale=t.scale.clone(),e.node.setPosition(0,0),e.node.active=!1}onDestroy(){this.animAbortSignal?.abort()}}).prototype,"hintNode",[jv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),aC=ve(iC.prototype,"hintLabel",[Xv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),sC=ve(iC.prototype,"thunderNode",[$v],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),oC=ve(iC.prototype,"thunderLabel",[Jv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),rC=ve(iC.prototype,"stormNode",[Qv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),lC=ve(iC.prototype,"stormLabel",[Zv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),cC=ve(iC.prototype,"itemPrefab",[eC],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),tC=iC));var mC,gC,yC,bC,fC,wC,SC,vC,CC,EC,TC,AC,RC,IC,PC,_C,LC,DC,OC,NC,MC;i._RF.pop(),i._RF.push({},"ba822axo49BibgkqkEhhqVp","DashboardPage",void 0);const{ccclass:kC,property:xC,disallowMultiple:FC,requireComponent:BC}=a;let zC=(mC=kC("DashboardPage"),gC=BC(A),yC=BC(x),bC=xC({type:n,displayName:"Page's container"}),fC=xC({type:n,displayName:"Placeholder"}),wC=xC({displayName:"Don't load page",tooltip:"Tell the component to not preload the page even if it hasn't loaded yet"}),SC=xC({type:_,displayName:"Page prefab",visible:function(){return!this.hasLoaded}}),vC=xC({displayName:"Darken background"}),CC=xC({type:f,min:0,max:255,displayName:"Background opacity",visible:function(){return this.darkenBackground}}),EC=xC({displayName:"Use navbar shadow"}),TC=xC({type:f,min:0,max:255,displayName:"Navbar shadow opacity",visible:function(){return this.useNavbarShadow}}),mC(AC=FC(AC=gC(AC=yC((IC=ve((RC=class extends s{constructor(){super(...arguments),e(this,"container",IC,this),e(this,"placeholder",PC,this),e(this,"hasLoaded",_C,this),e(this,"pagePrefab",LC,this),e(this,"darkenBackground",DC,this),e(this,"backgroundOpacity",OC,this),e(this,"useNavbarShadow",NC,this),e(this,"navbarShadowOpacity",MC,this)}onLoad(){this.containerUIOpacity=this.container.getComponent(x),this.placeholderUIOpacity=this.placeholder.getComponent(x),this.widgetComponent=this.node.getComponent(A),this.uiOpacity=this.node.getComponent(x),this.validateRequiredComponents();const e=this.container.getComponent(T);this.layoutComponents=e?[e]:[],this.widgetComponents=[this.widgetComponent,...this.container.getComponentsInChildren(A)]}start(){this.container.active=!0,this.placeholder.active=!0}getWidget(){return this.widgetComponent}updateWidgets(){this.widgetComponents.forEach((e=>{e.updateAlignment()}))}updateLayouts(){this.layoutComponents.forEach((e=>{e.updateLayout()}))}show(){this.uiOpacity.opacity=255}hide(){this.uiOpacity.opacity=0}async mount(){this.hasLoaded||await this.create(),this.placeholderUIOpacity.opacity=0,this.containerUIOpacity.opacity=255,ji.trackCurrentPage(this.node.name,!0)}unmount(){255===this.placeholderUIOpacity.opacity&&0===this.containerUIOpacity.opacity||(this.placeholderUIOpacity.opacity=255,this.containerUIOpacity.opacity=0)}transitionIn(){return Promise.resolve()}transitionOut(){return Promise.resolve()}hasLoadedPage(){return this.hasLoaded}getContainer(){return this.container}getDarkenBackground(){return this.darkenBackground?this.backgroundOpacity:0}getNavbarShadow(){return this.useNavbarShadow?this.navbarShadowOpacity:0}async create(){if(!this.pagePrefab)return;if(this.hasLoaded)return;const e=c(this.pagePrefab),t=e.getComponentsInChildren(A);this.widgetComponents.push(...t);const i=e.getComponentsInChildren(T);this.layoutComponents.push(...i),this.container.addChild(e),await vt.waitTweenAsync(0),this.hasLoaded=!0}validateRequiredComponents(){Fe.lazyValidateProperties(this)}}).prototype,"container",[bC],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),PC=ve(RC.prototype,"placeholder",[fC],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_C=ve(RC.prototype,"hasLoaded",[wC],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),LC=ve(RC.prototype,"pagePrefab",[SC],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),DC=ve(RC.prototype,"darkenBackground",[vC],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),OC=ve(RC.prototype,"backgroundOpacity",[CC],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 150}}),NC=ve(RC.prototype,"useNavbarShadow",[EC],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),MC=ve(RC.prototype,"navbarShadowOpacity",[TC],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 150}}),AC=RC))||AC)||AC)||AC)||AC);var UC,GC,HC,VC,qC,WC,KC,YC,jC,XC,$C;i._RF.pop(),i._RF.push({},"18bbbp5z2VHVKp4jjjmsAhu","ThemeProgressBar",void 0);const{ccclass:JC,property:QC}=a;let ZC=(UC=JC("ThemeProgressBar"),GC=QC(n),HC=QC(n),VC=QC(n),qC=QC(n),UC((YC=ve((KC=class extends s{constructor(){super(...arguments),e(this,"progressBar",YC,this),e(this,"progressText",jC,this),e(this,"leftCap",XC,this),e(this,"rightCap",$C,this)}onLoad(){this.validateRequiredComponents()}validateRequiredComponents(){if(!this.progressBar)throw new Error("ThemeProgressBar: progressBar not found");if(!this.progressText)throw new Error("ThemeProgressBar: progressText not found");if(!this.leftCap)throw new Error("ThemeProgressBar: leftCap not found");if(!this.rightCap)throw new Error("ThemeProgressBar: rightCap not found")}setProgress(e,t){e<=0?(this.leftCap.active=!1,this.rightCap.active=!1):(this.leftCap.active=!0,this.rightCap.active=!0);const i=this.progressBar.getComponent(X);if(!i)throw new Error("ThemeProgressBar: progressBarComponent not found");i.progress=e/t;const n=this.progressText.getComponent(h);if(!n)throw new Error("ThemeProgressBar: progressTextComponent not found");n.string=`${e}/${t}`}}).prototype,"progressBar",[GC],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),jC=ve(KC.prototype,"progressText",[HC],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),XC=ve(KC.prototype,"leftCap",[VC],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),$C=ve(KC.prototype,"rightCap",[qC],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),WC=KC))||WC);var eE,tE,iE,nE,aE,sE,oE,rE,lE,cE,hE,dE,uE,pE,mE;i._RF.pop(),i._RF.push({},"e62f9TdkTxOyJy6vcnplnCB","LockAnimator",void 0);const{ccclass:gE,disallowMultiple:yE,property:bE}=a,fE=[50,160];let wE=(eE=gE("LockAnimator"),tE=bE(se),iE=bE(y),nE=bE(D),aE=bE(D),sE=bE(Lo),oE=bE({type:f,min:0}),eE(rE=yE((cE=ve((lE=class extends s{constructor(){super(...arguments),e(this,"floatingParticles",cE,this),e(this,"iconAnimation",hE,this),e(this,"lockClip",dE,this),e(this,"unlockClip",uE,this),e(this,"trailTemplate",pE,this),e(this,"trailCount",mE,this),this.trails=[]}onLoad(){this.validateRequiredComponents(),this.prepareTrails(),this.floatingParticles.node.active=!1}async unlock(e){this.floatingParticles.node.active=!0,this.floatingParticles.resetSystem(),await this.playAnimation(this.unlockClip.name,e),this.floatingParticles.stopSystem()}fireExplosionParticles(){this.explodeTrails()}lock(){this.playAnimation(this.lockClip.name),this.floatingParticles.node.active&&this.floatingParticles.stopSystem()}explodeTrails(){return Promise.all(this.trails.map((e=>vt.runTweenAsync(this.getExplodeTrail(e)))))}getExplodeTrail(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const i=ne(0,2*Math.PI),n=ne(fE[0],fE[1])*Math.cos(i),a=ne(fE[0],fE[1])*Math.sin(i),s=new j(n,a,e.node.position.z),o=e.node.scale.clone();return C(e.node).delay(t).call((()=>{e.node.setPosition(0,0),e.reset(),e.node.active=!0})).to(.5,{position:s.clone()},{easing:"expoOut"}).to(.5,{scale:new j(0,0,1)},{easing:"expoIn"}).call((()=>{e.node.setPosition(0,0),e.node.scale=o,e.reset(),e.node.active=!1}))}prepareTrails(){this.trailTemplate.node.active=!1;for(let e=0;e<this.trailCount;e++){const e=c(this.trailTemplate.node);e.setParent(this.node),e.active=!1,this.trails.push(e.getComponent(Lo))}}validateRequiredComponents(){Fe.lazyValidateProperties(this)}async playAnimation(e,t){return t&&t?.aborted?Promise.resolve():new Promise((i=>{this.iconAnimation.once(y.EventType.FINISHED,(()=>{i()})),t?.addAbortListener((()=>{this.iconAnimation.off(y.EventType.FINISHED),this.iconAnimation.stop(),i()})),this.iconAnimation.play(e)}))}}).prototype,"floatingParticles",[tE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),hE=ve(lE.prototype,"iconAnimation",[iE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),dE=ve(lE.prototype,"lockClip",[nE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),uE=ve(lE.prototype,"unlockClip",[aE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),pE=ve(lE.prototype,"trailTemplate",[sE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),mE=ve(lE.prototype,"trailCount",[oE],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),rE=lE))||rE)||rE);var SE,vE,CE,EE,TE,AE,RE,IE,PE,_E,LE,DE,OE,NE,ME,kE,xE,FE,BE,zE,UE,GE;i._RF.pop(),i._RF.push({},"aef0d6qo8hNUJ7qNl2wuT29","ThemeBlock",void 0);const{ccclass:HE,property:VE}=a,qE={progress:0,max:10,isLocked:!0,themeId:tl.SUMMER,skin:el};let WE=(SE=HE("ThemeBlock"),vE=VE(n),CE=VE(x),EE=VE(n),TE=VE(x),AE=VE(wE),RE=VE(n),IE=VE(R),PE=VE([R]),_E=VE(h),LE=VE(H),SE((NE=ve((OE=class extends s{constructor(){super(...arguments),e(this,"mask",NE,this),e(this,"nodeUIOpacity",ME,this),e(this,"progressBar",kE,this),e(this,"backgroundUI",xE,this),e(this,"lockAnimator",FE,this),e(this,"themeLoadingRing",BE,this),e(this,"themeSprite",zE,this),e(this,"tileBlockIconSprite",UE,this),e(this,"titleLabel",GE,this),this.visibilityTween=null,this.isVisible=!1,this.payload=qE}set isLocked(e){this.payload.isLocked=e,this.updateThemeBlockDisplay()}get isLocked(){return this.payload.isLocked}getSkinName(){return this.payload.skin}__preload(){this.uiTransform=this.getComponent(l),this.validateRequiredComponents()}validateRequiredComponents(){Fe.lazyValidateProperties(this)}updateThemeBlockDisplay(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:qE;this.payload=e;const{progress:t,max:i,isLocked:n,themeId:a,skin:s}=e;this.updateTitle(a),this.updateSkinAsync(s),this.updateThemeAsync(a);const o=this.progressBar.getComponent(ZC);if(!o)throw new Error("ThemeBlock: progressBarComponent not found");this.mask.active=n,this.progressBar.active=!n,this.lockAnimator.node.active=n,n||o.setProgress(t,i)}async playUnlockAnim(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:qE;this.payload={...t,isLocked:!1};const{progress:i,max:n}=t,a=this.progressBar.getComponent(ZC);if(!a)throw new Error("ThemeBlock: progressBarComponent not found");this.mask.active=!0,this.progressBar.active=!1,this.lockAnimator.node.active=!0,a.setProgress(i,n),await this.animateUnlockedState(e)}updateTitle(e){switch(e){case tl.SUMMER:this.titleLabel.string="Summer";break;case tl.WINTER:this.titleLabel.string="Winter";break;case tl.AUTUMN:this.titleLabel.string="Autumn"}}async updateSkinAsync(e){const t=await hi.loadSkinPreviewAsync(e);this.tileBlockIconSprite&&t.forEach(((e,t)=>{e&&(this.tileBlockIconSprite[t].spriteFrame=e)}))}async updateThemeAsync(e){const t=await hi.loadThemePreviewAsync(e);this.themeSprite&&t&&(this.themeSprite.spriteFrame=t,this.themeLoadingRing&&(this.themeLoadingRing.active=!1))}async animateUnlockedState(e){const t=this.mask.getComponent(x),i=this.progressBar.getComponent(x);if(!t)throw new Error("ThemeBlock: maskUIOpacity not found");if(!i)throw new Error("ThemeBlock: progressBarUIOpacity not found");this.mask.active=!0,t.opacity=t.opacity??255,this.progressBar.active=!0,i.opacity=0,await this.lockAnimator.unlock(e),this.lockAnimator.node.active=!1,await Promise.all([vt.runTweenAsync(C(t).to(.25,{opacity:0}),e),vt.runTweenAsync(C(i).to(.25,{opacity:255}),e)]),this.mask.active=!1,t.opacity=0,i.opacity=255}getUITransform(){return this.uiTransform}setVisible(e){this.isVisible!==e&&(this.isVisible=e,this.visibilityTween?.stop(),this.visibilityTween=C(this.nodeUIOpacity).to(.05,{opacity:e?255:0}).start())}}).prototype,"mask",[vE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ME=ve(OE.prototype,"nodeUIOpacity",[CE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),kE=ve(OE.prototype,"progressBar",[EE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),xE=ve(OE.prototype,"backgroundUI",[TE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),FE=ve(OE.prototype,"lockAnimator",[AE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),BE=ve(OE.prototype,"themeLoadingRing",[RE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),zE=ve(OE.prototype,"themeSprite",[IE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),UE=ve(OE.prototype,"tileBlockIconSprite",[PE],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),GE=ve(OE.prototype,"titleLabel",[_E],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ve(OE.prototype,"isLocked",[LE],Object.getOwnPropertyDescriptor(OE.prototype,"isLocked"),OE.prototype),DE=OE))||DE);var KE,YE,jE,XE,$E,JE,QE,ZE,eT,tT,iT;i._RF.pop(),i._RF.push({},"b3a4dy5XgpIT6stybzgYjnu","CollectionsContent",void 0);const{ccclass:nT,property:aT}=a,{storage:sT}=globalThis.game,{Array:oT}=GameCore.Utils;let rT=(KE=nT("CollectionsContent"),YE=aT(ps),jE=aT(ce),XE=aT(Wn),$E=aT({type:E,displayName:"Offset from top of scroll view",tooltip:"The offset between the first theme tab and the top of the scroll view"}),KE((ZE=ve((QE=class extends s{constructor(){super(...arguments),this.animateThemeTabUnlock=null,e(this,"panelAnimator",ZE,this),e(this,"themeScrollView",eT,this),e(this,"contentOpacity",tT,this),this.themeBlocks=[],this.preservedScrollPosition=new J,e(this,"offsetFromTopOfScrollView",iT,this),this.updateBlocksVisibility=()=>{const{yMax:e,yMin:t}=this.uiTransform.getBoundingBoxToWorld();this.themeBlocks.forEach((i=>{const n=i.getUITransform(),{yMax:a,yMin:s}=n.getBoundingBoxToWorld(),o=a<t||s>e;i.setVisible(!o)}))},this.hideContent=()=>{this.contentOpacity.changeStateFade(!1,.1)},this.showContent=()=>{this.contentOpacity.changeStateFade(!0,.1)}}__preload(){this.uiTransform=this.getComponent(l),this.themeBlocks=this.themeScrollView.content?.getComponentsInChildren(WE)??[],this.validateRequiredComponents()}listenEvents(){this.themeScrollView.node.on(ce.EventType.SCROLLING,this.updateBlocksVisibility),this.node.scene.on(Ha.HIDE_UI,this.hideContent),this.node.scene.on(Ha.SHOW_UI,this.showContent)}unlistenEvents(){this.themeScrollView.node.off(ce.EventType.SCROLLING,this.updateBlocksVisibility),this.unlistenUIEvents()}unlistenUIEvents(){this.node.scene.off(Ha.HIDE_UI,this.hideContent),this.node.scene.off(Ha.SHOW_UI,this.showContent)}init(e){if(0===e.length)return;this.getThemeTabs().forEach(((t,i)=>t.updateThemeBlockDisplay(e[i])))}preserveScrollPosition(){this.themeScrollView.stopAutoScroll(),this.preservedScrollPosition.set(this.themeScrollView.getScrollOffset())}restoreScrollPosition(){this.themeScrollView.scrollToOffset(this.preservedScrollPosition,0)}updateUnlockedProgress(e){const t=sT.getStorageData("collection","animateMapPackUnlock"),i=sT.getStorageData("collection","lastMapPack");e.forEach(((e,n)=>{const{skin:a,progress:s,max:o,isLocked:r}=e;if(s<o&&!r&&t&&i!==n+1)return this.animateThemeTabUnlock=e,sT.setStorageData("collection","animateMapPackUnlock",!1),sT.setStorageData("collection","lastMapPack",n+1),void this.setProgressToThemeTab(a,{...e,isLocked:!0});this.setProgressToThemeTab(a,e)}))}shouldAnimateThemeTabUnlock(){return null!==this.animateThemeTabUnlock}async playThemeTabUnlockAnim(e){if(!this.animateThemeTabUnlock)return;const t=this.findThemeTab(this.animateThemeTabUnlock.skin);if(void 0===t)throw new Error("CollectionsContent: ThemeTab not found");await t.playUnlockAnim(e,{...this.animateThemeTabUnlock,isLocked:!0}),this.animateThemeTabUnlock=null}async scrollToCurrentUnlockingTheme(e,t){const i=this.findThemeTab(e);if(!i)return;const{y:n}=i.node.position,a=-n-this.offsetFromTopOfScrollView;await this.scrollToOffset(new J(0,a),2,t)}async scrollToOffset(e,t,i){this.themeScrollView.scrollToOffset(e,t),await vt.waitTweenAsync(t,i),i.aborted&&(this.themeScrollView.stopAutoScroll(),this.themeScrollView.scrollToOffset(e,0))}setProgressToThemeTab(e,t){const i=this.findThemeTab(e);if(void 0===i)throw new Error("CollectionsContent: ThemeTab not found");i.updateThemeBlockDisplay(t)}findThemeTab(e){return oT.search(this.getThemeTabs(),(t=>t.getSkinName()===e))}getThemeTabs(){return this.themeScrollView.content.getComponentsInChildren(WE)}enableUIAnimator(){this.panelAnimator.enabled=!0}disableUIAnimator(){this.panelAnimator.enabled=!1}validateRequiredComponents(){Fe.lazyValidateProperties(this)}}).prototype,"panelAnimator",[YE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),eT=ve(QE.prototype,"themeScrollView",[jE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),tT=ve(QE.prototype,"contentOpacity",[XE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),iT=ve(QE.prototype,"offsetFromTopOfScrollView",[$E],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 407.5}}),JE=QE))||JE);var lT;i._RF.pop(),i._RF.push({},"dab8cbliOBAeZ7iVs959mBm","CollectionsPage",void 0);const{ccclass:cT}=a;let hT=cT("CollectionsPage")(lT=class extends zC{constructor(){super(...arguments),this.payload=null}setPayload(e){this.payload=e}async mount(){if(!this.pagePrefab){const e=await hi.loadPrefabAsync(ri.COLLECTIONS_PAGE);e&&this.node&&(this.pagePrefab=e)}if(await super.mount(),this.containerUIOpacity.opacity=0,!this.themeContent&&(this.themeContent=this.container.getComponentInChildren(rT),!this.themeContent))throw new Error("No theme content found");this.payload&&this.themeContent.init(this.payload)}async transitionIn(){await super.transitionIn(),this.themeContent.restoreScrollPosition(),this.themeContent.updateBlocksVisibility(),this.themeContent.enableUIAnimator(),this.themeContent.listenEvents();const e=vt.runTweenAsync(C(this.containerUIOpacity).to(.2,{opacity:255})),t=new Promise((e=>{this.node.scene.emit(Ha.SHOW_UI,{onComplete:()=>{e()}})}));await Promise.all([e,t])}async transitionOut(){await super.transitionOut(),this.themeContent.preserveScrollPosition(),this.themeContent.unlistenUIEvents(),await new Promise((e=>{this.node.scene.emit(Ha.HIDE_UI,{onComplete:()=>{e()}})})),this.themeContent.disableUIAnimator(),this.themeContent.unlistenEvents()}})||lT;var dT,uT,pT,mT,gT,yT,bT,fT,wT,ST,vT,CT,ET,TT,AT,RT,IT,PT,_T,LT,DT,OT,NT,MT,kT,xT,FT;i._RF.pop(),i._RF.push({},"2381b1mKt1PUq5W+fsaaOYP","PageManager",void 0);const{ccclass:BT,property:zT,disallowMultiple:UT,requireComponent:GT}=a,{Array:HT}=GameCore.Utils;let VT=(dT=BT("PageManagerItem"),uT=zT(zC),pT=zT({type:M(ai)}),dT((yT=ve((gT=class{constructor(){e(this,"page",yT,this),e(this,"pageType",bT,this)}}).prototype,"page",[uT],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),bT=ve(gT.prototype,"pageType",[pT],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),mT=gT))||mT),qT=(fT=BT("PageManager"),wT=GT(l),ST=zT({type:x,displayName:"Background Mask",group:"Background Mask"}),vT=zT({type:E,displayName:"Transition duration",group:"Background Mask"}),CT=zT({type:E,displayName:"Transition delay",group:"Background Mask"}),ET=zT({type:x,displayName:"Nav Bar Shadow",group:"Nav Bar Shadow"}),TT=zT({type:E,displayName:"Transition duration",group:"Nav Bar Shadow"}),AT=zT({type:E,displayName:"Transition delay",group:"Nav Bar Shadow"}),RT=zT({type:[VT]}),IT=zT({type:M(ai)}),fT(PT=UT(PT=wT((LT=ve((_T=class extends s{constructor(){super(...arguments),e(this,"backgroundMask",LT,this),e(this,"backgroundMaskTransitionDuration",DT,this),e(this,"backgroundMaskTransitionDelay",OT,this),e(this,"navBarShadow",NT,this),e(this,"navBarShadowTransitionDuration",MT,this),e(this,"navBarShadowTransitionDelay",kT,this),e(this,"pageItems",xT,this),e(this,"currentScreen",FT,this)}unmountAndHideAll(){this.pageItems.forEach((e=>{const{page:t,pageType:i}=e;i!==this.currentScreen&&(t.unmount(),t.hide())}))}onLoad(){this.uiTransform=this.getComponent(l),this.validateRequiredComponents()}updateCollectionsContentPayload(e){const t=this.getPage(ai.collections);t&&t instanceof hT&&t.setPayload(e)}async navigate(e,t,i){const{from:n,to:a}=e;if(null===n){const e=this.getPage(this.currentScreen);return e.show(),await e.mount(),await(t?.(e)),this.node.scene.emit(ii,{from:null,to:a}),await e.transitionIn(),await(i?.(e)),void(this.currentScreen=a)}if(n!==this.currentScreen)throw new Error("PageManager: Cannot navigate from a different screen. Perhaps you forgot to update the currentScreen property.");const s=this.getPage(this.currentScreen),o=this.getPage(a);if(!o||!s)throw new Error("PageManager: Cannot navigate to/from a null page. Perhaps you forgot to add the page to the pageItems array in the editor.");const r=this.uiTransform.width,l=this.getPageIndex(n),c=this.getPageIndex(a),h=Math.min(l,c),d=Math.max(l,c),u=(d-h)*r,p=l<c?1:-1,m=this.pageItems.slice(h,d+1);m.forEach(((e,t)=>{let{page:i}=e;i.show();i.getWidget().enabled=!1,i.node.position=new j((t+h-l)*r,i.node.position.y,i.node.position.z)}));let g=!1;o.hasLoadedPage()||(g=!0,Wl.showLoadingScreen(),await vt.waitTweenAsync(.5)),await o.mount(),await(t?.(o)),this.node.scene.emit(ii,{from:n,to:a}),await Promise.all([s.transitionOut(),this.transition(u,p,m),this.handleBackgroundMask(this.backgroundMaskTransitionDuration,o.getDarkenBackground()),this.handleNavBarShadow(this.navBarShadowTransitionDuration,o.getNavbarShadow())]);const y=o.getWidget();y.enabled=!0,y.left=0,y.right=0,o.updateWidgets(),o.updateLayouts(),m.forEach((e=>{e.pageType!==a&&(e.page.unmount(),e.page.hide())})),this.currentScreen=a,await o.transitionIn(),await(i?.(o)),g&&Wl.closeLoadingScreen()}getPage(e){const t=this.getPageIndex(e);return-1!==t?this.pageItems[t].page:null}async handleBackgroundMask(e,t){await vt.runTweenAsync(C(this.backgroundMask).delay(this.backgroundMaskTransitionDelay).to(e,{opacity:t}).start())}async handleNavBarShadow(e,t){await vt.runTweenAsync(C(this.navBarShadow).delay(this.navBarShadowTransitionDelay).to(e,{opacity:t}).start())}getPageIndex(e){return HT.searchIndex(this.pageItems,(t=>t.pageType===e))}async transition(e,t,i){await Promise.all(i.map((i=>{let{page:n}=i;return vt.runTweenAsync(C(n.node).to(.5,{position:new j(n.node.position.x-e*t,n.node.position.y,n.node.position.z)},{easing:k.quintInOut}))})))}validateRequiredComponents(){if(!this.uiTransform)throw new Error("PageManager requires UITransform component");if(!this.backgroundMask)throw new Error("PageManager requires background mask")}}).prototype,"backgroundMask",[ST],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),DT=ve(_T.prototype,"backgroundMaskTransitionDuration",[vT],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.5}}),OT=ve(_T.prototype,"backgroundMaskTransitionDelay",[CT],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.3}}),NT=ve(_T.prototype,"navBarShadow",[ET],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),MT=ve(_T.prototype,"navBarShadowTransitionDuration",[TT],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.5}}),kT=ve(_T.prototype,"navBarShadowTransitionDelay",[AT],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.3}}),xT=ve(_T.prototype,"pageItems",[RT],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),FT=ve(_T.prototype,"currentScreen",[IT],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return ai.home}}),PT=_T))||PT)||PT)||PT);var WT,KT,YT,jT,XT,$T,JT,QT,ZT,eA,tA,iA,nA;i._RF.pop(),i._RF.push({},"500274Qu9dAjJwYv27wMaMU","StarProgressBar",void 0);const{ccclass:aA,property:sA}=a;let oA=(WT=aA("StarProgressBar"),KT=sA(Hs),YT=sA(h),jT=sA(f),XT=sA(f),$T=sA(b),WT((ZT=ve((QT=class extends s{constructor(){super(...arguments),e(this,"progressBar",ZT,this),e(this,"progressLabel",eA,this),e(this,"current",tA,this),e(this,"total",iA,this),e(this,"separator",nA,this)}setRange(e,t){this.total=t,this.current=e,this.updateProgress()}onLoad(){this.validateRequiredComponents()}updateProgress(){this.progressBar.progress=Math.min(this.current,this.total)/this.total,this.updateProgressLabel()}updateProgressLabel(){this.progressLabel.string=`${this.current}${this.separator}${this.total}`}async animateTo(e,t,i){const n=Math.min(e,this.total)/this.total,a=this.current;let s=1;const o=C(this.progressBar).to(3,{progress:n},{easing:"quadOut",onUpdate:(t,n)=>{n&&(this.current=a+Math.floor((e-a)*n),i?.(this.current),this.current===a-s&&(s++,C(this.progressLabel.node).to(.05,{scale:new j(1.2,1.2,1.2)}).to(.05,{scale:j.ONE}).start()),this.updateProgressLabel())}});t?.addAbortListener((()=>{this.current=e,this.updateProgress()})),await vt.runTweenAsync(o,t)}validateRequiredComponents(){if(!this.progressBar)throw new Error("JourneyProgressBar: Missing required component TapperedProgressBar");if(!this.progressLabel)throw new Error("JourneyProgressBar: Missing required component Label")}}).prototype,"progressBar",[KT],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),eA=ve(QT.prototype,"progressLabel",[YT],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),tA=ve(QT.prototype,"current",[jT],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),iA=ve(QT.prototype,"total",[XT],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),nA=ve(QT.prototype,"separator",[$T],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),JT=QT))||JT);var rA,lA,cA,hA,dA,uA;i._RF.pop(),i._RF.push({},"83036ocqiZHXrI3Aq0dBJRD","EventButton",void 0);const{ccclass:pA,property:mA}=a;let gA=(rA=pA("EventButton"),lA=mA({type:M(vf)}),cA=mA(H),rA((uA=ve((dA=class extends Fn{constructor(){super(...arguments),e(this,"eventType",uA,this),this._isAvailable=!1}get isAvailable(){return this._isAvailable}set isAvailable(e){this._isAvailable=e,this.fakeClick()}handleClick(){this.node.scene.emit(ni,{type:this.eventType})}setAnimationState(e){this.animationController.setValue("RESET-SPECIAL",this._isAvailable),super.setAnimationState(e)}}).prototype,"eventType",[lA],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return vf.STAR_CHEST}}),ve(dA.prototype,"isAvailable",[cA],Object.getOwnPropertyDescriptor(dA.prototype,"isAvailable"),dA.prototype),hA=dA))||hA);var yA,bA,fA,wA,SA,vA,CA,EA,TA,AA,RA;i._RF.pop(),i._RF.push({},"87a11fQFYVFcphsqf5ivVof","DashboardHeader",void 0);const{ccclass:IA,property:PA}=a,{player:_A}=globalThis.game;let LA=(yA=IA("DashboardHeader"),bA=PA({type:oA,displayName:"Progress bar",group:"Star Chest"}),fA=PA({type:gA,displayName:"Button Component",group:"Star Chest"}),wA=PA({type:D,displayName:"Default Rest animation",group:"Star Chest"}),SA=PA({type:D,displayName:"Special Rest animation",group:"Star Chest"}),yA((EA=ve((CA=class extends s{constructor(){super(...arguments),e(this,"starProgressBar",EA,this),e(this,"chestButton",TA,this),e(this,"defaultRestAnimation",AA,this),e(this,"specialRestAnimation",RA,this),this.handleStarsUpdateEvent=e=>{void 0!==(e=e??_A.getGameData()?.stars)&&(this.starProgressBar.setRange(e,20),this.updateStarChestButtonAnimation(e))}}__preload(){this.validateRequiredComponents(),W.on(Zt,this.handleStarsUpdateEvent)}onDestroy(){W.off(Zt,this.handleStarsUpdateEvent)}updateStarProgress(e){this.handleStarsUpdateEvent(e)}updateStarChestButtonAnimation(e){this.chestButton.isAvailable=e>=20}validateRequiredComponents(){if(!this.starProgressBar)throw new Error("DashboardHeader: starProgressBar not found");if(!this.chestButton)throw new Error("DashboardHeader: chestButton not found");if(!this.defaultRestAnimation)throw new Error("DashboardHeader: defaultRestAnimation not found");if(!this.specialRestAnimation)throw new Error("DashboardHeader: specialRestAnimation not found")}}).prototype,"starProgressBar",[bA],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),TA=ve(CA.prototype,"chestButton",[fA],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),AA=ve(CA.prototype,"defaultRestAnimation",[wA],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),RA=ve(CA.prototype,"specialRestAnimation",[SA],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),vA=CA))||vA);var DA,OA,NA,MA,kA,xA,FA,BA,zA,UA,GA,HA,VA,qA,WA,KA,YA,jA;i._RF.pop(),i._RF.push({},"3b954Re2cRHvYJeBVAukYp9","JourneyLevelAvatar",void 0);const{ccclass:XA,property:$A,executeInEditMode:JA}=a;let QA=(DA=XA("JourneyLevelAvatar"),OA=$A({type:R,displayName:"Avatar node"}),NA=$A(n),MA=$A(y),kA=$A(x),xA=$A({type:D,group:"Animation"}),FA=$A({type:D,group:"Animation"}),BA=$A({type:D,group:"Animation"}),zA=$A({type:N,displayName:"Avatar sprite"}),DA(UA=JA((HA=ve((GA=class extends s{constructor(){super(...arguments),e(this,"sprite",HA,this),e(this,"lockIcon",VA,this),e(this,"animation",qA,this),e(this,"opacity",WA,this),e(this,"flashAnimation",KA,this),e(this,"unlockAnimation",YA,this),e(this,"spawnAnimation",jA,this)}get avatarSprite(){return this.sprite?.spriteFrame??null}set avatarSprite(e){this.sprite&&(this.sprite.spriteFrame=e)}async playUnlockAnimation(){const e=this.playAnimation(this.unlockAnimation),t=this.lockIcon.position.x,i=this.lockIcon.position.y,n=[45,135],a=(Math.random()*(n[1]-n[0])+n[0])*(Math.PI/180),s=this.lockIcon.position.x+150*Math.cos(a),o=this.lockIcon.position.y+150*Math.sin(a),r=i-400,l=vt.runTweenAsync(C(this.lockIcon).delay(.3).to(.2,{position:new j(s,o,this.lockIcon.position.z)},{easing:"sineOut"}).to(.4,{position:new j(s,r,this.lockIcon.position.z)},{easing:"cubicIn"})),c=[0,360],h=vt.runTweenAsync(C(this.lockIcon).delay(.3).to(.6,{eulerAngles:new j(0,0,Math.random()*(c[1]-c[0])*(s>t?-1:1))},{easing:"sineOut"}));await Promise.all([e,l,h]),this.lockIcon.position=new j(t,i,this.lockIcon.position.z),this.lockIcon.eulerAngles=new j(0,0,0)}async playFlashAnimation(){const e=this.node.position.y,t=this.playAnimation(this.flashAnimation),i=vt.runTweenAsync(C(this.node).to(.1,{position:new j(this.node.position.x,this.node.position.y+10,this.node.position.z)},{easing:"sineOut"}).to(.1,{position:new j(this.node.position.x,e,this.node.position.z)},{easing:"sineIn"}));await Promise.all([t,i])}playSpawnAnimation(){this.opacity.opacity=255,this.playAnimation(this.spawnAnimation)}hideImmediately(){this.opacity.opacity=0,this.node.setScale(j.ZERO)}async playAnimation(e){await vt.runAnimationAsync(this.animation,e.name)}onLoad(){this.validateRequiredComponents()}validateRequiredComponents(){if(!this.sprite)throw new Error("JourneyLevelAvatar: Avatar node is required");if(!this.lockIcon)throw new Error("JourneyLevelAvatar: Lock icon is required");if(!this.flashAnimation)throw new Error("JourneyLevelAvatar: Flash animation is required");if(!this.unlockAnimation)throw new Error("JourneyLevelAvatar: Unlock animation is required");if(!this.animation)throw new Error("JourneyLevelAvatar: Animation component is required");if(!this.animation.clips.some((e=>null!==e&&(e.name===this.flashAnimation.name||e.name===this.unlockAnimation.name||e.name===this.spawnAnimation.name))))throw new Error("JourneyLevelAvatar: Animation component does not contain required animations")}}).prototype,"sprite",[OA],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),VA=ve(GA.prototype,"lockIcon",[NA],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),qA=ve(GA.prototype,"animation",[MA],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),WA=ve(GA.prototype,"opacity",[kA],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),KA=ve(GA.prototype,"flashAnimation",[xA],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),YA=ve(GA.prototype,"unlockAnimation",[FA],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),jA=ve(GA.prototype,"spawnAnimation",[BA],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ve(GA.prototype,"avatarSprite",[zA],Object.getOwnPropertyDescriptor(GA.prototype,"avatarSprite"),GA.prototype),UA=GA))||UA)||UA);var ZA,eR,tR,iR,nR,aR,sR,oR,rR,lR,cR,hR;i._RF.pop(),i._RF.push({},"a392bibG75JPKzG0y2ZS2YY","JourneyProgressBar",void 0);const{ccclass:dR,property:uR,executeInEditMode:pR}=a;let mR=(ZA=dR("JourneyProgressBar"),eR=uR(Hs),tR=uR(h),iR=uR(x),nR=uR(f),aR=uR(f),sR=uR(b),ZA(oR=pR((lR=ve((rR=class extends s{constructor(){super(...arguments),e(this,"progressBar",lR,this),e(this,"progressLabel",cR,this),e(this,"labelUIOpacity",hR,this),this.currentProgress=10,this.totalProgress=10,this.labelSeparator="/"}get total(){return this.totalProgress}get current(){return this.currentProgress}get separator(){return this.labelSeparator}set separator(e){this.labelSeparator=e,this.updateProgress()}setRange(e,t){this.totalProgress=t,e>t&&(e=t),this.currentProgress=e,this.updateProgress()}onLoad(){this.validateRequiredComponents()}async animateTo(e){const{nextCurr:t,nextTotal:i,numberOfProgressBar:n=0,onProgressBarPassed:a,signal:s}=e,o=t/i,r=C(this.labelUIOpacity).to(.2,{opacity:0}),l=C(this.labelUIOpacity).to(.2,{opacity:255}),c=n<1?1:Math.sqrt(n)+1,h=0===n?o:n+o;let d=1;const u=this.progressBar.progress,p=h,m=vt.runOnUpdateAsync(this.node,c,(e=>{const t=k.sineInOut(e),i=he(u,p,t);this.progressBar.progress=i%1,i>d&&(d=0===i?1:Math.ceil(i),a?.())}),s);return await Promise.all([vt.runTweenAsync(r,s),m]),this.currentProgress=t,this.totalProgress=i,this.updateProgress(),await vt.runTweenAsync(l,s),this.labelUIOpacity.opacity=255,o}updateProgress(){this.progressBar.progress=this.currentProgress/this.totalProgress,this.progressLabel.string=`${this.currentProgress}${this.separator}${this.totalProgress}`}validateRequiredComponents(){if(!this.progressBar)throw new Error("JourneyProgressBar: Missing required component TapperedProgressBar");if(!this.progressLabel)throw new Error("JourneyProgressBar: Missing required component Label")}}).prototype,"progressBar",[eR],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),cR=ve(rR.prototype,"progressLabel",[tR],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),hR=ve(rR.prototype,"labelUIOpacity",[iR],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ve(rR.prototype,"total",[nR],Object.getOwnPropertyDescriptor(rR.prototype,"total"),rR.prototype),ve(rR.prototype,"current",[aR],Object.getOwnPropertyDescriptor(rR.prototype,"current"),rR.prototype),ve(rR.prototype,"separator",[sR],Object.getOwnPropertyDescriptor(rR.prototype,"separator"),rR.prototype),oR=rR))||oR)||oR);var gR,yR,bR,fR,wR,SR,vR,CR,ER,TR,AR,RR,IR,PR,_R,LR,DR,OR,NR,MR,kR,xR;i._RF.pop(),i._RF.push({},"8a41bfxLylDhLk57kewW14A","JourneyProgressAnimator",void 0);const{ccclass:FR,property:BR}=a,{Array:zR}=GameCore.Utils;let UR=(gR=FR("ProgressConfiguration"),yR=BR(N),bR=BR(b),gR((SR=ve((wR=class{constructor(){e(this,"avatar",SR,this),e(this,"themeId",vR,this)}}).prototype,"avatar",[yR],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),vR=ve(wR.prototype,"themeId",[bR],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),fR=wR))||fR),GR=(CR=FR("JourneyProgressAnimator"),ER=BR(mR),TR=BR(n),AR=BR(R),RR=BR(QA),IR=BR(UR),PR=BR({type:E,displayName:"Next Level Y Offset on Animation",group:"Unlocked Animation"}),CR((DR=ve((LR=class extends s{constructor(){super(...arguments),e(this,"progressBar",DR,this),e(this,"currentLevelAvatarNode",OR,this),e(this,"currentLevelAvatar",NR,this),e(this,"nextLevelAvatar",MR,this),e(this,"progressConfigs",kR,this),e(this,"nextLevelYOffset",xR,this),this.isAnimating=!1}setRange(e,t){this.progressBar.setRange(e,t)}async animateTo(e,t){if(this.isAnimating)return console.warn("JourneyProgressAnimator: animation already in progress"),Promise.resolve();this.isAnimating=!0,e!==this.progressBar.current&&await this.progressBar.animateTo({nextCurr:e,nextTotal:this.progressBar.total,signal:t}),this.isAnimating=!1}async animateToNextLevel(e){let{nextCurr:t,nextTotal:i,mapsPassed:n,signal:a}=e;if(this.isAnimating)return void console.warn("JourneyProgressAnimator: animation already in progress");this.isAnimating=!0;const s=n.length-2;if(0===s)return await this.progressBar.animateTo({nextCurr:t,nextTotal:i,signal:a}),void(this.isAnimating=!1);await this.animateTargetAvaToCenter(a);let o=1;await this.progressBar.animateTo({signal:a,nextCurr:t,nextTotal:i,numberOfProgressBar:s,onProgressBarPassed:()=>{if(1===o)return this.nextLevelAvatar.playUnlockAnimation(),void(o+=1);if(o>=n.length)throw new Error("JourneyProgressAnimator: currThemeIndex out of bounds");this.nextLevelAvatar.playFlashAnimation(),this.setNextLevelAvatar(n[o].theme),o+=1}}),await this.animateTargetAvaToPrev(a);const r=n[n.length-1].theme,l=n[n.length-2].theme;this.setCurrentLevelAvatar(l),this.nextLevelAvatar.hideImmediately(),this.moveTargetAvaToOriginal(),this.nextLevelAvatar.avatarSprite=this.getSpriteFrameByThemeId(r),this.nextLevelAvatar.playSpawnAnimation(),this.isAnimating=!1}async animateTargetAvaToCenter(e){const t=new j(0,this.nextLevelYOffset+this.nextLevelAvatar.node.position.y,this.nextLevelAvatar.node.position.z);await vt.runTweenAsync(C(this.nextLevelAvatar.node).to(1,{position:t},{easing:"cubicInOut"}),e),this.nextLevelAvatar.node.position=t}moveTargetAvaToOriginal(){this.nextLevelAvatar.node.position=this.originalNextLevelAvatarPosition.clone()}async animateTargetAvaToPrev(e){const t=this.currentLevelAvatarNode.position.clone();await vt.runTweenAsync(C(this.nextLevelAvatar.node).to(1,{position:t},{easing:"cubicInOut"}),e),this.nextLevelAvatar.node.position=t}getSpriteFrameByThemeId(e){const t=zR.search(this.progressConfigs,(t=>t.themeId===e));if(!t)throw new Error(`JourneyProgressController: config not found for themeId ${e}`);return t.avatar}setAvatar(e,t){const i=this.getSpriteFrameByThemeId(e);t instanceof QA?t.avatarSprite=i:t.spriteFrame=i}setCurrentLevelAvatar(e){this.setAvatar(e,this.currentLevelAvatar)}setNextLevelAvatar(e){this.setAvatar(e,this.nextLevelAvatar)}onLoad(){this.validateRequiredComponents(),this.originalNextLevelAvatarPosition=this.nextLevelAvatar.node.position.clone()}validateRequiredComponents(){Fe.lazyValidateProperties(this)}}).prototype,"progressBar",[ER],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),OR=ve(LR.prototype,"currentLevelAvatarNode",[TR],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),NR=ve(LR.prototype,"currentLevelAvatar",[AR],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),MR=ve(LR.prototype,"nextLevelAvatar",[RR],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),kR=ve(LR.prototype,"progressConfigs",[IR],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),xR=ve(LR.prototype,"nextLevelYOffset",[PR],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),_R=LR))||_R);var HR,VR,qR,WR,KR,YR,jR,XR,$R,JR,QR,ZR,eI,tI,iI,nI,aI;i._RF.pop(),i._RF.push({},"c2ddaEnKBVFvrM5x5nbfT7h","HomeContent",void 0);const{ccclass:sI,property:oI}=a,{storage:rI}=globalThis.game;let lI=(HR=sI("HomeContent"),VR=oI(h),qR=oI(p),WR=oI(GR),KR=oI(ps),YR=oI(LA),jR=oI(x),XR=oI(Kv),HR((QR=ve((JR=class extends s{constructor(){super(...arguments),e(this,"playButtonLabel",QR,this),e(this,"playButton",ZR,this),e(this,"journeyProgressAnimator",eI,this),e(this,"panelAnimator",tI,this),e(this,"dashboardHeader",iI,this),e(this,"overlayDuringAnim",nI,this),e(this,"coinContainer",aI,this)}__preload(){this.validateRequiredComponents()}getCoinContainer(){return this.coinContainer}handlePlayButtonPress(){this.playButton.interactable=!1,this.node.scene.emit(ei)}setPlayButtonLabel(e){this.playButtonLabel.string=e}updateStarProgress(e){this.dashboardHeader.updateStarProgress(e)}setUnlockProgress(e){this.setProgress(e),this.updateCurrentMapInStorage(e)}prepareUnlockProgressAnimation(e,t,i,n){if(e.id===t.id){this.setProgress({...t,progress:e.progress}),this.updateCurrentMapInStorage(t);const i=t.progress;return async()=>{this.playButton.interactable=!1,await this.showOwnOverlay(n),await this.journeyProgressAnimator.animateTo(i,n),await this.hideOwnOverlay(n),this.playButton.interactable=!0}}return this.setProgress(e),this.updateCurrentMapInStorage(t),async()=>{this.playButton.interactable=!1,await this.showOwnOverlay(n),await this.journeyProgressAnimator.animateToNextLevel({nextCurr:t.progress,nextTotal:t.max,mapsPassed:i,signal:n}),await this.hideOwnOverlay(n),this.playButton.interactable=!0}}async hideOwnOverlay(e){await vt.runTweenAsync(C(this.overlayDuringAnim).to(.3,{opacity:0}),e),this.overlayDuringAnim.opacity=0}async showOwnOverlay(e){await vt.runTweenAsync(C(this.overlayDuringAnim).to(.3,{opacity:150}),e)}setProgress(e){const{currentTheme:t,nextTheme:i,progress:n,max:a}=e;this.journeyProgressAnimator.setCurrentLevelAvatar(t),this.journeyProgressAnimator.setNextLevelAvatar(i??t),this.journeyProgressAnimator.setRange(n,a)}updateCurrentMapInStorage(e){rI.setStorageData("dashboard","animateToCurrentLevel",!1),rI.setStorageData("dashboard","lastMapPayload",e)}enableUIAnimator(){this.panelAnimator.enabled=!0}disableUIAnimator(){this.panelAnimator.enabled=!1}validateRequiredComponents(){Fe.lazyValidateProperties(this)}}).prototype,"playButtonLabel",[VR],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ZR=ve(JR.prototype,"playButton",[qR],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),eI=ve(JR.prototype,"journeyProgressAnimator",[WR],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),tI=ve(JR.prototype,"panelAnimator",[KR],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),iI=ve(JR.prototype,"dashboardHeader",[YR],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),nI=ve(JR.prototype,"overlayDuringAnim",[jR],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),aI=ve(JR.prototype,"coinContainer",[XR],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),$R=JR))||$R);var cI,hI,dI,uI,pI,mI,gI,yI,bI,fI,wI,SI,vI,CI,EI;i._RF.pop(),i._RF.push({},"f555belwQ1NHJr4np65OtcU","NavManager",void 0);const{ccclass:TI,property:AI}=a,{ads:RI}=globalThis.game,{Utils:{Array:II}}=GameCore;let PI=(cI=TI("NavManager"),hI=AI(n),dI=AI(n),uI=AI(Wt),pI=AI(H),mI=AI({type:A,visible:function(){return this.useOffsetWhenSAB}}),gI=AI({type:E,visible:function(){return this.useOffsetWhenSAB}}),cI((fI=ve((bI=class extends s{constructor(){super(...arguments),e(this,"selectorNode",fI,this),e(this,"selectedButtonNode",wI,this),e(this,"autoLayout",SI,this),e(this,"useOffsetWhenSAB",vI,this),e(this,"offsetWidget",CI,this),e(this,"offsetWhenSAB",EI,this),this.navButtons=[],this.isNavigating=!1}get currentButton(){return this.selectedButton}onLoad(){this.navButtons=this.node.getComponentsInChildren("NavButton"),this.selectedButton=this.selectedButtonNode?.getComponentInChildren("NavButton"),Fe.lazyValidateProperties(this)}start(){if(!this.useOffsetWhenSAB)return;RI.getSafeAreaBottom($i.cssSizeToWorldSize(1))>0&&(this.offsetWidget.bottom=this.offsetWhenSAB)}async select(e){if(!this.isNavigating){if(!II.has(this.navButtons,e))throw new Error("NavManager: Button not found");if(e!==this.selectedButton){if(!e.isWIP)return this.isNavigating=!0,this.node.scene.emit(ti,{from:this.selectedButton.buttonType,to:e.buttonType}),new Promise((t=>{this.node.scene.once(ii,(()=>{const i=this.selectedButton.deselect();this.autoLayout.selectedIndex=this.navButtons.indexOf(e),this.selectedButton=e;const n=this.autoLayout.getSelectedWorldX()-e.getSelectedWorldDistanceX(),a=this.playSelectorAnimation(n),s=e.select();Promise.all([i,s,a]).then((()=>{this.isNavigating=!1,t()}))}))}));this.handleWIPButton()}}}async selectUsingSceneTransition(e){this.isNavigating||(II.has([ai.store],e.buttonType)?this.handleWIPButton():await this.select(e))}async selectByType(e){const t=II.search(this.navButtons,(t=>t.buttonType===e));if(!t)throw new Error("NavManager: Button not found");await this.selectUsingSceneTransition(t)}handleWIPButton(){Wl.openScreen(Hi.STAR_CHEST_SCREEN)}async selectDefaultNavBtn(){if(!this.currentButton||!II.has(this.navButtons,this.currentButton))throw new Error("NavManager: Button not found");const e=this.currentButton.buttonType;return this.node.scene.emit(ti,{from:null,to:e}),new Promise((e=>{this.node.scene.once(ii,(()=>{this.autoLayout.selectedIndex=this.navButtons.indexOf(this.currentButton);const t=this.navButtons.map((e=>e===this.currentButton?e.select(!1):e.deselect(!1,!0))),i=this.autoLayout.getSelectedWorldX()-this.currentButton.getSelectedWorldDistanceX();this.selectorNode.worldPosition=new j(i,this.selectorNode.worldPosition.y,0),Promise.all(t).then((()=>{e()}))}))}))}async playSelectorAnimation(e){const t=new j(1,1,1),i=this.selectorNode.worldPosition.clone(),n=new j(1.2*t.x,.8*t.y,1);await vt.runTweenAsync(C(this.selectorNode).to(.3,{worldPosition:new j(e,i.y,0)},{easing:"quintInOut",onUpdate:(e,i)=>{if(void 0===i)return;const a=this.calculateCurrentSquashScale(t,n,i);this.selectorNode.scale=a}}))}setIgnoreInput(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.navButtons.forEach((t=>{const i=t.getComponentInChildren(p);i&&(i.interactable=!e)}))}calculateCurrentSquashScale(e,t,i){const n=this.splitIntoSquashRatio(i);return e.clone().lerp(t,n)}splitIntoSquashRatio(e){return e<.5?2*e:1-2*(e-.5)}}).prototype,"selectorNode",[hI],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wI=ve(bI.prototype,"selectedButtonNode",[dI],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),SI=ve(bI.prototype,"autoLayout",[uI],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),vI=ve(bI.prototype,"useOffsetWhenSAB",[pI],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),CI=ve(bI.prototype,"offsetWidget",[mI],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),EI=ve(bI.prototype,"offsetWhenSAB",[gI],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),yI=bI))||yI);var _I,LI,DI,OI,NI,MI,kI,xI,FI,BI,zI,UI,GI;i._RF.pop(),i._RF.push({},"d48a1TnKg1F4YRzzKmQOD5k","DashboardScene",void 0);const{ccclass:HI,disallowMultiple:VI,property:qI}=a,{event:WI,storage:KI,player:YI,leaderboard:jI}=globalThis.game,{Events:XI,Match:{Modes:$I},Configs:{DailyRewards:JI},Utils:{Time:QI,Json:ZI,Array:eP}}=GameCore;_I=HI("DashboardScene"),LI=qI(qw),DI=qI(PI),OI=qI(xi),NI=qI(qT),MI=qI(Nv),_I(kI=VI((FI=ve((xI=class extends s{constructor(){super(...arguments),e(this,"coinManager",FI,this),e(this,"navManager",BI,this),e(this,"bgComp",zI,this),e(this,"pageManager",UI,this),e(this,"pageAnimSkipOverlay",GI,this),this.firstNavigation=!0,this.isFirstNavToCollections=!0,this.playBgAnim=async()=>{const e=KI.getStorage("dashboard");if(null==e)throw new Error("DashboardScene: dashboardStorage not found");const t=e.animateToCurrentLevel??!1,i={...e.lastMapPayload},n=ll.getCurrentMapProgress(),a=i.currentTheme===n.currentTheme&&i.nextTheme===n.nextTheme,s=n.currentTheme;if(t&&!a){await vt.waitTweenAsync(2);try{await this.bgComp.animateToNextTheme(s)}catch(e){}}},this.handlePlayButtonPress=async()=>{try{const e=ll.getCurrentMapProgress(),{level:t=1}=YI.getGameData()??{};await Promise.all([await Sl.setMatchCustomDataAsync({level:t}),await Sl.startMatchAsync($I.SINGLE)]),this.updateCurrentMapInStorage(e),KI.setStorageData("collection","lastMapPack",e.id),KI.setStorageData("collection","animateMapPackUnlock",!1);const{lastTabOpened:i}=KI.getStorage("leaderboard_content");this.getPlayerLeader(i).then((e=>{if(!e)return;const{score:t,rank:i}=e;KI.setStorageData("leaderboard_content","previousScore",t),KI.setStorageData("leaderboard_content","previousRank",i)})),El.switchScene(Br,{level:t})}catch(e){return void console.error(e)}},this.onNavigate=async e=>{switch(this.firstNavigation&&(this.firstNavigation=!1,this.pageManager.unmountAndHideAll()),e.to){case ai.store:this.navManager.setIgnoreInput(),await this.pageManager.navigate(e),this.handleNavigateToStore(),this.navManager.setIgnoreInput(!1);break;case ai.collections:await this.onNavigateToCollections({...e,to:ai.collections});break;case ai.tournaments:await this.onNavigateToTournaments(e);break;case ai.leaderboard:await this.onNavigateToLeaderboard({...e,to:ai.leaderboard});break;case ai.home:await this.handleNavigateToHome(e);break;default:throw new Error("DashboardScene: Unhandled page name")}},this.handleEventButtonPress=e=>{switch(e.type){case vf.STAR_CHEST:Wl.openScreen(Hi.STAR_CHEST_SCREEN);break;case vf.BALLOON:Wl.showNotificationScreen("Coming soon!");break;default:throw new Error("DashboardScene: Unhandled event button type")}}}__preload(){this.panelAnimationController=this.getComponent(qa),this.validateRequiredComponents(),this.listenNavigationEvents(),this.listenDashboardEvents(),this.panelAnimationController.init()}listenNavigationEvents(){this.node.scene.on(ti,this.onNavigate)}listenDashboardEvents(){this.node.scene.on(ei,this.handlePlayButtonPress),this.node.scene.on(ni,this.handleEventButtonPress)}onLoad(){this.coinManager.init(this.pageAnimSkipOverlay),ll.init(),this.setPlayerLevel(),this.initBgComp(),this.pageManager.updateCollectionsContentPayload(ll.getCollectionUnlockProgress())}setPlayerLevel(){let{level:e=1}=YI.getGameData()??{};e=0===e?1:e,YI.setGameData({level:e})}start(){YI.getPlayerSetting("music")&&Xi.playMusic(),this.playBgAnim(),this.navManager.selectDefaultNavBtn(),this.updateVolumeBackgroundMusic(),this.scheduleOnce(this.preloadScenes,2)}preloadScenes(){El.preloadGameScene()}initBgComp(){const e=KI.getStorage("dashboard");if(null==e)throw new Error("DashboardScene: dashboardStorage not found");const t=e.animateToCurrentLevel??!1,i={...e.lastMapPayload},n=ll.getCurrentMapProgress(),a=i.currentTheme===n.currentTheme&&i.nextTheme===n.nextTheme,s=n.currentTheme;t&&!a?this.bgComp.setCurrentTheme(i.currentTheme):this.bgComp.setCurrentTheme(s)}async getPlayerLeader(e){const t="global"==e?Lr:Dr;if(!t)return null;const i=YI.getPlayerId(),n=await jI.getLeadersByPlayerIdsAsync(t,[i]);return 0===n.length?null:n[0]}updateCurrentMapInStorage(e){KI.setStorageData("dashboard","animateToCurrentLevel",!1),KI.setStorageData("dashboard","lastMapPayload",e)}updateVolumeBackgroundMusic(){Xi.turnUpMusic()}checkDailyRewardsOpenable(){const{logDays:e=[],lastRewarded:t=0}=YI.getPlayerData().dailyRewarded;if(e.length>JI.MaxDays)return!0;if(JI.MockTime>0){if(Date.now()-t>=1e3*JI.MockTime)return!0}return!QI.isToday(t)}validateRequiredComponents(){Fe.lazyValidateProperties(this)}handleNavigateToStore(){}async onNavigateToCollections(e){this.navManager.setIgnoreInput();const t=ll.getCollectionUnlockProgress(),i=this.getCurrentUnlockingTheme();let n;if(await this.pageManager.navigate(e,(e=>(n=e.getContainer().getComponentInChildren(rT),n.updateUnlockedProgress(t),Promise.resolve()))),void 0===n)throw new Error("CollectionsContent not found");const a=new oi,s=n.shouldAnimateThemeTabUnlock();s&&await this.pageAnimSkipOverlay.open({onSkip:()=>a.abort(),opacity:200}),this.isFirstNavToCollections&&null!==i&&(await n.scrollToCurrentUnlockingTheme(i.skin,a),this.isFirstNavToCollections=!1),await n.playThemeTabUnlockAnim(a),s&&await this.pageAnimSkipOverlay.close(),a.abort(),this.navManager.setIgnoreInput(!1)}async onNavigateToTournaments(e){this.navManager.setIgnoreInput(),await this.pageManager.navigate(e),this.navManager.setIgnoreInput(!1)}async onNavigateToLeaderboard(e){this.navManager.setIgnoreInput(),await this.pageManager.navigate(e),this.navManager.setIgnoreInput(!1)}setHomeDataAndGetNavAnim(){const e=this.pageManager.getPage(ai.home).getContainer().getComponentInChildren(lI);this.coinManager.setTargetContainer(e.getCoinContainer());const t=`Level ${YI.getGameData()?.level??1}`;e.setPlayButtonLabel(t),this.coinManager.emitCoinAmount();const i=YI.getGameData()?.stars??0;e.updateStarProgress(i);const n=KI.getStorage("dashboard");if(null==n)throw new Error("DashboardScene: dashboardStorage not found");const a=n.animateToCurrentLevel??!1,s={...n.lastMapPayload},o={...ll.getCurrentMapProgress()},{animateTournamentLeader:r}=KI.getStorage("tournament");if(r)return e.setUnlockProgress(o),async()=>{await this.navManager.selectByType(ai.tournaments)};if(ZI.encode(s)===ZI.encode(o))return void e.setUnlockProgress(o);if(!a)
//! this is bad for user experience
return void e.setUnlockProgress(o);const l=eP.searchIndex(Jr.mapOrder,(e=>e.id===s.id)),c=eP.searchIndex(Jr.mapOrder,(e=>e.id===o.id)),h=l===c;if(-1===l||-1===c)throw new Error("DashboardScene: map not found");
//! safe guard against dev tools time travel
if(l>c)return void e.setUnlockProgress(o);const d=Jr.mapOrder.slice(l,c+2),u=new oi,p=e.prepareUnlockProgressAnimation(s,o,d,u);return async()=>{await this.pageAnimSkipOverlay.open({onSkip:()=>u.abort(),opacity:150}),await p(),u.aborted||h||await this.navManager.selectByType(ai.collections),await this.pageAnimSkipOverlay.close()}}async handleNavigateToHome(e){let t;this.navManager.setIgnoreInput(),await this.pageManager.navigate(e,(async()=>{t=this.setHomeDataAndGetNavAnim()})),this.navManager.setIgnoreInput(!1),await this.tryOpenDailyRewardsScreen(),await this.coinManager.untilFinishesCollectAnim(),await this.pageAnimSkipOverlay.untilClosed(),await(t?.())}async tryOpenDailyRewardsScreen(){if(this.checkDailyRewardsOpenable())return Wl.openScreen(Hi.DAILY_REWARDS_SCREEN),new Promise((e=>{const t=i=>{i.screenName===Vi[Hi.DAILY_REWARDS_SCREEN]&&(e(),WI.off(XI.CLOSED_SCREEN,t))};WI.on(XI.CLOSED_SCREEN,t)}))}getCurrentUnlockingTheme(){const e=ll.getCollectionUnlockProgress();if(0===e.length)return null;let t=e[0];for(const i of e){const{isLocked:e}=i;e||(t=i)}return t}}).prototype,"coinManager",[LI],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),BI=ve(xI.prototype,"navManager",[DI],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),zI=ve(xI.prototype,"bgComp",[OI],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),UI=ve(xI.prototype,"pageManager",[NI],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),GI=ve(xI.prototype,"pageAnimSkipOverlay",[MI],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),kI=xI))||kI);var tP,iP,nP,aP,sP;i._RF.pop(),i._RF.push({},"53f87ljsxFJUKsBbXk8WVkJ","HomePage",void 0);const{ccclass:oP,property:rP}=a,{player:lP}=globalThis.game,{Utils:{Number:cP}}=GameCore;tP=oP("HomePage"),iP=rP({type:h,group:"Placeholders"}),tP((sP=ve((aP=class extends zC{constructor(){super(...arguments),e(this,"coinLabel",sP,this)}__preload(){super.__preload?.(),this.validateOwnRequiredComponents(),this.listenToCoinUpdateEvent()}listenToCoinUpdateEvent(){this.node.scene.on(Ha.COIN_CHANGED,this.updateplaceholderCoins,this)}async updateplaceholderCoins(e){this.coinLabel.string=cP.getShortNumber(e.coins,3)}async mount(){if(await super.mount(),!this.homeContent&&(this.homeContent=this.container.getComponentInChildren(lI),!this.homeContent))throw new Error("HomePage: homeContent not found");const e=lP.getGameData()?.coins??0;this.updateplaceholderCoins({coins:e})}async transitionIn(){await super.transitionIn(),this.homeContent.enableUIAnimator()}async transitionOut(){this.homeContent.disableUIAnimator(),await super.transitionOut()}validateOwnRequiredComponents(){if(!this.coinLabel)throw new Error("HomePage: coinLabel not found")}}).prototype,"coinLabel",[iP],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),nP=aP));var hP;i._RF.pop(),i._RF.push({},"332aaP3dkhKxZNHiMFB1bKn","LeaderboardIsEmpty",void 0);const{ccclass:dP}=a;let uP=dP("LeaderboardIsEmpty")(hP=class extends s{onLoad(){this.uiOpacity=this.getComponent(x),this.validateRequiredComponents()}validateRequiredComponents(){Fe.lazyValidateProperties(this)}async show(){this.uiOpacity.opacity=255;const e=this.node.position.clone(),t=C(this.node);t.to(.05,{position:e.clone().add3f(5,0,0)}),t.to(.05,{position:e.clone().add3f(-5,0,0)});const i=C(this.node).repeat(2,t);i.to(.05,{position:e}),await vt.runTweenAsync(i)}hide(){this.uiOpacity.opacity=0}})||hP;var pP,mP,gP,yP,bP,fP,wP,SP,vP,CP,EP,TP,AP,RP,IP,PP,_P,LP,DP,OP;i._RF.pop(),i._RF.push({},"aa4b0d0u0hLeqd3+/PQZ/QD","SwitchButton",void 0);const{ccclass:NP,property:MP,requireComponent:kP}=a,{analytics:xP}=globalThis.game,{Utils:{Array:FP},Plugins:{Analytics:{Events:BP}}}=GameCore;let zP=(pP=NP("SwitchButton"),mP=kP([p,y]),gP=MP(H),yP=MP(n),bP=MP(n),fP=MP(H),wP=MP({visible(){return this.useSound},type:Ui}),SP=MP(H),vP=MP({visible(){return this.useDesktopHover},type:D}),CP=MP({visible(){return this.useDesktopHover},type:D}),pP(EP=mP((AP=ve((TP=class extends s{constructor(){super(...arguments),e(this,"enable",AP,this),e(this,"nodeOn",RP,this),e(this,"nodeOff",IP,this),e(this,"useSound",PP,this),e(this,"soundKey",_P,this),e(this,"useDesktopHover",LP,this),e(this,"mouseEnterClip",DP,this),e(this,"mouseLeaveClip",OP,this),this.isMouseLeaved=!1,this.onMouseEnter=e=>{this.useDesktopHover&&this.buttonComponent.interactable&&(this.isMouseLeaved=!1,this.animationComponent.play(this.mouseEnterClip.name))},this.onMouseLeave=e=>{this.useDesktopHover&&this.buttonComponent.interactable&&(this.isMouseLeaved||(this.isMouseLeaved=!0,this.animationComponent.play(this.mouseLeaveClip.name)))}}__preload(){this.buttonComponent=this.getComponent(p),this.animationComponent=this.getComponent(y),this.validateRequiredComponents()}onLoad(){const e=this.animationComponent.clips.map((e=>e?.name)).filter((e=>null!=e&&"string"==typeof e));this.useDesktopHover&&(FP.has(e,this.mouseEnterClip.name)||this.animationComponent.addClip(this.mouseEnterClip),FP.has(e,this.mouseLeaveClip.name)||this.animationComponent.addClip(this.mouseLeaveClip))}validateRequiredComponents(){Fe.lazyValidateProperties(this)}onEnable(){this.node.on(n.EventType.MOUSE_ENTER,this.onMouseEnter),this.node.on(n.EventType.MOUSE_LEAVE,this.onMouseLeave)}onDisable(){this.node.off(n.EventType.MOUSE_ENTER,this.onMouseEnter),this.node.off(n.EventType.MOUSE_LEAVE,this.onMouseLeave)}switch(){return!!this.node.active&&(xP.event(BP.BUTTON_CLICK,{button_name:this.node.name,enable:!this.enable}),this.useSound&&Xi.playSound(Gi[this.soundKey]),this.updateStatus(!this.enable))}setEnabled(e){this.node.active&&this.updateStatus(e)}updateStatus(e){return this.enable===e||(this.onMouseLeave(null),this.enable=e,this.nodeOn.active=e,this.nodeOff.active=!e),this.enable}}).prototype,"enable",[gP],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),RP=ve(TP.prototype,"nodeOn",[yP],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),IP=ve(TP.prototype,"nodeOff",[bP],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),PP=ve(TP.prototype,"useSound",[fP],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),_P=ve(TP.prototype,"soundKey",[wP],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Ui[Bi.BUTTON_CLICK]}}),LP=ve(TP.prototype,"useDesktopHover",[SP],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),DP=ve(TP.prototype,"mouseEnterClip",[vP],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),OP=ve(TP.prototype,"mouseLeaveClip",[CP],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),EP=TP))||EP)||EP);var UP,GP,HP,VP,qP,WP,KP;i._RF.pop(),i._RF.push({},"2871awUXL9J0I+rBEFNHN7o","Tabs",void 0);const{ccclass:YP,property:jP}=a,{analytics:XP}=globalThis.game,{Plugins:{Analytics:{Events:$P}}}=GameCore;let JP=(UP=YP("Tabs"),GP=jP(zP),HP=jP(zP),UP((WP=ve((qP=class extends s{constructor(){super(...arguments),e(this,"tabWorld",WP,this),e(this,"tabFriends",KP,this)}onLoad(){this.validateRequiredComponents()}validateRequiredComponents(){if(!this.tabWorld)throw new Error("Tabs: tabWorld not found");if(!this.tabFriends)throw new Error("Tabs: tabFriends not found")}setInteractableButtons(e){this.tabWorld.getComponent(p).interactable=e,this.tabFriends.getComponent(p).interactable=e}updateStatus(e){this.tabWorld.setEnabled("global"===e),this.tabFriends.setEnabled("friends"===e)}handleTabWorldSelect(){this.tabWorld.setEnabled(!0),this.tabFriends.setEnabled(!1),XP.event($P.BUTTON_CLICK,{button_name:this.node.name,screen_name:ji.getCurrentPage()}),this.node.scene.emit(Cf.WORLD_TAB_SELECTED)}handleTabFriendsSelect(){this.tabWorld.setEnabled(!1),this.tabFriends.setEnabled(!0),XP.event($P.BUTTON_CLICK,{button_name:this.node.name,screen_name:ji.getCurrentPage()}),this.node.scene.emit(Cf.FRIENDS_TAB_SELECTED)}}).prototype,"tabWorld",[GP],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),KP=ve(qP.prototype,"tabFriends",[HP],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),VP=qP))||VP);var QP,ZP,e_,t_,i_;i._RF.pop(),i._RF.push({},"69c90PvoTtGfZyDw8FbbOvV","LeaderSkeleton",void 0);const{ccclass:n_,disallowMultiple:a_,property:s_}=a;let o_=(QP=n_("LeaderSkeleton"),ZP=s_(n),QP(e_=a_((i_=ve((t_=class extends s{constructor(){super(...arguments),e(this,"container",i_,this)}__preload(){this.uiOpacity=this.getComponent(x),this.validateRequiredComponents()}async hide(e){await vt.runTweenAsync(C(this.uiOpacity).to(.2,{opacity:0}).call((()=>{this.node.active=!1})),e)}async show(e,t){this.node.active=!0,this.node.scale=new j(.8,.8,.8),this.uiOpacity.opacity=0;const i=this.container.position.clone();this.container.position=new j(i.x,i.y-100,i.z);const n=C(this.node).delay(e);n.to(.2,{scale:j.ONE},{easing:"cubicOut"});const a=C(this.container).delay(e);a.to(.2,{position:i},{easing:"cubicOut"});const s=C(this.uiOpacity).delay(e);s.to(.2,{opacity:255},{easing:"cubicOut"}),await Promise.all([vt.runTweenAsync(n,t),vt.runTweenAsync(a,t),vt.runTweenAsync(s,t)])}validateRequiredComponents(){if(!this.uiOpacity)throw new Error("UIOpacity component is not attached to the same node");if(!this.container)throw new Error("Container is not attached to the same node")}}).prototype,"container",[ZP],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),e_=t_))||e_)||e_);var r_,l_,c_,h_,d_,u_,p_,m_,g_,y_,b_,f_,w_,S_,v_,C_,E_,T_,A_,R_,I_,P_,__,L_,D_,O_,N_,M_,k_,x_,F_,B_,z_,U_,G_,H_,V_,q_,W_,K_,Y_;i._RF.pop(),i._RF.push({},"53da1+ne4RJ4p0kTjp52K/1","Leader",void 0);const{ccclass:j_,property:X_}=a,{Utils:{Number:$_}}=GameCore;let J_=(r_=j_("Leader"),l_=X_(h),c_=X_(x),h_=X_({type:n,group:"Container"}),d_=X_({type:R,group:"Background"}),u_=X_({type:N,group:"Background"}),p_=X_({type:R,group:"Rank"}),m_=X_({type:h,group:"Rank"}),g_=X_({type:N,group:"Rank"}),y_=X_({type:N,group:"Rank"}),b_=X_({type:N,group:"Rank"}),f_=X_({type:N,group:"Rank"}),w_=X_({type:R,group:"Avatar"}),S_=X_({type:x,group:"Avatar"}),v_=X_({type:R,group:"Score"}),C_=X_({type:h,group:"Score"}),E_=X_({type:N,group:"Score"}),T_=X_({type:x,group:"Score"}),A_=X_({type:x}),R_=X_({type:l}),r_((__=ve((P_=class extends s{constructor(){super(...arguments),e(this,"nameLabel",__,this),e(this,"nameOpacity",L_,this),e(this,"container",D_,this),e(this,"background",O_,this),e(this,"highlightBackground",N_,this),e(this,"rankSprite",M_,this),e(this,"rankLabel",k_,this),e(this,"goldRank",x_,this),e(this,"silverRank",F_,this),e(this,"bronzeRank",B_,this),e(this,"highlightRank",z_,this),e(this,"avatar",U_,this),e(this,"avatarOpacity",G_,this),e(this,"scoreBackground",H_,this),e(this,"scoreLabel",V_,this),e(this,"highlightScoreBackground",q_,this),e(this,"scoreOpacity",W_,this),e(this,"uiOpacity",K_,this),e(this,"uiTransform",Y_,this)}onLoad(){this.defaultBackground=this.background.spriteFrame,this.defaultRank=this.rankSprite.spriteFrame,this.defaultScoreBackground=this.scoreBackground.spriteFrame,this.validateRequiredComponents()}validateRequiredComponents(){Fe.lazyValidateProperties(this)}updateInfo(e,t){this.updateBackground(e),this.updateRank(e,t),this.resetPhoto(),this.updateUsername(e),this.updateScore(e)}updateBackground(e){this.background.spriteFrame=e.isHighlight?this.highlightBackground:this.defaultBackground}updateRank(e,t){const i=e.rank;if(this.rankLabel.string===i.toString())return;this.rankLabel.string=t&&i>t?`${t}+`:i.toString(),this.rankSprite.spriteFrame=this.defaultRank;let n=new o(If);switch(e.isHighlight&&(this.rankSprite.spriteFrame=this.highlightRank,n=new o(_f)),i){case 1:this.rankSprite.spriteFrame=this.goldRank,n=new o(Ef);break;case 2:this.rankSprite.spriteFrame=this.silverRank,n=new o(Tf);break;case 3:this.rankSprite.spriteFrame=this.bronzeRank,n=new o(Af)}this.rankLabel.shadowColor=n,this.rankLabel.outlineColor=n}setPhoto(e){e&&this.node.active&&(e.packable=!0,this.avatar.spriteFrame=e)}async resetPhoto(){if(!this.defaultAvatar){const e=await hi.loadSpriteFrameAsync("images/avatar-bg/spriteFrame");if(!e)return;this.defaultAvatar=e}this.avatar.spriteFrame=this.defaultAvatar}updateUsername(e){this.nameLabel.string=e.name,this.nameLabel.color=new o(e.isHighlight?Pf:Rf)}updateScore(e){const t=Math.floor(e.score);this.scoreLabel.string=$_.getShortNumber(t,7);const i=this.scoreLabel.getComponent(h);i.outlineColor=new o(e.isHighlight?_f:If),i.shadowColor=new o(e.isHighlight?_f:If),this.scoreBackground.spriteFrame=e.isHighlight?this.highlightScoreBackground:this.defaultScoreBackground}async runShowUpAnimation(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.3;this.node.scale=new j(.8,.8,.8),this.setOpacity(0);const n=this.container.position.clone();this.container.position=new j(n.x,n.y-100,n.z);const a=C(this.node).delay(t);a.to(i,{scale:j.ONE},{easing:"elasticOut"});const s=C(this.container).delay(t);s.to(i,{position:n},{easing:"backOut"});const o=C(this.uiOpacity).delay(t);o.to(i,{opacity:255},{easing:"cubicOut",onUpdate:()=>{this.nameOpacity.opacity=this.uiOpacity.opacity,this.scoreOpacity.opacity=this.uiOpacity.opacity,this.avatarOpacity.opacity=this.uiOpacity.opacity}}),e.addAbortListener((()=>{this.node.scale=j.ONE,this.container.position=n,this.uiOpacity.opacity=255,this.avatar.node.active=!0})),await Promise.all([vt.runTweenAsync(a,e),vt.runTweenAsync(s,e),vt.runTweenAsync(o,e)])}async runWorldPositionAnimation(e,t){const i=C(this.node).to(t,{worldPosition:e},{easing:"quadOut"});await vt.runTweenAsync(i)}async runScaleAnimation(e,t,i){const n=C(this.node).to(i,{scale:new j(t,t,t)},{easing:"backOut"});await vt.runTweenAsync(n,e)}async runUpdateDataAnimation(e,t,i,n,a){await vt.runOnUpdateAsync(this.node,a,(a=>{const s=Math.floor(e+(t-e)*a),o=Math.floor(i+(n-i)*a);this.updateRank({rank:s,isHighlight:!0}),this.updateScore({score:o,isHighlight:!0})}))}setOpacity(e){this.uiOpacity.opacity=e,this.nameOpacity.opacity=e,this.scoreOpacity.opacity=e,this.avatarOpacity.opacity=e}}).prototype,"nameLabel",[l_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),L_=ve(P_.prototype,"nameOpacity",[c_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),D_=ve(P_.prototype,"container",[h_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),O_=ve(P_.prototype,"background",[d_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),N_=ve(P_.prototype,"highlightBackground",[u_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),M_=ve(P_.prototype,"rankSprite",[p_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),k_=ve(P_.prototype,"rankLabel",[m_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),x_=ve(P_.prototype,"goldRank",[g_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),F_=ve(P_.prototype,"silverRank",[y_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),B_=ve(P_.prototype,"bronzeRank",[b_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),z_=ve(P_.prototype,"highlightRank",[f_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),U_=ve(P_.prototype,"avatar",[w_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),G_=ve(P_.prototype,"avatarOpacity",[S_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),H_=ve(P_.prototype,"scoreBackground",[v_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),V_=ve(P_.prototype,"scoreLabel",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),q_=ve(P_.prototype,"highlightScoreBackground",[E_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),W_=ve(P_.prototype,"scoreOpacity",[T_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),K_=ve(P_.prototype,"uiOpacity",[A_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Y_=ve(P_.prototype,"uiTransform",[R_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),I_=P_))||I_);var Q_,Z_,eL,tL,iL,nL,aL,sL,oL,rL,lL,cL,hL;i._RF.pop(),i._RF.push({},"173acdyc/VOnLkPsoSfdfnr","Leaders",void 0);const{ccclass:dL,property:uL}=a,{player:pL,frameCapture:mL}=globalThis.game,{Utils:{Image:gL}}=GameCore;let yL=(Q_=dL("Leaders"),Z_=uL(_),eL=uL(n),tL=uL(T),iL=uL(l),nL=uL(f),Q_((oL=ve((sL=class extends s{constructor(){super(...arguments),e(this,"leaderPrefab",oL,this),e(this,"inactiveNodeContainer",rL,this),e(this,"layout",lL,this),e(this,"viewport",cL,this),e(this,"maxLeader",hL,this),this.cachedPhotos=new Map,this.leaderData=[],this.leaderPoolArray=[],this.playerLeader=null,this.isHidden=!0}onLoad(){this.uiTransform=this.getComponent(l),this.batchNodes=this.getComponents(hr),this.validateRequiredComponents()}validateRequiredComponents(){Fe.lazyValidateProperties(this)}__preload(){this.currentPlayerId=pL.getPlayerId();for(let e=0;e<this.maxLeader;e++){const e=this.createLeader();this.leaderPoolArray.push(e)}const{contentSize:e}=this.leaderPoolArray[0].uiTransform;this.leaderContentHeight=e.height+this.layout.spacingY}createLeader(){const e=c(this.leaderPrefab);return this.addLeaderToInactiveNode(e),e.getComponent(J_)}async updateData(e){if(this.playerLeader=null,this.isHidden=!1,this.leaderData=e,this.leaderData.sort(((e,t)=>t.score-e.score)),null==pL)throw new Error("Player is not defined");this.batchNodes.every((e=>e.enabled=!0)),await Promise.all(this.leaderData.map(((e,t)=>{let{playerId:i,photo:n,score:a,name:s}=e;const o=this.currentPlayerId===i;this.leaderData[t].rank=t+1;const r=this.maxLeader-1;if(t>=r&&!o)return;const l=o&&t>r-1?this.leaderPoolArray[r]:this.leaderPoolArray[t];return this.layout.node.addChild(l.node),l.setOpacity(0),o&&(this.playerLeader=l),l.updateInfo({isHighlight:o,name:s,photo:n,rank:t+1,score:a},r),this.getAndSetLeaderPhoto({playerId:i,url:n,leader:l})})))}async getAndSetLeaderPhoto(e){const{playerId:t,url:i,leader:n}=e;if("default"!==i)if(this.cachedPhotos.has(t))n.setPhoto(this.cachedPhotos.get(t));else try{const e=await this.loadAvatarImage(i,85,85,t);if(!e)return;const a=N.createWithImage(e);this.cachedPhotos.set(t,a),n.setPhoto(a)}catch(e){if(e instanceof DOMException&&"AbortError"===e.name)return void console.info("Leaders: getAndSetLeaderPhoto was aborted");throw e}}removeLeaders(){this.isHidden=!0,this.getActiveLeaders().forEach((e=>{e.resetPhoto(),this.addLeaderToInactiveNode(e.node)})),this.batchNodes.every((e=>e.enabled=!1))}getActiveLeaders(){return this.leaderPoolArray.filter((e=>e.node.parent===this.layout.node))}getActiveLeaderChildren(){return this.layout.getComponentsInChildren(J_)}async showLeaders(e){if(this.isHidden)return;const t=this.getActiveLeaders();if(t.length<1)return;const i=Math.ceil(this.viewport.contentSize.height/this.leaderContentHeight),n=Math.min(t.length,i);await Promise.all(t.map((async(t,i)=>{this.isHidden||i<n&&await t.runShowUpAnimation(e,.1*i,.3)})))}async runUpdateLeadersRankAnimation(e,t){const i=e??0;let n=t??this.leaderData.length;n=Math.min(n,100);const a=this.getActiveLeaderChildren(),s=this.leaderContentHeight,o=[];for(let e=i;e<n;e++){a[e].updateRank({rank:e+1,isHighlight:!1});const t=a[e].node.worldPosition.clone();o.push(a[e].runWorldPositionAnimation(t.add3f(0,-s,0),.25))}await Promise.all(o)}getLeaderData(){return this.leaderData}getPlayerLeader(){return this.playerLeader}getLeaderByRank(e){return this.getActiveLeaders()[e-1]||null}getLeaderDataByRank(e){return this.leaderData[e-1]||null}updateVisibility(){const{yMax:e,yMin:t}=this.viewport.getBoundingBoxToWorld();this.getActiveLeaders().forEach((i=>{const n=i.uiTransform;if(void 0===n)return;const{yMax:a,yMin:s}=n.getBoundingBoxToWorld(),o=a<t||s>e;i.setOpacity(o?0:255)}))}async loadAvatarImage(e,t,i,n){try{const a=await mL.captureAsync({width:t,height:i,name:"LeaderAvatar",renderOptions:{[n]:{name:n,type:"image",depth:0,position:[0,0],size:[t,i],image:e}}});return a?await gL.loadImage(a):null}catch(e){return null}}addLeaderToInactiveNode(e){this.inactiveNodeContainer.addChild(e),e.getComponent(J_).setOpacity(0)}}).prototype,"leaderPrefab",[Z_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),rL=ve(sL.prototype,"inactiveNodeContainer",[eL],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),lL=ve(sL.prototype,"layout",[tL],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),cL=ve(sL.prototype,"viewport",[iL],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),hL=ve(sL.prototype,"maxLeader",[nL],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),aL=sL))||aL);var bL,fL,wL,SL,vL,CL,EL,TL,AL,RL,IL,PL,_L,LL,DL,OL,NL;i._RF.pop(),i._RF.push({},"2aa67vEWR9HaJkCtpsuUyRX","LeaderboardContent",void 0);const{ccclass:ML,property:kL}=a,{storage:xL,leaderboard:FL,player:BL}=globalThis.game,{Utils:{Object:zL,Array:UL},Configs:{Leaderboards:GL}}=GameCore;let HL=(bL=ML("LeaderboardContent"),fL=kL(ps),wL=kL(JP),SL=kL(yL),vL=kL(ce),CL=kL({type:[o_]}),EL=kL(uP),TL=kL(Wn),bL((IL=ve((RL=class extends s{constructor(){super(...arguments),e(this,"panelAnimator",IL,this),e(this,"tabs",PL,this),e(this,"leaders",_L,this),e(this,"scrollview",LL,this),e(this,"leaderSkeletons",DL,this),e(this,"leaderboardIsEmpty",OL,this),e(this,"contentOpacity",NL,this),this.isHidden=!0,this.currentLb=null,this.animAbortSignal=null,this.fetchAbortController=null,this.handleUpdateVisibility=()=>{this.leaders.updateVisibility()},this.handleFriendsTabSelected=async()=>{xL.setStorageData("leaderboard_content","lastTabOpened","friends"),this.cleanupSideEffects(),await this.updateStatus("friends")},this.handleWorldTabSelected=async()=>{xL.setStorageData("leaderboard_content","lastTabOpened","global"),this.cleanupSideEffects(),await this.updateStatus("global")},this.hideContent=()=>{this.contentOpacity.changeStateFade(!1,.1)},this.showContent=()=>{this.contentOpacity.changeStateFade(!0,.1)}}onLoad(){this.uiTransform=this.getComponent(l),this.validateRequiredComponents()}validateRequiredComponents(){Fe.lazyValidateProperties(this)}enableUIAnimator(){this.panelAnimator.enabled=!0}disableUIAnimator(){this.panelAnimator.enabled=!1}listenEvents(){this.node.scene.on(Cf.FRIENDS_TAB_SELECTED,this.handleFriendsTabSelected),this.node.scene.on(Cf.WORLD_TAB_SELECTED,this.handleWorldTabSelected),this.node.scene.on(Ha.HIDE_UI,this.hideContent),this.node.scene.on(Ha.SHOW_UI,this.showContent),this.scrollview.node.on(ce.EventType.SCROLLING,this.handleUpdateVisibility)}unlistenEvents(){this.node.scene.off(Cf.FRIENDS_TAB_SELECTED,this.handleFriendsTabSelected),this.node.scene.off(Cf.WORLD_TAB_SELECTED,this.handleWorldTabSelected),this.unlistenUIEvents(),this.scrollview.node.off(ce.EventType.SCROLLING,this.handleUpdateVisibility)}unlistenUIEvents(){this.node.scene.off(Ha.HIDE_UI,this.hideContent),this.node.scene.off(Ha.SHOW_UI,this.showContent)}async loadLeaderboard(e,t){if(t.aborted)return null;const i=this.getLeaderboardName(e);return i?(await FL.requestLeaderboardAsync(i,GL.Limit),t.aborted?null:FL.getLeaderboard(i)):null}getLeaderboardName(e){return"friends"===e?Dr:Lr}async loadMoreLeaderboard(e,t){if(t.aborted)return null;const i=this.getLeaderboardName(e);return i?(await FL.loadMoreLeaderboardAsync(i,1e3),t.aborted?null:FL.getLeaderboard(i)):null}async showLoading(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.scrollview.scrollToTop(0),this.scrollview.enabled=!1,await Promise.all([this.leaderSkeletons.map(((i,n)=>i.show(n*t,e)))])}async hideLoading(e){await Promise.all(this.leaderSkeletons.map((t=>t.hide(e))))}enter(){this.listenEvents(),this.isHidden=!1;const e=xL.getStorageData("leaderboard_content","lastTabOpened");"friends"===e&&this.handleFriendsTabSelected(),"global"===e&&this.handleWorldTabSelected()}hide(){this.isHidden=!0}cleanup(){this.unlistenEvents(),this.cleanupSideEffects()}cleanupSideEffects(){this.animAbortSignal?.abort(),this.animAbortSignal=null,this.fetchAbortController?.abort(),this.fetchAbortController=null,this.leaders.removeLeaders(),this.leaderboardIsEmpty.hide()}isAborted(){const e=this.animAbortSignal?.aborted??!0,t=this.fetchAbortController?.signal.aborted??!0;return e||t}async updateStatus(e){if(null!==this.animAbortSignal||null!==this.fetchAbortController)throw new Error("LeaderboardContent: LeaderboardContent is already loading. Please handle cancelling gracefully.");if(this.isHidden)return;if(this.tabs.updateStatus(e),this.animAbortSignal=new oi,this.fetchAbortController=new AbortController,await this.showLoading(this.animAbortSignal),this.currentLb=await this.loadLeaderboard(e,this.animAbortSignal),!this.currentLb)return;if(0===zL.vals(this.currentLb.leaders).length)return this.leaderboardIsEmpty.show(),this.tabs.setInteractableButtons(!0),void this.hideLoading(this.animAbortSignal);const t=BL.getPlayerId();let i=this.currentLb.leaders[t];if(!i){const n=this.getLeaderboardName(e);if(n){const e=await FL.getLeadersByPlayerIdsAsync(n,[t]);e.length>0&&(i=e[0],this.currentLb.leaders[t]=i)}}const{previousScore:n,previousRank:a}=xL.getStorage("leaderboard_content"),{score:s,rank:o}=i??{};n&&n<s&&a&&a!==o&&(this.currentLb.leaders[t].score=n);const r=zL.vals(this.currentLb.leaders);if(hi.setBlockInput(!0),this.tabs.setInteractableButtons(!1),await this.hideLoading(this.animAbortSignal),this.isAborted())return hi.setBlockInput(!1),void this.tabs.setInteractableButtons(!0);if(this.leaders.updateData(r),this.scrollview.enabled=!0,await this.leaders.showLeaders(this.animAbortSignal),this.isAborted())return hi.setBlockInput(!1),void this.tabs.setInteractableButtons(!0);const l=this.leaders.getPlayerLeader();return l?(await this.scrollToLeader(l,1),this.isAborted()?(hi.setBlockInput(!1),void this.tabs.setInteractableButtons(!0)):(await this.runPlayerRankChangeAnimation(this.animAbortSignal,s),this.isAborted()?(hi.setBlockInput(!1),void this.tabs.setInteractableButtons(!0)):(xL.setStorageData("leaderboard_content","previousScore",s),xL.setStorageData("leaderboard_content","previousRank",o),hi.setBlockInput(!1),void this.tabs.setInteractableButtons(!0)))):(hi.setBlockInput(!1),void this.tabs.setInteractableButtons(!0))}async runPlayerRankChangeAnimation(e,t){const{previousScore:i}=xL.getStorage("leaderboard_content");if(!i||i>=t)return;const n=this.leaders.getLeaderData(),a=UL.searchIndex(n,(e=>e.playerId===BL.getPlayerId()));if(-1===a)return;const s=n[a],{score:o,rank:r}=s;s.score=t,n.sort(((e,t)=>t.score-e.score)),n.forEach(((e,t)=>{e.rank=t+1}));const l=this.leaders.getPlayerLeader();if(!l)return;if(r===s.rank)return void l.updateScore({score:s.score,isHighlight:!0});const c=this.leaders.getLeaderByRank(s.rank);if(!c)return;this.leaders.layout.enabled=!1,await l.runScaleAnimation(e,1.1,.5);const h=Math.min(.5*(r-s.rank),2),d=[l.runUpdateDataAnimation(r,s.rank,o,s.score,h),this.scrollToLeader(c,h)],u=this.uiTransform.contentSize.height,p=this.scrollview.getMaxScrollOffset().y,m=-c.node.position.y-u/2;let g=j.ZERO;m<0?g=new j(l.node.worldPosition.x,u+c.node.position.y,l.node.worldPosition.z):this.scrollview.getScrollOffset().y>=p-5&&(g=m<p?new j(l.node.worldPosition.x,u/2,l.node.worldPosition.z):c.node.worldPosition),g.equals(j.ZERO)||d.push(l.runWorldPositionAnimation(g,h)),await Promise.all(d),await Promise.all([l.runScaleAnimation(e,1,.25),l.node.setSiblingIndex(s.rank-1),this.leaders.runUpdateLeadersRankAnimation(s.rank,r)]),this.leaders.layout.enabled=!0,this.leaders.layout.updateLayout()}async scrollToLeader(e,t){const{contentSize:i}=this.uiTransform,n=new J(0,-e.node.position.y-i.height/2),a=this.scrollview.getScrollOffset().clone();n.y=Math.max(n.y,0),a.y=Math.max(a.y,0);const s=n.y-a.y;if(!(Math.abs(s)<5))return this.scrollview.scrollToOffset(n,t),vt.waitTweenAsync(t)}}).prototype,"panelAnimator",[fL],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),PL=ve(RL.prototype,"tabs",[wL],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_L=ve(RL.prototype,"leaders",[SL],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),LL=ve(RL.prototype,"scrollview",[vL],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),DL=ve(RL.prototype,"leaderSkeletons",[CL],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),OL=ve(RL.prototype,"leaderboardIsEmpty",[EL],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),NL=ve(RL.prototype,"contentOpacity",[TL],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),AL=RL))||AL);var VL;i._RF.pop(),i._RF.push({},"ae514KD4phHMYC0AD3CIw68","LeaderboardPage",void 0);const{ccclass:qL}=a;qL("LeaderboardPage")(VL=class extends zC{async mount(){if(!this.pagePrefab){const e=await hi.loadPrefabAsync(ri.LEADERBOARD_PAGE);e&&this.node&&(this.pagePrefab=e)}if(await super.mount(),this.containerUIOpacity.opacity=0,this.content=this.container.getComponentInChildren(HL),!this.content)throw new Error("LeaderboardPage: Leaders not found")}async transitionIn(){await super.transitionIn(),this.content.enableUIAnimator();const e=vt.runTweenAsync(C(this.containerUIOpacity).to(.2,{opacity:255})),t=new Promise((e=>{this.node.scene.emit(Ha.SHOW_UI,{onComplete:()=>{e()}})}));await Promise.all([e,t]),this.content.enter()}async transitionOut(){await super.transitionOut(),this.content.unlistenUIEvents(),await new Promise((e=>{this.node.scene.emit(Ha.HIDE_UI,{onComplete:()=>{e()}})})),this.content.disableUIAnimator()}unmount(){this.content?.hide(),this.content?.cleanup(),super.unmount()}});var WL,KL,YL,jL,XL,$L,JL,QL,ZL,eD,tD,iD,nD,aD,sD,oD,rD;i._RF.pop(),i._RF.push({},"8cd04RxbahLDaxq9FJf6hBh","TournamentBlock",void 0);const{ccclass:lD,property:cD}=a,{leaderboard:hD,player:dD}=globalThis.game,{Utils:{Time:uD}}=GameCore;let pD=(WL=lD("TournamentBlock"),KL=cD(n),YL=cD(h),jL=cD(h),XL=cD(h),$L=cD(h),JL=cD(l),QL=cD({type:[R]}),WL((tD=ve((eD=class extends s{constructor(){super(...arguments),e(this,"container",tD,this),e(this,"titleLabel",iD,this),e(this,"timeLabel",nD,this),e(this,"playerCountLabel",aD,this),e(this,"playButtonLabel",sD,this),e(this,"uiTransform",oD,this),e(this,"banners",rD,this)}onLoad(){this.uiOpacity=this.node.getComponent(x),this.validateRequiredComponents()}activateThemeBanner(e){let t=!1;this.banners.forEach((i=>{i.node.active=i.node.name.toLowerCase()===e,i.node.active&&(t=!0)})),t||this.banners.forEach((e=>{e.node.active=e.node.name.toLowerCase()===tl.SUMMER}))}validateRequiredComponents(){Fe.lazyValidateProperties(this)}async updateInfo(e){this.payload=e;const{endTime:t,title:i}=e,{leaderboardId:n,themeId:a}=e.payload;if(!n)return;this.setPlayerCountWaiting(),this.updateTitle(i),this.updateEndTime(t),this.updateTournamentBanner(a);let s={leaders:[],isPlayerInTournament:!1};try{const e=await this.getLeadersPayload(n);e&&(s=e)}catch(e){console.error(`Fetch lb for tournament ${i}`,e)}this.leadersPayload=s;const{leaders:o,isPlayerInTournament:r}=this.leadersPayload,l=o.length;this.updatePlayerCount(l),this.updatePlayButtonLabel(r)}updateTitle(e){e&&(this.titleLabel.string=e)}updateEndTime(e){const t=uD.getRelativeTime(e);this.timeLabel.string=`Ends ${t}`}updatePlayerCount(e){this.playerCountLabel.string=`${e} `+(e>1?"players":"player")}setPlayerCountWaiting(){this.playerCountLabel.string="Loading..."}updateTournamentBanner(e){e?this.activateThemeBanner(e):this.activateThemeBanner(tl.SUMMER)}updatePlayButtonLabel(e){this.playButtonLabel.string=e?"Continue":"Join"}async getLeadersPayload(e){const t=hD.getLeaderboardName(e);if(!t)return null;await hD.requestLeaderboardAsync(t,0);const i=hD.getLeaderboard(t);if(!i)return null;const n=GameCore.Utils.Object.vals(i.leaders),a=dD.getPlayerId(),s={leaders:[],player:void 0,isPlayerInTournament:!1};for(const e of n){const{playerId:t}=e;t===a?(s.player=e,s.isPlayerInTournament=!0,s.leaders.push(e)):s.leaders.push(e)}return s}async runShowPopUpAnimation(e,t,i){this.node.scale=new j(.8,.8,.8),this.uiOpacity.opacity=0;const n=this.container.position.clone();this.container.position=new j(n.x,n.y-100,n.z);const a=C(this.node).delay(e);a.to(t,{scale:j.ONE},{easing:"elasticOut"});const s=C(this.container).delay(e);s.to(t,{position:n},{easing:"backOut"});const o=C(this.uiOpacity).delay(e);o.to(t,{opacity:255},{easing:"cubicOut"}),i.addAbortListener((()=>{this.node.scale=j.ONE,this.container.position=n,this.uiOpacity.opacity=255})),await Promise.all([vt.runTweenAsync(a,i),vt.runTweenAsync(s,i),vt.runTweenAsync(o,i)])}handleOnTournamentClicked(){const e=this.payload.id||"";if(Ql.validateTournamentExpired(e))return this.node.scene.emit(Gr.RELOAD_TOURNAMENT),void Wl.showNotificationScreen("Tournament has ended",2);try{const e=JSON.stringify(this.payload);Wl.showTournamentDetailScreen(e,"tournament_start")}catch(e){console.warn("handleOnTournamentClicked",e)}}}).prototype,"container",[KL],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),iD=ve(eD.prototype,"titleLabel",[YL],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),nD=ve(eD.prototype,"timeLabel",[jL],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),aD=ve(eD.prototype,"playerCountLabel",[XL],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),sD=ve(eD.prototype,"playButtonLabel",[$L],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),oD=ve(eD.prototype,"uiTransform",[JL],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),rD=ve(eD.prototype,"banners",[QL],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),ZL=eD))||ZL);var mD,gD,yD,bD,fD;i._RF.pop(),i._RF.push({},"a409buwLfZLQq7cmBGiqhF5","TournamentBlockSkeleton",void 0);const{ccclass:wD,property:SD}=a;let vD=(mD=wD("TournamentBlockSkeleton"),gD=SD(n),mD((fD=ve((bD=class extends s{constructor(){super(...arguments),e(this,"container",fD,this)}__preload(){this.uiOpacity=this.getComponent(x),this.validateRequiredComponents()}validateRequiredComponents(){Fe.lazyValidateProperties(this)}async hide(e){await vt.runTweenAsync(C(this.uiOpacity).to(.2,{opacity:0}).call((()=>{this.node.active=!1})),e)}async show(e,t){this.node.active=!0,this.node.scale=new j(.8,.8,.8),this.uiOpacity.opacity=0;const i=this.container.position.clone();this.container.position=new j(i.x,i.y-100,i.z);const n=C(this.node).delay(e);n.to(.2,{scale:j.ONE},{easing:"elasticOut"});const a=C(this.container).delay(e);a.to(.2,{position:i},{easing:"backOut"});const s=C(this.uiOpacity).delay(e);s.to(.2,{opacity:255},{easing:"cubicOut"}),t.addAbortListener((()=>{this.node.scale=j.ONE,this.container.position=i,this.uiOpacity.opacity=255})),await Promise.all([vt.runTweenAsync(n,t),vt.runTweenAsync(a,t),vt.runTweenAsync(s,t)])}}).prototype,"container",[gD],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),yD=bD))||yD);var CD,ED,TD,AD,RD,ID,PD,_D,LD,DD,OD;i._RF.pop(),i._RF.push({},"5f82fye3oxHQrxKbP9TC2di","TournamentsBoard",void 0);const{ccclass:ND,property:MD}=a,{player:kD}=globalThis.game;let xD=(CD=ND("TournamentsBoard"),ED=MD(_),TD=MD(n),AD=MD(T),RD=MD(n),CD((_D=ve((PD=class extends s{constructor(){super(...arguments),e(this,"tournamentBlockPrefab",_D,this),this.tournamentBlockArray=[],e(this,"inactiveNodeContainer",LD,this),e(this,"layout",DD,this),e(this,"createTournamentButton",OD,this)}onLoad(){this.uiTransform=this.getComponent(l),this.uiOpacity=this.getComponent(x),this.validateRequiredComponents()}start(){for(let e=0;e<20;e++)this.addTournamentBlock();this.tournamentBlockContentHeight=this.tournamentBlockArray[0].uiTransform.contentSize.height+this.layout.spacingY}validateRequiredComponents(){Fe.lazyValidateProperties(this)}updateData(e){let t=!1;e.forEach(((e,i)=>{let n=this.tournamentBlockArray[i];e.payload.playerId===kD.getPlayerId()&&(t=!0),n||(n=this.addTournamentBlock()),n.updateInfo(e),this.layout.node.addChild(n.node)})),t||this.setCreateTournamentButtonActive(!0)}addTournamentBlock(){const e=c(this.tournamentBlockPrefab);this.inactiveNodeContainer.addChild(e);const t=e.getComponent(pD);return this.tournamentBlockArray.push(t),t}removeTournamentBlocks(){this.getActiveTournamentBlocks().forEach((e=>{this.inactiveNodeContainer.addChild(e.node)})),this.setCreateTournamentButtonActive(!1)}getActiveTournamentBlocks(){return this.tournamentBlockArray.filter((e=>e.node.parent===this.layout.node))}setCreateTournamentButtonActive(e){e?this.layout.node.addChild(this.createTournamentButton):this.layout.node.removeChild(this.createTournamentButton),this.createTournamentButton.active=e}async showTournamentBlocks(e,t){const i=this.getActiveTournamentBlocks();if(i.length<1)return;const n=Math.ceil(e/this.tournamentBlockContentHeight),a=Math.min(i.length,n);await Promise.all(i.map((async(e,i)=>{i>=a?await e.runShowPopUpAnimation(.1*i,.3,t):e.uiOpacity.opacity=255})))}updateVisibility(){const{yMax:e,yMin:t}=this.uiTransform.getBoundingBoxToWorld();this.getActiveTournamentBlocks().forEach((i=>{const n=i.uiTransform;if(void 0===n)return;const{yMax:a,yMin:s}=n.getBoundingBoxToWorld(),o=a<t||s>e;i.uiOpacity.opacity=o?0:255}))}}).prototype,"tournamentBlockPrefab",[ED],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),LD=ve(PD.prototype,"inactiveNodeContainer",[TD],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),DD=ve(PD.prototype,"layout",[AD],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),OD=ve(PD.prototype,"createTournamentButton",[RD],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ID=PD))||ID);var FD,BD,zD,UD,GD;i._RF.pop(),i._RF.push({},"f8a7b0St3FAkb1PvvvJTLCh","TournamentsNotAvailable",void 0);const{ccclass:HD,property:VD}=a;let qD=(FD=HD("TournamentsNotAvailable"),BD=VD(p),FD((GD=ve((UD=class extends s{constructor(){super(...arguments),e(this,"createButton",GD,this)}onLoad(){this.uiOpacity=this.getComponent(x),this.validateRequiredComponents()}validateRequiredComponents(){Fe.lazyValidateProperties(this)}async show(){this.createButton.interactable=!0,this.uiOpacity.opacity=255;const e=this.node.position.clone(),t=C(this.node);t.to(.05,{position:e.clone().add3f(5,0,0)}),t.to(.05,{position:e.clone().add3f(-5,0,0)});const i=C(this.node).repeat(2,t);i.to(.05,{position:e}),await vt.runTweenAsync(i)}hide(){this.createButton.interactable=!1,this.uiOpacity.opacity=0}}).prototype,"createButton",[BD],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),zD=UD))||zD);var WD,KD,YD,jD,XD,$D,JD,QD,ZD,eO,tO,iO,nO,aO,sO;i._RF.pop(),i._RF.push({},"199fcQ5IEZFbJCfSrGNrGDQ","TournamentContent",void 0);const{ccclass:oO,property:rO}=a,{storage:lO,match:cO}=globalThis.game,{Utils:{Object:hO,Array:dO}}=GameCore;let uO=(WD=oO("TournamentContent"),KD=rO({type:ps}),YD=rO(xD),jD=rO(qD),XD=rO(ce),$D=rO({type:[vD]}),JD=rO(Wn),WD((eO=ve((ZD=class extends s{constructor(){super(...arguments),e(this,"panelAnimator",eO,this),e(this,"tournamentsBoard",tO,this),e(this,"tournamentsNotAvailable",iO,this),e(this,"scrollView",nO,this),e(this,"skeletons",aO,this),e(this,"contentOpacity",sO,this),this.animAbortSignal=null,this.softAbortSignal=null,this.hideContent=()=>{this.contentOpacity.changeStateFade(!1,.1)},this.showContent=()=>{this.contentOpacity.changeStateFade(!0,.1)}}onLoad(){this.uiTransform=this.node.getComponent(l),this.validateRequiredComponents()}validateRequiredComponents(){Fe.lazyValidateProperties(this)}listenEvents(){this.scrollView.node.on(ce.EventType.SCROLLING,this.onScrolling,this),this.node.scene.on(Gr.RELOAD_TOURNAMENT,this.reload,this),this.node.scene.on(Ha.HIDE_UI,this.hideContent),this.node.scene.on(Ha.SHOW_UI,this.showContent)}unlistenEvents(){this.scrollView.node.off(ce.EventType.SCROLLING,this.onScrolling,this),this.node.scene.off(Gr.RELOAD_TOURNAMENT,this.reload,this),this.unlistenUIEvents()}unlistenUIEvents(){this.node.scene.off(Ha.HIDE_UI,this.hideContent),this.node.scene.off(Ha.SHOW_UI,this.showContent)}onScrolling(){this.tournamentsBoard.updateVisibility()}enableUIAnimator(){this.panelAnimator.enabled=!0}disableUIAnimator(){this.panelAnimator.enabled=!1}async enter(){if(this.listenEvents(),null!==this.animAbortSignal||null!==this.softAbortSignal)throw new Error("TournamentContent: TournamentContent is already running");if(this.animAbortSignal=new oi,this.softAbortSignal=new oi,await this.showLoading(this.animAbortSignal),this.isAborted())return;const e=await Ql.requestTournamentDataAsync();this.isAborted()||(await this.hideLoading(this.animAbortSignal),this.isAborted()||(0!==e.length||this.softAbortSignal?.aborted?(this.tryShowTournamentResult(),this.scrollView.enabled=!0,this.tournamentsBoard.updateData(e),await this.tournamentsBoard.showTournamentBlocks(this.uiTransform.contentSize.height-this.tournamentsBoard.layout.paddingTop,this.animAbortSignal)):this.tournamentsNotAvailable.show()))}async showLoading(e){this.scrollView.scrollToTop(0),this.scrollView.enabled=!1,await Promise.all([this.skeletons.map((t=>t.show(0,e)))])}async hideLoading(e){await Promise.all([this.skeletons.map((t=>t.hide(e)))])}tryShowTournamentResult(){try{const{animateTournamentLeader:e}=lO.getStorage("tournament");if(!e)return;const t=Ql.getAllTournamentData(),{tournamentId:i}=cO.getMatchState().customData;if(!i)throw new Error("Tournament ID not found");const n=dO.search(t,(e=>e.id===i));if(!n)throw new Error("Tournament not found");const a=JSON.stringify(n);Wl.showTournamentDetailScreen(a,"tournament_end")}catch(e){lO.setStorageData("tournament","animateTournamentLeader",!1),console.warn("showTournamentResult",e)}}async processCreateTournament(){try{await Sl.processCreateTournamentAsync()}catch(e){if(!hO.hasOwn(e,"code"))return void Wl.showNotificationScreen("Sorry. Unknown error. Failed to Create Tournament");if("USER_INPUT"===e.code)return;"INVALID_OPERATION"===e.code?Wl.showNotificationScreen(e.message):Wl.showNotificationScreen("Sorry. Unknown error. Failed to Create Tournament")}this.reload()}isAborted(){return this.animAbortSignal?.aborted??!0}cleanup(){this.unlistenEvents(),this.animAbortSignal?.abort(),this.animAbortSignal=null,this.tournamentsBoard.removeTournamentBlocks(),this.tournamentsNotAvailable.hide()}softAbort(){this.softAbortSignal?.abort(),this.softAbortSignal=null}reload(){this.softAbort(),this.cleanup(),this.enter()}}).prototype,"panelAnimator",[KD],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),tO=ve(ZD.prototype,"tournamentsBoard",[YD],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),iO=ve(ZD.prototype,"tournamentsNotAvailable",[jD],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),nO=ve(ZD.prototype,"scrollView",[XD],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),aO=ve(ZD.prototype,"skeletons",[$D],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),sO=ve(ZD.prototype,"contentOpacity",[JD],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),QD=ZD))||QD);var pO;i._RF.pop(),i._RF.push({},"bce5eh0LHVP2bCJ6u+kFjuA","TournamentPage",void 0);const{ccclass:mO}=a;mO("TournamentPage")(pO=class extends zC{async mount(){if(!this.pagePrefab){const e=await hi.loadPrefabAsync(ri.TOURNAMENTS_PAGE);e&&this.node&&(this.pagePrefab=e)}if(await super.mount(),this.containerUIOpacity.opacity=0,this.content=this.container.getComponentInChildren(uO),!this.content)throw new Error("LeaderboardPage: Leaders not found")}async transitionIn(){await super.transitionIn(),this.content.enableUIAnimator();const e=vt.runTweenAsync(C(this.containerUIOpacity).to(.2,{opacity:255})),t=new Promise((e=>{this.node.scene.emit(Ha.SHOW_UI,{onComplete:()=>{e()}})}));await Promise.all([e,t]),this.content.enter()}async transitionOut(){this.content?.softAbort(),this.content.unlistenUIEvents(),await super.transitionOut(),await new Promise((e=>{this.node.scene.emit(Ha.HIDE_UI,{onComplete:()=>{e()}})})),this.content.disableUIAnimator()}unmount(){this.content?.cleanup(),super.unmount()}});var gO,yO,bO,fO,wO,SO;i._RF.pop(),i._RF.push({},"b8271vI+3pO9q8SKMYpqLKv","EventBadge",void 0);const{ccclass:vO,property:CO}=a;gO=vO("EventBadge"),yO=CO(h),bO=CO(b),gO((SO=ve((wO=class extends s{constructor(){super(...arguments),e(this,"label",SO,this)}get text(){return this.label.string}set text(e){this.label.string=e}onLoad(){this.validateRequiredComponents()}validateRequiredComponents(){if(!this.label)throw new Error("EventBadge: Missing required component Label")}}).prototype,"label",[yO],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ve(wO.prototype,"text",[bO],Object.getOwnPropertyDescriptor(wO.prototype,"text"),wO.prototype),fO=wO));var EO,TO,AO,RO,IO,PO,_O,LO,DO;i._RF.pop(),i._RF.push({},"7712cs4XLJAgpKqlO3gPqkF","EventProgressBar",void 0);const{ccclass:OO,property:NO}=a;EO=OO("EventProgressBar"),TO=NO(Hs),AO=NO(h),RO=NO(b),IO=NO({range:[0,1,.01],slide:!0,tooltip:"i18n:progress.progress"}),EO((LO=ve((_O=class extends s{constructor(){super(...arguments),e(this,"progressBar",LO,this),e(this,"progressLabel",DO,this)}get text(){return this.progressLabel.string}get progress(){return this.progressBar.progress}set progress(e){this.progressBar.progress=e}set text(e){this.progressLabel.string=e}__preload(){}onLoad(){this.validateRequiredComponents()}validateRequiredComponents(){if(!this.progressBar)throw new Error("EventProgressBar: Missing required component TapperedProgressBar");if(!this.progressLabel)throw new Error("EventProgressBar: Missing required component Label")}}).prototype,"progressBar",[TO],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),DO=ve(_O.prototype,"progressLabel",[AO],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ve(_O.prototype,"text",[RO],Object.getOwnPropertyDescriptor(_O.prototype,"text"),_O.prototype),ve(_O.prototype,"progress",[IO],Object.getOwnPropertyDescriptor(_O.prototype,"progress"),_O.prototype),PO=_O));var MO,kO,xO,FO,BO,zO,UO,GO,HO,VO,qO,WO,KO,YO,jO,XO,$O,JO,QO,ZO,eN,tN,iN,nN,aN,sN,oN,rN,lN,cN,hN,dN,uN,pN,mN,gN,yN,bN,fN,wN,SN,vN,CN,EN,TN;i._RF.pop(),i._RF.push({},"7741dWPNcdHRqGVvif/L/MP","NavButton",void 0);const{ccclass:AN,property:RN,executeInEditMode:IN}=a,{analytics:PN}=globalThis.game,{Plugins:{Analytics:{Events:_N}}}=GameCore;MO=AN("NavButton"),kO=RN(H),xO=RN({group:{name:"Animation"},displayName:"Is Selected",tooltip:"This is for the editor only and will be ignored at runtime",editorOnly:!0}),FO=RN({type:E,group:{name:"Animation"}}),BO=RN({type:E,group:{name:"Animation"}}),zO=RN({type:E,group:{name:"Animation"}}),UO=RN({type:E,group:{name:"Animation"}}),GO=RN({type:E,group:{name:"Animation"}}),HO=RN({group:{name:"Animation"}}),VO=RN({type:E,group:{name:"Animation"}}),qO=RN({type:E,group:{name:"Animation"}}),WO=RN({group:{name:"Animation"}}),KO=RN({type:E,group:{name:"Animation"}}),YO=RN({type:E,group:{name:"Animation"}}),jO=RN({type:E,group:{name:"Animation"}}),XO=RN({type:E,group:{name:"Animation"}}),$O=RN({type:l}),JO=RN(n),QO=RN(x),ZO=RN({type:l}),eN=RN({type:M(ai)}),tN=RN(PI),MO(iN=IN((aN=ve((nN=class extends s{constructor(){super(...arguments),e(this,"wip",aN,this),e(this,"isSelectedInEditor",sN,this),e(this,"animationDuration",oN,this),e(this,"selectedSpacing",rN,this),e(this,"deselectedSpacing",lN,this),e(this,"selectedIconY",cN,this),e(this,"selectedIconX",hN,this),e(this,"selectedIconScale",dN,this),e(this,"deselectedIconY",uN,this),e(this,"deselectedIconX",pN,this),e(this,"deselectedIconScale",mN,this),e(this,"selectedTextY",gN,this),e(this,"selectedTextX",yN,this),e(this,"deselectedTextY",bN,this),e(this,"deselectedTextX",fN,this),e(this,"spacer",wN,this),e(this,"icon",SN,this),e(this,"text",vN,this),e(this,"uiTransform",CN,this),e(this,"screenType",EN,this),e(this,"navManager",TN,this),this.isSelected=!1,this.onMouseEnter=e=>{this.isSelected||this.playHoverOnAnimation()},this.onMouseLeave=e=>{this.isSelected||this.playHoverOffAnimation()}}get isWIP(){return this.wip}get buttonType(){return this.screenType}update(){}onEnable(){this.node.on(n.EventType.MOUSE_ENTER,this.onMouseEnter),this.node.on(n.EventType.MOUSE_LEAVE,this.onMouseLeave)}onDisable(){this.node.off(n.EventType.MOUSE_ENTER,this.onMouseEnter),this.node.off(n.EventType.MOUSE_LEAVE,this.onMouseLeave)}onEditorUpdate(){null!==this.icon&&void 0!==this.icon&&null!==this.text&&void 0!==this.icon&&null!==this.spacer&&void 0!==this.spacer&&(this.isSelectedInEditor?(this.icon.setScale(this.selectedIconScale),this.icon.setPosition(this.selectedIconX,this.selectedIconY,0),this.text.node.setPosition(this.selectedTextX,this.selectedTextY,0),this.spacer.width=this.selectedSpacing,this.text.opacity=255):(this.icon.setScale(this.deselectedIconScale),this.icon.setPosition(this.deselectedIconX,this.deselectedIconY,0),this.text.node.setPosition(this.deselectedTextX,this.deselectedTextY,0),this.spacer.width=this.deselectedSpacing,this.text.opacity=0))}setSelected(){this.isSelected||(Xi.playSound(Bi.PATCH_SHIFT),this.navManager.selectUsingSceneTransition(this),PN.event(_N.BUTTON_CLICK,{button_name:this.node.parent?.name??this.node.name,screen_name:ji.getCurrentPage()}))}async select(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(this.isSelected)throw new Error("NavButton: Already selected");this.isSelected=!0,e?await vt.runTweenAsync(this.playSelectAnimation()):(this.icon.setScale(this.selectedIconScale),this.icon.setPosition(this.selectedIconX,this.selectedIconY,0),this.text.node.setPosition(this.selectedTextX,this.selectedTextY,0),this.spacer.width=this.selectedSpacing,this.text.opacity=255)}async deselect(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this.isSelected&&!t)throw new Error("NavButton: Already deselected");this.isSelected=!1,e?await vt.runTweenAsync(this.deselectAnimation()):(this.icon.setScale(this.deselectedIconScale),this.icon.setPosition(this.deselectedIconX,this.deselectedIconY,0),this.text.node.setPosition(this.deselectedTextX,this.deselectedTextY,0),this.spacer.width=this.deselectedSpacing,this.text.opacity=0)}getSelectedWorldDistanceX(){const e=new j(this.selectedIconX,this.selectedIconY,0),t=new j(this.deselectedIconX,this.deselectedIconY,0),i=this.node.scale.clone();this.node.scale=this.selectedIconScale;const n=this.uiTransform.convertToWorldSpaceAR(e),a=this.uiTransform.convertToWorldSpaceAR(t);return this.node.scale=i,a.x-n.x}playHoverOnAnimation(){const e=C(this.icon);return e.to(.1,{scale:this.deselectedIconScale.clone().add3f(.1,.1,0)},{easing:"cubicIn"}),vt.runTweenAsync(e)}playHoverOffAnimation(){const e=C(this.icon);return e.to(.1,{scale:this.deselectedIconScale},{easing:"cubicOut"}),vt.runTweenAsync(e)}playSelectAnimation(){return C(this.spacer).to(this.animationDuration,{width:this.selectedSpacing},{easing:"linear",onUpdate:(e,t)=>{if(void 0===t)return;const i=k.quintInOut(t),n=k.backOut(t),a=k.linear(t),s=t<.5?2*t:1,o=this.deselectedIconY+(this.selectedIconY-this.deselectedIconY)*n,r=this.deselectedIconX+(this.selectedIconX-this.deselectedIconX)*a;this.icon.setPosition(r,o,0);const l=this.deselectedIconScale.clone().lerp(this.selectedIconScale,i);this.icon.setScale(l.x,l.y,this.icon.scale.z);const c=255*s,h=this.deselectedTextY+(this.selectedTextY-this.deselectedTextY)*a,d=this.deselectedTextX+(this.selectedTextX-this.deselectedTextX)*a;this.text.opacity=c,this.text.node.setPosition(d,h,0)}})}deselectAnimation(){return C(this.spacer).to(this.animationDuration,{width:this.deselectedSpacing},{easing:"linear",onUpdate:(e,t)=>{if(void 0===t)return;const i=he(this.selectedIconY,this.deselectedIconY,t),n=he(this.selectedIconX,this.deselectedIconX,t);this.icon.setPosition(n,i,0);const a=he(255,0,t<.5?2*t:1);this.text.opacity=a;const s=he(this.selectedTextY,this.deselectedTextY,t),o=he(this.selectedTextX,this.deselectedTextX,t);this.text.node.setPosition(o,s,0);const r=this.selectedIconScale.clone().lerp(this.deselectedIconScale,k.quintInOut(t));this.icon.setScale(r.x,r.y,this.icon.scale.z)}})}onLoad(){this.uiTransform=this.getComponent(l),this.validateRequiredComponents()}validateRequiredComponents(){Fe.lazyValidateProperties(this)}}).prototype,"wip",[kO],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),sN=ve(nN.prototype,"isSelectedInEditor",[xO],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),oN=ve(nN.prototype,"animationDuration",[FO],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.3}}),rN=ve(nN.prototype,"selectedSpacing",[BO],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 150}}),lN=ve(nN.prototype,"deselectedSpacing",[zO],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 88}}),cN=ve(nN.prototype,"selectedIconY",[UO],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 20}}),hN=ve(nN.prototype,"selectedIconX",[GO],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),dN=ve(nN.prototype,"selectedIconScale",[HO],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new j(1,1,1)}}),uN=ve(nN.prototype,"deselectedIconY",[VO],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),pN=ve(nN.prototype,"deselectedIconX",[qO],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),mN=ve(nN.prototype,"deselectedIconScale",[WO],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new j(.8,.8,1)}}),gN=ve(nN.prototype,"selectedTextY",[KO],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return-10}}),yN=ve(nN.prototype,"selectedTextX",[YO],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),bN=ve(nN.prototype,"deselectedTextY",[jO],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),fN=ve(nN.prototype,"deselectedTextX",[XO],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),wN=ve(nN.prototype,"spacer",[$O],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),SN=ve(nN.prototype,"icon",[JO],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),vN=ve(nN.prototype,"text",[QO],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),CN=ve(nN.prototype,"uiTransform",[ZO],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),EN=ve(nN.prototype,"screenType",[eN],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),TN=ve(nN.prototype,"navManager",[tN],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),iN=nN))||iN);var LN,DN,ON,NN,MN,kN,xN;i._RF.pop(),i._RF.push({},"9b83boaSv9PE6mRFqy0MSI8","GameScene",void 0);const{ccclass:FN,property:BN,disallowMultiple:zN}=a,{audio:UN,player:GN}=globalThis.game,{Layout:HN}=na;LN=FN("GameScene"),DN=BN(Nv),ON=BN(qw),LN(NN=zN((kN=ve((MN=class extends s{constructor(){super(...arguments),e(this,"animSkipOverlay",kN,this),e(this,"coinManager",xN,this),this.handleGameExit=()=>{Rg.hideBannerAds(),El.switchScene(zr)},this.handleShowResults=()=>{El.switchScene(Ur)},this.handleGameMaskWhenLayoutChanged=e=>{const t=P("Canvas/Game/GameObjects");if(!t)return;const i=t.getComponent(de);i&&(i.enabled=e===HN.Landscape)},this.attemptCallSubscribeBot=()=>{"subscribeBotAsync"in GameSDK.extra&&GameSDK.extra.subscribeBotAsync().catch((e=>{console.warn("subscribeBotAsync",e)}))}}__preload(){this.validateRequiredComponents(),this.listenGameEvents(),Rg.showBannerAds()}onLoad(){this.coinManager.init(this.animSkipOverlay)}validateRequiredComponents(){Fe.lazyValidateProperties(this)}listenGameEvents(){W.on(Xn,this.handleGameMaskWhenLayoutChanged),this.node.scene.on(Ha.GAME_EXIT,this.handleGameExit),this.node.scene.on(Ha.SHOW_CHALLENGE_RESULTS,this.handleShowResults)}start(){this.scheduleOnce(this.attemptCallSubscribeBot,.5),GN.getPlayerSetting("music")&&Xi.playMusic(),this.updateVolumeBackgroundMusic(),this.scheduleOnce(this.preloadScenes,2)}preloadScenes(){El.preloadDashboardScene()}updateVolumeBackgroundMusic(){UN.setVolume(1,"global_music")}}).prototype,"animSkipOverlay",[DN],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),xN=ve(MN.prototype,"coinManager",[ON],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),NN=MN))||NN);var VN,qN,WN,KN,YN,jN,XN,$N,JN,QN,ZN,eM,tM,iM,nM;i._RF.pop(),i._RF.push({},"48081huyTZGu5rme4u8PrdR","Item",void 0);const{ccclass:aM,property:sM}=a;VN=aM("ItemButton"),qN=sM(H),WN=sM(p),KN=sM({type:f}),YN=sM(h),jN=sM(n),XN=sM(n),VN((QN=ve((JN=class extends s{constructor(){super(...arguments),e(this,"isDebug",QN,this),e(this,"button",ZN,this),e(this,"quantity",eM,this),e(this,"quantityLabel",tM,this),e(this,"plusNode",iM,this),e(this,"quantityNode",nM,this)}__preload(){this.item=this.getComponent(rg),this.validateRequiredComponents()}start(){this.quantity=this.item.loadQuantity(),this.quantityLabel.string=`${this.quantity}`,this.validateButton(),this.node.scene.on(Ha.GRID_CREATE,this.validateButton,this),this.node.scene.on(Ha.GRID_MATCH_SUCCESS,this.validateButton,this),this.node.scene.on(Ha.GRID_CLEAR,this.validateButton,this)}validateRequiredComponents(){if(!this.item)throw new Error("Item: BaseItem component not found");if(!this.button)throw new Error("Item: Button component not found");if(!this.quantityLabel)throw new Error("Item: Quantity label not found");if(!this.plusNode)throw new Error("Item: Plus node not found");if(!this.quantityNode)throw new Error("Item: Quantity node not found")}validateButton(){console.log("VALIDATE BUTTON"),this.canActivate().then((e=>{this.button.interactable=!0,this.plusNode.active=0==this.quantity,this.quantityNode.active=this.quantity>0}))}activate(){return new Promise((e=>{if(this.quantity<=0)return this.handleShowAddItemScreen(),void e();this.item.activate().then((()=>{this.isDebug||(this.quantity--,this.quantityLabel.string=`${this.quantity}`,this.item.saveQuantity()),this.validateButton(),e()}))}))}canActivate(){return Promise.resolve(!0)}addQuantity(e){this.quantity+=e,this.quantityLabel.string=`${this.quantity}`,this.item.saveQuantity(),this.validateButton()}clearQuantity(){this.quantity=0,this.quantityLabel.string=`${this.quantity}`,this.item.saveQuantity(),this.validateButton()}handleShowAddItemScreen(){Wl.openScreen(Hi.GET_ITEM_SCREEN,{item:br.HINT,quantity:1})}}).prototype,"isDebug",[qN],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),ZN=ve(JN.prototype,"button",[WN],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),eM=ve(JN.prototype,"quantity",[KN],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),tM=ve(JN.prototype,"quantityLabel",[YN],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),iM=ve(JN.prototype,"plusNode",[jN],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),nM=ve(JN.prototype,"quantityNode",[XN],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),$N=JN));var oM,rM,lM,cM,hM,dM,uM;i._RF.pop(),i._RF.push({},"0c0b4cnFOFJ6pJmGNHnMo7m","ComboEffect",void 0);const{ccclass:pM,property:mM}=a;oM=pM("ComboEffect"),rM=mM(x),lM=mM(se),oM((dM=ve((hM=class extends s{constructor(){super(...arguments),e(this,"circleOpacity",dM,this),e(this,"particle",uM,this)}onLoad(){this.validateRequiredComponents()}validateRequiredComponents(){if(!this.circleOpacity)throw new Error("ComboEffect requires a circleOpacity component");if(!this.particle)throw new Error("ComboEffect requires a particle component")}start(){this.node.scene.on(Ha.COMBO_UPDATED,this.handleOnComboUpdated,this)}handleOnComboUpdated(e){e>1&&(this.circleOpacity.node.scale=j.ZERO,this.circleOpacity.opacity=127.5,this.particle.resetSystem(),C(this.circleOpacity.node).to(.2,{scale:new j(1.3,1.3,1.3)},{easing:"quadOut"}).start(),C(this.circleOpacity).delay(.2).to(.2,{opacity:0},{easing:"expoIn"}).start())}}).prototype,"circleOpacity",[rM],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),uM=ve(hM.prototype,"particle",[lM],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),cM=hM));var gM,yM,bM,fM,wM,SM,vM;i._RF.pop(),i._RF.push({},"0506aJZ1EdPqJejQ2PpB980","ComboLabel",void 0);const{ccclass:CM,property:EM}=a;gM=CM("ComboLabel"),yM=EM(h),bM=EM(n),gM((SM=ve((wM=class extends s{constructor(){super(...arguments),e(this,"comboNumber",SM,this),e(this,"comboContainer",vM,this)}onLoad(){this.opacity=this.getComponent(x),this.validateRequiredComponents()}validateRequiredComponents(){Fe.lazyValidateProperties(this)}start(){this.node.scene.on(Ha.COMBO_UPDATED,this.handleOnComboUpdated,this)}handleOnComboUpdated(e){0===e?this.opacity.opacity=0:e>1?(this.opacity.opacity=255,this.comboNumber.string=`${e}`,C(this.comboContainer).to(.1,{scale:new j(1.3,1.3,1.3)},{easing:"sineIn"}).to(.1,{scale:j.ONE},{easing:"sineOut"}).start()):this.opacity.opacity=0}}).prototype,"comboNumber",[yM],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),vM=ve(wM.prototype,"comboContainer",[bM],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),fM=wM));var TM,AM,RM,IM,PM,_M,LM,DM,OM;i._RF.pop(),i._RF.push({},"51871oF8CFOkp81rgCf90UQ","ComboPopup",void 0);const{ccclass:NM,property:MM}=a;TM=NM("ComboPopup"),AM=MM(R),RM=MM(N),IM=MM(y),TM((LM=ve((_M=class extends s{constructor(){super(...arguments),e(this,"textSprite",LM,this),e(this,"comboSprites",DM,this),e(this,"animation",OM,this)}onLoad(){this.validateRequiredComponents()}start(){this.node.scene.on(Ha.COMBO_UPDATED,this.handleOnComboUpdated,this)}validateRequiredComponents(){if(!this.textSprite)throw new Error("ComboPopup: textSprite not found");if(0===this.comboSprites.length)throw new Error("ComboPopup: comboSprites not found");if(!this.animation)throw new Error("ComboPopup: animation not found")}handleOnComboUpdated(e){if(!(e<2))for(let t=this.comboSprites.length-1;t>=0;t--)if(e>=t+2){this.textSprite.spriteFrame=this.comboSprites[t],this.animation.play();break}}}).prototype,"textSprite",[AM],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),DM=ve(_M.prototype,"comboSprites",[RM],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),OM=ve(_M.prototype,"animation",[IM],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),PM=_M));var kM,xM,FM,BM,zM,UM,GM,HM,VM;i._RF.pop(),i._RF.push({},"a0819yK3HpO2505QqLUOChz","PlayerScore",void 0);const{ccclass:qM,property:WM}=a,{Utils:{Image:KM}}=GameCore;let YM=(kM=qM("PlayerScore"),xM=WM(n),FM=WM(h),BM=WM(R),kM((GM=ve((UM=class extends s{constructor(){super(...arguments),e(this,"crown",GM,this),e(this,"playerScore",HM,this),e(this,"avatar",VM,this)}showCrown(e){this.crown.active=e}setPlayerScore(e){this.playerScore.string=e.toString()}playWaitingAnimation(){let e=0;this.playerScore.schedule((()=>{e=(e+1)%4;const t=Array(e+1).join(".");this.playerScore.string="Waiting"+t}),.5);const t=this.playerScore.getComponent(x),i=C(t).to(1,{opacity:130},{easing:"sineInOut"}).to(1,{opacity:255},{easing:"sineInOut"}).delay(.25);this.waitingAnimation=C(t).repeatForever(i).start()}stopWaitingAnimation(){this.playerScore.unscheduleAllCallbacks(),this.waitingAnimation&&this.waitingAnimation.stop(),this.playerScore.getComponent(x).opacity=255}async loadPhoto(e){try{const t=await KM.loadImage(e);if(!t)throw new Error("Failed to load image");const i=N.createWithImage(t);if(!i)throw new Error("Failed to create sprite frame");i.packable=!0,this.avatar.spriteFrame=i}catch(e){return void console.error(e)}}}).prototype,"crown",[xM],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),HM=ve(UM.prototype,"playerScore",[FM],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),VM=ve(UM.prototype,"avatar",[BM],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),zM=UM))||zM);var jM,XM,$M,JM,QM,ZM,ek,tk,ik,nk,ak,sk,ok,rk,lk;i._RF.pop(),i._RF.push({},"4b062RYQK5PQbgs7yH66gDw","ChallengeResultScene",void 0);const{ccclass:ck,disallowMultiple:hk,property:dk}=a,{match:uk,player:pk,monitorError:mk}=globalThis.game,gk="Waiting",{Dtos:{Match:{Data:yk}}}=GameCore;jM=ck("ChallengeResultScene"),XM=dk(f),$M=dk({type:YM,group:"Score"}),JM=dk({type:YM,group:"Score"}),QM=dk(XS),ZM=dk(h),ek=dk(yg),jM(tk=hk((nk=ve((ik=class extends s{constructor(){super(...arguments),e(this,"pollingInterval",nk,this),e(this,"playerScore",ak,this),e(this,"opponentScore",sk,this),e(this,"paperConfetti",ok,this),e(this,"titleText",rk,this),e(this,"levelManager",lk,this),this.goToDashboardScene=()=>{Rg.hideBannerAds(),El.switchScene(zr)},this.pollMatchState=async()=>{try{const{id:e}=uk.getMatchState();if(null===e)throw new Error("Match id is not found");const t=pk.getPlayerId(),i=Date.now(),n=await uk.api.getMatchAPI().getMatchDetailByIdAsync(e),a=Date.now(),s=Math.max(0,a-i,this.pollingInterval),o=new yk(n).toObject(),{blackPlayerId:r,blackPlayerScore:l,whitePlayerScore:c,blackPlayerFinish:h,whitePlayerFinish:d}=o,u=t===r?l:c,p=t===r?c:l,m=t===r?h:d,g=t===r?d:h,y=h&&d;if(this.playerScore.setPlayerScore(u),this.opponentScore.setPlayerScore(p),this.playerScore.showCrown(y&&u>p),this.opponentScore.showCrown(y&&p>u),this.stopWaitingAnimation(),this.playerScore.stopWaitingAnimation(),this.opponentScore.stopWaitingAnimation(),y)if(u===p)this.titleText.string="Draw";else if(u>p)this.titleText.string="You Win";else{if(!(u<p))return;this.titleText.string="You Lose"}else this.titleText.string=gk,this.playWaitingAnimation(),m||this.playerScore.playWaitingAnimation(),g||this.opponentScore.playWaitingAnimation();this.scheduleOnce(this.pollMatchState,s)}catch(e){console.warn("ResultScene: Error on pollMatchState",e),this.scheduleOnce(this.pollMatchState,this.pollingInterval)}}}__preload(){this.validateRequiredComponents(),this.listenEvents(),Rg.showBannerAds()}validateRequiredComponents(){Fe.lazyValidateProperties(this)}onLoad(){try{const e=uk.getMatchState(),{playerId:t,opponentId:i}=e.customData;if(null===t||null===i)throw new Error(`ResultScene: playerId is ${t} and opponentId is ${i}. Expected to not be null.`);const{photo:n}=pk.getPlayer(),{score:a=0,finished:s=!1}=e.profiles[t],{photo:o,score:r=0,finished:l=!1}=e.profiles[i],c=s&&l,h=c&&a>r,d=c&&r>a;this.playerScore.loadPhoto(n),this.opponentScore.loadPhoto(o),this.playerScore.setPlayerScore(a),this.opponentScore.setPlayerScore(r),this.playerScore.showCrown(h),this.opponentScore.showCrown(d),s&&l?a===r?this.titleText.string="Draw":h?this.titleText.string="You Win":d&&(this.titleText.string="You Lose"):(this.titleText.string=gk,this.playWaitingAnimation(),s||this.playerScore.playWaitingAnimation(),l||this.opponentScore.playWaitingAnimation())}catch(e){console.warn("ResultScene: Error on load",e),this.goToDashboardScene()}}listenEvents(){this.node.scene.on(ea,this.goToDashboardScene),this.node.scene.on(Zn,this.onReplayButtonPressed,this)}start(){this.scheduleOnce(this.pollMatchState,this.pollingInterval),this.scheduleOnce((()=>{this.paperConfetti.runEffect()}),.2)}onDestroy(){this.unschedule(this.pollMatchState)}async onReplayButtonPressed(){let{level:e=1}=pk.getGameData()??{};e=Math.max(1,e);const t=await this.levelManager.loadLevelData(e);try{if(!t)throw new Error("Level data is not found");const{opponentId:e}=uk.getMatchState().customData;if(!e)throw new Error("Opponent id is not found");Wl.showLoadingScreen();const i=ed.generateFen(t),{mode:n="",rules:a={addRandomTilesPerMove:0,maxSpaceOfPair:0},time:s=0,level:o}=t;await uk.challenge.friend.processAsync({playerId:pk.getPlayerId(),opponentId:e,extraData:{level:o,fen:i,gravity:n,rules:a,time:s}}),Wl.closeLoadingScreen(),this.goToGameScene()}catch(e){console.warn("ReplayChallengeFriend",e),Wl.closeLoadingScreen();const t=2;Wl.showNotificationScreen("Sorry, you cannot replay\nat this time.",t),mk?.sendException(e instanceof Error?e:new Error("ReplayChallengeFriend"+JSON.stringify(e))),this.scheduleOnce(this.goToDashboardScene,t)}}onHomeButtonPressed(){this.goToDashboardScene()}goToGameScene(){El.switchScene(Br)}playWaitingAnimation(){let e=0;this.titleText.schedule((()=>{e=(e+1)%4;const t=Array(e+1).join(".");this.titleText.string=gk+t}),.5);const t=this.titleText.getComponent(x),i=C(t).to(1,{opacity:130},{easing:"sineInOut"}).to(1,{opacity:255},{easing:"sineInOut"}).delay(.25);this.waitingAnimation=C(t).repeatForever(i).start()}stopWaitingAnimation(){this.titleText.unscheduleAllCallbacks(),this.waitingAnimation&&this.waitingAnimation.stop(),this.titleText.getComponent(x).opacity=255}}).prototype,"pollingInterval",[XM],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 15}}),ak=ve(ik.prototype,"playerScore",[$M],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),sk=ve(ik.prototype,"opponentScore",[JM],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ok=ve(ik.prototype,"paperConfetti",[QM],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),rk=ve(ik.prototype,"titleText",[ZM],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),lk=ve(ik.prototype,"levelManager",[ek],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),tk=ik))||tk);var bk,fk,wk,Sk,vk,Ck,Ek,Tk,Ak;i._RF.pop(),i._RF.push({},"acb0egHPppFmYJalVNrDDv/","BaseScreen",void 0);const{ccclass:Rk,property:Ik,disallowMultiple:Pk}=a,{Events:_k}=GameCore,{event:Lk}=globalThis.game;let Dk=(bk=Rk("BaseScreen"),fk=Ik(n),wk=Ik(n),Sk=Ik(x),bk(vk=Pk((Ek=ve((Ck=class extends s{constructor(){super(...arguments),e(this,"container",Ek,this),e(this,"backgroundMask",Tk,this),e(this,"screenOpacity",Ak,this),this.data={}}__preload(){this.animation=this.getComponent(y),this.validateRequiredComponents(),this.initializeNodes()}initializeNodes(){const e=this.getMaskOpacity(),t=this.getContainerOpacity();e&&t&&(e.opacity=0,t.opacity=0)}validateRequiredComponents(){Fe.lazyValidateProperties(this)}setScreenOpacity(e){this.screenOpacity.opacity=e}open(e){e&&(this.data=e),this.show(),this.runAnimation("OpenScreen")}close(){this.node.active&&(this.animation.once(y.EventType.FINISHED,(()=>{Lk.emit(_k.CLOSED_SCREEN,{screenName:this.node.name}),this.hide()})),this.runAnimation("CloseScreen"))}runAnimation(e){if(!this.isAnimationExist(e))throw new Error(`${this.node.name}: Animation component must have ${e} clip`);this.animation.play(e)}isAnimationExist(e){return this.animation.clips.some((t=>!(!t||t.name!==e)))}getMaskOpacity(){const e=this.backgroundMask.getComponent(x);return e||(console.warn("BaseScreen: maskOpacity not found"),null)}getContainerOpacity(){const e=this.container.getComponent(x);return e||(console.warn("BaseScreen: containerOpacity not found"),null)}show(){this.setScreenOpacity(255);const e=this.node.getComponent(A);e&&(e.enabled=!0,e.updateAlignment(),this.node.getComponentsInChildren(A).forEach((e=>{e.updateAlignment()})))}hide(){this.setScreenOpacity(0),this.node.setWorldPosition(new j(-1e3,-1e3,0));const e=this.node.getComponent(A);e&&(e.enabled=!1)}}).prototype,"container",[fk],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Tk=ve(Ck.prototype,"backgroundMask",[wk],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ak=ve(Ck.prototype,"screenOpacity",[Sk],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),vk=Ck))||vk)||vk);var Ok;i._RF.pop(),i._RF.push({},"f3521L4Mn5I3bhxr0QZJ9y9","BackgroundMask",void 0);const{ccclass:Nk,requireComponent:Mk}=a;Nk("BackgroundMask")(Ok=Mk([x])(Ok=class extends s{onLoad(){const e=this.getComponent(x);e?(this.opacity=e,this.updateMaskAlpha()):console.warn("BackgroundMask: UIOpacity not found")}updateMaskAlpha(){(e=>{const t=document.getElementById("app-mask");t&&(t.style.background=`rgb(0 0 0 / ${e})`)})(this.opacity.opacity/255)}})||Ok);var kk,xk,Fk,Bk,zk;i._RF.pop(),i._RF.push({},"d25c5ZVzYVC/YcfG5prmRdB","Screens",void 0);const{ccclass:Uk,property:Gk}=a;let Hk=(kk=Uk("Screens"),xk=Gk({type:M(Hi)}),kk((zk=ve((Bk=class extends s{constructor(){super(...arguments),e(this,"screenKeys",zk,this)}}).prototype,"screenKeys",[xk],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Fk=Bk))||Fk);var Vk,qk,Wk,Kk,Yk,jk,Xk,$k,Jk,Qk,Zk,ex,tx,ix;i._RF.pop(),i._RF.push({},"cecf2nUBzhIWZw7uJgVliXz","CongratulationScreen",void 0);const{ccclass:nx,property:ax,disallowMultiple:sx,requireComponent:ox}=a,{Events:rx}=GameCore,{event:lx}=globalThis.game;Vk=nx("CongratulationScreen"),qk=ox(Dk),Wk=ax(n),Kk=ax(n),Yk=ax(p),jk=ax(p),Xk=ax(p),Vk($k=sx($k=qk((Qk=ve((Jk=class extends s{constructor(){super(...arguments),e(this,"congratulation",Qk,this),e(this,"confirmation",Zk,this),e(this,"closeButtonComponent",ex,this),e(this,"yesButtonComponent",tx,this),e(this,"noButtonComponent",ix,this),this.handleOpeningScreen=e=>{if(!this.screen)throw new Error("CongratulationScreen: screen not found");this.validateEventPayload(e)&&(this.closeButtonComponent.interactable=!0,this.yesButtonComponent.interactable=!0,this.noButtonComponent.interactable=!0)},this.handleOpenedScreen=e=>{this.validateEventPayload(e)&&this.open()}}__preload(){this.enabled=!1,this.screen=this.getComponent(Dk),this.confirmationUIOpacity=this.confirmation.getComponent(x),this.validateRequiredComponents(),this.listenScreenEvents()}onDestroy(){this.unListenScreenEvents()}validateRequiredComponents(){Fe.lazyValidateProperties(this)}listenScreenEvents(){lx.on(rx.OPENING_SCREEN,this.handleOpeningScreen),lx.on(rx.OPENED_SCREEN,this.handleOpenedScreen)}unListenScreenEvents(){lx.off(rx.OPENING_SCREEN,this.handleOpeningScreen),lx.off(rx.OPENED_SCREEN,this.handleOpenedScreen)}validateEventPayload(e){const{screenName:t}=e;return t===this.node.name}open(){this.confirmation.active=!1,this.congratulation.active=!0}close(){this.closeButtonComponent.interactable=!1,this.yesButtonComponent.interactable=!1,this.noButtonComponent.interactable=!1,Wl.closeScreen(qi[this.node.name])}handleStartOver(){this.confirmation.active=!0,this.congratulation.active=!1,C(this.confirmationUIOpacity).set({opacity:0}).to(.2,{opacity:255}).start(),C(this.confirmation).set({scale:new j(.8,.8,.8)}).to(.2,{scale:new j(1,1,1)},{easing:"backOut"}).start()}handleYesStartOver(){this.close(),this.node.scene.emit(Ha.START_OVER)}handleNoStartOver(){this.requestGameReplay()}handleClickedClose(){this.requestGameReplay()}requestGameReplay(){this.close(),this.node.scene.emit(Ha.GAME_REPLAY,{level:this.screen.data.level})}}).prototype,"congratulation",[Wk],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Zk=ve(Jk.prototype,"confirmation",[Kk],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ex=ve(Jk.prototype,"closeButtonComponent",[Yk],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),tx=ve(Jk.prototype,"yesButtonComponent",[jk],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ix=ve(Jk.prototype,"noButtonComponent",[Xk],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),$k=Jk))||$k)||$k);var cx,hx,dx,ux,px,mx,gx,yx,bx,fx,wx,Sx,vx,Cx,Ex,Tx,Ax,Rx,Ix,Px,_x;i._RF.pop(),i._RF.push({},"01c067hcjNDc7prJzSE6UEq","DayBlock",void 0);const{ccclass:Lx,property:Dx}=a;let Ox=(cx=Lx("DayBlock"),hx=Dx({type:R,group:"Background"}),dx=Dx({type:R,group:"Background"}),ux=Dx({type:N,group:"Background"}),px=Dx({type:N,group:"Background"}),mx=Dx(h),gx=Dx(h),yx=Dx(n),bx=Dx(n),fx=Dx(n),cx((vx=ve((Sx=class extends s{constructor(){super(...arguments),e(this,"background",vx,this),e(this,"topBackground",Cx,this),e(this,"blueBackground",Ex,this),e(this,"blueTopBackground",Tx,this),e(this,"dayLabel",Ax,this),e(this,"coinLabel",Rx,this),e(this,"rewardItemsNode",Ix,this),e(this,"checkNode",Px,this),e(this,"glowNodes",_x,this)}onLoad(){this.uiOpacity=this.getComponent(x),this.initDefaultProperties(),this.validateRequiredComponents()}initDefaultProperties(){this.defaultBackground=this.background.spriteFrame,this.defaultTopBackground=this.topBackground.spriteFrame,this.defaultDayLabelOutlineColor=new o(this.dayLabel.outlineColor),this.blueDayLabelOutlineColor=new o("#3469bf")}validateRequiredComponents(){Fe.lazyValidateProperties(this)}updateInfo(e){this.updateBackground(e),this.updateDayLabel(e),this.coinLabel.string=e.value.toString(),this.updateRewardItems(e)}updateBackground(e){if(this.blueTopBackground&&this.blueBackground)switch(e.status){case"ready":this.background.spriteFrame=this.blueBackground,this.topBackground.spriteFrame=this.blueTopBackground;break;case"waiting":this.background.spriteFrame=this.defaultBackground,this.topBackground.spriteFrame=this.blueTopBackground;break;case"rewarded":this.background.spriteFrame=this.defaultBackground,this.topBackground.spriteFrame=this.defaultTopBackground}}updateDayLabel(e){this.dayLabel.string=`Day ${e.day.toString()}`;let t=this.defaultDayLabelOutlineColor;"rewarded"!==e.status&&(t=this.blueDayLabelOutlineColor),this.dayLabel.outlineColor=t,this.dayLabel.shadowColor=t}updateRewardItems(e){switch(e.status){case"ready":this.rewardItemsNode.active=!0,this.checkNode.active=!1,this.setGlowNodesActive(!0);break;case"waiting":this.rewardItemsNode.active=!0,this.checkNode.active=!1,this.setGlowNodesActive(!1);break;case"rewarded":this.rewardItemsNode.active=!1,this.checkNode.active=!0,this.setGlowNodesActive(!1)}}setGlowNodesActive(e){this.glowNodes&&this.glowNodes.forEach((t=>{t.active=e}))}}).prototype,"background",[hx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Cx=ve(Sx.prototype,"topBackground",[dx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ex=ve(Sx.prototype,"blueBackground",[ux],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Tx=ve(Sx.prototype,"blueTopBackground",[px],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ax=ve(Sx.prototype,"dayLabel",[mx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Rx=ve(Sx.prototype,"coinLabel",[gx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ix=ve(Sx.prototype,"rewardItemsNode",[yx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Px=ve(Sx.prototype,"checkNode",[bx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_x=ve(Sx.prototype,"glowNodes",[fx],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),wx=Sx))||wx);var Nx,Mx,kx,xx,Fx,Bx;i._RF.pop(),i._RF.push({},"cc662r8eR5Al6FdOBdcAkHG","DailyRewardsScreen",void 0);const{ccclass:zx,property:Ux,requireComponent:Gx}=a,{Events:Hx,Utils:{Object:Vx,Array:qx},Configs:{DailyRewards:Wx}}=GameCore,{event:Kx,dailyRewards:Yx,player:jx,monitorError:Xx}=globalThis.game;Nx=zx("DailyRewardsScreen"),Mx=Gx(Dk),kx=Ux([Ox]),Nx(xx=Mx((Bx=ve((Fx=class extends s{constructor(){super(...arguments),this.rewardsData=[],this.debugScreenOpened=!1,this.debugUpdatedRewardsData=!1,e(this,"dailyBlocks",Bx,this),this.handleOpeningScreen=e=>{this.validateEventPayload(e)},this.handleOpenedScreen=e=>{this.validateEventPayload(e)&&this.open()}}__preload(){this.enabled=!1,this.screen=this.getComponent(Dk),this.validateRequiredComponents(),this.listenScreenEvents()}onDestroy(){this.unListenScreenEvents()}validateRequiredComponents(){Fe.lazyValidateProperties(this)}listenScreenEvents(){Kx.on(Hx.OPENING_SCREEN,this.handleOpeningScreen),Kx.on(Hx.OPENED_SCREEN,this.handleOpenedScreen)}unListenScreenEvents(){Kx.off(Hx.OPENING_SCREEN,this.handleOpeningScreen),Kx.off(Hx.OPENED_SCREEN,this.handleOpenedScreen)}validateEventPayload(e){const{screenName:t}=e??{};return t===this.node.name}async open(){
//! DEBUG bug Cannot read properties of undefined (reading 'find')
this.debugScreenOpened=!0,this.node.scene.emit(Ha.HIDE_UI),this.resetState(),await this.updateRewardsData(),this.loginDailyRewards(),this.updateDayBlocks(),this.runPopUpAnimation()}close(){Kx.emit(Hx.CLOSE_SCREEN,{screenName:this.node.name}),this.node.scene.emit(Ha.SHOW_UI)}resetState(){this.dailyBlocks.forEach((e=>{e.uiOpacity.opacity=0,e.node.scale=new j(1.2,1.2,1.2)}))}runPopUpAnimation(){this.screen.container||console.warn("DailyRewardScreen: screen not found"),this.dailyBlocks.forEach(((e,t)=>{this.runAppearTween(e,.15*t)}))}runAppearTween(e,t){C(e.uiOpacity).delay(t).to(.3,{opacity:255},{easing:"quadOut"}).start(),C(e.node).delay(t).to(.3,{scale:j.ONE},{easing:"backOut"}).start()}handleOnClaim(){const e=this.getCurrentRewardData();if(!e)
//! DEBUG bug Cannot read properties of undefined (reading 'find')
return Xx?.sendException(new Error("DailyRewardsScreen: rewardData not found"),{nodeIsActive:this.node.activeInHierarchy,nodeHasParent:null!==this.node.parent&&void 0!==this.node.parent,hasLoadedRewardsData:this.debugUpdatedRewardsData,hasOpenedScreen:this.debugScreenOpened}),void Wl.showNotificationScreen("Unable to validate rewards. Please try again later...",2);this.claimReward(e)}async handleOnClaimX2(){const e=this.getCurrentRewardData();if(!e)
//! DEBUG bug Cannot read properties of undefined (reading 'find')
return Xx?.sendException(new Error("DailyRewardsScreen: rewardData not found"),{nodeIsActive:this.node.activeInHierarchy,nodeHasParent:null!==this.node.parent&&void 0!==this.node.parent,hasLoadedRewardsData:this.debugUpdatedRewardsData,hasOpenedScreen:this.debugScreenOpened}),void Wl.showNotificationScreen("Unable to validate rewards. Please try again later...",2);if(!await Rg.showRewardVideoAdAsync({}))return;this.claimReward(e,!0)}getCurrentRewardData(){return qx.search(this.rewardsData,(e=>"ready"===e.status))}claimReward(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const i=e.value*(t?2:1),n=new oi;if(this.node.scene.emit(Ha.ADD_COINS,{coins:i,collectionAnimation:{animateTextOnly:!1,signal:n}}),!e.items)return void this.close();const a=e.items.hint*(t?2:1),s=e.items.thunder*(t?2:1),o=e.items.storm*(t?2:1),r=jx.getGameData();r?(jx.setGameData({items:{hint:r.items.hint+a,thunder:r.items.thunder+s,storm:r.items.storm+o,pliers:r.items.pliers}}),this.close()):this.close()}async updateRewardsData(){await Yx.requestDailyRewardsAsync();const e={...Yx.getDailyRewards()};for(let t=0;t<Wx.MaxDays;t++)e[t]={...e[t],value:Tr[t].value,items:Tr[t].items};e&&(this.rewardsData=Vx.vals(e),
//! DEBUG bug Cannot read properties of undefined (reading 'find')
this.debugUpdatedRewardsData=!0,console.log("DailyRewardsScreen: rewardsData",this.rewardsData))}loginDailyRewards(){Yx.logLoginReward()}updateDayBlocks(){
//! DEBUG bug Cannot read properties of undefined (reading 'find')
this.dailyBlocks.length>this.rewardsData.length&&(console.warn("DailyRewardsScreen: dailyBlocks not enough"),Xx?.sendException(new Error("DailyRewardsScreen: dailyBlocks not enough"),{dailyBlocksCount:this.dailyBlocks.length,rewardsDataCount:this.rewardsData.length,nodeIsActive:this.node.activeInHierarchy,nodeHasParent:null!==this.node.parent&&void 0!==this.node.parent,hasLoadedRewardsData:this.debugUpdatedRewardsData,hasOpenedScreen:this.debugScreenOpened})),this.dailyBlocks.forEach(((e,t)=>{
//! DEBUG bug Cannot read properties of undefined (reading 'find')
if(t>=this.rewardsData.length)return;const{id:i,type:n,value:a,status:s}=this.rewardsData[t];e.updateInfo({day:i,type:n,value:a,status:s})}))}}).prototype,"dailyBlocks",[kx],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),xx=Fx))||xx);var $x;i._RF.pop(),i._RF.push({},"5a6aeaMAdtMGYA8B1wIuhDa","DayBlockRed",void 0);const{ccclass:Jx}=a;Jx("DayBlockRed")($x=class extends Ox{updateBackground(e){if(this.blueTopBackground&&this.blueBackground)switch(e.status){case"ready":this.background.spriteFrame=this.blueBackground,this.topBackground.spriteFrame=this.blueTopBackground;break;case"waiting":this.background.spriteFrame=this.defaultBackground,this.topBackground.spriteFrame=this.defaultTopBackground}}updateDayLabel(e){this.dayLabel.string=`Day ${e.day.toString()}`;let t=this.defaultDayLabelOutlineColor;"ready"===e.status&&(t=this.blueDayLabelOutlineColor),this.dayLabel.shadowColor=t,this.dayLabel.outlineColor=t}});var Qx,Zx,eF,tF,iF,nF,aF,sF,oF,rF;i._RF.pop(),i._RF.push({},"6fed95tFh5MRKzFqaFB2Ts8","GetCoinScreen",void 0);const{ccclass:lF,property:cF,requireComponent:hF}=a,{event:dF}=globalThis.game,{Events:uF}=GameCore;Qx=lF("GetCoinScreen"),Zx=hF(Dk),eF=cF(h),tF=cF(p),iF=cF(p),Qx(nF=Zx((sF=ve((aF=class extends s{constructor(){super(...arguments),e(this,"quantityLabel",sF,this),e(this,"closeButtonComponent",oF,this),e(this,"getNowButtonComponent",rF,this),this.handleOpeningScreen=e=>{console.log("GetCoinScreen.OPENING_SCREEN",e),this.validateEventPayload(e)&&(this.closeButtonComponent.interactable=!0,this.getNowButtonComponent.interactable=!0,this.updateStatus())},this.handleOpenedScreen=e=>{this.validateEventPayload(e)&&this.open()}}__preload(){this.enabled=!1,this.screen=this.getComponent(Dk),this.validateRequiredComponents(),this.listenScreenEvents()}onDestroy(){this.unListenScreenEvents()}validateRequiredComponents(){Fe.lazyValidateProperties(this)}listenScreenEvents(){dF.on(uF.OPENING_SCREEN,this.handleOpeningScreen),dF.on(uF.OPENED_SCREEN,this.handleOpenedScreen)}unListenScreenEvents(){dF.off(uF.OPENING_SCREEN,this.handleOpeningScreen),dF.off(uF.OPENED_SCREEN,this.handleOpenedScreen)}validateEventPayload(e){if(!("screenName"in e))return!1;const{screenName:t}=e;return t===this.node.name&&(this.payload=e,!0)}open(){this.updateStatus(),this.runPopUpAnimation(),this.node.scene.emit(Ha.HIDE_UI)}close(){this.closeButtonComponent.interactable=!1,this.getNowButtonComponent.interactable=!1,dF.emit(uF.CLOSE_SCREEN,{screenName:this.node.name}),this.node.scene.emit(Ha.SHOW_UI)}updateStatus(){this.updateCoinQuantity()}runPopUpAnimation(){this.screen.container||console.warn("GetCoinScreen: screen not found")}updateCoinQuantity(){const e=this.getQuantity();e&&this.updateQuantityLabel(e)}updateQuantityLabel(e){this.quantityLabel.string=`x${e.toString()}`}getQuantity(){if(!this.payload||!("screenData"in this.payload))return 0;const{screenData:e}=this.payload;return e&&"quantity"in e&&e.quantity&&"number"==typeof e.quantity?e.quantity:0}handleAddCoin(){const e=this.getQuantity();this.node.scene.emit(Ha.ADD_COINS,{coins:e,collectionAnimation:{animateTextOnly:!1}}),this.close()}async handleGetNowButtonClicked(){Xi.stopAllSounds();await Rg.showRewardVideoAdAsync({})&&this.handleAddCoin()}}).prototype,"quantityLabel",[eF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),oF=ve(aF.prototype,"closeButtonComponent",[tF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),rF=ve(aF.prototype,"getNowButtonComponent",[iF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),nF=aF))||nF);var pF,mF,gF,yF,bF,fF,wF,SF,vF;i._RF.pop(),i._RF.push({},"91e6dGDvN1FKLi7g/JQPwl8","ItemCollectionFX",void 0);const{ccclass:CF,property:EF}=a;let TF=(pF=CF("ItemCollectionFX"),mF=EF(R),gF=EF(x),yF=EF(se),pF((wF=ve((fF=class extends s{constructor(){super(...arguments),e(this,"sprite",wF,this),e(this,"glowUIOpacity",SF,this),e(this,"particles",vF,this)}__preload(){Fe.lazyValidateProperties(this)}playExplosionParticles(){this.particles.resetSystem()}}).prototype,"sprite",[mF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),SF=ve(fF.prototype,"glowUIOpacity",[gF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),vF=ve(fF.prototype,"particles",[yF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),bF=fF))||bF);var AF,RF,IF,PF,_F,LF,DF,OF,NF,MF,kF,xF,FF,BF,zF,UF,GF,HF,VF,qF,WF,KF,YF,jF,XF;i._RF.pop(),i._RF.push({},"f016fTAlsNKRYkdu72AyCLI","GetItemScreen",void 0);const{ccclass:$F,property:JF}=a,{event:QF,player:ZF,analytics:eB}=globalThis.game,{Events:tB,Utils:{Object:iB,Array:nB},Plugins:{Analytics:{Events:aB}}}=GameCore;AF=$F("GetItemScreen"),RF=JF(_),IF=JF(R),PF=JF(R),_F=JF(R),LF=JF(R),DF=JF(h),OF=JF(h),NF=JF(h),MF=JF(p),kF=JF(p),xF=JF(p),AF((zF=ve((BF=class extends s{constructor(){super(...arguments),e(this,"itemFxPrefab",zF,this),e(this,"hintSprite",UF,this),e(this,"stormSprite",GF,this),e(this,"pliersSprite",HF,this),e(this,"thunderSprite",VF,this),e(this,"titleLabel",qF,this),e(this,"descriptionLabel",WF,this),e(this,"coinLabel",KF,this),e(this,"closeButtonComponent",YF,this),e(this,"buyItemButtonComponent",jF,this),e(this,"getNowButtonComponent",XF,this),this.handleOpeningScreen=e=>{if(!this.screen)throw new Error("GetItemScreen: screen not found");if(!this.validateEventPayload(e))return;this.closeButtonComponent.interactable=!0,this.getNowButtonComponent.interactable=!0,this.buyItemButtonComponent.interactable=!0;const t=this.getItemType();t&&this.updateStatus(t)},this.handleOpenedScreen=e=>{this.validateEventPayload(e)&&this.open()}}__preload(){this.enabled=!1,this.screen=this.getComponent(Dk),this.validateRequiredComponents(),this.listenScreenEvents()}onDestroy(){this.unListenScreenEvents()}validateRequiredComponents(){Fe.lazyValidateProperties(this)}listenScreenEvents(){QF.on(tB.OPENING_SCREEN,this.handleOpeningScreen),QF.on(tB.OPENED_SCREEN,this.handleOpenedScreen)}unListenScreenEvents(){QF.off(tB.OPENING_SCREEN,this.handleOpeningScreen),QF.off(tB.OPENED_SCREEN,this.handleOpenedScreen)}validateEventPayload(e){const{screenName:t}=e??{};return t===this.node.name&&(this.payload=e,!0)}open(){this.node.scene.emit(Ha.GAME_PAUSE)}close(){this.closeButtonComponent.interactable=!1,this.buyItemButtonComponent.interactable=!1,this.getNowButtonComponent.interactable=!1,QF.emit(tB.CLOSE_SCREEN,{screenName:this.node.name}),this.node.scene.emit(Ha.GAME_RESUME)}updateStatus(e){this.updateItemIcon(e),this.updateTitle(e),this.updateDescription(),this.updateButtons(e)}updateItemIcon(e){switch([this.hintSprite,this.stormSprite,this.thunderSprite,this.pliersSprite].forEach((e=>{e.node.active=!1})),e){case br.HINT:this.activeIcon=this.hintSprite;break;case br.STORM:this.activeIcon=this.stormSprite;break;case br.THUNDER:this.activeIcon=this.thunderSprite;break;case br.PLIERS:this.activeIcon=this.pliersSprite}this.activeIcon.node.active=!0}updateTitle(e){const t=e.charAt(0).toUpperCase()+e.slice(1);this.titleLabel.string=t}updateDescription(){const e=this.payload.screenData?.message;e&&(this.descriptionLabel.string=e)}updateButtons(e){const t=this.canBuyItem(e);this.buyItemButtonComponent.node.active=t,this.getNowButtonComponent.node.active=!t,t&&(this.coinLabel.string=""+3*vr[e])}canBuyItem(e){const t=ZF.getGameData();if(!t)return!1;const{coins:i}=t;return i>=3*vr[e]}getItemType(){const{screenData:e}=this.payload;return e&&e.item&&nB.has(iB.vals(br),e.item)?e.item:null}async handleAddItem(){const e=this.getItemType();if(!e)return;eB.event(aB.EARN_ITEM,{item_name:e,value:3}),this.node.scene.emit(Ha.ADD_ITEM,{animate:()=>this.animateAddItem(e),item:e,quantity:3})}async animateAddItem(e){const{spriteFrame:t}=this.activeIcon,[i,n]=this.createItemCollectionNode(t),a=this.getItemButtonWorldPosition(e),s=new j(.5,.5,.5);n.glowUIOpacity.opacity=150,await this.playScaleUpItemAnim(i,n),await vt.runTweenAsync(C(n.glowUIOpacity).to(.8,{opacity:0},{easing:"cubicIn"})),await this.playMoveCloseToItemButtonAnim(i,a,s),await this.playJumpAnim(i,s,a),Xi.playSound("sounds/clicks"),i.destroy()}async playJumpAnim(e,t,i){const n=i.clone().add3f(0,70,0),a=t.clone().multiplyScalar(1.3);await Promise.all([vt.runTweenAsync(C(e).to(.3,{worldPosition:n},{easing:"cubicOut"})),vt.runTweenAsync(C(e).to(.3,{scale:a},{easing:"cubicOut"}))]),await vt.runTweenAsync(C(e).to(.5,{worldPosition:i},{easing:"cubicIn"}))}playMoveCloseToItemButtonAnim(e,t,i){const n=t.clone().add3f(0,30,0);return vt.runTweenAsync(C(e).to(1,{worldPosition:n,scale:i},{easing:"cubicInOut"}))}createItemCollectionNode(e){const t=c(this.itemFxPrefab),i=t.getComponent(TF);return t.setParent(this.node.parent),i.sprite.spriteFrame=e,t.setWorldPosition(this.activeIcon.node.worldPosition.clone()),[t,i]}playScaleUpItemAnim(e,t){return e.setScale(j.ZERO),vt.runTweenAsync(C(e).delay(.2).call((()=>{t.playExplosionParticles(),Xi.playSound("sounds/item_reward")})).to(.1,{scale:new j(.8,1.2,1)}).to(.1,{scale:new j(1.2,.8,1)}).to(.1,{scale:new j(1,1,1)}))}getItemButtonWorldPosition(e){return this.getItemButton(e).worldPosition.clone()}async handleGetNowButtonClicked(){this.stopAllSounds();await Rg.showRewardVideoAdAsync({})&&(this.handleAddItem(),this.close())}async handleBuyItemButtonClicked(){this.node.scene.emit(Ha.REMOVE_COINS,{coins:3*vr[this.getItemType()],collectionAnimation:{animateTextOnly:!0}}),this.handleAddItem(),this.close()}stopAllSounds(){P("Sound")?.getComponent(St)?.stopAll()}getItemButton(e){switch(e){case br.HINT:return P("Canvas/UI/Footer/HintItemButton");case br.STORM:return P("Canvas/UI/Footer/StormItemButton");case br.THUNDER:return P("Canvas/UI/Footer/ThunderItemButton");case br.PLIERS:return P("Canvas/UI/Footer/PliersItemButton")}}}).prototype,"itemFxPrefab",[RF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),UF=ve(BF.prototype,"hintSprite",[IF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),GF=ve(BF.prototype,"stormSprite",[PF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),HF=ve(BF.prototype,"pliersSprite",[_F],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),VF=ve(BF.prototype,"thunderSprite",[LF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),qF=ve(BF.prototype,"titleLabel",[DF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),WF=ve(BF.prototype,"descriptionLabel",[OF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),KF=ve(BF.prototype,"coinLabel",[NF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),YF=ve(BF.prototype,"closeButtonComponent",[MF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),jF=ve(BF.prototype,"buyItemButtonComponent",[kF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),XF=ve(BF.prototype,"getNowButtonComponent",[xF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),FF=BF));var sB,oB,rB,lB,cB,hB,dB,uB,pB,mB,gB,yB,bB,fB,wB,SB,vB,CB,EB,TB,AB,RB,IB,PB,_B,LB,DB,OB,NB,MB;i._RF.pop(),i._RF.push({},"31829DUddVEq6NgIYHvnI68","LevelCompleteScreen",void 0);const{ccclass:kB,property:xB,requireComponent:FB}=a,{Events:BB,Utils:{Valid:zB}}=GameCore,{event:UB,player:GB}=globalThis.game,HB="Coin Container";sB=kB("LevelCompleteScreen"),oB=FB(Dk),rB=xB(Kv),lB=xB(n),cB=xB(h),hB=xB(n),dB=xB(n),uB=xB(p),pB=xB(n),mB=xB(y),gB=xB(n),yB=xB({type:y,group:HB}),bB=xB({type:D,group:HB}),fB=xB({type:D,group:HB}),wB=xB(XS),sB(SB=oB((CB=ve((vB=class extends s{constructor(){super(...arguments),this.levelId=1,this.coins=40,this.currentCoin=0,e(this,"coinContainer",CB,this),e(this,"playButton",EB,this),e(this,"coinText",TB,this),e(this,"levelText",AB,this),e(this,"nextLevelText",RB,this),e(this,"playButtonComponent",IB,this),e(this,"wellDoneText",PB,this),e(this,"coinAnimation",_B,this),e(this,"playButtonContainer",LB,this),e(this,"coinContainerAnimation",DB,this),e(this,"coinContainerEnterClip",OB,this),e(this,"coinContainerExitClip",NB,this),e(this,"paperConfetti",MB,this),this.handleOpeningScreen=e=>{if(!this.screen)throw new Error("StarChestScreen: screen not found");this.validateEventPayload(e)&&(this.playButtonComponent.interactable=!0)},this.handleOpenedScreen=e=>{this.validateEventPayload(e)&&this.open()}}__preload(){this.enabled=!1,this.screen=this.getComponent(Dk),this.validateRequiredComponents(),this.listenScreenEvents()}onLoad(){const e=this.screen.open;this.screen.open=t=>{this.overrideOpenHandler(e,t)}}onDestroy(){this.unListenScreenEvents()}validateRequiredComponents(){Fe.lazyValidateProperties(this)}listenScreenEvents(){UB.on(BB.OPENING_SCREEN,this.handleOpeningScreen),UB.on(BB.OPENED_SCREEN,this.handleOpenedScreen)}unListenScreenEvents(){UB.off(BB.OPENING_SCREEN,this.handleOpeningScreen),UB.off(BB.OPENED_SCREEN,this.handleOpenedScreen)}validateEventPayload(e){const{screenName:t,screenData:i}=e??{};return t===this.node.name&&(!!zB.isObject(i)&&(zB.isNumber(i.level)&&(this.levelId=i.level,this.coins=this.levelId<5?fr:wr),zB.isNumber(i.currentCoin)&&(this.currentCoin=i.currentCoin),!0))}open(){this.updateComponents(),this.node.scene.emit(Ha.HIDE_UI)}async close(){await vt.runAnimationAsync(this.coinContainerAnimation,this.coinContainerExitClip.name),UB.emit(BB.CLOSE_SCREEN,{screenName:this.node.name}),await Rg.showInterstitialAdAsync({forLevel:this.screen.data.level}),this.handleNextLevel()}async overrideOpenHandler(e,t){this.screen.setScreenOpacity(255),this.coinText.string="x0",this.playButtonComponent.interactable=!1,this.paperConfetti.runEffect(),await this.animateWellDoneText(),this.playButtonContainer.setScale(0,0,this.playButtonContainer.scale.z),e.call(this.screen,t),this.screen.getComponent(y)?.once(y.EventType.FINISHED,(()=>{this.animateCoin()}))}handleNextLevel(){const e=this.screen.data.level;if(!e)return void console.warn("LevelCompleteScreen: level not found");const t=GB.getGameData();if(!t)return void console.warn("LevelCompleteScreen: gameData not found");e>=t.totalLevel?this.node.scene.emit(Ha.MAX_LEVEL):this.node.scene.emit(Ha.NEXT_LEVEL)}updateComponents(){this.updateLevelText(),this.updateCoinContainer()}updateCoinContainer(){this.coinContainer.updateCoins({coins:this.currentCoin})}updateLevelText(){const e=GB.getGameData();if(!e)return void console.warn("LevelCompleteScreen: gameData not found");this.levelText.getComponent(h).string=`Level ${this.levelId}`,console.log("LevelCompleteScreen: updateLevelText",this.levelId);const t=this.levelId+1>e.totalLevel?"Complete":`Level ${this.levelId+1}`;this.nextLevelText.getComponent(h).string=t}updateCoinString(){this.coinText.string=`x${this.coins}`,console.log("LevelCompleteScreen: updateCoinString",this.coins)}async animateCoin(){this.screen.container?(this.coinAnimation.play(),await vt.runOnUpdateAsync(this.node,.8,(e=>{const t=he(0,this.coins,e),i=Math.floor(t);this.coinText.string=`x${i}`})),await this.animateCoinCollection(),await vt.runTweenAsync(this.showPlayButton()),this.updateCoinString()):console.warn("LevelCompleteScreen: screen not found")}async animateCoinCollection(){await vt.runAnimationAsync(this.coinContainerAnimation,this.coinContainerEnterClip.name),this.node.scene.emit(Ha.ADD_COINS,{coins:this.coins,collectionAnimation:{animateTextOnly:!1,target:this.coinContainer}})}showPlayButton(){return C(this.playButtonContainer).call((()=>{this.playButtonContainer.setScale(0,0,this.playButtonContainer.scale.z)})).to(.5,{scale:new j(1,1,1)},{easing:"backOut"}).call((()=>{this.playButtonComponent.interactable=!0}))}handleClickedPlay(){this.playButtonComponent.interactable=!1,this.close()}animateWellDoneText(){const e=this.wellDoneText.position.clone(),t=C(this.wellDoneText).call((()=>{this.wellDoneText.setPosition(0,0,this.wellDoneText.position.z),this.wellDoneText.setScale(0,0,this.wellDoneText.scale.z)})).to(.5,{scale:new j(1.5,1.5,1)},{easing:"cubicOut"}).to(.5,{scale:new j(1,1,1)},{easing:"backOut"}).to(.5,{position:e},{easing:"backOut"});return vt.runTweenAsync(t)}}).prototype,"coinContainer",[rB],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),EB=ve(vB.prototype,"playButton",[lB],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),TB=ve(vB.prototype,"coinText",[cB],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),AB=ve(vB.prototype,"levelText",[hB],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),RB=ve(vB.prototype,"nextLevelText",[dB],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),IB=ve(vB.prototype,"playButtonComponent",[uB],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),PB=ve(vB.prototype,"wellDoneText",[pB],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_B=ve(vB.prototype,"coinAnimation",[mB],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),LB=ve(vB.prototype,"playButtonContainer",[gB],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),DB=ve(vB.prototype,"coinContainerAnimation",[yB],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),OB=ve(vB.prototype,"coinContainerEnterClip",[bB],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),NB=ve(vB.prototype,"coinContainerExitClip",[fB],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),MB=ve(vB.prototype,"paperConfetti",[wB],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),SB=vB))||SB);var VB;i._RF.pop(),i._RF.push({},"61985gSEDBMY6nVNc9Q1D6W","LoadingScreen",void 0);const{ccclass:qB,disallowMultiple:WB,requireComponent:KB}=a,{Events:YB}=GameCore,{event:jB}=globalThis.game;qB("LoadingScreen")(VB=WB(VB=KB(Dk)(VB=class extends s{constructor(){super(...arguments),this.handleOpeningScreen=e=>{this.validateEventPayload(e)&&(this.enabled=!0)},this.handleOpenedScreen=e=>{this.validateEventPayload(e)&&this.open()},this.handleClosingScreen=e=>{this.validateEventPayload(e)&&this.unscheduleAllCallbacks()},this.handleClosedScreen=e=>{this.validateEventPayload(e)&&(this.enabled=!1)},this.handleOnCloseScreen=()=>{Wl.closeScreen(qi[this.node.name])}}onLoad(){this.enabled=!1,this.screen=this.getComponent(Dk),this.validateRequiredComponents(),this.listenScreenEvents()}onDestroy(){this.unListenScreenEvents()}validateRequiredComponents(){Fe.lazyValidateProperties(this)}listenScreenEvents(){jB.on(YB.OPENING_SCREEN,this.handleOpeningScreen),jB.on(YB.OPENED_SCREEN,this.handleOpenedScreen),jB.on(YB.CLOSING_SCREEN,this.handleClosingScreen),jB.on(YB.CLOSED_SCREEN,this.handleClosedScreen)}unListenScreenEvents(){jB.off(YB.OPENING_SCREEN,this.handleOpeningScreen),jB.off(YB.OPENED_SCREEN,this.handleOpenedScreen),jB.off(YB.CLOSING_SCREEN,this.handleClosingScreen),jB.off(YB.CLOSED_SCREEN,this.handleClosedScreen)}validateEventPayload(e){const{screenName:t}=e;return t===this.node.name}open(){if(!this.enabled)return;const e=this.screen.data.duration;e&&e>0&&this.scheduleOnce(this.handleOnCloseScreen,e)}})||VB)||VB);var XB,$B,JB,QB,ZB,ez,tz,iz;i._RF.pop(),i._RF.push({},"6460akNFfhP9pDOT2Z0+s2R","NotificationScreen",void 0);const{ccclass:nz,disallowMultiple:az,requireComponent:sz,property:oz}=a,{Events:rz,Utils:{Valid:lz}}=GameCore,{event:cz}=globalThis.game;XB=nz("NotificationScreen"),$B=sz(Dk),JB=oz(h),QB=oz(p),XB(ZB=az(ZB=$B((tz=ve((ez=class extends s{constructor(){super(...arguments),e(this,"message",tz,this),e(this,"touchZone",iz,this),this.enableCloseOnTouch=!0,this.handleOpeningScreen=e=>{this.validateEventPayload(e)&&this.updateScreenData(e)},this.handleClosingScreen=e=>{this.validateEventPayload(e)&&this.unscheduleAllCallbacks()}}__preload(){this.listenScreenEvents()}onDestroy(){this.unListenScreenEvents()}onLoad(){this.validateRequiredComponents()}validateRequiredComponents(){Fe.lazyValidateProperties(this)}listenScreenEvents(){cz.on(rz.OPENING_SCREEN,this.handleOpeningScreen),cz.on(rz.CLOSING_SCREEN,this.handleClosingScreen)}unListenScreenEvents(){cz.off(rz.OPENING_SCREEN,this.handleOpeningScreen),cz.off(rz.CLOSING_SCREEN,this.handleClosingScreen)}validateEventPayload(e){const{screenName:t}=e;return t===this.node.name}updateScreenData(e){const{screenData:t}=e;lz.isObject(t)?(t.message&&(this.message.string=t.message),t.duration&&t.duration>0&&this.scheduleOnce((()=>{Wl.closeScreen(qi[this.node.name])}),t.duration),!1===t.enableCloseOnTouch?this.enableCloseOnTouch=!1:this.enableCloseOnTouch=!0):console.warn("NotificationScreen: screenData not found")}handleClickedClose(){this.unscheduleAllCallbacks(),Wl.closeScreen(qi[this.node.name])}closeOnTouch(){this.enableCloseOnTouch&&this.handleClickedClose()}}).prototype,"message",[JB],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),iz=ve(ez.prototype,"touchZone",[QB],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ZB=ez))||ZB)||ZB);var hz,dz,uz,pz,mz,gz,yz,bz;i._RF.pop(),i._RF.push({},"7129ca71jRMGaTHxWhEL4F4","QuitLevelScreen",void 0);const{ccclass:fz,property:wz,requireComponent:Sz}=a,{Events:vz}=GameCore,{event:Cz}=globalThis.game;hz=fz("QuitLevelScreen"),dz=Sz(Dk),uz=wz(p),pz=wz(p),hz(mz=dz((yz=ve((gz=class extends s{constructor(){super(...arguments),e(this,"noButton",yz,this),e(this,"yesButton",bz,this),this.handleOpeningScreen=e=>{this.validateEventPayload(e)&&(this.noButton.interactable=!0,this.yesButton.interactable=!0)},this.handleOpenedScreen=e=>{this.validateEventPayload(e)&&this.open()}}__preload(){this.enabled=!1,this.screen=this.getComponent(Dk),this.validateRequiredComponents(),this.listenScreenEvents()}onDestroy(){this.unListenScreenEvents()}validateRequiredComponents(){Fe.lazyValidateProperties(this)}listenScreenEvents(){Cz.on(vz.OPENING_SCREEN,this.handleOpeningScreen),Cz.on(vz.OPENED_SCREEN,this.handleOpenedScreen)}unListenScreenEvents(){Cz.off(vz.OPENING_SCREEN,this.handleOpeningScreen),Cz.off(vz.OPENED_SCREEN,this.handleOpenedScreen)}validateEventPayload(e){const{screenName:t}=e??{};return t===this.node.name}open(){this.runPopUpAnimation(),this.node.scene.emit(Ha.HIDE_UI)}close(){this.noButton.interactable=!1,this.yesButton.interactable=!1,Wl.closeScreen(qi[this.node.name]),this.node.scene.emit(Ha.SHOW_UI),this.node.scene.emit(Ha.GAME_RESUME)}runPopUpAnimation(){this.screen.container||console.warn("StartLevelScreen: screen not found")}handleClickedNo(){this.close()}handleClickedYes(){this.node.scene.emit(Ha.GAME_EXIT)}}).prototype,"noButton",[uz],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),bz=ve(gz.prototype,"yesButton",[pz],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),mz=gz))||mz);var Ez,Tz,Az,Rz,Iz,Pz,_z,Lz,Dz,Oz,Nz,Mz,kz,xz,Fz,Bz,zz,Uz,Gz,Hz,Vz,qz;i._RF.pop(),i._RF.push({},"85907Tnp/NBq7myeciP/4h3","RescuesScreen",void 0);const{ccclass:Wz,property:Kz,disallowMultiple:Yz,requireComponent:jz}=a,{Events:Xz}=GameCore,{event:$z,player:Jz}=globalThis.game;Ez=Wz("RescuesScreen"),Tz=jz(Dk),Az=Kz(x),Rz=Kz([n]),Iz=Kz(h),Pz=Kz(h),_z=Kz(n),Lz=Kz(n),Dz=Kz(y),Oz=Kz(n),Nz=Kz(n),Ez(Mz=Yz(Mz=Tz((xz=ve((kz=class extends s{constructor(){super(...arguments),e(this,"adOpacity",xz,this),e(this,"animNodes",Fz,this),e(this,"titleLabel",Bz,this),e(this,"descriptionLabel",zz,this),e(this,"timer",Uz,this),e(this,"bomb",Gz,this),e(this,"bombAnim",Hz,this),e(this,"replayButton",Vz,this),e(this,"buyTimeButton",qz,this),this.handleOpeningScreen=e=>{if(!this.screen)throw new Error("RescuesScreen: screen not found");this.validateEventPayload(e)},this.handleOpenedScreen=e=>{this.validateEventPayload(e)&&this.open()}}__preload(){this.enabled=!1,this.screen=this.getComponent(Dk),this.validateRequiredComponents(),this.listenScreenEvents()}onDestroy(){this.unListenScreenEvents()}validateRequiredComponents(){Fe.lazyValidateProperties(this)}listenScreenEvents(){$z.on(Xz.OPENING_SCREEN,this.handleOpeningScreen),$z.on(Xz.OPENED_SCREEN,this.handleOpenedScreen)}unListenScreenEvents(){$z.off(Xz.OPENING_SCREEN,this.handleOpeningScreen),$z.off(Xz.OPENED_SCREEN,this.handleOpenedScreen)}validateEventPayload(e){const{screenName:t}=e;return t===this.node.name&&(this.payload=e,!0)}async open(){await this.resetState(),this.runOpenAnimation(),this.node.scene.emit(Ha.HIDE_UI)}close(){$z.emit(Xz.CLOSE_SCREEN,{screenName:this.node.name})}async resetState(){const e=this.payload.screenData?.failKey===ec;this.titleLabel.string=e?"Boom!":"Time's Up!",this.descriptionLabel.string=e?"The bomb exploded!":"Restart or add 2 minutes?",this.timer.active=!e,this.bomb.active=e,e&&this.bombAnim.play();const t=Jz.getGameData();if(!t)return;const i=t.coins>=Cr;this.replayButton.active=!i,this.buyTimeButton.active=i,this.adOpacity.opacity=0}async runOpenAnimation(){this.screen.container?(await Promise.all(this.animNodes.map(((e,t)=>{this.runAppearTween(e,.1*t)}))),await this.runShowAdContainer()):console.warn("TimeUpScreen: screen not found")}async runAppearTween(e,t){await vt.runTweenAsync(C(e).set({scale:new j(0,0,0)}).delay(t).to(1,{scale:new j(1,1,1)},{progress:(e,t,i,n)=>e+(t-e)*vt.elasticOut(n,.1,.45)}))}runShowAdContainer(){const e=C(this.adOpacity);return e.delay(1),e.to(.5,{opacity:255}),vt.runTweenAsync(e)}handleClickReplayButton(){this.close(),this.node.scene.emit(Ha.GAME_REPLAY,{level:this.screen.data.level})}handleClickBuyTimeButton(){this.node.scene.emit(Ha.REMOVE_COINS,{coins:Cr,collectionAnimation:{animateTextOnly:!0}}),this.startRescue()}async handleClickAdButton(){await Rg.showRewardVideoAdAsync({})&&this.startRescue()}startRescue(){this.node.scene.emit(Ha.SHOW_UI),this.node.scene.emit(Ha.RESCUE_START),this.close()}}).prototype,"adOpacity",[Az],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Fz=ve(kz.prototype,"animNodes",[Rz],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Bz=ve(kz.prototype,"titleLabel",[Iz],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),zz=ve(kz.prototype,"descriptionLabel",[Pz],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Uz=ve(kz.prototype,"timer",[_z],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Gz=ve(kz.prototype,"bomb",[Lz],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Hz=ve(kz.prototype,"bombAnim",[Dz],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Vz=ve(kz.prototype,"replayButton",[Oz],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),qz=ve(kz.prototype,"buyTimeButton",[Nz],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Mz=kz))||Mz)||Mz);var Qz,Zz,eU,tU,iU,nU,aU,sU,oU,rU,lU,cU,hU,dU,uU,pU,mU,gU,yU,bU,fU,wU,SU,vU,CU,EU;i._RF.pop(),i._RF.push({},"61932YLC/5CFrE0eD0ez8Zg","SettingsScreen",void 0);const{ccclass:TU,property:AU,requireComponent:RU}=a,{Events:IU,Utils:{Device:PU}}=GameCore,{player:_U,event:LU}=globalThis.game;Qz=TU("SettingsScreen"),Zz=RU(Dk),eU=AU(n),tU=AU(n),iU=AU(n),nU=AU(zP),aU=AU(zP),sU=AU(zP),oU=AU(p),rU=AU(p),lU=AU(p),cU=AU(p),hU=AU(n),Qz(dU=Zz((pU=ve((uU=class extends s{constructor(){super(...arguments),e(this,"musicSetting",pU,this),e(this,"soundSetting",mU,this),e(this,"vibrateSetting",gU,this),e(this,"musicSwitch",yU,this),e(this,"soundSwitch",bU,this),e(this,"vibrateSwitch",fU,this),e(this,"closeButtonComponent",wU,this),e(this,"continueButtonComponent",SU,this),e(this,"restartButtonComponent",vU,this),e(this,"inviteFriendsButtonComponent",CU,this),e(this,"animNodes",EU,this),this.triggerSequence="",this.handleOpeningScreen=e=>{this.validateSwitchScreenPayload(e)&&(this.closeButtonComponent.interactable=!0,this.continueButtonComponent.interactable=!0,this.restartButtonComponent.interactable=!0,this.inviteFriendsButtonComponent.interactable=!0,this.updateStatus())},this.handleOpenedScreen=e=>{this.validateSwitchScreenPayload(e)&&this.open()},this.handleResetSequence=()=>{this.triggerSequence=""},this.handleTriggerUnlockKey=e=>{if(!("code"in e))return;const{code:t}=e,{UNLOCK_SEQUENCE:i}=Pr;"number"==typeof t&&-1!==i.indexOf(t.toString())&&(this.triggerSequence+=t.toString(),console.log("SettingsScreen: handleTriggerUnlockKey",t,this.triggerSequence,this.triggerSequence===i),this.triggerSequence===i&&(this.node.scene.emit(Pr.Events.UNLOCK_DEV_TOOLS),this.node.off(Pr.Events.TRIGGER_UNLOCK_KEY)))},this.updateVibrateButton=()=>{const e=this.vibrateSetting.getComponentInChildren(p),t=this.vibrateSetting.getComponentInChildren(zP),i=this.vibrateSetting.getComponentInChildren(Wn);if(e&&t&&i)if(PU.isMobile()){const e=_U.getPlayerSetting("vibrate")??!1;t.setEnabled(e)}else e.interactable=!1,t.setEnabled(!1),i.changeState(!1);else console.warn("SettingsScreen: vibrate button missing components")}}onLoad(){this.enabled=!1,this.screen=this.getComponent(Dk),this.validateRequiredComponents(),this.listenScreenEvents(),this.listenUnlockDevTools()}onDestroy(){this.unListenScreenEvents(),this.unListenUnlockDevTools()}validateRequiredComponents(){Fe.lazyValidateProperties(this)}listenScreenEvents(){LU.on(IU.OPENING_SCREEN,this.handleOpeningScreen),LU.on(IU.OPENED_SCREEN,this.handleOpenedScreen)}unListenScreenEvents(){LU.off(IU.OPENING_SCREEN,this.handleOpeningScreen),LU.off(IU.OPENED_SCREEN,this.handleOpenedScreen)}validateSwitchScreenPayload(e){const{screenName:t}=e;return t===this.node.name}listenUnlockDevTools(){this.node.off(Pr.Events.TRIGGER_UNLOCK_KEY),this.node.on(Pr.Events.TRIGGER_RESET_SEQUENCE,this.handleResetSequence),this.node.on(Pr.Events.TRIGGER_UNLOCK_KEY,this.handleTriggerUnlockKey)}unListenUnlockDevTools(){this.node.off(Pr.Events.TRIGGER_RESET_SEQUENCE,this.handleResetSequence),this.node.off(Pr.Events.TRIGGER_UNLOCK_KEY,this.handleTriggerUnlockKey)}open(){this.updateStatus(),this.runPopUpAnimation(),this.node.emit(Pr.Events.TRIGGER_RESET_SEQUENCE),this.node.scene.emit(Ha.HIDE_UI)}close(){this.closeButtonComponent.interactable=!1,this.continueButtonComponent.interactable=!1,this.restartButtonComponent.interactable=!1,this.inviteFriendsButtonComponent.interactable=!1,this.node.emit(Pr.Events.TRIGGER_RESET_SEQUENCE),Wl.closeScreen(qi[this.node.name])}updateStatus(){const e={music:_U.getPlayerSetting("music")??!1,sound:_U.getPlayerSetting("sound")??!1,vibrate:_U.getPlayerSetting("vibrate")??!1};this.musicSwitch?this.soundSwitch?(this.musicSwitch.setEnabled(e.music),this.soundSwitch.setEnabled(e.sound),"GameDistributions"!==GameSDK.getSDKName()&&this.scheduleOnce(this.updateVibrateButton,.1)):console.warn("SettingsScreen: soundSwitch not found"):console.warn("SettingsScreen: musicSwitch not found")}runPopUpAnimation(){this.screen.container||console.warn("SettingsScreen: screen not found"),this.animNodes.forEach(((e,t)=>{this.runAppearTween(e,.1*t)}))}runAppearTween(e,t){const i=C(e);i.set({scale:new j(0,0,0)}),i.delay(t),i.to(1,{scale:new j(1,1,1)},{progress:(e,t,i,n)=>e+(t-e)*vt.elasticOut(n,.1,.45)}),i.start()}switchMusicButton(){if(!this.musicSwitch)return void console.warn("SettingsScreen: musicSwitch not found");const e=this.musicSwitch.switch();_U.setSetting("music",e),this.node.emit(Pr.Events.TRIGGER_UNLOCK_KEY,{code:e?1:0}),e?Xi.playMusic():Xi.pauseMusic()}switchSoundButton(){if(!this.soundSwitch)return void console.warn("SettingsScreen: soundSwitch not found");const e=this.soundSwitch.switch();_U.setSetting("sound",e),this.node.emit(Pr.Events.TRIGGER_UNLOCK_KEY,{code:e?3:2})}switchVibrateButton(){if(!this.vibrateSwitch)return void console.warn("SettingsScreen: vibrateSwitch not found");const e=this.vibrateSwitch.switch();_U.setSetting("vibrate",e)}handleClickedResume(){this.resumeGame()}handleClickedClose(){this.resumeGame()}handleClickedReplayGame(){this.restartGame()}async handleClickedInviteFriends(){this.close(),this.node.scene.emit(Ha.INVITE_FRIENDS)}resumeGame(){this.close(),this.node.scene.emit(Ha.GAME_RESUME),this.node.scene.emit(Ha.SHOW_UI)}restartGame(){this.close(),this.node.scene.emit(Ha.GAME_RESUME);const{level:e=1}=_U.getGameData()??{};this.node.scene.emit(Ha.GAME_REPLAY,{level:e})}}).prototype,"musicSetting",[eU],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),mU=ve(uU.prototype,"soundSetting",[tU],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),gU=ve(uU.prototype,"vibrateSetting",[iU],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),yU=ve(uU.prototype,"musicSwitch",[nU],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),bU=ve(uU.prototype,"soundSwitch",[aU],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),fU=ve(uU.prototype,"vibrateSwitch",[sU],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wU=ve(uU.prototype,"closeButtonComponent",[oU],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),SU=ve(uU.prototype,"continueButtonComponent",[rU],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),vU=ve(uU.prototype,"restartButtonComponent",[lU],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),CU=ve(uU.prototype,"inviteFriendsButtonComponent",[cU],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),EU=ve(uU.prototype,"animNodes",[hU],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),dU=uU))||dU);var DU,OU,NU,MU,kU,xU,FU,BU,zU,UU,GU,HU,VU,qU,WU,KU,YU,jU,XU,$U,JU,QU,ZU;i._RF.pop(),i._RF.push({},"891d37NJ6lLdp3CNLPHxZ6d","StarChest",void 0);const{ccclass:eG,property:tG}=a;let iG=(DU=eG("StarChest"),OU=tG(R),NU=tG(x),MU=tG(se),kU=tG(x),xU=tG(x),FU=tG({type:E,readonly:!0,displayName:"Starting Offset X",group:"Reward Animations"}),BU=tG({type:E,readonly:!0,displayName:"Starting Offset Y",group:"Reward Animations"}),zU=tG({type:E,displayName:"Centered Offset X",group:"Reward Animations"}),UU=tG({type:E,displayName:"Centered Offset Y",group:"Reward Animations"}),GU=tG({type:E,min:0,displayName:"Starting Scale",group:"Reward Animations"}),HU=tG({type:E,min:0,displayName:"Ending Scale",group:"Reward Animations"}),DU((WU=ve((qU=class extends s{constructor(){super(...arguments),e(this,"sprite",WU,this),e(this,"glowOpacity",KU,this),e(this,"explosionParticles",YU,this),e(this,"circle",jU,this),e(this,"uiOpacity",XU,this),this.ogCenterX=0,this.ogCenterY=0,e(this,"endingOffsetX",$U,this),e(this,"endingOffsetY",JU,this),e(this,"startingScale",QU,this),e(this,"endingScale",ZU,this)}get startingOffsetX(){return this.node.position.x}get startingOffsetY(){return this.node.position.y}__preload(){this.validateRequiredComponents(),this.ogCenterX=this.startingOffsetX,this.ogCenterY=this.startingOffsetY}validateRequiredComponents(){Fe.lazyValidateProperties(this)}async moveToCenter(e){const t=new j(this.endingOffsetX,this.endingOffsetY,this.node.position.z);await vt.runTweenAsync(C(this.node).to(.7,{position:t},{easing:"quintInOut"}),e),this.node.position=t}respawnAtStartingState(){this.node.position=new j(this.ogCenterX,this.ogCenterY,this.node.position.z),this.glowOpacity.opacity=0,this.sprite.node.setScale(this.startingScale,this.startingScale,this.startingScale),this.glowOpacity.node.setScale(this.startingScale,this.startingScale,this.startingScale),this.uiOpacity.opacity=255}async scale(e,t){const i=this.startingScale+(this.endingScale-this.startingScale)*e,n=new j(i,i,i);await Promise.all([vt.runTweenAsync(C(this.sprite.node).to(.2,{scale:n},{easing:"backOut"}),t),vt.runTweenAsync(C(this.glowOpacity.node).to(.2,{scale:n},{easing:"backOut"}),t)]),this.sprite.node.setScale(n),this.glowOpacity.node.setScale(n)}startShaking(){const e=this.node.position.clone();this.shakingTween={ogPos:e,tw:C(this.node).to(.1,{},{onUpdate:(t,i)=>{if(i){const t=e.x+10*(i-.5);this.node.position=new j(t,e.y,e.z)}}}).repeatForever().start()}}stopShaking(){this.shakingTween&&(this.shakingTween.tw.stop(),this.node.position=this.shakingTween.ogPos,this.shakingTween=void 0)}async glow(e){const t=this.sprite.node.scale.clone().multiplyScalar(1.1);await Promise.all([vt.runTweenAsync(C(this.sprite.node).to(.2,{scale:t},{easing:"cubicInOut"}),e),vt.runTweenAsync(C(this.glowOpacity.node).to(.2,{scale:t}),e),vt.runTweenAsync(C(this.glowOpacity).to(.5,{opacity:255}),e)])}async explode(e){const t=new j(8,8,8);await Promise.all([this.explodeParticles(e),(async()=>{this.circle.opacity=255,this.circle.node.setScale(j.ZERO),await Promise.all([vt.runTweenAsync(C(this.circle).to(.3,{opacity:0}),e),vt.runTweenAsync(C(this.circle.node).to(.3,{scale:t},{easing:"cubicOut"}),e)]),this.circle.opacity=0,this.circle.node.scale=t})(),(async()=>{await Promise.all([vt.runTweenAsync(C(this.glowOpacity.node).to(.3,{scale:j.ZERO},{easing:"cubicOut"}),e),vt.runTweenAsync(C(this.sprite.node).to(.3,{scale:j.ZERO},{easing:"cubicOut"}),e)]),this.sprite.node.setScale(j.ZERO),this.glowOpacity.node.setScale(j.ZERO)})()])}async explodeParticles(e){e.aborted||(this.explosionParticles.node.active=!0,this.explosionParticles.resetSystem(),await vt.waitTweenAsync(1),this.explosionParticles.node.active=!1)}}).prototype,"sprite",[OU],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),KU=ve(qU.prototype,"glowOpacity",[NU],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),YU=ve(qU.prototype,"explosionParticles",[MU],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),jU=ve(qU.prototype,"circle",[kU],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),XU=ve(qU.prototype,"uiOpacity",[xU],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ve(qU.prototype,"startingOffsetX",[FU],Object.getOwnPropertyDescriptor(qU.prototype,"startingOffsetX"),qU.prototype),ve(qU.prototype,"startingOffsetY",[BU],Object.getOwnPropertyDescriptor(qU.prototype,"startingOffsetY"),qU.prototype),$U=ve(qU.prototype,"endingOffsetX",[zU],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),JU=ve(qU.prototype,"endingOffsetY",[UU],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),QU=ve(qU.prototype,"startingScale",[GU],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.5}}),ZU=ve(qU.prototype,"endingScale",[HU],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),VU=qU))||VU);var nG,aG,sG,oG,rG,lG,cG,hG,dG,uG,pG,mG,gG,yG,bG,fG,wG,SG,vG,CG;i._RF.pop(),i._RF.push({},"e414bczbutHJKcOfhl1sc4p","StarChestScreen",void 0);const{ccclass:EG,property:TG,requireComponent:AG}=a,{Events:RG}=GameCore,{event:IG,player:PG}=globalThis.game;nG=EG("StarChestScreen"),aG=AG(Dk),sG=TG(oA),oG=TG(h),rG=TG(p),lG=TG(y),cG=TG(iG),hG=TG(x),dG=TG(Nv),uG=TG(h),nG(pG=aG((gG=ve((mG=class extends s{constructor(){super(...arguments),e(this,"starProgressBar",gG,this),e(this,"buttonLabel",yG,this),e(this,"button",bG,this),e(this,"chestAnimation",fG,this),e(this,"starChest",wG,this),e(this,"chestUnlockFXMask",SG,this),e(this,"skipOverlay",vG,this),e(this,"messageLabel",CG,this),this.handleOpeningScreen=e=>{if(!this.screen)throw new Error("StarChestScreen: screen not found");this.validateEventPayload(e)},this.handleOpenedScreen=e=>{this.validateEventPayload(e)&&this.open()}}__preload(){this.enabled=!1,this.screen=this.getComponent(Dk),this.validateRequiredComponents(),this.listenScreenEvents()}onDestroy(){this.unListenScreenEvents()}validateRequiredComponents(){Fe.lazyValidateProperties(this)}listenScreenEvents(){IG.on(RG.OPENING_SCREEN,this.handleOpeningScreen),IG.on(RG.OPENED_SCREEN,this.handleOpenedScreen)}unListenScreenEvents(){IG.off(RG.OPENING_SCREEN,this.handleOpeningScreen),IG.off(RG.OPENED_SCREEN,this.handleOpenedScreen)}validateEventPayload(e){const{screenName:t}=e??{};return t===this.node.name}open(){this.runPopUpAnimation(),this.node.scene.emit(Ha.HIDE_UI);const e=PG.getGameData();if(!e)return;const{stars:t}=e;this.numChestAvailable=Math.floor(t/20),this.starProgressBar.setRange(t,20),this.buttonLabel.string=this.numChestAvailable?"Open":"Continue",this.messageLabel.string=this.numChestAvailable?"Congrats, you have enough stars to open the chest!":"Win more stars to open!",this.button.interactable=!0,this.numChestAvailable?this.chestAnimation.play():this.chestAnimation.stop(),this.chestUnlockFXMask.node.active=!1,this.chestUnlockFXMask.opacity=0,this.starChest.respawnAtStartingState()}close(){IG.emit(RG.CLOSE_SCREEN,{screenName:this.node.name}),this.node.scene.emit(Ha.SHOW_UI)}runPopUpAnimation(){this.screen.container||console.warn("StarChestScreen: screen not found")}async handleClickButton(){if(0===this.numChestAvailable)return void this.close();Xi.turnDownMusic();const e=PG.getGameData();if(!e)return;this.button.interactable=!1;const{stars:t}=e;PG.setGameData({stars:e.stars-20*this.numChestAvailable});const i=new oi;await this.skipOverlay.open({opacity:200,onSkip:()=>i.abort()}),await this.handleUnlockAnimation(t,e.stars,i),await this.skipOverlay.close(),Xi.turnUpMusic(),W.emit(Zt),this.close()}async handleUnlockAnimation(e,t,i){await Promise.all([this.starChest.moveToCenter(i),this.fadeInChestUnlockFX(i)]),this.chestAnimation.stop(),this.starChest.startShaking(),Xi.playSound(Bi.STAR_CHEST_DRUM_ROLL,{loop:!0}),await vt.waitTweenAsync(0);let n=e,a=this.numChestAvailable;const s=e=>this.numChestAvailable>2?1-e/this.numChestAvailable:.35*(1-e/this.numChestAvailable);await Promise.all([this.starProgressBar.animateTo(t,i,(e=>{n-e>=20&&(n=e,a--,this.starChest.scale(s(a),i),Xi.playSound(Bi.STAR_CHEST_OPEN))}))]),await vt.waitTweenAsync(1,i),this.starChest.stopShaking(),await this.starChest.glow(i),Xi.stopSound(Bi.STAR_CHEST_DRUM_ROLL);const o=Sr*this.numChestAvailable;this.node.scene.emit(Ha.ADD_COINS,{coins:o,collectionAnimation:{animateTextOnly:!1,floatDuration:3,signal:i}}),await this.starChest.explode(i),await vt.waitTweenAsync(1,i),await Promise.all([this.fadeOutChestUnlockFX(i)])}async fadeInChestUnlockFX(e){this.chestUnlockFXMask.node.active=!0,await vt.runTweenAsync(C(this.chestUnlockFXMask).to(.5,{opacity:150}),e)}async fadeOutChestUnlockFX(e){await vt.runTweenAsync(C(this.chestUnlockFXMask).to(.3,{opacity:0}),e),this.chestUnlockFXMask.opacity=0,this.chestUnlockFXMask.node.active=!1}}).prototype,"starProgressBar",[sG],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),yG=ve(mG.prototype,"buttonLabel",[oG],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),bG=ve(mG.prototype,"button",[rG],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),fG=ve(mG.prototype,"chestAnimation",[lG],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wG=ve(mG.prototype,"starChest",[cG],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),SG=ve(mG.prototype,"chestUnlockFXMask",[hG],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),vG=ve(mG.prototype,"skipOverlay",[dG],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),CG=ve(mG.prototype,"messageLabel",[uG],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),pG=mG))||pG);var _G,LG,DG,OG,NG,MG,kG,xG,FG,BG,zG,UG,GG,HG;i._RF.pop(),i._RF.push({},"ecbb9MLxRlP2Kv7swFe9AXo","StartLevelScreen",void 0);const{ccclass:VG,property:qG,requireComponent:WG}=a,{Events:KG}=GameCore,{event:YG}=globalThis.game;_G=VG("StartLevelScreen"),LG=WG(Dk),DG=qG(n),OG=qG(n),NG=qG(n),MG=qG(n),kG=qG(p),_G(xG=LG((BG=ve((FG=class extends s{constructor(){super(...arguments),e(this,"playButton",BG,this),e(this,"goalText",zG,this),e(this,"levelText",UG,this),e(this,"missionText",GG,this),e(this,"playButtonComponent",HG,this),this.handleOpeningScreen=e=>{if(!this.screen)throw new Error("StartLevelScreen: screen not found");this.validateEventPayload(e)&&(this.playButtonComponent.interactable=!0)},this.handleOpenedScreen=e=>{this.validateEventPayload(e)&&this.open()}}__preload(){this.enabled=!1,this.screen=this.getComponent(Dk),this.validateRequiredComponents(),this.listenScreenEvents()}onDestroy(){this.unListenScreenEvents()}validateRequiredComponents(){Fe.lazyValidateProperties(this)}listenScreenEvents(){YG.on(KG.OPENING_SCREEN,this.handleOpeningScreen),YG.on(KG.OPENED_SCREEN,this.handleOpenedScreen)}unListenScreenEvents(){YG.off(KG.OPENING_SCREEN,this.handleOpeningScreen),YG.off(KG.OPENED_SCREEN,this.handleOpenedScreen)}validateEventPayload(e){const{screenName:t,screenData:i}=e??{};return t===this.node.name&&(i?.level&&(this.levelId=i.level),i?.mission&&(this.mission=i.mission),!0)}open(){this.updateComponents(),this.runPopUpAnimation(),this.node.scene.emit(Ha.HIDE_UI)}close(){this.playButtonComponent.interactable=!1,YG.emit(KG.CLOSE_SCREEN,{screenName:this.node.name}),this.node.scene.emit(Ha.SHOW_UI)}updateComponents(){this.updateGoalText(),this.updateLevelText(),this.updateDescriptionText()}updateGoalText(){const{mission:e}=this.mission;this.goalText.getComponent(h).string=e>1?"Goals":"Goal"}updateLevelText(){this.levelText.getComponent(h).string=`Level ${this.levelId}`}updateDescriptionText(){this.missionText.getComponent(h).string=this.mission.description}runPopUpAnimation(){this.screen.container||console.warn("StartLevelScreen: screen not found")}handleClickedPlay(){this.node.scene.emit(Ha.GAME_START),this.close()}}).prototype,"playButton",[DG],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),zG=ve(FG.prototype,"goalText",[OG],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),UG=ve(FG.prototype,"levelText",[NG],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),GG=ve(FG.prototype,"missionText",[MG],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),HG=ve(FG.prototype,"playButtonComponent",[kG],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),xG=FG))||xG);var jG,XG,$G,JG,QG;i._RF.pop(),i._RF.push({},"fe274iMNmBCzZ13Ie1nGU1R","TournamentLeaderSkeleton",void 0);const{ccclass:ZG,property:eH}=a;let tH=(jG=ZG("TournamentLeaderSkeleton"),XG=eH(n),jG((QG=ve((JG=class extends s{constructor(){super(...arguments),e(this,"container",QG,this)}__preload(){this.uiOpacity=this.getComponent(x),this.validateRequiredComponents()}async hide(e){await vt.runTweenAsync(C(this.uiOpacity).to(.2,{opacity:0}).call((()=>{this.node.active=!1})),e)}async show(e,t){this.node.active=!0,this.node.scale=new j(.8,.8,.8),this.uiOpacity.opacity=0;const i=this.container.position.clone();this.container.position=new j(i.x,i.y-100,i.z);const n=C(this.node).delay(e);n.to(.2,{scale:j.ONE},{easing:"elasticOut"});const a=C(this.container).delay(e);a.to(.2,{position:i},{easing:"backOut"});const s=C(this.uiOpacity).delay(e);s.to(.2,{opacity:255},{easing:"cubicOut"}),await Promise.all([vt.runTweenAsync(n,t),vt.runTweenAsync(a,t),vt.runTweenAsync(s,t)])}validateRequiredComponents(){if(!this.uiOpacity)throw new Error("UIOpacity component is not attached to the same node");if(!this.container)throw new Error("Container is not attached to the same node")}}).prototype,"container",[XG],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),$G=JG))||$G);var iH,nH,aH,sH,oH,rH,lH,cH,hH,dH,uH,pH,mH,gH,yH,bH,fH,wH,SH,vH,CH,EH,TH,AH,RH,IH;i._RF.pop(),i._RF.push({},"cdaa9B4pK9PFrDmP6/GQcMn","TournamentDetailScreen",void 0);const{ccclass:PH,property:_H,requireComponent:LH}=a,{Events:DH,Utils:{Object:OH,Time:NH,Number:MH,Array:kH}}=GameCore,{event:xH,storage:FH,player:BH,leaderboard:zH}=globalThis.game;iH=PH("TournamentDetailScreen"),nH=LH(Dk),aH=_H(h),sH=_H(h),oH=_H(h),rH=_H(yL),lH=_H(l),cH=_H({type:n,group:"Buttons"}),hH=_H({type:n,group:"Buttons"}),dH=_H({type:n,group:"Buttons"}),uH=_H({type:[tH]}),pH=_H({type:[R]}),mH=_H(XS),iH(gH=nH((bH=ve((yH=class extends s{constructor(){super(...arguments),e(this,"titleLabel",bH,this),e(this,"timeLabel",fH,this),e(this,"playerCountLabel",wH,this),e(this,"tournamentLeaders",SH,this),e(this,"viewport",vH,this),e(this,"playButton",CH,this),e(this,"continueButton",EH,this),e(this,"replayButton",TH,this),e(this,"leaderSkeletons",AH,this),e(this,"banners",RH,this),e(this,"paperConfetti",IH,this),this.animAbortSignal=null,this.fetchAbortController=null,this.leadersPayload=null,this.handleOpeningScreen=e=>{if(!this.screen)throw new Error("TournamentDetailScreen: screen not found");this.validateEventPayload(e)},this.handleOpenedScreen=e=>{this.validateEventPayload(e)&&this.open()}}__preload(){this.enabled=!1,this.screen=this.getComponent(Dk),this.tournamentScrollView=this.tournamentLeaders.node.getComponent(ce),this.validateRequiredComponents(),this.listenScreenEvents()}onDestroy(){this.unListenScreenEvents()}validateRequiredComponents(){Fe.lazyValidateProperties(this)}listenScreenEvents(){xH.on(DH.OPENING_SCREEN,this.handleOpeningScreen),xH.on(DH.OPENED_SCREEN,this.handleOpenedScreen)}unListenScreenEvents(){xH.off(DH.OPENING_SCREEN,this.handleOpeningScreen),xH.off(DH.OPENED_SCREEN,this.handleOpenedScreen)}updateVisibility(){this.tournamentLeaders.updateVisibility()}validateEventPayload(e){const{screenName:t}=e??{};return t===this.node.name&&(this.payload=e,!0)}open(){if(this.updateButtonVisibility(),this.setPlayerCountWaiting(),this.runPopUpAnimation(),this.node.scene.emit(Ha.HIDE_UI),this.tournamentScrollView.node.on(ce.EventType.SCROLLING,this.updateVisibility,this),null!==this.animAbortSignal)throw new Error("TournamentContent: TournamentContent is already loading. Please handle cancelling gracefully.");this.animAbortSignal=new oi,this.updateInfo(this.animAbortSignal)}close(){Wl.closeTournamentDetailScreen(),this.node.scene.emit(Ha.SHOW_UI),this.tournamentScrollView.node.off(ce.EventType.SCROLLING,this.updateVisibility,this),this.cleanup()}cleanup(){this.fetchAbortController?.abort(),this.animAbortSignal?.abort(),this.animAbortSignal=null,this.fetchAbortController=null,this.tournamentLeaders.removeLeaders()}runPopUpAnimation(){this.screen.container||console.warn("StartLevelScreen: screen not found")}async updateInfo(e){const t=this.payload?.screenData?.tournament;if(!t)return;const i=JSON.parse(t);i.id=i.id.toString(),this.tournamentPayload=i;const{endTime:n,payload:a,title:s}=this.tournamentPayload,{leaderboardId:o="",themeId:r}=a;this.updateTitle(s),this.updateEndTime(n),this.updateTournamentBanner(r);const{previousScore:l,previousRank:c,animateTournamentLeader:h}=FH.getStorage("tournament");if(this.updateButtonsVisibility(h),await this.showLoading(e),this.leadersPayload=await this.getLeadersPayload(o),!this.leadersPayload)return this.updatePlayerCount(0),void this.hideLoading(e);const{player:d,leaders:u}=this.leadersPayload;this.updatePlayerCount(u.length);const p=d?.score??0;if(d&&h&&l&&l<p&&c&&c!==(d?.rank??0)){kH.search(u,(e=>e.playerId===d.playerId)).score=l}await this.hideLoading(e),this.tournamentLeaders.updateData(u),await this.runShowUpAnimation(e),h&&(FH.setStorageData("tournament","animateTournamentLeader",!1),await this.runPlayerRankChangeAnimation(e,p))}updateTournamentBanner(e){e?this.activateThemeBanner(e):this.activateThemeBanner(tl.SUMMER)}activateThemeBanner(e){let t=!1;this.banners.forEach((i=>{i.node.active=i.node.name.toLowerCase()===e,i.node.active&&(t=!0)})),t||this.banners.forEach((e=>{e.node.active=e.node.name.toLowerCase()===tl.SUMMER}))}async showLoading(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;await Promise.all([this.leaderSkeletons.map(((i,n)=>i.show(n*t,e)))])}async hideLoading(e){await Promise.all(this.leaderSkeletons.map((t=>t.hide(e))))}async runShowUpAnimation(e){await this.tournamentLeaders.showLeaders(e);const t=this.tournamentLeaders.getPlayerLeader();t&&await this.scrollToLeader(t,1)}async runPlayerRankChangeAnimation(e,t){const i=this.tournamentLeaders.getLeaderData(),n=kH.search(i,(e=>e.playerId===BH.getPlayerId()));if(!n)return;const{score:a,rank:s}=n;if(a===t)return;n.score=t,i.sort(((e,t)=>t.score-e.score)),i.forEach(((e,t)=>{e.rank=t+1}));const o=this.tournamentLeaders.getPlayerLeader();if(!o)return;const r=this.tournamentLeaders.getLeaderByRank(n.rank);if(!r)return;this.tournamentLeaders.layout.enabled=!1,o.node.setParent(this.node,!0),await o.runScaleAnimation(e,1.1,.5),n.rank<=10&&Xi.playSound(Bi.STAR_CHEST_DRUM_ROLL);const l=Math.min(.5*(s-n.rank),2),c=[o.runUpdateDataAnimation(s,n.rank,a,n.score,l),this.scrollToLeader(r,l)],h=this.viewport.contentSize.height,d=this.viewport.getBoundingBoxToWorld(),u=this.tournamentScrollView.getMaxScrollOffset().y,p=-r.node.position.y-h/2;let m=j.ZERO;p<0?m=new j(o.node.worldPosition.x,d.yMax+r.node.position.y,o.node.worldPosition.z):this.tournamentScrollView.getScrollOffset().y>=u-5&&(m=p<u?new j(o.node.worldPosition.x,d.center.y,o.node.worldPosition.z):r.node.worldPosition),m.equals(j.ZERO)||c.push(o.runWorldPositionAnimation(m,l)),await Promise.all(c),Xi.stopSound(Bi.STAR_CHEST_DRUM_ROLL),await Promise.all([o.runScaleAnimation(e,1,.25),o.node.setParent(this.tournamentLeaders.layout.node,!0),o.node.setSiblingIndex(n.rank-1),this.tournamentLeaders.runUpdateLeadersRankAnimation(n.rank,s),this.runPaperConfettiEffect(n.rank)]),this.tournamentLeaders.layout.enabled=!0,this.tournamentLeaders.layout.updateLayout()}runPaperConfettiEffect(e){e>10||(this.paperConfetti.runEffect(),Xi.playSound(Bi.LEADERBOARD_TRIUMPH))}async scrollToLeader(e,t){const{contentSize:i}=this.tournamentLeaders.uiTransform,n=new J(0,-e.node.position.y-i.height/2),a=this.tournamentScrollView.getScrollOffset().clone();n.y=Math.max(n.y,0),a.y=Math.max(a.y,0);const s=n.y-a.y;if(!(Math.abs(s)<5))return this.tournamentScrollView.scrollToOffset(n,t),vt.waitTweenAsync(t)}updateTitle(e){e&&(this.titleLabel.string=e)}updateEndTime(e){let t=NH.getRelativeTime(e);t=t.replace("seconds","secs").replace("second","sec"),t=t.replace("minutes","mins").replace("minute","min"),this.timeLabel.string=`Ends ${t}`}updatePlayerCount(e){const t=MH.getShortNumber(e,3);this.playerCountLabel.string=`${t} `+(e>1?"players":"player")}setPlayerCountWaiting(){this.playerCountLabel.string="Loading..."}async getLeadersPayload(e){const t=zH.getLeaderboardName(e);if(!t)return null;await zH.requestLeaderboardAsync(t,0);const i=zH.getLeaderboard(t);if(!i)return null;const n=OH.vals(i.leaders),a=BH.getPlayerId(),s={leaders:[],player:void 0,isPlayerInTournament:!1};for(const e of n){const{playerId:t}=e;t===a?(s.player=e,s.isPlayerInTournament=!0,s.leaders.push(e)):s.leaders.push(e)}return s}updateButtonsVisibility(e){this.playButton.active=!e,this.continueButton.active=e,this.replayButton.active=e}async handleOnPlay(){const e=this.tournamentPayload.id||"";if(Ql.validateTournamentExpired(e))return this.close(),this.node.scene.emit(Gr.RELOAD_TOURNAMENT),void Wl.showNotificationScreen("Tournament has ended",2);try{Wl.showLoadingNotificationScreen(),await Sl.setMatchCustomDataAsync({level:1,score:0}),await this.processJoinTournament()}catch(e){if(OH.hasOwn(e,"code")&&"USER_INPUT"===e.code)return void Wl.closeNotificationScreen();try{await this.processContinueTournament()}catch(e){if(OH.hasOwn(e,"code")&&"USER_INPUT"===e.code)return void Wl.closeNotificationScreen();console.error("processPlayButtonPressed",e),Wl.showNotificationScreen("Sorry, you cannot join\nat this time.",2)}}}async processJoinTournament(){try{await this.joinTournamentAsync(),El.switchScene(Br,{level:1})}catch(e){throw console.warn("processJoinTournament",e),e}}async processContinueTournament(){try{await this.continueTournamentAsync(),El.switchScene(Br,{level:1})}catch(e){throw console.warn("processContinueTournament",e),e}}async joinTournamentAsync(){const e=this.tournamentPayload.id||"";await Sl.joinTournamentAsync(e)}async continueTournamentAsync(){const e=GameSDK.context.getID()??"";await Sl.continueTournamentAsync(e)}updateButtonVisibility(){const{tournamentContextType:e="tournament_start"}=this.payload?.screenData??{};switch(e){case"tournament_end":this.playButton.active=!1,this.continueButton.active=!0,this.replayButton.active=!0;break;case"tournament_start":this.playButton.active=!0,this.continueButton.active=!1,this.replayButton.active=!1}}}).prototype,"titleLabel",[aH],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),fH=ve(yH.prototype,"timeLabel",[sH],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wH=ve(yH.prototype,"playerCountLabel",[oH],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),SH=ve(yH.prototype,"tournamentLeaders",[rH],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),vH=ve(yH.prototype,"viewport",[lH],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),CH=ve(yH.prototype,"playButton",[cH],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),EH=ve(yH.prototype,"continueButton",[hH],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),TH=ve(yH.prototype,"replayButton",[dH],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),AH=ve(yH.prototype,"leaderSkeletons",[uH],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),RH=ve(yH.prototype,"banners",[pH],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),IH=ve(yH.prototype,"paperConfetti",[mH],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),gH=yH))||gH);var UH;i._RF.pop(),i._RF.push({},"36d58kn8v5POaqgX4C8S3ct","TournamentLeader",void 0);const{ccclass:GH}=a;GH("TournamentLeader")(UH=class extends J_{});i._RF.pop(),i._RF.push({},"43001Am3F9GVZjL3Nj2K44h","CoreManager",void 0);const{Events:HH}=GameCore,{event:VH,monitorError:qH}=globalThis.game;class WH{constructor(){this.callbackCoreBooting=null,this.callbackCoreStarting=null,this.callbackCoreReady=null,this.handleWhenCoreBooting=()=>{if(!this.callbackCoreBooting)return console.error("Core: Booting callback is not set"),void qH?.sendException(new Error("Core: Booting callback is not set"));console.info(" Core: Boot"),this.callbackCoreBooting(),this.callbackCoreBooting=null},this.handleWhenCoreStarting=()=>{if(!this.callbackCoreStarting)return console.error("Core: Starting callback is not set"),void qH?.sendException(new Error("Core: Starting callback is not set"));console.info(" Core: Starting"),this.callbackCoreStarting(),this.callbackCoreStarting=null},this.handleWhenCoreReady=()=>{if(!this.callbackCoreReady)return console.error("Core: Ready callback is not set"),void qH?.sendException(new Error("Core: Ready callback is not set"));console.info(" Core: Ready"),this.callbackCoreReady(),this.callbackCoreReady=null}}init(){this.listenEvents(),console.info("Core Manager: Initialized")}listenEvents(){VH.once(HH.CORE_BOOTING,this.handleWhenCoreBooting),VH.once(HH.CORE_STARTING,this.handleWhenCoreStarting),VH.once(HH.CORE_READY,this.handleWhenCoreReady)}requestStart(){VH.emit(HH.REQUEST_CORE_START)}onCoreBoot(e){this.callbackCoreBooting=e;VH.getEventEmitCount(HH.CORE_BOOTING)>0&&(VH.off(HH.CORE_BOOTING,this.handleWhenCoreBooting),this.handleWhenCoreBooting())}onCoreStart(e){this.callbackCoreStarting=e;VH.getEventEmitCount(HH.CORE_STARTING)>0&&(VH.off(HH.CORE_STARTING,this.handleWhenCoreStarting),this.handleWhenCoreStarting())}onCoreReady(e){this.callbackCoreReady=e;VH.getEventEmitCount(HH.CORE_READY)>0&&(VH.off(HH.CORE_READY,this.handleWhenCoreReady),this.handleWhenCoreReady())}}i._RF.pop(),i._RF.push({},"b4ad5mMokdAa6EVNGzNedpF","EngineManager",void 0);const{Configs:{GameEngine:{DynamicAtlas:KH}},Utils:{Valid:YH}}=GameCore;class jH{constructor(){this.overrideSettings=()=>{ue.overrideSettings(pe.Category.ENGINE,"debug",YH.isDebugger())},this.handleResizeView=e=>{le.instance.resizeWithBrowserSize(!1);const{width:t,height:i}=e;this.resizeView(t,i)},this.handleViewResized=e=>{const{width:t,height:i}=e;le.instance.resizeWithBrowserSize(!0),console.info(" New View Size",{width:t,height:i})}}init(){this.overrideSettings(),this.setupAutoAtlas(),this.setupBatcherLimit(),this.setupDynamicAtlas(),this.listenEvents(),console.info("Engine Manager: Initialized")}listenEvents(){W.on(Kn,this.handleResizeView),W.on(Yn,this.handleViewResized)}setupAutoAtlas(){me.instance.cacheAsset=!0}setupDynamicAtlas(){switch(Y.os){case Y.OS.IOS:this.setupDynamicAtlasForIOS();break;case Y.OS.ANDROID:this.setupDynamicAtlasForAndroid();break;default:this.setupDynamicAtlasForDesktop()}}setDynamicAtlas(e){const{Enabled:t,AutoAtlasSize:i,MaxAtlasCount:n,MaxAtlasSize:a,MaxFrameSize:s}=e;if(ge.instance.enabled=t,ge.instance.textureSize=a,ge.instance.maxFrameSize=s,ge.instance.maxAtlasCount=n,ge.instance.textureBleeding=!0,i){const e=this.getMaxTextureSize();if(!e)return;ge.instance.maxAtlasCount=1,ge.instance.textureSize=e}}getMaxTextureSize(){if(!m.root)return-1;const{capabilities:e}=m.root.device,{maxTextureSize:t}=e;return t>8192?7168:t-1024}setupDynamicAtlasForIOS(){const{IOS:e}=KH;this.setDynamicAtlas(e)}setupDynamicAtlasForAndroid(){const{Android:e}=KH;this.setDynamicAtlas(e)}setupDynamicAtlasForDesktop(){const{Desktop:e}=KH;this.setDynamicAtlas(e)}setupBatcherLimit(){ye.BATCHER2D_MEM_INCREMENT=288,ye.MAX_LABEL_CANVAS_POOL_SIZE=125}resizeView(e,t){const i=window.devicePixelRatio,n=i>=2?2/i:1,a=e*i*n,s=t*i*n;m.root?.resize(a,s),B.windowSize=new z.Size(a,s),m.once(Q.EVENT_AFTER_UPDATE,(()=>{W.emit(Yn,{width:a,height:s})}))}}i._RF.pop();var XH=new class{constructor(){this._registry={},this._moduleCache={}}define(e,t,i){this._registry[e]={factory:t,resolveMap:i}}require(e){return this._require(e)}throwInvalidWrapper(e,t){throw new Error(`Module '${e}' imported from '${t}' is expected be an ESM-wrapped CommonJS module but it doesn't.`)}_require(e,t){const i=this._moduleCache[e];if(i)return i.exports;const n={id:e,exports:{}};return this._moduleCache[e]=n,this._tryModuleLoad(n,e),n.exports}_resolve(e,t){return this._resolveFromInfos(e,t)||this._throwUnresolved(e,t)}_resolveFromInfos(e,t){return e in cjsInfos?e:t?cjsInfos[t]?.resolveCache[e]??void 0:void 0}_tryModuleLoad(e,t){let i=!0;try{this._load(e,t),i=!1}finally{i&&delete this._moduleCache[t]}}_load(e,t){const{factory:i,resolveMap:n}=this._loadWrapper(t),a=this._createRequire(e),s=n?this._createRequireWithResolveMap("function"==typeof n?n():n,a):a;i(e.exports,s,e)}_loadWrapper(e){return e in this._registry?this._registry[e]:this._loadHostProvidedModules(e)}_loadHostProvidedModules(e){return{factory:(t,i,n)=>{if("undefined"==typeof require)throw new Error(`Current environment does not provide a require() for requiring '${e}'.`);try{n.exports=require(e)}catch(t){throw new Error(`Exception thrown when calling host defined require('${e}').`,{cause:t})}}}}_createRequire(e){return t=>this._require(t,e)}_createRequireWithResolveMap(e,t){return i=>{const n=e[i];if(n)return t(n);throw new Error("Unresolved specifier "+i)}}_throwUnresolved(e,t){throw new Error(`Unable to resolve ${e} from ${parent}.`)}};let $H;const JH="file:///D:/VSCode%20Project/tile-connect-remaster-game/node_modules/resize-observer-polyfill/dist/ResizeObserver.js";XH.define(JH,(function(e,t,i,n,a){!function(t,n){"object"==typeof e&&void 0!==i?i.exports=n():"function"==typeof define&&define.amd?define(n):t.ResizeObserver=n()}(this,(function(){var e=function(){if("undefined"!=typeof Map)return Map;function e(e,t){var i=-1;return e.some((function(e,n){return e[0]===t&&(i=n,!0)})),i}return function(){function t(){this.__entries__=[]}return Object.defineProperty(t.prototype,"size",{get:function(){return this.__entries__.length},enumerable:!0,configurable:!0}),t.prototype.get=function(t){var i=e(this.__entries__,t),n=this.__entries__[i];return n&&n[1]},t.prototype.set=function(t,i){var n=e(this.__entries__,t);~n?this.__entries__[n][1]=i:this.__entries__.push([t,i])},t.prototype.delete=function(t){var i=this.__entries__,n=e(i,t);~n&&i.splice(n,1)},t.prototype.has=function(t){return!!~e(this.__entries__,t)},t.prototype.clear=function(){this.__entries__.splice(0)},t.prototype.forEach=function(e,t){void 0===t&&(t=null);for(var i=0,n=this.__entries__;i<n.length;i++){var a=n[i];e.call(t,a[1],a[0])}},t}()}(),t="undefined"!=typeof window&&"undefined"!=typeof document&&window.document===document,i="undefined"!=typeof global&&global.Math===Math?global:"undefined"!=typeof self&&self.Math===Math?self:"undefined"!=typeof window&&window.Math===Math?window:Function("return this")(),n="function"==typeof requestAnimationFrame?requestAnimationFrame.bind(i):function(e){return setTimeout((function(){return e(Date.now())}),1e3/60)};var a=["top","right","bottom","left","width","height","size","weight"],s="undefined"!=typeof MutationObserver,o=function(){function e(){this.connected_=!1,this.mutationEventsAdded_=!1,this.mutationsObserver_=null,this.observers_=[],this.onTransitionEnd_=this.onTransitionEnd_.bind(this),this.refresh=function(e,t){var i=!1,a=!1,s=0;function o(){i&&(i=!1,e()),a&&l()}function r(){n(o)}function l(){var e=Date.now();if(i){if(e-s<2)return;a=!0}else i=!0,a=!1,setTimeout(r,t);s=e}return l}(this.refresh.bind(this),20)}return e.prototype.addObserver=function(e){~this.observers_.indexOf(e)||this.observers_.push(e),this.connected_||this.connect_()},e.prototype.removeObserver=function(e){var t=this.observers_,i=t.indexOf(e);~i&&t.splice(i,1),!t.length&&this.connected_&&this.disconnect_()},e.prototype.refresh=function(){this.updateObservers_()&&this.refresh()},e.prototype.updateObservers_=function(){var e=this.observers_.filter((function(e){return e.gatherActive(),e.hasActive()}));return e.forEach((function(e){return e.broadcastActive()})),e.length>0},e.prototype.connect_=function(){t&&!this.connected_&&(document.addEventListener("transitionend",this.onTransitionEnd_),window.addEventListener("resize",this.refresh),s?(this.mutationsObserver_=new MutationObserver(this.refresh),this.mutationsObserver_.observe(document,{attributes:!0,childList:!0,characterData:!0,subtree:!0})):(document.addEventListener("DOMSubtreeModified",this.refresh),this.mutationEventsAdded_=!0),this.connected_=!0)},e.prototype.disconnect_=function(){t&&this.connected_&&(document.removeEventListener("transitionend",this.onTransitionEnd_),window.removeEventListener("resize",this.refresh),this.mutationsObserver_&&this.mutationsObserver_.disconnect(),this.mutationEventsAdded_&&document.removeEventListener("DOMSubtreeModified",this.refresh),this.mutationsObserver_=null,this.mutationEventsAdded_=!1,this.connected_=!1)},e.prototype.onTransitionEnd_=function(e){var t=e.propertyName,i=void 0===t?"":t;a.some((function(e){return!!~i.indexOf(e)}))&&this.refresh()},e.getInstance=function(){return this.instance_||(this.instance_=new e),this.instance_},e.instance_=null,e}(),r=function(e,t){for(var i=0,n=Object.keys(t);i<n.length;i++){var a=n[i];Object.defineProperty(e,a,{value:t[a],enumerable:!1,writable:!1,configurable:!0})}return e},l=function(e){return e&&e.ownerDocument&&e.ownerDocument.defaultView||i},c=g(0,0,0,0);function h(e){return parseFloat(e)||0}function d(e){for(var t=[],i=1;i<arguments.length;i++)t[i-1]=arguments[i];return t.reduce((function(t,i){return t+h(e["border-"+i+"-width"])}),0)}function u(e){var t=e.clientWidth,i=e.clientHeight;if(!t&&!i)return c;var n=l(e).getComputedStyle(e),a=function(e){for(var t={},i=0,n=["top","right","bottom","left"];i<n.length;i++){var a=n[i],s=e["padding-"+a];t[a]=h(s)}return t}(n),s=a.left+a.right,o=a.top+a.bottom,r=h(n.width),u=h(n.height);if("border-box"===n.boxSizing&&(Math.round(r+s)!==t&&(r-=d(n,"left","right")+s),Math.round(u+o)!==i&&(u-=d(n,"top","bottom")+o)),!function(e){return e===l(e).document.documentElement}(e)){var p=Math.round(r+s)-t,m=Math.round(u+o)-i;1!==Math.abs(p)&&(r-=p),1!==Math.abs(m)&&(u-=m)}return g(a.left,a.top,r,u)}var p="undefined"!=typeof SVGGraphicsElement?function(e){return e instanceof l(e).SVGGraphicsElement}:function(e){return e instanceof l(e).SVGElement&&"function"==typeof e.getBBox};function m(e){return t?p(e)?function(e){var t=e.getBBox();return g(0,0,t.width,t.height)}(e):u(e):c}function g(e,t,i,n){return{x:e,y:t,width:i,height:n}}var y=function(){function e(e){this.broadcastWidth=0,this.broadcastHeight=0,this.contentRect_=g(0,0,0,0),this.target=e}return e.prototype.isActive=function(){var e=m(this.target);return this.contentRect_=e,e.width!==this.broadcastWidth||e.height!==this.broadcastHeight},e.prototype.broadcastRect=function(){var e=this.contentRect_;return this.broadcastWidth=e.width,this.broadcastHeight=e.height,e},e}(),b=function(e,t){var i,n,a,s,o,l,c,h=(n=(i=t).x,a=i.y,s=i.width,o=i.height,l="undefined"!=typeof DOMRectReadOnly?DOMRectReadOnly:Object,c=Object.create(l.prototype),r(c,{x:n,y:a,width:s,height:o,top:a,right:n+s,bottom:o+a,left:n}),c);r(this,{target:e,contentRect:h})},f=function(){function t(t,i,n){if(this.activeObservations_=[],this.observations_=new e,"function"!=typeof t)throw new TypeError("The callback provided as parameter 1 is not a function.");this.callback_=t,this.controller_=i,this.callbackCtx_=n}return t.prototype.observe=function(e){if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");if("undefined"!=typeof Element&&Element instanceof Object){if(!(e instanceof l(e).Element))throw new TypeError('parameter 1 is not of type "Element".');var t=this.observations_;t.has(e)||(t.set(e,new y(e)),this.controller_.addObserver(this),this.controller_.refresh())}},t.prototype.unobserve=function(e){if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");if("undefined"!=typeof Element&&Element instanceof Object){if(!(e instanceof l(e).Element))throw new TypeError('parameter 1 is not of type "Element".');var t=this.observations_;t.has(e)&&(t.delete(e),t.size||this.controller_.removeObserver(this))}},t.prototype.disconnect=function(){this.clearActive(),this.observations_.clear(),this.controller_.removeObserver(this)},t.prototype.gatherActive=function(){var e=this;this.clearActive(),this.observations_.forEach((function(t){t.isActive()&&e.activeObservations_.push(t)}))},t.prototype.broadcastActive=function(){if(this.hasActive()){var e=this.callbackCtx_,t=this.activeObservations_.map((function(e){return new b(e.target,e.broadcastRect())}));this.callback_.call(e,t,e),this.clearActive()}},t.prototype.clearActive=function(){this.activeObservations_.splice(0)},t.prototype.hasActive=function(){return this.activeObservations_.length>0},t}(),w="undefined"!=typeof WeakMap?new WeakMap:new e,S=function e(t){if(!(this instanceof e))throw new TypeError("Cannot call a class as a function.");if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");var i=o.getInstance(),n=new f(t,i,this);w.set(this,n)};return["observe","unobserve","disconnect"].forEach((function(e){S.prototype[e]=function(){var t;return(t=w.get(this))[e].apply(t,arguments)}})),void 0!==i.ResizeObserver?i.ResizeObserver:S})),$H=i.exports}),{}),XH.require(JH),i._RF.push({},"9f0a0l1uXlNwqKEKardFRyv","LayoutManager",void 0);const{Layout:QH,DesignSize:ZH}=na,{Portrait:eV,Landscape:tV}=ZH,{Utils:{Function:iV}}=GameCore;class nV{constructor(){this.currentLayout="",this.handleViewResizeBySystem=e=>{console.info(" View resize by system"),window.devicePixelRatio=e||window.devicePixelRatio,this.setupOrientationByScreenSize(),this.resizeGameView()},this.handleViewResize=iV.debounce((()=>{console.info(" View resize by window"),this.setupOrientationByScreenSize(),this.resizeGameView()}),200),this.handleBodyResize=iV.debounce((()=>{this.resizeGameDiv()&&(console.info(" View resize by body"),this.setupOrientationByScreenSize(),this.resizeGameView())}),200)}init(){this.listenResizeEvent(),this.listenObserverEvent(),this.setupResolutionPolicy(),W.emit(jn),console.info("Layout Manager: Initialized")}listenResizeEvent(){Y.isBrowser?(B.on("window-resize",this.handleViewResize,this),B.on("orientation-change",this.handleViewResize,this)):Y.isMobile?window.addEventListener("resize",this.handleViewResize,{capture:!1,passive:!0}):console.warn("LayoutManager: Not support this platform"),W.on(jn,this.handleViewResizeBySystem)}listenObserverEvent(){new $H(this.handleBodyResize).observe(document.body)}setupResolutionPolicy(){le.instance.resizeWithBrowserSize(!0),le.instance.setOrientation(ye.ORIENTATION_AUTO),le.instance.setResolutionPolicy(be.ContentStrategy.FIXED_WIDTH),le.instance.setResolutionPolicy(be.ContainerStrategy.EQUAL_TO_FRAME),this.resolutionPolicy=le.instance.getResolutionPolicy()}setupOrientationByScreenSize(){const e=this.getScreenRatio();this.resolutionPolicy.setContentStrategy(be.ContentStrategy.FIXED_WIDTH),e<1?this.setPortraitView():this.setLandscapeView()}resizeGameDiv(){const e=document.getElementById("GameDiv");if(!e)return!1;const t=$i.getScreenWidthCss(),i=$i.getScreenHeightCss(),{width:n,height:a}=e.getBoundingClientRect();return(t!==n||i!==a)&&(e.style.width=`${t}px`,e.style.height=`${i}px`,!0)}resizeGameView(){let e=$i.getScreenWidthCss(),t=$i.getScreenHeightCss();W.emit(Kn,{width:e,height:t})}setPortraitView(){let{WIDTH:e,HEIGHT:t}=eV;na.FORCE_LAYOUT===QH.Landscape&&(e=tV.WIDTH,t=tV.HEIGHT,this.resolutionPolicy.setContentStrategy(be.ContentStrategy.SHOW_ALL)),this.currentLayout=QH.Portrait,this.changeDesignResolutionSize(e,t)}setLandscapeView(){let{WIDTH:e,HEIGHT:t}=tV;na.FORCE_LAYOUT===QH.Portrait&&(e=eV.WIDTH,t=eV.HEIGHT,this.resolutionPolicy.setContentStrategy(be.ContentStrategy.EXACT_FIT)),this.currentLayout=QH.Landscape,this.changeDesignResolutionSize(e,t)}changeDesignResolutionSize(e,t){le.instance.setDesignResolutionSize(e,t,this.resolutionPolicy),W.emit(Xn,this.currentLayout),console.info(" Change layout to",this.currentLayout)}getScreenRatio(){return $i.getScreenWidthCss()/$i.getScreenHeightCss()}}i._RF.pop(),i._RF.push({},"535cbXcmXdEzLn3H3LOIS27","MatchManager",void 0);const{Utils:{Valid:aV,Object:sV,Array:oV},Dtos:{Match:{CustomData:rV,Data:lV}}}=GameCore,cV=["code","cols","encoding","idSize","rows"],hV=["addRandomTilesPerMove","maxSpaceOfPair"];class dV{init(){console.info("Match Manager: Initialized")}setupDefaultMatchData(){this.setupMatchData(),this.setupMatchCustomData()}setupMatchCustomData(){rV.addDefaultData(kr),rV.addValidateFunction("score",(e=>{if(!aV.isNumber(e)||e<0)throw new Error(`score ${e} is invalid`)}))}setupMatchData(){lV.addDefaultData(Rr),lV.addValidateFunction("extraData",(e=>{if(null==e)return;if(!aV.isObject(e))throw new Error(`extraData ${e} must be a record of string keys`);const t=e,i=Object.keys(t);if(!oV.has(i,"level"))throw new Error("extraData.level is missing");if(!aV.isNumber(t.level))throw new Error(`extraData.level ${t.level} must be a number`);if(!oV.has(i,"fen"))throw new Error("extraData.fen is missing");if(this.validateFen(t.fen),!oV.has(i,"gravity"))throw new Error("extraData.gravity is missing");if(!aV.isString(t.gravity))throw new Error(`extraData.gravity ${t.gravity} must be a string`);if(!oV.has(i,"rules"))throw new Error("extraData.rules is missing");if(this.validateLevelRules(t.rules),!oV.has(i,"time"))throw new Error("extraData.time is missing");if(!aV.isNumber(t.time))throw new Error(`extraData.time ${t.time} must be a number`)}))}validateFen(e){if(!aV.isObject(e))throw new Error(`extraData.fen ${e} must be a record of string keys`);const t=this.validateKeys(e,cV);if(!aV.isNumber(t.idSize))throw new Error("fen.idSize must be a number");if(!aV.isString(t.code))throw new Error("fen.code must be a string");if(!aV.isNumber(t.rows))throw new Error("fen.rows must be a number");if(!aV.isNumber(t.cols))throw new Error("fen.cols must be a number");if(!aV.isObject(t.encoding))throw new Error("fen.encoding must be a record of string keys");const i=this.validateKeys(t.encoding,sV.vals(pc));Object.entries(i).forEach((e=>{let[t,i]=e;if(!aV.isString(i))throw new Error(`fen.encoding.${t} ${i} must be a string`)}))}validateLevelRules(e){if(!aV.isObject(e))throw new Error(`extraData.rules ${e} must be a record of string keys`);const t=this.validateKeys(e,hV);if(!aV.isNumber(t.addRandomTilesPerMove))throw new Error("rules.addRandomTilesPerMove must be a number");if(!aV.isNumber(t.maxSpaceOfPair))throw new Error("rules.maxSpaceOfPair must be a number")}validateKeys(e,t){return Object.keys(e).forEach((e=>{if(!oV.has(t,e))throw new Error(`Key ${e} is missing`)})),e}}i._RF.pop(),i._RF.push({},"d675ctpYslBHp4qqiYEki+q","PlayerManager",void 0);const{Utils:{Valid:uV,Array:pV,Object:mV},Dtos:gV}=GameCore,{player:yV}=globalThis.game;class bV{init(){console.info("Player Manager: Initialized")}setupDefaultGameData(){const{Player:e}=gV;e.Data.addDefaultData(xr),e.GameData.addDefaultData(_r),e.GameData.addValidateFunction("stars",(e=>{if(!uV.isNumber(e)||e<0)throw new Error(`stars ${e} is invalid`)})),e.GameData.addValidateFunction("totalLevel",(e=>{if(!uV.isNumber(e)||e<1)throw new Error(`totalLevel ${e} is invalid`)})),e.GameData.addValidateFunction("levelVersion",(e=>{if(!uV.isNumber(e)||e<0)throw new Error(`levelVersion ${e} is invalid`)})),e.GameData.addValidateFunction("lastRewardedItems",(e=>{if(!uV.isNumber(e)||e<0)throw new Error(`lastRewardedItems ${e} is invalid`)})),e.GameData.addValidateFunction("lastCreateTournamentShown",(e=>{if(!uV.isNumber(e)||e<0)throw new Error(`lastCreateTournamentShown ${e} is invalid`)})),e.GameData.addValidateFunction("guideItemShowed",(e=>{if(!Array.isArray(e))throw new Error(`guideItemShowed ${e} is invalid`)})),e.GameData.addValidateFunction("items",(e=>{if(!uV.isObject(e))throw new Error(`items ${e} is invalid`);const t=Object.keys(e),i=mV.vals(e);if(!pV.has(t,br.HINT))throw new Error(`item ${br.HINT} not found`);if(!pV.has(t,br.THUNDER))throw new Error(`item ${br.THUNDER} not found`);if(!pV.has(t,br.STORM))throw new Error(`item ${br.STORM} not found`);if(!pV.has(t,br.PLIERS))throw new Error(`item ${br.PLIERS} not found`);i.forEach((e=>{if(!uV.isNumber(e)||e<0)throw new Error(`item ${e} is invalid`)}))})),e.GameData.addValidateFunction("skins",(e=>{if(!uV.isObject(e))throw new Error(`skins ${e} is invalid`)}))}requestConnectedPlayers(){yV.requestConnectedPlayers().catch((e=>{console.warn("player.requestConnectedPlayers",e)}))}}i._RF.pop(),i._RF.push({},"51079bCfn9MZK6cuxbahS7M","AdaptivePerformance",void 0);const{Events:fV,Utils:{Valid:wV}}=GameCore,{event:SV,adaptivePerformance:vV}=globalThis.game;class CV{constructor(){this.handleBeginFrame=()=>{m.on(Q.EVENT_AFTER_UPDATE,this.lateUpdate),m.on(Q.EVENT_BEFORE_UPDATE,this.updateActualFPS)},this.handleAfterSceneLaunch=e=>{vV&&vV.trackingScene(e.name)},this.handleRequestResizeGame=e=>{const{forcePixelRatio:t}=e;wV.isNumber(t)&&W.emit(jn,t)},this.lateUpdate=()=>{const e=1e3*W.deltaTime;vV?.updatePostStepDeltaTime(e)},this.updateActualFPS=()=>{const e=m.root?.fps;wV.isNumber(e)&&vV?.updateActualFPS(e)}}init(){vV&&this.listenEvents()}listenEvents(){SV.on(fV.REQUEST_RESIZE_GAME,this.handleRequestResizeGame),m.once(Q.EVENT_BEGIN_FRAME,this.handleBeginFrame),m.on(Q.EVENT_AFTER_SCENE_LAUNCH,this.handleAfterSceneLaunch)}}i._RF.pop(),i._RF.push({},"0bbd4wf2fRDcKljBcls6K8a","CanvasRecorder",void 0);const{canvasRecorder:EV}=globalThis.game;class TV{init(){if(!W.canvas||!EV)return;EV.setCanvas(W.canvas);const e=EV.getOptions(),t=EV.waitNextFrame;EV.waitNextFrame=async()=>e.syncFps?new Promise((e=>{m.once(Q.EVENT_AFTER_RENDER,e),W.pause(),W.step()})):(W.resume(),await t.call(EV),Promise.resolve())}}i._RF.pop(),i._RF.push({},"4a29byVcRpBGogGcAwYASiP","CocosStats",void 0);class AV{constructor(){this.hideCocosStats=()=>{clearInterval(this.waiter),this.waiter=setInterval(this.checkProfilerReady,100)},this.checkProfilerReady=()=>{if(!K)return;K._showFPS=!1;const{_rootNode:e}=K;e&&(e.active=!1,e.isValid&&(e.destroyAllChildren(),e.removeAllChildren(),e.destroy(),clearInterval(this.waiter)))}}init(){K&&m.on(Q.EVENT_BEFORE_SCENE_LAUNCH,this.hideCocosStats)}}i._RF.pop(),i._RF.push({},"49a72YoKFFCKbOm5Xgp9R+k","DynamicAssets",void 0);const{Configs:{GameEngine:{DynamicAssets:RV}},Events:IV,Utils:{Array:PV}}=GameCore,{event:_V}=globalThis.game,LV=[".png",".jpg",".jpeg",".webp"];class DV{constructor(){this.useHighQuality=!1,this.upgradableAssets=new Map,this.requestUpdateDynamicAssets=()=>{W.emit(ia)},this.collectUpgradableAssets=e=>{const t=e.output=e.input;for(const e of t)if(PV.has(LV,e.ext)&&!this.upgradableAssets.has(e.uuid)){this.useHighQuality&&(e.url=this.replaceAssetUrl(e.url),e.requestUpgrade=!0);const t={uuid:e.uuid,url:e.url,options:e.options,upgraded:e.upgraded,requestUpgrade:e.requestUpgrade,ext:e.ext};this.upgradableAssets.set(e.uuid,t)}},this.replaceAssetUrl=e=>this.useHighQuality?e.replace("native/","native32/"):e,this.handleUpgradeQuality=()=>{this.useHighQuality=!0;let e=0,t=0;const{assets:i,loadAny:n}=me.instance;let a=0;this.upgradableAssets.forEach((s=>{if(s.upgraded||s.requestUpgrade)return void e++;t++;const o=i.get(s.uuid);o instanceof O?(s.url=this.replaceAssetUrl(s.url),console.info("DynamicAssets: Process upgrade quality",s.uuid,s,o),n(s,s.options,((e,i)=>{a++,e?console.warn("DynamicAssets: Upgrade error",e):(o.reset(i),s.upgraded=!0,this.upgradableAssets.set(s.uuid,s),console.info("DynamicAssets: Upgrade done",s.uuid,i,o),a>=t&&this.requestUpdateDynamicAssets())}))):console.warn("DynamicAssets: Asset not found",s.uuid)})),console.warn("DynamicAssets: Upgradable Assets Info",{needUpgrade:t,upgraded:e,total:this.upgradableAssets.size})}}init(){const{Enabled:e}=RV;console.info("DynamicAssets: init",{EDITOR:false,Enabled:e}),e&&(me.instance.transformPipeline.insert(this.collectUpgradableAssets,3),this.listenEvents())}listenEvents(){W.on(ta,this.handleUpgradeQuality),_V.on(IV.SCENE_LAUNCHED,(e=>{const t=e.sceneName,i=[Fr];PV.has(i,t)||this.handleUpgradeQuality()}))}}i._RF.pop(),i._RF.push({},"15ecbqnx5lFtYRSJp2lOLCm","DynamicAtlas",void 0);const{Configs:{GameEngine:{DynamicAtlas:OV}},Utils:{Array:NV},Events:MV}=GameCore,{event:kV}=globalThis.game;class xV{constructor(){this.drawInfo=[],this.atlasInfo=null,this.lastRenderTime=0,this.updateRenderTime=()=>{this.lastRenderTime=performance.now()},this.checkRenderTimeHighers=()=>{const e=performance.now()-this.lastRenderTime;e>8&&(m.off(Q.EVENT_AFTER_RENDER,this.checkRenderTimeHighers),console.warn(`DynamicAtlas: Laggy frame detected, render time is ${e.toFixed(2)}ms`),this.requestUpdateDynamicAtlas(),setTimeout((()=>{m.on(Q.EVENT_AFTER_RENDER,this.checkRenderTimeHighers)}),2e3))},this.requestUpdateDynamicAtlas=()=>{m.once(Q.EVENT_AFTER_RENDER,this.updateDynamicAtlas)},this.updateDynamicAtlas=()=>{const e=m.getScene();if(!e)return;const t=e.getComponentsInChildren(fe),i=[],n={};t.forEach((e=>{if(!e.enabled)return;if(!e.node.activeInHierarchy)return;if(!("spriteFrame"in e))return;if(!(e.spriteFrame instanceof N))return;const{uuid:t,packable:a,texture:s,original:o}=e.spriteFrame;if(!a)return void console.warn("DynamicAtlas: Skip non-packable texture",e.name);if(!(s instanceof we))return void console.warn("DynamicAtlas: Skip non-texture2d texture",e.name);let r=s.getId();const{width:l,height:c}=s,{width:h,height:d}=o?._texture||{width:0,height:0};if(o){const t=o._texture.getId();if(r===t)return void console.warn("DynamicAtlas: Skip original texture",e.name,{ori:o._texture,tex:s});r=t}let u=o?h:l,p=o?d:c;if(u<=1||p<=1)return void console.warn("DynamicAtlas: Skip invalid texture size",e.name,{w:u,h:p});u+=2,p+=2;const m={id:r,w:u,h:p,x:-1,y:-1};n[r]?n[r].components.push(e):(i.push(m),n[r]={...m,name:t,components:[e]})})),console.info("DynamicAtlas: collect info",n),i.length<1||(console.info("DynamicAtlas: process textures",i),this.drawInfo=[],this.atlasInfo=null,this.generateDrawInfo(i),this.atlasInfo?(this.updateAtlasData(),this.refreshComponents(t)):console.warn("DynamicAtlas: Atlas info not found",{textures:i}))},this.generateDrawInfo=e=>{if(e.length<1)return;console.info("DynamicAtlas: generate draw info",e);const{textureSize:t}=ge.instance;if(this.calculateOptimizedAtlas(e,t),!this.atlasInfo)return void console.warn("DynamicAtlas: Atlas info not found",{textures:e});const{textures:i}=this.atlasInfo;if(i.forEach((e=>{this.drawInfo.push(e)})),e.length>i.length){const t=e.filter((e=>!i.some((t=>t.id===e.id))));console.warn("DynamicAtlas: Missing textures",t),this.generateDrawInfo(t)}},this.calculateOptimizedAtlas=(e,t)=>{const{w:i,h:n,fill:a}=function(e){let t=0,i=0;for(const n of e)t+=n.w*n.h,i=Math.max(i,n.w);e.sort(((e,t)=>t.h-e.h));const n=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(t/.95)),i),h:1/0}];let a=0,s=0;for(const t of e)for(let e=n.length-1;e>=0;e--){const i=n[e];if(!(t.w>i.w||t.h>i.h)){if(t.x=i.x,t.y=i.y,s=Math.max(s,t.y+t.h),a=Math.max(a,t.x+t.w),t.w===i.w&&t.h===i.h){const t=n.pop();e<n.length&&(n[e]=t)}else t.h===i.h?(i.x+=t.w,i.w-=t.w):t.w===i.w?(i.y+=t.h,i.h-=t.h):(n.push({x:i.x+t.w,y:i.y,w:i.w-t.w,h:t.h}),i.y+=t.h,i.h-=t.h);break}}return{w:a,h:s,fill:t/(a*s)||0}}(e);if(i>t||n>t){e.pop()?this.calculateOptimizedAtlas(e,t):console.warn("DynamicAtlas: Texture size is too big",i,n,t)}else this.atlasInfo={textures:e,atlasSize:t,packedInfo:{width:i,height:n,fillRate:a}}},this.drawTexture=(e,t,i)=>{const n=t.texture,a=n.getId(),s=NV.search([...this.drawInfo],(e=>e.id===a)),{x:o,y:r}=s||{x:-1,y:-1};if(o<0||r<0)return;const l=e._innerTextureInfos[a];l||(i&&(e._texture.drawTextureAt(n.image,o-1,r),e._texture.drawTextureAt(n.image,o+1,r),e._texture.drawTextureAt(n.image,o,r-1),e._texture.drawTextureAt(n.image,o,r+1)),e._texture.drawTextureAt(n.image,o,r),e._count++,e._innerTextureInfos[a]={texture:n,x:o,y:r});let{x:c,y:h}=t.rect;c+=l?.x||o,h+=l?.y||r;const d={texture:e._texture,x:c,y:h};return e._innerSpriteFrames.push(t),d},this.refreshComponents=e=>{e.forEach((e=>{e.node.active&&(e.node.active=!1,e.node.active=!0)}))}}init(){const{TextureAtlasOptimize:e}=OV;e&&(console.info("DynamicAtlas: init",{TextureAtlasOptimize:e}),this.listenEvents(),this.overrideDynamicAtlas())}listenEvents(){kV.on(MV.SCENE_LAUNCHED,this.requestUpdateDynamicAtlas),W.on(ia,this.requestUpdateDynamicAtlas),m.on(Q.EVENT_BEFORE_RENDER,this.updateRenderTime),m.on(Q.EVENT_AFTER_RENDER,this.checkRenderTimeHighers)}overrideDynamicAtlas(){const{instance:e}=ge;ge.instance.insertSpriteFrame=t=>{if(e._atlasIndex>=e._maxAtlasCount)return null;if(!t||t.original)return null;if(!t.packable)return null;let i=this.getAtlas();const n=i?i.insertSpriteFrame(t):null;return!n&&e._atlasIndex<e._maxAtlasCount?(i=this.getAtlas(),i?i.insertSpriteFrame(t):null):n}}createAtlas(){const{instance:e}=ge;return e.newAtlas()}getAtlas(){const{_atlases:e=[],_atlasIndex:t,textureBleeding:i}=ge.instance;let n=e[t];return n||(n=this.createAtlas()),n.originalInsertSpriteFrame||(n.originalInsertSpriteFrame=n.insertSpriteFrame,n.insertSpriteFrame=e=>this.drawTexture(n,e,i)),n}updateAtlasData(){if(!this.atlasInfo)return;console.info("DynamicAtlas: atlas info",this.atlasInfo);const{packedInfo:e}=this.atlasInfo;ge.instance.reset();const t=this.getAtlas();if(t){const{width:i,height:n}=e,a=Math.max(i,n);t._texture.initWithSize(a,a),console.info("DynamicAtlas: Resize texture",a,t._texture)}}}i._RF.pop();var FV={text:{level:"Level",settings:"SETTINGS",music:"Music",sound:"Sound",vibrate:"Vibrate",resume:"CONTINUE",on:"ON",off:"OFF",notification:"Notification",adsNotComplete:"Sorry, No Rewards!\nYou have cancelled the ad!",loadingAds:"Loading ads...",loading:"Loading...",load:"Loading",rewardNotReady:"No ads to display!",next:"NEXT",completed:"COMPLETED",tryAgain:"TRY AGAIN",retry:"RETRY",congratulation:"CONGRATULATION",you_have_pass_all_levels:"You have passed all levels.",please_come_back_later:"Please come back later,\nwe will update soon!",start_over:"START OVER",confirmation:"CONFIRMATION",are_you_sure_to_start_over:"ARE YOU SURE TO START OVER?",you_will_play_the_game_again:"You will play the game again\nfrom the beginning, at level 1.",no:"NO",yes:"YES"},texture:{image:"image"}};i._RF.push({},"14b76Yew19JgY7K+L9F5mmu","Languages",void 0);const{Events:BV}=GameCore,{event:zV,language:UV}=globalThis.game;class GV{constructor(){this.handleLanguageChanged=async e=>{const{locale:t}=e;W.emit("update-language",t),this.updateComponentInEditor()}}init(){this.addLanguage("en").then((()=>{this.setLanguage("en"),this.listenEvent()}))}listenEvent(){zV.on(BV.LANGUAGE_CHANGED,this.handleLanguageChanged)}async addLanguage(e){const t=await this.getLangData(e);UV.add(e,t)}setLanguage(e){UV.choose(e)}async getLangData(e){switch(e){case"en":return FV;case"ru":return this.loadLanguageAsync(e);default:throw new Error(`Language ${e} not supported`)}}async loadLanguageAsync(e){const i=(await t.import(`db://assets/resources/locales/${e}.json`)).default;UV.add(e,i)}updateComponentInEditor(){}}i._RF.pop(),i._RF.push({},"fb33bK/6Y5FAas5AwmmBM/X","Leaderboards",void 0);const{Configs:{Mockup:{Leaderboards:HV,GameSDK:{Player:VV}},Leaderboards:qV},Utils:{Number:WV}}=GameCore,{leaderboard:KV}=globalThis.game;class YV{constructor(){this.handleWhenGameSDKStarted=()=>{HV.Enabled?this.setupLeaderboardsMockup():this.setupLeaderboards()}}init(){this.handleWhenGameSDKStarted()}async setupLeaderboards(){this.setupLeaderboardByConfigs()}setupLeaderboardByConfigs(){const{LeaderboardId:e}=qV;e?(KV.addLeaderboard({name:Lr,type:"global",autoSortRank:!0,leaderboardId:e}),KV.addLeaderboard({name:Dr,type:"friends",autoSortRank:!0,leaderboardId:e})):console.warn("LeaderboardId in Configs is not set")}async setupLeaderboardsMockup(){this.setupMockGlobalLeaderboard(),this.setupMockFriendsLeaderboard(),this.setupMockGlobalTournamentLeaderboard()}async setupMockGlobalLeaderboard(){const e=Lr,t=Or,i=await KV.createLeaderboardAsync({_id:t,name:e,numberOfLeaders:100});KV.addLeaderboard({name:e,type:"global",autoSortRank:!0,leaderboardId:i}),await KV.requestLeaderboardAsync(e,10);let n=KV.getLeaderboard(e);console.info("setupGlobalLeaderboard fetch new",n,n&&Object.keys(n.leaders).length),n=KV.getLeaderboard(e),console.info("setupGlobalLeaderboard load more",n,n&&Object.keys(n.leaders).length)}async setupMockFriendsLeaderboard(){const e=Dr,t=Nr;let i=0;const{ConnectedPlayers:n}=VV;n.Enabled&&(i=WV.random(n.NumOfPlayers));const a=await KV.createLeaderboardAsync({_id:t,name:e,numberOfLeaders:i});KV.addLeaderboard({name:e,type:"friends",autoSortRank:!0,leaderboardId:a}),await KV.requestLeaderboardAsync(e,10);const s=KV.getLeaderboard(e);console.info("setupFriendsLeaderboard done",s)}async setupMockGlobalTournamentLeaderboard(){const e=await Ql.requestTournamentDataAsync();e.forEach((e=>{const{payload:t}=e,{leaderboardId:i}=t;i&&(KV.isExistLeaderboardId(i)||KV.addLeaderboard({type:"tournament",name:i,autoSortRank:!0,leaderboardId:i}))})),console.info("setupGlobalTournamentLeaderboard done",e)}}i._RF.pop(),i._RF.push({},"e7bf73g4jJGuI9FqvW5YBsS","PerformanceMonitor",void 0);const{Configs:{PerformanceMonitor:jV},Utils:XV,Events:$V}=GameCore,{event:JV}=globalThis.game;class QV{constructor(){this.markName="FPS Tracking",this.handleStartTraceFps=()=>{this.startTraceFps()},this.handleLateUpdate=()=>{if(this.mark){if(this.fpsTraceDuration-=W.deltaTime,this.fpsTraceDuration<=0&&!this.traceStopped)return this.traceStopped=!0,this.unListenEvents(),this.updateFPS(),void this.mark.stop(this.markName);this.fpsTraceIntervalTimer-=W.deltaTime,this.fpsTraceIntervalTimer>0||(this.fpsTraceIntervalTimer=this.fpsTraceInterval,this.updateFPS(),this.mark.stop(this.markName),this.startTraceFps())}}}get mark(){return jV.FpsTracking?XV.Mark:null}init(){const{TrackingDuration:e,TrackingInterval:t}=jV.FpsTracking;this.fpsTraceDuration=e??60,this.fpsTraceInterval=t??10,this.fpsTraceIntervalTimer=this.fpsTraceInterval,this.traceStopped=!1,this.listenEvents()}listenEvents(){JV.once($V.GAME_READY,this.handleStartTraceFps),m.on(Q.EVENT_AFTER_UPDATE,this.handleLateUpdate)}unListenEvents(){m.off(Q.EVENT_AFTER_UPDATE,this.handleLateUpdate)}startTraceFps(){this.mark&&(this.mark.measure(this.markName),this.mark.start(this.markName))}updateFPS(){if(!this.mark)return;const e=this.getFPS(),t=this.getDrawCalls(),i=this.getDeviceRender(),n=this.getTextureMemory();this.minFps=Math.min(this.minFps??e,e),this.maxFps=Math.max(this.maxFps??0,e),this.mark.putMetric(this.markName,"FPS Metric",e),this.mark.putAttr(this.markName,"Page Title",document.title),this.mark.putAttr(this.markName,"Device Render",i),this.mark.putAttr(this.markName,"Draw Calls",t.toString()),this.mark.putAttr(this.markName,"Texture Memory",n.toFixed(2)),this.mark.putAttr(this.markName,"Min FPS",this.minFps.toString()),this.mark.putAttr(this.markName,"Max FPS",this.maxFps.toString()),console.info(`FPS: ${e} Min: ${this.minFps} Max: ${this.maxFps}, draw calls: ${t}, texture memory: ${n.toFixed(2)}MB`)}getFPS(){if(!m.root)return 0;const{fps:e}=m.root;return Math.floor(e)||0}getDrawCalls(){if(!m.root)return 0;const{numDrawCalls:e}=m.root.device;return e||0}getDeviceRender(){if(!m.root)return"Unknown";const{renderer:e}=m.root.device;return e||"Unknown"}getTextureMemory(){if(!m.root)return 0;const{memoryStatus:e}=m.root.device;return e.textureSize/1048576||0}}i._RF.pop(),i._RF.push({},"58248LBip1DBrMjK0UWw2rM","RemoteConfig",void 0);const{Events:ZV}=GameCore,{event:eq}=globalThis.game;class tq{constructor(){this.handleHotReload=()=>{W.restart()},this.handleUpdateConfig=e=>{if("Gameplay"!==e.type)return;W.emit($n,e.config);const{id:t,type:i}=e;eq.emit(ZV.REMOTE_CONFIG_UPDATED,{id:t,type:i})}}init(){this.listenEvents()}listenEvents(){eq.on(ZV.REQUEST_HOT_RELOAD,this.handleHotReload),eq.on(ZV.REQUEST_UPDATE_CONFIG,this.handleUpdateConfig)}}i._RF.pop(),i._RF.push({},"c34a93D1BREiKms1T21AkQS","PluginsManager",void 0);class iq{init(){console.info("Plugins Manager: Initialized"),this.initCocosStats(),this.initDynamicAtlas()}initLanguages(){(new GV).init()}initCocosStats(){(new AV).init()}initLeaderboards(){(new YV).init()}initRemoteConfig(){(new tq).init()}initDynamicAtlas(){(new xV).init()}initDynamicAssets(){(new DV).init()}initCanvasRecorder(){(new TV).init()}initPerformanceMonitor(){(new QV).init()}initAdaptivePerformance(){(new CV).init()}}i._RF.pop(),i._RF.push({},"ac8b03T+rFB061sXoEEsCUH","SceneManager",void 0);const{event:nq,monitorError:aq}=globalThis.game,{Events:sq,Configs:{PerformanceMonitor:oq},Utils:{Mark:rq}}=GameCore;class lq{constructor(){this.markName="Load Scene",this.queueLoadScene={},this.callbackSwitchScene=null,this.switchScene=async e=>{const{sceneName:t,sceneData:i}=e,n=this.correctSceneName(t);console.info("Switching",n,i??{}),n&&(Wl.showLoadingFullScreen(n),this.startScene({sceneName:n,sceneData:i}))},this.preloadScene=(e,t)=>{const{sceneName:i}=e;this.startMeasure(i),m.preloadScene(i,this.onSceneProgress,this.onScenePreloaded(i,t))},this.startMeasure=e=>{this.mark&&(this.queueLoadScene[e]&&(this.mark.putAttr(this.markName,"Canceled","true"),this.stopMeasure(e)),console.groupCollapsed(" Load scene progress"),this.mark.measure(this.markName),this.mark.putAttr(this.markName,"Cancel","false"),this.mark.putAttr(this.markName,"Success","false"),this.mark.putMetric(this.markName,e),this.mark.start(this.markName),this.queueLoadScene[e]=!0)},this.stopMeasure=e=>{this.mark&&this.queueLoadScene[e]&&(this.mark.rmAttr(this.markName,"File"),this.mark.putAttr(this.markName,"Success","true"),this.mark.stop(this.markName),this.queueLoadScene[e]=!1,console.groupEnd())},this.onSceneProgress=(e,t,i)=>{const n=e/t;this.mark&&this.mark.putAttr(this.markName,"Last File",`${i.id} (${i.ext})`);const a=Math.floor(70*n+30);GameSDK.setLoadingProgress(a)},this.onScenePreloaded=(e,t)=>i=>{i?console.warn("SceneManager.onScenePreloaded",{sceneName:e,error:i}):(t&&t(e,i),nq.emit(sq.SCENE_LOADED,{sceneName:e,isPreload:!0}))},this.onDirectorLoadScene=e=>(t,i)=>{if(t)return void console.warn("SceneManager.onSceneLoaded",t);if(!i?.scene)return void console.warn("SceneManager.onSceneLoaded","Scene not found");const n=i.name;this.handleBeforeSceneLaunch(i,e)(),m.once(Q.EVENT_AFTER_SCENE_LAUNCH,this.handleSceneLaunched(n,e))},this.handleBeforeSceneLaunch=(e,t)=>()=>{this.setSceneData(e,t??{}),W.emit(jn),nq.emit(sq.SCENE_LOADED,{sceneName:e.name})},this.handleSceneLaunched=(e,t)=>()=>{Wl.hideLoadingFullScreen(e),ji.switchSceneTracking(),aq?.addMetadata({currentScene:e}),this.callbackSwitchScene?.({sceneName:e,sceneData:t}),nq.emit(sq.SCENE_LAUNCHED,{sceneName:e})},this.handleSceneLoaded=e=>{const{sceneName:t}=e;this.stopMeasure(t)}}init(){this.listenEvents(),console.info("Scene Manager: Initialized")}listenEvents(){nq.on(sq.SWITCH_SCENE,this.switchScene),nq.on(sq.PRELOAD_SCENE,this.preloadScene),nq.on(sq.SCENE_LOADED,this.handleSceneLoaded)}correctSceneName(e){const t=this.getCurrentScene();return t&&e===t.name?null:e}startScene(e){const{sceneName:t,sceneData:i}=e;this.preloadScene({sceneName:t},((e,n)=>{e===t&&(n?console.warn("SceneManager.startScene",{sceneName:t,error:n}):m.loadScene(t,this.onDirectorLoadScene(i)))}))}get mark(){return oq.LoadResources?rq:null}getCurrentScene(){return m.getScene()}getLoadedScenes(){const e=[];return Object.keys(this.queueLoadScene).map((t=>{this.queueLoadScene[t]||e.push(t)})),e}onSwitchScene(e){this.callbackSwitchScene=e}setSceneData(e,t){if(!t)return;if("data"in e||e.scene.attr({data:{}}),!("data"in e))return;const i=e.data||{};e.scene.attr({data:{...i,...t}}),console.info("SceneManager.setSceneData",{sceneName:e.name,sceneData:t,currentData:i})}}i._RF.pop(),i._RF.push({},"617b2SRAL5CyL75C998xBnx","ScreenManager",void 0);const{event:cq,monitorError:hq}=globalThis.game,{Events:dq,Utils:{Object:uq}}=GameCore;class pq{constructor(){this.screens={},this.handleOpenScreen=e=>{const{screenName:t,screenData:i}=e;this.openScreen(t,i)},this.handleCloseScreen=e=>{const{screenName:t}=e;this.closeScreen(t)}}init(){this.listenEvents(),console.info("Screen Manager: Initialized")}listenEvents(){cq.on(dq.OPEN_SCREEN,this.handleOpenScreen),cq.on(dq.CLOSE_SCREEN,this.handleCloseScreen)}reorderScreens(){const e=uq.vals(this.screens).filter((e=>"ready"===e.state));e.sort(((e,t)=>e.order-t.order));for(let t=0;t<e.length;t++){const i=e[t];i.order=t,i.comp.node.setSiblingIndex(i.order)}}addScreenKeys(e,t){e.forEach(((e,i)=>{this.screens[Vi[e]]&&(this.screens[Vi[e]].order=i),this.screens[Vi[e]]={state:"key",parent:t,key:e,order:i}}))}addScreens(e){e.forEach(((e,t)=>{this.screens[e.node.name]={state:"ready",comp:e,order:t}}))}async preloadScreens(){const e=uq.vals(this.screens).reduce(((e,t)=>{if("key"===t.state){const i=hi.loadPrefabAsync(`screens/${Vi[t.key]}`);e.push(i)}return e}),[]);return await Promise.all(e)}async getScreen(e){const t=this.screens[e];if(null==t)return hq?.sendException(new Error(`ScreenManager.openScreen Screen ${e} not found`),{screenName:e,screens:this.getScreensAsMetadata()}),null;if("ready"===t.state)return t.comp;console.info("ScreenManager.getScreen",`Screen ${e} not found in cache, instantiating it...`);const{parent:i,key:n,order:a}=t,s=await hi.loadPrefabAsync(`screens/${Vi[n]}`);if(!s)return hq?.sendException(new Error(`ScreenManager.getScreen: Failed to load Screen ${e} prefab...`),{screenName:e,screens:this.getScreensAsMetadata()}),null;const o=c(s);o.name=e,i.addChild(o),o.active=!1;const r=o.getComponent(Dk);return r?(this.screens[e]={state:"ready",comp:r,order:a},this.reorderScreens(),r):(hq?.sendException(new Error(`ScreenManager.getScreen: Screen ${e} prefab doesn't have BaseScreen component...`),{screenName:e,screens:this.getScreensAsMetadata()}),null)}getScreensAsMetadata(){return Object.keys(this.screens).map((e=>{const t=this.screens[e];return"ready"===t.state?`${t.comp.node.name}(loaded)`:`${Vi[t.key]}(notloaded)`})).join(", ")}clearScreens(){this.screens={}}async openScreen(e,t){try{hi.setBlockInput(!0);const i=await this.getScreen(e);if(hi.setBlockInput(!1),!i?.node)return void console.warn("ScreenManager.openScreen",`Screen ${e} not found`);i.node.active=!0,i.node.setPosition(new j(0,0,0));const n={screenName:e,screenData:t};cq.emit(dq.OPENING_SCREEN,n),ji.trackCurrentPage(e,!0),hq?.addMetadata({currentScreen:e}),await vt.waitTweenAsync(0),i.open(t),cq.emit(dq.OPENED_SCREEN,n)}catch(e){console.error("ScreenManager.openScreen",e)}}async closeScreen(e){try{const t=await this.getScreen(e);if(!t)return void console.warn("ScreenManager.closeScreen",`Screen ${e} not found`);if(!t.node?.active)return;const i={screenName:e};cq.emit(dq.CLOSING_SCREEN,i),t.close(),ji.trackCurrentPage(e,!1),hq?.removeMetadata("currentScreen")}catch(e){console.error("ScreenManager.closeScreen",e)}}closeAllScreens(){Object.keys(this.screens).forEach((e=>{"ready"===this.screens[e].state&&this.closeScreen(e)}))}}i._RF.pop(),i._RF.push({},"a851bnZR1RCUILrjMPf7nMm","CorecosSystem",void 0);const{Configs:{Core:mq},Events:gq,Plugins:{Analytics:{Events:yq}}}=GameCore,{context:bq,storage:fq,event:wq,analytics:Sq,monitorError:vq}=globalThis.game;new class{constructor(){this.coreManager=new WH,this.matchManager=new dV,this.sceneManager=new lq,this.screenManager=new pq,this.engineManager=new jH,this.layoutManager=new nV,this.playerManager=new bV,this.pluginsManager=new iq,this.handleWhenCoreBoot=()=>{W.inited?this.handleCocosInit():W.once(Se.EVENT_POST_PROJECT_INIT,this.handleCocosInit)},this.handleCocosInit=()=>{this.coreManager.requestStart()},this.handleWhenCoreStart=()=>{this.playerManager.setupDefaultGameData(),this.matchManager.setupDefaultMatchData(),console.groupEnd()},this.handleWhenCoreReady=()=>{this.initPlugins(),console.groupEnd(),mq.StartSDKAfterLoadGame?wq.once(gq.SCENE_LOADED,this.handleStartGameWhenMainSceneReady):this.processStartGame(),this.preloadScenes()},this.handleStartGameWhenMainSceneReady=()=>{this.processStartGame()},this.handleSwitchScene=e=>{const{sceneName:t}=e,i=this.sceneManager.getCurrentScene();if(i?.name!==t)return;this.screenManager.closeAllScreens(),this.screenManager.clearScreens();const n=i?.getComponentsInChildren(Dk);if(n.length>0){const e=n.map((e=>e.node.name)).join(", ");console.info(` Loaded Screens in ${t}: ${e}`),this.screenManager.addScreens(n)}const a=i?.getComponentInChildren(Hk);if(!a)return;const s=a.screenKeys.filter((e=>!n.some((t=>t.node.name===Vi[e]))));if(0===s.length)return;const o=s.map((e=>Vi[e])).join(", ");console.info(` Lazy-loading Screens in ${t}: ${o}`),this.screenManager.addScreenKeys(s,a.node),this.screenManager.preloadScreens()},console.groupCollapsed(" Corecos System"),console.info("Corecos Initializing..."),this.listenEvents(),this.initManagers(),console.groupEnd()}initManagers(){this.coreManager.init(),this.engineManager.init(),this.layoutManager.init(),this.sceneManager.init(),this.screenManager.init(),this.playerManager.init(),this.matchManager.init(),this.pluginsManager.init()}listenEvents(){this.coreManager.onCoreBoot(this.handleWhenCoreBoot),this.coreManager.onCoreStart(this.handleWhenCoreStart),this.coreManager.onCoreReady(this.handleWhenCoreReady),this.sceneManager.onSwitchScene(this.handleSwitchScene)}preloadScenes(){"solo"===fq.getStorageData("context","sessionContextType")?El.preloadDashboardScene():El.preloadGameScene()}async processStartGame(){console.groupEnd(),Sq.event(yq.LOAD_COMPLETE),await this.startGameAsync(),this.startProcessContextData(),this.playerManager.requestConnectedPlayers(),Sq.event(yq.APP_READY,{success:!0}),wq.emit(gq.GAME_READY)}async startGameAsync(){try{await GameSDK.startGameAsync(),Sq.event(yq.GAME_SDK_READY,{success:!0})}catch(e){console.warn("GameSDK.startGameAsync",e),Sq.event(yq.GAME_SDK_READY,{success:!1}),e instanceof Error&&vq?.sendException(e)}}startProcessContextData(){wq.getEventEmitCount(gq.PLAYER_INFO_LOADED)?bq.processContextData().catch((e=>{console.error("startProcessContextData",e)})):wq.once(gq.PLAYER_INFO_LOADED,this.startProcessContextData)}initPlugins(){this.pluginsManager.initLeaderboards(),this.pluginsManager.initDynamicAssets(),this.pluginsManager.initCanvasRecorder(),this.pluginsManager.initPerformanceMonitor(),this.pluginsManager.initAdaptivePerformance()}},i._RF.pop()}}}));

(function(r) {
  r('virtual:///prerequisite-imports/start-scene', 'chunks:///start-scene.js'); 
})(function(mid, cid) {
    System.register(mid, [cid], function (_export, _context) {
    return {
        setters: [function(_m) {
            var _exportObj = {};

            for (var _key in _m) {
              if (_key !== "default" && _key !== "__esModule") _exportObj[_key] = _m[_key];
            }
      
            _export(_exportObj);
        }],
        execute: function () { }
    };
    });
});